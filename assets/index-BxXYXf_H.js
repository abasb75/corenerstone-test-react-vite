(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();var cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Dy(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}),n}var e3={exports:{}},Zl={},t3={exports:{}},ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n0=Symbol.for("react.element"),Vy=Symbol.for("react.portal"),Ly=Symbol.for("react.fragment"),_y=Symbol.for("react.strict_mode"),Ny=Symbol.for("react.profiler"),Iy=Symbol.for("react.provider"),Fy=Symbol.for("react.context"),ky=Symbol.for("react.forward_ref"),Uy=Symbol.for("react.suspense"),Py=Symbol.for("react.memo"),by=Symbol.for("react.lazy"),Q5=Symbol.iterator;function Gy(t){return t===null||typeof t!="object"?null:(t=Q5&&t[Q5]||t["@@iterator"],typeof t=="function"?t:null)}var n3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},r3=Object.assign,a3={};function ys(t,e,n){this.props=t,this.context=e,this.refs=a3,this.updater=n||n3}ys.prototype.isReactComponent={};ys.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ys.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function i3(){}i3.prototype=ys.prototype;function R2(t,e,n){this.props=t,this.context=e,this.refs=a3,this.updater=n||n3}var O2=R2.prototype=new i3;O2.constructor=R2;r3(O2,ys.prototype);O2.isPureReactComponent=!0;var J5=Array.isArray,s3=Object.prototype.hasOwnProperty,M2={current:null},o3={key:!0,ref:!0,__self:!0,__source:!0};function c3(t,e,n){var r,a={},i=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(i=""+e.key),e)s3.call(e,r)&&!o3.hasOwnProperty(r)&&(a[r]=e[r]);var o=arguments.length-2;if(o===1)a.children=n;else if(1<o){for(var c=Array(o),l=0;l<o;l++)c[l]=arguments[l+2];a.children=c}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)a[r]===void 0&&(a[r]=o[r]);return{$$typeof:n0,type:t,key:i,ref:s,props:a,_owner:M2.current}}function By(t,e){return{$$typeof:n0,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function D2(t){return typeof t=="object"&&t!==null&&t.$$typeof===n0}function Ay(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var ep=/\/+/g;function Wu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Ay(""+t.key):e.toString(36)}function pc(t,e,n,r,a){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case n0:case Vy:s=!0}}if(s)return s=t,a=a(s),t=r===""?"."+Wu(s,0):r,J5(a)?(n="",t!=null&&(n=t.replace(ep,"$&/")+"/"),pc(a,e,n,"",function(l){return l})):a!=null&&(D2(a)&&(a=By(a,n+(!a.key||s&&s.key===a.key?"":(""+a.key).replace(ep,"$&/")+"/")+t)),e.push(a)),1;if(s=0,r=r===""?".":r+":",J5(t))for(var o=0;o<t.length;o++){i=t[o];var c=r+Wu(i,o);s+=pc(i,e,n,c,a)}else if(c=Gy(t),typeof c=="function")for(t=c.call(t),o=0;!(i=t.next()).done;)i=i.value,c=r+Wu(i,o++),s+=pc(i,e,n,c,a);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function O0(t,e,n){if(t==null)return t;var r=[],a=0;return pc(t,r,"","",function(i){return e.call(n,i,a++)}),r}function Wy(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Kt={current:null},dc={transition:null},zy={ReactCurrentDispatcher:Kt,ReactCurrentBatchConfig:dc,ReactCurrentOwner:M2};function l3(){throw Error("act(...) is not supported in production builds of React.")}ve.Children={map:O0,forEach:function(t,e,n){O0(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return O0(t,function(){e++}),e},toArray:function(t){return O0(t,function(e){return e})||[]},only:function(t){if(!D2(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ve.Component=ys;ve.Fragment=Ly;ve.Profiler=Ny;ve.PureComponent=R2;ve.StrictMode=_y;ve.Suspense=Uy;ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zy;ve.act=l3;ve.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=r3({},t.props),a=t.key,i=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,s=M2.current),e.key!==void 0&&(a=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(c in e)s3.call(e,c)&&!o3.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&o!==void 0?o[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){o=Array(c);for(var l=0;l<c;l++)o[l]=arguments[l+2];r.children=o}return{$$typeof:n0,type:t.type,key:a,ref:i,props:r,_owner:s}};ve.createContext=function(t){return t={$$typeof:Fy,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Iy,_context:t},t.Consumer=t};ve.createElement=c3;ve.createFactory=function(t){var e=c3.bind(null,t);return e.type=t,e};ve.createRef=function(){return{current:null}};ve.forwardRef=function(t){return{$$typeof:ky,render:t}};ve.isValidElement=D2;ve.lazy=function(t){return{$$typeof:by,_payload:{_status:-1,_result:t},_init:Wy}};ve.memo=function(t,e){return{$$typeof:Py,type:t,compare:e===void 0?null:e}};ve.startTransition=function(t){var e=dc.transition;dc.transition={};try{t()}finally{dc.transition=e}};ve.unstable_act=l3;ve.useCallback=function(t,e){return Kt.current.useCallback(t,e)};ve.useContext=function(t){return Kt.current.useContext(t)};ve.useDebugValue=function(){};ve.useDeferredValue=function(t){return Kt.current.useDeferredValue(t)};ve.useEffect=function(t,e){return Kt.current.useEffect(t,e)};ve.useId=function(){return Kt.current.useId()};ve.useImperativeHandle=function(t,e,n){return Kt.current.useImperativeHandle(t,e,n)};ve.useInsertionEffect=function(t,e){return Kt.current.useInsertionEffect(t,e)};ve.useLayoutEffect=function(t,e){return Kt.current.useLayoutEffect(t,e)};ve.useMemo=function(t,e){return Kt.current.useMemo(t,e)};ve.useReducer=function(t,e,n){return Kt.current.useReducer(t,e,n)};ve.useRef=function(t){return Kt.current.useRef(t)};ve.useState=function(t){return Kt.current.useState(t)};ve.useSyncExternalStore=function(t,e,n){return Kt.current.useSyncExternalStore(t,e,n)};ve.useTransition=function(){return Kt.current.useTransition()};ve.version="18.3.1";t3.exports=ve;var ka=t3.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $y=ka,jy=Symbol.for("react.element"),Hy=Symbol.for("react.fragment"),Ky=Object.prototype.hasOwnProperty,qy=$y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Xy={key:!0,ref:!0,__self:!0,__source:!0};function u3(t,e,n){var r,a={},i=null,s=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)Ky.call(e,r)&&!Xy.hasOwnProperty(r)&&(a[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)a[r]===void 0&&(a[r]=e[r]);return{$$typeof:jy,type:t,key:i,ref:s,props:a,_owner:qy.current}}Zl.Fragment=Hy;Zl.jsx=u3;Zl.jsxs=u3;e3.exports=Zl;var js=e3.exports,f3={exports:{}},hn={},g3={exports:{}},p3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,N){var k=U.length;U.push(N);e:for(;0<k;){var z=k-1>>>1,j=U[z];if(0<a(j,N))U[z]=N,U[k]=j,k=z;else break e}}function n(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var N=U[0],k=U.pop();if(k!==N){U[0]=k;e:for(var z=0,j=U.length,$=j>>>1;z<$;){var re=2*(z+1)-1,xt=U[re],Me=re+1,Gt=U[Me];if(0>a(xt,k))Me<j&&0>a(Gt,xt)?(U[z]=Gt,U[Me]=k,z=Me):(U[z]=xt,U[re]=k,z=re);else if(Me<j&&0>a(Gt,k))U[z]=Gt,U[Me]=k,z=Me;else break e}}return N}function a(U,N){var k=U.sortIndex-N.sortIndex;return k!==0?k:U.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var c=[],l=[],f=1,u=null,g=3,p=!1,h=!1,d=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(U){for(var N=n(l);N!==null;){if(N.callback===null)r(l);else if(N.startTime<=U)r(l),N.sortIndex=N.expirationTime,e(c,N);else break;N=n(l)}}function T(U){if(d=!1,y(U),!h)if(n(c)!==null)h=!0,P(x);else{var N=n(l);N!==null&&K(T,N.startTime-U)}}function x(U,N){h=!1,d&&(d=!1,v(E),E=-1),p=!0;var k=g;try{for(y(N),u=n(c);u!==null&&(!(u.expirationTime>N)||U&&!D());){var z=u.callback;if(typeof z=="function"){u.callback=null,g=u.priorityLevel;var j=z(u.expirationTime<=N);N=t.unstable_now(),typeof j=="function"?u.callback=j:u===n(c)&&r(c),y(N)}else r(c);u=n(c)}if(u!==null)var $=!0;else{var re=n(l);re!==null&&K(T,re.startTime-N),$=!1}return $}finally{u=null,g=k,p=!1}}var S=!1,w=null,E=-1,L=5,R=-1;function D(){return!(t.unstable_now()-R<L)}function I(){if(w!==null){var U=t.unstable_now();R=U;var N=!0;try{N=w(!0,U)}finally{N?b():(S=!1,w=null)}}else S=!1}var b;if(typeof C=="function")b=function(){C(I)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,W=F.port2;F.port1.onmessage=I,b=function(){W.postMessage(null)}}else b=function(){m(I,0)};function P(U){w=U,S||(S=!0,b())}function K(U,N){E=m(function(){U(t.unstable_now())},N)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){h||p||(h=!0,P(x))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(U){switch(g){case 1:case 2:case 3:var N=3;break;default:N=g}var k=g;g=N;try{return U()}finally{g=k}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,N){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var k=g;g=U;try{return N()}finally{g=k}},t.unstable_scheduleCallback=function(U,N,k){var z=t.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?z+k:z):k=z,U){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=k+j,U={id:f++,callback:N,priorityLevel:U,startTime:k,expirationTime:j,sortIndex:-1},k>z?(U.sortIndex=k,e(l,U),n(c)===null&&U===n(l)&&(d?(v(E),E=-1):d=!0,K(T,k-z))):(U.sortIndex=j,e(c,U),h||p||(h=!0,P(x))),U},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(U){var N=g;return function(){var k=g;g=N;try{return U.apply(this,arguments)}finally{g=k}}}})(p3);g3.exports=p3;var Yy=g3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zy=ka,dn=Yy;function q(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d3=new Set,Mo={};function gi(t,e){rs(t,e),rs(t+"Capture",e)}function rs(t,e){for(Mo[t]=e,t=0;t<e.length;t++)d3.add(e[t])}var Mr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$f=Object.prototype.hasOwnProperty,Qy=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tp={},np={};function Jy(t){return $f.call(np,t)?!0:$f.call(tp,t)?!1:Qy.test(t)?np[t]=!0:(tp[t]=!0,!1)}function eC(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function tC(t,e,n,r){if(e===null||typeof e>"u"||eC(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qt(t,e,n,r,a,i,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=s}var Ot={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ot[t]=new qt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ot[e]=new qt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ot[t]=new qt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ot[t]=new qt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ot[t]=new qt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ot[t]=new qt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ot[t]=new qt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ot[t]=new qt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ot[t]=new qt(t,5,!1,t.toLowerCase(),null,!1,!1)});var V2=/[\-:]([a-z])/g;function L2(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(V2,L2);Ot[e]=new qt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(V2,L2);Ot[e]=new qt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(V2,L2);Ot[e]=new qt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ot[t]=new qt(t,1,!1,t.toLowerCase(),null,!1,!1)});Ot.xlinkHref=new qt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ot[t]=new qt(t,1,!1,t.toLowerCase(),null,!0,!0)});function _2(t,e,n,r){var a=Ot.hasOwnProperty(e)?Ot[e]:null;(a!==null?a.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(tC(e,n,a,r)&&(n=null),r||a===null?Jy(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):a.mustUseProperty?t[a.propertyName]=n===null?a.type===3?!1:"":n:(e=a.attributeName,r=a.attributeNamespace,n===null?t.removeAttribute(e):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var kr=Zy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M0=Symbol.for("react.element"),Di=Symbol.for("react.portal"),Vi=Symbol.for("react.fragment"),N2=Symbol.for("react.strict_mode"),jf=Symbol.for("react.profiler"),h3=Symbol.for("react.provider"),m3=Symbol.for("react.context"),I2=Symbol.for("react.forward_ref"),Hf=Symbol.for("react.suspense"),Kf=Symbol.for("react.suspense_list"),F2=Symbol.for("react.memo"),jr=Symbol.for("react.lazy"),v3=Symbol.for("react.offscreen"),rp=Symbol.iterator;function Ls(t){return t===null||typeof t!="object"?null:(t=rp&&t[rp]||t["@@iterator"],typeof t=="function"?t:null)}var He=Object.assign,zu;function Hs(t){if(zu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);zu=e&&e[1]||""}return`
`+zu+t}var $u=!1;function ju(t,e){if(!t||$u)return"";$u=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var a=l.stack.split(`
`),i=r.stack.split(`
`),s=a.length-1,o=i.length-1;1<=s&&0<=o&&a[s]!==i[o];)o--;for(;1<=s&&0<=o;s--,o--)if(a[s]!==i[o]){if(s!==1||o!==1)do if(s--,o--,0>o||a[s]!==i[o]){var c=`
`+a[s].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=s&&0<=o);break}}}finally{$u=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Hs(t):""}function nC(t){switch(t.tag){case 5:return Hs(t.type);case 16:return Hs("Lazy");case 13:return Hs("Suspense");case 19:return Hs("SuspenseList");case 0:case 2:case 15:return t=ju(t.type,!1),t;case 11:return t=ju(t.type.render,!1),t;case 1:return t=ju(t.type,!0),t;default:return""}}function qf(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Vi:return"Fragment";case Di:return"Portal";case jf:return"Profiler";case N2:return"StrictMode";case Hf:return"Suspense";case Kf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case m3:return(t.displayName||"Context")+".Consumer";case h3:return(t._context.displayName||"Context")+".Provider";case I2:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case F2:return e=t.displayName||null,e!==null?e:qf(t.type)||"Memo";case jr:e=t._payload,t=t._init;try{return qf(t(e))}catch{}}return null}function rC(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return qf(e);case 8:return e===N2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function fa(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function y3(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function aC(t){var e=y3(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return a.call(this)},set:function(s){r=""+s,i.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function D0(t){t._valueTracker||(t._valueTracker=aC(t))}function C3(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=y3(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Hc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Xf(t,e){var n=e.checked;return He({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ap(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=fa(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function T3(t,e){e=e.checked,e!=null&&_2(t,"checked",e,!1)}function Yf(t,e){T3(t,e);var n=fa(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Zf(t,e.type,n):e.hasOwnProperty("defaultValue")&&Zf(t,e.type,fa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ip(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Zf(t,e,n){(e!=="number"||Hc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ks=Array.isArray;function ji(t,e,n,r){if(t=t.options,e){e={};for(var a=0;a<n.length;a++)e["$"+n[a]]=!0;for(n=0;n<t.length;n++)a=e.hasOwnProperty("$"+t[n].value),t[n].selected!==a&&(t[n].selected=a),a&&r&&(t[n].defaultSelected=!0)}else{for(n=""+fa(n),e=null,a=0;a<t.length;a++){if(t[a].value===n){t[a].selected=!0,r&&(t[a].defaultSelected=!0);return}e!==null||t[a].disabled||(e=t[a])}e!==null&&(e.selected=!0)}}function Qf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(q(91));return He({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function sp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(q(92));if(Ks(n)){if(1<n.length)throw Error(q(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:fa(n)}}function x3(t,e){var n=fa(e.value),r=fa(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function op(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function S3(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?S3(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var V0,w3=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,a){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,a)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(V0=V0||document.createElement("div"),V0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=V0.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Do(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var io={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},iC=["Webkit","ms","Moz","O"];Object.keys(io).forEach(function(t){iC.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),io[e]=io[t]})});function E3(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||io.hasOwnProperty(t)&&io[t]?(""+e).trim():e+"px"}function R3(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=E3(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,a):t[n]=a}}var sC=He({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function e1(t,e){if(e){if(sC[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(q(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(q(62))}}function t1(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var n1=null;function k2(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var r1=null,Hi=null,Ki=null;function cp(t){if(t=i0(t)){if(typeof r1!="function")throw Error(q(280));var e=t.stateNode;e&&(e=nu(e),r1(t.stateNode,t.type,e))}}function O3(t){Hi?Ki?Ki.push(t):Ki=[t]:Hi=t}function M3(){if(Hi){var t=Hi,e=Ki;if(Ki=Hi=null,cp(t),e)for(t=0;t<e.length;t++)cp(e[t])}}function D3(t,e){return t(e)}function V3(){}var Hu=!1;function L3(t,e,n){if(Hu)return t(e,n);Hu=!0;try{return D3(t,e,n)}finally{Hu=!1,(Hi!==null||Ki!==null)&&(V3(),M3())}}function Vo(t,e){var n=t.stateNode;if(n===null)return null;var r=nu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(q(231,e,typeof n));return n}var a1=!1;if(Mr)try{var _s={};Object.defineProperty(_s,"passive",{get:function(){a1=!0}}),window.addEventListener("test",_s,_s),window.removeEventListener("test",_s,_s)}catch{a1=!1}function oC(t,e,n,r,a,i,s,o,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(f){this.onError(f)}}var so=!1,Kc=null,qc=!1,i1=null,cC={onError:function(t){so=!0,Kc=t}};function lC(t,e,n,r,a,i,s,o,c){so=!1,Kc=null,oC.apply(cC,arguments)}function uC(t,e,n,r,a,i,s,o,c){if(lC.apply(this,arguments),so){if(so){var l=Kc;so=!1,Kc=null}else throw Error(q(198));qc||(qc=!0,i1=l)}}function pi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function _3(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function lp(t){if(pi(t)!==t)throw Error(q(188))}function fC(t){var e=t.alternate;if(!e){if(e=pi(t),e===null)throw Error(q(188));return e!==t?null:t}for(var n=t,r=e;;){var a=n.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return lp(a),t;if(i===r)return lp(a),e;i=i.sibling}throw Error(q(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,o=a.child;o;){if(o===n){s=!0,n=a,r=i;break}if(o===r){s=!0,r=a,n=i;break}o=o.sibling}if(!s){for(o=i.child;o;){if(o===n){s=!0,n=i,r=a;break}if(o===r){s=!0,r=i,n=a;break}o=o.sibling}if(!s)throw Error(q(189))}}if(n.alternate!==r)throw Error(q(190))}if(n.tag!==3)throw Error(q(188));return n.stateNode.current===n?t:e}function N3(t){return t=fC(t),t!==null?I3(t):null}function I3(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=I3(t);if(e!==null)return e;t=t.sibling}return null}var F3=dn.unstable_scheduleCallback,up=dn.unstable_cancelCallback,gC=dn.unstable_shouldYield,pC=dn.unstable_requestPaint,it=dn.unstable_now,dC=dn.unstable_getCurrentPriorityLevel,U2=dn.unstable_ImmediatePriority,k3=dn.unstable_UserBlockingPriority,Xc=dn.unstable_NormalPriority,hC=dn.unstable_LowPriority,U3=dn.unstable_IdlePriority,Ql=null,ar=null;function mC(t){if(ar&&typeof ar.onCommitFiberRoot=="function")try{ar.onCommitFiberRoot(Ql,t,void 0,(t.current.flags&128)===128)}catch{}}var An=Math.clz32?Math.clz32:CC,vC=Math.log,yC=Math.LN2;function CC(t){return t>>>=0,t===0?32:31-(vC(t)/yC|0)|0}var L0=64,_0=4194304;function qs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Yc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,a=t.suspendedLanes,i=t.pingedLanes,s=n&268435455;if(s!==0){var o=s&~a;o!==0?r=qs(o):(i&=s,i!==0&&(r=qs(i)))}else s=n&~a,s!==0?r=qs(s):i!==0&&(r=qs(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&a)&&(a=r&-r,i=e&-e,a>=i||a===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-An(e),a=1<<n,r|=t[n],e&=~a;return r}function TC(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xC(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,a=t.expirationTimes,i=t.pendingLanes;0<i;){var s=31-An(i),o=1<<s,c=a[s];c===-1?(!(o&n)||o&r)&&(a[s]=TC(o,e)):c<=e&&(t.expiredLanes|=o),i&=~o}}function s1(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function P3(){var t=L0;return L0<<=1,!(L0&4194240)&&(L0=64),t}function Ku(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function r0(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-An(e),t[e]=n}function SC(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var a=31-An(n),i=1<<a;e[a]=0,r[a]=-1,t[a]=-1,n&=~i}}function P2(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-An(n),a=1<<r;a&e|t[r]&e&&(t[r]|=e),n&=~a}}var De=0;function b3(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var G3,b2,B3,A3,W3,o1=!1,N0=[],na=null,ra=null,aa=null,Lo=new Map,_o=new Map,Xr=[],wC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fp(t,e){switch(t){case"focusin":case"focusout":na=null;break;case"dragenter":case"dragleave":ra=null;break;case"mouseover":case"mouseout":aa=null;break;case"pointerover":case"pointerout":Lo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_o.delete(e.pointerId)}}function Ns(t,e,n,r,a,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},e!==null&&(e=i0(e),e!==null&&b2(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),t)}function EC(t,e,n,r,a){switch(e){case"focusin":return na=Ns(na,t,e,n,r,a),!0;case"dragenter":return ra=Ns(ra,t,e,n,r,a),!0;case"mouseover":return aa=Ns(aa,t,e,n,r,a),!0;case"pointerover":var i=a.pointerId;return Lo.set(i,Ns(Lo.get(i)||null,t,e,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,_o.set(i,Ns(_o.get(i)||null,t,e,n,r,a)),!0}return!1}function z3(t){var e=Ba(t.target);if(e!==null){var n=pi(e);if(n!==null){if(e=n.tag,e===13){if(e=_3(n),e!==null){t.blockedOn=e,W3(t.priority,function(){B3(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function hc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=c1(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);n1=r,n.target.dispatchEvent(r),n1=null}else return e=i0(n),e!==null&&b2(e),t.blockedOn=n,!1;e.shift()}return!0}function gp(t,e,n){hc(t)&&n.delete(e)}function RC(){o1=!1,na!==null&&hc(na)&&(na=null),ra!==null&&hc(ra)&&(ra=null),aa!==null&&hc(aa)&&(aa=null),Lo.forEach(gp),_o.forEach(gp)}function Is(t,e){t.blockedOn===e&&(t.blockedOn=null,o1||(o1=!0,dn.unstable_scheduleCallback(dn.unstable_NormalPriority,RC)))}function No(t){function e(a){return Is(a,t)}if(0<N0.length){Is(N0[0],t);for(var n=1;n<N0.length;n++){var r=N0[n];r.blockedOn===t&&(r.blockedOn=null)}}for(na!==null&&Is(na,t),ra!==null&&Is(ra,t),aa!==null&&Is(aa,t),Lo.forEach(e),_o.forEach(e),n=0;n<Xr.length;n++)r=Xr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Xr.length&&(n=Xr[0],n.blockedOn===null);)z3(n),n.blockedOn===null&&Xr.shift()}var qi=kr.ReactCurrentBatchConfig,Zc=!0;function OC(t,e,n,r){var a=De,i=qi.transition;qi.transition=null;try{De=1,G2(t,e,n,r)}finally{De=a,qi.transition=i}}function MC(t,e,n,r){var a=De,i=qi.transition;qi.transition=null;try{De=4,G2(t,e,n,r)}finally{De=a,qi.transition=i}}function G2(t,e,n,r){if(Zc){var a=c1(t,e,n,r);if(a===null)rf(t,e,r,Qc,n),fp(t,r);else if(EC(a,t,e,n,r))r.stopPropagation();else if(fp(t,r),e&4&&-1<wC.indexOf(t)){for(;a!==null;){var i=i0(a);if(i!==null&&G3(i),i=c1(t,e,n,r),i===null&&rf(t,e,r,Qc,n),i===a)break;a=i}a!==null&&r.stopPropagation()}else rf(t,e,r,null,n)}}var Qc=null;function c1(t,e,n,r){if(Qc=null,t=k2(r),t=Ba(t),t!==null)if(e=pi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=_3(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Qc=t,null}function $3(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dC()){case U2:return 1;case k3:return 4;case Xc:case hC:return 16;case U3:return 536870912;default:return 16}default:return 16}}var Jr=null,B2=null,mc=null;function j3(){if(mc)return mc;var t,e=B2,n=e.length,r,a="value"in Jr?Jr.value:Jr.textContent,i=a.length;for(t=0;t<n&&e[t]===a[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===a[i-r];r++);return mc=a.slice(t,1<r?1-r:void 0)}function vc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function I0(){return!0}function pp(){return!1}function mn(t){function e(n,r,a,i,s){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?I0:pp,this.isPropagationStopped=pp,this}return He(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=I0)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=I0)},persist:function(){},isPersistent:I0}),e}var Cs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},A2=mn(Cs),a0=He({},Cs,{view:0,detail:0}),DC=mn(a0),qu,Xu,Fs,Jl=He({},a0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:W2,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Fs&&(Fs&&t.type==="mousemove"?(qu=t.screenX-Fs.screenX,Xu=t.screenY-Fs.screenY):Xu=qu=0,Fs=t),qu)},movementY:function(t){return"movementY"in t?t.movementY:Xu}}),dp=mn(Jl),VC=He({},Jl,{dataTransfer:0}),LC=mn(VC),_C=He({},a0,{relatedTarget:0}),Yu=mn(_C),NC=He({},Cs,{animationName:0,elapsedTime:0,pseudoElement:0}),IC=mn(NC),FC=He({},Cs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),kC=mn(FC),UC=He({},Cs,{data:0}),hp=mn(UC),PC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},GC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function BC(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=GC[t])?!!e[t]:!1}function W2(){return BC}var AC=He({},a0,{key:function(t){if(t.key){var e=PC[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=vc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?bC[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:W2,charCode:function(t){return t.type==="keypress"?vc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?vc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),WC=mn(AC),zC=He({},Jl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mp=mn(zC),$C=He({},a0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:W2}),jC=mn($C),HC=He({},Cs,{propertyName:0,elapsedTime:0,pseudoElement:0}),KC=mn(HC),qC=He({},Jl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),XC=mn(qC),YC=[9,13,27,32],z2=Mr&&"CompositionEvent"in window,oo=null;Mr&&"documentMode"in document&&(oo=document.documentMode);var ZC=Mr&&"TextEvent"in window&&!oo,H3=Mr&&(!z2||oo&&8<oo&&11>=oo),vp=" ",yp=!1;function K3(t,e){switch(t){case"keyup":return YC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function q3(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Li=!1;function QC(t,e){switch(t){case"compositionend":return q3(e);case"keypress":return e.which!==32?null:(yp=!0,vp);case"textInput":return t=e.data,t===vp&&yp?null:t;default:return null}}function JC(t,e){if(Li)return t==="compositionend"||!z2&&K3(t,e)?(t=j3(),mc=B2=Jr=null,Li=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return H3&&e.locale!=="ko"?null:e.data;default:return null}}var eT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!eT[t.type]:e==="textarea"}function X3(t,e,n,r){O3(r),e=Jc(e,"onChange"),0<e.length&&(n=new A2("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var co=null,Io=null;function tT(t){s4(t,0)}function eu(t){var e=Ii(t);if(C3(e))return t}function nT(t,e){if(t==="change")return e}var Y3=!1;if(Mr){var Zu;if(Mr){var Qu="oninput"in document;if(!Qu){var Tp=document.createElement("div");Tp.setAttribute("oninput","return;"),Qu=typeof Tp.oninput=="function"}Zu=Qu}else Zu=!1;Y3=Zu&&(!document.documentMode||9<document.documentMode)}function xp(){co&&(co.detachEvent("onpropertychange",Z3),Io=co=null)}function Z3(t){if(t.propertyName==="value"&&eu(Io)){var e=[];X3(e,Io,t,k2(t)),L3(tT,e)}}function rT(t,e,n){t==="focusin"?(xp(),co=e,Io=n,co.attachEvent("onpropertychange",Z3)):t==="focusout"&&xp()}function aT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return eu(Io)}function iT(t,e){if(t==="click")return eu(e)}function sT(t,e){if(t==="input"||t==="change")return eu(e)}function oT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $n=typeof Object.is=="function"?Object.is:oT;function Fo(t,e){if($n(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!$f.call(e,a)||!$n(t[a],e[a]))return!1}return!0}function Sp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wp(t,e){var n=Sp(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Sp(n)}}function Q3(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Q3(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function J3(){for(var t=window,e=Hc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Hc(t.document)}return e}function $2(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function cT(t){var e=J3(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Q3(n.ownerDocument.documentElement,n)){if(r!==null&&$2(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!t.extend&&i>r&&(a=r,r=i,i=a),a=wp(n,i);var s=wp(n,r);a&&s&&(t.rangeCount!==1||t.anchorNode!==a.node||t.anchorOffset!==a.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(a.node,a.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var lT=Mr&&"documentMode"in document&&11>=document.documentMode,_i=null,l1=null,lo=null,u1=!1;function Ep(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;u1||_i==null||_i!==Hc(r)||(r=_i,"selectionStart"in r&&$2(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),lo&&Fo(lo,r)||(lo=r,r=Jc(l1,"onSelect"),0<r.length&&(e=new A2("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=_i)))}function F0(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ni={animationend:F0("Animation","AnimationEnd"),animationiteration:F0("Animation","AnimationIteration"),animationstart:F0("Animation","AnimationStart"),transitionend:F0("Transition","TransitionEnd")},Ju={},e4={};Mr&&(e4=document.createElement("div").style,"AnimationEvent"in window||(delete Ni.animationend.animation,delete Ni.animationiteration.animation,delete Ni.animationstart.animation),"TransitionEvent"in window||delete Ni.transitionend.transition);function tu(t){if(Ju[t])return Ju[t];if(!Ni[t])return t;var e=Ni[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in e4)return Ju[t]=e[n];return t}var t4=tu("animationend"),n4=tu("animationiteration"),r4=tu("animationstart"),a4=tu("transitionend"),i4=new Map,Rp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ma(t,e){i4.set(t,e),gi(e,[t])}for(var ef=0;ef<Rp.length;ef++){var tf=Rp[ef],uT=tf.toLowerCase(),fT=tf[0].toUpperCase()+tf.slice(1);ma(uT,"on"+fT)}ma(t4,"onAnimationEnd");ma(n4,"onAnimationIteration");ma(r4,"onAnimationStart");ma("dblclick","onDoubleClick");ma("focusin","onFocus");ma("focusout","onBlur");ma(a4,"onTransitionEnd");rs("onMouseEnter",["mouseout","mouseover"]);rs("onMouseLeave",["mouseout","mouseover"]);rs("onPointerEnter",["pointerout","pointerover"]);rs("onPointerLeave",["pointerout","pointerover"]);gi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));gi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));gi("onBeforeInput",["compositionend","keypress","textInput","paste"]);gi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));gi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));gi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xs));function Op(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,uC(r,e,void 0,t),t.currentTarget=null}function s4(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],a=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var s=r.length-1;0<=s;s--){var o=r[s],c=o.instance,l=o.currentTarget;if(o=o.listener,c!==i&&a.isPropagationStopped())break e;Op(a,o,l),i=c}else for(s=0;s<r.length;s++){if(o=r[s],c=o.instance,l=o.currentTarget,o=o.listener,c!==i&&a.isPropagationStopped())break e;Op(a,o,l),i=c}}}if(qc)throw t=i1,qc=!1,i1=null,t}function be(t,e){var n=e[h1];n===void 0&&(n=e[h1]=new Set);var r=t+"__bubble";n.has(r)||(o4(e,t,2,!1),n.add(r))}function nf(t,e,n){var r=0;e&&(r|=4),o4(n,t,r,e)}var k0="_reactListening"+Math.random().toString(36).slice(2);function ko(t){if(!t[k0]){t[k0]=!0,d3.forEach(function(n){n!=="selectionchange"&&(gT.has(n)||nf(n,!1,t),nf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[k0]||(e[k0]=!0,nf("selectionchange",!1,e))}}function o4(t,e,n,r){switch($3(e)){case 1:var a=OC;break;case 4:a=MC;break;default:a=G2}n=a.bind(null,e,n,t),a=void 0,!a1||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),r?a!==void 0?t.addEventListener(e,n,{capture:!0,passive:a}):t.addEventListener(e,n,!0):a!==void 0?t.addEventListener(e,n,{passive:a}):t.addEventListener(e,n,!1)}function rf(t,e,n,r,a){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var o=r.stateNode.containerInfo;if(o===a||o.nodeType===8&&o.parentNode===a)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;s=s.return}for(;o!==null;){if(s=Ba(o),s===null)return;if(c=s.tag,c===5||c===6){r=i=s;continue e}o=o.parentNode}}r=r.return}L3(function(){var l=i,f=k2(n),u=[];e:{var g=i4.get(t);if(g!==void 0){var p=A2,h=t;switch(t){case"keypress":if(vc(n)===0)break e;case"keydown":case"keyup":p=WC;break;case"focusin":h="focus",p=Yu;break;case"focusout":h="blur",p=Yu;break;case"beforeblur":case"afterblur":p=Yu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=dp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=LC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=jC;break;case t4:case n4:case r4:p=IC;break;case a4:p=KC;break;case"scroll":p=DC;break;case"wheel":p=XC;break;case"copy":case"cut":case"paste":p=kC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=mp}var d=(e&4)!==0,m=!d&&t==="scroll",v=d?g!==null?g+"Capture":null:g;d=[];for(var C=l,y;C!==null;){y=C;var T=y.stateNode;if(y.tag===5&&T!==null&&(y=T,v!==null&&(T=Vo(C,v),T!=null&&d.push(Uo(C,T,y)))),m)break;C=C.return}0<d.length&&(g=new p(g,h,null,n,f),u.push({event:g,listeners:d}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",g&&n!==n1&&(h=n.relatedTarget||n.fromElement)&&(Ba(h)||h[Dr]))break e;if((p||g)&&(g=f.window===f?f:(g=f.ownerDocument)?g.defaultView||g.parentWindow:window,p?(h=n.relatedTarget||n.toElement,p=l,h=h?Ba(h):null,h!==null&&(m=pi(h),h!==m||h.tag!==5&&h.tag!==6)&&(h=null)):(p=null,h=l),p!==h)){if(d=dp,T="onMouseLeave",v="onMouseEnter",C="mouse",(t==="pointerout"||t==="pointerover")&&(d=mp,T="onPointerLeave",v="onPointerEnter",C="pointer"),m=p==null?g:Ii(p),y=h==null?g:Ii(h),g=new d(T,C+"leave",p,n,f),g.target=m,g.relatedTarget=y,T=null,Ba(f)===l&&(d=new d(v,C+"enter",h,n,f),d.target=y,d.relatedTarget=m,T=d),m=T,p&&h)t:{for(d=p,v=h,C=0,y=d;y;y=mi(y))C++;for(y=0,T=v;T;T=mi(T))y++;for(;0<C-y;)d=mi(d),C--;for(;0<y-C;)v=mi(v),y--;for(;C--;){if(d===v||v!==null&&d===v.alternate)break t;d=mi(d),v=mi(v)}d=null}else d=null;p!==null&&Mp(u,g,p,d,!1),h!==null&&m!==null&&Mp(u,m,h,d,!0)}}e:{if(g=l?Ii(l):window,p=g.nodeName&&g.nodeName.toLowerCase(),p==="select"||p==="input"&&g.type==="file")var x=nT;else if(Cp(g))if(Y3)x=sT;else{x=aT;var S=rT}else(p=g.nodeName)&&p.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(x=iT);if(x&&(x=x(t,l))){X3(u,x,n,f);break e}S&&S(t,g,l),t==="focusout"&&(S=g._wrapperState)&&S.controlled&&g.type==="number"&&Zf(g,"number",g.value)}switch(S=l?Ii(l):window,t){case"focusin":(Cp(S)||S.contentEditable==="true")&&(_i=S,l1=l,lo=null);break;case"focusout":lo=l1=_i=null;break;case"mousedown":u1=!0;break;case"contextmenu":case"mouseup":case"dragend":u1=!1,Ep(u,n,f);break;case"selectionchange":if(lT)break;case"keydown":case"keyup":Ep(u,n,f)}var w;if(z2)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Li?K3(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(H3&&n.locale!=="ko"&&(Li||E!=="onCompositionStart"?E==="onCompositionEnd"&&Li&&(w=j3()):(Jr=f,B2="value"in Jr?Jr.value:Jr.textContent,Li=!0)),S=Jc(l,E),0<S.length&&(E=new hp(E,t,null,n,f),u.push({event:E,listeners:S}),w?E.data=w:(w=q3(n),w!==null&&(E.data=w)))),(w=ZC?QC(t,n):JC(t,n))&&(l=Jc(l,"onBeforeInput"),0<l.length&&(f=new hp("onBeforeInput","beforeinput",null,n,f),u.push({event:f,listeners:l}),f.data=w))}s4(u,e)})}function Uo(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Jc(t,e){for(var n=e+"Capture",r=[];t!==null;){var a=t,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Vo(t,n),i!=null&&r.unshift(Uo(t,i,a)),i=Vo(t,e),i!=null&&r.push(Uo(t,i,a))),t=t.return}return r}function mi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Mp(t,e,n,r,a){for(var i=e._reactName,s=[];n!==null&&n!==r;){var o=n,c=o.alternate,l=o.stateNode;if(c!==null&&c===r)break;o.tag===5&&l!==null&&(o=l,a?(c=Vo(n,i),c!=null&&s.unshift(Uo(n,c,o))):a||(c=Vo(n,i),c!=null&&s.push(Uo(n,c,o)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var pT=/\r\n?/g,dT=/\u0000|\uFFFD/g;function Dp(t){return(typeof t=="string"?t:""+t).replace(pT,`
`).replace(dT,"")}function U0(t,e,n){if(e=Dp(e),Dp(t)!==e&&n)throw Error(q(425))}function el(){}var f1=null,g1=null;function p1(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var d1=typeof setTimeout=="function"?setTimeout:void 0,hT=typeof clearTimeout=="function"?clearTimeout:void 0,Vp=typeof Promise=="function"?Promise:void 0,mT=typeof queueMicrotask=="function"?queueMicrotask:typeof Vp<"u"?function(t){return Vp.resolve(null).then(t).catch(vT)}:d1;function vT(t){setTimeout(function(){throw t})}function af(t,e){var n=e,r=0;do{var a=n.nextSibling;if(t.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){t.removeChild(a),No(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);No(e)}function ia(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Lp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ts=Math.random().toString(36).slice(2),tr="__reactFiber$"+Ts,Po="__reactProps$"+Ts,Dr="__reactContainer$"+Ts,h1="__reactEvents$"+Ts,yT="__reactListeners$"+Ts,CT="__reactHandles$"+Ts;function Ba(t){var e=t[tr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Dr]||n[tr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Lp(t);t!==null;){if(n=t[tr])return n;t=Lp(t)}return e}t=n,n=t.parentNode}return null}function i0(t){return t=t[tr]||t[Dr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ii(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(q(33))}function nu(t){return t[Po]||null}var m1=[],Fi=-1;function va(t){return{current:t}}function Ge(t){0>Fi||(t.current=m1[Fi],m1[Fi]=null,Fi--)}function Fe(t,e){Fi++,m1[Fi]=t.current,t.current=e}var ga={},Ut=va(ga),tn=va(!1),ni=ga;function as(t,e){var n=t.type.contextTypes;if(!n)return ga;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in n)a[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function nn(t){return t=t.childContextTypes,t!=null}function tl(){Ge(tn),Ge(Ut)}function _p(t,e,n){if(Ut.current!==ga)throw Error(q(168));Fe(Ut,e),Fe(tn,n)}function c4(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in e))throw Error(q(108,rC(t)||"Unknown",a));return He({},n,r)}function nl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ga,ni=Ut.current,Fe(Ut,t),Fe(tn,tn.current),!0}function Np(t,e,n){var r=t.stateNode;if(!r)throw Error(q(169));n?(t=c4(t,e,ni),r.__reactInternalMemoizedMergedChildContext=t,Ge(tn),Ge(Ut),Fe(Ut,t)):Ge(tn),Fe(tn,n)}var hr=null,ru=!1,sf=!1;function l4(t){hr===null?hr=[t]:hr.push(t)}function TT(t){ru=!0,l4(t)}function ya(){if(!sf&&hr!==null){sf=!0;var t=0,e=De;try{var n=hr;for(De=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}hr=null,ru=!1}catch(a){throw hr!==null&&(hr=hr.slice(t+1)),F3(U2,ya),a}finally{De=e,sf=!1}}return null}var ki=[],Ui=0,rl=null,al=0,Sn=[],wn=0,ri=null,Cr=1,Tr="";function La(t,e){ki[Ui++]=al,ki[Ui++]=rl,rl=t,al=e}function u4(t,e,n){Sn[wn++]=Cr,Sn[wn++]=Tr,Sn[wn++]=ri,ri=t;var r=Cr;t=Tr;var a=32-An(r)-1;r&=~(1<<a),n+=1;var i=32-An(e)+a;if(30<i){var s=a-a%5;i=(r&(1<<s)-1).toString(32),r>>=s,a-=s,Cr=1<<32-An(e)+a|n<<a|r,Tr=i+t}else Cr=1<<i|n<<a|r,Tr=t}function j2(t){t.return!==null&&(La(t,1),u4(t,1,0))}function H2(t){for(;t===rl;)rl=ki[--Ui],ki[Ui]=null,al=ki[--Ui],ki[Ui]=null;for(;t===ri;)ri=Sn[--wn],Sn[wn]=null,Tr=Sn[--wn],Sn[wn]=null,Cr=Sn[--wn],Sn[wn]=null}var gn=null,un=null,Be=!1,Un=null;function f4(t,e){var n=En(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ip(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,gn=t,un=ia(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,gn=t,un=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ri!==null?{id:Cr,overflow:Tr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=En(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,gn=t,un=null,!0):!1;default:return!1}}function v1(t){return(t.mode&1)!==0&&(t.flags&128)===0}function y1(t){if(Be){var e=un;if(e){var n=e;if(!Ip(t,e)){if(v1(t))throw Error(q(418));e=ia(n.nextSibling);var r=gn;e&&Ip(t,e)?f4(r,n):(t.flags=t.flags&-4097|2,Be=!1,gn=t)}}else{if(v1(t))throw Error(q(418));t.flags=t.flags&-4097|2,Be=!1,gn=t}}}function Fp(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;gn=t}function P0(t){if(t!==gn)return!1;if(!Be)return Fp(t),Be=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!p1(t.type,t.memoizedProps)),e&&(e=un)){if(v1(t))throw g4(),Error(q(418));for(;e;)f4(t,e),e=ia(e.nextSibling)}if(Fp(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(q(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){un=ia(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}un=null}}else un=gn?ia(t.stateNode.nextSibling):null;return!0}function g4(){for(var t=un;t;)t=ia(t.nextSibling)}function is(){un=gn=null,Be=!1}function K2(t){Un===null?Un=[t]:Un.push(t)}var xT=kr.ReactCurrentBatchConfig;function ks(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(q(309));var r=n.stateNode}if(!r)throw Error(q(147,t));var a=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(s){var o=a.refs;s===null?delete o[i]:o[i]=s},e._stringRef=i,e)}if(typeof t!="string")throw Error(q(284));if(!n._owner)throw Error(q(290,t))}return t}function b0(t,e){throw t=Object.prototype.toString.call(e),Error(q(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function kp(t){var e=t._init;return e(t._payload)}function p4(t){function e(v,C){if(t){var y=v.deletions;y===null?(v.deletions=[C],v.flags|=16):y.push(C)}}function n(v,C){if(!t)return null;for(;C!==null;)e(v,C),C=C.sibling;return null}function r(v,C){for(v=new Map;C!==null;)C.key!==null?v.set(C.key,C):v.set(C.index,C),C=C.sibling;return v}function a(v,C){return v=la(v,C),v.index=0,v.sibling=null,v}function i(v,C,y){return v.index=y,t?(y=v.alternate,y!==null?(y=y.index,y<C?(v.flags|=2,C):y):(v.flags|=2,C)):(v.flags|=1048576,C)}function s(v){return t&&v.alternate===null&&(v.flags|=2),v}function o(v,C,y,T){return C===null||C.tag!==6?(C=pf(y,v.mode,T),C.return=v,C):(C=a(C,y),C.return=v,C)}function c(v,C,y,T){var x=y.type;return x===Vi?f(v,C,y.props.children,T,y.key):C!==null&&(C.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===jr&&kp(x)===C.type)?(T=a(C,y.props),T.ref=ks(v,C,y),T.return=v,T):(T=Ec(y.type,y.key,y.props,null,v.mode,T),T.ref=ks(v,C,y),T.return=v,T)}function l(v,C,y,T){return C===null||C.tag!==4||C.stateNode.containerInfo!==y.containerInfo||C.stateNode.implementation!==y.implementation?(C=df(y,v.mode,T),C.return=v,C):(C=a(C,y.children||[]),C.return=v,C)}function f(v,C,y,T,x){return C===null||C.tag!==7?(C=Xa(y,v.mode,T,x),C.return=v,C):(C=a(C,y),C.return=v,C)}function u(v,C,y){if(typeof C=="string"&&C!==""||typeof C=="number")return C=pf(""+C,v.mode,y),C.return=v,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case M0:return y=Ec(C.type,C.key,C.props,null,v.mode,y),y.ref=ks(v,null,C),y.return=v,y;case Di:return C=df(C,v.mode,y),C.return=v,C;case jr:var T=C._init;return u(v,T(C._payload),y)}if(Ks(C)||Ls(C))return C=Xa(C,v.mode,y,null),C.return=v,C;b0(v,C)}return null}function g(v,C,y,T){var x=C!==null?C.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return x!==null?null:o(v,C,""+y,T);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case M0:return y.key===x?c(v,C,y,T):null;case Di:return y.key===x?l(v,C,y,T):null;case jr:return x=y._init,g(v,C,x(y._payload),T)}if(Ks(y)||Ls(y))return x!==null?null:f(v,C,y,T,null);b0(v,y)}return null}function p(v,C,y,T,x){if(typeof T=="string"&&T!==""||typeof T=="number")return v=v.get(y)||null,o(C,v,""+T,x);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case M0:return v=v.get(T.key===null?y:T.key)||null,c(C,v,T,x);case Di:return v=v.get(T.key===null?y:T.key)||null,l(C,v,T,x);case jr:var S=T._init;return p(v,C,y,S(T._payload),x)}if(Ks(T)||Ls(T))return v=v.get(y)||null,f(C,v,T,x,null);b0(C,T)}return null}function h(v,C,y,T){for(var x=null,S=null,w=C,E=C=0,L=null;w!==null&&E<y.length;E++){w.index>E?(L=w,w=null):L=w.sibling;var R=g(v,w,y[E],T);if(R===null){w===null&&(w=L);break}t&&w&&R.alternate===null&&e(v,w),C=i(R,C,E),S===null?x=R:S.sibling=R,S=R,w=L}if(E===y.length)return n(v,w),Be&&La(v,E),x;if(w===null){for(;E<y.length;E++)w=u(v,y[E],T),w!==null&&(C=i(w,C,E),S===null?x=w:S.sibling=w,S=w);return Be&&La(v,E),x}for(w=r(v,w);E<y.length;E++)L=p(w,v,E,y[E],T),L!==null&&(t&&L.alternate!==null&&w.delete(L.key===null?E:L.key),C=i(L,C,E),S===null?x=L:S.sibling=L,S=L);return t&&w.forEach(function(D){return e(v,D)}),Be&&La(v,E),x}function d(v,C,y,T){var x=Ls(y);if(typeof x!="function")throw Error(q(150));if(y=x.call(y),y==null)throw Error(q(151));for(var S=x=null,w=C,E=C=0,L=null,R=y.next();w!==null&&!R.done;E++,R=y.next()){w.index>E?(L=w,w=null):L=w.sibling;var D=g(v,w,R.value,T);if(D===null){w===null&&(w=L);break}t&&w&&D.alternate===null&&e(v,w),C=i(D,C,E),S===null?x=D:S.sibling=D,S=D,w=L}if(R.done)return n(v,w),Be&&La(v,E),x;if(w===null){for(;!R.done;E++,R=y.next())R=u(v,R.value,T),R!==null&&(C=i(R,C,E),S===null?x=R:S.sibling=R,S=R);return Be&&La(v,E),x}for(w=r(v,w);!R.done;E++,R=y.next())R=p(w,v,E,R.value,T),R!==null&&(t&&R.alternate!==null&&w.delete(R.key===null?E:R.key),C=i(R,C,E),S===null?x=R:S.sibling=R,S=R);return t&&w.forEach(function(I){return e(v,I)}),Be&&La(v,E),x}function m(v,C,y,T){if(typeof y=="object"&&y!==null&&y.type===Vi&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case M0:e:{for(var x=y.key,S=C;S!==null;){if(S.key===x){if(x=y.type,x===Vi){if(S.tag===7){n(v,S.sibling),C=a(S,y.props.children),C.return=v,v=C;break e}}else if(S.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===jr&&kp(x)===S.type){n(v,S.sibling),C=a(S,y.props),C.ref=ks(v,S,y),C.return=v,v=C;break e}n(v,S);break}else e(v,S);S=S.sibling}y.type===Vi?(C=Xa(y.props.children,v.mode,T,y.key),C.return=v,v=C):(T=Ec(y.type,y.key,y.props,null,v.mode,T),T.ref=ks(v,C,y),T.return=v,v=T)}return s(v);case Di:e:{for(S=y.key;C!==null;){if(C.key===S)if(C.tag===4&&C.stateNode.containerInfo===y.containerInfo&&C.stateNode.implementation===y.implementation){n(v,C.sibling),C=a(C,y.children||[]),C.return=v,v=C;break e}else{n(v,C);break}else e(v,C);C=C.sibling}C=df(y,v.mode,T),C.return=v,v=C}return s(v);case jr:return S=y._init,m(v,C,S(y._payload),T)}if(Ks(y))return h(v,C,y,T);if(Ls(y))return d(v,C,y,T);b0(v,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,C!==null&&C.tag===6?(n(v,C.sibling),C=a(C,y),C.return=v,v=C):(n(v,C),C=pf(y,v.mode,T),C.return=v,v=C),s(v)):n(v,C)}return m}var ss=p4(!0),d4=p4(!1),il=va(null),sl=null,Pi=null,q2=null;function X2(){q2=Pi=sl=null}function Y2(t){var e=il.current;Ge(il),t._currentValue=e}function C1(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Xi(t,e){sl=t,q2=Pi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(en=!0),t.firstContext=null)}function Mn(t){var e=t._currentValue;if(q2!==t)if(t={context:t,memoizedValue:e,next:null},Pi===null){if(sl===null)throw Error(q(308));Pi=t,sl.dependencies={lanes:0,firstContext:t}}else Pi=Pi.next=t;return e}var Aa=null;function Z2(t){Aa===null?Aa=[t]:Aa.push(t)}function h4(t,e,n,r){var a=e.interleaved;return a===null?(n.next=n,Z2(e)):(n.next=a.next,a.next=n),e.interleaved=n,Vr(t,r)}function Vr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Hr=!1;function Q2(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function m4(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function wr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function sa(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Oe&2){var a=r.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),r.pending=e,Vr(t,n)}return a=r.interleaved,a===null?(e.next=e,Z2(r)):(e.next=a.next,a.next=e),r.interleaved=e,Vr(t,n)}function yc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,P2(t,n)}}function Up(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?a=i=s:i=i.next=s,n=n.next}while(n!==null);i===null?a=i=e:i=i.next=e}else a=i=e;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ol(t,e,n,r){var a=t.updateQueue;Hr=!1;var i=a.firstBaseUpdate,s=a.lastBaseUpdate,o=a.shared.pending;if(o!==null){a.shared.pending=null;var c=o,l=c.next;c.next=null,s===null?i=l:s.next=l,s=c;var f=t.alternate;f!==null&&(f=f.updateQueue,o=f.lastBaseUpdate,o!==s&&(o===null?f.firstBaseUpdate=l:o.next=l,f.lastBaseUpdate=c))}if(i!==null){var u=a.baseState;s=0,f=l=c=null,o=i;do{var g=o.lane,p=o.eventTime;if((r&g)===g){f!==null&&(f=f.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var h=t,d=o;switch(g=e,p=n,d.tag){case 1:if(h=d.payload,typeof h=="function"){u=h.call(p,u,g);break e}u=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=d.payload,g=typeof h=="function"?h.call(p,u,g):h,g==null)break e;u=He({},u,g);break e;case 2:Hr=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,g=a.effects,g===null?a.effects=[o]:g.push(o))}else p={eventTime:p,lane:g,tag:o.tag,payload:o.payload,callback:o.callback,next:null},f===null?(l=f=p,c=u):f=f.next=p,s|=g;if(o=o.next,o===null){if(o=a.shared.pending,o===null)break;g=o,o=g.next,g.next=null,a.lastBaseUpdate=g,a.shared.pending=null}}while(!0);if(f===null&&(c=u),a.baseState=c,a.firstBaseUpdate=l,a.lastBaseUpdate=f,e=a.shared.interleaved,e!==null){a=e;do s|=a.lane,a=a.next;while(a!==e)}else i===null&&(a.shared.lanes=0);ii|=s,t.lanes=s,t.memoizedState=u}}function Pp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(q(191,a));a.call(r)}}}var s0={},ir=va(s0),bo=va(s0),Go=va(s0);function Wa(t){if(t===s0)throw Error(q(174));return t}function J2(t,e){switch(Fe(Go,e),Fe(bo,t),Fe(ir,s0),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Jf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Jf(e,t)}Ge(ir),Fe(ir,e)}function os(){Ge(ir),Ge(bo),Ge(Go)}function v4(t){Wa(Go.current);var e=Wa(ir.current),n=Jf(e,t.type);e!==n&&(Fe(bo,t),Fe(ir,n))}function eg(t){bo.current===t&&(Ge(ir),Ge(bo))}var $e=va(0);function cl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var of=[];function tg(){for(var t=0;t<of.length;t++)of[t]._workInProgressVersionPrimary=null;of.length=0}var Cc=kr.ReactCurrentDispatcher,cf=kr.ReactCurrentBatchConfig,ai=0,je=null,pt=null,vt=null,ll=!1,uo=!1,Bo=0,ST=0;function Dt(){throw Error(q(321))}function ng(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!$n(t[n],e[n]))return!1;return!0}function rg(t,e,n,r,a,i){if(ai=i,je=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Cc.current=t===null||t.memoizedState===null?OT:MT,t=n(r,a),uo){i=0;do{if(uo=!1,Bo=0,25<=i)throw Error(q(301));i+=1,vt=pt=null,e.updateQueue=null,Cc.current=DT,t=n(r,a)}while(uo)}if(Cc.current=ul,e=pt!==null&&pt.next!==null,ai=0,vt=pt=je=null,ll=!1,e)throw Error(q(300));return t}function ag(){var t=Bo!==0;return Bo=0,t}function Jn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?je.memoizedState=vt=t:vt=vt.next=t,vt}function Dn(){if(pt===null){var t=je.alternate;t=t!==null?t.memoizedState:null}else t=pt.next;var e=vt===null?je.memoizedState:vt.next;if(e!==null)vt=e,pt=t;else{if(t===null)throw Error(q(310));pt=t,t={memoizedState:pt.memoizedState,baseState:pt.baseState,baseQueue:pt.baseQueue,queue:pt.queue,next:null},vt===null?je.memoizedState=vt=t:vt=vt.next=t}return vt}function Ao(t,e){return typeof e=="function"?e(t):e}function lf(t){var e=Dn(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var r=pt,a=r.baseQueue,i=n.pending;if(i!==null){if(a!==null){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(a!==null){i=a.next,r=r.baseState;var o=s=null,c=null,l=i;do{var f=l.lane;if((ai&f)===f)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var u={lane:f,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(o=c=u,s=r):c=c.next=u,je.lanes|=f,ii|=f}l=l.next}while(l!==null&&l!==i);c===null?s=r:c.next=o,$n(r,e.memoizedState)||(en=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){a=t;do i=a.lane,je.lanes|=i,ii|=i,a=a.next;while(a!==t)}else a===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function uf(t){var e=Dn(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var r=n.dispatch,a=n.pending,i=e.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do i=t(i,s.action),s=s.next;while(s!==a);$n(i,e.memoizedState)||(en=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function y4(){}function C4(t,e){var n=je,r=Dn(),a=e(),i=!$n(r.memoizedState,a);if(i&&(r.memoizedState=a,en=!0),r=r.queue,ig(S4.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||vt!==null&&vt.memoizedState.tag&1){if(n.flags|=2048,Wo(9,x4.bind(null,n,r,a,e),void 0,null),Ct===null)throw Error(q(349));ai&30||T4(n,e,a)}return a}function T4(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=je.updateQueue,e===null?(e={lastEffect:null,stores:null},je.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function x4(t,e,n,r){e.value=n,e.getSnapshot=r,w4(e)&&E4(t)}function S4(t,e,n){return n(function(){w4(e)&&E4(t)})}function w4(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$n(t,n)}catch{return!0}}function E4(t){var e=Vr(t,1);e!==null&&Wn(e,t,1,-1)}function bp(t){var e=Jn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ao,lastRenderedState:t},e.queue=t,t=t.dispatch=RT.bind(null,je,t),[e.memoizedState,t]}function Wo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=je.updateQueue,e===null?(e={lastEffect:null,stores:null},je.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function R4(){return Dn().memoizedState}function Tc(t,e,n,r){var a=Jn();je.flags|=t,a.memoizedState=Wo(1|e,n,void 0,r===void 0?null:r)}function au(t,e,n,r){var a=Dn();r=r===void 0?null:r;var i=void 0;if(pt!==null){var s=pt.memoizedState;if(i=s.destroy,r!==null&&ng(r,s.deps)){a.memoizedState=Wo(e,n,i,r);return}}je.flags|=t,a.memoizedState=Wo(1|e,n,i,r)}function Gp(t,e){return Tc(8390656,8,t,e)}function ig(t,e){return au(2048,8,t,e)}function O4(t,e){return au(4,2,t,e)}function M4(t,e){return au(4,4,t,e)}function D4(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function V4(t,e,n){return n=n!=null?n.concat([t]):null,au(4,4,D4.bind(null,e,t),n)}function sg(){}function L4(t,e){var n=Dn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ng(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function _4(t,e){var n=Dn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ng(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function N4(t,e,n){return ai&21?($n(n,e)||(n=P3(),je.lanes|=n,ii|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,en=!0),t.memoizedState=n)}function wT(t,e){var n=De;De=n!==0&&4>n?n:4,t(!0);var r=cf.transition;cf.transition={};try{t(!1),e()}finally{De=n,cf.transition=r}}function I4(){return Dn().memoizedState}function ET(t,e,n){var r=ca(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},F4(t))k4(e,n);else if(n=h4(t,e,n,r),n!==null){var a=Ht();Wn(n,t,r,a),U4(n,e,r)}}function RT(t,e,n){var r=ca(t),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(F4(t))k4(e,a);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var s=e.lastRenderedState,o=i(s,n);if(a.hasEagerState=!0,a.eagerState=o,$n(o,s)){var c=e.interleaved;c===null?(a.next=a,Z2(e)):(a.next=c.next,c.next=a),e.interleaved=a;return}}catch{}finally{}n=h4(t,e,a,r),n!==null&&(a=Ht(),Wn(n,t,r,a),U4(n,e,r))}}function F4(t){var e=t.alternate;return t===je||e!==null&&e===je}function k4(t,e){uo=ll=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function U4(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,P2(t,n)}}var ul={readContext:Mn,useCallback:Dt,useContext:Dt,useEffect:Dt,useImperativeHandle:Dt,useInsertionEffect:Dt,useLayoutEffect:Dt,useMemo:Dt,useReducer:Dt,useRef:Dt,useState:Dt,useDebugValue:Dt,useDeferredValue:Dt,useTransition:Dt,useMutableSource:Dt,useSyncExternalStore:Dt,useId:Dt,unstable_isNewReconciler:!1},OT={readContext:Mn,useCallback:function(t,e){return Jn().memoizedState=[t,e===void 0?null:e],t},useContext:Mn,useEffect:Gp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Tc(4194308,4,D4.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Tc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Tc(4,2,t,e)},useMemo:function(t,e){var n=Jn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Jn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=ET.bind(null,je,t),[r.memoizedState,t]},useRef:function(t){var e=Jn();return t={current:t},e.memoizedState=t},useState:bp,useDebugValue:sg,useDeferredValue:function(t){return Jn().memoizedState=t},useTransition:function(){var t=bp(!1),e=t[0];return t=wT.bind(null,t[1]),Jn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=je,a=Jn();if(Be){if(n===void 0)throw Error(q(407));n=n()}else{if(n=e(),Ct===null)throw Error(q(349));ai&30||T4(r,e,n)}a.memoizedState=n;var i={value:n,getSnapshot:e};return a.queue=i,Gp(S4.bind(null,r,i,t),[t]),r.flags|=2048,Wo(9,x4.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Jn(),e=Ct.identifierPrefix;if(Be){var n=Tr,r=Cr;n=(r&~(1<<32-An(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Bo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ST++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},MT={readContext:Mn,useCallback:L4,useContext:Mn,useEffect:ig,useImperativeHandle:V4,useInsertionEffect:O4,useLayoutEffect:M4,useMemo:_4,useReducer:lf,useRef:R4,useState:function(){return lf(Ao)},useDebugValue:sg,useDeferredValue:function(t){var e=Dn();return N4(e,pt.memoizedState,t)},useTransition:function(){var t=lf(Ao)[0],e=Dn().memoizedState;return[t,e]},useMutableSource:y4,useSyncExternalStore:C4,useId:I4,unstable_isNewReconciler:!1},DT={readContext:Mn,useCallback:L4,useContext:Mn,useEffect:ig,useImperativeHandle:V4,useInsertionEffect:O4,useLayoutEffect:M4,useMemo:_4,useReducer:uf,useRef:R4,useState:function(){return uf(Ao)},useDebugValue:sg,useDeferredValue:function(t){var e=Dn();return pt===null?e.memoizedState=t:N4(e,pt.memoizedState,t)},useTransition:function(){var t=uf(Ao)[0],e=Dn().memoizedState;return[t,e]},useMutableSource:y4,useSyncExternalStore:C4,useId:I4,unstable_isNewReconciler:!1};function Fn(t,e){if(t&&t.defaultProps){e=He({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function T1(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:He({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var iu={isMounted:function(t){return(t=t._reactInternals)?pi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ht(),a=ca(t),i=wr(r,a);i.payload=e,n!=null&&(i.callback=n),e=sa(t,i,a),e!==null&&(Wn(e,t,a,r),yc(e,t,a))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ht(),a=ca(t),i=wr(r,a);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=sa(t,i,a),e!==null&&(Wn(e,t,a,r),yc(e,t,a))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ht(),r=ca(t),a=wr(n,r);a.tag=2,e!=null&&(a.callback=e),e=sa(t,a,r),e!==null&&(Wn(e,t,r,n),yc(e,t,r))}};function Bp(t,e,n,r,a,i,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,s):e.prototype&&e.prototype.isPureReactComponent?!Fo(n,r)||!Fo(a,i):!0}function P4(t,e,n){var r=!1,a=ga,i=e.contextType;return typeof i=="object"&&i!==null?i=Mn(i):(a=nn(e)?ni:Ut.current,r=e.contextTypes,i=(r=r!=null)?as(t,a):ga),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=iu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=a,t.__reactInternalMemoizedMaskedChildContext=i),e}function Ap(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&iu.enqueueReplaceState(e,e.state,null)}function x1(t,e,n,r){var a=t.stateNode;a.props=n,a.state=t.memoizedState,a.refs={},Q2(t);var i=e.contextType;typeof i=="object"&&i!==null?a.context=Mn(i):(i=nn(e)?ni:Ut.current,a.context=as(t,i)),a.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(T1(t,e,i,n),a.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(e=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),e!==a.state&&iu.enqueueReplaceState(a,a.state,null),ol(t,n,a,r),a.state=t.memoizedState),typeof a.componentDidMount=="function"&&(t.flags|=4194308)}function cs(t,e){try{var n="",r=e;do n+=nC(r),r=r.return;while(r);var a=n}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:a,digest:null}}function ff(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function S1(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var VT=typeof WeakMap=="function"?WeakMap:Map;function b4(t,e,n){n=wr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){gl||(gl=!0,N1=r),S1(t,e)},n}function G4(t,e,n){n=wr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var a=e.value;n.payload=function(){return r(a)},n.callback=function(){S1(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){S1(t,e),typeof r!="function"&&(oa===null?oa=new Set([this]):oa.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function Wp(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new VT;var a=new Set;r.set(e,a)}else a=r.get(e),a===void 0&&(a=new Set,r.set(e,a));a.has(n)||(a.add(n),t=zT.bind(null,t,e,n),e.then(t,t))}function zp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function $p(t,e,n,r,a){return t.mode&1?(t.flags|=65536,t.lanes=a,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=wr(-1,1),e.tag=2,sa(n,e,1))),n.lanes|=1),t)}var LT=kr.ReactCurrentOwner,en=!1;function At(t,e,n,r){e.child=t===null?d4(e,null,n,r):ss(e,t.child,n,r)}function jp(t,e,n,r,a){n=n.render;var i=e.ref;return Xi(e,a),r=rg(t,e,n,r,i,a),n=ag(),t!==null&&!en?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~a,Lr(t,e,a)):(Be&&n&&j2(e),e.flags|=1,At(t,e,r,a),e.child)}function Hp(t,e,n,r,a){if(t===null){var i=n.type;return typeof i=="function"&&!dg(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,B4(t,e,i,r,a)):(t=Ec(n.type,null,r,e,e.mode,a),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&a)){var s=i.memoizedProps;if(n=n.compare,n=n!==null?n:Fo,n(s,r)&&t.ref===e.ref)return Lr(t,e,a)}return e.flags|=1,t=la(i,r),t.ref=e.ref,t.return=e,e.child=t}function B4(t,e,n,r,a){if(t!==null){var i=t.memoizedProps;if(Fo(i,r)&&t.ref===e.ref)if(en=!1,e.pendingProps=r=i,(t.lanes&a)!==0)t.flags&131072&&(en=!0);else return e.lanes=t.lanes,Lr(t,e,a)}return w1(t,e,n,r,a)}function A4(t,e,n){var r=e.pendingProps,a=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fe(Gi,on),on|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Fe(Gi,on),on|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Fe(Gi,on),on|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Fe(Gi,on),on|=r;return At(t,e,a,n),e.child}function W4(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function w1(t,e,n,r,a){var i=nn(n)?ni:Ut.current;return i=as(e,i),Xi(e,a),n=rg(t,e,n,r,i,a),r=ag(),t!==null&&!en?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~a,Lr(t,e,a)):(Be&&r&&j2(e),e.flags|=1,At(t,e,n,a),e.child)}function Kp(t,e,n,r,a){if(nn(n)){var i=!0;nl(e)}else i=!1;if(Xi(e,a),e.stateNode===null)xc(t,e),P4(e,n,r),x1(e,n,r,a),r=!0;else if(t===null){var s=e.stateNode,o=e.memoizedProps;s.props=o;var c=s.context,l=n.contextType;typeof l=="object"&&l!==null?l=Mn(l):(l=nn(n)?ni:Ut.current,l=as(e,l));var f=n.getDerivedStateFromProps,u=typeof f=="function"||typeof s.getSnapshotBeforeUpdate=="function";u||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o!==r||c!==l)&&Ap(e,s,r,l),Hr=!1;var g=e.memoizedState;s.state=g,ol(e,r,s,a),c=e.memoizedState,o!==r||g!==c||tn.current||Hr?(typeof f=="function"&&(T1(e,n,f,r),c=e.memoizedState),(o=Hr||Bp(e,n,o,r,g,c,l))?(u||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),s.props=r,s.state=c,s.context=l,r=o):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,m4(t,e),o=e.memoizedProps,l=e.type===e.elementType?o:Fn(e.type,o),s.props=l,u=e.pendingProps,g=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=Mn(c):(c=nn(n)?ni:Ut.current,c=as(e,c));var p=n.getDerivedStateFromProps;(f=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o!==u||g!==c)&&Ap(e,s,r,c),Hr=!1,g=e.memoizedState,s.state=g,ol(e,r,s,a);var h=e.memoizedState;o!==u||g!==h||tn.current||Hr?(typeof p=="function"&&(T1(e,n,p,r),h=e.memoizedState),(l=Hr||Bp(e,n,l,r,g,h,c)||!1)?(f||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,h,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,h,c)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||o===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=h),s.props=r,s.state=h,s.context=c,r=l):(typeof s.componentDidUpdate!="function"||o===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return E1(t,e,n,r,i,a)}function E1(t,e,n,r,a,i){W4(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return a&&Np(e,n,!1),Lr(t,e,i);r=e.stateNode,LT.current=e;var o=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=ss(e,t.child,null,i),e.child=ss(e,null,o,i)):At(t,e,o,i),e.memoizedState=r.state,a&&Np(e,n,!0),e.child}function z4(t){var e=t.stateNode;e.pendingContext?_p(t,e.pendingContext,e.pendingContext!==e.context):e.context&&_p(t,e.context,!1),J2(t,e.containerInfo)}function qp(t,e,n,r,a){return is(),K2(a),e.flags|=256,At(t,e,n,r),e.child}var R1={dehydrated:null,treeContext:null,retryLane:0};function O1(t){return{baseLanes:t,cachePool:null,transitions:null}}function $4(t,e,n){var r=e.pendingProps,a=$e.current,i=!1,s=(e.flags&128)!==0,o;if((o=s)||(o=t!==null&&t.memoizedState===null?!1:(a&2)!==0),o?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(a|=1),Fe($e,a&1),t===null)return y1(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,i?(r=e.mode,i=e.child,s={mode:"hidden",children:s},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=cu(s,r,0,null),t=Xa(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=O1(n),e.memoizedState=R1,t):og(e,s));if(a=t.memoizedState,a!==null&&(o=a.dehydrated,o!==null))return _T(t,e,s,r,o,a,n);if(i){i=r.fallback,s=e.mode,a=t.child,o=a.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&e.child!==a?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=la(a,c),r.subtreeFlags=a.subtreeFlags&14680064),o!==null?i=la(o,i):(i=Xa(i,s,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,s=t.child.memoizedState,s=s===null?O1(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=t.childLanes&~n,e.memoizedState=R1,r}return i=t.child,t=i.sibling,r=la(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function og(t,e){return e=cu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function G0(t,e,n,r){return r!==null&&K2(r),ss(e,t.child,null,n),t=og(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function _T(t,e,n,r,a,i,s){if(n)return e.flags&256?(e.flags&=-257,r=ff(Error(q(422))),G0(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,a=e.mode,r=cu({mode:"visible",children:r.children},a,0,null),i=Xa(i,a,s,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ss(e,t.child,null,s),e.child.memoizedState=O1(s),e.memoizedState=R1,i);if(!(e.mode&1))return G0(t,e,s,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(q(419)),r=ff(i,r,void 0),G0(t,e,s,r)}if(o=(s&t.childLanes)!==0,en||o){if(r=Ct,r!==null){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|s)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Vr(t,a),Wn(r,t,a,-1))}return pg(),r=ff(Error(q(421))),G0(t,e,s,r)}return a.data==="$?"?(e.flags|=128,e.child=t.child,e=$T.bind(null,t),a._reactRetry=e,null):(t=i.treeContext,un=ia(a.nextSibling),gn=e,Be=!0,Un=null,t!==null&&(Sn[wn++]=Cr,Sn[wn++]=Tr,Sn[wn++]=ri,Cr=t.id,Tr=t.overflow,ri=e),e=og(e,r.children),e.flags|=4096,e)}function Xp(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),C1(t.return,e,n)}function gf(t,e,n,r,a){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function j4(t,e,n){var r=e.pendingProps,a=r.revealOrder,i=r.tail;if(At(t,e,r.children,n),r=$e.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Xp(t,n,e);else if(t.tag===19)Xp(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Fe($e,r),!(e.mode&1))e.memoizedState=null;else switch(a){case"forwards":for(n=e.child,a=null;n!==null;)t=n.alternate,t!==null&&cl(t)===null&&(a=n),n=n.sibling;n=a,n===null?(a=e.child,e.child=null):(a=n.sibling,n.sibling=null),gf(e,!1,a,n,i);break;case"backwards":for(n=null,a=e.child,e.child=null;a!==null;){if(t=a.alternate,t!==null&&cl(t)===null){e.child=a;break}t=a.sibling,a.sibling=n,n=a,a=t}gf(e,!0,n,null,i);break;case"together":gf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function xc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Lr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ii|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(q(153));if(e.child!==null){for(t=e.child,n=la(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=la(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function NT(t,e,n){switch(e.tag){case 3:z4(e),is();break;case 5:v4(e);break;case 1:nn(e.type)&&nl(e);break;case 4:J2(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,a=e.memoizedProps.value;Fe(il,r._currentValue),r._currentValue=a;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Fe($e,$e.current&1),e.flags|=128,null):n&e.child.childLanes?$4(t,e,n):(Fe($e,$e.current&1),t=Lr(t,e,n),t!==null?t.sibling:null);Fe($e,$e.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return j4(t,e,n);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Fe($e,$e.current),r)break;return null;case 22:case 23:return e.lanes=0,A4(t,e,n)}return Lr(t,e,n)}var H4,M1,K4,q4;H4=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};M1=function(){};K4=function(t,e,n,r){var a=t.memoizedProps;if(a!==r){t=e.stateNode,Wa(ir.current);var i=null;switch(n){case"input":a=Xf(t,a),r=Xf(t,r),i=[];break;case"select":a=He({},a,{value:void 0}),r=He({},r,{value:void 0}),i=[];break;case"textarea":a=Qf(t,a),r=Qf(t,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=el)}e1(n,r);var s;n=null;for(l in a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&a[l]!=null)if(l==="style"){var o=a[l];for(s in o)o.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Mo.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in r){var c=r[l];if(o=a!=null?a[l]:void 0,r.hasOwnProperty(l)&&c!==o&&(c!=null||o!=null))if(l==="style")if(o){for(s in o)!o.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&o[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(i||(i=[]),i.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Mo.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&be("scroll",t),i||o===c||(i=[])):(i=i||[]).push(l,c))}n&&(i=i||[]).push("style",n);var l=i;(e.updateQueue=l)&&(e.flags|=4)}};q4=function(t,e,n,r){n!==r&&(e.flags|=4)};function Us(t,e){if(!Be)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Vt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var a=t.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=t,a=a.sibling;else for(a=t.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=t,a=a.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function IT(t,e,n){var r=e.pendingProps;switch(H2(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(e),null;case 1:return nn(e.type)&&tl(),Vt(e),null;case 3:return r=e.stateNode,os(),Ge(tn),Ge(Ut),tg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(P0(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Un!==null&&(k1(Un),Un=null))),M1(t,e),Vt(e),null;case 5:eg(e);var a=Wa(Go.current);if(n=e.type,t!==null&&e.stateNode!=null)K4(t,e,n,r,a),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(q(166));return Vt(e),null}if(t=Wa(ir.current),P0(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[tr]=e,r[Po]=i,t=(e.mode&1)!==0,n){case"dialog":be("cancel",r),be("close",r);break;case"iframe":case"object":case"embed":be("load",r);break;case"video":case"audio":for(a=0;a<Xs.length;a++)be(Xs[a],r);break;case"source":be("error",r);break;case"img":case"image":case"link":be("error",r),be("load",r);break;case"details":be("toggle",r);break;case"input":ap(r,i),be("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},be("invalid",r);break;case"textarea":sp(r,i),be("invalid",r)}e1(n,i),a=null;for(var s in i)if(i.hasOwnProperty(s)){var o=i[s];s==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&U0(r.textContent,o,t),a=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&U0(r.textContent,o,t),a=["children",""+o]):Mo.hasOwnProperty(s)&&o!=null&&s==="onScroll"&&be("scroll",r)}switch(n){case"input":D0(r),ip(r,i,!0);break;case"textarea":D0(r),op(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=el)}r=a,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=a.nodeType===9?a:a.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=S3(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[tr]=e,t[Po]=r,H4(t,e,!1,!1),e.stateNode=t;e:{switch(s=t1(n,r),n){case"dialog":be("cancel",t),be("close",t),a=r;break;case"iframe":case"object":case"embed":be("load",t),a=r;break;case"video":case"audio":for(a=0;a<Xs.length;a++)be(Xs[a],t);a=r;break;case"source":be("error",t),a=r;break;case"img":case"image":case"link":be("error",t),be("load",t),a=r;break;case"details":be("toggle",t),a=r;break;case"input":ap(t,r),a=Xf(t,r),be("invalid",t);break;case"option":a=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},a=He({},r,{value:void 0}),be("invalid",t);break;case"textarea":sp(t,r),a=Qf(t,r),be("invalid",t);break;default:a=r}e1(n,a),o=a;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?R3(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&w3(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Do(t,c):typeof c=="number"&&Do(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Mo.hasOwnProperty(i)?c!=null&&i==="onScroll"&&be("scroll",t):c!=null&&_2(t,i,c,s))}switch(n){case"input":D0(t),ip(t,r,!1);break;case"textarea":D0(t),op(t);break;case"option":r.value!=null&&t.setAttribute("value",""+fa(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ji(t,!!r.multiple,i,!1):r.defaultValue!=null&&ji(t,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(t.onclick=el)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Vt(e),null;case 6:if(t&&e.stateNode!=null)q4(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(q(166));if(n=Wa(Go.current),Wa(ir.current),P0(e)){if(r=e.stateNode,n=e.memoizedProps,r[tr]=e,(i=r.nodeValue!==n)&&(t=gn,t!==null))switch(t.tag){case 3:U0(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&U0(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[tr]=e,e.stateNode=r}return Vt(e),null;case 13:if(Ge($e),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Be&&un!==null&&e.mode&1&&!(e.flags&128))g4(),is(),e.flags|=98560,i=!1;else if(i=P0(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(q(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(q(317));i[tr]=e}else is(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Vt(e),i=!1}else Un!==null&&(k1(Un),Un=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||$e.current&1?ht===0&&(ht=3):pg())),e.updateQueue!==null&&(e.flags|=4),Vt(e),null);case 4:return os(),M1(t,e),t===null&&ko(e.stateNode.containerInfo),Vt(e),null;case 10:return Y2(e.type._context),Vt(e),null;case 17:return nn(e.type)&&tl(),Vt(e),null;case 19:if(Ge($e),i=e.memoizedState,i===null)return Vt(e),null;if(r=(e.flags&128)!==0,s=i.rendering,s===null)if(r)Us(i,!1);else{if(ht!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=cl(t),s!==null){for(e.flags|=128,Us(i,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,t=s.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Fe($e,$e.current&1|2),e.child}t=t.sibling}i.tail!==null&&it()>ls&&(e.flags|=128,r=!0,Us(i,!1),e.lanes=4194304)}else{if(!r)if(t=cl(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Us(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Be)return Vt(e),null}else 2*it()-i.renderingStartTime>ls&&n!==1073741824&&(e.flags|=128,r=!0,Us(i,!1),e.lanes=4194304);i.isBackwards?(s.sibling=e.child,e.child=s):(n=i.last,n!==null?n.sibling=s:e.child=s,i.last=s)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=it(),e.sibling=null,n=$e.current,Fe($e,r?n&1|2:n&1),e):(Vt(e),null);case 22:case 23:return gg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?on&1073741824&&(Vt(e),e.subtreeFlags&6&&(e.flags|=8192)):Vt(e),null;case 24:return null;case 25:return null}throw Error(q(156,e.tag))}function FT(t,e){switch(H2(e),e.tag){case 1:return nn(e.type)&&tl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return os(),Ge(tn),Ge(Ut),tg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return eg(e),null;case 13:if(Ge($e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(q(340));is()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ge($e),null;case 4:return os(),null;case 10:return Y2(e.type._context),null;case 22:case 23:return gg(),null;case 24:return null;default:return null}}var B0=!1,It=!1,kT=typeof WeakSet=="function"?WeakSet:Set,Y=null;function bi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){qe(t,e,r)}else n.current=null}function D1(t,e,n){try{n()}catch(r){qe(t,e,r)}}var Yp=!1;function UT(t,e){if(f1=Zc,t=J3(),$2(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var s=0,o=-1,c=-1,l=0,f=0,u=t,g=null;t:for(;;){for(var p;u!==n||a!==0&&u.nodeType!==3||(o=s+a),u!==i||r!==0&&u.nodeType!==3||(c=s+r),u.nodeType===3&&(s+=u.nodeValue.length),(p=u.firstChild)!==null;)g=u,u=p;for(;;){if(u===t)break t;if(g===n&&++l===a&&(o=s),g===i&&++f===r&&(c=s),(p=u.nextSibling)!==null)break;u=g,g=u.parentNode}u=p}n=o===-1||c===-1?null:{start:o,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(g1={focusedElem:t,selectionRange:n},Zc=!1,Y=e;Y!==null;)if(e=Y,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Y=t;else for(;Y!==null;){e=Y;try{var h=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var d=h.memoizedProps,m=h.memoizedState,v=e.stateNode,C=v.getSnapshotBeforeUpdate(e.elementType===e.type?d:Fn(e.type,d),m);v.__reactInternalSnapshotBeforeUpdate=C}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(T){qe(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,Y=t;break}Y=e.return}return h=Yp,Yp=!1,h}function fo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&t)===t){var i=a.destroy;a.destroy=void 0,i!==void 0&&D1(e,n,i)}a=a.next}while(a!==r)}}function su(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function V1(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function X4(t){var e=t.alternate;e!==null&&(t.alternate=null,X4(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[tr],delete e[Po],delete e[h1],delete e[yT],delete e[CT])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Y4(t){return t.tag===5||t.tag===3||t.tag===4}function Zp(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Y4(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function L1(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=el));else if(r!==4&&(t=t.child,t!==null))for(L1(t,e,n),t=t.sibling;t!==null;)L1(t,e,n),t=t.sibling}function _1(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(_1(t,e,n),t=t.sibling;t!==null;)_1(t,e,n),t=t.sibling}var Et=null,kn=!1;function Pr(t,e,n){for(n=n.child;n!==null;)Z4(t,e,n),n=n.sibling}function Z4(t,e,n){if(ar&&typeof ar.onCommitFiberUnmount=="function")try{ar.onCommitFiberUnmount(Ql,n)}catch{}switch(n.tag){case 5:It||bi(n,e);case 6:var r=Et,a=kn;Et=null,Pr(t,e,n),Et=r,kn=a,Et!==null&&(kn?(t=Et,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Et.removeChild(n.stateNode));break;case 18:Et!==null&&(kn?(t=Et,n=n.stateNode,t.nodeType===8?af(t.parentNode,n):t.nodeType===1&&af(t,n),No(t)):af(Et,n.stateNode));break;case 4:r=Et,a=kn,Et=n.stateNode.containerInfo,kn=!0,Pr(t,e,n),Et=r,kn=a;break;case 0:case 11:case 14:case 15:if(!It&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&D1(n,e,s),a=a.next}while(a!==r)}Pr(t,e,n);break;case 1:if(!It&&(bi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){qe(n,e,o)}Pr(t,e,n);break;case 21:Pr(t,e,n);break;case 22:n.mode&1?(It=(r=It)||n.memoizedState!==null,Pr(t,e,n),It=r):Pr(t,e,n);break;default:Pr(t,e,n)}}function Qp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new kT),e.forEach(function(r){var a=jT.bind(null,t,r);n.has(r)||(n.add(r),r.then(a,a))})}}function Vn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var i=t,s=e,o=s;e:for(;o!==null;){switch(o.tag){case 5:Et=o.stateNode,kn=!1;break e;case 3:Et=o.stateNode.containerInfo,kn=!0;break e;case 4:Et=o.stateNode.containerInfo,kn=!0;break e}o=o.return}if(Et===null)throw Error(q(160));Z4(i,s,a),Et=null,kn=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(l){qe(a,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Q4(e,t),e=e.sibling}function Q4(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Vn(e,t),Xn(t),r&4){try{fo(3,t,t.return),su(3,t)}catch(d){qe(t,t.return,d)}try{fo(5,t,t.return)}catch(d){qe(t,t.return,d)}}break;case 1:Vn(e,t),Xn(t),r&512&&n!==null&&bi(n,n.return);break;case 5:if(Vn(e,t),Xn(t),r&512&&n!==null&&bi(n,n.return),t.flags&32){var a=t.stateNode;try{Do(a,"")}catch(d){qe(t,t.return,d)}}if(r&4&&(a=t.stateNode,a!=null)){var i=t.memoizedProps,s=n!==null?n.memoizedProps:i,o=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&T3(a,i),t1(o,s);var l=t1(o,i);for(s=0;s<c.length;s+=2){var f=c[s],u=c[s+1];f==="style"?R3(a,u):f==="dangerouslySetInnerHTML"?w3(a,u):f==="children"?Do(a,u):_2(a,f,u,l)}switch(o){case"input":Yf(a,i);break;case"textarea":x3(a,i);break;case"select":var g=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?ji(a,!!i.multiple,p,!1):g!==!!i.multiple&&(i.defaultValue!=null?ji(a,!!i.multiple,i.defaultValue,!0):ji(a,!!i.multiple,i.multiple?[]:"",!1))}a[Po]=i}catch(d){qe(t,t.return,d)}}break;case 6:if(Vn(e,t),Xn(t),r&4){if(t.stateNode===null)throw Error(q(162));a=t.stateNode,i=t.memoizedProps;try{a.nodeValue=i}catch(d){qe(t,t.return,d)}}break;case 3:if(Vn(e,t),Xn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{No(e.containerInfo)}catch(d){qe(t,t.return,d)}break;case 4:Vn(e,t),Xn(t);break;case 13:Vn(e,t),Xn(t),a=t.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(ug=it())),r&4&&Qp(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(It=(l=It)||f,Vn(e,t),It=l):Vn(e,t),Xn(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!f&&t.mode&1)for(Y=t,f=t.child;f!==null;){for(u=Y=f;Y!==null;){switch(g=Y,p=g.child,g.tag){case 0:case 11:case 14:case 15:fo(4,g,g.return);break;case 1:bi(g,g.return);var h=g.stateNode;if(typeof h.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,h.props=e.memoizedProps,h.state=e.memoizedState,h.componentWillUnmount()}catch(d){qe(r,n,d)}}break;case 5:bi(g,g.return);break;case 22:if(g.memoizedState!==null){ed(u);continue}}p!==null?(p.return=g,Y=p):ed(u)}f=f.sibling}e:for(f=null,u=t;;){if(u.tag===5){if(f===null){f=u;try{a=u.stateNode,l?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=u.stateNode,c=u.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=E3("display",s))}catch(d){qe(t,t.return,d)}}}else if(u.tag===6){if(f===null)try{u.stateNode.nodeValue=l?"":u.memoizedProps}catch(d){qe(t,t.return,d)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;f===u&&(f=null),u=u.return}f===u&&(f=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Vn(e,t),Xn(t),r&4&&Qp(t);break;case 21:break;default:Vn(e,t),Xn(t)}}function Xn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Y4(n)){var r=n;break e}n=n.return}throw Error(q(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Do(a,""),r.flags&=-33);var i=Zp(t);_1(t,i,a);break;case 3:case 4:var s=r.stateNode.containerInfo,o=Zp(t);L1(t,o,s);break;default:throw Error(q(161))}}catch(c){qe(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function PT(t,e,n){Y=t,J4(t)}function J4(t,e,n){for(var r=(t.mode&1)!==0;Y!==null;){var a=Y,i=a.child;if(a.tag===22&&r){var s=a.memoizedState!==null||B0;if(!s){var o=a.alternate,c=o!==null&&o.memoizedState!==null||It;o=B0;var l=It;if(B0=s,(It=c)&&!l)for(Y=a;Y!==null;)s=Y,c=s.child,s.tag===22&&s.memoizedState!==null?td(a):c!==null?(c.return=s,Y=c):td(a);for(;i!==null;)Y=i,J4(i),i=i.sibling;Y=a,B0=o,It=l}Jp(t)}else a.subtreeFlags&8772&&i!==null?(i.return=a,Y=i):Jp(t)}}function Jp(t){for(;Y!==null;){var e=Y;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:It||su(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!It)if(n===null)r.componentDidMount();else{var a=e.elementType===e.type?n.memoizedProps:Fn(e.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Pp(e,i,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Pp(e,s,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var f=l.memoizedState;if(f!==null){var u=f.dehydrated;u!==null&&No(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}It||e.flags&512&&V1(e)}catch(g){qe(e,e.return,g)}}if(e===t){Y=null;break}if(n=e.sibling,n!==null){n.return=e.return,Y=n;break}Y=e.return}}function ed(t){for(;Y!==null;){var e=Y;if(e===t){Y=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Y=n;break}Y=e.return}}function td(t){for(;Y!==null;){var e=Y;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{su(4,e)}catch(c){qe(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var a=e.return;try{r.componentDidMount()}catch(c){qe(e,a,c)}}var i=e.return;try{V1(e)}catch(c){qe(e,i,c)}break;case 5:var s=e.return;try{V1(e)}catch(c){qe(e,s,c)}}}catch(c){qe(e,e.return,c)}if(e===t){Y=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Y=o;break}Y=e.return}}var bT=Math.ceil,fl=kr.ReactCurrentDispatcher,cg=kr.ReactCurrentOwner,Rn=kr.ReactCurrentBatchConfig,Oe=0,Ct=null,ct=null,Rt=0,on=0,Gi=va(0),ht=0,zo=null,ii=0,ou=0,lg=0,go=null,Qt=null,ug=0,ls=1/0,pr=null,gl=!1,N1=null,oa=null,A0=!1,ea=null,pl=0,po=0,I1=null,Sc=-1,wc=0;function Ht(){return Oe&6?it():Sc!==-1?Sc:Sc=it()}function ca(t){return t.mode&1?Oe&2&&Rt!==0?Rt&-Rt:xT.transition!==null?(wc===0&&(wc=P3()),wc):(t=De,t!==0||(t=window.event,t=t===void 0?16:$3(t.type)),t):1}function Wn(t,e,n,r){if(50<po)throw po=0,I1=null,Error(q(185));r0(t,n,r),(!(Oe&2)||t!==Ct)&&(t===Ct&&(!(Oe&2)&&(ou|=n),ht===4&&Yr(t,Rt)),rn(t,r),n===1&&Oe===0&&!(e.mode&1)&&(ls=it()+500,ru&&ya()))}function rn(t,e){var n=t.callbackNode;xC(t,e);var r=Yc(t,t===Ct?Rt:0);if(r===0)n!==null&&up(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&up(n),e===1)t.tag===0?TT(nd.bind(null,t)):l4(nd.bind(null,t)),mT(function(){!(Oe&6)&&ya()}),n=null;else{switch(b3(r)){case 1:n=U2;break;case 4:n=k3;break;case 16:n=Xc;break;case 536870912:n=U3;break;default:n=Xc}n=o8(n,e8.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function e8(t,e){if(Sc=-1,wc=0,Oe&6)throw Error(q(327));var n=t.callbackNode;if(Yi()&&t.callbackNode!==n)return null;var r=Yc(t,t===Ct?Rt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=dl(t,r);else{e=r;var a=Oe;Oe|=2;var i=n8();(Ct!==t||Rt!==e)&&(pr=null,ls=it()+500,qa(t,e));do try{AT();break}catch(o){t8(t,o)}while(!0);X2(),fl.current=i,Oe=a,ct!==null?e=0:(Ct=null,Rt=0,e=ht)}if(e!==0){if(e===2&&(a=s1(t),a!==0&&(r=a,e=F1(t,a))),e===1)throw n=zo,qa(t,0),Yr(t,r),rn(t,it()),n;if(e===6)Yr(t,r);else{if(a=t.current.alternate,!(r&30)&&!GT(a)&&(e=dl(t,r),e===2&&(i=s1(t),i!==0&&(r=i,e=F1(t,i))),e===1))throw n=zo,qa(t,0),Yr(t,r),rn(t,it()),n;switch(t.finishedWork=a,t.finishedLanes=r,e){case 0:case 1:throw Error(q(345));case 2:_a(t,Qt,pr);break;case 3:if(Yr(t,r),(r&130023424)===r&&(e=ug+500-it(),10<e)){if(Yc(t,0)!==0)break;if(a=t.suspendedLanes,(a&r)!==r){Ht(),t.pingedLanes|=t.suspendedLanes&a;break}t.timeoutHandle=d1(_a.bind(null,t,Qt,pr),e);break}_a(t,Qt,pr);break;case 4:if(Yr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,a=-1;0<r;){var s=31-An(r);i=1<<s,s=e[s],s>a&&(a=s),r&=~i}if(r=a,r=it()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*bT(r/1960))-r,10<r){t.timeoutHandle=d1(_a.bind(null,t,Qt,pr),r);break}_a(t,Qt,pr);break;case 5:_a(t,Qt,pr);break;default:throw Error(q(329))}}}return rn(t,it()),t.callbackNode===n?e8.bind(null,t):null}function F1(t,e){var n=go;return t.current.memoizedState.isDehydrated&&(qa(t,e).flags|=256),t=dl(t,e),t!==2&&(e=Qt,Qt=n,e!==null&&k1(e)),t}function k1(t){Qt===null?Qt=t:Qt.push.apply(Qt,t)}function GT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!$n(i(),a))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Yr(t,e){for(e&=~lg,e&=~ou,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-An(e),r=1<<n;t[n]=-1,e&=~r}}function nd(t){if(Oe&6)throw Error(q(327));Yi();var e=Yc(t,0);if(!(e&1))return rn(t,it()),null;var n=dl(t,e);if(t.tag!==0&&n===2){var r=s1(t);r!==0&&(e=r,n=F1(t,r))}if(n===1)throw n=zo,qa(t,0),Yr(t,e),rn(t,it()),n;if(n===6)throw Error(q(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,_a(t,Qt,pr),rn(t,it()),null}function fg(t,e){var n=Oe;Oe|=1;try{return t(e)}finally{Oe=n,Oe===0&&(ls=it()+500,ru&&ya())}}function si(t){ea!==null&&ea.tag===0&&!(Oe&6)&&Yi();var e=Oe;Oe|=1;var n=Rn.transition,r=De;try{if(Rn.transition=null,De=1,t)return t()}finally{De=r,Rn.transition=n,Oe=e,!(Oe&6)&&ya()}}function gg(){on=Gi.current,Ge(Gi)}function qa(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hT(n)),ct!==null)for(n=ct.return;n!==null;){var r=n;switch(H2(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&tl();break;case 3:os(),Ge(tn),Ge(Ut),tg();break;case 5:eg(r);break;case 4:os();break;case 13:Ge($e);break;case 19:Ge($e);break;case 10:Y2(r.type._context);break;case 22:case 23:gg()}n=n.return}if(Ct=t,ct=t=la(t.current,null),Rt=on=e,ht=0,zo=null,lg=ou=ii=0,Qt=go=null,Aa!==null){for(e=0;e<Aa.length;e++)if(n=Aa[e],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,i=n.pending;if(i!==null){var s=i.next;i.next=a,r.next=s}n.pending=r}Aa=null}return t}function t8(t,e){do{var n=ct;try{if(X2(),Cc.current=ul,ll){for(var r=je.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}ll=!1}if(ai=0,vt=pt=je=null,uo=!1,Bo=0,cg.current=null,n===null||n.return===null){ht=1,zo=e,ct=null;break}e:{var i=t,s=n.return,o=n,c=e;if(e=Rt,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,f=o,u=f.tag;if(!(f.mode&1)&&(u===0||u===11||u===15)){var g=f.alternate;g?(f.updateQueue=g.updateQueue,f.memoizedState=g.memoizedState,f.lanes=g.lanes):(f.updateQueue=null,f.memoizedState=null)}var p=zp(s);if(p!==null){p.flags&=-257,$p(p,s,o,i,e),p.mode&1&&Wp(i,l,e),e=p,c=l;var h=e.updateQueue;if(h===null){var d=new Set;d.add(c),e.updateQueue=d}else h.add(c);break e}else{if(!(e&1)){Wp(i,l,e),pg();break e}c=Error(q(426))}}else if(Be&&o.mode&1){var m=zp(s);if(m!==null){!(m.flags&65536)&&(m.flags|=256),$p(m,s,o,i,e),K2(cs(c,o));break e}}i=c=cs(c,o),ht!==4&&(ht=2),go===null?go=[i]:go.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=b4(i,c,e);Up(i,v);break e;case 1:o=c;var C=i.type,y=i.stateNode;if(!(i.flags&128)&&(typeof C.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(oa===null||!oa.has(y)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=G4(i,o,e);Up(i,T);break e}}i=i.return}while(i!==null)}a8(n)}catch(x){e=x,ct===n&&n!==null&&(ct=n=n.return);continue}break}while(!0)}function n8(){var t=fl.current;return fl.current=ul,t===null?ul:t}function pg(){(ht===0||ht===3||ht===2)&&(ht=4),Ct===null||!(ii&268435455)&&!(ou&268435455)||Yr(Ct,Rt)}function dl(t,e){var n=Oe;Oe|=2;var r=n8();(Ct!==t||Rt!==e)&&(pr=null,qa(t,e));do try{BT();break}catch(a){t8(t,a)}while(!0);if(X2(),Oe=n,fl.current=r,ct!==null)throw Error(q(261));return Ct=null,Rt=0,ht}function BT(){for(;ct!==null;)r8(ct)}function AT(){for(;ct!==null&&!gC();)r8(ct)}function r8(t){var e=s8(t.alternate,t,on);t.memoizedProps=t.pendingProps,e===null?a8(t):ct=e,cg.current=null}function a8(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=FT(n,e),n!==null){n.flags&=32767,ct=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ht=6,ct=null;return}}else if(n=IT(n,e,on),n!==null){ct=n;return}if(e=e.sibling,e!==null){ct=e;return}ct=e=t}while(e!==null);ht===0&&(ht=5)}function _a(t,e,n){var r=De,a=Rn.transition;try{Rn.transition=null,De=1,WT(t,e,n,r)}finally{Rn.transition=a,De=r}return null}function WT(t,e,n,r){do Yi();while(ea!==null);if(Oe&6)throw Error(q(327));n=t.finishedWork;var a=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(q(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(SC(t,i),t===Ct&&(ct=Ct=null,Rt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||A0||(A0=!0,o8(Xc,function(){return Yi(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Rn.transition,Rn.transition=null;var s=De;De=1;var o=Oe;Oe|=4,cg.current=null,UT(t,n),Q4(n,t),cT(g1),Zc=!!f1,g1=f1=null,t.current=n,PT(n),pC(),Oe=o,De=s,Rn.transition=i}else t.current=n;if(A0&&(A0=!1,ea=t,pl=a),i=t.pendingLanes,i===0&&(oa=null),mC(n.stateNode),rn(t,it()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)a=e[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(gl)throw gl=!1,t=N1,N1=null,t;return pl&1&&t.tag!==0&&Yi(),i=t.pendingLanes,i&1?t===I1?po++:(po=0,I1=t):po=0,ya(),null}function Yi(){if(ea!==null){var t=b3(pl),e=Rn.transition,n=De;try{if(Rn.transition=null,De=16>t?16:t,ea===null)var r=!1;else{if(t=ea,ea=null,pl=0,Oe&6)throw Error(q(331));var a=Oe;for(Oe|=4,Y=t.current;Y!==null;){var i=Y,s=i.child;if(Y.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var l=o[c];for(Y=l;Y!==null;){var f=Y;switch(f.tag){case 0:case 11:case 15:fo(8,f,i)}var u=f.child;if(u!==null)u.return=f,Y=u;else for(;Y!==null;){f=Y;var g=f.sibling,p=f.return;if(X4(f),f===l){Y=null;break}if(g!==null){g.return=p,Y=g;break}Y=p}}}var h=i.alternate;if(h!==null){var d=h.child;if(d!==null){h.child=null;do{var m=d.sibling;d.sibling=null,d=m}while(d!==null)}}Y=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,Y=s;else e:for(;Y!==null;){if(i=Y,i.flags&2048)switch(i.tag){case 0:case 11:case 15:fo(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,Y=v;break e}Y=i.return}}var C=t.current;for(Y=C;Y!==null;){s=Y;var y=s.child;if(s.subtreeFlags&2064&&y!==null)y.return=s,Y=y;else e:for(s=C;Y!==null;){if(o=Y,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:su(9,o)}}catch(x){qe(o,o.return,x)}if(o===s){Y=null;break e}var T=o.sibling;if(T!==null){T.return=o.return,Y=T;break e}Y=o.return}}if(Oe=a,ya(),ar&&typeof ar.onPostCommitFiberRoot=="function")try{ar.onPostCommitFiberRoot(Ql,t)}catch{}r=!0}return r}finally{De=n,Rn.transition=e}}return!1}function rd(t,e,n){e=cs(n,e),e=b4(t,e,1),t=sa(t,e,1),e=Ht(),t!==null&&(r0(t,1,e),rn(t,e))}function qe(t,e,n){if(t.tag===3)rd(t,t,n);else for(;e!==null;){if(e.tag===3){rd(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(oa===null||!oa.has(r))){t=cs(n,t),t=G4(e,t,1),e=sa(e,t,1),t=Ht(),e!==null&&(r0(e,1,t),rn(e,t));break}}e=e.return}}function zT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ht(),t.pingedLanes|=t.suspendedLanes&n,Ct===t&&(Rt&n)===n&&(ht===4||ht===3&&(Rt&130023424)===Rt&&500>it()-ug?qa(t,0):lg|=n),rn(t,e)}function i8(t,e){e===0&&(t.mode&1?(e=_0,_0<<=1,!(_0&130023424)&&(_0=4194304)):e=1);var n=Ht();t=Vr(t,e),t!==null&&(r0(t,e,n),rn(t,n))}function $T(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),i8(t,n)}function jT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,a=t.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(q(314))}r!==null&&r.delete(e),i8(t,n)}var s8;s8=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||tn.current)en=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return en=!1,NT(t,e,n);en=!!(t.flags&131072)}else en=!1,Be&&e.flags&1048576&&u4(e,al,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;xc(t,e),t=e.pendingProps;var a=as(e,Ut.current);Xi(e,n),a=rg(null,e,r,t,a,n);var i=ag();return e.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,nn(r)?(i=!0,nl(e)):i=!1,e.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,Q2(e),a.updater=iu,e.stateNode=a,a._reactInternals=e,x1(e,r,t,n),e=E1(null,e,r,!0,i,n)):(e.tag=0,Be&&i&&j2(e),At(null,e,a,n),e=e.child),e;case 16:r=e.elementType;e:{switch(xc(t,e),t=e.pendingProps,a=r._init,r=a(r._payload),e.type=r,a=e.tag=KT(r),t=Fn(r,t),a){case 0:e=w1(null,e,r,t,n);break e;case 1:e=Kp(null,e,r,t,n);break e;case 11:e=jp(null,e,r,t,n);break e;case 14:e=Hp(null,e,r,Fn(r.type,t),n);break e}throw Error(q(306,r,""))}return e;case 0:return r=e.type,a=e.pendingProps,a=e.elementType===r?a:Fn(r,a),w1(t,e,r,a,n);case 1:return r=e.type,a=e.pendingProps,a=e.elementType===r?a:Fn(r,a),Kp(t,e,r,a,n);case 3:e:{if(z4(e),t===null)throw Error(q(387));r=e.pendingProps,i=e.memoizedState,a=i.element,m4(t,e),ol(e,r,null,n);var s=e.memoizedState;if(r=s.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){a=cs(Error(q(423)),e),e=qp(t,e,r,n,a);break e}else if(r!==a){a=cs(Error(q(424)),e),e=qp(t,e,r,n,a);break e}else for(un=ia(e.stateNode.containerInfo.firstChild),gn=e,Be=!0,Un=null,n=d4(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(is(),r===a){e=Lr(t,e,n);break e}At(t,e,r,n)}e=e.child}return e;case 5:return v4(e),t===null&&y1(e),r=e.type,a=e.pendingProps,i=t!==null?t.memoizedProps:null,s=a.children,p1(r,a)?s=null:i!==null&&p1(r,i)&&(e.flags|=32),W4(t,e),At(t,e,s,n),e.child;case 6:return t===null&&y1(e),null;case 13:return $4(t,e,n);case 4:return J2(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=ss(e,null,r,n):At(t,e,r,n),e.child;case 11:return r=e.type,a=e.pendingProps,a=e.elementType===r?a:Fn(r,a),jp(t,e,r,a,n);case 7:return At(t,e,e.pendingProps,n),e.child;case 8:return At(t,e,e.pendingProps.children,n),e.child;case 12:return At(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,a=e.pendingProps,i=e.memoizedProps,s=a.value,Fe(il,r._currentValue),r._currentValue=s,i!==null)if($n(i.value,s)){if(i.children===a.children&&!tn.current){e=Lr(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){s=i.child;for(var c=o.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=wr(-1,n&-n),c.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var f=l.pending;f===null?c.next=c:(c.next=f.next,f.next=c),l.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),C1(i.return,n,e),o.lanes|=n;break}c=c.next}}else if(i.tag===10)s=i.type===e.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(q(341));s.lanes|=n,o=s.alternate,o!==null&&(o.lanes|=n),C1(s,n,e),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===e){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}At(t,e,a.children,n),e=e.child}return e;case 9:return a=e.type,r=e.pendingProps.children,Xi(e,n),a=Mn(a),r=r(a),e.flags|=1,At(t,e,r,n),e.child;case 14:return r=e.type,a=Fn(r,e.pendingProps),a=Fn(r.type,a),Hp(t,e,r,a,n);case 15:return B4(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,a=e.pendingProps,a=e.elementType===r?a:Fn(r,a),xc(t,e),e.tag=1,nn(r)?(t=!0,nl(e)):t=!1,Xi(e,n),P4(e,r,a),x1(e,r,a,n),E1(null,e,r,!0,t,n);case 19:return j4(t,e,n);case 22:return A4(t,e,n)}throw Error(q(156,e.tag))};function o8(t,e){return F3(t,e)}function HT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function En(t,e,n,r){return new HT(t,e,n,r)}function dg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function KT(t){if(typeof t=="function")return dg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===I2)return 11;if(t===F2)return 14}return 2}function la(t,e){var n=t.alternate;return n===null?(n=En(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ec(t,e,n,r,a,i){var s=2;if(r=t,typeof t=="function")dg(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case Vi:return Xa(n.children,a,i,e);case N2:s=8,a|=8;break;case jf:return t=En(12,n,e,a|2),t.elementType=jf,t.lanes=i,t;case Hf:return t=En(13,n,e,a),t.elementType=Hf,t.lanes=i,t;case Kf:return t=En(19,n,e,a),t.elementType=Kf,t.lanes=i,t;case v3:return cu(n,a,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case h3:s=10;break e;case m3:s=9;break e;case I2:s=11;break e;case F2:s=14;break e;case jr:s=16,r=null;break e}throw Error(q(130,t==null?t:typeof t,""))}return e=En(s,n,e,a),e.elementType=t,e.type=r,e.lanes=i,e}function Xa(t,e,n,r){return t=En(7,t,r,e),t.lanes=n,t}function cu(t,e,n,r){return t=En(22,t,r,e),t.elementType=v3,t.lanes=n,t.stateNode={isHidden:!1},t}function pf(t,e,n){return t=En(6,t,null,e),t.lanes=n,t}function df(t,e,n){return e=En(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function qT(t,e,n,r,a){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ku(0),this.expirationTimes=Ku(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ku(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function hg(t,e,n,r,a,i,s,o,c){return t=new qT(t,e,n,o,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=En(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Q2(i),t}function XT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Di,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function c8(t){if(!t)return ga;t=t._reactInternals;e:{if(pi(t)!==t||t.tag!==1)throw Error(q(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(q(171))}if(t.tag===1){var n=t.type;if(nn(n))return c4(t,n,e)}return e}function l8(t,e,n,r,a,i,s,o,c){return t=hg(n,r,!0,t,a,i,s,o,c),t.context=c8(null),n=t.current,r=Ht(),a=ca(n),i=wr(r,a),i.callback=e??null,sa(n,i,a),t.current.lanes=a,r0(t,a,r),rn(t,r),t}function lu(t,e,n,r){var a=e.current,i=Ht(),s=ca(a);return n=c8(n),e.context===null?e.context=n:e.pendingContext=n,e=wr(i,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=sa(a,e,s),t!==null&&(Wn(t,a,s,i),yc(t,a,s)),s}function hl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ad(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function mg(t,e){ad(t,e),(t=t.alternate)&&ad(t,e)}function YT(){return null}var u8=typeof reportError=="function"?reportError:function(t){console.error(t)};function vg(t){this._internalRoot=t}uu.prototype.render=vg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(q(409));lu(t,e,null,null)};uu.prototype.unmount=vg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;si(function(){lu(null,t,null,null)}),e[Dr]=null}};function uu(t){this._internalRoot=t}uu.prototype.unstable_scheduleHydration=function(t){if(t){var e=A3();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Xr.length&&e!==0&&e<Xr[n].priority;n++);Xr.splice(n,0,t),n===0&&z3(t)}};function yg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function fu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function id(){}function ZT(t,e,n,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var l=hl(s);i.call(l)}}var s=l8(e,r,t,0,null,!1,!1,"",id);return t._reactRootContainer=s,t[Dr]=s.current,ko(t.nodeType===8?t.parentNode:t),si(),s}for(;a=t.lastChild;)t.removeChild(a);if(typeof r=="function"){var o=r;r=function(){var l=hl(c);o.call(l)}}var c=hg(t,0,!1,null,null,!1,!1,"",id);return t._reactRootContainer=c,t[Dr]=c.current,ko(t.nodeType===8?t.parentNode:t),si(function(){lu(e,c,n,r)}),c}function gu(t,e,n,r,a){var i=n._reactRootContainer;if(i){var s=i;if(typeof a=="function"){var o=a;a=function(){var c=hl(s);o.call(c)}}lu(e,s,t,a)}else s=ZT(n,e,t,a,r);return hl(s)}G3=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=qs(e.pendingLanes);n!==0&&(P2(e,n|1),rn(e,it()),!(Oe&6)&&(ls=it()+500,ya()))}break;case 13:si(function(){var r=Vr(t,1);if(r!==null){var a=Ht();Wn(r,t,1,a)}}),mg(t,1)}};b2=function(t){if(t.tag===13){var e=Vr(t,134217728);if(e!==null){var n=Ht();Wn(e,t,134217728,n)}mg(t,134217728)}};B3=function(t){if(t.tag===13){var e=ca(t),n=Vr(t,e);if(n!==null){var r=Ht();Wn(n,t,e,r)}mg(t,e)}};A3=function(){return De};W3=function(t,e){var n=De;try{return De=t,e()}finally{De=n}};r1=function(t,e,n){switch(e){case"input":if(Yf(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var a=nu(r);if(!a)throw Error(q(90));C3(r),Yf(r,a)}}}break;case"textarea":x3(t,n);break;case"select":e=n.value,e!=null&&ji(t,!!n.multiple,e,!1)}};D3=fg;V3=si;var QT={usingClientEntryPoint:!1,Events:[i0,Ii,nu,O3,M3,fg]},Ps={findFiberByHostInstance:Ba,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},JT={bundleType:Ps.bundleType,version:Ps.version,rendererPackageName:Ps.rendererPackageName,rendererConfig:Ps.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:kr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=N3(t),t===null?null:t.stateNode},findFiberByHostInstance:Ps.findFiberByHostInstance||YT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var W0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!W0.isDisabled&&W0.supportsFiber)try{Ql=W0.inject(JT),ar=W0}catch{}}hn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QT;hn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yg(e))throw Error(q(200));return XT(t,e,null,n)};hn.createRoot=function(t,e){if(!yg(t))throw Error(q(299));var n=!1,r="",a=u8;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(a=e.onRecoverableError)),e=hg(t,1,!1,null,null,n,!1,r,a),t[Dr]=e.current,ko(t.nodeType===8?t.parentNode:t),new vg(e)};hn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(q(188)):(t=Object.keys(t).join(","),Error(q(268,t)));return t=N3(e),t=t===null?null:t.stateNode,t};hn.flushSync=function(t){return si(t)};hn.hydrate=function(t,e,n){if(!fu(e))throw Error(q(200));return gu(null,t,e,!0,n)};hn.hydrateRoot=function(t,e,n){if(!yg(t))throw Error(q(405));var r=n!=null&&n.hydratedSources||null,a=!1,i="",s=u8;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=l8(e,null,t,1,n??null,a,!1,i,s),t[Dr]=e.current,ko(t),r)for(t=0;t<r.length;t++)n=r[t],a=n._getVersion,a=a(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,a]:e.mutableSourceEagerHydrationData.push(n,a);return new uu(e)};hn.render=function(t,e,n){if(!fu(e))throw Error(q(200));return gu(null,t,e,!1,n)};hn.unmountComponentAtNode=function(t){if(!fu(t))throw Error(q(40));return t._reactRootContainer?(si(function(){gu(null,null,t,!1,function(){t._reactRootContainer=null,t[Dr]=null})}),!0):!1};hn.unstable_batchedUpdates=fg;hn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!fu(n))throw Error(q(200));if(t==null||t._reactInternals===void 0)throw Error(q(38));return gu(t,e,n,!1,r)};hn.version="18.3.1-next-f1338f8080-20240426";function f8(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f8)}catch(t){console.error(t)}}f8(),f3.exports=hn;var ex=f3.exports,g8,sd=ex;g8=sd.createRoot,sd.hydrateRoot;class tx{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,n){const r=a=>{this.removeEventListener(e,r),n.call(this,a)};this.addEventListener(e,r)}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}addEventListenerDebounced(e,n,r){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const a=this.debouncedListeners[e];if(!a[n]){const i=s=>{a[n]&&clearTimeout(a[n].timeoutId),a[n].timeoutId=setTimeout(()=>{n.call(this,s)},r)};a[n]={original:n,handle:i,timeoutId:null},this.addEventListener(e,i)}}removeEventListenerDebounced(e,n){var r;if((r=this.debouncedListeners[e])!=null&&r[n]){const a=this.debouncedListeners[e][n];this.removeEventListener(e,a.handle),clearTimeout(a.timeoutId),delete this.debouncedListeners[e][n]}}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],a=r.length;for(let i=0;i<a;i++)if(r[i]===n){r.splice(i,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const n=this.listeners[e.type].slice(),r=n.length;for(let a=0;a<r;a++)try{n[a].call(this,e)}catch(i){console.error(`error in event listener of type:  ${e.type}`,i)}return!e.defaultPrevented}}const de=new tx;function Q(t=de,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t==null?void 0:t.dispatchEvent(r)}function zn(t){const e=t.indexOf(":");return t.substring(e+1)}var X;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED"})(X||(X={}));var se;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(se||(se={}));var Ae;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(Ae||(Ae={}));var xr;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(xr||(xr={}));const Rc={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},nx={OFF:0,NORMALIZED:1,RAW:2};var p8={BlendMode:Rc,FilterMode:nx};const{BlendMode:z0}=p8;var U1;(function(t){t[t.COMPOSITE=z0.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=z0.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=z0.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=z0.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND"})(U1||(U1={}));const rx=U1;var us;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition"})(us||(us={}));var P1;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE"})(P1||(P1={}));const ax=P1;var b1;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(b1||(b1={}));const ix=b1;var Er;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID"})(Er||(Er={}));var G1;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(G1||(G1={}));const sx=G1;var B1;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated"})(B1||(B1={}));const ox=B1;var Wt;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(Wt||(Wt={}));var fn;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(fn||(fn={}));var $o;(function(t){t.FRAME="f",t.SECOND="s"})($o||($o={}));const cx=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return $o}},Symbol.toStringTag,{value:"Module"}));var Jt;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.WADO_WEB_CLIENT="wadoWebClient"})(Jt||(Jt={}));var A1;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(A1||(A1={}));const di=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:rx,CalibrationTypes:ox,ContourType:ix,DynamicOperatorType:sx,Events:X,get GenerateImageType(){return A1},GeometryType:ax,ImageQualityStatus:fn,InterpolationType:xr,MetadataModules:Jt,OrientationAxis:us,RequestType:se,VOILUTFunctionType:Er,VideoEnums:cx,ViewportStatus:Wt,ViewportType:Ae},Symbol.toStringTag,{value:"Module"})),lx=1073741824;class ux{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*lx,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{const n=this.getBytesAvailable(),r=Array.from(this._imageCache.values()).reduce((i,s)=>s.sharedCacheKey?i:i+s.sizeInBytes,0);return n+r>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,n=!1)=>{const r=this._imageCache.get(e);if(!r)return;if(r.sharedCacheKey&&!n)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:a}=r;a!=null&&a.cancelFn&&a.cancelFn(),a!=null&&a.decache&&a.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e);if(!n)return;const{volumeLoadObject:r,volume:a}=n;a&&(a.cancelLoading&&a.cancelLoading(),a.imageData&&a.imageData.delete(),r.cancelFn&&r.cancelFn(),a.imageIds&&a.imageIds.forEach(i=>{const s=this._imageCache.get(i);s&&s.sharedCacheKey===e&&(s.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n,{force:!0}),Q(de,X.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),Q(de,X.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.putGeometryLoadObject=(e,n)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(n.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const r={loaded:!1,geometryId:e,geometryLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,r),n.promise.then(a=>{try{this._putGeometryCommon(e,a,r)}catch(i){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,i),i}}).catch(a=>{throw console.debug(`Error caching geometry ${e}:`,a),this._geometryCache.delete(e),a})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(!n)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(n.sizeInBytes);const r={geometry:n,geometryId:e};Q(de,X.GEOMETRY_CACHE_GEOMETRY_REMOVED,r),this._decacheGeometry(e)},this._decacheGeometry=e=>{const n=this._geometryCache.get(e);if(!n)return;const{geometryLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImage=(e,n=fn.FAR_REPLICATE)=>{var a;if(e===void 0)throw new Error("getImage: imageId must not be undefined");const r=this._imageCache.get(e);if(r&&(r.timeStamp=Date.now(),!(((a=r.image)==null?void 0:a.imageQualityStatus)<n)))return r.image},this.getVolume=(e,n=!1)=>{var a;if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const r=this._volumeCache.get(e);return r?(r.timeStamp=Date.now(),r.volume):n?(a=[...this._volumeCache.values()].find(i=>i.volumeId.includes(e)))==null?void 0:a.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(r=>r.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:n=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(!r)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,n),this.incrementImageCacheSize(-r.sizeInBytes);const a={image:r,imageId:e};Q(de,X.IMAGE_CACHE_IMAGE_REMOVED,a)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const r={volume:n,volumeId:e};Q(de,X.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometryLoadObject}}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;const a=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function i(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}a.sort(i);const s=a.map(c=>c.imageId);let o=s;n&&(o=s.filter(c=>!n.includes(c)));for(const c of o)if(this.removeImageLoadObject(c),Q(de,X.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r;for(const c of s)if(this.removeImageLoadObject(c),Q(de,X.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r}_putImageCommon(e,n,r){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!n){console.warn("Image is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(X.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.image=n,r.sizeInBytes=n.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const a={image:r};Q(de,X.IMAGE_CACHE_IMAGE_ADDED,a),r.sharedCacheKey=n.sharedCacheKey}async putImageLoadObject(e,n){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const r=this._imageCache.get(e);if(r!=null&&r.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const a={...r,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,a),this._imageCache.set(e,a),n.promise.then(i=>{try{this._putImageCommon(e,i,a)}catch(s){throw console.debug(`Error in _putImageCommon for image ${e}:`,s),s}}).catch(i=>{throw console.debug(`Error caching image ${e}:`,i),this._imageCache.delete(e),i})}putImageSync(e,n){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,r);try{this._putImageCommon(e,n,r)}catch(a){throw this._imageCache.delete(e),a}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){const n=Array.from(this._volumeCache.keys()),r=zn(e);for(const a of n){const i=this._volumeCache.get(a);if(!i)return;const{volume:s}=i;if(!s.imageIds.length)return;const o=s.getImageURIIndex(r);if(o>-1)return{volume:s,imageIdIndex:o}}}getCachedImageBasedOnImageURI(e){const n=zn(e),a=Array.from(this._imageCache.keys()).find(i=>zn(i)===n);if(a)return this._imageCache.get(a)}_putVolumeCommon(e,n,r){var i;if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}r.loaded=!0,r.volume=n,(i=n.imageIds)==null||i.forEach(s=>{const o=this._imageCache.get(s);o&&(o.sharedCacheKey=e)});const a={volume:r};Q(de,X.VOLUME_CACHE_VOLUME_ADDED,a)}putVolumeSync(e,n){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const r={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,r);try{this._putVolumeCommon(e,n,r)}catch(a){throw this._volumeCache.delete(e),a}}async putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(a=>{try{this._putVolumeCommon(e,a,r)}catch(i){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,i),this._volumeCache.delete(e),i}}).catch(a=>{throw this._volumeCache.delete(e),a})}_putGeometryCommon(e,n,r){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!n){console.warn("Geometry is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(X.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.geometry=n,r.sizeInBytes=n.sizeInBytes,this.incrementGeometryCacheSize(r.sizeInBytes);const a={geometry:r};Q(de,X.GEOMETRY_CACHE_GEOMETRY_ADDED,a)}putGeometrySync(e,n){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const r={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,r);try{this._putGeometryCommon(e,n,r)}catch(a){throw this._geometryCache.delete(e),a}}setPartialImage(e,n){const r=this._imageCache.get(e);if(!r){n&&this._imageCache.set(e,{image:n,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}r.loaded&&(r.loaded=!1,r.imageLoadObject=null,this.incrementImageCacheSize(-r.sizeInBytes),r.sizeInBytes=0),r.image=n||r.image}getImageQuality(e){var r;const n=(r=this._imageCache.get(e))==null?void 0:r.image;return n?n.imageQualityStatus||fn.FULL_RESOLUTION:void 0}}const ie=new ux,sr=[];function xs(t,e=0){let n;for(n=0;n<sr.length&&!(sr[n].priority<=e);n++);sr.splice(n,0,{priority:e,provider:t})}function fx(t){for(let e=0;e<sr.length;e++)if(sr[e].provider===t){sr.splice(e,1);break}}function gx(){for(;sr.length>0;)sr.pop()}function Z(t,...e){for(let n=0;n<sr.length;n++){const r=sr[n].provider(t,...e);if(r!==void 0)return r}}const px=Object.freeze(Object.defineProperty({__proto__:null,addProvider:xs,get:Z,removeAllProviders:gx,removeProvider:fx},Symbol.toStringTag,{value:"Module"}));let bs={};const Cg={add:(t,e)=>{Cg.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const n=e.type;bs[t]||(bs[t]={}),bs[t][n]=e.metadata},get:(t,e)=>{var n;return(n=bs[e])==null?void 0:n[t]},clear:()=>{bs={}}};xs(Cg.get);function d8(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, or Int16Array");return Float32Array}}function dx(t,e,n={}){const{isVolumeBuffer:r=!1}=n,a=d8(t,r),i=a.BYTES_PER_ELEMENT;return{numBytes:e*i,TypedArrayConstructor:a}}function _r(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}var Te=1e-6,et=typeof Float32Array<"u"?Float32Array:Array,hx=Math.PI/180;function mx(t){return t*hx}function od(t,e){return Math.abs(t-e)<=Te*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Tg(){var t=new et(9);return et!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function pu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function vx(t){var e=new et(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function yx(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ys(t,e,n,r,a,i,s,o,c){var l=new et(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=a,l[5]=i,l[6]=s,l[7]=o,l[8]=c,l}function h8(t,e,n,r,a,i,s,o,c,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=s,t[6]=o,t[7]=c,t[8]=l,t}function jn(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function xg(t,e){if(t===e){var n=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function o0(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],l=e[7],f=e[8],u=f*s-o*l,g=-f*i+o*c,p=l*i-s*c,h=n*u+r*g+a*p;return h?(h=1/h,t[0]=u*h,t[1]=(-f*r+a*l)*h,t[2]=(o*r-a*s)*h,t[3]=g*h,t[4]=(f*n-a*c)*h,t[5]=(-o*n+a*i)*h,t[6]=p*h,t[7]=(-l*n+r*c)*h,t[8]=(s*n-r*i)*h,t):null}function Cx(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],l=e[7],f=e[8];return t[0]=s*f-o*l,t[1]=a*l-r*f,t[2]=r*o-a*s,t[3]=o*c-i*f,t[4]=n*f-a*c,t[5]=a*i-n*o,t[6]=i*l-s*c,t[7]=r*c-n*l,t[8]=n*s-r*i,t}function Na(t){var e=t[0],n=t[1],r=t[2],a=t[3],i=t[4],s=t[5],o=t[6],c=t[7],l=t[8];return e*(l*i-s*c)+n*(-l*a+s*o)+r*(c*a-i*o)}function fs(t,e,n){var r=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],p=n[1],h=n[2],d=n[3],m=n[4],v=n[5],C=n[6],y=n[7],T=n[8];return t[0]=g*r+p*s+h*l,t[1]=g*a+p*o+h*f,t[2]=g*i+p*c+h*u,t[3]=d*r+m*s+v*l,t[4]=d*a+m*o+v*f,t[5]=d*i+m*c+v*u,t[6]=C*r+y*s+T*l,t[7]=C*a+y*o+T*f,t[8]=C*i+y*c+T*u,t}function Tx(t,e,n){var r=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],p=n[1];return t[0]=r,t[1]=a,t[2]=i,t[3]=s,t[4]=o,t[5]=c,t[6]=g*r+p*s+l,t[7]=g*a+p*o+f,t[8]=g*i+p*c+u,t}function xx(t,e,n){var r=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=Math.sin(n),p=Math.cos(n);return t[0]=p*r+g*s,t[1]=p*a+g*o,t[2]=p*i+g*c,t[3]=p*s-g*r,t[4]=p*o-g*a,t[5]=p*c-g*i,t[6]=l,t[7]=f,t[8]=u,t}function Sx(t,e,n){var r=n[0],a=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function wx(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Ex(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Rx(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ox(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Mx(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=n+n,o=r+r,c=a+a,l=n*s,f=r*s,u=r*o,g=a*s,p=a*o,h=a*c,d=i*s,m=i*o,v=i*c;return t[0]=1-u-h,t[3]=f-v,t[6]=g+m,t[1]=f+v,t[4]=1-l-h,t[7]=p-d,t[2]=g-m,t[5]=p+d,t[8]=1-l-u,t}function Dx(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],p=e[11],h=e[12],d=e[13],m=e[14],v=e[15],C=n*o-r*s,y=n*c-a*s,T=n*l-i*s,x=r*c-a*o,S=r*l-i*o,w=a*l-i*c,E=f*d-u*h,L=f*m-g*h,R=f*v-p*h,D=u*m-g*d,I=u*v-p*d,b=g*v-p*m,F=C*b-y*I+T*D+x*R-S*L+w*E;return F?(F=1/F,t[0]=(o*b-c*I+l*D)*F,t[1]=(c*R-s*b-l*L)*F,t[2]=(s*I-o*R+l*E)*F,t[3]=(a*I-r*b-i*D)*F,t[4]=(n*b-a*R+i*L)*F,t[5]=(r*R-n*I-i*E)*F,t[6]=(d*w-m*S+v*x)*F,t[7]=(m*T-h*w-v*y)*F,t[8]=(h*S-d*T+v*C)*F,t):null}function Vx(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Lx(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function _x(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Nx(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function m8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Ix(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Fx(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function kx(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Ux(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],l=t[7],f=t[8],u=e[0],g=e[1],p=e[2],h=e[3],d=e[4],m=e[5],v=e[6],C=e[7],y=e[8];return Math.abs(n-u)<=Te*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-g)<=Te*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-p)<=Te*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(i-h)<=Te*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-d)<=Te*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-m)<=Te*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(c-v)<=Te*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-C)<=Te*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(f-y)<=Te*Math.max(1,Math.abs(f),Math.abs(y))}var Px=fs,bx=m8;const Gx=Object.freeze(Object.defineProperty({__proto__:null,add:Nx,adjoint:Cx,clone:vx,copy:yx,create:Tg,determinant:Na,equals:Ux,exactEquals:kx,frob:_x,fromMat2d:Ox,fromMat4:pu,fromQuat:Mx,fromRotation:Ex,fromScaling:Rx,fromTranslation:wx,fromValues:Ys,identity:jn,invert:o0,mul:Px,multiply:fs,multiplyScalar:Ix,multiplyScalarAndAdd:Fx,normalFromMat4:Dx,projection:Vx,rotate:xx,scale:Sx,set:h8,str:Lx,sub:bx,subtract:m8,translate:Tx,transpose:xg},Symbol.toStringTag,{value:"Module"}));function Ca(){var t=new et(16);return et!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Bx(t){var e=new et(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function v8(t,e,n,r,a,i,s,o,c,l,f,u,g,p,h,d){var m=new et(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=a,m[5]=i,m[6]=s,m[7]=o,m[8]=c,m[9]=l,m[10]=f,m[11]=u,m[12]=g,m[13]=p,m[14]=h,m[15]=d,m}function Ax(t,e,n,r,a,i,s,o,c,l,f,u,g,p,h,d,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=i,t[5]=s,t[6]=o,t[7]=c,t[8]=l,t[9]=f,t[10]=u,t[11]=g,t[12]=p,t[13]=h,t[14]=d,t[15]=m,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function me(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],i=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=i,t[11]=e[14],t[12]=a,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function lt(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],p=e[11],h=e[12],d=e[13],m=e[14],v=e[15],C=n*o-r*s,y=n*c-a*s,T=n*l-i*s,x=r*c-a*o,S=r*l-i*o,w=a*l-i*c,E=f*d-u*h,L=f*m-g*h,R=f*v-p*h,D=u*m-g*d,I=u*v-p*d,b=g*v-p*m,F=C*b-y*I+T*D+x*R-S*L+w*E;return F?(F=1/F,t[0]=(o*b-c*I+l*D)*F,t[1]=(a*I-r*b-i*D)*F,t[2]=(d*w-m*S+v*x)*F,t[3]=(g*S-u*w-p*x)*F,t[4]=(c*R-s*b-l*L)*F,t[5]=(n*b-a*R+i*L)*F,t[6]=(m*T-h*w-v*y)*F,t[7]=(f*w-g*T+p*y)*F,t[8]=(s*I-o*R+l*E)*F,t[9]=(r*R-n*I-i*E)*F,t[10]=(h*S-d*T+v*C)*F,t[11]=(u*T-f*S-p*C)*F,t[12]=(o*L-s*D-c*E)*F,t[13]=(n*D-r*L+a*E)*F,t[14]=(d*y-h*x-m*C)*F,t[15]=(f*x-u*y+g*C)*F,t):null}function Wx(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],p=e[11],h=e[12],d=e[13],m=e[14],v=e[15];return t[0]=o*(g*v-p*m)-u*(c*v-l*m)+d*(c*p-l*g),t[1]=-(r*(g*v-p*m)-u*(a*v-i*m)+d*(a*p-i*g)),t[2]=r*(c*v-l*m)-o*(a*v-i*m)+d*(a*l-i*c),t[3]=-(r*(c*p-l*g)-o*(a*p-i*g)+u*(a*l-i*c)),t[4]=-(s*(g*v-p*m)-f*(c*v-l*m)+h*(c*p-l*g)),t[5]=n*(g*v-p*m)-f*(a*v-i*m)+h*(a*p-i*g),t[6]=-(n*(c*v-l*m)-s*(a*v-i*m)+h*(a*l-i*c)),t[7]=n*(c*p-l*g)-s*(a*p-i*g)+f*(a*l-i*c),t[8]=s*(u*v-p*d)-f*(o*v-l*d)+h*(o*p-l*u),t[9]=-(n*(u*v-p*d)-f*(r*v-i*d)+h*(r*p-i*u)),t[10]=n*(o*v-l*d)-s*(r*v-i*d)+h*(r*l-i*o),t[11]=-(n*(o*p-l*u)-s*(r*p-i*u)+f*(r*l-i*o)),t[12]=-(s*(u*m-g*d)-f*(o*m-c*d)+h*(o*g-c*u)),t[13]=n*(u*m-g*d)-f*(r*m-a*d)+h*(r*g-a*u),t[14]=-(n*(o*m-c*d)-s*(r*m-a*d)+h*(r*c-a*o)),t[15]=n*(o*g-c*u)-s*(r*g-a*u)+f*(r*c-a*o),t}function zx(t){var e=t[0],n=t[1],r=t[2],a=t[3],i=t[4],s=t[5],o=t[6],c=t[7],l=t[8],f=t[9],u=t[10],g=t[11],p=t[12],h=t[13],d=t[14],m=t[15],v=e*s-n*i,C=e*o-r*i,y=e*c-a*i,T=n*o-r*s,x=n*c-a*s,S=r*c-a*o,w=l*h-f*p,E=l*d-u*p,L=l*m-g*p,R=f*d-u*h,D=f*m-g*h,I=u*m-g*d;return v*I-C*D+y*R+T*L-x*E+S*w}function ge(t,e,n){var r=e[0],a=e[1],i=e[2],s=e[3],o=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=e[9],p=e[10],h=e[11],d=e[12],m=e[13],v=e[14],C=e[15],y=n[0],T=n[1],x=n[2],S=n[3];return t[0]=y*r+T*o+x*u+S*d,t[1]=y*a+T*c+x*g+S*m,t[2]=y*i+T*l+x*p+S*v,t[3]=y*s+T*f+x*h+S*C,y=n[4],T=n[5],x=n[6],S=n[7],t[4]=y*r+T*o+x*u+S*d,t[5]=y*a+T*c+x*g+S*m,t[6]=y*i+T*l+x*p+S*v,t[7]=y*s+T*f+x*h+S*C,y=n[8],T=n[9],x=n[10],S=n[11],t[8]=y*r+T*o+x*u+S*d,t[9]=y*a+T*c+x*g+S*m,t[10]=y*i+T*l+x*p+S*v,t[11]=y*s+T*f+x*h+S*C,y=n[12],T=n[13],x=n[14],S=n[15],t[12]=y*r+T*o+x*u+S*d,t[13]=y*a+T*c+x*g+S*m,t[14]=y*i+T*l+x*p+S*v,t[15]=y*s+T*f+x*h+S*C,t}function at(t,e,n){var r=n[0],a=n[1],i=n[2],s,o,c,l,f,u,g,p,h,d,m,v;return e===t?(t[12]=e[0]*r+e[4]*a+e[8]*i+e[12],t[13]=e[1]*r+e[5]*a+e[9]*i+e[13],t[14]=e[2]*r+e[6]*a+e[10]*i+e[14],t[15]=e[3]*r+e[7]*a+e[11]*i+e[15]):(s=e[0],o=e[1],c=e[2],l=e[3],f=e[4],u=e[5],g=e[6],p=e[7],h=e[8],d=e[9],m=e[10],v=e[11],t[0]=s,t[1]=o,t[2]=c,t[3]=l,t[4]=f,t[5]=u,t[6]=g,t[7]=p,t[8]=h,t[9]=d,t[10]=m,t[11]=v,t[12]=s*r+f*a+h*i+e[12],t[13]=o*r+u*a+d*i+e[13],t[14]=c*r+g*a+m*i+e[14],t[15]=l*r+p*a+v*i+e[15]),t}function Nr(t,e,n){var r=n[0],a=n[1],i=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _n(t,e,n,r){var a=r[0],i=r[1],s=r[2],o=Math.hypot(a,i,s),c,l,f,u,g,p,h,d,m,v,C,y,T,x,S,w,E,L,R,D,I,b,F,W;return o<Te?null:(o=1/o,a*=o,i*=o,s*=o,c=Math.sin(n),l=Math.cos(n),f=1-l,u=e[0],g=e[1],p=e[2],h=e[3],d=e[4],m=e[5],v=e[6],C=e[7],y=e[8],T=e[9],x=e[10],S=e[11],w=a*a*f+l,E=i*a*f+s*c,L=s*a*f-i*c,R=a*i*f-s*c,D=i*i*f+l,I=s*i*f+a*c,b=a*s*f+i*c,F=i*s*f-a*c,W=s*s*f+l,t[0]=u*w+d*E+y*L,t[1]=g*w+m*E+T*L,t[2]=p*w+v*E+x*L,t[3]=h*w+C*E+S*L,t[4]=u*R+d*D+y*I,t[5]=g*R+m*D+T*I,t[6]=p*R+v*D+x*I,t[7]=h*R+C*D+S*I,t[8]=u*b+d*F+y*W,t[9]=g*b+m*F+T*W,t[10]=p*b+v*F+x*W,t[11]=h*b+C*F+S*W,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Sg(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[4],s=e[5],o=e[6],c=e[7],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+l*r,t[5]=s*a+f*r,t[6]=o*a+u*r,t[7]=c*a+g*r,t[8]=l*a-i*r,t[9]=f*a-s*r,t[10]=u*a-o*r,t[11]=g*a-c*r,t}function wg(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],s=e[1],o=e[2],c=e[3],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-l*r,t[1]=s*a-f*r,t[2]=o*a-u*r,t[3]=c*a-g*r,t[8]=i*r+l*a,t[9]=s*r+f*a,t[10]=o*r+u*a,t[11]=c*r+g*a,t}function Eg(t,e,n){var r=Math.sin(n),a=Math.cos(n),i=e[0],s=e[1],o=e[2],c=e[3],l=e[4],f=e[5],u=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+l*r,t[1]=s*a+f*r,t[2]=o*a+u*r,t[3]=c*a+g*r,t[4]=l*a-i*r,t[5]=f*a-s*r,t[6]=u*a-o*r,t[7]=g*a-c*r,t}function du(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Rg(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Og(t,e,n){var r=n[0],a=n[1],i=n[2],s=Math.hypot(r,a,i),o,c,l;return s<Te?null:(s=1/s,r*=s,a*=s,i*=s,o=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=r*r*l+c,t[1]=a*r*l+i*o,t[2]=i*r*l-a*o,t[3]=0,t[4]=r*a*l-i*o,t[5]=a*a*l+c,t[6]=i*a*l+r*o,t[7]=0,t[8]=r*i*l+a*o,t[9]=a*i*l-r*o,t[10]=i*i*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function $x(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jx(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Hx(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y8(t,e,n){var r=e[0],a=e[1],i=e[2],s=e[3],o=r+r,c=a+a,l=i+i,f=r*o,u=r*c,g=r*l,p=a*c,h=a*l,d=i*l,m=s*o,v=s*c,C=s*l;return t[0]=1-(p+d),t[1]=u+C,t[2]=g-v,t[3]=0,t[4]=u-C,t[5]=1-(f+d),t[6]=h+m,t[7]=0,t[8]=g+v,t[9]=h-m,t[10]=1-(f+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Kx(t,e){var n=new et(3),r=-e[0],a=-e[1],i=-e[2],s=e[3],o=e[4],c=e[5],l=e[6],f=e[7],u=r*r+a*a+i*i+s*s;return u>0?(n[0]=(o*s+f*r+c*i-l*a)*2/u,n[1]=(c*s+f*a+l*r-o*i)*2/u,n[2]=(l*s+f*i+o*a-c*r)*2/u):(n[0]=(o*s+f*r+c*i-l*a)*2,n[1]=(c*s+f*a+l*r-o*i)*2,n[2]=(l*s+f*i+o*a-c*r)*2),y8(t,e,n),t}function qx(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function C8(t,e){var n=e[0],r=e[1],a=e[2],i=e[4],s=e[5],o=e[6],c=e[8],l=e[9],f=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(i,s,o),t[2]=Math.hypot(c,l,f),t}function W1(t,e){var n=new et(3);C8(n,e);var r=1/n[0],a=1/n[1],i=1/n[2],s=e[0]*r,o=e[1]*a,c=e[2]*i,l=e[4]*r,f=e[5]*a,u=e[6]*i,g=e[8]*r,p=e[9]*a,h=e[10]*i,d=s+f+h,m=0;return d>0?(m=Math.sqrt(d+1)*2,t[3]=.25*m,t[0]=(u-p)/m,t[1]=(g-c)/m,t[2]=(o-l)/m):s>f&&s>h?(m=Math.sqrt(1+s-f-h)*2,t[3]=(u-p)/m,t[0]=.25*m,t[1]=(o+l)/m,t[2]=(g+c)/m):f>h?(m=Math.sqrt(1+f-s-h)*2,t[3]=(g-c)/m,t[0]=(o+l)/m,t[1]=.25*m,t[2]=(u+p)/m):(m=Math.sqrt(1+h-s-f)*2,t[3]=(o-l)/m,t[0]=(g+c)/m,t[1]=(u+p)/m,t[2]=.25*m),t}function T8(t,e,n,r){var a=e[0],i=e[1],s=e[2],o=e[3],c=a+a,l=i+i,f=s+s,u=a*c,g=a*l,p=a*f,h=i*l,d=i*f,m=s*f,v=o*c,C=o*l,y=o*f,T=r[0],x=r[1],S=r[2];return t[0]=(1-(h+m))*T,t[1]=(g+y)*T,t[2]=(p-C)*T,t[3]=0,t[4]=(g-y)*x,t[5]=(1-(u+m))*x,t[6]=(d+v)*x,t[7]=0,t[8]=(p+C)*S,t[9]=(d-v)*S,t[10]=(1-(u+h))*S,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Xx(t,e,n,r,a){var i=e[0],s=e[1],o=e[2],c=e[3],l=i+i,f=s+s,u=o+o,g=i*l,p=i*f,h=i*u,d=s*f,m=s*u,v=o*u,C=c*l,y=c*f,T=c*u,x=r[0],S=r[1],w=r[2],E=a[0],L=a[1],R=a[2],D=(1-(d+v))*x,I=(p+T)*x,b=(h-y)*x,F=(p-T)*S,W=(1-(g+v))*S,P=(m+C)*S,K=(h+y)*w,U=(m-C)*w,N=(1-(g+d))*w;return t[0]=D,t[1]=I,t[2]=b,t[3]=0,t[4]=F,t[5]=W,t[6]=P,t[7]=0,t[8]=K,t[9]=U,t[10]=N,t[11]=0,t[12]=n[0]+E-(D*E+F*L+K*R),t[13]=n[1]+L-(I*E+W*L+U*R),t[14]=n[2]+R-(b*E+P*L+N*R),t[15]=1,t}function ml(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=n+n,o=r+r,c=a+a,l=n*s,f=r*s,u=r*o,g=a*s,p=a*o,h=a*c,d=i*s,m=i*o,v=i*c;return t[0]=1-u-h,t[1]=f+v,t[2]=g-m,t[3]=0,t[4]=f-v,t[5]=1-l-h,t[6]=p+d,t[7]=0,t[8]=g+m,t[9]=p-d,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Yx(t,e,n,r,a,i,s){var o=1/(n-e),c=1/(a-r),l=1/(i-s);return t[0]=i*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(a+r)*c,t[10]=(s+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*i*2*l,t[15]=0,t}function x8(t,e,n,r,a){var i=1/Math.tan(e/2),s;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(s=1/(r-a),t[10]=(a+r)*s,t[14]=2*a*r*s):(t[10]=-1,t[14]=-2*r),t}var Zx=x8;function Qx(t,e,n,r,a){var i=1/Math.tan(e/2),s;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(s=1/(r-a),t[10]=a*s,t[14]=a*r*s):(t[10]=-1,t[14]=-r),t}function Jx(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(s+o),l=2/(a+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((s-o)*c*.5),t[9]=(a-i)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function S8(t,e,n,r,a,i,s){var o=1/(e-n),c=1/(r-a),l=1/(i-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*o,t[13]=(a+r)*c,t[14]=(s+i)*l,t[15]=1,t}var Mg=S8;function eS(t,e,n,r,a,i,s){var o=1/(e-n),c=1/(r-a),l=1/(i-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*o,t[13]=(a+r)*c,t[14]=i*l,t[15]=1,t}function w8(t,e,n,r){var a,i,s,o,c,l,f,u,g,p,h=e[0],d=e[1],m=e[2],v=r[0],C=r[1],y=r[2],T=n[0],x=n[1],S=n[2];return Math.abs(h-T)<Te&&Math.abs(d-x)<Te&&Math.abs(m-S)<Te?te(t):(f=h-T,u=d-x,g=m-S,p=1/Math.hypot(f,u,g),f*=p,u*=p,g*=p,a=C*g-y*u,i=y*f-v*g,s=v*u-C*f,p=Math.hypot(a,i,s),p?(p=1/p,a*=p,i*=p,s*=p):(a=0,i=0,s=0),o=u*s-g*i,c=g*a-f*s,l=f*i-u*a,p=Math.hypot(o,c,l),p?(p=1/p,o*=p,c*=p,l*=p):(o=0,c=0,l=0),t[0]=a,t[1]=o,t[2]=f,t[3]=0,t[4]=i,t[5]=c,t[6]=u,t[7]=0,t[8]=s,t[9]=l,t[10]=g,t[11]=0,t[12]=-(a*h+i*d+s*m),t[13]=-(o*h+c*d+l*m),t[14]=-(f*h+u*d+g*m),t[15]=1,t)}function tS(t,e,n,r){var a=e[0],i=e[1],s=e[2],o=r[0],c=r[1],l=r[2],f=a-n[0],u=i-n[1],g=s-n[2],p=f*f+u*u+g*g;p>0&&(p=1/Math.sqrt(p),f*=p,u*=p,g*=p);var h=c*g-l*u,d=l*f-o*g,m=o*u-c*f;return p=h*h+d*d+m*m,p>0&&(p=1/Math.sqrt(p),h*=p,d*=p,m*=p),t[0]=h,t[1]=d,t[2]=m,t[3]=0,t[4]=u*m-g*d,t[5]=g*h-f*m,t[6]=f*d-u*h,t[7]=0,t[8]=f,t[9]=u,t[10]=g,t[11]=0,t[12]=a,t[13]=i,t[14]=s,t[15]=1,t}function nS(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function rS(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function aS(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function E8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function iS(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function sS(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function oS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function cS(t,e){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],l=t[7],f=t[8],u=t[9],g=t[10],p=t[11],h=t[12],d=t[13],m=t[14],v=t[15],C=e[0],y=e[1],T=e[2],x=e[3],S=e[4],w=e[5],E=e[6],L=e[7],R=e[8],D=e[9],I=e[10],b=e[11],F=e[12],W=e[13],P=e[14],K=e[15];return Math.abs(n-C)<=Te*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(r-y)<=Te*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-T)<=Te*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(i-x)<=Te*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-S)<=Te*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(o-w)<=Te*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(c-E)<=Te*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-L)<=Te*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(f-R)<=Te*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(u-D)<=Te*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(g-I)<=Te*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(p-b)<=Te*Math.max(1,Math.abs(p),Math.abs(b))&&Math.abs(h-F)<=Te*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(d-W)<=Te*Math.max(1,Math.abs(d),Math.abs(W))&&Math.abs(m-P)<=Te*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(v-K)<=Te*Math.max(1,Math.abs(v),Math.abs(K))}var vl=ge,lS=E8;const yl=Object.freeze(Object.defineProperty({__proto__:null,add:aS,adjoint:Wx,clone:Bx,copy:Ze,create:Ca,determinant:zx,equals:cS,exactEquals:oS,frob:rS,fromQuat:ml,fromQuat2:Kx,fromRotation:Og,fromRotationTranslation:y8,fromRotationTranslationScale:T8,fromRotationTranslationScaleOrigin:Xx,fromScaling:Rg,fromTranslation:du,fromValues:v8,fromXRotation:$x,fromYRotation:jx,fromZRotation:Hx,frustum:Yx,getRotation:W1,getScaling:C8,getTranslation:qx,identity:te,invert:lt,lookAt:w8,mul:vl,multiply:ge,multiplyScalar:iS,multiplyScalarAndAdd:sS,ortho:Mg,orthoNO:S8,orthoZO:eS,perspective:Zx,perspectiveFromFieldOfView:Jx,perspectiveNO:x8,perspectiveZO:Qx,rotate:_n,rotateX:Sg,rotateY:wg,rotateZ:Eg,scale:Nr,set:Ax,str:nS,sub:lS,subtract:E8,targetTo:tS,translate:at,transpose:me},Symbol.toStringTag,{value:"Module"}));function ne(){var t=new et(3);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Zi(t){var e=new et(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ua(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Qe(t,e,n){var r=new et(3);return r[0]=t,r[1]=e,r[2]=n,r}function jo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ee(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function pn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Nt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function uS(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function fS(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function c0(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function zt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function R8(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function Ya(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function O8(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function kt(t,e){var n=e[0],r=e[1],a=e[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Ve(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ut(t,e,n){var r=e[0],a=e[1],i=e[2],s=n[0],o=n[1],c=n[2];return t[0]=a*c-i*o,t[1]=i*s-r*c,t[2]=r*o-a*s,t}function Re(t,e,n){var r=e[0],a=e[1],i=e[2],s=n[3]*r+n[7]*a+n[11]*i+n[15];return s=s||1,t[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/s,t[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/s,t[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/s,t}function Oc(t,e,n){var r=e[0],a=e[1],i=e[2];return t[0]=r*n[0]+a*n[3]+i*n[6],t[1]=r*n[1]+a*n[4]+i*n[7],t[2]=r*n[2]+a*n[5]+i*n[8],t}function M8(t,e){var n=t[0],r=t[1],a=t[2],i=e[0],s=e[1],o=e[2],c=Math.sqrt(n*n+r*r+a*a),l=Math.sqrt(i*i+s*s+o*o),f=c*l,u=f&&Ve(t,e)/f;return Math.acos(Math.min(Math.max(u,-1),1))}function gS(t){return t[0]=0,t[1]=0,t[2]=0,t}function cd(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ld(t,e){var n=t[0],r=t[1],a=t[2],i=e[0],s=e[1],o=e[2];return Math.abs(n-i)<=Te*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=Te*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-o)<=Te*Math.max(1,Math.abs(a),Math.abs(o))}var jt=Nt,pS=uS,D8=ua;(function(){var t=ne();return function(e,n,r,a,i,s){var o,c;for(n||(n=3),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function dS(){var t=new et(4);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function hS(t,e,n,r){var a=new et(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function ud(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function mS(t,e){var n=e[0],r=e[1],a=e[2],i=e[3],s=n*n+r*r+a*a+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=r*s,t[2]=a*s,t[3]=i*s,t}function za(t,e,n){var r=e[0],a=e[1],i=e[2],s=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*s,t[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*s,t[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*s,t[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*s,t}(function(){var t=dS();return function(e,n,r,a,i,s){var o,c;for(n||(n=4),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function oi(){var t=new et(4);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Dg(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function vS(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>Te?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function fd(t,e,n){var r=e[0],a=e[1],i=e[2],s=e[3],o=n[0],c=n[1],l=n[2],f=n[3];return t[0]=r*f+s*o+a*l-i*c,t[1]=a*f+s*c+i*o-r*l,t[2]=i*f+s*l+r*c-a*o,t[3]=s*f-r*o-a*c-i*l,t}function Mc(t,e,n,r){var a=e[0],i=e[1],s=e[2],o=e[3],c=n[0],l=n[1],f=n[2],u=n[3],g,p,h,d,m;return p=a*c+i*l+s*f+o*u,p<0&&(p=-p,c=-c,l=-l,f=-f,u=-u),1-p>Te?(g=Math.acos(p),h=Math.sin(g),d=Math.sin((1-r)*g)/h,m=Math.sin(r*g)/h):(d=1-r,m=r),t[0]=d*a+m*c,t[1]=d*i+m*l,t[2]=d*s+m*f,t[3]=d*o+m*u,t}function yS(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function CS(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var i=(a+1)%3,s=(a+2)%3;r=Math.sqrt(e[a*3+a]-e[i*3+i]-e[s*3+s]+1),t[a]=.5*r,r=.5/r,t[3]=(e[i*3+s]-e[s*3+i])*r,t[i]=(e[i*3+a]+e[a*3+i])*r,t[s]=(e[s*3+a]+e[a*3+s])*r}return t}var gd=hS,V8=mS;(function(){var t=ne(),e=Qe(1,0,0),n=Qe(0,1,0);return function(r,a,i){var s=Ve(a,i);return s<-.999999?(ut(t,e,a),D8(t)<1e-6&&ut(t,n,a),kt(t,t),Dg(r,t,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ut(t,a,i),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+s,V8(r,r))}})();(function(){var t=oi(),e=oi();return function(n,r,a,i,s,o){return Mc(t,r,s,o),Mc(e,a,i,o),Mc(n,t,e,2*o*(1-o)),n}})();(function(){var t=Tg();return function(e,n,r,a){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],V8(e,CS(e,t))}})();function L8(){var t=new et(2);return et!=Float32Array&&(t[0]=0,t[1]=0),t}function pd(t,e){var n=new et(2);return n[0]=t,n[1]=e,n}function Vg(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Cl(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function dd(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}var Tl=Cl;(function(){var t=L8();return function(e,n,r,a,i,s){var o,c;for(n||(n=2),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],i(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}})();class _8{constructor(e,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numberOfComponents=1,this.defaultValue=0,this.pixelDataConstructor=Uint8Array,this.get=a=>{const i=a%this.jMultiple,s=(a-i)/this.jMultiple,o=this.getRLE(i,s);return(o==null?void 0:o.value)||this.defaultValue},this.getRun=(a,i)=>{const s=a+i*this.height;return this.rows.get(s)},this.set=(a,i)=>{if(i===void 0)throw new Error(`Can't set undefined at ${a%this.width}`);const s=a%this.width,o=(a-s)/this.width,c=this.rows.get(o);if(!c){this.rows.set(o,[{start:s,end:s+1,value:i}]);return}const l=this.findIndex(c,s),f=c[l],u=c[l-1];if(!f){if(!u||u.value!==i||u.end!==s){c[l]={start:s,end:s+1,value:i};return}u.end++;return}const{start:g,end:p,value:h}=f;if(i===h&&s>=g)return;const d={start:s,end:s+1,value:i},m=s>g,v=m?l+1:l,C=m?f:u;let y=m?c[l+1]:f;if((C==null?void 0:C.value)===i&&C.end===s){C.end++,(y==null?void 0:y.value)===i&&y.start===s+1?(C.end=y.end,c.splice(l,1)):(y==null?void 0:y.start)===s&&(y.start++,y.start===y.end&&(c.splice(l,1),y=c[l],(y==null?void 0:y.start)===s+1&&y.value===i&&(C.end=y.end,c.splice(l,1))));return}if((y==null?void 0:y.value)===i&&y.start===s+1){y.start--,(C==null?void 0:C.end)>s&&(C.end=s,C.end===C.start&&c.splice(l,1));return}if((y==null?void 0:y.start)===s&&y.end===s+1){y.value=i;const T=c[l+1];(T==null?void 0:T.start)==s+1&&(T==null?void 0:T.value)===i&&(c.splice(l+1,1),y.end=T.end);return}s===(y==null?void 0:y.start)&&y.start++,m&&p>s+1?c.splice(v,0,d,{start:s+1,end:C.end,value:C.value}):c.splice(v,0,d),(C==null?void 0:C.end)>s&&(C.end=s)},this.width=e,this.height=n,this.depth=r,this.jMultiple=e,this.kMultiple=this.jMultiple*n}getRLE(e,n,r=0){const a=this.rows.get(n+r*this.height);if(!a)return;const i=this.findIndex(a,e),s=a[i];return e>=(s==null?void 0:s.start)?s:void 0}findIndex(e,n){for(let r=0;r<e.length;r++){const{end:a}=e[r];if(n<a)return r}return e.length}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numberOfComponents);const{width:r,height:a,numberOfComponents:i}=this;for(let s=0;s<a;s++){const o=this.getRun(s,e);if(o)if(i===1)for(const c of o){const l=s*r,{start:f,end:u,value:g}=c;for(let p=f;p<u;p++)n[l+p]=g}else for(const c of o){const l=s*r*i,{start:f,end:u,value:g}=c;for(let p=f;p<u;p+=i)for(let h=0;h<i;h++)n[l+p+h]=g[h]}}return n}}function N8(t,e,n){return Math.abs(t-e)<=n}function TS(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!N8(t[r],e[r],n))return!1;return!0}function hd(t){return typeof t=="number"}function md(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function yt(t,e,n=1e-5){return typeof t!=typeof e||t===null||e===null?!1:hd(t)&&hd(e)?N8(t,e,n):md(t)&&md(e)?TS(t,e,n):!1}const I8=t=>typeof t=="number"?-t:t!=null&&t.map?t.map(I8):!t,z1=t=>typeof t=="number"?Math.abs(t):t!=null&&t.map?t.map(z1):t,F8=(t,e,n=void 0)=>yt(t,I8(e),n),xS=(t,e,n=void 0)=>yt(z1(t),z1(e),n),SS=5*1024;class Ke{constructor(e,n,r){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.numberOfComponents=1,this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(a,i,s)=>{const o=this.toIndex([a,i,s]);return this._get(o)},this.setAtIJK=(a,i,s,o)=>{const c=this.toIndex([a,i,s]),l=this._set(c,o);return l!==!1&&(this.modifiedSlices.add(s),Ke.addBounds(this.boundsIJK,[a,i,s])),l},this.getAtIJKPoint=([a,i,s])=>this.getAtIJK(a,i,s),this.setAtIJKPoint=([a,i,s],o)=>{this.setAtIJK(a,i,s,o)},this.getAtIndex=a=>this._get(a),this.setAtIndex=(a,i)=>{const s=this._set(a,i);if(s!==!1){const o=this.toIJK(a);this.modifiedSlices.add(o[2]),Ke.addBounds(this.boundsIJK,o)}return s},this.getMiddleSliceData=()=>{const a=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:a,slicePlane:2})},this.forEach=(a,i={})=>{const s=i.boundsIJK||this.getBoundsIJK(),o=i.isInObject||this.isInObject||(()=>!0),c=i.returnPoints||!1,l=i.imageData,f=Math.min(s[0][0],s[0][1]),u=Math.max(s[0][0],s[0][1]),g=Math.min(s[1][0],s[1][1]),p=Math.max(s[1][0],s[1][1]),h=Math.min(s[2][0],s[2][1]),d=Math.max(s[2][0],s[2][1]),m=[];if(l){const{imageData:v}=i,C=v.getDirection(),y=C.slice(0,3),T=C.slice(3,6),x=C.slice(6,9),S=v.getSpacing(),[w,E,L]=S,R=Qe(f,g,h),D=v.indexToWorld(R),I=Qe(y[0]*w,y[1]*w,y[2]*w),b=Qe(T[0]*E,T[1]*E,T[2]*E),F=Qe(x[0]*L,x[1]*L,x[2]*L),W=Zi(D);for(let P=h;P<=d;P++){const K=Zi(W);for(let U=g;U<=p;U++){const N=Zi(W);for(let k=f;k<=u;k++){const z=[k,U,P];if(o(W,z)){const j=this.toIndex(z),$=this._get(j);c&&m.push({value:$,index:j,pointIJK:z,pointLPS:W.slice()}),a&&a({value:$,index:j,pointIJK:z,pointLPS:W})}pn(W,W,I)}jo(W,N),pn(W,W,b)}jo(W,K),pn(W,W,F)}return m}if(this.map){for(const v of this.map.keys()){const C=this.toIJK(v);if(!o(null,C))continue;const y=this._get(v);c&&m.push({value:y,index:v,pointIJK:C,pointLPS:null}),a({value:y,index:v,pointIJK:C,pointLPS:null})}return m}else{for(let v=h;v<=d;v++){const C=v*this.frameSize;for(let y=g;y<=p;y++){const T=C+y*this.width;for(let x=f,S=T+x;x<=u;x++,S++){const w=this.getAtIndex(S),E=[x,y,v];o(null,E)&&(c&&m.push({value:w,index:S,pointIJK:E,pointLPS:null}),a({value:w,index:S,pointIJK:[x,y,v],pointLPS:null}))}}}return m}},this.getSliceData=({sliceIndex:a,slicePlane:i})=>{const[s,o,c]=this.dimensions,l=s*o,f=a*l;let u;const g=this.getConstructor();function p(d){return typeof d=="function"}if(!p(g))return new Uint8Array(0);let h;switch(i){case 0:u=o*c,h=new g(u);for(let d=0;d<o;d++)for(let m=0;m<c;m++){const v=a+d*s+m*l;this.setSliceDataValue(h,d*c+m,this._get(v))}break;case 1:u=s*c,h=new g(u);for(let d=0;d<s;d++)for(let m=0;m<c;m++){const v=d+a*s+m*l;this.setSliceDataValue(h,d+m*s,this._get(v))}break;case 2:u=s*o,h=new g(u);for(let d=0;d<u;d++)this.setSliceDataValue(h,d,this._get(f+d));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return h},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=n,this._set=r}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}getScalarData(){if(this.scalarData)return this.scalarData;if(this._getScalarData)return this._getScalarData();throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clear(){var e;this.map&&this.map.clear(),this.boundsIJK.map(n=>{n[0]=1/0,n[1]=-1/0}),this.modifiedSlices.clear(),(e=this.points)==null||e.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}static addBounds(e,n){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(n[0],e[0][0]),e[0][1]=Math.max(n[0],e[0][1]),e[1][0]=Math.min(n[1],e[1][0]),e[1][1]=Math.max(n[1],e[1][1]),e[2][0]=Math.min(n[2],e[2][0]),e[2][1]=Math.max(n[2],e[2][1])}addPoint(e){const n=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,n,r){if(Array.isArray(r))for(let a=0;a<r.length;a++)e[n*r.length+a]=this.toNumber(r[a]);else e[n]=this.toNumber(r)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=3}){const a=new Ke(e,i=>(i*=r,[n[i++],n[i++],n[i++]]),(i,s)=>{i*=3;const o=!yt(n[i],s);return n[i++]=s[0],n[i++]=s[1],n[i++]=s[2],o});return a.numberOfComponents=r,a.scalarData=n,a}static createImageVolumeVoxelManager({dimensions:e,imageIds:n,numberOfComponents:r=1}){const a=e[0]*e[1];function i(l){const f=Math.floor(l/a),u=n[f];if(!u)return console.warn(`ImageId not found for sliceIndex: ${f}`),{pixelData:null,pixelIndex:null};const g=ie.getImage(u);if(!g)return console.warn(`Image not found for imageId: ${u}`),{pixelData:null,pixelIndex:null};const p=g.voxelManager.getScalarData(),h=l%a*r;return{pixelData:p,pixelIndex:h}}function s(l){const{pixelData:f,pixelIndex:u}=i(l);return!f||u===null?null:r===1?f[u]:[f[u],f[u+1],f[u+2]]}function o(l,f){const{pixelData:u,pixelIndex:g}=i(l);if(!u||g===null)return!1;let p=!1;if(r===1)u[g]!==f&&(u[g]=f,p=!0);else{const h=f;for(let d=0;d<r;d++)u[g+d]!==h[d]&&(u[g+d]=h[d],p=!0)}return p}const c=new Ke(e,l=>s(l),(l,f)=>o(l,f));return c.numberOfComponents=r,c._getConstructor=()=>{const l=i(0);return l.pixelData?l.pixelData.constructor:null},c.getMiddleSliceData=()=>{const l=Math.floor(e[2]/2);return c.getSliceData({sliceIndex:l,slicePlane:2})},c.getRange=()=>{let l=1/0,f=-1/0;for(const u of n){const g=ie.getImage(u);g.minPixelValue<l&&(l=g.minPixelValue),g.maxPixelValue>f&&(f=g.maxPixelValue)}return[l,f]},c._getScalarDataLength=()=>{const{pixelData:l}=i(0);return l.length*e[2]},c.getCompleteScalarDataArray=()=>{const l=c._getConstructor();if(!l)return new Uint8Array(0);const f=c.getScalarDataLength(),u=new l(f),g=e[0]*e[1]*r;for(let p=0;p<e[2];p++){const{pixelData:h}=i(p*g/r);if(h){const d=p*g;if(r===1)u.set(h,d);else for(let m=0;m<h.length;m+=r)for(let v=0;v<r;v++)u[d+m+v]=h[m+v]}}return u},c.setCompleteScalarDataArray=l=>{const f=e[0]*e[1]*r,u=c._getConstructor();let g=1/0,p=-1/0;for(let h=0;h<e[2];h++){const{pixelData:d}=i(h*f/r);if(d&&u){const m=h*f,v=m+f,C=new u(f);C.set(l.subarray(m,v)),d.set(C);for(let x=0;x<C.length;x++){const S=C[x];g=Math.min(g,S),p=Math.max(p,S)}const y=n[h],T=ie.getImage(y);T&&(T.minPixelValue=g,T.maxPixelValue=p)}}for(let h=0;h<e[2];h++)c.modifiedSlices.add(h);c.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},c}static createScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=1}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/e[0]/e[1]/e[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?Ke._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r}):Ke._createNumberVolumeVoxelManager({dimensions:e,scalarData:n})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:n,timePoint:r=0,numberOfComponents:a=1}){if(!a){const o=ie.getImage(e[0][0]);if(!o)throw new Error("Unable to determine number of components: No image found");if(a=o.getPixelData().length/(n[0]*n[1]),a>4||a<1||a===2)throw new Error(`Number of components ${a} must be 1, 3 or 4`)}const i=e.map(o=>Ke.createImageVolumeVoxelManager({dimensions:n,imageIds:o,numberOfComponents:a})),s=new Ke(n,o=>i[r]._get(o),(o,c)=>i[r]._set(o,c));return s.numberOfComponents=a,s.getScalarDataLength=()=>i[r].getScalarDataLength(),s.getConstructor=()=>i[r].getConstructor(),s.getRange=()=>i[r].getRange(),s.getMiddleSliceData=()=>i[r].getMiddleSliceData(),s.setTimePoint=o=>{r=o,s._get=c=>i[r]._get(c),s._set=(c,l)=>i[r]._set(c,l)},s.getAtIndexAndTimePoint=(o,c)=>i[c]._get(o),s.getTimePointScalarData=o=>i[o].getCompleteScalarDataArray(),s.getTimePointScalarData=o=>i[o].getCompleteScalarDataArray(),s.getCurrentTimePointScalarData=()=>i[r].getCompleteScalarDataArray(),s}static createImageVoxelManager({width:e,height:n,scalarData:r,numberOfComponents:a=1}){const i=[e,n,1];if(!a&&(a=r.length/e/n,a>4||a<1||a===2))throw new Error(`Number of components ${a} must be 1, 3 or 4`);return a>1?Ke._createRGBScalarVolumeVoxelManager({dimensions:i,scalarData:r,numberOfComponents:a}):Ke._createNumberVolumeVoxelManager({dimensions:i,scalarData:r})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:n}){const r=new Ke(e,a=>n[a],(a,i)=>{const s=n[a]!==i;return n[a]=i,s});return r.scalarData=n,r.getMiddleSliceData=()=>{const a=Math.floor(e[2]/2);return r.getSliceData({sliceIndex:a,slicePlane:2})},r}static createMapVoxelManager({dimension:e}){const n=new Map,r=new Ke(e,n.get.bind(n),(a,i)=>n.set(a,i)&&!0);return r.map=n,r}static createHistoryVoxelManager({sourceVoxelManager:e}){const n=new Map,{dimensions:r}=e,a=new Ke(r,i=>n.get(i),function(i,s){if(n.has(i))s===n.get(i)&&n.delete(i);else{const o=this.sourceVoxelManager.getAtIndex(i);if(o===s)return!1;n.set(i,o)}this.sourceVoxelManager.setAtIndex(i,s)});return a.map=n,a.scalarData=e.scalarData,a.sourceVoxelManager=e,a}static createLazyVoxelManager({dimensions:e,planeFactory:n}){const r=new Map,[a,i]=e,s=a*i,o=new Ke(e,c=>r.get(Math.floor(c/s))[c%s],(c,l)=>{const f=Math.floor(c/s);let u=r.get(f);return u||(u=n(a,i),r.set(f,u)),u[c%s]=l,!0});return o.map=r,o}static createRLEVoxelManager({dimensions:e}){const[n,r,a]=e,i=new _8(n,r,a),s=new Ke(e,o=>i.get(o),(o,c)=>(i.set(o,c),!0));return s.map=i,s.getPixelData=i.getPixelData.bind(i),s}static addInstanceToImage(e){const{width:n,height:r}=e,a=e.voxelManager.getScalarData();if(a.length>=n*r){e.voxelManager=Ke.createScalarVolumeVoxelManager({dimensions:[n,r,1],scalarData:a});return}e.voxelManager=Ke.createRLEVoxelManager({dimensions:[n,r,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=SS}}class Lg{constructor(e){this.numRequests={[se.Interaction]:0,[se.Thumbnail]:0,[se.Prefetch]:0,[se.Compute]:0},this.id=e||_r(),this.requestPool={[se.Interaction]:{0:[]},[se.Thumbnail]:{0:[]},[se.Prefetch]:{0:[]},[se.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[se.Interaction]:0,[se.Thumbnail]:0,[se.Prefetch]:0,[se.Compute]:0},this.maxNumRequests={[se.Interaction]:6,[se.Thumbnail]:6,[se.Prefetch]:5,[se.Compute]:1e3}}setMaxSimultaneousRequests(e,n){this.maxNumRequests[e]=n}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,a=0){const i={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][a]===void 0&&(this.requestPool[n][a]=[]),this.requestPool[n][a].push(i),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(a=>{r[a]=r[a].filter(i=>e(i))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let a=0;a<n;a++){const i=this.getNextRequest(e);if(i===null)return!1;if(i){this.numRequests[e]++,this.awake=!0;let s;try{s=i.requestFn()}catch(o){console.warn("sendRequest failed",o)}s!=null&&s.finally?s.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(se.Interaction),n=this.sendRequests(se.Thumbnail),r=this.sendRequests(se.Prefetch),a=this.sendRequests(se.Compute);!e&&!n&&!r&&!a&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort((r,a)=>r-a)}getRequestPool(){return this.requestPool}}const or=new Lg("imageLoadPool");or.grabDelay=0;or.setMaxSimultaneousRequests(se.Interaction,1e3);or.setMaxSimultaneousRequests(se.Thumbnail,1e3);or.setMaxSimultaneousRequests(se.Prefetch,1e3);const k8={};let wS;function U8(t,e){const n=ie.getImageLoadObject(t);if(n)return vd(n.promise,t),n;const r=t.split(":")[0],a=k8[r]||wS;if(!a)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${r}'`);const i=a(t,e);return vd(i.promise,t),i}function vd(t,e){Promise.resolve(t).then(n=>{ES(n),Q(de,X.IMAGE_LOADED,{image:n})}).catch(n=>{const r={imageId:e,error:n};Q(de,X.IMAGE_LOAD_FAILED,r)})}function ES(t){if(!t.voxelManager){const{width:e,height:n,numberOfComponents:r}=t,a=Ke.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:n,numberOfComponents:r});t.voxelManager=a,t.getPixelData=()=>a.getScalarData(),delete t.imageFrame.pixelData}}function RS(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return U8(t,e).promise}function ci(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=U8(t,e);return ie.getImageLoadObject(t)||ie.putImageLoadObject(t,n),n.promise}function Dc(t,e){k8[t]=e}const yd={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},Xe={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(Xe);const Ir=.001;function P8(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&P8(r)}return Object.freeze(t)}const OS={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},$a=P8(OS),MS=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],Gs={},Ho={get:t=>Gs[t],set:t=>{const e=t.id;Gs[e]=t},delete:t=>delete Gs[t],getAll:()=>{const e=Object.keys(Gs).map(n=>Gs[n]);return e.sort((n,r)=>n.id[0]==="_"&&r.id[0]!=="_"?1:n.id[0]!=="_"&&r.id[0]==="_"?-1:0),e}};var DS=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,a,i;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(a=r;a--!==0;)if(!t(e[a],n[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(n).length)return!1;for(a=r;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[a]))return!1;for(a=r;a--!==0;){var s=i[a];if(!t(e[s],n[s]))return!1}return!0}return e!==e&&n!==n};const b8=Yl(DS);var Cd=Object.prototype.toString,G8=function(e){var n=Cd.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Cd.call(e.callee)==="[object Function]"),r},hf,Td;function VS(){if(Td)return hf;Td=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=G8,a=Object.prototype.propertyIsEnumerable,i=!a.call({toString:null},"toString"),s=a.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(g){var p=g.constructor;return p&&p.prototype===g},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var g in window)try{if(!l["$"+g]&&e.call(window,g)&&window[g]!==null&&typeof window[g]=="object")try{c(window[g])}catch{return!0}}catch{return!0}return!1}(),u=function(g){if(typeof window>"u"||!f)return c(g);try{return c(g)}catch{return!1}};t=function(p){var h=p!==null&&typeof p=="object",d=n.call(p)==="[object Function]",m=r(p),v=h&&n.call(p)==="[object String]",C=[];if(!h&&!d&&!m)throw new TypeError("Object.keys called on a non-object");var y=s&&d;if(v&&p.length>0&&!e.call(p,0))for(var T=0;T<p.length;++T)C.push(String(T));if(m&&p.length>0)for(var x=0;x<p.length;++x)C.push(String(x));else for(var S in p)!(y&&S==="prototype")&&e.call(p,S)&&C.push(String(S));if(i)for(var w=u(p),E=0;E<o.length;++E)!(w&&o[E]==="constructor")&&e.call(p,o[E])&&C.push(o[E]);return C}}return hf=t,hf}var LS=Array.prototype.slice,_S=G8,xd=Object.keys,Vc=xd?function(e){return xd(e)}:VS(),Sd=Object.keys;Vc.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return _S(r)?Sd(LS.call(r)):Sd(r)})}else Object.keys=Vc;return Object.keys||Vc};var NS=Vc,IS=Error,FS=EvalError,kS=RangeError,US=ReferenceError,B8=SyntaxError,A8=TypeError,PS=URIError,bS=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var a=42;e[n]=a;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,n);if(s.value!==a||s.enumerable!==!0)return!1}return!0},wd=typeof Symbol<"u"&&Symbol,GS=bS,BS=function(){return typeof wd!="function"||typeof Symbol!="function"||typeof wd("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:GS()},mf={__proto__:null,foo:{}},AS=Object,WS=function(){return{__proto__:mf}.foo===mf.foo&&!(mf instanceof AS)},zS="Function.prototype.bind called on incompatible ",$S=Object.prototype.toString,jS=Math.max,HS="[object Function]",Ed=function(e,n){for(var r=[],a=0;a<e.length;a+=1)r[a]=e[a];for(var i=0;i<n.length;i+=1)r[i+e.length]=n[i];return r},KS=function(e,n){for(var r=[],a=n,i=0;a<e.length;a+=1,i+=1)r[i]=e[a];return r},qS=function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n},XS=function(e){var n=this;if(typeof n!="function"||$S.apply(n)!==HS)throw new TypeError(zS+n);for(var r=KS(arguments,1),a,i=function(){if(this instanceof a){var f=n.apply(this,Ed(r,arguments));return Object(f)===f?f:this}return n.apply(e,Ed(r,arguments))},s=jS(0,n.length-r.length),o=[],c=0;c<s;c++)o[c]="$"+c;if(a=Function("binder","return function ("+qS(o,",")+"){ return binder.apply(this,arguments); }")(i),n.prototype){var l=function(){};l.prototype=n.prototype,a.prototype=new l,l.prototype=null}return a},YS=XS,W8=Function.prototype.bind||YS,ZS=Function.prototype.call,QS=Object.prototype.hasOwnProperty,JS=W8,ew=JS.call(ZS,QS),ye,tw=IS,nw=FS,rw=kS,aw=US,gs=B8,Qi=A8,iw=PS,z8=Function,vf=function(t){try{return z8('"use strict"; return ('+t+").constructor;")()}catch{}},Za=Object.getOwnPropertyDescriptor;if(Za)try{Za({},"")}catch{Za=null}var yf=function(){throw new Qi},sw=Za?function(){try{return arguments.callee,yf}catch{try{return Za(arguments,"callee").get}catch{return yf}}}():yf,vi=BS(),ow=WS(),mt=Object.getPrototypeOf||(ow?function(t){return t.__proto__}:null),Ri={},cw=typeof Uint8Array>"u"||!mt?ye:mt(Uint8Array),Qa={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?ye:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?ye:ArrayBuffer,"%ArrayIteratorPrototype%":vi&&mt?mt([][Symbol.iterator]()):ye,"%AsyncFromSyncIteratorPrototype%":ye,"%AsyncFunction%":Ri,"%AsyncGenerator%":Ri,"%AsyncGeneratorFunction%":Ri,"%AsyncIteratorPrototype%":Ri,"%Atomics%":typeof Atomics>"u"?ye:Atomics,"%BigInt%":typeof BigInt>"u"?ye:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?ye:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?ye:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?ye:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":tw,"%eval%":eval,"%EvalError%":nw,"%Float32Array%":typeof Float32Array>"u"?ye:Float32Array,"%Float64Array%":typeof Float64Array>"u"?ye:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?ye:FinalizationRegistry,"%Function%":z8,"%GeneratorFunction%":Ri,"%Int8Array%":typeof Int8Array>"u"?ye:Int8Array,"%Int16Array%":typeof Int16Array>"u"?ye:Int16Array,"%Int32Array%":typeof Int32Array>"u"?ye:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":vi&&mt?mt(mt([][Symbol.iterator]())):ye,"%JSON%":typeof JSON=="object"?JSON:ye,"%Map%":typeof Map>"u"?ye:Map,"%MapIteratorPrototype%":typeof Map>"u"||!vi||!mt?ye:mt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?ye:Promise,"%Proxy%":typeof Proxy>"u"?ye:Proxy,"%RangeError%":rw,"%ReferenceError%":aw,"%Reflect%":typeof Reflect>"u"?ye:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?ye:Set,"%SetIteratorPrototype%":typeof Set>"u"||!vi||!mt?ye:mt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?ye:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":vi&&mt?mt(""[Symbol.iterator]()):ye,"%Symbol%":vi?Symbol:ye,"%SyntaxError%":gs,"%ThrowTypeError%":sw,"%TypedArray%":cw,"%TypeError%":Qi,"%Uint8Array%":typeof Uint8Array>"u"?ye:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?ye:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?ye:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?ye:Uint32Array,"%URIError%":iw,"%WeakMap%":typeof WeakMap>"u"?ye:WeakMap,"%WeakRef%":typeof WeakRef>"u"?ye:WeakRef,"%WeakSet%":typeof WeakSet>"u"?ye:WeakSet};if(mt)try{null.error}catch(t){var lw=mt(mt(t));Qa["%Error.prototype%"]=lw}var uw=function t(e){var n;if(e==="%AsyncFunction%")n=vf("async function () {}");else if(e==="%GeneratorFunction%")n=vf("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=vf("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var a=t("%AsyncGenerator%");a&&mt&&(n=mt(a.prototype))}return Qa[e]=n,n},Rd={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},l0=W8,xl=ew,fw=l0.call(Function.call,Array.prototype.concat),gw=l0.call(Function.apply,Array.prototype.splice),Od=l0.call(Function.call,String.prototype.replace),Sl=l0.call(Function.call,String.prototype.slice),pw=l0.call(Function.call,RegExp.prototype.exec),dw=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,hw=/\\(\\)?/g,mw=function(e){var n=Sl(e,0,1),r=Sl(e,-1);if(n==="%"&&r!=="%")throw new gs("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new gs("invalid intrinsic syntax, expected opening `%`");var a=[];return Od(e,dw,function(i,s,o,c){a[a.length]=o?Od(c,hw,"$1"):s||i}),a},vw=function(e,n){var r=e,a;if(xl(Rd,r)&&(a=Rd[r],r="%"+a[0]+"%"),xl(Qa,r)){var i=Qa[r];if(i===Ri&&(i=uw(r)),typeof i>"u"&&!n)throw new Qi("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:a,name:r,value:i}}throw new gs("intrinsic "+e+" does not exist!")},$8=function(e,n){if(typeof e!="string"||e.length===0)throw new Qi("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Qi('"allowMissing" argument must be a boolean');if(pw(/^%?[^%]*%?$/,e)===null)throw new gs("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=mw(e),a=r.length>0?r[0]:"",i=vw("%"+a+"%",n),s=i.name,o=i.value,c=!1,l=i.alias;l&&(a=l[0],gw(r,fw([0,1],l)));for(var f=1,u=!0;f<r.length;f+=1){var g=r[f],p=Sl(g,0,1),h=Sl(g,-1);if((p==='"'||p==="'"||p==="`"||h==='"'||h==="'"||h==="`")&&p!==h)throw new gs("property names with quotes must have matching quotes");if((g==="constructor"||!u)&&(c=!0),a+="."+g,s="%"+a+"%",xl(Qa,s))o=Qa[s];else if(o!=null){if(!(g in o)){if(!n)throw new Qi("base intrinsic for "+e+" exists, but the property is not available.");return}if(Za&&f+1>=r.length){var d=Za(o,g);u=!!d,u&&"get"in d&&!("originalValue"in d.get)?o=d.get:o=o[g]}else u=xl(o,g),o=o[g];u&&!c&&(Qa[s]=o)}}return o},yw=$8,Lc=yw("%Object.defineProperty%",!0)||!1;if(Lc)try{Lc({},"a",{value:1})}catch{Lc=!1}var j8=Lc,Cw=$8,_c=Cw("%Object.getOwnPropertyDescriptor%",!0);if(_c)try{_c([],"length")}catch{_c=null}var Tw=_c,Md=j8,xw=B8,yi=A8,Dd=Tw,Sw=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new yi("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new yi("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new yi("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new yi("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new yi("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new yi("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,o=arguments.length>6?arguments[6]:!1,c=!!Dd&&Dd(e,n);if(Md)Md(e,n,{configurable:s===null&&c?c.configurable:!s,enumerable:a===null&&c?c.enumerable:!a,value:r,writable:i===null&&c?c.writable:!i});else if(o||!a&&!i&&!s)e[n]=r;else throw new xw("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},$1=j8,H8=function(){return!!$1};H8.hasArrayLengthDefineBug=function(){if(!$1)return null;try{return $1([],"length",{value:1}).length!==1}catch{return!0}};var ww=H8,Ew=NS,Rw=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Ow=Object.prototype.toString,Mw=Array.prototype.concat,Vd=Sw,Dw=function(t){return typeof t=="function"&&Ow.call(t)==="[object Function]"},K8=ww(),Vw=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!Dw(r)||!r())return}K8?Vd(t,e,n,!0):Vd(t,e,n)},q8=function(t,e){var n=arguments.length>2?arguments[2]:{},r=Ew(e);Rw&&(r=Mw.call(r,Object.getOwnPropertySymbols(e)));for(var a=0;a<r.length;a+=1)Vw(t,r[a],e[r[a]],n[r[a]])};q8.supportsDescriptors=!!K8;var X8=q8,Nc={exports:{}};typeof self<"u"?Nc.exports=self:typeof window<"u"?Nc.exports=window:Nc.exports=Function("return this")();var Y8=Nc.exports,Lw=Y8,Z8=function(){return typeof cn!="object"||!cn||cn.Math!==Math||cn.Array!==Array?Lw:cn},_w=X8,Nw=Z8,Iw=function(){var e=Nw();if(_w.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},Fw=X8,kw=Y8,Q8=Z8,Uw=Iw,Pw=Q8(),J8=function(){return Pw};Fw(J8,{getPolyfill:Q8,implementation:kw,shim:Uw});var bw=J8;const Gw=Yl(bw),Pn=Gw(),e9={vtkObject:()=>null};function Gn(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Pn.console&&Pn.console.error&&Pn.console.error("Invalid VTK object"),null;const e=e9[t.vtkClass];if(!e)return Pn.console&&Pn.console.error&&Pn.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(a=>{n[a]&&typeof n[a]=="object"&&n[a].vtkClass&&(n[a]=Gn(n[a]))});const r=e(n);return r&&r.modified&&r.modified(),r}function Bw(t,e){e9[t]=e}Gn.register=Bw;class Cf extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let j1=0;const t9=Symbol("void");function Aw(){return j1}const n9={};function Ua(){}const Ww=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];Ww.forEach(t=>{n9[t]=Ua});Pn.console=console.hasOwnProperty("log")?console:n9;const pa={debug:Ua,error:Pn.console.error||Ua,info:Pn.console.info||Ua,log:Pn.console.log||Ua,warn:Pn.console.warn||Ua};function r9(t,e){pa[t]&&(pa[t]=e||Ua)}function a9(){pa.log(...arguments)}function i9(){pa.info(...arguments)}function wl(){pa.debug(...arguments)}function fe(){pa.error(...arguments)}function hu(){pa.warn(...arguments)}const Ld={};function s9(t){Ld[t]||(pa.error(t),Ld[t]=!0)}const Pt=Object.create(null);Pt.Float32Array=Float32Array;Pt.Float64Array=Float64Array;Pt.Uint8Array=Uint8Array;Pt.Int8Array=Int8Array;Pt.Uint16Array=Uint16Array;Pt.Int16Array=Int16Array;Pt.Uint32Array=Uint32Array;Pt.Int32Array=Int32Array;Pt.Uint8ClampedArray=Uint8ClampedArray;try{Pt.BigInt64Array=BigInt64Array,Pt.BigUint64Array=BigUint64Array}catch{}function Ss(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(Pt[t]||Float64Array)(...n)}function mu(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(Pt[t]||Float64Array).from(...n)}function vu(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Je(t){return vu(t[0]==="_"?t.slice(1):t)}function o9(t){return t.charAt(0).toLowerCase()+t.slice(1)}function c9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let a=Number(t),i="B";for(;a>n;)a/=n,i=r.pop();return`${a.toFixed(e)} ${i}`}function l9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function u9(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function zw(t){return Object.values(Pt).some(e=>t instanceof e)}function $w(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function jw(t,e){return Object.keys(t).find(n=>t[n]===e)}function f9(t){return t&&t.isA?t.getState():t}function _g(t){setTimeout(t,0)}function g9(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function Ue(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};u9(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++j1),!("classHierarchy"in e))e.classHierarchy=new Cf("vtkObject");else if(!(e.classHierarchy instanceof Cf)){const i=new Cf;for(let s=0;s<e.classHierarchy.length;s++)i.push(e.classHierarchy[s]);e.classHierarchy=i}function r(i){n[i]=null}function a(i){function s(){r(i)}return Object.freeze({unsubscribe:s})}return t.isDeleted=()=>!!e.deleted,t.modified=i=>{if(e.deleted){fe("instance deleted - cannot call any method");return}i&&i<t.getMTime()||(e.mtime=++j1,n.forEach(s=>s&&s(t)))},t.onModified=i=>{if(e.deleted)return fe("instance deleted - cannot call any method"),null;const s=n.length;return n.push(i),a(s)},t.getMTime=()=>e.mtime,t.isA=i=>{let s=e.classHierarchy.length;for(;s--;)if(e.classHierarchy[s]===i)return!0;return!1},t.getClassName=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-i]},t.set=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(i).forEach(l=>{const f=o?null:t[`set${vu(l)}`];f&&Array.isArray(i[l])&&f.length>1?c=f(...i[l])||c:f?c=f(i[l])||c:(["mtime"].indexOf(l)===-1&&!s&&hu(`Warning: Set value to model directly ${l}, ${i[l]}`),c=e[l]!==i[l]||c,e[l]=i[l])}),c},t.get=function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];if(!s.length)return e;const c={};return s.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=i=>e[i],t.delete=()=>{Object.keys(e).forEach(i=>delete e[i]),n.forEach((i,s)=>r(s)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const i={...e,vtkClass:t.getClassName()};Object.keys(i).forEach(o=>{i[o]===null||i[o]===void 0||o[0]==="_"?delete i[o]:i[o].isA?i[o]=i[o].getState():Array.isArray(i[o])?i[o]=i[o].map(f9):zw(i[o])&&(i[o]=Array.from(i[o]))});const s={};return Object.keys(i).sort().forEach(o=>{s[o]=i[o]}),s.mtime&&delete s.mtime,s},t.shallowCopy=function(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(i.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${i.getClassName()} into ${t.getClassName()}`);const o=i.get(),c=Object.keys(e).sort();Object.keys(o).sort().forEach(f=>{const u=c.indexOf(f);u===-1?s&&wl(`add ${f} in shallowCopy`):c.splice(u,1),e[f]=o[f]}),c.length&&s&&wl(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const Hw={object(t,e,n){return function(){return{...e[n.name]}}}};function Xt(t,e,n){n.forEach(r=>{if(typeof r=="object"){const a=Hw[r.type];a?t[`get${Je(r.name)}`]=a(t,e,r):t[`get${Je(r.name)}`]=()=>e[r.name]}else t[`get${Je(r)}`]=()=>e[r]})}const p9={enum(t,e,n){const r=`_on${Je(n.name)}Changed`;return a=>{var i;if(typeof a=="string"){if(n.enum[a]!==void 0)return e[n.name]!==n.enum[a]?(e[n.name]=n.enum[a],t.modified(),!0):!1;throw fe(`Set Enum with invalid argument ${n}, ${a}`),new RangeError("Set Enum with invalid string argument")}if(typeof a=="number"){if(e[n.name]!==a){if(Object.keys(n.enum).map(s=>n.enum[s]).indexOf(a)!==-1){const s=e[n.name];return e[n.name]=a,(i=e[r])==null||i.call(e,t,e,a,s),t.modified(),!0}throw fe(`Set Enum outside numeric range ${n}, ${a}`),new RangeError("Set Enum outside numeric range")}return!1}throw fe(`Set Enum with invalid argument (String/Number) ${n}, ${a}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){var a;((a=n.params)==null?void 0:a.length)===1&&hu('Setter of type "object" with a single "param" field is not supported');const r=`_on${Je(n.name)}Changed`;return function(){var l,f;for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];let c;if(s.length>1&&((l=n.params)!=null&&l.length)?c=n.params.reduce((u,g,p)=>Object.assign(u,{[g]:s[p]}),{}):c=s[0],!b8(e[n.name],c)){const u=e[n.name];return e[n.name]=c,(f=e[r])==null||f.call(e,t,e,c,u),t.modified(),!0}return!1}}};function _d(t){if(typeof t=="object"){const e=p9[t.type];if(e)return(n,r)=>e(n,r,t);throw fe(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const a=`_on${Je(t)}Changed`;return function(s){var o;if(r.deleted)return fe("instance deleted - cannot call any method"),!1;if(r[t]!==s){const c=r[t.name];return r[t]=s,(o=r[a])==null||o.call(r,n,r,s,c),n.modified(),!0}return!1}}}function u0(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${Je(r.name)}`]=_d(r)(t,e):t[`set${Je(r)}`]=_d(r)(t,e)})}function ft(t,e,n){Xt(t,e,n),u0(t,e,n)}function ws(t,e,n){n.forEach(r=>{t[`get${Je(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${Je(r)}ByReference`]=()=>e[r]})}function Ng(t,e,n,r){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(i=>{if(e[i]&&r&&e[i].length!==r)throw new RangeError(`Invalid initial number of values for array (${i})`);const s=`_on${Je(i)}Changed`;t[`set${Je(i)}`]=function(){var p;if(e.deleted)return fe("instance deleted - cannot call any method"),!1;for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];let f=c,u,g=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],g=!0),f==null)u=e[i]!==f;else{if(r&&f.length!==r)if(f.length<r&&a!==void 0)for(f=Array.from(f),g=!1;f.length<r;)f.push(a);else throw new RangeError(`Invalid number of values for array setter (${i})`);u=e[i]==null||e[i].length!==f.length;for(let h=0;!u&&h<f.length;++h)u=e[i][h]!==f[h];u&&g&&(f=Array.from(f))}if(u){const h=e[i.name];e[i]=f,(p=e[s])==null||p.call(e,t,e,f,h),t.modified()}return u},t[`set${Je(i)}From`]=o=>{const c=e[i];o.forEach((l,f)=>{c[f]=l})}})}function Ig(t,e,n,r){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;ws(t,e,n),Ng(t,e,n,r,a)}function f0(t,e,n){for(let r=0;r<n.length;r++){const a=n[r];e[a]!==void 0&&(e[`_${a}`]=e[a],delete e[a])}}function Fg(t,e,n,r){e.inputData?e.inputData=e.inputData.map(Gn):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Gn):e.inputConnection=[],e.output?e.output=e.output.map(Gn):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Gn):e.inputArrayToProcess=[],e.numberOfInputs=n;function a(p){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){fe("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){fe(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[h]!==p||e.inputConnection[h])&&(e.inputData[h]=p,e.inputConnection[h]=null,t.modified&&t.modified())}function i(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]&&(e.inputData[p]=e.inputConnection[p]()),e.inputData[p]}function s(p){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){fe("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){let d=`algorithm ${t.getClassName()} only has `;d+=`${e.numberOfInputs}`,d+=" input ports. To add more input ports, use addInputConnection()",fe(d);return}e.inputData[h]=null,e.inputConnection[h]=p}function o(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]}function c(){let p=e.numberOfInputs;for(;p&&!e.inputData[p-1]&&!e.inputConnection[p-1];)p--;return p===e.numberOfInputs&&e.numberOfInputs++,p}function l(p){if(e.deleted){fe("instance deleted - cannot call any method");return}s(p,c())}function f(p){if(e.deleted){fe("instance deleted - cannot call any method");return}a(p,c())}function u(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(fe("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[p])}t.shouldUpdate=()=>{var m,v;const p=t.getMTime();let h=1/0,d=r;for(;d--;){if(!e.output[d]||e.output[d].isDeleted())return!0;const C=e.output[d].getMTime();if(C<p)return!0;C<h&&(h=C)}for(d=e.numberOfInputs;d--;)if((m=e.inputConnection[d])!=null&&m.filter.shouldUpdate()||((v=t.getInputData(d))==null?void 0:v.getMTime())>h)return!0;return!1};function g(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const h=()=>u(p);return h.filter=t,h}if(e.numberOfInputs){let p=e.numberOfInputs;for(;p--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=s,t.addInputData=f,t.addInputConnection=l,t.getInputData=i,t.getInputConnection=o}r&&(t.getOutputData=u,t.getOutputPort=g),t.update=()=>{const p=[];if(e.numberOfInputs){let h=0;for(;h<e.numberOfInputs;)p[h]=t.getInputData(h),h++}t.shouldUpdate()&&t.requestData&&t.requestData(p,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=p=>{const h=e.inputArrayToProcess[p],d=e.inputData[p];return h&&d?d[`get${h.fieldAssociation}`]().getArray(h.arrayName):null},t.setInputArrayToProcess=function(p,h,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<p;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[p]={arrayName:h,fieldAssociation:d,attributeType:m}}}const kg=Symbol("Event abort");function d9(t,e,n){const r=[],a=t.delete;let i=1;function s(l){for(let f=0;f<r.length;++f){const[u]=r[f];if(u===l){r.splice(f,1);return}}}function o(l){function f(){s(l)}return Object.freeze({unsubscribe:f})}function c(){if(e.deleted){fe("instance deleted - cannot call any method");return}const l=r.slice();for(let f=0;f<l.length;++f){const[,u,g]=l[f];if(u){if(g<0)setTimeout(()=>u.apply(t,arguments),1-g);else if(u.apply(t,arguments)===kg)break}}}t[`invoke${Je(n)}`]=c,t[`on${Je(n)}`]=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return fe("instance deleted - cannot call any method"),null;const u=i++;return r.push([u,l,f]),r.sort((g,p)=>p[2]-g[2]),o(u)},t.delete=()=>{a(),r.forEach(l=>{let[f]=l;return s(f)})}}function Le(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={},i={};return t(i,a,r),Object.freeze(i)};return e&&Gn.register(e,n),n}function g0(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e.filter(s=>!!s).map(s=>s(...a))}}function Ug(t){return t&&t.isA&&t.isA("vtkObject")}function El(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Ug(t)){if(r.indexOf(t)>=0)return n;r.push(t);const a=e(t);a!==void 0&&n.push(a);const i=t.get();Object.keys(i).forEach(s=>{const o=i[s];Array.isArray(o)?o.forEach(c=>{El(c,e,n,r)}):El(o,e,n,r)})}return n}function h9(t,e,n){var r=this;let a;const i=function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];const l=r,f=()=>{a=null,n||t.apply(l,o)},u=n&&!a;clearTimeout(a),a=setTimeout(f,e),u&&t.apply(l,o)};return i.cancel=()=>clearTimeout(a),i}function m9(t,e){let n=!1,r=null;function a(){n=!1,r!==null&&(i(...r),r=null)}function i(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];if(n){r=o;return}n=!0,t(...o),setTimeout(a,e)}return i}function Pg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,a)=>{e.keystore[r]=a},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let Kw=1;const $0="__root__";function v9(t,e){Pg(t,e);const n=t.delete;e.proxyId=`${Kw++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),Xt(t,e,["proxyId","proxyGroup","proxyName"]),ft(t,e,["proxyManager"]);const r={},a={};function i(l,f){a[f]||(a[f]=[]);const u=a[f];for(let g=0;g<l.length;g++)u.push(l[g].name),r[l[g].name]=l[g],l[g].children&&l[g].children.length&&i(l[g].children,l[g].name)}i(e.ui,$0),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(r).forEach(f=>delete r[f]),Object.keys(a).forEach(f=>delete a[f]),i(e.ui,$0),t.modified()};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$0;return a[l]}t.updateProxyProperty=(l,f)=>{const u=r[l];u?Object.assign(u,f):r[l]={...f}},t.activate=()=>{if(e.proxyManager){const l=`setActive${Je(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,f)=>{f in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[f]=[]),e.propertyLinkSubscribers[f].push(l)},t.gcPropertyLinks=l=>{const f=e.propertyLinkSubscribers[l]||[];for(;f.length;)f.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let u=null;const g=[];let p=0,h=!1;function d(T){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(h)return null;const S=[];let w=null;for(p=g.length;p--;){const L=g[p];L.instance===T?w=L:S.push(L)}if(!w)return null;const E=w.instance[`get${Je(w.propertyName)}`]();if(!$w(E,u)||x){for(u=E,h=!0;S.length;){const L=S.pop();L.instance.set({[L.propertyName]:u})}h=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=E),E}function m(T,x){const S=[];for(p=g.length;p--;){const w=g[p];w.instance===T&&(w.propertyName===x||x===void 0)&&(w.subscription.unsubscribe(),S.push(p))}for(;S.length;)g.splice(S.pop(),1)}function v(T,x){let S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const w=T.onModified(d),E=g[0];return g.push({instance:T,propertyName:x,subscription:w}),S&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?T.set({[x]:e.propertyLinkMap[l].value}):E&&d(E.instance,!0)),{unsubscribe:()=>m(T,x)}}function C(){for(;g.length;)g.pop().subscription.unsubscribe()}const y={bind:v,unbind:m,unsubscribe:C,persistent:f};return e.propertyLinkMap[l]=y,y};function o(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$0;const f=[],u=e.proxyId,g=s(l)||[];for(let p=0;p<g.length;p++){const h=g[p],d=t[`get${Je(h)}`],m=d?d():void 0,v={id:u,name:h,value:m},C=o(h);C.length&&(v.children=C),f.push(v)}return f}t.listPropertyNames=()=>o().map(l=>l.name),t.getPropertyByName=l=>o().find(f=>f.name===l),t.getPropertyDomainByName=l=>(r[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let f=l.length;for(;f--;)e.propertyLinkMap[l[f]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:f,property:u,persistent:g,updateOnBind:p,type:h}=e.links[l];if(h==="application"){const d=e.proxyManager.getPropertyLink(f,g);t.registerPropertyLinkForGC(d,"application"),d.bind(t,u,p)}}}_g(c)}function y9(t,e,n){const r=t.delete,a=[],i=Object.keys(n);let s=i.length;for(;s--;){const o=i[s],{modelKey:c,property:l,modified:f=!0}=n[o],u=Je(l),g=Je(o);t[`get${g}`]=e[c][`get${u}`],t[`set${g}`]=e[c][`set${u}`],f&&a.push(e[c].onModified(t.modified))}t.delete=()=>{for(;a.length;)a.pop().unsubscribe();r()}}function C9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(o){const c=Object.keys(o);let l=c.length;for(;l--;){const f=c[l];e[f].set(o[f])}}const i=Object.keys(r);let s=i.length;for(;s--;){const o=i[s];e[o]=r[o];const c=n[o];t[`set${Je(o)}`]=l=>{if(l!==e[o]){e[o]=l;const f=c[l];a(f),t.modified()}}}i.length&&Xt(t,e,i)}const Nd=10,Id=40,Fd=800;function T9(t){let e=0,n=0,r=0,a=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*Nd,a=n*Nd,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||a)&&t.deltaMode&&(t.deltaMode===1?(r*=Id,a*=Id):(r*=Fd,a*=Fd)),r&&!e&&(e=r<1?-1:1),a&&!n&&(n=a<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:a||r}}var O={algo:Fg,capitalize:vu,chain:g0,debounce:h9,enumToString:jw,event:d9,EVENT_ABORT:kg,formatBytesToProperUnit:c9,formatNumbersWithThousandSeparator:l9,get:Xt,getArray:ws,getCurrentGlobalMTime:Aw,getStateArrayMapFunc:f9,isVtkObject:Ug,keystore:Pg,measurePromiseExecution:g9,moveToProtected:f0,newInstance:Le,newTypedArray:Ss,newTypedArrayFrom:mu,normalizeWheel:T9,obj:Ue,proxy:v9,proxyPropertyMapping:y9,proxyPropertyState:C9,safeArrays:u9,set:u0,setArray:Ng,setGet:ft,setGetArray:Ig,setImmediate:_g,setLoggerFunction:r9,throttle:m9,traverseInstanceTree:El,TYPED_ARRAYS:Pt,uncapitalize:o9,VOID:t9,vtkDebugMacro:wl,vtkErrorMacro:fe,vtkInfoMacro:i9,vtkLogMacro:a9,vtkOnceErrorMacro:s9,vtkWarningMacro:hu,objectSetterMap:p9},bt=Object.freeze({__proto__:null,VOID:t9,setLoggerFunction:r9,vtkLogMacro:a9,vtkInfoMacro:i9,vtkDebugMacro:wl,vtkErrorMacro:fe,vtkWarningMacro:hu,vtkOnceErrorMacro:s9,TYPED_ARRAYS:Pt,newTypedArray:Ss,newTypedArrayFrom:mu,capitalize:vu,_capitalize:Je,uncapitalize:o9,formatBytesToProperUnit:c9,formatNumbersWithThousandSeparator:l9,setImmediateVTK:_g,measurePromiseExecution:g9,obj:Ue,get:Xt,set:u0,setGet:ft,getArray:ws,setArray:Ng,setGetArray:Ig,moveToProtected:f0,algo:Fg,EVENT_ABORT:kg,event:d9,newInstance:Le,chain:g0,isVtkObject:Ug,traverseInstanceTree:El,debounce:h9,throttle:m9,keystore:Pg,proxy:v9,proxyPropertyMapping:y9,proxyPropertyState:C9,normalizeWheel:T9,default:O});const qw={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ce={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},Xw=ce.FLOAT;var x9={DefaultDataType:Xw,DataTypeByteSize:qw,VtkDataTypes:ce};const Yw="WebGL",Rl=Object.create(null);function S9(t,e){Rl[t]=e}function Zw(){return Object.keys(Rl)}function w9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Rl[t]&&Rl[t](e)}function Qw(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return w9(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const a=r.getViewProps(),i=e._views[0].getViewNodeFor(r);a.forEach(s=>{if(s.getVisibility()){n.propCount+=1;const o=s.getMapper&&s.getMapper();if(o&&o.getPrimitiveCount){const c=i.getViewNodeFor(o);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const l=o.getPrimitiveCount();Object.keys(l).forEach(f=>{n[f]||(n[f]=0),n[f]+=l[f]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return O.setImmediate(t.render),e._views.map(a=>a.captureNextImage?a.captureNextImage(n,r):void 0).filter(a=>!!a)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(a=>a===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const Jw={defaultViewAPI:Yw,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function E9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jw,n),O.obj(t,e),O.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),O.get(t,e,["neverRendered"]),O.getArray(t,e,["renderers","childRenderWindows"]),O.moveToProtected(t,e,["views"]),O.event(t,e,"completion"),Qw(t,e)}const eE=O.newInstance(E9,"vtkRenderWindow");var tE={newInstance:eE,extend:E9,registerViewConstructor:S9,listViewAPIs:Zw,newAPISpecificView:w9};const Ko={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},ee={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var R9={Wrap:Ko,Filter:ee};const O9=new Float32Array(1),nE=new Int32Array(O9.buffer);function rE(t){O9[0]=t;const e=nE[0];let n=e>>16&32768,r=e>>12&2047;const a=e>>23&255;return a<103?n:a>142?(n|=31744,n|=(a===255?0:1)&&e&8388607,n):a<113?(r|=2048,n|=(r>>114-a)+(r>>113-a&1),n):(n|=a-112<<10|r>>1,n+=r&1,n)}function aE(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var Oi={fromHalf:aE,toHalf:rE},bg={exports:{}};bg.exports;(function(t){(function(e,n,r){function a(c){var l=this,f=o();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(c),l.s0<0&&(l.s0+=1),l.s1-=f(c),l.s1<0&&(l.s1+=1),l.s2-=f(c),l.s2<0&&(l.s2+=1),f=null}function i(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function s(c,l){var f=new a(c),u=l&&l.state,g=f.next;return g.int32=function(){return f.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,u&&(typeof u=="object"&&i(u,f),g.state=function(){return i(f,{})}),g}function o(){var c=4022871197,l=function(f){f=String(f);for(var u=0;u<f.length;u++){c+=f.charCodeAt(u);var g=.02519603282416938*c;c=g>>>0,g-=c,g*=c,c=g>>>0,g-=c,c+=g*4294967296}return(c>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=s:this.alea=s})(cn,t)})(bg);var iE=bg.exports,Gg={exports:{}};Gg.exports;(function(t){(function(e,n,r){function a(o){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var u=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^u^u>>>8},o===(o|0)?c.x=o:l+=o;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,c.next()}function i(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c}function s(o,c){var l=new a(o),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,p=(l.next()>>>0)/4294967296,h=(g+p)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&i(f,l),u.state=function(){return i(l,{})}),u}n&&n.exports?n.exports=s:this.xor128=s})(cn,t)})(Gg);var sE=Gg.exports,Bg={exports:{}};Bg.exports;(function(t){(function(e,n,r){function a(o){var c=this,l="";c.next=function(){var u=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(u^u<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,o===(o|0)?c.x=o:l+=o;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,f==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function i(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c.v=o.v,c.d=o.d,c}function s(o,c){var l=new a(o),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,p=(l.next()>>>0)/4294967296,h=(g+p)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&i(f,l),u.state=function(){return i(l,{})}),u}n&&n.exports?n.exports=s:this.xorwow=s})(cn,t)})(Bg);var oE=Bg.exports,Ag={exports:{}};Ag.exports;(function(t){(function(e,n,r){function a(o){var c=this;c.next=function(){var f=c.x,u=c.i,g,p;return g=f[u],g^=g>>>7,p=g^g<<24,g=f[u+1&7],p^=g^g>>>10,g=f[u+3&7],p^=g^g>>>3,g=f[u+4&7],p^=g^g<<7,g=f[u+7&7],g=g^g<<13,p^=g^g<<9,f[u]=p,c.i=u+1&7,p};function l(f,u){var g,p=[];if(u===(u|0))p[0]=u;else for(u=""+u,g=0;g<u.length;++g)p[g&7]=p[g&7]<<15^u.charCodeAt(g)+p[g+1&7]<<13;for(;p.length<8;)p.push(0);for(g=0;g<8&&p[g]===0;++g);for(g==8?p[7]=-1:p[g],f.x=p,f.i=0,g=256;g>0;--g)f.next()}l(c,o)}function i(o,c){return c.x=o.x.slice(),c.i=o.i,c}function s(o,c){o==null&&(o=+new Date);var l=new a(o),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,p=(l.next()>>>0)/4294967296,h=(g+p)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(f.x&&i(f,l),u.state=function(){return i(l,{})}),u}n&&n.exports?n.exports=s:this.xorshift7=s})(cn,t)})(Ag);var cE=Ag.exports,Wg={exports:{}};Wg.exports;(function(t){(function(e,n,r){function a(o){var c=this;c.next=function(){var f=c.w,u=c.X,g=c.i,p,h;return c.w=f=f+1640531527|0,h=u[g+34&127],p=u[g=g+1&127],h^=h<<13,p^=p<<17,h^=h>>>15,p^=p>>>12,h=u[g]=h^p,c.i=g,h+(f^f>>>16)|0};function l(f,u){var g,p,h,d,m,v=[],C=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,C=Math.max(C,u.length)),h=0,d=-32;d<C;++d)u&&(p^=u.charCodeAt((d+32)%u.length)),d===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,d>=0&&(m=m+1640531527|0,g=v[d&127]^=p+m,h=g==0?h+1:0);for(h>=128&&(v[(u&&u.length||0)&127]=-1),h=127,d=4*128;d>0;--d)p=v[h+34&127],g=v[h=h+1&127],p^=p<<13,g^=g<<17,p^=p>>>15,g^=g>>>12,v[h]=p^g;f.w=m,f.X=v,f.i=h}l(c,o)}function i(o,c){return c.i=o.i,c.w=o.w,c.X=o.X.slice(),c}function s(o,c){o==null&&(o=+new Date);var l=new a(o),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,p=(l.next()>>>0)/4294967296,h=(g+p)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(f.X&&i(f,l),u.state=function(){return i(l,{})}),u}n&&n.exports?n.exports=s:this.xor4096=s})(cn,t)})(Wg);var lE=Wg.exports,zg={exports:{}};zg.exports;(function(t){(function(e,n,r){function a(o){var c=this,l="";c.next=function(){var u=c.b,g=c.c,p=c.d,h=c.a;return u=u<<25^u>>>7^g,g=g-p|0,p=p<<24^p>>>8^h,h=h-u|0,c.b=u=u<<20^u>>>12^g,c.c=g=g-p|0,c.d=p<<16^g>>>16^h,c.a=h-u|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,o===Math.floor(o)?(c.a=o/4294967296|0,c.b=o|0):l+=o;for(var f=0;f<l.length+20;f++)c.b^=l.charCodeAt(f)|0,c.next()}function i(o,c){return c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c}function s(o,c){var l=new a(o),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,p=(l.next()>>>0)/4294967296,h=(g+p)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&i(f,l),u.state=function(){return i(l,{})}),u}n&&n.exports?n.exports=s:this.tychei=s})(cn,t)})(zg);var uE=zg.exports,M9={exports:{}};const fE={},gE=Object.freeze(Object.defineProperty({__proto__:null,default:fE},Symbol.toStringTag,{value:"Module"})),D9=Dy(gE);(function(t){(function(e,n,r){var a=256,i=6,s=52,o="random",c=r.pow(a,i),l=r.pow(2,s),f=l*2,u=a-1,g;function p(T,x,S){var w=[];x=x==!0?{entropy:!0}:x||{};var E=v(m(x.entropy?[T,y(n)]:T??C(),3),w),L=new h(w),R=function(){for(var D=L.g(i),I=c,b=0;D<l;)D=(D+b)*a,I*=a,b=L.g(1);for(;D>=f;)D/=2,I/=2,b>>>=1;return(D+b)/I};return R.int32=function(){return L.g(4)|0},R.quick=function(){return L.g(4)/4294967296},R.double=R,v(y(L.S),n),(x.pass||S||function(D,I,b,F){return F&&(F.S&&d(F,L),D.state=function(){return d(L,{})}),b?(r[o]=D,I):D})(R,E,"global"in x?x.global:this==r,x.state)}function h(T){var x,S=T.length,w=this,E=0,L=w.i=w.j=0,R=w.S=[];for(S||(T=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[L=u&L+T[E%S]+(x=R[E])],R[L]=x;(w.g=function(D){for(var I,b=0,F=w.i,W=w.j,P=w.S;D--;)I=P[F=u&F+1],b=b*a+P[u&(P[F]=P[W=u&W+I])+(P[W]=I)];return w.i=F,w.j=W,b})(a)}function d(T,x){return x.i=T.i,x.j=T.j,x.S=T.S.slice(),x}function m(T,x){var S=[],w=typeof T,E;if(x&&w=="object")for(E in T)try{S.push(m(T[E],x-1))}catch{}return S.length?S:w=="string"?T:T+"\0"}function v(T,x){for(var S=T+"",w,E=0;E<S.length;)x[u&E]=u&(w^=x[u&E]*19)+S.charCodeAt(E++);return y(x)}function C(){try{var T;return g&&(T=g.randomBytes)?T=T(a):(T=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(T)),y(T)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,y(n)]}}function y(T){return String.fromCharCode.apply(0,T)}if(v(r.random(),n),t.exports){t.exports=p;try{g=D9}catch{}}else r["seed"+o]=p})(typeof self<"u"?self:cn,[],Math)})(M9);var pE=M9.exports,dE=iE,hE=sE,mE=oE,vE=cE,yE=lE,CE=uE,hi=pE;hi.alea=dE;hi.xor128=hE;hi.xorwow=mE;hi.xorshift7=vE;hi.xor4096=yE;hi.tychei=CE;var TE=hi;const xE=Yl(TE),$g=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],SE=[1,0,0,0,1,0,0,0,1],jg=1e-6,Hg=1e-12,{vtkErrorMacro:V9,vtkWarningMacro:li}=O;let L9=0;const kd=20;function p0(t){return()=>V9(`vtkMath::${t} - NOT IMPLEMENTED`)}function ho(t,e,n,r){let a;for(let i=0;i<e;i++)a=t[n*e+i],t[n*e+i]=t[r*e+i],t[r*e+i]=a}function Zs(t,e,n,r){let a;for(let i=0;i<e;i++)a=t[i*e+n],t[i*e+n]=t[i*e+r],t[i*e+r]=a}function Ie(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const wE=()=>Math.PI;function We(t){return t/180*Math.PI}function Ol(t){return t*180/Math.PI}const{round:EE,floor:Kg,ceil:RE,min:OE,max:ME}=Math;function DE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let a=e,i=t.length;a<i;a+=n)t[a]<r&&(r=t[a]);return r}function VE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let a=e,i=t.length;a<i;a+=n)r<t[a]&&(r=t[a]);return r}function LE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,a=-1/0;for(let i=e,s=t.length;i<s;i+=n)t[i]<r&&(r=t[i]),a<t[i]&&(a=t[i]);return[r,a]}const _E=p0("ceilLog2"),NE=p0("factorial");function Kr(t){let e=1;for(;e<t;)e*=2;return e}function Qs(t){return t===Kr(t)}function IE(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function FE(t,e){if(t<e)return 0;const n=Ie(e);for(let r=0;r<e;++r)n[r]=r;return n}function kE(t,e,n){let r=0;for(let a=e-1;a>=0;--a)if(n[a]<t-e+a){let i=n[a]+1;for(;a<e;)n[a++]=i++;r=1;break}return r}function UE(t){xE(`${t}`,{global:!0}),L9=t}function PE(){return L9}function bE(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const GE=p0("gaussian");function Ml(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Rr(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function _9(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function N9(t,e){return t[0]*=e,t[1]*=e,t}function H1(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function BE(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function oe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function AE(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function cr(t,e,n){const r=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],i=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=a,n[2]=i,n}function ta(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function ui(t){const e=ta(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function WE(t,e,n,r){const a=t[0]*t[0],i=t[1]*t[1],s=t[2]*t[2],o=Math.sqrt(a+i+s);let c,l,f;a>i&&a>s?(c=0,l=1,f=2):i>s?(c=1,l=2,f=0):(c=2,l=0,f=1);const u=t[c]/o,g=t[l]/o,p=t[f]/o,h=Math.sqrt(u*u+p*p);if(r!==0){const d=Math.sin(r),m=Math.cos(r);e&&(e[c]=(p*m-u*g*d)/h,e[l]=d*h,e[f]=(-(u*m)-g*p*d)/h),n&&(n[c]=(-(p*d)-u*g*m)/h,n[l]=m*h,n[f]=(u*d-g*p*m)/h)}else e&&(e[c]=p/h,e[l]=0,e[f]=-u/h),n&&(n[c]=-u*g/h,n[l]=h,n[f]=-g*p/h)}function zE(t,e,n){const r=oe(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const a=oe(t,e)/r;for(let i=0;i<3;i++)n[i]=e[i];return _9(n,a),!0}function K1(t,e){return t[0]*e[0]+t[1]*e[1]}function $E(t,e,n){const r=K1(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const a=K1(t,e)/r;for(let i=0;i<2;i++)n[i]=e[i];return N9(n,a),!0}function er(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function jE(t,e){const n=[0,0,0];return cr(t,e,n),Math.atan2(ta(n),oe(t,e))}function HE(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function KE(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function qE(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function I9(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function XE(t){const e=I9(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function ze(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function YE(t,e){let n,r,a;const i=[0,0,0];for(let s=0;s<3;s++)a=Math.abs(t[s*3]),(r=Math.abs(t[s*3+1]))>a&&(a=r),(r=Math.abs(t[s*3+2]))>a&&(a=r),i[s]=1/a;a=i[0]*Math.abs(t[0]),n=0,(r=i[1]*Math.abs(t[3]))>=a&&(a=r,n=1),(r=i[2]*Math.abs(t[6]))>=a&&(n=2),n!==0&&(ho(t,3,n,0),i[n]=i[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],a=i[1]*Math.abs(t[4]),n=1,(r=i[2]*Math.abs(t[7]))>=a&&(n=2,ho(t,3,1,2),i[2]=i[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function ZE(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function QE(t,e,n){const r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],l=t[6],f=t[7],u=t[8],g=+ze(o,f,c,u),p=-ze(s,l,c,u),h=+ze(s,l,o,f),d=-ze(a,f,i,u),m=+ze(r,l,i,u),v=-ze(r,l,a,f),C=+ze(a,o,i,c),y=-ze(r,s,i,c),T=+ze(r,s,a,o),x=r*g+a*p+i*h,S=g*e[0]+d*e[1]+C*e[2],w=p*e[0]+m*e[1]+y*e[2],E=h*e[0]+v*e[1]+T*e[2];n[0]=S/x,n[1]=w/x,n[2]=E/x}function Ic(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],a=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],i=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=a,n[2]=i}function q1(t,e,n){const r=[...t],a=[...e];for(let i=0;i<3;i++)n[i]=r[0]*a[i]+r[1]*a[i+3]+r[2]*a[i+6],n[i+3]=r[3]*a[i]+r[4]*a[i+3]+r[5]*a[i+6],n[i+6]=r[6]*a[i]+r[7]*a[i+3]+r[8]*a[i+6]}function JE(t,e,n,r,a,i,s){r!==a&&V9("Number of columns of A must match number of rows of B.");const o=[...t],c=[...e];for(let l=0;l<n;l++)for(let f=0;f<i;f++){s[l*i+f]=0;for(let u=0;u<r;u++)s[l*i+f]+=o[l*r+u]*c[f+i*u]}}function Ji(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function eR(t,e){const n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],l=t[7],f=t[8],u=+ze(s,l,o,f),g=-ze(i,c,o,f),p=+ze(i,c,s,l),h=-ze(r,l,a,f),d=+ze(n,c,a,f),m=-ze(n,c,r,l),v=+ze(r,s,a,o),C=-ze(n,i,a,o),y=+ze(n,i,r,s),T=n*u+r*g+a*p;T===0&&li("Matrix has 0 determinant"),e[0]=u/T,e[3]=g/T,e[6]=p/T,e[1]=h/T,e[4]=d/T,e[7]=m/T,e[2]=v/T,e[5]=C/T,e[8]=y/T}function yu(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function F9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:jg;if(t.length!==e.length)return!1;function r(a,i){return Math.abs(a-e[i])<=n}return t.every(r)}const d0=F9;function k9(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function U9(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function tR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jg;return d0(t,$g,e)}function nR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jg;return d0(t,SE,e)}function P9(t,e){const n=t[0]*t[0],r=t[0]*t[1],a=t[0]*t[2],i=t[0]*t[3],s=t[1]*t[1],o=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],f=t[1]*t[3],u=t[2]*t[3],g=s+o+c;let p=1/(n+g);const h=(n-g)*p;p*=2,e[0]=s*p+h,e[3]=(l+i)*p,e[6]=(f-a)*p,e[1]=(l-i)*p,e[4]=o*p+h,e[7]=(u+r)*p,e[2]=(f+a)*p,e[5]=(u-r)*p,e[8]=c*p+h}function Fc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function X1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=Fc(t[0],n),e[1]=Fc(t[1],n),e[2]=Fc(t[2],n),e}function h0(t,e,n,r){let a,i,s,o,c,l,f,u,g,p,h,d,m,v,C,y;const T=Ie(e),x=Ie(e),S=(E,L,R)=>{v=E[L],m=E[R],E[L]=v-d*(m+v*p),E[R]=m+d*(v-m*p)};for(U9(e,r),c=0;c<e;c++)T[c]=n[c]=t[c+c*e],x[c]=0;for(a=0;a<kd;a++){for(h=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)h+=Math.abs(t[c*e+o]);if(h===0)break;for(a<3?f=.2*h/(e*e):f=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)if(v=100*Math.abs(t[c*e+o]),a>3&&Math.abs(n[c])+v===Math.abs(n[c])&&Math.abs(n[o])+v===Math.abs(n[o]))t[c*e+o]=0;else if(Math.abs(t[c*e+o])>f){for(m=n[o]-n[c],Math.abs(m)+v===Math.abs(m)?g=t[c*e+o]/m:(u=.5*m/t[c*e+o],g=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(g=-g)),C=1/Math.sqrt(1+g*g),d=g*C,p=d/(1+C),m=g*t[c*e+o],x[c]-=m,x[o]+=m,n[c]-=m,n[o]+=m,t[c*e+o]=0,i=0;i<=c-1;i++)S(t,i*e+c,i*e+o);for(i=c+1;i<=o-1;i++)S(t,c*e+i,i*e+o);for(i=o+1;i<e;i++)S(t,c*e+i,o*e+i);for(i=0;i<e;i++)S(r,i*e+c,i*e+o)}for(c=0;c<e;c++)T[c]+=x[c],n[c]=T[c],x[c]=0}if(a>=kd)return li("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(i=0;i<e-1;i++){for(s=i,y=n[s],a=i+1;a<e;a++)(n[a]>=y||Math.abs(n[a]-y)<Hg)&&(s=a,y=n[s]);s!==i&&(n[s]=n[i],n[i]=y,Zs(r,e,i,s))}const w=(e>>1)+(e&1);for(l=0,a=0;a<e*e;a++)r[a]>=0&&l++;if(l<w)for(a=0;a<e;a++)r[a*e+i]*=-1;return 1}function b9(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0],i=[...n];h0(i,4,a,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function rR(t,e,n){const r=t[0]*e[0],a=t[0]*e[1],i=t[0]*e[2],s=t[0]*e[3],o=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],f=t[1]*e[3],u=t[2]*e[0],g=t[2]*e[1],p=t[2]*e[2],h=t[2]*e[3],d=t[3]*e[0],m=t[3]*e[1],v=t[3]*e[2],C=t[3]*e[3];n[0]=r-c-p-C,n[1]=a+o+h-v,n[2]=i-f+u+m,n[3]=s+l-g+d}function G9(t,e){for(let g=0;g<9;g++)e[g]=t[g];const n=Ie(3),r=Ie(3);let a;for(let g=0;g<3;g++){const p=Math.abs(e[g*3]),h=Math.abs(e[g*3+1]),d=Math.abs(e[g*3+2]);a=h>p?h:p,a=d>a?d:a,n[g]=1,a!==0&&(n[g]/=a)}const i=Math.abs(e[0])*n[0],s=Math.abs(e[3])*n[1],o=Math.abs(e[6])*n[2];r[0]=0,a=i,s>=a&&(a=s,r[0]=1),o>=a&&(r[0]=2),r[0]!==0&&(Zs(e,3,r[0],0),n[r[0]]=n[0]);const c=Math.abs(e[4])*n[1],l=Math.abs(e[7])*n[2];r[1]=1,a=c,l>=a&&(r[1]=2,Zs(e,3,1,2)),r[2]=2;let f=0;if(yu(e)<0){f=1;for(let g=0;g<9;g++)e[g]=-e[g]}const u=Ie(4);if(b9(e,u),P9(u,e),f)for(let g=0;g<9;g++)e[g]=-e[g];r[1]!==1&&Zs(e,3,r[1],1),r[0]!==0&&Zs(e,3,r[0],0)}function B9(t,e,n){let r,a,i,s,o,c;const l=[...t];if(h0(l,3,e,n),e[0]===e[1]&&e[0]===e[2]){k9(n);return}for(Ji(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r*3]),s=0,a=1;a<3;a++)c<(o=Math.abs(n[r*3+a]))&&(c=o,s=a);s!==r&&(o=e[s],e[s]=e[r],e[r]=o,ho(n,3,r,s)),n[s*3+s]<0&&(n[s*3]=-n[s*3],n[s*3+1]=-n[s*3+1],n[s*3+2]=-n[s*3+2]),a=(s+1)%3,i=(s+2)%3,n[a*3]=0,n[a*3+1]=0,n[a*3+2]=0,n[a*3+a]=1;const f=cr([n[s*3],n[s*3+1],n[s*3+2]],[n[a*3],n[a*3+1],n[a*3+2]],[]);ui(f);const u=cr(f,[n[s*3],n[s*3+1],n[s*3+2]],[]);for(let g=0;g<3;g++)n[i*3+g]=f[g],n[a*3+g]=u[g];Ji(n,n);return}for(c=Math.abs(n[0]),s=0,r=1;r<3;r++)c<(o=Math.abs(n[r*3]))&&(c=o,s=r);if(s!==0){const f=e[s];e[s]=e[0],e[0]=f,ho(n,3,s,0)}if(Math.abs(n[4])<Math.abs(n[7])){const f=e[2];e[2]=e[1],e[1]=f,ho(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);yu(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),Ji(n,n)}function aR(t,e,n,r){let a;const i=[...t],s=yu(i);if(s<0)for(a=0;a<9;a++)i[a]=-i[a];G9(i,e),Ji(i,i),q1(i,e,r),B9(r,n,r),q1(e,r,e),Ji(r,r),s<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function qg(t,e,n){let r,a,i,s,o=0,c,l,f;const u=Ie(n);for(r=0;r<n;r++){for(s=0,a=0;a<n;a++)(f=Math.abs(t[r*n+a]))>s&&(s=f);if(s===0)return li("Unable to factor linear system"),0;u[r]=1/s}for(a=0;a<n;a++){for(r=0;r<a;r++){for(c=t[r*n+a],i=0;i<r;i++)c-=t[r*n+i]*t[i*n+a];t[r*n+a]=c}for(s=0,r=a;r<n;r++){for(c=t[r*n+a],i=0;i<a;i++)c-=t[r*n+i]*t[i*n+a];t[r*n+a]=c,(l=u[r]*Math.abs(c))>=s&&(s=l,o=r)}if(a!==o){for(i=0;i<n;i++)l=t[o*n+i],t[o*n+i]=t[a*n+i],t[a*n+i]=l;u[o]=u[a]}if(e[a]=o,Math.abs(t[a*n+a])<=Hg)return li("Unable to factor linear system"),0;if(a!==n-1)for(l=1/t[a*n+a],r=a+1;r<n;r++)t[r*n+a]*=l}return 1}function Xg(t,e,n,r){let a,i,s,o,c;for(s=-1,a=0;a<r;a++){if(o=e[a],c=n[o],n[o]=n[a],s>=0)for(i=s;i<=a-1;i++)c-=t[a*r+i]*n[i];else c!==0&&(s=a);n[a]=c}for(a=r-1;a>=0;a--){for(c=n[a],i=a+1;i<r;i++)c-=t[a*r+i]*n[i];n[a]=c/t[a*r+a]}}function A9(t,e,n){if(n===2){const a=Ie(2),i=ze(t[0],t[1],t[2],t[3]);return i===0?0:(a[0]=(t[3]*e[0]-t[1]*e[1])/i,a[1]=(-(t[2]*e[0])+t[0]*e[1])/i,e[0]=a[0],e[1]=a[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=Ie(n);return qg(t,r,n)===0?0:(Xg(t,r,e,n),1)}function W9(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const i=r||Ie(n),s=a||Ie(n);if(qg(t,i,n)===0)return null;for(let o=0;o<n;o++){for(let c=0;c<n;c++)s[c]=0;s[o]=1,Xg(t,i,s,n);for(let c=0;c<n;c++)e[c*n+o]=s[c]}return e}function iR(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let a=0;a<e;a++)for(let i=a;i<e;i++)Math.abs(t[a*e+i])>r&&(r=Math.abs(t[a*e+i]));for(let a=0;a<e;a++)Math.abs(t[a*e+a])<n&&(n=Math.abs(t[a*e+a]));return n===0?Number.MAX_VALUE:r/n}function sR(t,e,n){return h0(t,3,e,n)}function Y1(t,e,n,r){if(t<n)return li("Insufficient number of samples. Underdetermined."),0;let a,i,s;const o=Ie(n*n),c=Ie(n),l=Ie(n*n);for(s=0;s<t;s++)for(a=0;a<n;a++)for(i=a;i<n;i++)o[a*n+i]+=e[s*n+a]*e[s*n+i];for(a=0;a<n;a++)for(i=0;i<a;i++)o[a*n+i]=o[i*n+a];for(h0(o,n,c,l),a=0;a<n;a++)r[a]=l[a*n+n-1];return 1}function oR(t,e,n,r,a,i){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<a)return li("Insufficient number of samples. Underdetermined."),0;const o=Ie(a);let c=1,l,f=0,u,g,p,h=0;if(s){for(g=0;g<a;g++)o[g]=1;for(u=0;u<t;u++)for(g=0;g<a;g++)Math.abs(r[u*a+g])>Hg&&(c=0,o[g]=0);if(c&&a===1)return li("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),Y1(t,e,n,i);if(c)h=1;else for(g=0;g<a;g++)o[g]&&(h=1)}h&&(l=Ie(n),f=Y1(t,e,n,l));const d=Ie(n*n),m=Ie(n*n),v=Ie(n*a);for(p=0;p<t;p++)for(u=0;u<n;u++){for(g=u;g<n;g++)d[u*n+g]+=e[p*n+u]*e[p*n+g];for(g=0;g<a;g++)v[u*a+g]+=e[p*n+u]*r[p*a+g]}for(u=0;u<n;u++)for(g=0;g<u;g++)d[u*n+g]=d[g*n+u];const C=W9(d,m,n);if(C)for(u=0;u<n;u++)for(g=0;g<a;g++)for(i[u*a+g]=0,p=0;p<n;p++)i[u*a+g]+=m[u*n+p]*v[p*a+g];if(h){for(g=0;g<a;g++)if(o[g])for(u=0;u<n;u++)i[u*a+g]=l[u*a]}return h?f&&C:C}function cR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function Js(t,e){let n,r;const[a,i,s]=t,o=1/3,c=1/6,l=2/3;let f=a,u=a;i>f?f=i:i<u&&(u=i),s>f?f=s:s<u&&(u=s);const g=f;g>0?r=(f-u)/f:r=0,r>0?(a===f?n=c*(i-s)/(f-u):i===f?n=o+c*(s-a)/(f-u):n=l+c*(a-i)/(f-u),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=g}function Pa(t,e){const[n,r,a]=t,i=1/3,s=1/6,o=2/3,c=5/6;let l,f,u;n>s&&n<=i?(f=1,l=(i-n)/s,u=0):n>i&&n<=.5?(f=1,u=(n-i)/s,l=0):n>.5&&n<=o?(u=1,f=(o-n)/s,l=0):n>o&&n<=c?(u=1,l=(n-o)/s,f=0):n>c&&n<=1?(l=1,u=(1-n)/s,f=0):(l=1,f=n/s,u=0),l=r*l+(1-r),f=r*f+(1-r),u=r*u+(1-r),l*=a,f*=a,u*=a,e[0]=l,e[1]=f,e[2]=u}function z9(t,e){const[n,r,a]=t;let i=(n+16)/116,s=r/500+i,o=i-a/200;i**3>.008856?i**=3:i=(i-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787;const c=.9505,l=1,f=1.089;e[0]=c*s,e[1]=l*i,e[2]=f*o}function $9(t,e){const[n,r,a]=t,i=.9505,s=1,o=1.089;let c=n/i,l=r/s,f=a/o;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,f>.008856?f**=1/3:f=7.787*f+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-f)}function j9(t,e){const[n,r,a]=t;let i=n*3.2406+r*-1.5372+a*-.4986,s=n*-.9689+r*1.8758+a*.0415,o=n*.0557+r*-.204+a*1.057;i>.0031308?i=1.055*i**(1/2.4)-.055:i*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92;let c=i;c<s&&(c=s),c<o&&(c=o),c>1&&(i/=c,s/=c,o/=c),i<0&&(i=0),s<0&&(s=0),o<0&&(o=0),e[0]=i,e[1]=s,e[2]=o}function H9(t,e){let[n,r,a]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,a>.04045?a=((a+.055)/1.055)**2.4:a/=12.92,e[0]=n*.4124+r*.3576+a*.1805,e[1]=n*.2126+r*.7152+a*.0722,e[2]=n*.0193+r*.1192+a*.9505}function ja(t,e){const n=[0,0,0];H9(t,n),$9(n,e)}function Dl(t,e){const n=[0,0,0];z9(t,n),j9(n,e)}function Es(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function kc(t){return!(t[1]-t[0]<0)}function lR(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function Bn(t,e,n){return t<e?e:t>n?n:t}function Z1(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=Bn(t[0],e[0],n[0]),r[1]=Bn(t[1],e[1],n[1]),r[2]=Bn(t[2],e[2],n[2]),r}function uR(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const fR=p0("GetScalarTypeFittingRange"),gR=p0("GetAdjustedScalarRange");function pR(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function dR(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function hR(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function mR(t,e,n,r){const a=Ie(3),i=Ie(3),s=Ie(3),o=Ie(3),c=Ie(3),l=Ie(3);for(let T=0;T<3;++T)a[T]=t[T]-e[T],i[T]=e[T]-n[T],s[T]=n[T]-t[T],o[T]=-a[T],c[T]=-i[T],l[T]=-s[T];const f=ta(o),u=ta(c),g=ta(s),p=Ie(3);cr(a,i,p);const h=ta(p),d=f*u*g/(2*h),m=2*h*h,v=u*u*oe(a,l)/m,C=g*g*oe(o,i)/m,y=f*f*oe(s,c)/m;for(let T=0;T<3;++T)r[T]=v*t[T]+C*e[T]+y*n[T];return d}const vR=1/0,yR=-1/0,K9=t=>!Number.isFinite(t),{isFinite:CR,isNaN:Q1}=Number,Vl=Q1;function da(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function TR(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const a=Math.abs(t[r]);a>e&&(n=r,e=a)}return n}function q9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let i=0;i<e;++i)n[i]=i,r[i]=i;for(let i=e-1;i>0;i--){let s=-1/0,o=0,c=0;for(let l=0;l<=i;++l){const f=n[l];for(let u=0;u<=i;++u){const g=r[u],p=Math.abs(t[f+e*g]);p>s&&(s=p,o=l,c=u)}}[n[i],n[o]]=[n[o],n[i]],[r[i],r[c]]=[r[c],r[i]]}const a=new Array(e*e).fill(0);for(let i=0;i<e;++i){const s=n[i]+e*r[i];a[s]=t[s]<0?-1:1}return a}function X9(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function xR(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(X9).join("")}`}function j0(t){return Math.round(t*255)}function SR(t){return t.length===3?`rgb(${t.map(j0).join(", ")})`:`rgba(${j0(t[0]||0)}, ${j0(t[1]||0)}, ${j0(t[2]||0)}, ${t[3]||0})`}var bn={Pi:wE,radiansFromDegrees:We,degreesFromRadians:Ol,round:EE,floor:Kg,ceil:RE,ceilLog2:_E,min:OE,max:ME,arrayMin:DE,arrayMax:VE,arrayRange:LE,isPowerOfTwo:Qs,nearestPowerOfTwo:Kr,factorial:NE,binomial:IE,beginCombination:FE,nextCombination:kE,randomSeed:UE,getSeed:PE,random:bE,gaussian:GE,add:Ml,subtract:Rr,multiplyScalar:_9,multiplyScalar2D:N9,multiplyAccumulate:H1,multiplyAccumulate2D:BE,dot:oe,outer:AE,cross:cr,norm:ta,normalize:ui,perpendiculars:WE,projectVector:zE,projectVector2D:$E,distance2BetweenPoints:er,angleBetweenVectors:jE,gaussianAmplitude:HE,gaussianWeight:KE,dot2D:K1,outer2D:qE,norm2D:I9,normalize2D:XE,determinant2x2:ze,LUFactor3x3:YE,LUSolve3x3:ZE,linearSolve3x3:QE,multiply3x3_vect3:Ic,multiply3x3_mat3:q1,multiplyMatrix:JE,transpose3x3:Ji,invert3x3:eR,identity3x3:k9,identity:U9,isIdentity:tR,isIdentity3x3:nR,determinant3x3:yu,quaternionToMatrix3x3:P9,areEquals:F9,areMatricesEqual:d0,roundNumber:Fc,roundVector:X1,matrix3x3ToQuaternion:b9,multiplyQuaternion:rR,orthogonalize3x3:G9,diagonalize3x3:B9,singularValueDecomposition3x3:aR,solveLinearSystem:A9,invertMatrix:W9,luFactorLinearSystem:qg,luSolveLinearSystem:Xg,estimateMatrixCondition:iR,jacobi:sR,jacobiN:h0,solveHomogeneousLeastSquares:Y1,solveLeastSquares:oR,hex2float:cR,rgb2hsv:Js,hsv2rgb:Pa,lab2xyz:z9,xyz2lab:$9,xyz2rgb:j9,rgb2xyz:H9,rgb2lab:ja,lab2rgb:Dl,uninitializeBounds:Es,areBoundsInitialized:kc,computeBoundsFromPoints:lR,clampValue:Bn,clampVector:Z1,clampAndNormalizeValue:uR,getScalarTypeFittingRange:fR,getAdjustedScalarRange:gR,extentIsWithinOtherExtent:pR,boundsIsWithinOtherBounds:dR,pointIsWithinBounds:hR,solve3PointCircle:mR,inf:vR,negInf:yR,isInf:K9,isNan:Q1,isNaN:Q1,isFinite:CR,createUninitializedBounds:da,getMajorAxisIndex:TR,getSparseOrthogonalMatrix:q9,floatToHex2:X9,floatRGB2HexCode:xR,float2CssRGBA:SR};const{vtkErrorMacro:wR}=bt,{DefaultDataType:ER}=x9,RR=1e-6;function J1(t,e,n){const r=t.length;let a=Number.MAX_VALUE,i=-Number.MAX_VALUE,s,o;for(o=e;o<r;o+=n)if(!Number.isNaN(t[o])){a=t[o],i=a;break}for(;o<r;o+=n)s=t[o],s<a?a=s:s>i&&(i=s);return{min:a,max:i}}function OR(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(a){t>a&&(t=a),e<a&&(e=a),n++,r+=a},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function Y9(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const a=t.length/n,i=new Float64Array(a);for(let s=0,o=0;s<a;++s){for(let c=o+n;o<c;++o)i[s]+=t[o]*t[o];i[s]**=.5}return J1(i,0,1)}return J1(t,e<0?0:e,n)}function Ud(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function Yg(t){return Object.prototype.toString.call(t).slice(8,-1)}function MR(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let a=0;a<t.getNumberOfTuples();++a){t.getTuple(a,r);const i=ta(r,e);i>n&&(n=i)}return n}const DR={computeRange:Y9,createRangeHelper:OR,fastComputeRange:J1,getDataType:Yg,getMaxNorm:MR};function VR(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const a=t.getNumberOfComponents(),i=e.values.length/(a>0?a:1);if(r===i)return!0;if(r>i){const s=e.values;return e.values=Ss(e.dataType,(r+i)*a),e.values.set(s),!0}return e.size>r*a&&(e.size=r*a,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const a=r*t.getNumberOfComponents();return e.size!==a?(e.size=a,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+a]},t.setComponent=(r,a,i)=>{i!==e.values[r*e.numberOfComponents+a]&&(e.values[r*e.numberOfComponents+a]=i,t.dataChange())},t.getValue=r=>{const a=r/e.numberOfComponents,i=r%e.numberOfComponents;return t.getComponent(a,i)},t.setValue=(r,a)=>{const i=r/e.numberOfComponents,s=r%e.numberOfComponents;t.setComponent(i,s,a)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=r;a<0&&(a=e.numberOfComponents===1?0:e.numberOfComponents);let i=null;return e.ranges||(e.ranges=Ud(e.ranges,e.numberOfComponents)),i=e.ranges[a],i?(e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple):(i=Y9(t.getData(),r,e.numberOfComponents),e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple)},t.setRange=(r,a)=>{e.ranges||(e.ranges=Ud(e.ranges,e.numberOfComponents));const i={min:r.min,max:r.max};return e.ranges[a]=i,e.rangeTuple[0]=i.min,e.rangeTuple[1]=i.max,e.rangeTuple},t.setTuple=(r,a)=>{const i=r*e.numberOfComponents;for(let s=0;s<e.numberOfComponents;s++)e.values[i+s]=a[s]},t.setTuples=(r,a)=>{let i=r*e.numberOfComponents;const s=Math.min(a.length,e.size-i);for(let o=0;o<s;)e.values[i++]=a[o++]},t.insertTuple=(r,a)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,a),r),t.insertTuples=(r,a)=>{const i=r+a.length/e.numberOfComponents;return e.size<i*e.numberOfComponents&&(e.size=i*e.numberOfComponents,n(i)),t.setTuples(r,a),i},t.insertNextTuple=r=>{const a=e.size/e.numberOfComponents;return t.insertTuple(a,r)},t.insertNextTuples=r=>{const a=e.size/e.numberOfComponents;return t.insertTuples(a,r)},t.findTuple=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:RR;for(let i=0;i<e.size;i+=e.numberOfComponents)if(Math.abs(r[0]-e.values[i])<=a){let s=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(r[o]-e.values[i+o])>a){s=!1;break}if(s)return i/e.numberOfComponents}return-1},t.getTuple=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=e.numberOfComponents||1,s=r*i;switch(i){case 4:a[3]=e.values[s+3];case 3:a[2]=e.values[s+2];case 2:a[1]=e.values[s+1];case 1:a[0]=e.values[s];break;default:for(let o=i-1;o>=0;--o)a[o]=e.values[s+o]}return a},t.getTuples=(r,a)=>{const i=(r??0)*e.numberOfComponents,s=(a??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(i,s);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>Q9({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,a)=>{e.values=r,e.size=r.length,e.dataType=Yg(r),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(i=>{r[i]||delete r[i]});const a={};return Object.keys(r).sort().forEach(i=>{a[i]=r[i]}),a.mtime&&delete a.mtime,a},t.deepCopy=r=>{const a=t.getDataType(),i=e.values;t.shallowCopy(r),(i==null?void 0:i.length)>=r.getNumberOfValues()&&a===r.getDataType()?(i.set(r.getData()),e.values=i,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,a,i,s,o,c)=>{const l=e.numberOfComponents||1;(l!==a.getNumberOfComponents()||l!==s.getNumberOfComponents())&&wR("numberOfComponents must match");const f=a.getTuple(i),u=s.getTuple(o),g=[];switch(g.length=l,l){case 4:g[3]=f[3]+(u[3]-f[3])*c;case 3:g[2]=f[2]+(u[2]-f[2])*c;case 2:g[1]=f[1]+(u[1]-f[1])*c;case 1:g[0]=f[0]+(u[0]-f[0])*c;break;default:for(let p=0;p<l;p++)g[p]=f[p]+(u[p]-f[p])*c}return t.insertTuple(r,g)}}const LR={name:"",numberOfComponents:1,dataType:ER,rangeTuple:[0,0]};function Z9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,LR,n),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=mu(e.dataType,e.values)):e.values=Ss(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=Yg(e.values)),Ue(t,e),u0(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");VR(t,e)}const Q9=Le(Z9,"vtkDataArray");var le={newInstance:Q9,extend:Z9,...DR,...x9};const{vtkErrorMacro:_R}=O,NR=["Build","Render"];function IR(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const a=r.getTraverseOperation(),i=t[a];if(i){i(r);return}t.apply(r,!0);for(let s=0;s<e.children.length;s++)e.children[s].traverse(r);t.apply(r,!1)},t.apply=(r,a)=>{const i=t[r.getOperation()];i&&i(a,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let a=0;a<e.children.length;++a){const s=e.children[a].getViewNodeFor(r);if(s)return s}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const a=e._parent.getLastAncestorOfType(r);return a||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const a=e._renderableChildMap.get(r);if(a!==void 0)return a.setVisited(!0),a;const i=t.createViewNode(r);if(i)return i.setParent(t),i.setVisited(!0),e._renderableChildMap.set(r,i),e.children.push(i),i},t.addMissingNodes=r=>{if(!(!r||!r.length))for(let a=0;a<r.length;++a){const i=r[a];t.addMissingNode(i)}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let a=0;a<r.length;++a){const i=r[a];if(e.children.indexOf(i)===-1){i.setParent(t),e.children.push(i);const o=i.getRenderable();o&&e._renderableChildMap.set(o,i)}i.setVisited(!0)}},t.removeNode=r=>{const a=e.children.findIndex(s=>s===r);if(a<0)return!1;const i=r.getRenderable();return i&&e._renderableChildMap.delete(i),r.delete(),e.children.splice(a,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let a=0;a<e.children.length;++a){const i=e.children[a];if(i.getVisited())e.children[r++]=i,i.setVisited(!1);else{const o=i.getRenderable();o&&e._renderableChildMap.delete(o),i.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return _R("Cannot create view nodes without my own factory"),null;const a=e.myFactory.createNode(r);return a&&a.setRenderable(r),a};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const FR={renderable:null,myFactory:null,children:[],visited:!1};function J9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FR,n),O.obj(t,e),O.event(t,e,"event"),e._renderableChildMap=new Map,O.get(t,e,["visited"]),O.setGet(t,e,["_parent","renderable","myFactory"]),O.getArray(t,e,["children"]),O.moveToProtected(t,e,["parent"]),IR(t,e)}const kR=O.newInstance(J9,"vtkViewNode");var st={newInstance:kR,extend:J9,PASS_TYPES:NR};function UR(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,a=n.getClassName(r++),i=!1;const s=Object.keys(e.overrides);for(;a&&!i;)s.indexOf(a)!==-1?i=!0:a=n.getClassName(r++);if(!i)return null;const o=e.overrides[a]();return o.setMyFactory(t),o}}const PR={};function e6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PR,n),O.obj(t,e),UR(t,e)}const bR=O.newInstance(e6,"vtkViewNodeFactory");var Zg={newInstance:bR,extend:e6};const t6=Object.create(null);function Tt(t,e){t6[t]=e}function GR(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const BR={};function n6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BR,n),e.overrides=t6,Zg.extend(t,e,n),GR(t,e)}const AR=O.newInstance(n6,"vtkOpenGLViewNodeFactory");var WR={newInstance:AR,extend:n6};const{Wrap:mr,Filter:wt}=R9,{VtkDataTypes:Se}=le,{vtkDebugMacro:Tf,vtkErrorMacro:Ci,vtkWarningMacro:Pd}=bt,{toHalf:zR}=Oi;function $R(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(c?e._openGLRenderWindow=c:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(wt.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(wt.LINEAR),t.setMagnificationFilter(wt.LINEAR)):(t.setMinificationFilter(wt.NEAREST),t.setMagnificationFilter(wt.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(mr.REPEAT),t.setWrapS(mr.REPEAT),t.setWrapT(mr.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(wt.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(wt.LINEAR_MIPMAP_LINEAR));const f=e.renderable.getCanvas();t.create2DFromRaw(f.width,f.height,4,Se.UNSIGNED_CHAR,f,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const f=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(wt.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(f.width,f.height,4,Se.UNSIGNED_CHAR,f.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const l=e.renderable.getInputData(0);if(l&&l.getPointData().getScalars()){const f=l.getExtent(),u=l.getPointData().getScalars(),g=[];for(let p=0;p<e.renderable.getNumberOfInputPorts();++p){const h=e.renderable.getInputData(p),d=h?h.getPointData().getScalars().getData():null;d&&g.push(d)}e.renderable.getInterpolate()&&u.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(wt.LINEAR_MIPMAP_LINEAR)),g.length%6===0?t.createCubeFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,u.getNumberOfComponents(),u.getDataType(),g):t.create2DFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,u.getNumberOfComponents(),u.getDataType(),u.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()},t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=c=>{c&&e.handle&&(c.activateTexture(t),c.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(c),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let c=!1;if(e.context&&e.handle){let l=0;switch(e.target){case e.context.TEXTURE_2D:l=e.context.TEXTURE_BINDING_2D;break;default:Pd("impossible case");break}c=e.context.getIntegerv(l)===e.handle}return c},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(c,l)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(c,l)),e.internalFormat||Tf(`Unable to find suitable internal format for T=${c} NC= ${l}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&Pd("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(c,l)=>{let f=0;return f=e._openGLRenderWindow.getDefaultTextureInternalFormat(c,l,e.oglNorm16Ext,t.useHalfFloat()),f||(f||(Tf("Unsupported internal texture type!"),Tf(`Unable to find suitable internal format for T=${c} NC= ${l}`)),f)},t.useHalfFloat=()=>e.enableHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=c=>{e._forceInternalFormat=!0,c!==e.internalFormat&&(e.internalFormat=c,t.modified())},t.getFormat=(c,l)=>(e.format=t.getDefaultFormat(c,l),e.format),t.getDefaultFormat=(c,l)=>{if(e._openGLRenderWindow.getWebgl2())switch(l){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(l){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=c=>{const l=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(c){case Se.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(e.oglNorm16Ext&&!l&&Se.SHORT):return e.context.SHORT;case(e.oglNorm16Ext&&!l&&Se.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(l&&Se.SHORT):return e.context.HALF_FLOAT;case(l&&Se.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case Se.FLOAT:case Se.VOID:default:return e.context.FLOAT}switch(c){case Se.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case Se.FLOAT:case Se.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const f=e.context.getExtension("OES_texture_half_float");if(f&&e.context.getExtension("OES_texture_half_float_linear"))return f.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(c){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||l)&&(e.openGLDataType=t.getDefaultDataType(c)),e.openGLDataType},t.getShiftAndScale=()=>{let c=0,l=1;switch(e.openGLDataType){case e.context.BYTE:l=127.5,c=l-128;break;case e.context.UNSIGNED_BYTE:l=255,c=0;break;case e.context.SHORT:l=32767.5,c=l-32768;break;case e.context.UNSIGNED_SHORT:l=65536,c=0;break;case e.context.INT:l=21474836475e-1,c=l-2147483648;break;case e.context.UNSIGNED_INT:l=4294967295,c=0;break;case e.context.FLOAT:}return{shift:c,scale:l}},t.getOpenGLFilterMode=c=>{switch(c){case wt.NEAREST:return e.context.NEAREST;case wt.LINEAR:return e.context.LINEAR;case wt.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case wt.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case wt.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case wt.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=c=>{switch(c){case mr.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case mr.REPEAT:return e.context.REPEAT;case mr.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}},t.updateArrayDataTypeForGL=function(c,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const u=[];let g=e.width*e.height*e.components;if(f&&(g*=e.depth),c!==Se.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let h=0;h<l.length;h++)if(l[h]){const d=l[h].length>g?l[h].subarray(0,g):l[h];u.push(new Float32Array(d))}else u.push(null);if(c!==Se.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let h=0;h<l.length;h++)if(l[h]){const d=l[h].length>g?l[h].subarray(0,g):l[h];u.push(new Uint8Array(d))}else u.push(null);let p=!1;if(e._openGLRenderWindow.getWebgl2())p=e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");p=h&&e.openGLDataType===h.HALF_FLOAT_OES}if(p)for(let h=0;h<l.length;h++)if(l[h]){const d=new Uint16Array(g),m=l[h];for(let v=0;v<g;v++)d[v]=zR(m[v]);u.push(d)}else u.push(null);if(u.length===0)for(let h=0;h<l.length;h++)u.push(l[h]);return u};function n(c){if(e._openGLRenderWindow.getWebgl2())return c;const l=[],f=e.width,u=e.height,g=e.components;if(c&&(!Qs(f)||!Qs(u))){const p=e.context.getExtension("OES_texture_half_float"),h=Kr(f),d=Kr(u),m=h*d*e.components;for(let v=0;v<c.length;v++)if(c[v]!==null){let C=null;const y=u/d,T=f/h;let x=!1;e.openGLDataType===e.context.FLOAT?C=new Float32Array(m):p&&e.openGLDataType===p.HALF_FLOAT_OES?(C=new Uint16Array(m),x=!0):C=new Uint8Array(m);for(let S=0;S<d;S++){const w=S*h*g,E=S*y;let L=Math.floor(E),R=Math.ceil(E);R>=u&&(R=u-1);const D=E-L,I=1-D;L=L*f*g,R=R*f*g;for(let b=0;b<h;b++){const F=b*g,W=b*T;let P=Math.floor(W),K=Math.ceil(W);K>=f&&(K=f-1);const U=W-P;P*=g,K*=g;for(let N=0;N<g;N++)x?C[w+F+N]=Oi.toHalf(Oi.fromHalf(c[v][L+P+N])*I*(1-U)+Oi.fromHalf(c[v][L+K+N])*I*U+Oi.fromHalf(c[v][R+P+N])*D*(1-U)+Oi.fromHalf(c[v][R+K+N])*D*U):C[w+F+N]=c[v][L+P+N]*I*(1-U)+c[v][L+K+N]*I*U+c[v][R+P+N]*D*(1-U)+c[v][R+K+N]*D*U}}l.push(C),e.width=h,e.height=d}else l.push(null)}if(l.length===0)for(let p=0;p<c.length;p++)l.push(c[p]);return l}function r(c){var l;return e._openGLRenderWindow?e.resizable||(l=e.renderable)!=null&&l.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&e.oglNorm16Ext&&(c===Se.UNSIGNED_SHORT||c===Se.SHORT)):!1:!1}t.create2DFromRaw=function(c,l,f,u,g){let p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(u,!0),t.getInternalFormat(u,f),t.getFormat(u,f),!e.internalFormat||!e.format||!e.openGLDataType)return Ci("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const h=[g],d=t.updateArrayDataTypeForGL(u,h),m=n(d);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,p),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(u)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),m[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,m[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,m[0]),e.generateMipmap&&e.context.generateMipmap(e.target),p&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(u,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(c,l,f,u,g)=>{if(t.getOpenGLDataType(u),t.getInternalFormat(u,f),t.getFormat(u,f),!e.internalFormat||!e.format||!e.openGLDataType)return Ci("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=f,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=g.length/6-1,t.createTexture(),t.bind();const p=t.updateArrayDataTypeForGL(u,g),h=n(p),d=[];let m=e.width,v=e.height;for(let C=0;C<h.length;C++){C%6===0&&C!==0&&(m/=2,v/=2),d[C]=Ss(u,v*m*e.components);for(let y=0;y<v;++y){const T=y*m*e.components,x=(v-y-1)*m*e.components;d[C].set(h[C].slice(x,x+m*e.components),T)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(u)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let C=0;C<6;C++){let y=0,T=e.width,x=e.height;for(;T>=1&&x>=1;){let S=null;y<=e.maxLevel&&(S=d[6*y+C]),r(u)?S!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+C,y,0,0,T,x,e.format,e.openGLDataType,S):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+C,y,e.internalFormat,T,x,0,e.format,e.openGLDataType,S),y++,T/=2,x/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(u,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(c,l,f,u)=>(t.getOpenGLDataType(f),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?f===Se.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Ci("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(f)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),u!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,u)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,u),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(f,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=c=>{if(t.getOpenGLDataType(Se.UNSIGNED_CHAR),t.getInternalFormat(Se.UNSIGNED_CHAR,4),t.getFormat(Se.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Ci("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const l=!e._openGLRenderWindow.getWebgl2()&&(!Qs(c.width)||!Qs(c.height)),f=document.createElement("canvas");f.width=l?Kr(c.width):c.width,f.height=l?Kr(c.height):c.height,e.width=f.width,e.height=f.height;const u=f.getContext("2d");u.translate(0,f.height),u.scale(1,-1),u.drawImage(c,0,0,c.width,c.height,0,0,f.width,f.height);const g=f;return r(Se.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),g!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,g)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,g),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(Se.UNSIGNED_CHAR,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0};function a(c,l,f){const u=new Array(f),g=new Array(f);for(let p=0;p<f;++p)u[p]=c[p],g[p]=l[p]-c[p]||1;return{scale:g,offset:u}}function i(c,l){for(let f=0;f<c.length;f++){const u=c[f],g=l[f]+u;if(u<-2048||u>2048||g<-2048||g>2048)return!1}return!0}function s(c,l,f,u){t.getOpenGLDataType(c);let g=!1;if(e._openGLRenderWindow.getWebgl2())g=e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");g=h&&e.openGLDataType===h.HALF_FLOAT_OES}const p=g&&(i(l,f)||u);e.canUseHalfFloat=p}function o(c,l){const f=c.getNumberOfComponents(),u=c.getDataType(),g=c.getData(),p=new Array(f),h=new Array(f);for(let m=0;m<f;++m){const[v,C]=c.getRange(m);p[m]=v,h[m]=C}const d=a(p,h,f);return s(u,d.offset,d.scale,l),t.useHalfFloat()||t.getOpenGLDataType(u,!0),{numComps:f,dataType:u,data:g,scaleOffsets:d}}t.create2DFilterableFromRaw=function(c,l,f,u,g){let p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(c,l,le.newInstance({numberOfComponents:f,dataType:u,values:g}),p)},t.create2DFilterableFromDataArray=function(c,l,f){let u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:g,dataType:p,data:h}=o(f,u);t.create2DFromRaw(c,l,g,p,h)},t.updateVolumeInfoForGL=(c,l)=>{var g,p;let f=!1;const u=t.useHalfFloat();(!((g=e.volumeInfo)!=null&&g.scale)||!((p=e.volumeInfo)!=null&&p.offset))&&(e.volumeInfo={scale:new Array(l),offset:new Array(l)});for(let h=0;h<l;++h)e.volumeInfo.scale[h]=1,e.volumeInfo.offset[h]=0;if(e.oglNorm16Ext&&!u&&c===Se.SHORT){for(let h=0;h<l;++h)e.volumeInfo.scale[h]=32767;f=!0}if(e.oglNorm16Ext&&!u&&c===Se.UNSIGNED_SHORT){for(let h=0;h<l;++h)e.volumeInfo.scale[h]=65535;f=!0}if(c===Se.UNSIGNED_CHAR){for(let h=0;h<l;++h)e.volumeInfo.scale[h]=255;f=!0}return(c===Se.FLOAT||u&&(c===Se.SHORT||c===Se.UNSIGNED_SHORT))&&(f=!0),f},t.create3DFromRaw=(c,l,f,u,g,p)=>{let h=g,d=p;if(!t.updateVolumeInfoForGL(h,u)&&d){const T=c*l*f,x=structuredClone(e.volumeInfo),S=new Float32Array(T*u);e.volumeInfo.offset=x.offset,e.volumeInfo.scale=x.scale;let w=0;const E=x.scale.map(L=>1/L);for(let L=0;L<T;L++)for(let R=0;R<u;R++)S[w]=(d[w]-x.offset[R])*E[R],w++;h=Se.FLOAT,d=S}if(t.getOpenGLDataType(h),t.getInternalFormat(h,u),t.getFormat(h,u),!e.internalFormat||!e.format||!e.openGLDataType)return Ci("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=u,e.width=c,e.height=l,e.depth=f,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const m=[d],C=t.updateArrayDataTypeForGL(h,m,!0),y=n(C);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(h)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),y[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,y[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,y[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(h,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(c,l,f,u,g,p){let h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(c,l,f,le.newInstance({numberOfComponents:u,dataType:g,values:p}),h)},t.create3DFilterableFromDataArray=function(c,l,f,u){let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:p,dataType:h,data:d,scaleOffsets:m}=o(u,g),v=[],C=[];for(let N=0;N<p;++N)v[N]=0,C[N]=1;if(e.volumeInfo={scale:C,offset:v,dataComputedScale:m.scale,dataComputedOffset:m.offset,width:c,height:l,depth:f},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(c,l,f,p,h,d);const y=c*l*f,T=structuredClone(m);let x=(N,k,z,j,$)=>{N[k]=z},S=Se.UNSIGNED_CHAR;if(h===Se.UNSIGNED_CHAR)for(let N=0;N<p;++N)T.offset[N]=0,T.scale[N]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(S=Se.FLOAT,x=(N,k,z,j,$)=>{N[k]=(z-j)/$}):(S=Se.UNSIGNED_CHAR,x=(N,k,z,j,$)=>{N[k]=255*(z-j)/$});if(t.getOpenGLDataType(S),t.getInternalFormat(S,p),t.getFormat(S,p),!e.internalFormat||!e.format||!e.openGLDataType)return Ci("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=p,e.depth=1,e.numberOfDimensions=2;let w=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);w>4096&&(S===Se.FLOAT||p>=3)&&(w=4096);let E=1,L=1;y>w*w&&(E=Math.ceil(Math.sqrt(y/(w*w))),L=E);let R=Math.sqrt(y)/E;R=Kr(R);const D=Math.floor(R*E/c),I=Math.ceil(f/D),b=Kr(l*I/L);e.width=R,e.height=b,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=D,e.volumeInfo.yreps=I,e.volumeInfo.xstride=E,e.volumeInfo.ystride=L,e.volumeInfo.offset=T.offset,e.volumeInfo.scale=T.scale;let F;const W=R*b*p;S===Se.FLOAT?F=new Float32Array(W):F=new Uint8Array(W);let P=0;const K=Math.floor(c/E),U=Math.floor(l/L);for(let N=0;N<I;N++){const k=Math.min(D,f-N*D),z=p*(e.width-k*Math.floor(c/E));for(let j=0;j<U;j++){for(let $=0;$<k;$++){const re=p*((N*D+$)*c*l+L*j*c);for(let xt=0;xt<K;xt++)for(let Me=0;Me<p;Me++)x(F,P,d[re+E*xt*p+Me],T.offset[Me],T.scale[Me]),P++}P+=z}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(S)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),F!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,F)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,F),t.deactivate(),!0},t.setOpenGLRenderWindow=c=>{e._openGLRenderWindow!==c&&(t.releaseGraphicsResources(),e._openGLRenderWindow=c,e.context=null,c&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=c=>c&&c.isCurrent()?c.getIntegerv(c.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=c=>{e.enableUseHalfFloat=c}}const jR={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:mr.CLAMP_TO_EDGE,wrapT:mr.CLAMP_TO_EDGE,wrapR:mr.CLAMP_TO_EDGE,minificationFilter:wt.NEAREST,magnificationFilter:wt.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function r6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jR,n),st.extend(t,e,n),e.sendParametersTime={},Ue(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Ue(e.textureBuildTime,{mtime:0}),u0(t,e,["format","openGLDataType"]),ft(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Xt(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),f0(t,e,["openGLRenderWindow"]),$R(t,e)}const a6=Le(r6,"vtkOpenGLTexture");var ke={newInstance:a6,extend:r6,...R9};Tt("vtkTexture",a6);function HR(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){fe("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){fe("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){fe("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=e.context;if(!a){fe("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let i=a.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())i+=r;else{fe("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,a.framebufferTexture2D(a.FRAMEBUFFER,i,a.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){fe("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let a=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())a+=n;else{fe("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,a,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){fe("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else fe("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){fe("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else fe("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){fe("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=ke.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(ee.LINEAR),r.setMagnificationFilter(ee.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,ce.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const KR={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function i6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KR,n),Ue(t,e),e.colorBuffers&&fe("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],ws(t,e,["colorBuffers"]),HR(t,e)}const qR=Le(i6,"vtkFramebuffer");var Cu={newInstance:qR,extend:i6};function XR(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${O.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(a=>{t.setCurrentOperation(a),n.traverse(t)}),e.delegates.forEach(a=>{a.traverse(n,t)}),e.postDelegateOperations.forEach(a=>{t.setCurrentOperation(a),n.traverse(t)}))}}const YR={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function s6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YR,n),O.obj(t,e),O.get(t,e,["currentOperation"]),O.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),O.moveToProtected(t,e,["currentParent"]),XR(t,e)}const ZR=O.newInstance(s6,"vtkRenderPass");var Qg={newInstance:ZR,extend:s6};const Or={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var o6={ObjectType:Or};const{ObjectType:Uc}=o6,QR={};function JR(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(o){switch(o){case Uc.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case Uc.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case Uc.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,a=null,i=!0,s="";t.getType=()=>r,t.setType=o=>{r=o},t.getHandle=()=>a,t.isReady=()=>i===!1,t.generateBuffer=o=>{const c=n(o);return a===null&&(a=e.context.createBuffer(),r=o),n(r)===c},t.upload=(o,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),a),e.context.bufferData(n(r),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,i=!1,!0):(s="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>a?(e.context.bindBuffer(n(r),a),!0):!1,t.release=()=>a?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{a!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(a),a=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>s}const eO={objectType:Uc.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function c6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eO,n),O.obj(t,e),O.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),O.moveToProtected(t,e,["openGLRenderWindow"]),JR(t,e)}const tO=O.newInstance(c6);var Sr={newInstance:tO,extend:c6,...QR,...o6};const l6={FLAT:0,GOURAUD:1,PHONG:2},On={POINTS:0,WIREFRAME:1,SURFACE:2},nO=l6;var u6={Shading:l6,Representation:On,Interpolation:nO};const{vtkErrorMacro:bd}=O;function rO(t,e){const n=new Float64Array(3);O8(n,e);const r=new Float64Array(16);return T8(r,oi(),t,n),r}function aO(t,e){return t===null||e===null?!1:!(cd(t,[0,0,0])&&cd(e,[1,1,1]))}function iO(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(Or.ARRAY_BUFFER),t.createVBO=function(n,r,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const o=i.points.getData();let c=null,l=null,f=null;const u=i.colors?i.colors.getNumberOfComponents():0,g=i.tcoords?i.tcoords.getNumberOfComponents():0;i.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=i.normals.getData()),i.customAttributes&&i.customAttributes.forEach(N=>{N&&(e.customData.push({data:N.getData(),offset:4*e.blockSize,components:N.getNumberOfComponents(),name:N.getName()}),e.blockSize+=N.getNumberOfComponents())}),i.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=g,e.blockSize+=g,l=i.tcoords.getData()),i.colors?(e.colorComponents=i.colors.getNumberOfComponents(),e.colorOffset=0,f=i.colors.getData(),e.colorBO||(e.colorBO=Sr.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let p=0,h=0,d=0,m=0,v=0,C=0,y;const T={anythingToPoints(N,k,z,j){for(let $=0;$<N;++$)y(k[z+$],j)},linesToWireframe(N,k,z,j){for(let $=0;$<N-1;++$)y(k[z+$],j),y(k[z+$+1],j)},polysToWireframe(N,k,z,j){if(N>2)for(let $=0;$<N;++$)y(k[z+$],j),y(k[z+($+1)%N],j)},stripsToWireframe(N,k,z,j){if(N>2){for(let $=0;$<N-1;++$)y(k[z+$],j),y(k[z+$+1],j);for(let $=0;$<N-2;$++)y(k[z+$],j),y(k[z+$+2],j)}},polysToSurface(N,k,z,j){for(let $=0;$<N-2;$++)y(k[z+0],j),y(k[z+$+1],j),y(k[z+$+2],j)},stripsToSurface(N,k,z,j){for(let $=0;$<N-2;$++)y(k[z+$],j),y(k[z+$+1+$%2],j),y(k[z+$+1+($+1)%2],j)}},x={anythingToPoints(N,k){return N},linesToWireframe(N,k){return N>1?(N-1)*2:0},polysToWireframe(N,k){return N>2?N*2:0},stripsToWireframe(N,k){return N>2?N*4-6:0},polysToSurface(N,k){return N>2?(N-2)*3:0},stripsToSurface(N,k,z){return N>2?(N-2)*3:0}};let S=null,w=null;a===On.POINTS||r==="verts"?(S=T.anythingToPoints,w=x.anythingToPoints):a===On.WIREFRAME||r==="lines"?(S=T[`${r}ToWireframe`],w=x[`${r}ToWireframe`]):(S=T[`${r}ToSurface`],w=x[`${r}ToSurface`]);const E=n.getData(),L=E.length;let R=0;for(let N=0;N<L;)R+=w(E[N],E),N+=E[N]+1;let D=null;const I=new Float32Array(R*e.blockSize);f&&(D=new Uint8Array(R*4));let b=0,F=0,W=0,P=0;for(let N=0;N<3;++N){const k=i.points.getRange(N),z=k[1]-k[0];W+=z*z;const j=.5*(k[1]+k[0]);P+=j*j}if(W>0&&(Math.abs(P)/W>1e6||Math.abs(Math.log10(W))>3||W===0&&P>1e6)){const N=new Float64Array(3),k=new Float64Array(3);for(let z=0;z<3;++z){const j=i.points.getRange(z),$=j[1]-j[0];N[z]=.5*(j[1]+j[0]),k[z]=$>0?1/$:1}t.setCoordShiftAndScale(N,k)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(s)if(!s.points&&!s.cells)s.points=new Int32Array(R),s.cells=new Int32Array(R);else{const N=new Int32Array(R+s.points.length);N.set(s.points),s.points=N;const k=new Int32Array(R+s.cells.length);k.set(s.cells),s.cells=k}let U=i.vertexOffset;y=function(k,z){if(s&&(s.points[U]=k,s.cells[U]=C+i.cellOffset),++U,p=k*3,e.coordShiftAndScaleEnabled?(I[b++]=(o[p++]-e.coordShift[0])*e.coordScale[0],I[b++]=(o[p++]-e.coordShift[1])*e.coordScale[1],I[b++]=(o[p++]-e.coordShift[2])*e.coordScale[2]):(I[b++]=o[p++],I[b++]=o[p++],I[b++]=o[p++]),c!==null&&(i.haveCellNormals?h=(C+i.cellOffset)*3:h=k*3,I[b++]=c[h++],I[b++]=c[h++],I[b++]=c[h++]),e.customData.forEach(j=>{v=k*j.components;for(let $=0;$<j.components;++$)I[b++]=j.data[v++]}),l!==null){i.useTCoordsPerCell?d=z*g:d=k*g;for(let j=0;j<g;++j)I[b++]=l[d++]}f!==null&&(i.haveCellScalars?m=(C+i.cellOffset)*u:m=k*u,D[F++]=f[m++],D[F++]=f[m++],D[F++]=f[m++],D[F++]=u===4?f[m++]:255)};for(let N=0;N<L;N+=E[N]+1,C++)S(E[N],E,N+1,C+i.cellOffset);return e.elementCount=R,t.upload(I,Or.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(D,Or.ARRAY_BUFFER)),C},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){bd("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){bd("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!ld(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!ld(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=aO(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=rO(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const sO={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function f6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sO,n),Sr.extend(t,e,n),O.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),O.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),iO(t,e)}const oO=O.newInstance(f6);var cO={newInstance:oO,extend:f6};const{vtkErrorMacro:lO}=O;function uO(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const a=e.context.getShaderInfoLog(e.handle);return lO(`Error compiling shader '${e.source}': ${a}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const fO={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function g6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fO,n),O.obj(t,e),O.setGet(t,e,["shaderType","source","error","handle","context"]),uO(t,e)}const gO=O.newInstance(g6,"vtkShader");var xf={newInstance:gO,extend:g6};const{vtkErrorMacro:Yn}=O;function pO(t,e,n,r){const a=typeof n=="string"?n:n.join(`
`),i=r===!1?e:new RegExp(e,"g"),s=t.replace(i,a);return{replace:s!==a,result:s}}function dO(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Yn(e.error),0):t.link()?(t.setCompiled(!0),1):(Yn(`Links failed: ${e.error}`),0):(Yn(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Yn(e.fragmentShader.getError()),0):(Yn(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Yn(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return Yn(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const i=new Float32Array(r);return e.context.uniformMatrix4fv(a,!1,i),!0},t.setUniformMatrix3x3=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const i=new Float32Array(r);return e.context.uniformMatrix3fv(a,!1,i),!0},t.setUniformf=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(a,r),!0)},t.setUniformfv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(a,r),!0)},t.setUniformi=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(a,r),!0)},t.setUniformiv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(a,r),!0)},t.setUniform2f=(n,r,a)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(i,r,a),!0},t.setUniform2fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(a,r),!0)},t.setUniform2i=(n,r,a)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(i,r,a),!0},t.setUniform2iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(a,r),!0)},t.setUniform3f=(n,r,a,i)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(s,r,a,i),!0},t.setUniform3fArray=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(a,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,o[0],o[1],o[2]),!0},t.setUniform3iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(a,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(a,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];let o=i;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(a,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(Yn("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return Yn("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const hO={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function p6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hO,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=xf.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=xf.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=xf.newInstance(),e.geometryShader.setShaderType("Geometry"),O.obj(t,e),O.get(t,e,["lastCameraMTime"]),O.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),dO(t,e)}const mO=O.newInstance(p6,"vtkShaderProgram");var G={newInstance:mO,extend:p6,substitute:pO};function vO(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(let i=0;i<a.attributes.length;++i){const s=a.attributes[i],o=s.isMatrix?s.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(s.index+c),n.vertexAttribPointer(s.index+c,s.size,s.type,s.normalize,s.stride,s.offset+s.stride*c/s.size),s.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(s.index+c,1):n.vertexAttribDivisor(s.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(let i=0;i<a.attributes.length;++i){const s=a.attributes[i],o=s.isMatrix?s.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(s.index+c),n.vertexAttribPointer(s.index+c,s.size,s.type,s.normalize,s.stride,s.offset+s.stride*c/s.size),s.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(s.index+c,0):n.vertexAttribDivisor(s.index+c,0)),n.disableVertexAttribArray(s.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,a,i,s,o,c,l)=>t.addAttributeArrayWithDivisor(n,r,a,i,s,o,c,l,0,!1),t.addAttributeArrayWithDivisor=(n,r,a,i,s,o,c,l,f,u)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==Or.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const g=e.context,p={};if(p.name=a,p.index=g.getAttribLocation(e.handleProgram,a),p.offset=i,p.stride=s,p.type=o,p.size=c,p.normalize=l,p.isMatrix=u,p.divisor=f,p.Index===-1)return!1;if(r.bind(),g.enableVertexAttribArray(p.index),g.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p.index,1):g.vertexAttribDivisor(p.index,1)),p.buffer=r.getHandle(),!e.supported){let h=!1;for(let d=0;d<e.buffers.length;++d){const m=e.buffers[d];if(m.buffer===p.buffer){h=!0;let v=!1;for(let C=0;C<m.attributes.length;++C)m.attributes[C].name===a&&(v=!0,m.attributes[C]=p);v||m.attributes.push(p)}}h||e.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,a,i,s,o,c,l,f)=>{const u=t.addAttributeArrayWithDivisor(n,r,a,i,s,o,c,l,f,!0);if(!u)return u;const g=e.context,p=g.getAttribLocation(e.handleProgram,a);for(let h=1;h<c;h++)g.enableVertexAttribArray(p+h),g.vertexAttribPointer(p+h,c,o,l,s,i+s*h/c),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p+h,1):g.vertexAttribDivisor(p+h,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];for(let i=0;i<a.attributes.length;++i)if(a.attributes[i].name===n)return a.attributes.splice(i,1),a.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const yO={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function d6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yO,n),e.buffers=[],O.obj(t,e),O.get(t,e,["supported"]),O.setGet(t,e,["forceEmulation"]),vO(t,e)}const CO=O.newInstance(d6,"vtkOpenGLVertexArrayObject");var Jg={newInstance:CO,extend:d6};const Wr={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function TO(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,a,i)=>{if(e.CABO.getElementCount()){const s=t.getOpenGLMode(a),o=t.haveWideLines(n,r),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),s===c.LINES&&o?(t.updateShaders(n,r,i),c.drawArraysInstanced(s,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,i),c.drawArrays(s,0,e.CABO.getElementCount()),c.lineWidth(1));const u=(s===c.POINTS?1:0)||(s===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===On.POINTS||r===Wr.Points?e.context.POINTS:n===On.WIREFRAME||r===Wr.Lines||r===Wr.TrisEdges||r===Wr.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,a)=>!!(a.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,a)=>{if(t.getNeedToRebuildShaders(n,r,a)){const i={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(i,n,r);const s=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(i.Vertex,i.Fragment,i.Geometry);s!==t.getProgram()&&(t.setProgram(s),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,n,r),a.setPropertyShaderParameters(t,n,r),a.setCameraShaderParameters(t,n,r),a.setLightingShaderParameters(t,n,r),a.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,a)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);const i=parseFloat(r.getProperty().getLineWidth()),s=i/2;t.getProgram().setUniformf("lineWidthStepSize",i/Math.ceil(i)),t.getProgram().setUniformf("halfLineWidth",s)}e.primitiveType===Wr.Points||r.getProperty().getRepresentation()===On.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,a)=>{let i=n.Vertex;i=G.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,i=G.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,a)&&(i=G.substitute(i,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,i=G.substitute(i,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=i},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Wr.Points?2:e.primitiveType===Wr.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const xO={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function h6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xO,n),O.obj(t,e),e.shaderSourceTime={},O.obj(e.shaderSourceTime),e.attributeUpdateTime={},O.obj(e.attributeUpdateTime),O.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=G.newInstance(),e.VAO=Jg.newInstance(),e.CABO=cO.newInstance(),TO(t,e)}const SO=O.newInstance(h6);var Ta={newInstance:SO,extend:h6,primTypes:Wr};const{Representation:eo,Interpolation:to}=u6;function Gd(t){return()=>O.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function wO(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,a)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==a)&&(e.color[0]=n,e.color[1]=r,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=Gd("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=Gd("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(to.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(to.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(to.PHONG),t.getInterpolationAsString=()=>O.enumToString(to,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(eo.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(eo.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(eo.POINTS),t.getRepresentationAsString=()=>O.enumToString(eo,e.representation)}const EO={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:to.GOURAUD,representation:eo.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function RO(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EO,n),O.obj(t,e),O.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),O.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),wO(t,e)}const OO=O.newInstance(RO,"vtkProperty");var m0={newInstance:OO,...u6};const{Representation:MO}=m0,{vtkErrorMacro:Bd}=O;function DO(t){const e=G.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const VO=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function LO(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),i=le.newInstance({numberOfComponents:3,values:n});i.setName("points");const s=le.newInstance({numberOfComponents:2,values:r});s.setName("tcoords");const o=le.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",MO.SURFACE,{points:i,tcoords:s,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),a=n.getContext();e.framebuffer=Cu.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=ke.newInstance(),e.translucentRGBATexture.setInternalFormat(a.RGBA16F),e.translucentRGBATexture.setFormat(a.RGBA),e.translucentRGBATexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(r[0],r[1],4,"Float32Array",null),e.translucentRTexture=ke.newInstance(),e.translucentRTexture.setInternalFormat(a.R16F),e.translucentRTexture.setFormat(a.RED),e.translucentRTexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(r[0],r[1],1,"Float32Array",null),e.translucentZTexture=ke.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(r[0],r[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),VO,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||Bd("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||Bd("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,a)=>{if(e.deleted)return;const i=n.getSize(),s=n.getContext();if(e._supported=!1,r.getSelector()||!s||!n.getWebgl2()||!s.getExtension("EXT_color_buffer_half_float")&&!s.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==i[0]||c[1]!==i[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}s.drawBuffers([s.COLOR_ATTACHMENT0]),s.clearBufferfv(s.COLOR,0,[0,0,0,0]),s.clearBufferfv(s.DEPTH,0,[1]),s.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaqueZBufferPass"),r.traverse(a)),s.colorMask(!0,!0,!0,!0),s.drawBuffers([s.COLOR_ATTACHMENT0,s.COLOR_ATTACHMENT1]),s.viewport(0,0,i[0],i[1]),s.scissor(0,0,i[0],i[1]),s.clearBufferfv(s.COLOR,0,[0,0,0,1]),s.clearBufferfv(s.COLOR,1,[0,0,0,0]),s.enable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFuncSeparate(s.ONE,s.ONE,s.ZERO,s.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),s.drawBuffers([s.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=Jg.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),s.depthMask(!1),s.depthFunc(s.ALWAYS),s.viewport(0,0,i[0],i[1]),s.scissor(0,0,i[0],i[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),s.drawArrays(s.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.depthMask(!0),s.depthFunc(s.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const o=r.getTiledSizeAndOrigin();s.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),s.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize)},t.getShaderReplacement=()=>e._supported?DO:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const _O={framebuffer:null,copyShader:null,tris:null};function m6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_O,n),Qg.extend(t,e,n),e.VBOBuildTime={},O.obj(e.VBOBuildTime,{mtime:0}),e.tris=Ta.newInstance(),O.get(t,e,["framebuffer"]),LO(t,e)}const NO=O.newInstance(m6,"vtkOpenGLOrderIndependentTranslucentPass");var IO={newInstance:NO,extend:m6};function FO(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const a=n.getRenderable().getNumberOfLayers(),i=n.getRenderable().getRenderersByReference();for(let s=0;s<a;s++)for(let o=0;o<i.length;o++){const c=i[o],l=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===s){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),l.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const f=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Cu.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const u=e.framebuffer.getSize();(u===null||u[0]!==f[0]||u[1]!==f[1])&&(e.framebuffer.create(f[0],f[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),l.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),l.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),l.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=IO.newInstance()),e.translucentPass.traverse(n,l,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),l.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),l.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const kO={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function v6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kO,n),Qg.extend(t,e,n),O.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),FO(t,e)}const UO=O.newInstance(v6,"vtkForwardPass");var PO={newInstance:UO,extend:v6};const $t={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var y6={PassTypes:$t};const{vtkErrorMacro:Ad,vtkWarningMacro:bO}=O;function GO(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:Gn(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(a=>a),e.arrays=r.arrays().map(a=>({array:a}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const a=r.getName(),{array:i,index:s}=t.getArrayWithIndex(a);return i!=null?(e.arrays[s]={data:r},s):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const a=e.arrays.findIndex(i=>i.data.getName()===r);return t.removeArrayByIndex(a)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((a,i,s)=>i.data.getName()===r?i.data:a,null),t.getArrayWithIndex=r=>{const a=e.arrays.findIndex(i=>i.data.getName()===r);return{array:a!==-1?e.arrays[a].data:null,index:a}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const a=e.arrays[r];return a?a.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(s=>{const o=t.getFlag(s.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&s){let c=t.getArrayByName(s.getName());if(c)if(s.getNumberOfComponents()===c.getNumberOfComponents())if(a>-1&&a<s.getNumberOfTuples()){const l=i>-1?i:a;c.insertTuple(l,s.getTuple(a))}else c.insertTuples(0,s.getTuples());else Ad("Unhandled case in passData");else if(a<0||a>s.getNumberOfTuples())t.addArray(s),r.getAttributes(s).forEach(l=>{t.setAttribute(s,l)});else{const l=s.getNumberOfComponents();let f=s.getNumberOfValues();const u=i>-1?i:a;f<=u*l&&(f=(u+1)*l),c=le.newInstance({name:s.getName(),dataType:s.getDataType(),numberOfComponents:l,values:O.newTypedArray(s.getDataType(),f),size:0}),c.insertTuple(u,s.getTuple(a)),t.addArray(c),r.getAttributes(s).forEach(g=>{t.setAttribute(c,g)})}}})},t.interpolateData=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let f=t.getArrayByName(c.getName());if(f)if(c.getNumberOfComponents()===f.getNumberOfComponents())if(a>-1&&a<c.getNumberOfTuples()){const u=s>-1?s:a;f.interpolateTuple(u,c,a,c,i,o),bO("Unexpected case in interpolateData")}else f.insertTuples(c.getTuples());else Ad("Unhandled case in interpolateData");else if(a<0||i<0||a>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{const u=c.getNumberOfComponents();let g=c.getNumberOfValues();const p=s>-1?s:a;g<=p*u&&(g=(p+1)*u),f=le.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:O.newTypedArray(c.getDataType(),g),size:0}),f.interpolateTuple(p,c,a,c,i,o),t.addArray(f),r.getAttributes(c).forEach(h=>{t.setAttribute(f,h)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(a=>{const i=a.newClone();return i.deepCopy(a),{data:i}})},t.copyFlags=r=>r.getCopyFieldFlags().map(a=>a),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,a)=>a.data.getMTime()>r?a.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,a)=>r+a.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(a=>({data:a.data.getState()}))),r}}const BO={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function C6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BO,n),O.obj(t,e),GO(t,e)}const AO=O.newInstance(C6,"vtkFieldData");var WO={newInstance:AO,extend:C6};const zO={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},$O={MAX:0,EXACT:1,NOLIMIT:2},jO={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},HO={DUPLICATEPOINT:1,HIDDENPOINT:2},KO={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},qO="vtkGhostType",XO={DEFAULT:0,SINGLE:1,DOUBLE:2};var T6={AttributeCopyOperations:KO,AttributeLimitTypes:$O,AttributeTypes:zO,CellGhostTypes:jO,DesiredOutputPrecision:XO,PointGhostTypes:HO,ghostArrayName:qO};const{AttributeTypes:br,AttributeCopyOperations:Sa}=T6,{vtkWarningMacro:H0}=O;function YO(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(s){let o=n.find(c=>br[c.toUpperCase()]===s||typeof s!="number"&&c.toLowerCase()===s.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");const a={...t};t.checkNumberOfComponents=s=>!0,t.setAttribute=(s,o)=>{const c=r(o);if(s&&c.toUpperCase()==="PEDIGREEIDS"&&!s.isA("vtkDataArray"))return H0(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(s&&!t.checkNumberOfComponents(s,c))return H0(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===s)return l;t.removeArrayByIndex(l)}return s?(l=t.addArray(s),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=s=>n.filter(o=>t[`get${o}`]()===s),t.setActiveAttributeByName=(s,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(s).index,o),t.setActiveAttributeByIndex=(s,o)=>{const c=r(o);if(s>=0&&s<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(s);if(!l.isA("vtkDataArray"))return H0(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return H0(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=s,t.modified(),s}return s===-1&&(e[`active${c}`]=s,t.modified()),-1},t.getActiveAttribute=s=>{const o=r(s);return t[`get${o}`]()},t.removeAllArrays=()=>{n.forEach(s=>{e[`active${s}`]=-1}),a.removeAllArrays()},t.removeArrayByIndex=s=>(s!==-1&&n.forEach(o=>{s===e[`active${o}`]?e[`active${o}`]=-1:s<e[`active${o}`]&&(e[`active${o}`]-=1)}),a.removeArrayByIndex(s)),n.forEach(s=>{const o=`active${s}`;t[`get${s}`]=()=>t.getArrayByIndex(e[o]),t[`set${s}`]=c=>t.setAttribute(c,s),t[`setActive${s}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,s),t[`copy${s}Off`]=()=>{const c=s.toUpperCase();e.copyAttributeFlags[Sa.PASSDATA][br[c]]=!1},t[`copy${s}On`]=()=>{const c=s.toUpperCase();e.copyAttributeFlags[Sa.PASSDATA][br[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(Sa).filter(s=>s!=="ALLCOPY").forEach(s=>{e.copyAttributeFlags[Sa[s]]=Object.keys(br).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,c)=>(o[br[c]]=!0,o),[])}),e.copyAttributeFlags[Sa.COPYTUPLE][br.GLOBALIDS]=!1,e.copyAttributeFlags[Sa.INTERPOLATE][br.GLOBALIDS]=!1,e.copyAttributeFlags[Sa.COPYTUPLE][br.PEDIGREEIDS]=!1},t.initialize=O.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(s=>{!e.dataArrays[s].ref&&e.dataArrays[s].type==="vtkDataArray"&&t.addArray(le.newInstance(e.dataArrays[s]))});const i=t.shallowCopy;t.shallowCopy=(s,o)=>{i(s,o),e.arrays=s.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,o),{data:l}})},t.initializeAttributeCopyFlags()}const ZO={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function x6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZO,n),WO.extend(t,e,n),O.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),YO(t,e)}const QO=O.newInstance(x6,"vtkDataSetAttributes");var Wd={newInstance:QO,extend:x6,...T6};const JO={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},eM={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var tM={FieldDataTypes:JO,FieldAssociations:eM};const e2=["pointData","cellData","fieldData"];function nM(t,e){e.classHierarchy.push("vtkDataSet"),e2.forEach(r=>{e[r]?e[r]=Gn(e[r]):e[r]=Wd.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,a),e2.forEach(i=>{e[i]=Wd.newInstance(),e[i].shallowCopy(r.getReferenceByName(i))})}}const rM={};function S6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rM,n),O.obj(t,e),O.setGet(t,e,e2),nM(t,e)}const aM=O.newInstance(S6,"vtkDataSet");var Rs={newInstance:aM,extend:S6,...tM};const{FieldAssociations:iM}=Rs;function sM(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,a,i,s)=>{},t.selectAsync=async(n,r,a,i,s)=>{const o=await t.getSourceDataAsync(n,r,a,i,s);return o?o.generateSelection(r,a,i,s):[]}}const oM={fieldAssociation:iM.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function w6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oM,n),O.obj(t,e),O.setGet(t,e,["fieldAssociation","captureZValues"]),sM(t,e)}const cM=O.newInstance(w6,"vtkHardwareSelector");var lM={newInstance:cM,extend:w6};const uM={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},fM={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var gM={SelectionContent:uM,SelectionField:fM};function pM(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const dM={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function E6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dM,n),O.obj(t,e),e.properties={},O.setGet(t,e,["contentType","fieldType","properties","selectionList"]),pM(t,e)}const hM=O.newInstance(E6,"vtkSelectionNode");var R6={newInstance:hM,extend:E6,...gM};const{PassTypes:rt}=y6,{SelectionContent:mM,SelectionField:zd}=R6,{FieldAssociations:mo}=Rs,{vtkErrorMacro:O6}=O,Zr=1;function M6(t){return`${t.propID} ${t.compositeID}`}function D6(t,e,n,r){if(!n)return 0;const a=(e*(r[2]-r[0]+1)+t)*4;return n[a+3]}function yr(t,e,n,r){if(!n)return 0;const a=(e*(r[2]-r[0]+1)+t)*4,i=n[a],s=n[a+1];return(n[a+2]*256+s)*256+i}function V6(t,e){let n=e;return n<<=24,n|=t,n}function vM(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const a=[e[0]-t.area[0],e[1]-t.area[1]],i=yr(a[0],a[1],t.pixBuffer[rt.ACTOR_PASS],t.area);if(i<=0||i-Zr>=t.props.length)return null;const s={};s.valid=!0,s.propID=i-Zr,s.prop=t.props[s.propID];let o=yr(a[0],a[1],t.pixBuffer[rt.COMPOSITE_INDEX_PASS],t.area);if((o<0||o>16777215)&&(o=0),s.compositeID=o-Zr,t.captureZValues){const f=(a[1]*(t.area[2]-t.area[0]+1)+a[0])*4;s.zValue=(256*t.zBuffer[f]+t.zBuffer[f+1])/65535,s.displayPosition=e}if(t.pixBuffer[rt.ID_LOW24]&&D6(a[0],a[1],t.pixBuffer[rt.ID_LOW24],t.area)===0)return s;const c=yr(a[0],a[1],t.pixBuffer[rt.ID_LOW24],t.area),l=yr(a[0],a[1],t.pixBuffer[rt.ID_HIGH24],t.area);return s.attributeID=V6(c,l),s}}function L6(t,e,n,r,a){const i=[];let s=0;return e.forEach((o,c)=>{const l=R6.newInstance();switch(l.setContentType(mM.INDICES),t){case mo.FIELD_ASSOCIATION_CELLS:l.setFieldType(zd.CELL);break;case mo.FIELD_ASSOCIATION_POINTS:l.setFieldType(zd.POINT);break;default:O6("Unknown field association")}l.getProperties().propID=o.info.propID,l.getProperties().prop=o.info.prop,l.getProperties().compositeID=o.info.compositeID,l.getProperties().attributeID=o.info.attributeID,l.getProperties().pixelCount=o.pixelCount,n&&(l.getProperties().displayPosition=[o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue],l.getProperties().worldPosition=a.displayToWorld(o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue,r)),l.setSelectionList(o.attributeIDs),i[s]=l,s++}),i}function yM(t,e,n,r,a){const i=Math.floor(e),s=Math.floor(n),o=Math.floor(r),c=Math.floor(a),l=new Map,f=[0,0];for(let u=s;u<=c;u++)for(let g=i;g<=o;g++){const h=vM(t,[g,u],0,f);if(h&&h.valid){const d=M6(h);if(!l.has(d))l.set(d,{info:h,pixelCount:1,attributeIDs:[h.attributeID]});else{const m=l.get(d);m.pixelCount++,t.captureZValues&&h.zValue<m.info.zValue&&(m.info=h),m.attributeIDs.indexOf(h.attributeID)===-1&&m.attributeIDs.push(h.attributeID)}}}return L6(t.fieldAssociation,l,t.captureZValues,t.renderer,t.openGLRenderWindow)}function CM(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Cu.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const a=e.framebuffer.getSize();!a||a[0]!==r[0]||a[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===mo.FIELD_ASSOCIATION_POINTS){const a=e._openGLRenderWindow.getContext(),i=a.isEnabled(a.BLEND);a.disable(a.BLEND),e._openGLRenderWindow.traverseAllPasses(),i&&a.enable(a.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,a,i,s,o)=>{if(e._renderer=r,a===void 0){const l=e._openGLRenderWindow.getSize();t.setArea(0,0,l[0]-1,l[1]-1)}else t.setArea(a,i,s,o);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var l=arguments.length,f=new Array(l),u=0;u<l;u++)f[u]=arguments[u];return yM(c,...f)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return O6("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const a=[];for(e.currentPass=rt.MIN_KNOWN_PASS;e.currentPass<=rt.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===rt.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),a.push(e.currentPass));return a.forEach(i=>{e.currentPass=i,t.processPixelBuffers()}),e.currentPass=rt.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,a)=>{t.isPropHit(a)&&r.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=r=>{if(r===rt.ID_HIGH24){if(e.fieldAssociation===mo.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===mo.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(a),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===rt.ACTOR_PASS){if(e.captureZValues){const a=e._openGLRenderWindow.getRenderPasses();if(typeof a[0].requestDepth=="function"&&typeof a[0].getFramebuffer=="function"){const i=a[0].getFramebuffer();i.saveCurrentBindingsAndBuffers(),i.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),i.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let a=0;for(let i=0;i<=e.area[3]-e.area[1];i++)for(let s=0;s<=e.area[2]-e.area[0];s++){let o=yr(s,i,r,e.area);o>0&&(o--,o in e.hitProps||(e.hitProps[o]=!0,e.propPixels[o]=[]),e.propPixels[o].push(a*4)),++a}},t.renderProp=r=>{e.currentPass===rt.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Zr),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===rt.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+Zr)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>O.enumToString(rt,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,a,i)=>{const s=a<0?0:a;if(s===0){if(i[0]=r[0],i[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const f=[r[0]-e.area[0],r[1]-e.area[1]],u=yr(f[0],f[1],e.pixBuffer[rt.ACTOR_PASS],e.area);if(u<=0||u-Zr>=e.props.length)return null;const g={};g.valid=!0,g.propID=u-Zr,g.prop=e.props[g.propID];let p=yr(f[0],f[1],e.pixBuffer[rt.COMPOSITE_INDEX_PASS],e.area);if((p<0||p>16777215)&&(p=0),g.compositeID=p-Zr,e.captureZValues){const m=(f[1]*(e.area[2]-e.area[0]+1)+f[0])*4;g.zValue=(256*e.zBuffer[m]+e.zBuffer[m+1])/65535,g.displayPosition=r}if(e.pixBuffer[rt.ID_LOW24]&&D6(f[0],f[1],e.pixBuffer[rt.ID_LOW24],e.area)===0)return g;const h=yr(f[0],f[1],e.pixBuffer[rt.ID_LOW24],e.area),d=yr(f[0],f[1],e.pixBuffer[rt.ID_HIGH24],e.area);return g.attributeID=V6(h,d),g}const o=[r[0],r[1]],c=[0,0];let l=t.getPixelInformation(r,0,i);if(l&&l.valid)return l;for(let f=1;f<s;++f){for(let u=o[1]>f?o[1]-f:0;u<=o[1]+f;++u)if(c[1]=u,o[0]>=f&&(c[0]=o[0]-f,l=t.getPixelInformation(c,0,i),l&&l.valid)||(c[0]=o[0]+f,l=t.getPixelInformation(c,0,i),l&&l.valid))return l;for(let u=o[0]>=f?o[0]-(f-1):0;u<=o[0]+(f-1);++u)if(c[0]=u,o[1]>=f&&(c[1]=o[1]-f,l=t.getPixelInformation(c,0,i),l&&l.valid)||(c[1]=o[1]+f,l=t.getPixelInformation(c,0,i),l&&l.valid))return l}return i[0]=r[0],i[1]=r[1],null},t.generateSelection=(r,a,i,s)=>{const o=Math.floor(r),c=Math.floor(a),l=Math.floor(i),f=Math.floor(s),u=new Map,g=[0,0];for(let p=c;p<=f;p++)for(let h=o;h<=l;h++){const d=[h,p],m=t.getPixelInformation(d,0,g);if(m&&m.valid){const v=M6(m);if(!u.has(v))u.set(v,{info:m,pixelCount:1,attributeIDs:[m.attributeID]});else{const C=u.get(v);C.pixelCount++,e.captureZValues&&m.zValue<C.info.zValue&&(C.info=m),C.attributeIDs.indexOf(m.attributeID)===-1&&C.attributeIDs.push(m.attributeID)}}}return L6(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,a)=>{e._openGLRenderWindow=r,e._renderer=a};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const TM={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function _6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TM,n),lM.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),O.setGetArray(t,e,["area"],4),O.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),O.setGetArray(t,e,["propColorValue"],3),O.moveToProtected(t,e,["renderer","openGLRenderWindow"]),O.event(t,e,"event"),CM(t,e)}const xM=O.newInstance(_6,"vtkOpenGLHardwareSelector");var e5={newInstance:xM,extend:_6,...y6},N6={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function a(v,C){var y=v[0],T=v[1],x=v[2],S=v[3];y+=(T&x|~T&S)+C[0]-680876936|0,y=(y<<7|y>>>25)+T|0,S+=(y&T|~y&x)+C[1]-389564586|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&T)+C[2]+606105819|0,x=(x<<17|x>>>15)+S|0,T+=(x&S|~x&y)+C[3]-1044525330|0,T=(T<<22|T>>>10)+x|0,y+=(T&x|~T&S)+C[4]-176418897|0,y=(y<<7|y>>>25)+T|0,S+=(y&T|~y&x)+C[5]+1200080426|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&T)+C[6]-1473231341|0,x=(x<<17|x>>>15)+S|0,T+=(x&S|~x&y)+C[7]-45705983|0,T=(T<<22|T>>>10)+x|0,y+=(T&x|~T&S)+C[8]+1770035416|0,y=(y<<7|y>>>25)+T|0,S+=(y&T|~y&x)+C[9]-1958414417|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&T)+C[10]-42063|0,x=(x<<17|x>>>15)+S|0,T+=(x&S|~x&y)+C[11]-1990404162|0,T=(T<<22|T>>>10)+x|0,y+=(T&x|~T&S)+C[12]+1804603682|0,y=(y<<7|y>>>25)+T|0,S+=(y&T|~y&x)+C[13]-40341101|0,S=(S<<12|S>>>20)+y|0,x+=(S&y|~S&T)+C[14]-1502002290|0,x=(x<<17|x>>>15)+S|0,T+=(x&S|~x&y)+C[15]+1236535329|0,T=(T<<22|T>>>10)+x|0,y+=(T&S|x&~S)+C[1]-165796510|0,y=(y<<5|y>>>27)+T|0,S+=(y&x|T&~x)+C[6]-1069501632|0,S=(S<<9|S>>>23)+y|0,x+=(S&T|y&~T)+C[11]+643717713|0,x=(x<<14|x>>>18)+S|0,T+=(x&y|S&~y)+C[0]-373897302|0,T=(T<<20|T>>>12)+x|0,y+=(T&S|x&~S)+C[5]-701558691|0,y=(y<<5|y>>>27)+T|0,S+=(y&x|T&~x)+C[10]+38016083|0,S=(S<<9|S>>>23)+y|0,x+=(S&T|y&~T)+C[15]-660478335|0,x=(x<<14|x>>>18)+S|0,T+=(x&y|S&~y)+C[4]-405537848|0,T=(T<<20|T>>>12)+x|0,y+=(T&S|x&~S)+C[9]+568446438|0,y=(y<<5|y>>>27)+T|0,S+=(y&x|T&~x)+C[14]-1019803690|0,S=(S<<9|S>>>23)+y|0,x+=(S&T|y&~T)+C[3]-187363961|0,x=(x<<14|x>>>18)+S|0,T+=(x&y|S&~y)+C[8]+1163531501|0,T=(T<<20|T>>>12)+x|0,y+=(T&S|x&~S)+C[13]-1444681467|0,y=(y<<5|y>>>27)+T|0,S+=(y&x|T&~x)+C[2]-51403784|0,S=(S<<9|S>>>23)+y|0,x+=(S&T|y&~T)+C[7]+1735328473|0,x=(x<<14|x>>>18)+S|0,T+=(x&y|S&~y)+C[12]-1926607734|0,T=(T<<20|T>>>12)+x|0,y+=(T^x^S)+C[5]-378558|0,y=(y<<4|y>>>28)+T|0,S+=(y^T^x)+C[8]-2022574463|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^T)+C[11]+1839030562|0,x=(x<<16|x>>>16)+S|0,T+=(x^S^y)+C[14]-35309556|0,T=(T<<23|T>>>9)+x|0,y+=(T^x^S)+C[1]-1530992060|0,y=(y<<4|y>>>28)+T|0,S+=(y^T^x)+C[4]+1272893353|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^T)+C[7]-155497632|0,x=(x<<16|x>>>16)+S|0,T+=(x^S^y)+C[10]-1094730640|0,T=(T<<23|T>>>9)+x|0,y+=(T^x^S)+C[13]+681279174|0,y=(y<<4|y>>>28)+T|0,S+=(y^T^x)+C[0]-358537222|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^T)+C[3]-722521979|0,x=(x<<16|x>>>16)+S|0,T+=(x^S^y)+C[6]+76029189|0,T=(T<<23|T>>>9)+x|0,y+=(T^x^S)+C[9]-640364487|0,y=(y<<4|y>>>28)+T|0,S+=(y^T^x)+C[12]-421815835|0,S=(S<<11|S>>>21)+y|0,x+=(S^y^T)+C[15]+530742520|0,x=(x<<16|x>>>16)+S|0,T+=(x^S^y)+C[2]-995338651|0,T=(T<<23|T>>>9)+x|0,y+=(x^(T|~S))+C[0]-198630844|0,y=(y<<6|y>>>26)+T|0,S+=(T^(y|~x))+C[7]+1126891415|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~T))+C[14]-1416354905|0,x=(x<<15|x>>>17)+S|0,T+=(S^(x|~y))+C[5]-57434055|0,T=(T<<21|T>>>11)+x|0,y+=(x^(T|~S))+C[12]+1700485571|0,y=(y<<6|y>>>26)+T|0,S+=(T^(y|~x))+C[3]-1894986606|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~T))+C[10]-1051523|0,x=(x<<15|x>>>17)+S|0,T+=(S^(x|~y))+C[1]-2054922799|0,T=(T<<21|T>>>11)+x|0,y+=(x^(T|~S))+C[8]+1873313359|0,y=(y<<6|y>>>26)+T|0,S+=(T^(y|~x))+C[15]-30611744|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~T))+C[6]-1560198380|0,x=(x<<15|x>>>17)+S|0,T+=(S^(x|~y))+C[13]+1309151649|0,T=(T<<21|T>>>11)+x|0,y+=(x^(T|~S))+C[4]-145523070|0,y=(y<<6|y>>>26)+T|0,S+=(T^(y|~x))+C[11]-1120210379|0,S=(S<<10|S>>>22)+y|0,x+=(y^(S|~T))+C[2]+718787259|0,x=(x<<15|x>>>17)+S|0,T+=(S^(x|~y))+C[9]-343485551|0,T=(T<<21|T>>>11)+x|0,v[0]=y+v[0]|0,v[1]=T+v[1]|0,v[2]=x+v[2]|0,v[3]=S+v[3]|0}function i(v){var C=[],y;for(y=0;y<64;y+=4)C[y>>2]=v.charCodeAt(y)+(v.charCodeAt(y+1)<<8)+(v.charCodeAt(y+2)<<16)+(v.charCodeAt(y+3)<<24);return C}function s(v){var C=[],y;for(y=0;y<64;y+=4)C[y>>2]=v[y]+(v[y+1]<<8)+(v[y+2]<<16)+(v[y+3]<<24);return C}function o(v){var C=v.length,y=[1732584193,-271733879,-1732584194,271733878],T,x,S,w,E,L;for(T=64;T<=C;T+=64)a(y,i(v.substring(T-64,T)));for(v=v.substring(T-64),x=v.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<x;T+=1)S[T>>2]|=v.charCodeAt(T)<<(T%4<<3);if(S[T>>2]|=128<<(T%4<<3),T>55)for(a(y,S),T=0;T<16;T+=1)S[T]=0;return w=C*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(w[2],16),L=parseInt(w[1],16)||0,S[14]=E,S[15]=L,a(y,S),y}function c(v){var C=v.length,y=[1732584193,-271733879,-1732584194,271733878],T,x,S,w,E,L;for(T=64;T<=C;T+=64)a(y,s(v.subarray(T-64,T)));for(v=T-64<C?v.subarray(T-64):new Uint8Array(0),x=v.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<x;T+=1)S[T>>2]|=v[T]<<(T%4<<3);if(S[T>>2]|=128<<(T%4<<3),T>55)for(a(y,S),T=0;T<16;T+=1)S[T]=0;return w=C*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(w[2],16),L=parseInt(w[1],16)||0,S[14]=E,S[15]=L,a(y,S),y}function l(v){var C="",y;for(y=0;y<4;y+=1)C+=r[v>>y*8+4&15]+r[v>>y*8&15];return C}function f(v){var C;for(C=0;C<v.length;C+=1)v[C]=l(v[C]);return v.join("")}f(o("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function v(C,y){return C=C|0||0,C<0?Math.max(C+y,0):Math.min(C,y)}ArrayBuffer.prototype.slice=function(C,y){var T=this.byteLength,x=v(C,T),S=T,w,E,L,R;return y!==n&&(S=v(y,T)),x>S?new ArrayBuffer(0):(w=S-x,E=new ArrayBuffer(w),L=new Uint8Array(E),R=new Uint8Array(this,x,w),L.set(R),E)}}();function u(v){return/[\u0080-\uFFFF]/.test(v)&&(v=unescape(encodeURIComponent(v))),v}function g(v,C){var y=v.length,T=new ArrayBuffer(y),x=new Uint8Array(T),S;for(S=0;S<y;S+=1)x[S]=v.charCodeAt(S);return C?x:T}function p(v){return String.fromCharCode.apply(null,new Uint8Array(v))}function h(v,C,y){var T=new Uint8Array(v.byteLength+C.byteLength);return T.set(new Uint8Array(v)),T.set(new Uint8Array(C),v.byteLength),T}function d(v){var C=[],y=v.length,T;for(T=0;T<y-1;T+=2)C.push(parseInt(v.substr(T,2),16));return String.fromCharCode.apply(String,C)}function m(){this.reset()}return m.prototype.append=function(v){return this.appendBinary(u(v)),this},m.prototype.appendBinary=function(v){this._buff+=v,this._length+=v.length;var C=this._buff.length,y;for(y=64;y<=C;y+=64)a(this._hash,i(this._buff.substring(y-64,y)));return this._buff=this._buff.substring(y-64),this},m.prototype.end=function(v){var C=this._buff,y=C.length,T,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S;for(T=0;T<y;T+=1)x[T>>2]|=C.charCodeAt(T)<<(T%4<<3);return this._finish(x,y),S=f(this._hash),v&&(S=d(S)),this.reset(),S},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(v){return this._buff=v.buff,this._length=v.length,this._hash=v.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(v,C){var y=C,T,x,S;if(v[y>>2]|=128<<(y%4<<3),y>55)for(a(this._hash,v),y=0;y<16;y+=1)v[y]=0;T=this._length*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),x=parseInt(T[2],16),S=parseInt(T[1],16)||0,v[14]=x,v[15]=S,a(this._hash,v)},m.hash=function(v,C){return m.hashBinary(u(v),C)},m.hashBinary=function(v,C){var y=o(v),T=f(y);return C?d(T):T},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(v){var C=h(this._buff.buffer,v),y=C.length,T;for(this._length+=v.byteLength,T=64;T<=y;T+=64)a(this._hash,s(C.subarray(T-64,T)));return this._buff=T-64<y?new Uint8Array(C.buffer.slice(T-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(v){var C=this._buff,y=C.length,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x,S;for(x=0;x<y;x+=1)T[x>>2]|=C[x]<<(x%4<<3);return this._finish(T,y),S=f(this._hash),v&&(S=d(S)),this.reset(),S},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var v=m.prototype.getState.call(this);return v.buff=p(v.buff),v},m.ArrayBuffer.prototype.setState=function(v){return v.buff=g(v.buff,!0),m.prototype.setState.call(this,v)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(v,C){var y=c(new Uint8Array(v)),T=f(y);return C?d(T):T},m})})(N6);var SM=N6.exports;const wM=Yl(SM),EM=["lastShaderProgramBound","context","_openGLRenderWindow"];function RM(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,a)=>{let i=r;a.length>0&&(i=G.substitute(i,"VSOut","GSOut").result);const s=e._openGLRenderWindow.getWebgl2();let o=`
`,c=`#version 100
`;s?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(o=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(o+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),i=G.substitute(i,"//VTK::System::Dec",[`${c}
`,s?"":`#extension GL_OES_standard_derivatives : enable
`,o,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=G.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(s){l=G.substitute(l,"varying","out").result,i=G.substitute(i,"varying","in").result;let u="",g=0;for(;i.includes(`gl_FragData[${g}]`);)i=G.substitute(i,`gl_FragData\\[${g}\\]`,`fragOutput${g}`).result,u+=`layout(location = ${g}) out vec4 fragOutput${g};
`,g++;i=G.substitute(i,"//VTK::Output::Dec",u).result}const f=G.substitute(a,"//VTK::System::Dec",c).result;return{VSSource:l,FSSource:i,GSSource:f}},t.readyShaderProgramArray=(n,r,a)=>{const i=t.replaceShaderValues(n,r,a),s=t.getShaderProgram(i.VSSource,i.FSSource,i.GSSource);return t.readyShaderProgram(s)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,a)=>{const i=`${n}${r}${a}`,s=wM.hash(i);if(!(s in e.shaderPrograms)){const o=G.newInstance();return o.setContext(e.context),o.getVertexShader().setSource(n),o.getFragmentShader().setSource(r),a&&o.getGeometryShader().setSource(a),o.setMd5Hash(s),e.shaderPrograms[s]=o,o}return e.shaderPrograms[s]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const OM={lastShaderProgramBound:null,shaderPrograms:null,context:null};function I6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OM,n),e.shaderPrograms={},O.obj(t,e),O.setGet(t,e,EM),O.moveToProtected(t,e,["openGLRenderWindow"]),RM(t,e)}const MM=O.newInstance(I6,"vtkShaderCache");var DM={newInstance:MM,extend:I6};const{vtkErrorMacro:VM}=O;function LM(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&VM("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const _M={context:null,numberOfTextureUnits:0,textureUnits:0};function F6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_M,n),O.obj(t,e),e.textureUnits=[],O.get(t,e,["numberOfTextureUnits"]),O.setGet(t,e,["context"]),LM(t,e)}const NM=O.newInstance(F6,"vtkOpenGLTextureUnitManager");var IM={newInstance:NM,extend:F6};function FM(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,a)=>{const i=a.getViewportByReference(),s=t.getFramebufferSize();return i[0]*s[0]<=n&&i[2]*s[0]>=n&&i[1]*s[1]<=r&&i[3]*s[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),a=t.getFramebufferSize();return[(r[2]-r[0])*a[0],(r[3]-r[1])*a[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,a)=>{const i=t.getFramebufferSize();return[n/i[0],r/i[1],a]},t.normalizedDisplayToDisplay=(n,r,a)=>{const i=t.getFramebufferSize();return[n*i[0],r*i[1],a]},t.worldToView=(n,r,a,i)=>i.worldToView(n,r,a),t.viewToWorld=(n,r,a,i)=>i.viewToWorld(n,r,a),t.worldToDisplay=(n,r,a,i)=>{const s=i.worldToView(n,r,a),o=t.getViewportSize(i),c=i.viewToProjection(s[0],s[1],s[2],o[0]/o[1]),l=i.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(l[0],l[1],l[2])},t.displayToWorld=(n,r,a,i)=>{const s=t.displayToNormalizedDisplay(n,r,a),o=i.normalizedDisplayToProjection(s[0],s[1],s[2]),c=t.getViewportSize(i),l=i.projectionToView(o[0],o[1],o[2],c[0]/c[1]);return i.viewToWorld(l[0],l[1],l[2])},t.normalizedDisplayToViewport=(n,r,a,i)=>{let s=i.getViewportByReference();s=t.normalizedDisplayToDisplay(s[0],s[1],0);const o=t.normalizedDisplayToDisplay(n,r,a);return[o[0]-s[0]-.5,o[1]-s[1]-.5,a]},t.viewportToNormalizedViewport=(n,r,a,i)=>{const s=t.getViewportSize(i);return s&&s[0]!==0&&s[1]!==0?[n/(s[0]-1),r/(s[1]-1),a]:[n,r,a]},t.normalizedViewportToViewport=(n,r,a,i)=>{const s=t.getViewportSize(i);return[n*(s[0]-1),r*(s[1]-1),a]},t.displayToLocalDisplay=(n,r,a)=>{const i=t.getFramebufferSize();return[n,i[1]-r-1,a]},t.viewportToNormalizedDisplay=(n,r,a,i)=>{let s=i.getViewportByReference();s=t.normalizedDisplayToDisplay(s[0],s[1],0);const o=n+s[0]+.5,c=r+s[1]+.5;return t.displayToNormalizedDisplay(o,c,a)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{O.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,a,i)=>{O.vtkErrorMacro("not implemented")},t.createSelector=()=>{O.vtkErrorMacro("not implemented")}}const kM={size:void 0,selector:void 0};function k6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kM,n),e.size||(e.size=[300,300]),O.getArray(t,e,["size"],2),O.get(t,e,["selector"]),st.extend(t,e,n),FM(t,e)}const UM=O.newInstance(k6,"vtkRenderWindowViewNode");var PM={newInstance:UM,extend:k6};const bM="__getUnderlyingContext";function GM(){const t=new Map,e={apply(a,i,s){return t.has(s[0])?t.get(s[0]):a.apply(i,s)}};function n(a){return{apply(i,s,o){return t.set(a,o[0]),i.apply(s,o)}}}const r=Object.create(null);return r.getParameter=(a,i,s,o)=>new Proxy(o.bind(a),e),r.depthMask=(a,i,s,o)=>new Proxy(o.bind(a),n(a.DEPTH_WRITEMASK)),{get(a,i,s){if(i===bM)return()=>a;let o=Reflect.get(a,i,a);o instanceof Function&&(o=o.bind(a));const c=r[i];return c?c(a,i,s,o):o}}}const{vtkDebugMacro:$d,vtkErrorMacro:jd}=O,BM={position:"absolute",top:0,left:0,width:"100%",height:"100%"},AM=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Bt(t,e,n){const r=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),i===t.FRAMEBUFFER_COMPLETE}let Ll=0;const Tu=[];function WM(){Ll++,Tu.forEach(t=>t(Ll))}function zM(){Ll--,Tu.forEach(t=>t(Ll))}function $M(t){Tu.push(t)}function jM(t){return Tu.pop()}function Hd(t){t.preventDefault()}function HM(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=GM()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",Hd,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const a=[0,0];function i(){e.renderable&&(e.size[0]!==a[0]||e.size[1]!==a[1])&&(a[0]=e.size[0],a[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(i),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(g=>{var p;(p=g.setOpenGLRenderWindow)==null||p.call(g,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&WM(),e.textureUnitManager=IM.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&jd("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:u,height:g}=e.el.getBoundingClientRect();e.containerSize=[u,g]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var g;return((g=e.activeFramebuffer)==null?void 0:g.getSize())||e.size},t.getPixelData=(u,g,p,h)=>{const d=new Uint8Array((p-u+1)*(h-g+1)*4);return e.context.readPixels(u,g,p-u+1,h-g+1,e.context.RGBA,e.context.UNSIGNED_BYTE,d),d},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},g=null;const p=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&p&&(g=e.canvas.getContext("webgl2",u),g&&(e.webgl2=!0,$d("using webgl2"))),g||($d("using webgl1"),g=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(g,r())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{const u=Qg.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{const g=e._textureResourceIds.get(u);if(g!==void 0){e.context.activeTexture(e.context.TEXTURE0+g);return}const p=t.getTextureUnitManager().allocate();if(p<0){jd("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,p),e.context.activeTexture(e.context.TEXTURE0+p)},t.deactivateTexture=u=>{const g=e._textureResourceIds.get(u);g!==void 0&&(t.getTextureUnitManager().free(g),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{const g=e._textureResourceIds.get(u);return g!==void 0?g:-1},t.getDefaultTextureByteSize=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case ce.CHAR:case ce.SIGNED_CHAR:case ce.UNSIGNED_CHAR:return 1;case g:case p:case ce.UNSIGNED_SHORT:case ce.SHORT:case ce.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,g){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case ce.UNSIGNED_CHAR:switch(g){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(p&&!h&&ce.UNSIGNED_SHORT):switch(g){case 1:return p.R16_EXT;case 2:return p.RG16_EXT;case 3:return p.RGB16_EXT;case 4:default:return p.RGBA16_EXT}case(p&&!h&&ce.SHORT):switch(g){case 1:return p.R16_SNORM_EXT;case 2:return p.RG16_SNORM_EXT;case 3:return p.RGB16_SNORM_EXT;case 4:default:return p.RGBA16_SNORM_EXT}case ce.UNSIGNED_SHORT:case ce.SHORT:case ce.FLOAT:default:switch(g){case 1:return h?e.context.R16F:e.context.R32F;case 2:return h?e.context.RG16F:e.context.RG32F;case 3:return h?e.context.RGB16F:e.context.RGB32F;case 4:default:return h?e.context.RGBA16F:e.context.RGBA32F}}switch(g){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function s(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const g=document.createElement("canvas"),p=g.getContext("2d");g.width=e.canvas.width,g.height=e.canvas.height,p.drawImage(e.canvas,0,0);const h=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(C=>{C.getViewProps().forEach(T=>{if(T.getContainer){const S=T.getContainer().getElementsByTagName("canvas");for(let w=0;w<S.length;w++){const E=S[w],L=E.getBoundingClientRect(),R=L.x-h.x,D=L.y-h.y;p.drawImage(E,R,D)}}})});const v=g.toDataURL(u);g.remove(),t.invokeImageReady(v)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:g=!1,size:p=null,scale:h=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;const d=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:p||h!==1?p||e.size.map(m=>m*h):null},new Promise((m,v)=>{const C=t.onImageReady(y=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=d,C.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(T=>{let{restoreParamsFn:x,arg:S}=T;return x(S)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),m(y);else{const T=document.createElement("img");if(T.style=BM,T.src=y,e._screenshot.placeHolder=e.el.appendChild(T),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),g){const x=g!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(S=>{const w=S.getActiveCamera(),E=w.get("focalPoint","position","parallelScale");return{resetCameraArgs:x?{renderer:S}:void 0,resetCameraFn:x?g:S.resetCamera,restoreParamsFn:w.set,arg:JSON.parse(JSON.stringify(E))}}),e._screenshot.cameras.forEach(S=>{let{resetCameraFn:w,resetCameraArgs:E}=S;return w(E)})}t.traverseAllPasses()}})})};let o;t.getHardwareMaximumLineWidth=()=>{if(o!=null)return o;const u=t.get3DContext(),g=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return o=g[1],g[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const u=t.get3DContext(),g=u.getExtension("OES_texture_float"),p=u.getExtension("OES_texture_half_float"),h=u.getExtension("WEBGL_debug_renderer_info"),d=u.getExtension("WEBGL_draw_buffers"),m=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),v=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",m&&u.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[g&&Bt(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",g&&Bt(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",g&&Bt(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",g&&Bt(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",g&&Bt(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[p&&Bt(u,u.RGBA,p.HALF_FLOAT_OES)?"RGBA":"",p&&Bt(u,u.RGB,p.HALF_FLOAT_OES)?"RGB":"",p&&Bt(u,u.LUMINANCE,p.HALF_FLOAT_OES)?"LUMINANCE":"",p&&Bt(u,u.ALPHA,p.HALF_FLOAT_OES)?"ALPHA":"",p&&Bt(u,u.LUMINANCE_ALPHA,p.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[g&&Bt(u,u.RGBA,u.FLOAT)?"RGBA":"",g&&Bt(u,u.RGB,u.FLOAT)?"RGB":"",g&&Bt(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",g&&Bt(u,u.ALPHA,u.FLOAT)?"ALPHA":"",g&&Bt(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",d?u.getParameter(d.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",h&&u.getParameter(h.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",h&&u.getParameter(h.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],C={};for(;v.length;){const[y,T,x]=v.pop();T&&(C[T]={label:y,value:x})}return e._glInformation=C,C},t.traverseAllPasses=()=>{var g;if(e.renderPasses)for(let p=0;p<e.renderPasses.length;++p)e.renderPasses[p].traverse(t,null);e.notifyStartCaptureImage&&s(),t.copyParentContent();const u=e.renderable.getChildRenderWindowsByReference();for(let p=0;p<u.length;++p)(g=t.getViewNodeFor(u[p]))==null||g.traverseAllPasses()},t.copyParentContent=()=>{const u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(h=>{var d;return!!((d=h.getSelector)!=null&&d.call(h))}))return;const g=u.getCanvas(),p=e.canvas;e.context2D.drawImage(g,0,g.height-p.height,p.width,p.height,0,0,p.width,p.height)},t.resizeFromChildRenderWindows=()=>{var g;const u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){const p=[0,0];for(let h=0;h<u.length;++h){const d=(g=t.getViewNodeFor(u[h]))==null?void 0:g.getSize();d&&(p[0]=d[0]>p[0]?d[0]:p[0],p[1]=d[1]>p[1]?d[1]:p[1])}t.setSize(...p)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){const g=e.renderable.getRenderers()[0];g.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(p=>t.setBackgroundImage(p.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const u=e5.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",Hd),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=O.chain(()=>{e.context&&zM(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};const l=t.setSize;t.setSize=(u,g)=>{const p=l(u,g);return p&&t.invokeWindowResizeEvent({width:u,height:g}),p},t.registerGraphicsResourceUser=(u,g)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null);const p=e._graphicsResources.get(u);p==null||p.users.add(g)},t.unregisterGraphicsResourceUser=(u,g)=>{var h;const p=e._graphicsResources.get(u);p&&(p.users.delete(g),p.users.size||((h=p.oglObject)==null||h.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,g,p)=>{var d;if(!u)return;const h=e._graphicsResources.get(u);(d=h==null?void 0:h.oglObject)==null||d.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:g,hash:p,users:(h==null?void 0:h.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(g=>{let{oglObject:p}=g;u+=p.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:g}=u;g.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{const g=t.getViewNodeFor(u);g==null||g.releaseGraphicsResources()})};const f={...t};AM.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):f[u](...arguments)}})}const KM={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function U6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KM,n),PM.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=e5.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=WR.newInstance(),e.shaderCache=DM.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=PO.newInstance(),O.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),O.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),O.setGetArray(t,e,["size"],2),O.event(t,e,"imageReady"),O.event(t,e,"windowResizeEvent"),HM(t,e)}const t5=O.newInstance(U6,"vtkOpenGLRenderWindow");S9("WebGL",t5);var qM={newInstance:t5,extend:U6,pushMonitorGLContextCount:$M,popMonitorGLContextCount:jM};Tt("vtkRenderWindow",t5);function XM(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Ze(e.keyMatrices.mcwc,e.renderable.getMatrix()),me(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?jn(e.keyMatrices.normalMatrix):(pu(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),o0(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),xg(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const YM={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function ZM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YM,n),st.extend(t,e,n),e.keyMatrixTime={},Ue(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:jn(new Float64Array(9)),mcwc:te(new Float64Array(16))},ft(t,e,["context"]),Xt(t,e,["activeTextures"]),XM(t,e)}const P6=Le(ZM);var QM={newInstance:P6};Tt("vtkActor",P6);function JM(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}const eD={context:null,activeTextures:null};function tD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eD,n),st.extend(t,e,n),ft(t,e,["context"]),Xt(t,e,["activeTextures"]),JM(t,e)}const b6=Le(tD);var nD={newInstance:b6};Tt("vtkActor2D",b6);function rD(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){Ze(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),pu(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),o0(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),me(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();Ze(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),me(e.keyMatrices.vcpc,e.keyMatrices.vcpc),ge(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const aD={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function iD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aD,n),st.extend(t,e,n),e.keyMatrixTime={},Ue(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},ft(t,e,["context","keyMatrixTime"]),rD(t,e)}const G6=Le(iD);var sD={newInstance:G6};Tt("vtkCamera",G6);function oD(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let a=0;a<r&&a<6;a++)t.addClippingPlane(n[a])}},t.getClippingPlaneInDataCoords=(n,r,a)=>{const i=e.clippingPlanes,s=n;if(i){const o=i.length;if(r>=0&&r<o){const c=i[r],l=c.getNormal(),f=c.getOrigin(),u=l[0],g=l[1],p=l[2],h=-(u*f[0]+g*f[1]+p*f[2]);a[0]=u*s[0]+g*s[4]+p*s[8]+h*s[12],a[1]=u*s[1]+g*s[5]+p*s[9]+h*s[13],a[2]=u*s[2]+g*s[6]+p*s[10]+h*s[14],a[3]=u*s[3]+g*s[7]+p*s[11]+h*s[15];return}}O.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const cD={clippingPlanes:[]};function lD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cD,n),O.obj(t,e),O.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),oD(t,e)}var uD={extend:lD};function fD(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{O.vtkErrorMacro("not implemented")}}const gD={};function B6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gD,n),O.obj(t,e),O.setGet(t,e,["transform"]),fD(t,e)}const pD=O.newInstance(B6,"vtkImplicitFunction");var dD={newInstance:pD,extend:B6};const t2=1e-6,A6="coincide",W6="disjoint";function hD(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function z6(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function $6(t,e,n,r){const a=[];Rr(t,e,a);const i=oe(n,a);r[0]=t[0]-i*n[0],r[1]=t[1]-i*n[1],r[2]=t[2]-i*n[2]}function j6(t,e,n){const r=oe(t,e);let a=oe(e,e);return a===0&&(a=1),n[0]=t[0]-r*e[0]/a,n[1]=t[1]-r*e[1]/a,n[2]=t[2]-r*e[2]/a,n}function H6(t,e,n,r){const a=[];Rr(t,e,a);const i=oe(n,a),s=oe(n,n);s!==0?(r[0]=t[0]-i*n[0]/s,r[1]=t[1]-i*n[1]/s,r[2]=t[2]-i*n[2]/s):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function K6(t,e,n,r){const a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},i=[],s=[];Rr(e,t,i),Rr(n,t,s);const o=oe(r,s),c=oe(r,i);let l,f;return c<0?l=-c:l=c,o<0?f=-o*t2:f=o*t2,l<=f||(a.t=o/c,a.x[0]=t[0]+a.t*i[0],a.x[1]=t[1]+a.t*i[1],a.x[2]=t[2]+a.t*i[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function q6(t,e,n,r){const a={intersection:!1,l0:[],l1:[],error:null},i=[];cr(e,r,i);const s=i.map(u=>Math.abs(u));if(s[0]+s[1]+s[2]<t2){const u=[];return Rr(t,n,u),oe(e,u)===0?a.error=A6:a.error=W6,a}let o;s[0]>s[1]&&s[0]>s[2]?o="x":s[1]>s[2]?o="y":o="z";const c=[],l=-oe(e,t),f=-oe(r,n);switch(o){case"x":c[0]=0,c[1]=(f*e[2]-l*r[2])/i[0],c[2]=(l*r[1]-f*e[1])/i[0];break;case"y":c[0]=(l*r[2]-f*e[2])/i[1],c[1]=0,c[2]=(f*e[0]-l*r[0])/i[1];break;case"z":c[0]=(f*e[1]-l*r[1])/i[2],c[1]=(l*r[0]-f*e[0])/i[2],c[2]=0;break}return a.l0=c,Ml(c,i,a.l1),a.intersection=!0,a}const mD={evaluate:hD,distanceToPlane:z6,projectPoint:$6,projectVector:j6,generalizedProjectPoint:H6,intersectWithLine:K6,intersectWithPlane:q6,DISJOINT:W6,COINCIDE:A6};function vD(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>z6(n,e.origin,e.normal),t.projectPoint=(n,r)=>{$6(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>j6(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{H6(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,a)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(a-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>K6(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>q6(n,r,e.origin,e.normal)}const yD={normal:[0,0,1],origin:[0,0,0]};function X6(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yD,n),dD.extend(t,e,n),O.setGetArray(t,e,["normal","origin"],3),vD(t,e)}const CD=O.newInstance(X6,"vtkPlane");var Ft={newInstance:CD,extend:X6,...mD};const xu=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function Y6(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Fr(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function n5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function r5(t){return n5(t,xu)}function _l(t,e,n,r){const[a,i,s,o,c,l]=t;return t[0]=a<e?a:e,t[1]=i>e?i:e,t[2]=s<n?s:n,t[3]=o>n?o:n,t[4]=c<r?c:r,t[5]=l>r?l:r,t}function a5(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)_l(t,...e[n]);else for(let n=0;n<e.length;n+=3)_l(t,...e.slice(n,n+3));return t}function Z6(t,e,n,r,a,i,s){const[o,c,l,f,u,g]=t;return s===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],f),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],g)):(t[0]=Math.min(e,o),t[1]=Math.max(n,c),t[2]=Math.min(r,l),t[3]=Math.max(a,f),t[4]=Math.min(i,u),t[5]=Math.max(s,g)),t}function Q6(t,e,n,r){const[a,i,s,o,c,l]=t;return t[0]=e,t[1]=e>i?e:i,t[2]=n,t[3]=n>o?n:o,t[4]=r,t[5]=r>l?r:l,a!==e||s!==n||c!==r}function J6(t,e,n,r){const[a,i,s,o,c,l]=t;return t[0]=e<a?e:a,t[1]=e,t[2]=n<s?n:s,t[3]=n,t[4]=r<c?r:c,t[5]=r,i!==e||o!==n||l!==r}function em(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function i5(t,e,n,r){return Fr(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function s5(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function TD(t,e,n,r){if(!Fr(t))return!1;const a=s5(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],i5(t,e,n,r),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function vo(t,e){return t[e*2+1]-t[e*2]}function Su(t){return[vo(t,0),vo(t,1),vo(t,2)]}function tm(t){return t.slice(0,2)}function nm(t){return t.slice(2,4)}function rm(t){return t.slice(4,6)}function am(t){const e=Su(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function im(t){if(Fr(t)){const e=Su(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function o5(t){return[t[0],t[2],t[4]]}function c5(t){return[t[1],t[3],t[5]]}function K0(t,e){return t<=0&&e>=0||t>=0&&e<=0}function l5(t,e){let n=0;for(let r=0;r<2;r++)for(let a=2;a<4;a++)for(let i=4;i<6;i++)e[n++]=[t[r],t[a],t[i]];return e}function sm(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function om(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=l5(t,[]);for(let a=0;a<r.length;++a)Re(r[a],r[a],e);return r5(n),a5(n,r)}function cm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function lm(t,e,n,r){const a=[].concat(xu),i=t.getData();for(let s=0;s<i.length;s+=3){const o=[i[s],i[s+1],i[s+2]],c=oe(o,e);a[0]=Math.min(c,a[0]),a[1]=Math.max(c,a[1]);const l=oe(o,n);a[2]=Math.min(l,a[2]),a[3]=Math.max(l,a[3]);const f=oe(o,r);a[4]=Math.min(f,a[4]),a[5]=Math.max(f,a[5])}return a}function um(t,e,n,r,a){let i=!0;const s=[];let o=0;const c=[],l=[0,0,0],f=0,u=1,g=2;for(let p=0;p<3;p++)e[p]<t[2*p]?(s[p]=u,l[p]=t[2*p],i=!1):e[p]>t[2*p+1]?(s[p]=f,l[p]=t[2*p+1],i=!1):s[p]=g;if(i)return r[0]=e[0],r[1]=e[1],r[2]=e[2],a[0]=0,1;for(let p=0;p<3;p++)s[p]!==g&&n[p]!==0?c[p]=(l[p]-e[p])/n[p]:c[p]=-1;for(let p=0;p<3;p++)c[o]<c[p]&&(o=p);if(c[o]>1||c[o]<0)return 0;a[0]=c[o];for(let p=0;p<3;p++)if(o!==p){if(r[p]=e[p]+c[o]*n[p],r[p]<t[2*p]||r[p]>t[2*p+1])return 0}else r[p]=l[p];return 1}function fm(t,e,n){const r=[];let a=0,i=1,s=1;for(let o=4;o<=5;++o){r[2]=t[o];for(let c=2;c<=3;++c){r[1]=t[c];for(let l=0;l<=1;++l)if(r[0]=t[l],a=Ft.evaluate(n,e,r),s&&(i=a>=0?1:-1,s=0),a===0||i>0&&a<0||i<0&&a>0)return 1}}return 0}function gm(t,e){if(!(Fr(t)&&Fr(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let a=0;a<3;a++)if(r=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(r=!0,n[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(r=!0,n[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(r=!0,n[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(r=!0,n[a*2+1]=t[a*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function Nl(t,e){if(!(Fr(t)&&Fr(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function Il(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function xD(t,e){return!(!Nl(t,e)||!Il(t,...o5(e))||!Il(t,...c5(e)))}function pm(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0];let i=0;for(let u=0;u<2;u++)for(let g=2;g<4;g++)for(let p=4;p<6;p++){const h=[t[u],t[g],t[p]];a[i++]=Ft.evaluate(n,e,h)}let s=2;for(;s--&&!(K0(a[r[s][0]],a[r[s][4]])&&K0(a[r[s][1]],a[r[s][5]])&&K0(a[r[s][2]],a[r[s][6]])&&K0(a[r[s][3]],a[r[s][7]])););if(s<0)return!1;const o=Math.sign(n[s]),c=Math.abs((t[s*2+1]-t[s*2])*n[s]);let l=o>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;const g=Math.abs(a[r[s][u]])/c;o>0&&g<l&&(l=g),o<0&&g>l&&(l=g)}const f=(1-l)*t[s*2]+l*t[s*2+1];return o>0?t[s*2]=f:t[s*2+1]=f,!0}class SD{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(xu))}getBounds(){return this.bounds}equals(e){return Y6(this.bounds,e)}isValid(){return Fr(this.bounds)}setBounds(e){return n5(this.bounds,e)}reset(){return r5(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return _l(this.bounds,...n)}addPoints(e){return a5(this.bounds,e)}addBounds(e,n,r,a,i,s){return Z6(this.bounds,e,n,r,a,i,s)}setMinPoint(e,n,r){return Q6(this.bounds,e,n,r)}setMaxPoint(e,n,r){return J6(this.bounds,e,n,r)}inflate(e){return em(this.bounds,e)}scale(e,n,r){return i5(this.bounds,e,n,r)}getCenter(){return s5(this.bounds)}getLength(e){return vo(this.bounds,e)}getLengths(){return Su(this.bounds)}getMaxLength(){return am(this.bounds)}getDiagonalLength(){return im(this.bounds)}getMinPoint(){return o5(this.bounds)}getMaxPoint(){return c5(this.bounds)}getXRange(){return tm(this.bounds)}getYRange(){return nm(this.bounds)}getZRange(){return rm(this.bounds)}getCorners(e){return l5(this.bounds,e)}computeCornerPoints(e,n){return sm(this.bounds,e,n)}computeLocalBounds(e,n,r){return lm(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return om(this.bounds,e,n)}computeScale3(e){return cm(this.bounds,e)}cutWithPlane(e,n){return pm(this.bounds,e,n)}intersectBox(e,n,r,a){return um(this.bounds,e,n,r,a)}intersectPlane(e,n){return fm(this.bounds,e,n)}intersect(e){return gm(this.bounds,e)}intersects(e){return Nl(this.bounds,e)}containsPoint(e,n,r){return Il(this.bounds,e,n,r)}contains(e){return Nl(this.bounds,e)}}function wD(t){const e=t&&t.bounds;return new SD(e)}const ED={equals:Y6,isValid:Fr,setBounds:n5,reset:r5,addPoint:_l,addPoints:a5,addBounds:Z6,setMinPoint:Q6,setMaxPoint:J6,inflate:em,scale:i5,scaleAboutCenter:TD,getCenter:s5,getLength:vo,getLengths:Su,getMaxLength:am,getDiagonalLength:im,getMinPoint:o5,getMaxPoint:c5,getXRange:tm,getYRange:nm,getZRange:rm,getCorners:l5,computeCornerPoints:sm,computeLocalBounds:lm,transformBounds:om,computeScale3:cm,cutWithPlane:pm,intersectBox:um,intersectPlane:fm,intersect:gm,intersects:Nl,containsPoint:Il,contains:xD,INIT_BOUNDS:xu};var _e={newInstance:wD,...ED};function RD(t,e){t.getBounds=()=>(O.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),da()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=_e.isValid(n)?_e.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return _e.getDiagonalLength(n)}}const OD=t=>({bounds:[..._e.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function MD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OD(n)),uD.extend(t,e,n),O.setGet(t,e,["viewSpecificProperties"]),RD(t,e)}var u5={extend:MD};const Nn={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var dm={StructuredType:Nn};const{StructuredType:ur}=dm;function DD(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?ur.EMPTY:e===3?ur.XYZ_GRID:e===2?t[0]===t[1]?ur.YZ_PLANE:t[2]===t[3]?ur.XZ_PLANE:ur.XY_PLANE:e===1?t[0]<t[1]?ur.X_LINE:t[2]<t[3]?ur.Y_LINE:ur.Z_LINE:ur.SINGLE_POINT}var VD={getDataDescriptionFromExtent:DD,...dm};const{vtkErrorMacro:wa}=O;function LD(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return wa("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];const i=r.length===1?r[0]:r;if(i.length!==6)return!1;const s=e.extent.some((o,c)=>o!==i[c]);return s&&(e.extent=i.slice(),e.dataDescription=VD.getDataDescriptionFromExtent(e.extent),t.modified()),s},t.setDimensions=function(){let n,r,a;if(e.deleted){wa("instance deleted - cannot call any method");return}if(arguments.length===1){const i=arguments.length<=0?void 0:arguments[0];n=i[0],r=i[1],a=i[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];else{wa("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,a-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let a=0;a<3;a++){if(n[a]===0)return 0;n[a]>1&&(r*=n[a]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return wa("Requesting a point from an empty image."),null;const a=new Float64Array(3);switch(e.dataDescription){case Nn.EMPTY:return null;case Nn.SINGLE_POINT:break;case Nn.X_LINE:a[0]=n;break;case Nn.Y_LINE:a[1]=n;break;case Nn.Z_LINE:a[2]=n;break;case Nn.XY_PLANE:a[0]=n%r[0],a[1]=n/r[0];break;case Nn.YZ_PLANE:a[1]=n%r[1],a[2]=n/r[1];break;case Nn.XZ_PLANE:a[0]=n%r[0],a[2]=n/r[0];break;case Nn.XYZ_GRID:a[0]=n%r[0],a[1]=n/r[0]%r[1],a[2]=n/(r[0]*r[1]);break;default:wa("Invalid dataDescription");break}const i=[0,0,0];return t.indexToWorld(a,i),i},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>_e.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>_e.inflate([...e.extent],.5),t.computeTransforms=()=>{du(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Nr(e.indexToWorld,e.indexToWorld,e.spacing),lt(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Re(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Re(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return _e.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return _e.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>_e.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const a=[0,0,0,0,0,0];t.worldToIndexBounds(n,a);const i=[0,0,0],s=[0,0,0];_e.computeCornerPoints(a,i,s),X1(i,i),X1(s,s);const o=t.getDimensions();Z1(i,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],i),Z1(s,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],s);const c=o[0],l=o[0]*o[1],f=t.getPointData().getScalars().getData();let u=-1/0,g=1/0,p=0,h=0,d=0;for(let y=i[2];y<=s[2];y++)for(let T=i[1];T<=s[1];T++){let x=i[0]+T*c+y*l;for(let S=i[0];S<=s[0];S++){if(!r||r([S,T,y],a)){const w=f[x];w>u&&(u=w),w<g&&(g=w),p+=w*w,h+=w,d+=1}++x}}const m=d>0?h/d:0,v=d?Math.abs(p/d-m*m):0,C=Math.sqrt(v);return{minimum:g,maximum:u,average:m,variance:v,sigma:C,count:d}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=[];let i=r;for(let s=0;s<3;++s)a[s]=i,i*=n[s*2+1]-n[s*2]+1;return a},t.computeOffsetIndex=n=>{let[r,a,i]=n;const s=t.getExtent(),o=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(s,o);return Math.floor((Math.round(r)-s[0])*c[0]+(Math.round(a)-s[2])*c[1]+(Math.round(i)-s[4])*c[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),a=t.worldToIndex(n);for(let i=0;i<3;++i)if(a[i]<r[i*2]||a[i]>r[i*2+1])return wa(`GetScalarPointer: Pixel ${a} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(a)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=a)return wa(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${a}`),NaN;const i=t.getOffsetIndexFromWorld(n);return Number.isNaN(i)?i:t.getPointData().getScalars().getComponent(i,r)}}const _D={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Nn.EMPTY};function hm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_D,n),Rs.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=jn(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),O.get(t,e,["indexToWorld","worldToIndex"]),O.setGetArray(t,e,["origin","spacing"],3),O.setGetArray(t,e,["direction"],9),O.getArray(t,e,["extent"],6),LD(t,e)}const ND=O.newInstance(hm,"vtkImageData");var f5={newInstance:ND,extend:hm};const ID={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},n2={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var g5={VectorMode:ID,ScalarMappingTarget:n2};const FD={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},kD={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},UD={BY_ID:0,BY_NAME:1};var p5={ColorMode:FD,GetArray:UD,ScalarMode:kD};const{ScalarMappingTarget:Kd,VectorMode:Qn}=g5,{VtkDataTypes:Gr}=le,{ColorMode:q0}=p5,{vtkErrorMacro:qd}=O;function PD(t){return t}function Xd(t){return Math.floor(t*255+.5)}function bD(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(Qn.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(Qn.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(Qn.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){qd("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const a=r.length;for(let i=0;i<a;i++)e.annotationArray.push({value:n[i],annotation:String(r[i])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let a=t.checkForAnnotatedValue(n),i=!1;return a>=0?e.annotationArray[a].annotation!==r&&(e.annotationArray[a].annotation=r,i=!0):(e.annotationArray.push({value:n,annotation:r}),a=e.annotationArray.length-1,i=!0),i&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),a=r>=0;return a&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const a=t.getAnnotatedValueIndex(n);t.getIndexedColor(a,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,a)=>{const i=n.getNumberOfComponents();let s=null;if(r===q0.DEFAULT&&(n.getDataType()===Gr.UNSIGNED_CHAR||n.getDataType()===Gr.UNSIGNED_CHAR_CLAMPED)||r===q0.DIRECT_SCALARS&&n)s=t.convertToRGBA(n,i,n.getNumberOfTuples());else{const o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:Gr.UNSIGNED_CHAR},c=O.newTypedArray(o.dataType,4*n.getNumberOfTuples());o.values=c,o.size=c.length,s=le.newInstance(o);let l=a;l<0&&i>1?t.mapVectorsThroughTable(n,s,Kd.RGBA,-1,-1):(l<0&&(l=0),l>=i&&(l=i-1),t.mapScalarsThroughTable(n,s,Kd.RGBA,l))}return s},t.mapVectorsToMagnitude=(n,r,a)=>{const i=n.getNumberOfTuples(),s=n.getNumberOfComponents(),o=r.getData(),c=n.getData();for(let l=0;l<i;l++){let f=0;for(let u=0;u<a;u++)f+=c[l*s+u]*c[l*s+u];o[l]=Math.sqrt(f)}},t.mapVectorsThroughTable=(n,r,a,i,s)=>{let o=t.getVectorMode(),c=s,l=i;const f=n.getNumberOfComponents();o===Qn.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=f&&(l=f-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=f):(l<0&&(l=0),l>=f&&(l=f-1),l+c>f&&(c=f-l)),o===Qn.MAGNITUDE&&(f===1||c===1)&&(o=Qn.COMPONENT));let u=0;switch(l>0&&(u=l),o){case Qn.COMPONENT:{t.mapScalarsThroughTable(n,r,a,u);break}case Qn.RGBCOLORS:break;case Qn.MAGNITUDE:default:{const g=le.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,g,c),t.mapScalarsThroughTable(g,r,a,0);break}}},t.luminanceToRGBA=(n,r,a,i)=>{const s=i(a),o=r.getData(),c=n.getData(),l=o.length,f=0,u=1;let g=0;for(let p=f;p<l;p+=u){const h=i(o[p]);c[g*4]=h,c[g*4+1]=h,c[g*4+2]=h,c[g*4+3]=s,g++}},t.luminanceAlphaToRGBA=(n,r,a,i)=>{const s=r.getData(),o=n.getData(),c=s.length,l=0,f=2;let u=0;for(let g=l;g<c;g+=f){const p=i(s[g]);o[u]=p,o[u+1]=p,o[u+2]=p,o[u+3]=i(s[g+1])*a,u+=4}},t.rGBToRGBA=(n,r,a,i)=>{const s=Xd(a),o=r.getData(),c=n.getData(),l=o.length,f=0,u=3;let g=0;for(let p=f;p<l;p+=u)c[g*4]=i(o[p]),c[g*4+1]=i(o[p+1]),c[g*4+2]=i(o[p+2]),c[g*4+3]=s,g++},t.rGBAToRGBA=(n,r,a,i)=>{const s=r.getData(),o=n.getData(),c=s.length,l=0,f=4;let u=0;for(let g=l;g<c;g+=f)o[u*4]=i(s[g]),o[u*4+1]=i(s[g+1]),o[u*4+2]=i(s[g+2]),o[u*4+3]=i(s[g+3])*a,u++},t.convertToRGBA=(n,r,a)=>{let{alpha:i}=e;if(r===4&&i>=1&&n.getDataType()===Gr.UNSIGNED_CHAR)return n;const s=le.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:Gr.UNSIGNED_CHAR});if(a<=0)return s;i=i>0?i:0,i=i<1?i:1;let o=PD;switch((n.getDataType()===Gr.FLOAT||n.getDataType()===Gr.DOUBLE)&&(o=Xd),r){case 1:t.luminanceToRGBA(s,n,i,o);break;case 2:t.luminanceAlphaToRGBA(s,n,o);break;case 3:t.rGBToRGBA(s,n,i,o);break;case 4:t.rGBAToRGBA(s,n,i,o);break;default:return qd("Cannot convert colors"),null}return s},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,a)=>{if(!n)return t.isOpaque();const i=n.getNumberOfComponents();return r===q0.DEFAULT&&n.getDataType()===Gr.UNSIGNED_CHAR||r===q0.DIRECT_SCALARS?i===3||i===1?e.alpha>=1:n.getRange(i-1)[0]===255:!0}}const GD={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:Qn.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function mm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GD,n),O.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],O.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),O.setArray(t,e,["mappingRange"],2),O.getArray(t,e,["mappingRange"]),bD(t,e)}const BD=O.newInstance(mm,"vtkScalarsToColors");var d5={newInstance:BD,extend:mm,...g5};const{vtkErrorMacro:Yd}=O,Zd=0,Qd=1,Sf=2;function AD(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let a=0;const i=Number(n);return i<r.range[0]?a=r.maxIndex+Zd+1.5:i>r.range[1]?a=r.maxIndex+Qd+1.5:(a=(i+r.shift)*r.scale,a=a<r.maxIndex?a:r.maxIndex),Math.floor(a)},t.linearLookup=(n,r,a)=>{let i=0;Vl(n)?i=Math.floor(a.maxIndex+1.5+Sf):i=t.linearIndexLookup(n,a);const s=4*i;return r.slice(s,s+4)},t.indexedLookupFunction=(n,r,a)=>{let i=t.getAnnotatedValueIndexInternal(n);i===-1&&(i=e.numberOfColors+Sf);const s=4*i;return[r[s],r[s+1],r[s+2],r[s+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,a,i)=>{let s=t.linearLookup;e.indexedLookup&&(s=t.indexedLookupFunction);const o=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:o,shift:0,scale:0};t.lookupShiftAndScale(o,c);const l=t.getAlpha(),f=n.getNumberOfTuples(),u=n.getNumberOfComponents(),g=r.getData(),p=n.getData();if(l>=1){if(a===n2.RGBA)for(let h=0;h<f;h++){const d=s(p[h*u+i],e.table,c);g[h*4]=d[0],g[h*4+1]=d[1],g[h*4+2]=d[2],g[h*4+3]=d[3]}}else if(a===n2.RGBA)for(let h=0;h<f;h++){const d=s(p[h*u+i],e.table,c);g[h*4]=d[0],g[h*4+1]=d[1],g[h*4+2]=d[2],g[h*4+3]=Math.floor(d[3]*l+.5)}},t.forceBuild=()=>{let n=0,r=0,a=0,i=0;const s=e.numberOfColors-1;s&&(n=(e.hueRange[1]-e.hueRange[0])/s,r=(e.saturationRange[1]-e.saturationRange[0])/s,a=(e.valueRange[1]-e.valueRange[0])/s,i=(e.alphaRange[1]-e.alphaRange[0])/s),e.table.length=4*s+16;const o=[],c=[];for(let l=0;l<=s;l++)o[0]=e.hueRange[0]+l*n,o[1]=e.saturationRange[0]+l*r,o[2]=e.valueRange[0]+l*a,Pa(o,c),c[3]=e.alphaRange[0]+l*i,e.table[l*4]=c[0]*255+.5,e.table[l*4+1]=c[1]*255+.5,e.table[l*4+2]=c[2]*255+.5,e.table[l*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const a=n[0].length;e.numberOfColors=n.length;const i=4-a;let s=0;for(let o=0;o<e.numberOfColors;o++)e.table[o*4]=255,e.table[o*4+1]=255,e.table[o*4+2]=255,e.table[o*4+3]=255;for(let o=0;o<n.length;o++){const c=n[o];for(let l=0;l<a;l++)e.table[s++]=c[l];s+=i}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return Yd("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==ce.UNSIGNED_CHAR)return Yd("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let a=0;a<r.length;a++)e.table[a]=r[a];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let a=(n+Zd)*4;e.useBelowRangeColor||n===0?(r[a]=e.belowRangeColor[0]*255+.5,r[a+1]=e.belowRangeColor[1]*255+.5,r[a+2]=e.belowRangeColor[2]*255+.5,r[a+3]=e.belowRangeColor[3]*255+.5):(r[a]=r[0],r[a+1]=r[1],r[a+2]=r[2],r[a+3]=r[3]),a=(n+Qd)*4,e.useAboveRangeColor||n===0?(r[a]=e.aboveRangeColor[0]*255+.5,r[a+1]=e.aboveRangeColor[1]*255+.5,r[a+2]=e.aboveRangeColor[2]*255+.5,r[a+3]=e.aboveRangeColor[3]*255+.5):(r[a]=r[4*(n-1)+0],r[a+1]=r[4*(n-1)+1],r[a+2]=r[4*(n-1)+2],r[a+3]=r[4*(n-1)+3]),a=(n+Sf)*4,r[a]=e.nanColor[0]*255+.5,r[a+1]=e.nanColor[1]*255+.5,r[a+2]=e.nanColor[2]*255+.5,r[a+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const WD={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function vm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WD,n),d5.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},O.obj(e.buildTime),e.opaqueFlagBuildTime={},O.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},O.obj(e.insertTime,{mtime:0}),O.get(t,e,["buildTime"]),O.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),O.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),O.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),O.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),AD(t,e)}const zD=O.newInstance(vm,"vtkLookupTable");var r2={newInstance:zD,extend:vm};const Kn={Off:0,PolygonOffset:1};let a2=Kn.PolygonOffset,Fl=Kn.Off;const $D=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function jD(){return a2}function HD(t){const e=a2===t;return a2=t,e}function KD(){return Fl}function wu(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=Fl===t;return Fl=t,e}function qD(){return wu(Kn.Off)}function XD(){return wu(Kn.Off)}function YD(){return wu(Kn.PolygonOffset)}function ZD(){return $D[Fl]}var i2={Resolve:Kn,getResolveCoincidentTopologyAsString:ZD,getResolveCoincidentTopologyPolygonOffsetFaces:jD,getResolveCoincidentTopology:KD,setResolveCoincidentTopology:wu,setResolveCoincidentTopologyPolygonOffsetFaces:HD,setResolveCoincidentTopologyToDefault:qD,setResolveCoincidentTopologyToOff:XD,setResolveCoincidentTopologyToPolygonOffset:YD};function ym(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=O.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const h5=["Polygon","Line","Point"],QD={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},ba={};ym(ba,QD,h5.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function JD(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),O.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(i2).forEach(n=>{t[n]=i2[n]}),Object.keys(ba).forEach(n=>{t[n]=ba[n]}),ym(t,e.topologyOffset,h5.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=ba.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=ba.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=ba.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var Eu={implementCoincidentTopologyMethods:JD,staticOffsetAPI:ba,otherStaticMethods:i2,CATEGORIES:h5,Resolve:Kn};const{FieldAssociations:Jd}=Rs,{staticOffsetAPI:eV,otherStaticMethods:tV}=Eu,{ColorMode:X0,ScalarMode:Ea,GetArray:wf}=p5,{VectorMode:nV}=g5,{VtkDataTypes:rV}=le;function Bs(t){return()=>O.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function aV(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function iV(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function eh(t,e,n){const r=Math.floor(e),a=r%(2*n[0]);let i,s;a<n[0]?(t[0]=a,i=1,s=t[0]===n[0]-1):(t[0]=2*n[0]-1-a,i=-1,s=t[0]===0);const o=Math.floor(r/n[0]),c=o%(2*n[1]);let l,f;c<n[1]?(t[1]=c,l=1,f=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,l=-1,f=t[1]===0),t[2]=Math.floor(o/n[1]);const u=e-r;s?f?t[2]+=u:t[1]+=l*u:t[0]+=i*u,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const th=new WeakMap;function sV(t,e,n,r,a,i,s){var I;const o=new Array(arguments.length);for(let b=0;b<arguments.length;++b){const F=arguments[b];o[b]=((I=F.getMTime)==null?void 0:I.call(F))??F}const c=o.join("/"),l=th.get(t);if(l&&l.stringHash===c)return l.textureCoordinates;const f=(n[1]-n[0])/(r-1),[u,g]=[n[0]-f,n[1]+f],p=u-.5*f,h=1/(g-u+f),d=u,m=(r+1)/(g-u),v=t.getData(),C=t.getNumberOfTuples(),y=t.getNumberOfComponents(),T=e<0||e>=y,x=a[2]<=1?2:3,S=le.newInstance({numberOfComponents:x,values:new Float32Array(C*x)}),w=S.getData(),E=[0,0,0];eh(E,r+2,a);let L=0,R=0;const D=[.5,.5,.5];for(let b=0;b<C;++b){let F;if(T){let W=0;for(let P=0;P<y;++P){const K=v[L+P];W+=K*K}F=Math.sqrt(W)}else F=v[L+e];if(L+=y,i&&(F=r2.applyLogScale(F,n,n)),Vl(F))D[0]=E[0],D[1]=E[1],D[2]=E[2];else if(s){let W=(F-d)*m;W<1?W=0:W>r&&(W=r+1),eh(D,W,a)}else{D[1]=.49;const W=(F-p)*h;W>1e3?D[0]=1e3:W<-1e3?D[0]=-1e3:D[0]=W}for(let W=0;W<x;++W)w[R++]=D[W]}return th.set(t,{stringHash:c,textureCoordinates:S}),S}function oV(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=da(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=r2.newInstance()},t.getColorModeAsString=()=>O.enumToString(X0,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>O.enumToString(Ea,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,a,i,s)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let o=null,c=!1;if(r===Ea.DEFAULT)o=n.getPointData().getScalars(),o||(o=n.getCellData().getScalars(),c=!0);else if(r===Ea.USE_POINT_DATA)o=n.getPointData().getScalars();else if(r===Ea.USE_CELL_DATA)o=n.getCellData().getScalars(),c=!0;else if(r===Ea.USE_POINT_FIELD_DATA){const l=n.getPointData();a===wf.BY_ID?o=l.getArrayByIndex(i):o=l.getArrayByName(s)}else if(r===Ea.USE_CELL_FIELD_DATA){const l=n.getCellData();c=!0,a===wf.BY_ID?o=l.getArrayByIndex(i):o=l.getArrayByName(s)}else if(r===Ea.USE_FIELD_DATA){const l=n.getFieldData();a===wf.BY_ID?o=l.getArrayByIndex(i):o=l.getArrayByName(s)}return{scalars:o,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:a,cellFlag:i}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=i,!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const s=`${t.getMTime()}${a.getMTime()}${r}`;if(e.colorBuildString!==s){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(a,i))e.mapScalarsToTexture(a,i,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${a.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,a)=>{const i=e.lookupTable.getRange(),s=e.lookupTable.usingLogScale();s&&r2.getLogRange(i,i);const o=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==a){e.lookupTable.setAlpha(a),e.colorTextureMap=null,e.lookupTable.build();const l=e.lookupTable.getNumberOfAvailableColors(),f=2048,u=f**3-3,p=4096-2,h=2,d=r?u:p;e.numberOfColorsInRange=Math.min(Math.max(l,h),d);const m=e.numberOfColorsInRange+3,v=e.numberOfColorsInRange+2,C=r?[Math.min(Math.ceil(m/f**0),f),Math.min(Math.ceil(m/f**1),f),Math.min(Math.ceil(m/f**2),f)]:[v,2,1],y=C[0]*C[1]*C[2],T=new Float64Array(y);T.fill(NaN);const x=e.numberOfColorsInRange,S=x+2,w=[0,0,0],E=i[0],L=i[1]-i[0];for(let I=0;I<S;++I){const b=iV(w,C),F=E+L*(I-1)/(x-1);T[b]=s?10**F:F,aV(w,C)}const R=le.newInstance({numberOfComponents:1,values:T}),D=e.lookupTable.mapScalars(R,e.colorMode,0);e.colorTextureMap=f5.newInstance(),e.colorTextureMap.setDimensions(C),e.colorTextureMap.getPointData().setScalars(D),e.lookupTable.setAlpha(o)}const c=e.lookupTable.getVectorMode()===nV.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=sV(n,c,i,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),s,r)},t.getIsOpaque=()=>{const n=t.getInputData(),a=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||a==null)return!0;const i=t.getLookupTable();return i?(i.build(),i.areScalarsOpaque(a,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==X0.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===X0.DEFAULT&&n.getDataType()===rV.UNSIGNED_CHAR||e.colorMode===X0.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=Bs("AcquireInvertibleLookupTable"),t.valueToColor=Bs("ValueToColor"),t.colorToValue=Bs("ColorToValue"),t.useInvertibleColorFor=Bs("UseInvertibleColorFor"),t.clearInvertibleColor=Bs("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const a=n.getRawPixelBuffer($t.ID_LOW24),i=n.getRawPixelBuffer($t.ID_HIGH24),s=n.getCurrentPass(),o=n.getFieldAssociation();let c=null;o===Jd.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:o===Jd.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(l=>{if(s===$t.ID_LOW24){let f=0;i&&(f+=i[l],f*=256),f+=a[l+2],f*=256,f+=a[l+1],f*=256,f+=a[l];const u=c[f],g=n.getPixelBuffer($t.ID_LOW24);g[l]=u&255,g[l+1]=(u&65280)>>8,g[l+2]=(u&16711680)>>16}else if(s===$t.ID_HIGH24&&i){let f=0;f+=i[l],f*=256,f+=a[l+2],f*=256,f+=a[l+1],f*=256,f+=a[l];const u=c[f],g=n.getPixelBuffer($t.ID_HIGH24);g[l]=(u&4278190080)>>24}})}}const cV={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function lV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cV,n),u5.extend(t,e,n),O.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),O.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),O.setGetArray(t,e,["scalarRange"],2),Eu.implementCoincidentTopologyMethods(t,e),oV(t,e)}O.newInstance(lV,"vtkMapper");var uV={...eV,...tV,...p5};const fV={DISPLAY:0,WORLD:1};var Cm={CoordinateSystem:fV};const{CoordinateSystem:s2}=Cm;function nh(t){return()=>O.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function gV(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const a=e.textures[r].getMTime();a>n&&(n=a)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=nh("pick"),t.hasKey=nh("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(a=>a!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(s2.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(s2.DISPLAY)}const pV={allocatedRenderTime:10,coordinateSystem:s2.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function Tm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pV,n),O.obj(t,e),O.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),O.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),O.moveToProtected(t,e,["parentProp"]),gV(t,e)}const dV=O.newInstance(Tm,"vtkProp");var xm={newInstance:dV,extend:Tm,...Cm},m5=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,v0=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function hV(t,e){t.replaceShaderCoincidentOffset=(n,r,a)=>{const i=t.getCoincidentParameters(r,a);if(i&&(i.factor!==0||i.offset!==0)){let s=n.Fragment;s=G.substitute(s,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(i.factor!==0?(s=G.substitute(s,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,s=G.substitute(s,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):s=G.substitute(s,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(i.factor!==0?(s=G.substitute(s,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,s=G.substitute(s,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):s=G.substitute(s,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=s}}}function mV(t,e){t.applyShaderReplacements=(n,r,a)=>{let i=null;if(r&&(i=r.ShaderReplacements),i)for(let s=0;s<i.length;s++){const o=i[s];if(a&&o.replaceFirst||!a&&!o.replaceFirst){const c=o.shaderType,l=n[c],f=G.substitute(l,o.originalValue,o.replacementValue,o.replaceAll);n[c]=f.result}}},t.buildShaders=(n,r,a)=>{t.getReplacedShaderTemplate(n,r,a),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const i=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,i,!0),t.replaceShaderValues(n,r,a),t.applyShaderReplacements(n,i)},t.getReplacedShaderTemplate=(n,r,a)=>{const i=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,a);let s=n.Vertex;if(i){const l=i.VertexShaderCode;l!==void 0&&l!==""&&(s=l)}n.Vertex=s;let o=n.Fragment;if(i){const l=i.FragmentShaderCode;l!==void 0&&l!==""&&(o=l)}n.Fragment=o;let c=n.Geometry;if(i){const l=i.GeometryShaderCode;l!==void 0&&(c=l)}n.Geometry=c}}var ha={implementReplaceShaderCoincidentOffset:hV,implementBuildShadersWithReplacements:mV};const{FieldAssociations:Ef}=Rs,{primTypes:gt}=Ta,{Representation:Ti,Shading:rh}=m0,{ScalarMode:Y0}=uV,{Filter:ah,Wrap:ih}=ke,{vtkErrorMacro:Ra}=bt,vV={type:"StartEvent"},yV={type:"EndEvent"},{CoordinateSystem:CV}=xm;function TV(t){const e=t.getSelector();return e?e.getCurrentPass():$t.MIN_KNOWN_PASS-1}function xV(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,a)=>{r&&(e.currentRenderPass=a,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let s=gt.Start;s<gt.End;s++)e.primitives[s].setOpenGLRenderWindow(e._openGLRenderWindow)}const a=e.openGLActor.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,a)},t.getShaderTemplate=(r,a,i)=>{r.Vertex=m5,r.Fragment=v0,r.Geometry=""},t.replaceShaderColor=(r,a,i)=>{let s=r.Vertex,o=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(f=f.concat(["varying vec4 vertexColorVSOutput;"]),s=G.substitute(s,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,s=G.substitute(s,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=G.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=G.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=G.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=G.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(i.getBackfaceProperty()&&!e.drawingEdges&&(f=f.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),l?(f=f.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(f=f.concat(["uniform samplerBuffer texture1;"])),c=G.substitute(c,"//VTK::Color::Impl",u).result),c=G.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=s,r.Geometry=o,r.Fragment=c},t.replaceShaderLight=(r,a,i)=>{let s=r.Fragment;const o="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=e.lastBoundBO.getReferenceByName("lastLightCount");let f=[];switch(c){case 0:s=G.substitute(s,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:s=G.substitute(s,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);s=G.substitute(s,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<l;++u)f=f.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${o}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${o} * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),s=G.substitute(s,"//VTK::Light::Impl",f,!1).result;break;case 3:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);s=G.substitute(s,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<l;++u)f=f.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${o}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${o}) * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),s=G.substitute(s,"//VTK::Light::Impl",f,!1).result;break;default:Ra("bad light complexity")}r.Fragment=s},t.replaceShaderNormal=(r,a,i)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=r.Vertex,c=r.Geometry,l=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(o=G.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=G.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=G.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=G.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,l=G.substitute(l,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,l=G.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(l=G.substitute(l,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,l=G.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES?(l=G.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=G.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(l=G.substitute(l,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,l=G.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=G.substitute(l,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=o,r.Geometry=c,r.Fragment=l}},t.replaceShaderPositionVC=(r,a,i)=>{e.lastBoundBO.replaceShaderPositionVC(r,a,i);let s=r.Vertex,o=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(s=G.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=G.substitute(s,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,s=G.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=G.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=G.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=G.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=G.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(s=G.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=G.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=s,r.Geometry=o,r.Fragment=c},t.replaceShaderTCoord=(r,a,i)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let s=r.Vertex,o=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;s=G.substitute(s,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const l=e.openGLActor.getActiveTextures();let f=2,u=2;if(l&&l.length>0&&(f=l[0].getComponents(),l[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(f=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(s=G.substitute(s,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,o=G.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,o=G.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=G.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l&&l.length>=1)switch(f){case 1:c=G.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=G.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=G.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(s=G.substitute(s,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,o=G.substitute(o,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,o=G.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=G.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,f){case 1:c=G.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=G.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=G.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=s,r.Geometry=o,r.Fragment=c}},t.replaceShaderClip=(r,a,i)=>{let s=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();s=G.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,s=G.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=G.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,o=G.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=s,r.Fragment=o},t.getCoincidentParameters=(r,a)=>{let i={factor:0,offset:0};const s=a.getProperty();if(e.renderable.getResolveCoincidentTopology()==Kn.PolygonOffset||s.getEdgeVisibility()&&s.getRepresentation()===Ti.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===gt.Points||s.getRepresentation()===Ti.POINTS?i=e.renderable.getCoincidentTopologyPointOffsetParameter():c===gt.Lines||s.getRepresentation()===Ti.WIREFRAME?i=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===gt.Tris||c===gt.TriStrips)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===gt.TrisEdges||c===gt.TriStripsEdges)&&(i=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),i.factor/=2,i.offset/=2)}const o=e._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===Ef.FIELD_ASSOCIATION_POINTS&&(i.offset-=2),i},t.replaceShaderPicking=(r,a,i)=>{let s=r.Fragment,o=r.Vertex;if(s=G.substitute(s,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===$t.ID_LOW24||e.lastSelectionState===$t.ID_HIGH24)&&(o=G.substitute(o,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,o=G.substitute(o,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,s=G.substitute(s,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,s=G.substitute(s,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case $t.ID_LOW24:s=G.substitute(s,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case $t.ID_HIGH24:s=G.substitute(s,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:s=G.substitute(s,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,s=G.substitute(s,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=s,r.Vertex=o}},t.replaceShaderValues=(r,a,i)=>{if(t.replaceShaderColor(r,a,i),t.replaceShaderNormal(r,a,i),t.replaceShaderLight(r,a,i),t.replaceShaderTCoord(r,a,i),t.replaceShaderPicking(r,a,i),t.replaceShaderClip(r,a,i),t.replaceShaderCoincidentOffset(r,a,i),t.replaceShaderPositionVC(r,a,i),e.haveSeenDepthRequest){let s=r.Fragment;s=G.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=G.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=s}},t.getNeedToRebuildShaders=(r,a,i)=>{let s=0,o=0;const c=r.getPrimitiveType(),l=e.currentInput;let f=!1;const u=l.getPointData().getNormals(),g=l.getCellData().getNormals(),p=i.getProperty().getInterpolation()===rh.FLAT,h=i.getProperty().getRepresentation(),d=r.getOpenGLMode(h,c);if((d===e.context.TRIANGLES||g&&!u||!p&&u||!p&&d===e.context.LINES)&&(f=!0),i.getProperty().getLighting()&&f){s=0;const y=a.getLightsByReference();for(let T=0;T<y.length;++T){const x=y[T];x.getSwitch()>0&&(o++,s===0&&(s=1)),s===1&&(o>1||x.getIntensity()!==1||!x.lightTypeIsHeadLight())&&(s=2),s<3&&x.getPositional()&&(s=3)}}let m=!1;const v=e.lastBoundBO.getReferenceByName("lastLightComplexity"),C=e.lastBoundBO.getReferenceByName("lastLightCount");return(v!==s||C!==o)&&(e.lastBoundBO.set({lastLightComplexity:s},!0),e.lastBoundBO.set({lastLightCount:o},!0),m=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(m=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||m?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,a,i)=>{const s=e.renderable.getViewSpecificProperties().ShadersCallbacks;s&&s.forEach(o=>{o.callback(o.userData,r,a,i)})},t.setMapperShaderParameters=(r,a,i)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||Ra("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||Ra("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((l,f)=>{r.getProgram().isAttributeUsed(`${l}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${l}MC`,r.getCABO().getCustomData()[f].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[f].components,!1)||Ra(`Error setting ${l}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||Ra("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Ra("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),l=[],u=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,g=u?Ze(e.tmpMat4,i.getMatrix()):i.getMatrix();u&&(me(g,g),ge(g,g,u),me(g,g));for(let p=0;p<c;p++){const h=[];e.renderable.getClippingPlaneInDataCoords(g,p,h);for(let d=0;d<4;d++)l.push(h[d])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",l)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const s=e.openGLActor.getActiveTextures();if(s)for(let c=0;c<s.length;++c){const f=s[c].getTextureUnit(),u=`texture${f+1}`;r.getProgram().isUniformUsed(u)&&r.getProgram().setUniformi(u,f)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,i);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(a,i,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,a,i)=>{const s=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(s<2)return;const o=r.getProgram();let c=0;const l=a.getLightsByReference();for(let g=0;g<l.length;++g){const p=l[g];if(p.getSwitch()>0){const d=p.getColorByReference(),m=p.getIntensity();e.lightColor[0]=d[0]*m,e.lightColor[1]=d[1]*m,e.lightColor[2]=d[2]*m;const v=p.getDirection(),C=a.getActiveCamera().getViewMatrix(),y=[...v];p.lightTypeIsSceneLight()&&(y[0]=C[0]*v[0]+C[1]*v[1]+C[2]*v[2],y[1]=C[4]*v[0]+C[5]*v[1]+C[6]*v[2],y[2]=C[8]*v[0]+C[9]*v[1]+C[10]*v[2],ui(y)),e.lightDirection[0]=y[0],e.lightDirection[1]=y[1],e.lightDirection[2]=y[2],ui(e.lightDirection),o.setUniform3fArray(`lightColor${c}`,e.lightColor),o.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(s<3)return;const u=a.getActiveCamera().getViewMatrix();me(u,u),c=0;for(let g=0;g<l.length;++g){const p=l[g];if(p.getSwitch()>0){const d=p.getTransformedPosition(),m=new Float64Array(3);Re(m,d,u),o.setUniform3fArray(`lightAttenuation${c}`,p.getAttenuationValuesByReference()),o.setUniformi(`lightPositional${c}`,p.getPositional()),o.setUniformf(`lightExponent${c}`,p.getExponent()),o.setUniformf(`lightConeAngle${c}`,p.getConeAngle()),o.setUniform3fArray(`lightPositionVC${c}`,[m[0],m[1],m[2]]),c++}}};function n(r,a,i){return a.identity(i),r.reduce((s,o,c)=>c===0?o?a.copy(s,o):a.identity(s):o?a.multiply(s,s,o):s,i)}t.setCameraShaderParameters=(r,a,i)=>{const s=r.getProgram(),o=e.openGLCamera.getKeyMatrices(a),c=a.getActiveCamera(),l=e.openGLCamera.getKeyMatrixTime().getMTime(),f=s.getLastCameraMTime(),g=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,p=i.getIsIdentity(),h=p?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(i.getCoordinateSystem()===CV.DISPLAY){const d=e._openGLRenderer.getTiledSizeAndOrigin();te(e.tmpMat4),e.tmpMat4[0]=2/d.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/d.vsize,e.tmpMat4[13]=-1,ge(e.tmpMat4,e.tmpMat4,g),s.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else s.setUniformMatrix("MCPCMatrix",n([o.wcpc,h.mcwc,g],yl,e.tmpMat4));s.isUniformUsed("MCVCMatrix")&&s.setUniformMatrix("MCVCMatrix",n([o.wcvc,h.mcwc,g],yl,e.tmpMat4)),s.isUniformUsed("normalMatrix")&&s.setUniformMatrix3x3("normalMatrix",n([o.normalMatrix,h.normalMatrix],Gx,e.tmpMat3)),f!==l&&(s.isUniformUsed("cameraParallel")&&s.setUniformi("cameraParallel",c.getParallelProjection()),s.setLastCameraMTime(l)),p||s.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,a,i)=>{const s=r.getProgram();let o=i.getProperty(),c=o.getOpacity(),l=e.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),f=e.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),u=e.drawingEdges?1:o.getAmbient(),g=e.drawingEdges?0:o.getDiffuse(),p=e.drawingEdges?0:o.getSpecular();const h=o.getSpecularPower();s.setUniformf("opacityUniform",c),s.setUniform3fArray("ambientColorUniform",l),s.setUniform3fArray("diffuseColorUniform",f),s.setUniformf("ambient",u),s.setUniformf("diffuse",g);const d=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(d<1)return;let m=o.getSpecularColorByReference();if(s.setUniform3fArray("specularColorUniform",m),s.setUniformf("specularPowerUniform",h),s.setUniformf("specular",p),s.isUniformUsed("ambientIntensityBF")){if(o=i.getBackfaceProperty(),c=o.getOpacity(),l=o.getAmbientColor(),u=o.getAmbient(),f=o.getDiffuseColor(),g=o.getDiffuse(),m=o.getSpecularColor(),p=o.getSpecular(),s.setUniformf("ambientIntensityBF",u),s.setUniformf("diffuseIntensityBF",g),s.setUniformf("opacityUniformBF",c),s.setUniform3fArray("ambientColorUniformBF",l),s.setUniform3fArray("diffuseColorUniformBF",f),d<1)return;s.setUniformf("specularIntensityBF",p),s.setUniform3fArray("specularColorUniformBF",m),s.setUniformf("specularPowerUniformBF",h)}},t.updateMaximumPointCellIds=(r,a)=>{var o,c,l,f;const i=e._openGLRenderer.getSelector();if(!i)return;if((c=(o=e.selectionWebGLIdsToVTKIds)==null?void 0:o.points)!=null&&c.length){const u=e.selectionWebGLIdsToVTKIds.points.length;i.setMaximumPointId(u-1)}if((f=(l=e.selectionWebGLIdsToVTKIds)==null?void 0:l.cells)!=null&&f.length){const u=e.selectionWebGLIdsToVTKIds.cells.length;i.setMaximumCellId(u-1)}i.getFieldAssociation()===Ef.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,a)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const i=TV(e._openGLRenderer);if(e.lastSelectionState!==i&&(e.selectionStateChanged.modified(),e.lastSelectionState=i),e._openGLRenderer.getSelector())switch(i){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(r,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,a)=>{const i=a.getProperty().getRepresentation(),s=a.getProperty().getEdgeVisibility()&&i===Ti.SURFACE,o=e._openGLRenderer.getSelector(),c=o&&o.getFieldAssociation()===Ef.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===$t.ID_LOW24||e.lastSelectionState===$t.ID_HIGH24);for(let l=gt.Start;l<gt.End;l++)e.primitives[l].setPointPicking(c),e.primitives[l].getCABO().getElementCount()&&(e.drawingEdges=s&&(l===gt.TrisEdges||l===gt.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[l],e.primitiveIDOffset+=e.primitives[l].drawArrays(r,a,i,t),e.vertexIDOffset+=e.primitives[l].getCABO().getElementCount()))},t.renderPieceFinish=(r,a)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,a)=>{if(t.invokeEvent(vV),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(yV),!e.currentInput){Ra("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const i=e.context,s=a.getProperty().getBackfaceCulling(),o=a.getProperty().getFrontfaceCulling();!s&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)},t.computeBounds=(r,a)=>{if(!t.getInput()){Es(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,a)=>{t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,a)=>{const i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentInput.getMTime()},t.buildBufferObjects=(r,a)=>{const i=e.currentInput;if(i===null)return;e.renderable.mapScalars(i,1);const s=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===Y0.USE_CELL_DATA||o===Y0.USE_CELL_FIELD_DATA||o===Y0.USE_FIELD_DATA||!i.getPointData().getScalars())&&o!==Y0.USE_POINT_FIELD_DATA&&s&&(e.haveCellScalars=!0);let c=a.getProperty().getInterpolation()!==rh.FLAT?i.getPointData().getNormals():null;c===null&&i.getCellData().getNormals()&&(e.haveCellNormals=!0,c=i.getCellData().getNormals());const l=a.getProperty().getRepresentation();let f=i.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(f=null);let u=!1;if(e.renderable.getColorCoordinates()){f=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=ke.newInstance({resizable:!0}));const p=e.internalColorTexture;p.setMinificationFilter(ah.NEAREST),p.setMagnificationFilter(ah.NEAREST),p.setWrapS(ih.CLAMP_TO_EDGE),p.setWrapT(ih.CLAMP_TO_EDGE),p.setOpenGLRenderWindow(e._openGLRenderWindow);const h=e.renderable.getColorTextureMap(),d=h.getExtent(),m=h.getPointData().getScalars();p.create2DFromRaw(d[1]-d[0]+1,d[3]-d[2]+1,m.getNumberOfComponents(),m.getDataType(),m.getData()),p.activate(),p.sendParameters(),p.deactivate()}const g=`${i.getMTime()}A${l}B${i.getMTime()}C${c?c.getMTime():1}D${s?s.getMTime():1}E${a.getProperty().getEdgeVisibility()}F${f?f.getMTime():1}`;if(e.VBOBuildString!==g){const h={points:i.getPoints(),normals:c,tcoords:f,colors:s,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(v=>i.getPointData().getArrayByName(v))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const d=[{inRep:"verts",cells:i.getVerts()},{inRep:"lines",cells:i.getLines()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()},{inRep:"polys",cells:i.getPolys()},{inRep:"strips",cells:i.getStrips()}],m=a.getProperty().getEdgeVisibility()&&l===Ti.SURFACE;for(let v=gt.Start;v<gt.End;v++)v!==gt.TrisEdges&&v!==gt.TriStripsEdges?(h.cellOffset+=e.primitives[v].getCABO().createVBO(d[v].cells,d[v].inRep,l,h,e.selectionWebGLIdsToVTKIds),h.vertexOffset+=e.primitives[v].getCABO().getElementCount()):m?e.primitives[v].getCABO().createVBO(d[v].cells,d[v].inRep,Ti.WIREFRAME,{...h,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[v].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=g}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(a=>{r+=a.getAllocatedGPUMemoryInBytes()}),r}}const SV={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:$t.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function Sm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SV,n),st.extend(t,e,n),ha.implementReplaceShaderCoincidentOffset(t,e,n),ha.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=gt,e.tmpMat3=jn(new Float64Array(9)),e.tmpMat4=te(new Float64Array(16));for(let r=gt.Start;r<gt.End;r++)e.primitives[r]=Ta.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ft(t,e,["context"]),e.VBOBuildTime={},Ue(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},Ue(e.selectionStateChanged,{mtime:0}),xV(t,e)}const wm=Le(Sm,"vtkOpenGLPolyDataMapper");var Ru={newInstance:wm,extend:Sm};Tt("vtkMapper",wm);const{vtkErrorMacro:As}=bt,{Representation:wV}=m0,{ObjectType:Z0}=Sr,{PassTypes:EV}=e5,RV={type:"StartEvent"},OV={type:"EndEvent"};function MV(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const n={...t};t.renderPiece=(r,a)=>{if(t.invokeEvent(RV),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(OV),!e.currentInput){As("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const i=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const s=a.getProperty().getBackfaceCulling(),o=a.getProperty().getFrontfaceCulling();!s&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.FRONT)):(e._openGLRenderWindow.enableCullFace(),i.cullFace(i.BACK)),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)},t.multiply4x4WithOffset=(r,a,i,s)=>{const o=a[0],c=a[1],l=a[2],f=a[3],u=a[4],g=a[5],p=a[6],h=a[7],d=a[8],m=a[9],v=a[10],C=a[11],y=a[12],T=a[13],x=a[14],S=a[15];let w=i[s],E=i[s+1],L=i[s+2],R=i[s+3];r[0]=w*o+E*u+L*d+R*y,r[1]=w*c+E*g+L*m+R*T,r[2]=w*l+E*p+L*v+R*x,r[3]=w*f+E*h+L*C+R*S,w=i[s+4],E=i[s+5],L=i[s+6],R=i[s+7],r[4]=w*o+E*u+L*d+R*y,r[5]=w*c+E*g+L*m+R*T,r[6]=w*l+E*p+L*v+R*x,r[7]=w*f+E*h+L*C+R*S,w=i[s+8],E=i[s+9],L=i[s+10],R=i[s+11],r[8]=w*o+E*u+L*d+R*y,r[9]=w*c+E*g+L*m+R*T,r[10]=w*l+E*p+L*v+R*x,r[11]=w*f+E*h+L*C+R*S,w=i[s+12],E=i[s+13],L=i[s+14],R=i[s+15],r[12]=w*o+E*u+L*d+R*y,r[13]=w*c+E*g+L*m+R*T,r[14]=w*l+E*p+L*v+R*x,r[15]=w*f+E*h+L*C+R*S},t.replaceShaderNormal=(r,a,i)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=r.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(o=G.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=G.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),r.Vertex=o}n.replaceShaderNormal(r,a,i)},t.replaceShaderColor=(r,a,i)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let s=r.Vertex,o=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(f=f.concat(["varying vec4 vertexColorVSOutput;"]),s=G.substitute(s,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,s=G.substitute(s,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,o=G.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=G.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,u=u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=G.substitute(c,"//VTK::Color::Impl",u).result,c=G.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=s,r.Geometry=o,r.Fragment=c}n.replaceShaderColor(r,a,i)},t.replaceShaderPositionVC=(r,a,i)=>{if(e.hardwareSupport){let s=r.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(s=G.substitute(s,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,s=G.substitute(s,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(s=G.substitute(s,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,s=G.substitute(s,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),r.Vertex=s}n.replaceShaderPositionVC(r,a,i)},t.replaceShaderPicking=(r,a,i)=>{if(e.hardwareSupport){let s=r.Fragment,o=r.Vertex;o=G.substitute(o,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,o=G.substitute(o,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,r.Vertex=o,s=G.substitute(s,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,s=G.substitute(s,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,r.Fragment=s}else n.replaceShaderPicking(r,a,i)},t.updateGlyphShaderParameters=(r,a,i,s,o,c,l,f)=>{const u=i.getProgram();if(r){const g=e.normalMatrix,p=c,h=l*9,d=e.tmpMat3,m=g[0],v=g[1],C=g[2],y=g[3],T=g[4],x=g[5],S=g[6],w=g[7],E=g[8],L=p[h],R=p[h+1],D=p[h+2],I=p[h+3],b=p[h+4],F=p[h+5],W=p[h+6],P=p[h+7],K=p[h+8];d[0]=L*m+R*y+D*S,d[1]=L*v+R*T+D*w,d[2]=L*C+R*x+D*E,d[3]=I*m+b*y+F*S,d[4]=I*v+b*T+F*w,d[5]=I*C+b*x+F*E,d[6]=W*m+P*y+K*S,d[7]=W*v+P*T+K*w,d[8]=W*C+P*x+K*E,u.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,o,l*16),u.setUniformMatrix("MCPCMatrix",e.tmpMat4),a&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,o,l*16),u.setUniformMatrix("MCVCMatrix",e.tmpMat4)),s){const g=s.getData();e.tmpColor[0]=g[l*4]/255,e.tmpColor[1]=g[l*4+1]/255,e.tmpColor[2]=g[l*4+2]/255,u.setUniform3fArray("ambientColorUniform",e.tmpColor),u.setUniform3fArray("diffuseColorUniform",e.tmpColor)}f&&u.setUniform3fArray("mapperIndex",f.getPropColorValue())},t.renderPieceDraw=(r,a)=>{const i=a.getProperty().getRepresentation(),s=e.context,o=a.getProperty().getEdgeVisibility()&&i===wV.SURFACE,c=e.openGLCamera.getKeyMatrices(r),l=e.openGLActor.getKeyMatrices();fs(e.normalMatrix,c.normalMatrix,l.normalMatrix),ge(e.mcpcMatrix,c.wcpc,l.mcwc),ge(e.mcvcMatrix,c.wcvc,l.mcwc);const f=e.renderable.getMatrixArray(),u=e.renderable.getNormalArray(),g=e.renderable.getColorArray(),p=f.length/16;let h=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===EV.COMPOSITE_INDEX_PASS&&(h=!0);for(let d=e.primTypes.Start;d<e.primTypes.End;d++){const m=e.primitives[d].getCABO();if(m.getElementCount()){e.drawingEdges=o&&(d===e.primTypes.TrisEdges||d===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[d],e.primitives[d].updateShaders(r,a,t);const v=e.primitives[d].getProgram(),C=e.primitives[d].getOpenGLMode(i),y=v.isUniformUsed("normalMatrix"),T=v.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(C,0,m.getElementCount(),p):s.drawArraysInstanced(C,0,m.getElementCount(),p);else for(let x=0;x<p;++x)h&&e._openGLRenderer.getSelector().renderCompositeIndex(x),t.updateGlyphShaderParameters(y,T,e.primitives[d],g,f,u,x,h?e._openGLRenderer.getSelector():null),s.drawArrays(C,0,m.getElementCount())}}},t.setMapperShaderParameters=(r,a,i)=>{if(r.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){r.getProgram().isAttributeUsed("gMatrix")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||As("Error setting gMatrix in shader VAO."):r.getVAO().removeAttributeArray("gMatrix"),r.getProgram().isAttributeUsed("gNormal")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||As("Error setting gNormal in shader VAO."):r.getVAO().removeAttributeArray("gNormal"),r.getProgram().isAttributeUsed("gColor")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||As("Error setting gColor in shader VAO."):r.getVAO().removeAttributeArray("gColor"),r.getProgram().isAttributeUsed("mapperIndexVS")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||As("Error setting mapperIndexVS in shader VAO."):r.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(r,a,i),r.getAttributeUpdateTime().modified();return}n.setMapperShaderParameters(r,a,i)},t.getNeedToRebuildBufferObjects=(r,a)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:n.getNeedToRebuildBufferObjects(r,a)),t.getNeedToRebuildShaders=(r,a,i)=>!!(n.getNeedToRebuildShaders(r,a,i)||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(r,a)=>{if(e.hardwareSupport){const i=e.renderable.getMatrixArray(),s=e.renderable.getNormalArray(),o=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=Sr.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=Sr.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=Sr.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=Sr.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(i,Z0.ARRAY_BUFFER),e.normalBuffer.upload(s,Z0.ARRAY_BUFFER),o?e.colorBuffer.upload(o.getData(),Z0.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const c=i.length/16,l=new Uint8Array(4*c);for(let f=0;f<c;++f){let u=f+1;const g=f*4;l[g]=u%256,u-=l[g],u/=256,l[g+1]=u%256,u-=l[g+1],u/=256,l[g+2]=u%256,l[g+3]=255}e.pickBuffer.upload(l,Z0.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return n.buildBufferObjects(r,a)}}const DV={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function VV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DV,n),Ru.extend(t,e,n),e.tmpMat3=jn(new Float64Array(9)),e.normalMatrix=jn(new Float64Array(9)),e.mcpcMatrix=te(new Float64Array(16)),e.mcvcMatrix=te(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},Ue(e.glyphBOBuildTime,{mtime:0}),MV(t,e)}const Em=Le(VV,"vtkOpenGLGlyph3DMapper");var LV={newInstance:Em};Tt("vtkGlyph3DMapper",Em);const _V={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var Ou={SlicingMode:_V};const Ja={NEAREST:0,LINEAR:1};var NV={InterpolationType:Ja};function lr(t,e,n){return t?`${t.getMTime()}-${e}-${n}`:"0"}function v5(t,e){return`${t.getMTime()}A${e.getMTime()}`}const{vtkErrorMacro:xi}=bt,{SlicingMode:Ln}=Ou;function IV(t){const e=t.split(`
`),n=[];for(let r=0;r<e.length;++r){const a=e[r].trim();a.length>0&&n.push(a)}return n}function FV(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function n(r){e.openGLTexture.releaseGraphicsResources(r),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray].forEach(a=>r.unregisterGraphicsResourceUser(a,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const a=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),a&&!a.isDeleted()&&a!==e._openGLRenderWindow&&n(a),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const i=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(i.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(i.getActiveCamera())}},t.translucentPass=(r,a)=>{r&&(e.currentRenderPass=a,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.getCoincidentParameters=(r,a)=>e.renderable.getResolveCoincidentTopology()==Kn.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,r)},t.getShaderTemplate=(r,a,i)=>{r.Vertex=m5,r.Fragment=v0,r.Geometry=""},t.replaceShaderValues=(r,a,i)=>{let s=r.Vertex,o=r.Fragment;s=G.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=G.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,s=G.substitute(s,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,s=G.substitute(s,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=i.getProperty().getIndependentComponents();let f=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(l){for(let g=1;g<c;g++)f=f.concat([`uniform float cshift${g};`,`uniform float cscale${g};`,`uniform float pwfshift${g};`,`uniform float pwfscale${g};`]);switch(c){case 1:f=f.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:f=f.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:xi("Unsupported number of independent coordinates.")}}if(o=G.substitute(o,"//VTK::TCoord::Dec",f).result,i.getProperty().getUseLabelOutline()===!0&&(o=G.substitute(o,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;"]).result,o=G.substitute(o,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,o=G.substitute(o,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","#endif"]).result),l){const g=["r","g","b","a"];let p=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let h=0;h<c;h++)p=p.concat([`vec3 tcolor${h} = mix${h} * texture2D(colorTexture1, vec2(tvalue.${g[h]} * cscale${h} + cshift${h}, height${h})).rgb;`,`float compWeight${h} = mix${h} * texture2D(pwfTexture1, vec2(tvalue.${g[h]} * pwfscale${h} + pwfshift${h}, height${h})).r;`]);switch(c){case 1:p=p.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:p=p.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:p=p.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:p=p.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:xi("Unsupported number of independent coordinates.")}o=G.substitute(o,"//VTK::TCoord::Impl",p).result}else switch(c){case 1:o=G.substitute(o,"//VTK::TCoord::Impl",[...IV(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, centerPosIS.xy).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 1.0, 1.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, neighborPosIS.xy).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:o=G.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:o=G.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:o=G.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(o=G.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=G.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=s,r.Fragment=o,t.replaceShaderClip(r,a,i),t.replaceShaderCoincidentOffset(r,a,i)},t.replaceShaderClip=(r,a,i)=>{let s=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(fe("OpenGL has a limit of 6 clipping planes"),c=6),s=G.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,s=G.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=G.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=G.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=s,r.Fragment=o},t.getNeedToRebuildShaders=(r,a,i)=>{var l;const s=e.openGLTexture.getComponents(),o=i.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((l=r.getProgram())==null?void 0:l.getHandle())===0||e.lastTextureComponents!==s||e.lastIndependentComponents!==o?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=o,!0):!1},t.updateShaders=(r,a,i)=>{if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,a,i)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,i);const o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);o!==r.getProgram()&&(r.setProgram(o),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,a,i),t.setCameraShaderParameters(r,a,i),t.setPropertyShaderParameters(r,a,i)},t.setMapperShaderParameters=(r,a,i)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||xi("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),e.context.FALSE)||xi("Error setting tcoordMC in shader VAO.")),r.getAttributeUpdateTime().modified());const s=e.openGLTexture.getTextureUnit();r.getProgram().setUniformi("texture1",s);const o=e.openGLTexture.getComponents(),c=i.getProperty().getIndependentComponents();if(c)for(let h=0;h<o;h++)r.getProgram().setUniformf(`mix${h}`,i.getProperty().getComponentWeight(h));const l=e.openGLTexture.getShiftAndScale();for(let h=0;h<o;h++){let d=i.getProperty().getColorWindow(),m=i.getProperty().getColorLevel();const v=c?h:0,C=i.getProperty().getRGBTransferFunction(v);if(C&&i.getProperty().getUseLookupTableScalarRange()){const x=C.getRange();d=x[1]-x[0],m=.5*(x[1]+x[0])}const y=l.scale/d,T=(l.shift-m)/d+.5;r.getProgram().setUniformf(`cshift${h}`,T),r.getProgram().setUniformf(`cscale${h}`,y)}for(let h=0;h<o;h++){let d=1,m=0;const v=c?h:0,C=i.getProperty().getPiecewiseFunction(v);if(C){const y=C.getRange(),T=y[1]-y[0],x=.5*(y[0]+y[1]);d=l.scale/T,m=(l.shift-x)/T+.5}r.getProgram().setUniformf(`pwfshift${h}`,m),r.getProgram().setUniformf(`pwfscale${h}`,d)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const h=t.getCoincidentParameters(a,i);r.getProgram().setUniformf("coffset",h.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",h.factor)}const f=e.colorTexture.getTextureUnit();r.getProgram().setUniformi("colorTexture1",f);const u=e.pwfTexture.getTextureUnit();r.getProgram().setUniformi("pwfTexture1",u);const g=e.labelOutlineThicknessTexture.getTextureUnit();if(r.getProgram().setUniformi("labelOutlineTexture1",g),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(fe("OpenGL has a limit of 6 clipping planes"),h=6);const m=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,v=m?Ze(e.imagematinv,i.getMatrix()):i.getMatrix();m&&(me(v,v),ge(v,v,m),me(v,v)),me(e.imagemat,e.currentInput.getIndexToWorld()),ge(e.imagematinv,v,e.imagemat);const C=[];for(let y=0;y<h;y++){const T=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,y,T);for(let x=0;x<4;x++)C.push(T[x])}r.getProgram().setUniformi("numClipPlanes",h),r.getProgram().setUniform4fv("clipPlanes",C)}if(i.getProperty().getUseLabelOutline()===!0){const h=i.getProperty().getLabelOutlineOpacity();r.getProgram().setUniformf("outlineOpacity",h)}},t.setCameraShaderParameters=(r,a,i)=>{const s=r.getProgram(),o=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();ge(e.imagemat,o.mcwc,l);const f=e.openGLCamera.getKeyMatrices(a);if(ge(e.imagemat,f.wcpc,e.imagemat),r.getCABO().getCoordShiftAndScaleEnabled()){const g=r.getCABO().getInverseShiftAndScaleMatrix();ge(e.imagemat,e.imagemat,g)}if(s.setUniformMatrix("MCPCMatrix",e.imagemat),i.getProperty().getUseLabelOutline()===!0){const g=c.getWorldToIndex(),p=c.getDimensions();s.setUniform3i("imageDimensions",p[0],p[1],1),s.setUniformMatrix("vWCtoIDX",g);const h=e.openGLCamera.getKeyMatrices(a);lt(e.projectionToWorld,h.wcpc),e.openGLCamera.getKeyMatrices(a),s.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const d=t.getRenderTargetSize();s.setUniformf("vpWidth",d[0]),s.setUniformf("vpHeight",d[1]);const m=t.getRenderTargetOffset();s.setUniformf("vpOffsetX",m[0]/d[0]),s.setUniformf("vpOffsetY",m[1]/d[1])}},t.setPropertyShaderParameters=(r,a,i)=>{const s=r.getProgram(),c=i.getProperty().getOpacity();s.setUniformf("opacity",c)},t.renderPieceStart=(r,a)=>{t.updateBufferObjects(r,a),e.lastBoundBO=null},t.renderPieceDraw=(r,a)=>{const i=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,a),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,a)=>{},t.renderPiece=(r,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){xi("No input!");return}t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)},t.computeBounds=(r,a)=>{if(!t.getInput()){Es(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,a)=>{t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a)},t.getNeedToRebuildBufferObjects=(r,a)=>{var i,s,o,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((i=e.openGLTexture)!=null&&i.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((o=e.labelOutlineThicknessTexture)!=null&&o.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(r,a)=>{var I,b,F,W;const i=e.currentInput;if(!i)return;const s=i.getPointData()&&i.getPointData().getScalars();if(!s)return;const o=s.getDataType(),c=s.getNumberOfComponents(),l=a.getProperty(),f=l.getInterpolationType(),u=l.getIndependentComponents(),g=u?c:1,p=u?2*g:1,h=l.getRGBTransferFunction(),d=lr(h,u,g),m=e._openGLRenderWindow.getGraphicsResourceForObject(h);if(!((I=m==null?void 0:m.oglObject)!=null&&I.getHandle())||(m==null?void 0:m.hash)!==d){e.colorTexture=ke.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const P=1024,K=P*p*3,U=new Uint8ClampedArray(K);if(f===Ja.NEAREST?(e.colorTexture.setMinificationFilter(ee.NEAREST),e.colorTexture.setMagnificationFilter(ee.NEAREST)):(e.colorTexture.setMinificationFilter(ee.LINEAR),e.colorTexture.setMagnificationFilter(ee.LINEAR)),h){const N=new Float32Array(P*3);for(let k=0;k<g;k++){const z=l.getRGBTransferFunction(k),j=z.getRange();if(z.getTable(j[0],j[1],P,N,1),u)for(let $=0;$<P*3;$++)U[k*P*6+$]=255*N[$],U[k*P*6+$+P*3]=255*N[$];else for(let $=0;$<P*3;$++)U[k*P*6+$]=255*N[$]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(P,p,3,ce.UNSIGNED_CHAR,U)}else{for(let N=0;N<P*3;++N)U[N]=255*N/((P-1)*3),U[N+1]=255*N/((P-1)*3),U[N+2]=255*N/((P-1)*3);e.colorTexture.create2DFromRaw(P,1,3,ce.UNSIGNED_CHAR,U)}h&&(e._openGLRenderWindow.setGraphicsResourceForObject(h,e.colorTexture,d),h!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(h,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=h)}else e.colorTexture=m.oglObject;const C=l.getPiecewiseFunction(),y=lr(C,u,g),T=e._openGLRenderWindow.getGraphicsResourceForObject(C);if(!((b=T==null?void 0:T.oglObject)!=null&&b.getHandle())||(T==null?void 0:T.hash)!==y){const K=1024*p,U=new Uint8ClampedArray(K);if(e.pwfTexture=ke.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),f===Ja.NEAREST?(e.pwfTexture.setMinificationFilter(ee.NEAREST),e.pwfTexture.setMagnificationFilter(ee.NEAREST)):(e.pwfTexture.setMinificationFilter(ee.LINEAR),e.pwfTexture.setMagnificationFilter(ee.LINEAR)),C){const N=new Float32Array(K),k=new Float32Array(1024);for(let z=0;z<g;++z){const j=l.getPiecewiseFunction(z);if(j===null)N.fill(1);else{const $=j.getRange();if(j.getTable($[0],$[1],1024,k,1),u)for(let re=0;re<1024;re++)N[z*1024*2+re]=k[re],N[z*1024*2+re+1024]=k[re];else for(let re=0;re<1024;re++)N[z*1024*2+re]=k[re]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,p,1,ce.FLOAT,N)}else U.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,ce.UNSIGNED_CHAR,U);C&&(e._openGLRenderWindow.setGraphicsResourceForObject(C,e.pwfTexture,y),C!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(C,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=C)}else e.pwfTexture=T.oglObject;t.updatelabelOutlineThicknessTexture(a);const{ijkMode:S}=e.renderable.getClosestIJKAxis();let w=e.renderable.getSlice();S!==e.renderable.getSlicingMode()&&(w=e.renderable.getSliceAtPosition(w));const E=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(w),L=i.getExtent();let R;S===Ln.I&&(R=E-L[0]),S===Ln.J&&(R=E-L[2]),(S===Ln.K||S===Ln.NONE)&&(R=E-L[4]);const D=`${w}A${i.getMTime()}A${s.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${a.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==D){const P=i.getDimensions();e.openGLTexture||(e.openGLTexture=ke.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),f===Ja.NEAREST?(new Set([1,3,4]).has(c)&&o===ce.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(ee.NEAREST),e.openGLTexture.setMagnificationFilter(ee.NEAREST)):(c===4&&o===ce.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(ee.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(ee.LINEAR),e.openGLTexture.setMagnificationFilter(ee.LINEAR)),e.openGLTexture.setWrapS(Ko.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(Ko.CLAMP_TO_EDGE);const K=P[0]*P[1]*c,U=new Float32Array(12),N=new Float32Array(8);for(let Mt=0;Mt<4;Mt++)N[Mt*2]=Mt%2?1:0,N[Mt*2+1]=Mt>1?1:0;const k=[Ln.X,Ln.Y,Ln.Z].includes(e.renderable.getSlicingMode())?w:E,z=i.getSpatialExtent(),j=s.getData();let $=null;if(S===Ln.I){$=new j.constructor(P[2]*P[1]*c);let Mt=0;for(let tt=0;tt<P[2];tt++)for(let pe=0;pe<P[1];pe++){let he=(R+pe*P[0]+tt*P[0]*P[1])*c;Mt=(tt*P[1]+pe)*c;const Yt=he+c;for(;he<Yt;)$[Mt++]=j[he++]}P[0]=P[1],P[1]=P[2],U[0]=k,U[1]=z[2],U[2]=z[4],U[3]=k,U[4]=z[3],U[5]=z[4],U[6]=k,U[7]=z[2],U[8]=z[5],U[9]=k,U[10]=z[3],U[11]=z[5]}else if(S===Ln.J){$=new j.constructor(P[2]*P[0]*c);let Mt=0;for(let tt=0;tt<P[2];tt++)for(let pe=0;pe<P[0];pe++){let he=(pe+R*P[0]+tt*P[0]*P[1])*c;Mt=(tt*P[0]+pe)*c;const Yt=he+c;for(;he<Yt;)$[Mt++]=j[he++]}P[1]=P[2],U[0]=z[0],U[1]=k,U[2]=z[4],U[3]=z[1],U[4]=k,U[5]=z[4],U[6]=z[0],U[7]=k,U[8]=z[5],U[9]=z[1],U[10]=k,U[11]=z[5]}else S===Ln.K||S===Ln.NONE?($=j.subarray(R*K,(R+1)*K),U[0]=z[0],U[1]=z[2],U[2]=k,U[3]=z[1],U[4]=z[2],U[5]=k,U[6]=z[0],U[7]=z[3],U[8]=k,U[9]=z[1],U[10]=z[3],U[11]=k):xi("Reformat slicing not yet supported.");e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw(P[0],P[1],c,s.getDataType(),$,(W=(F=e.renderable).getPreferSizeOverAccuracy)==null?void 0:W.call(F)),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const re=le.newInstance({numberOfComponents:3,values:U});re.setName("points");const xt=le.newInstance({numberOfComponents:2,values:N});xt.setName("tcoords");const Me=new Uint16Array(8);Me[0]=3,Me[1]=0,Me[2]=1,Me[3]=3,Me[4]=3,Me[5]=0,Me[6]=3,Me[7]=2;const Gt=le.newInstance({numberOfComponents:1,values:Me});e.tris.getCABO().createVBO(Gt,"polys",On.SURFACE,{points:re,tcoords:xt,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=D}},t.updatelabelOutlineThicknessTexture=r=>{var c;const a=r.getProperty().getLabelOutlineThickness(),i=e._openGLRenderWindow.getGraphicsResourceForObject(a),s=`${a.join("-")}`;if(!((c=i==null?void 0:i.oglObject)!=null&&c.getHandle())||(i==null?void 0:i.hash)!==s){const g=new Uint8Array(1024);for(let p=0;p<1024;++p){const h=typeof a[p]<"u"?a[p]:a[0];g[p]=h}e.labelOutlineThicknessTexture=ke.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(ee.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(ee.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,ce.UNSIGNED_CHAR,g),a&&(e._openGLRenderWindow.setGraphicsResourceForObject(a,e.labelOutlineThicknessTexture,s),a!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(a,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=a)}else e.labelOutlineThicknessTexture=i.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:r,vsize:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,a]},t.getRenderTargetOffset=()=>{const{lowerLeftU:r,lowerLeftV:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,a]},t.delete=g0(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const kV={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function UV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kV,n),st.extend(t,e,n),ha.implementReplaceShaderCoincidentOffset(t,e,n),ha.implementBuildShadersWithReplacements(t,e,n),e.tris=Ta.newInstance(),e.imagemat=te(new Float64Array(16)),e.imagematinv=te(new Float64Array(16)),e.projectionToWorld=te(new Float64Array(16)),e.idxToView=te(new Float64Array(16)),e.idxNormalMatrix=jn(new Float64Array(9)),e.modelToView=te(new Float64Array(16)),e.projectionToView=te(new Float64Array(16)),ft(t,e,[]),e.VBOBuildTime={},Ue(e.VBOBuildTime),FV(t,e)}const Rm=Le(UV,"vtkOpenGLImageMapper");var PV={newInstance:Rm};Tt("vtkAbstractImageMapper",Rm);function bV(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{n&&e.context.depthMask(!0)},t.translucentPass=(n,r)=>{e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(Ze(e.keyMatrices.mcwc,e.renderable.getMatrix()),me(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const GV={context:null,keyMatrixTime:null,keyMatrices:null};function BV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GV,n),st.extend(t,e,n),e.keyMatrixTime={},Ue(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:te(new Float64Array(16))},ft(t,e,["context"]),bV(t,e)}const Om=Le(BV,"vtkOpenGLImageSlice");var AV={newInstance:Om};Tt("vtkImageSlice",Om);const{vtkDebugMacro:WV}=bt;function zV(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const a=e._openGLRenderer.getAspectRatio(),i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();let o=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),l=Math.floor(c.getWidth()),f=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();const g=r.getFramebuffer();g?g.saveCurrentBindingsAndBuffers():WV("No framebuffer to save/restore");const p=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,p),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(l*f*4),u.viewport(0,0,l,f),u.readPixels(0,0,l,f,u.RGBA,u.UNSIGNED_BYTE,o)),g&&g.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(p)}e.renderable.invokeCallback(e.renderable.getInputData(),i,a,s,o)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const $V={};function jV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$V,n),st.extend(t,e,n),zV(t,e)}const Mm=Le(jV,"vtkOpenGLPixelSpaceCallbackMapper");var HV={newInstance:Mm};Tt("vtkPixelSpaceCallbackMapper",Mm);const{vtkDebugMacro:KV}=bt;function qV(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(KV("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),r|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const i=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),a.colorMask(!0,!0,!0,!0),r&&a.clear(r),a.enable(a.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],i=n[1]-r[1],s=e._parent.normalizedDisplayToDisplay(a,i),o=Math.round(s[0]),c=Math.round(s[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-o,p=Math.round(u[1])-c;return g<0&&(g=0),p<0&&(p=0),{usize:g,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const i=e.renderable.getBackgroundByReference();r.clearColor(i[0],i[1],i[2],i[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const a=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),r.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const XV={context:null,_openGLRenderWindow:null,selector:null};function YV(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XV,n),st.extend(t,e,n),Xt(t,e,["shaderCache"]),ft(t,e,["selector"]),f0(t,e,["openGLRenderWindow"]),qV(t,e)}const Dm=Le(YV,"vtkOpenGLRenderer");var ZV={newInstance:Dm};Tt("vtkRenderer",Dm);const{vtkErrorMacro:sh}=bt;function QV(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);const i=e._openGLRenderer.getRenderable(),s=e.openGLCamera.getKeyMatrices(i),o=new Float64Array(16);if(lt(o,s.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",o),e.lastFormat==="box"){const c=i.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let o=0;o<4;o++)r[o*3]=o%2*2-1,r[o*3+1]=o>1?1:-1,r[o*3+2]=1;const a=le.newInstance({numberOfComponents:3,values:r});a.setName("points");const i=new Uint16Array(8);i[0]=3,i[1]=0,i[2]=1,i[3]=3,i[4]=3,i[5]=0,i[6]=3,i[7]=2;const s=le.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",On.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||sh("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||sh("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const JV={context:null};function eL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JV,n),st.extend(t,e,n),e.openGLTexture=ke.newInstance(),e.tris=Ta.newInstance(),e.keyMatrixTime={},Ue(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:jn(new Float64Array(9)),mcwc:te(new Float64Array(16))},ft(t,e,["context"]),Xt(t,e,["activeTextures"]),QV(t,e)}const Vm=Le(eL);var tL={newInstance:Vm};Tt("vtkSkybox",Vm);var nL=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:rL}=bt;function aL(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const n={...t};t.getShaderTemplate=(r,a,i)=>{r.Vertex=nL,r.Fragment=v0,r.Geometry=""},t.replaceShaderValues=(r,a,i)=>{let s=r.Vertex,o=r.Fragment;s=G.substitute(s,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,o=G.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=G.substitute(o,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];o=G.substitute(o,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),o=G.substitute(o,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,o=G.substitute(o,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(o=G.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=s,r.Fragment=o,n.replaceShaderValues(r,a,i)},t.setMapperShaderParameters=(r,a,i)=>{if(r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"offsetMC",12,r.getCABO().getStride(),e.context.FLOAT,2,!1)||rL("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isUniformUsed("invertedDepth")&&r.getProgram().setUniformf("invertedDepth",e.invert?-1:1),r.getProgram().isUniformUsed("scaleFactor")){const o=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&o.hasArray(e.renderable.getScaleArray())?r.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):r.getProgram().setUniformf("scaleFactor",1)}n.setMapperShaderParameters(r,a,i)},t.setCameraShaderParameters=(r,a,i)=>{const s=r.getProgram(),o=a.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(a);if(s.isUniformUsed("VCPCMatrix")&&s.setUniformMatrix("VCPCMatrix",c.vcpc),s.isUniformUsed("MCVCMatrix"))if(i.getIsIdentity())s.setUniformMatrix("MCVCMatrix",c.wcvc);else{const l=e.openGLActor.getKeyMatrices(),f=new Float64Array(16);ge(f,c.wcvc,l.mcwc),s.setUniformMatrix("MCVCMatrix",f)}s.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",o.getParallelProjection())},t.getOpenGLMode=(r,a)=>e.context.TRIANGLES,t.buildBufferObjects=(r,a)=>{const i=e.currentInput;if(i===null)return;e.renderable.mapScalars(i,1);const s=e.renderable.getColorMapColors(),o=e.primitives[e.primTypes.Tris].getCABO(),c=i.getPointData(),l=i.getPoints(),f=l.getNumberOfPoints(),u=l.getData(),g=5;let p=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(p=c.getArray(e.renderable.getScaleArray()).getData());let h=null,d=0,m=null;s?(d=s.getNumberOfComponents(),o.setColorOffset(0),o.setColorBOStride(4),h=s.getData(),m=new Uint8Array(3*f*4),o.getColorBO()||o.setColorBO(Sr.newInstance()),o.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):o.getColorBO()&&o.setColorBO(null),o.setColorComponents(d);const v=new Float32Array(g*f*3);o.setStride(g*4);const C=Math.cos(We(30));let y=0,T=0,x=0,S=0;for(let w=0;w<f;++w){let E=e.renderable.getRadius();p&&(E=p[w]),y=w*3,v[x++]=u[y++],v[x++]=u[y++],v[x++]=u[y++],v[x++]=-2*E*C,v[x++]=-E,h&&(T=w*d,m[S++]=h[T],m[S++]=h[T+1],m[S++]=h[T+2],m[S++]=h[T+3]),y=w*3,v[x++]=u[y++],v[x++]=u[y++],v[x++]=u[y++],v[x++]=2*E*C,v[x++]=-E,h&&(m[S++]=h[T],m[S++]=h[T+1],m[S++]=h[T+2],m[S++]=h[T+3]),y=w*3,v[x++]=u[y++],v[x++]=u[y++],v[x++]=u[y++],v[x++]=0,v[x++]=2*E,h&&(m[S++]=h[T],m[S++]=h[T+1],m[S++]=h[T+2],m[S++]=h[T+3])}o.setElementCount(x/g),o.upload(v,Or.ARRAY_BUFFER),s&&o.getColorBO().upload(m,Or.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const iL={};function sL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iL,n),Ru.extend(t,e,n),aL(t,e)}const Lm=Le(sL,"vtkOpenGLSphereMapper");var oL={newInstance:Lm};Tt("vtkSphereMapper",Lm);var cL=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:Q0}=bt;function lL(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const n={...t};t.getShaderTemplate=(r,a,i)=>{r.Vertex=cL,r.Fragment=v0,r.Geometry=""},t.replaceShaderValues=(r,a,i)=>{let s=r.Vertex,o=r.Fragment;s=G.substitute(s,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,o=G.substitute(o,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,o=G.substitute(o,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];o=G.substitute(o,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),o=G.substitute(o,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,o=G.substitute(o,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(o=G.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=s,r.Fragment=o,n.replaceShaderValues(r,a,i)},t.setMapperShaderParameters=(r,a,i)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("orientMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"orientMC",12,r.getCABO().getStride(),e.context.FLOAT,3,!1)||Q0("Error setting 'orientMC' in shader VAO.")),r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"offsetMC",0,r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||Q0("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isAttributeUsed("radiusMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"radiusMC",24,r.getCABO().getStride(),e.context.FLOAT,1,!1)||Q0("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(r,a,i)},t.setCameraShaderParameters=(r,a,i)=>{const s=r.getProgram(),o=a.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(a);if(s.isUniformUsed("VCPCMatrix")&&s.setUniformMatrix("VCPCMatrix",c.vcpc),i.getIsIdentity())s.isUniformUsed("MCVCMatrix")&&s.setUniformMatrix("MCVCMatrix",c.wcvc),s.isUniformUsed("normalMatrix")&&s.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const l=e.openGLActor.getKeyMatrices();if(s.isUniformUsed("MCVCMatrix")){const f=new Float64Array(16);ge(f,c.wcvc,l.mcwc),s.setUniformMatrix("MCVCMatrix",f)}if(s.isUniformUsed("normalMatrix")){const f=new Float64Array(9);fs(f,c.normalMatrix,l.normalMatrix),s.setUniformMatrix3x3("normalMatrix",f)}}s.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",o.getParallelProjection())},t.getOpenGLMode=(r,a)=>e.context.TRIANGLES,t.buildBufferObjects=(r,a)=>{const i=e.currentInput;if(i===null)return;e.renderable.mapScalars(i,1);const s=e.renderable.getColorMapColors(),o=e.primitives[e.primTypes.Tris].getCABO(),c=i.getPointData(),l=i.getPoints(),f=l.getNumberOfPoints(),u=l.getData();let g=3;g+=4;let p=null,h=0;o.setColorBOStride(4),o.getColorBO()||o.setColorBO(Sr.newInstance()),o.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),s&&(h=s.getNumberOfComponents(),o.setColorOffset(4),p=s.getData(),o.setColorBOStride(8)),o.setColorComponents(h),o.setStride(g*4);const d=new Float32Array(g*f*12),m=new Uint8Array(12*f*(p?8:4));let v=null,C=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(v=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?C=c.getArray(e.renderable.getOrientationArray()).getData():Q0([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const y=[0,1,3,0,3,2,2,3,5,2,5,4];let T=0,x=0,S=0,w=0;for(let E=0;E<f;++E){let L=e.renderable.getLength(),R=e.renderable.getRadius();v&&(L=v[E*2],R=v[E*2+1]);for(let D=0;D<y.length;++D)T=E*3,d[S++]=u[T++],d[S++]=u[T++],d[S++]=u[T++],T=E*3,d[S++]=C[T++]*L,d[S++]=C[T++]*L,d[S++]=C[T++]*L,d[S++]=R,m[w++]=255*(y[D]%2),m[w++]=y[D]>=4?255:0,m[w++]=y[D]>=2?255:0,m[w++]=255,x=E*h,p&&(m[w++]=p[x],m[w++]=p[x+1],m[w++]=p[x+2],m[w++]=p[x+3])}o.setElementCount(S/g),o.upload(d,Or.ARRAY_BUFFER),o.getColorBO().upload(m,Or.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const uL={};function fL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uL,n),Ru.extend(t,e,n),lL(t,e)}const _m=Le(fL,"vtkOpenGLStickMapper");var gL={newInstance:_m};Tt("vtkStickMapper",_m);function pL(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=n=>{!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=n=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Ze(e.MCWCMatrix,e.renderable.getMatrix()),me(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?jn(e.normalMatrix):(pu(e.normalMatrix,e.MCWCMatrix),o0(e.normalMatrix,e.normalMatrix),xg(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const dL={};function hL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dL,n),st.extend(t,e,n),e.keyMatrixTime={},Ue(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),ft(t,e,["context"]),pL(t,e)}const Nm=Le(hL,"vtkOpenGLVolume");var mL={newInstance:Nm};Tt("vtkVolume",Nm);const o2={NEAREST:0,LINEAR:1,FAST_LINEAR:2},Im={FRACTIONAL:0,PROPORTIONAL:1},Pc={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var Fm={InterpolationType:o2,OpacityMode:Im,ColorMixPreset:Pc},vL=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,yL=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define UseIndependentComponents
//VTK::IndependentComponentsOn

// possibly define vtkCustomComponentsColorMix
//VTK::CustomComponentsColorMixOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// possibly define any components that are forced to nearest interpolation
//VTK::vtkForceNearestComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Possibly define vtkLabelEdgeProjectionOn
//VTK::LabelEdgeProjectionOn


#ifdef vtkImageLabelOutlineOn
  uniform float outlineOpacity;
  uniform float vpWidth;
  uniform float vpHeight;
  uniform float vpOffsetX;
  uniform float vpOffsetY;
  uniform mat4 PCWCMatrix;
  uniform mat4 vWCtoIDX;

  const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
  // bool seenSegmentsByOriginalPos[MAX_SEGMENT_INDEX];
  #define MAX_SEGMENTS 256
  #define UINT_SIZE 32
  #define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)

  uint bitmask[BITMASK_SIZE];

  // Set the corresponding bit in the bitmask
  void setBit(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    bitmask[index] |= 1u << bitIndex;
  }

  // Check if a bit is set in the bitmask
  bool isBitSet(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    return ((bitmask[index] & (1u << bitIndex)) != 0u);
  }
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#ifdef UseIndependentComponents
#if vtkNumComponents > 1
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents > 2
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#if vtkNumComponents > 3
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

// jitter texture
uniform sampler2D jtexture;
uniform sampler2D ttexture;


// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;
uniform vec3 volumeSpacings; // spacing in the world coorindates


// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef UseIndependentComponents
#if vtkNumComponents == 1
uniform float mix0;
#define height0 0.5
#endif
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);

  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);
    vec4 nearestValue = texture(texture1, nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  #ifndef UseIndependentComponents
    #if vtkNumComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkClippingPlanesOn
    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
    {
      vec3 g1VC[3];
      for (int i = 0; i < 3; ++i)
      {
        g1VC[i] = IStoVC(texPos[i]);
      }
      vec3 posVC = IStoVC(pos);
      for (int i = 0; i < clip_numPlanes; ++i)
      {
        for (int j = 0; j < 3; ++j)
        {
          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
          {
            g1[j] = 0.0;
          }
        }
      }
    }
  #endif

  #ifdef vtkComputeNormalFromOpacity
    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {
      vec3 opacityG1, opacityG2;
      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;
      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;
      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;
      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;
      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;
      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;
      opacityG1.xyz *= gradientOpacity;
      opacityG2.xyz *= gradientOpacity;

      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
      // divide by spacing
      opacityG.xyz /= vSpacing;
      opacityG.w = length(opacityG.xyz);
      // rotate to View Coords
      rotateToViewCoord(opacityG.xyz);
      if (!all(equal(opacityG.xyz, vec3(0.0)))) {
        return vec4(normalize(opacityG.xyz),opacityG.w);
      } else {
        return vec4(0.0);
      }
    }

    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)
    {
      vec3 xvec = vec3(tstep.x, 0.0, 0.0);
      vec3 yvec = vec3(0.0, tstep.y, 0.0);
      vec3 zvec = vec3(0.0, 0.0, tstep.z);
      vec3 texPosPVec[3];
      texPosPVec[0] = pos + xvec;
      texPosPVec[1] = pos + yvec;
      texPosPVec[2] = pos + zvec;
      vec3 texPosNVec[3];
      texPosNVec[0] = pos - xvec;
      texPosNVec[1] = pos - yvec;
      texPosNVec[2] = pos - zvec;
      vec3 g1, g2;

      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];
      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];
      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];
      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];
      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];
      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];

      #ifdef vtkClippingPlanesOn
        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
      #endif
      vec4 result;
      result.x = scalarInterp[0].x - scalarInterp[1].x;
      result.y = scalarInterp[0].y - scalarInterp[1].y;
      result.z = scalarInterp[0].z - scalarInterp[1].z;
      // divide by spacing
      result.xyz /= vSpacing;
      result.w = length(result.xyz);
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      if (length(result.xyz) > 0.0) {
        return vec4(normalize(result.xyz),result.w);
      } else {
        return vec4(0.0);
      }
    }
  #endif

  // only works with dependent components
  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif


#ifdef vtkImageLabelOutlineOn
  vec4 fragCoordToPCPos(vec4 fragCoord) {
    return vec4(
      (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
      (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
      (fragCoord.z - 0.5) * 2.0,
      1.0);
  }

  vec4 pcPosToWorldCoord(vec4 pcPos) {
    return PCWCMatrix * pcPos;
  }

  vec3 fragCoordToIndexSpace(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    vec4 vertex = (worldCoord / worldCoord.w);

    vec3 index = (vWCtoIDX * vertex).xyz;

    // half voxel fix for labelmapOutline
    return (index + vec3(0.5)) / vec3(volumeDimensions);
  }

  vec3 fragCoordToWorld(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    return worldCoord.xyz;
  }
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)
      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {
  #if vtkLightComplexity > 0
    // surface shadows if needed
    #ifdef SurfaceShadowOn
      #if vtkLightComplexity < 3
        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);
      #else
        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));
      #endif
    #endif

    // volume shadows if needed
    #ifdef VolumeShadowOn
      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);
    #endif

    // merge
    #ifdef VolumeShadowOn
      #ifdef SurfaceShadowOn
        // surface shadows + volumetric shadows
        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
      #else
        // volumetric shadows only
        tColor = tColorVS;
      #endif
    #else
      #ifdef SurfaceShadowOn
        // surface shadows only
        tColor = tColorS;
      #else
        // no shadows
        applyLighting(tColor, normal3);
      #endif
    #endif
  #endif
  return tColor;
}

  
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{

// If labeloutline and not the edge labelmap, since in the edge labelmap blend
// we need the underlying data to sample through
#if defined(vtkImageLabelOutlineOn) && !defined(vtkLabelEdgeProjectionOn)
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  int segmentIndex = int(centerValue.r * 255.0);
  
  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

  int actualThickness = int(textureValue * 255.0);


  // If it is the background (segment index 0), we should quickly bail out. 
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0){
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
        gl_FragCoord.y + float(j),
        gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = outlineOpacity;
  }

  return tColor;

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4

  #ifdef UseIndependentComponents

    // sample textures
    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;

    #if vtkNumComponents > 1
      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;

      #if vtkNumComponents > 2
        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;

        #if vtkNumComponents > 3
          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #endif
      #endif
    #endif

    #if !defined(vtkCustomComponentsColorMix)
      // default path for component color mix

      // compute the normal vectors as needed
      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #endif

      // compute gradient opacity factors as needed
      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);
      #if defined(vtkGradientOpacityOn)
        #if !defined(vtkComponent0Proportional)
          goFactor.x =
            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
        #endif
        #if vtkNumComponents > 1
          #if !defined(vtkComponent1Proportional)
            goFactor.y =
              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          #endif
          #if vtkNumComponents > 2
            #if !defined(vtkComponent2Proportional)
              goFactor.z =
                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);
            #endif
            #if vtkNumComponents > 3
              #if !defined(vtkComponent3Proportional)
                goFactor.w =
                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);
              #endif
            #endif
          #endif
        #endif
      #endif

      // process color and opacity for each component
      #if !defined(vtkComponent0Proportional)
        float alpha = goFactor.x*mix0*pwfValue0;
        #if vtkLightComplexity > 0
          applyLighting(tColor0, normalMat[0]);
        #endif
      #else
        tColor0 *= pwfValue0;
        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));
      #endif

      #if vtkNumComponents > 1
        #if !defined(vtkComponent1Proportional)
          alpha += goFactor.y*mix1*pwfValue1;
          #if vtkLightComplexity > 0
            applyLighting(tColor1, normalMat[1]);
          #endif
        #else
          tColor1 *= pwfValue1;
          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));
        #endif

        #if vtkNumComponents > 2
          #if !defined(vtkComponent2Proportional)
            alpha += goFactor.z*mix2*pwfValue2;
            #if vtkLightComplexity > 0
              applyLighting(tColor2, normalMat[2]);
            #endif
          #else
            tColor2 *= pwfValue2;
            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));
          #endif
        #endif

        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            alpha += goFactor.w*mix3*pwfValue3;
            #if vtkLightComplexity > 0
              applyLighting(tColor3, normalMat[3]);
            #endif
          #else
            tColor3 *= pwfValue3;
            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));
          #endif
        #endif
      #endif

      // perform final independent blend
      vec3 tColor = mix0 * tColor0;
      #if vtkNumComponents > 1
        tColor += mix1 * tColor1;
        #if vtkNumComponents > 2
          tColor += mix2 * tColor2;
          #if vtkNumComponents > 3
            tColor += mix3 * tColor3;
          #endif
        #endif
      #endif

      return vec4(tColor, alpha);
    #else
      /*
       * Mix the color information from all the independent components to get a single rgba output
       * Gradient opactity factors and normals are not computed
       *
       * You can compute these using:
       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix
       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),
       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper
       * - computeGradientOpacityFactor: always available, used in a lot of places
       *
       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)
       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight
       */
      //VTK::CustomComponentsColorMix::Impl
    #endif
  #else
    // dependent components

    // compute normal if needed
    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
      #endif
    #endif

    // compute gradient opacity factor enabled
    #if defined(vtkGradientOpacityOn)
      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #else
      const float gradientOpacity = 1.0;
    #endif

    // get color and opacity
    #if vtkNumComponents == 1
      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      if (alpha < EPSILON){
        return vec4(0.0);
      }
    #endif
    #if vtkNumComponents == 2
      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    #endif
    #if vtkNumComponents == 3
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
    #endif
    #if vtkNumComponents == 4
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
    #endif

    // lighting
    #if (vtkLightComplexity > 0)
      #ifdef vtkComputeNormalFromOpacity
        vec4 normalLight;
        if (!all(equal(normal0, vec4(0.0)))) {
          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;
          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;
          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);
          if (all(equal(normalLight, vec4(0.0)))) {
            normalLight = normal0;
          }
        }
      #else
        vec4 normalLight = normal0;
      #endif
      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);
    #endif

    return vec4(tColor, alpha);
  #endif // dependent
#endif
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #else
    #ifdef UseIndependentComponents
      #if vtkNumComponents == 2
        if (val.r >= min.r && val.r <= max.r &&
            val.g >= min.g && val.g <= max.g) {
          withinRange = true;
        }
      #else
        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
            all(lessThanEqual(val, ipScalarRangeMax))) {
          withinRange = true;
        }
      #endif
    #endif
  #endif
  return withinRange;
}

#if vtkBlendMode == 6 
bool checkOnEdgeForNeighbor(int i, int j, int s, vec3 stepIS) {
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j), gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    bool justSawIt = false;

    vec3 neighborPosIS = originalNeighborPosIS;

    float stepsTraveled = 0.0;


    // float neighborValue;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS += stepIS;
    }

    if (justSawIt){
      return false;
    }

   
    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS -= stepIS;
    }


    if (!justSawIt) {
        // onedge
        vec3 tColorSegment = texture2D(ctexture, vec2(float(s) * cscale1 + cshift1, height1)).rgb;
        float pwfValueSegment = texture2D(otexture, vec2(float(s) * oscale1 + oshift1, height1)).r;
        gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
        return true;
    }

    // not on edge
    return false;
}

#endif


//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // Initialize arrays to false
  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);
  
  #if vtkBlendMode == 6 
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    uint bitmask = 0u;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading 
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the segment index
      // and later check if the bit is set via bit operations
      setBit(segmentIndex);
    }
    
    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value =  tValue; // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue; // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }  

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      gl_FragData[0] = getColorForValue(value, maxPosIS, tstep);
      return;
    }

    // probably we can make this configurable but for now we will use the same
    // sample distance as the original sample distance
    float neighborSampleDistanceIS = sampleDistanceIS;

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    float minVoxelSpacing = min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base = vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z, gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not 
      // been seen by the center segment
      if (!isBitSet(s)) {
       continue;
      }

      // Use texture sampling for outlineThickness so that we can have 
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out 
      // faster if we find the edge
      bool onEdge =
          checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s, stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than 
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety 
      // of the all the fragments inside. i.e., this happens when we zoom out, 
      if (minVoxelSpacing > (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }
      
      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
            for (int j = -actualThickness; j <= actualThickness; j++) {
                if (i == 0 && j == 0) continue; // Skip the center
                if (abs(i) == actualThickness && abs(j) == actualThickness) continue; // Skip corners
                if (checkOnEdgeForNeighbor(i, j, s, stepIS )) {
                    return;
                }
          }
      }
    }

    vec3 tColor0 = texture2D(ctexture, vec2(value.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(value.r * oscale0 + oshift0, height0)).r;
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;const{vtkWarningMacro:CL,vtkErrorMacro:Rf}=bt;function TL(t){switch(t){case Pc.CUSTOM:return"//VTK::CustomColorMix";case Pc.ADDITIVE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);

          vec3 scalarInterp1[2];
          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);
          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;
          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;
          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
          vec4 normalLight1 = normalMat[1];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        float opacity1 = pwfValue1;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          opacity1 *= gof1;
        #endif
        float opacitySum = opacity0 + opacity1;
        if (opacitySum <= 0.0) {
          return vec4(0.0);
        }

        // mix the colors and opacities
        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);
        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);
        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;
        return vec4(mixedColor, min(1.0, opacitySum));
`;case Pc.COLORIZE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
        #endif

        // mix the colors and opacities
        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);
        color = applyAllLightning(color, opacity0, posIS, normalLight0);
        return vec4(color, opacity0);
`;default:return null}}function xL(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function n(a){[e._scalars,e._scalarOpacityFunc,e._colorTransferFunc,e._labelOutlineThicknessArray].forEach(i=>a.unregisterGraphicsResourceUser(i,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(a,i)=>{if(a){const s=i.getZBufferTexture();s!==e.zBufferTexture&&(e.zBufferTexture=s)}},t.opaqueZBufferPass=(a,i)=>t.zBufferPass(a,i),t.volumePass=(a,i)=>{if(a){const s=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),s&&!s.isDeleted()&&s!==e._openGLRenderWindow&&n(s),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const o=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const c=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(c.getActiveCamera()),t.renderPiece(c,o)}},t.getShaderTemplate=(a,i,s)=>{a.Vertex=vL,a.Fragment=yL,a.Geometry=""},t.useIndependentComponents=a=>{var l,f;const i=a.getIndependentComponents(),s=e.currentInput,o=(f=(l=s==null?void 0:s.getPointData())==null?void 0:l.getScalars())==null?void 0:f.getNumberOfComponents(),c=a.getColorMixPreset();return i&&o>=2||!!c},t.replaceShaderValues=(a,i,s)=>{const o=s.getProperty();let c=a.Fragment;o.getInterpolationType()===o2.LINEAR&&(c=G.substitute(c,"//VTK::TrilinearOn","#define vtkTrilinearOn").result),t.isLabelmapOutlineRequired(s)===!0&&(c=G.substitute(c,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result),e.renderable.getBlendMode()===Rc.LABELMAP_EDGE_PROJECTION_BLEND&&(c=G.substitute(c,"//VTK::LabelEdgeProjectionOn","#define vtkLabelEdgeProjectionOn").result);const g=e.scalarTexture.getComponents();c=G.substitute(c,"//VTK::NumComponents",`#define vtkNumComponents ${g}`).result;const p=t.useIndependentComponents(o);p&&(c=G.substitute(c,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const h=[],d=[];for(let w=0;w<g;w++)o.getOpacityMode(w)===Im.PROPORTIONAL&&h.push(`#define vtkComponent${w}Proportional`),o.getForceNearestInterpolation(w)&&d.push(`#define vtkComponent${w}ForceNearest`);c=G.substitute(c,"//VTK::vtkProportionalComponents",h.join(`
`)).result,c=G.substitute(c,"//VTK::vtkForceNearestComponents",d.join(`
`)).result;const m=o.getColorMixPreset(),v=TL(m);v&&(c=G.substitute(c,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,c=G.substitute(c,"//VTK::CustomComponentsColorMix::Impl",v).result);const C=e.currentInput.getSpatialExtent(),y=e.currentInput.getSpacing(),T=new Float64Array(3);Ee(T,(C[1]-C[0])*y[0],(C[3]-C[2])*y[1],(C[5]-C[4])*y[2]);const x=ua(T)/t.getCurrentSampleDistance(i);c=G.substitute(c,"//VTK::MaximumSamplesValue",`${Math.ceil(x)}`).result,c=G.substitute(c,"//VTK::LightComplexity",`#define vtkLightComplexity ${e.lightComplexity}`).result,e.lightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(c=G.substitute(c,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(c=G.substitute(c,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&o.getAmbient()>0&&(c=G.substitute(c,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const S=p?g:1;e.gopacity=!1;for(let w=0;!e.gopacity&&w<S;++w)e.gopacity||(e.gopacity=o.getUseGradientOpacity(w));e.gopacity&&(c=G.substitute(c,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(c=G.substitute(c,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(c=G.substitute(c,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,c=G.substitute(c,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),c=G.substitute(c,"//VTK::BlendMode",`${e.renderable.getBlendMode()}`).result,a.Fragment=c,t.replaceShaderLight(a,i,s),t.replaceShaderClippingPlane(a,i,s)},t.replaceShaderLight=(a,i,s)=>{if(e.lightComplexity===0)return;let o=a.Fragment,c=0;i.getLights().forEach(l=>{l.getSwitch()&&(c+=1)}),o=G.substitute(o,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${c}];`,`uniform vec3 lightDirectionVC[${c}]; // normalized`,`uniform vec3 lightHalfAngleVC[${c}];`,"//VTK::Light::Dec"],!1).result,e.lightComplexity===3&&(o=G.substitute(o,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${c}];`,`uniform vec3 lightAttenuation[${c}];`,`uniform float lightConeAngle[${c}];`,`uniform float lightExponent[${c}];`,`uniform int lightPositional[${c}];`],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(o=G.substitute(o,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&s.getProperty().getAmbient()>0&&(o=G.substitute(o,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${e.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),a.Fragment=o},t.replaceShaderClippingPlane=(a,i,s)=>{let o=a.Fragment;if(e.renderable.getClippingPlanes().length>0){const c=e.renderable.getClippingPlanes().length;o=G.substitute(o,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,o=G.substitute(o,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${c}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}a.Fragment=o};const r=(a,i)=>{let s=0;a.getProperty().getShade()&&e.renderable.getBlendMode()===Rc.COMPOSITE_BLEND&&(s=0,e.numberOfLights=0,i.forEach(o=>{o.getSwitch()>0&&(e.numberOfLights++,s===0&&(s=1)),s===1&&(e.numberOfLights>1||o.getIntensity()!==1||!o.lightTypeIsHeadLight())&&(s=2),s<3&&o.getPositional()&&(s=3)})),s!==e.lightComplexity&&(e.lightComplexity=s,t.modified())};t.getNeedToRebuildShaders=(a,i,s)=>{var v;const o=s.getProperty();r(s,i.getLights());const c=e.scalarTexture.getComponents(),l=[],f=[];for(let C=0;C<c;C++)l.push(o.getOpacityMode(C)),f.push(o.getForceNearestInterpolation(C));const u=e.currentInput.getSpatialExtent(),g=e.currentInput.getSpacing(),p=new Float64Array(3);Ee(p,(u[1]-u[0])*g[0],(u[3]-u[2])*g[1],(u[5]-u[4])*g[2]);const h=ua(p)/t.getCurrentSampleDistance(i),d=!!e.zBufferTexture,m={iComps:o.getIndependentComponents(),colorMixPreset:o.getColorMixPreset(),interpolationType:o.getInterpolationType(),useLabelOutline:t.isLabelmapOutlineRequired(s),numComp:c,maxSamples:h,useGradientOpacity:o.getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),hasZBufferTexture:d,opacityModes:l,forceNearestInterps:f};return((v=a.getProgram())==null?void 0:v.getHandle())===0||a.getShaderSourceTime().getMTime()<t.getMTime()||a.getShaderSourceTime().getMTime()<e.renderable.getMTime()||!e.previousState||!b8(e.previousState,m)?(e.previousState=m,!0):!1},t.updateShaders=(a,i,s)=>{if(t.getNeedToRebuildShaders(a,i,s)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,s);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);c!==a.getProgram()&&(a.setProgram(c),a.getVAO().releaseGraphicsResources()),a.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(a.getProgram());a.getVAO().bind(),t.setMapperShaderParameters(a,i,s),t.setCameraShaderParameters(a,i,s),t.setPropertyShaderParameters(a,i,s),t.getClippingPlaneShaderParameters(a,i,s)},t.setMapperShaderParameters=(a,i,s)=>{var f;const o=a.getProgram();a.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>a.getAttributeUpdateTime().getMTime()||a.getShaderSourceTime().getMTime()>a.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexDC")&&(a.getVAO().addAttributeArray(o,a.getCABO(),"vertexDC",a.getCABO().getVertexOffset(),a.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Rf("Error setting vertexDC in shader VAO.")),a.getAttributeUpdateTime().modified()),o.setUniformi("texture1",e.scalarTexture.getTextureUnit()),o.setUniformf("sampleDistance",t.getCurrentSampleDistance(i));const c=e.scalarTexture.getVolumeInfo(),l=e.renderable.getIpScalarRange();if((f=c==null?void 0:c.dataComputedScale)!=null&&f.length){const u=[],g=[];for(let p=0;p<4;p++)u[p]=l[0]*c.dataComputedScale[p]+c.dataComputedOffset[p],g[p]=l[1]*c.dataComputedScale[p]+c.dataComputedOffset[p],u[p]=(u[p]-c.offset[p])/c.scale[p],g[p]=(g[p]-c.offset[p])/c.scale[p];o.setUniform4f("ipScalarRangeMin",u[0],u[1],u[2],u[3]),o.setUniform4f("ipScalarRangeMax",g[0],g[1],g[2],g[3])}if(e.zBufferTexture!==null){o.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const u=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();o.setUniformf("vpZWidth",u[0]),o.setUniformf("vpZHeight",u[1])}},t.setCameraShaderParameters=(a,i,s)=>{const o=e.openGLCamera.getKeyMatrices(i),c=e.openGLVolume.getKeyMatrices();ge(e.modelToView,o.wcvc,c.mcwc);const l=a.getProgram(),f=e.openGLCamera.getRenderable(),u=f.getClippingRange();l.setUniformf("camThick",u[1]-u[0]),l.setUniformf("camNear",u[0]),l.setUniformf("camFar",u[1]);const g=e.currentInput.getBounds(),p=e.currentInput.getDimensions(),h=new Float64Array(3),d=new Float64Array(3);let m=1,v=-1,C=1,y=-1;for(let P=0;P<8;++P){if(Ee(h,g[P%2],g[2+Math.floor(P/2)%2],g[4+Math.floor(P/4)]),Re(h,h,e.modelToView),!f.getParallelProjection()){kt(d,h);const K=-u[0]/h[2];c0(h,d,K)}Re(h,h,o.vcpc),m=Math.min(h[0],m),v=Math.max(h[0],v),C=Math.min(h[1],C),y=Math.max(h[1],y)}l.setUniformf("dcxmin",m),l.setUniformf("dcxmax",v),l.setUniformf("dcymin",C),l.setUniformf("dcymax",y),l.isUniformUsed("cameraParallel")&&l.setUniformi("cameraParallel",f.getParallelProjection());const T=e.currentInput.getSpatialExtent(),x=e.currentInput.getSpacing(),S=new Float64Array(3);Ee(S,(T[1]-T[0])*x[0],(T[3]-T[2])*x[1],(T[5]-T[4])*x[2]),l.setUniform3f("vSpacing",x[0],x[1],x[2]),Ee(h,T[0],T[2],T[4]),e.currentInput.indexToWorldVec3(h,h),Re(h,h,e.modelToView),l.setUniform3f("vOriginVC",h[0],h[1],h[2]);const w=e.currentInput.getIndexToWorld();ge(e.idxToView,e.modelToView,w),fs(e.idxNormalMatrix,o.normalMatrix,c.normalMatrix),fs(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());const E=ua(S)/t.getCurrentSampleDistance(i);E>e.renderable.getMaximumSamplesPerRay()&&CL(`The number of steps required ${Math.ceil(E)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const L=new Float64Array(3);if(Ee(L,1,1,1),fS(L,L,S),l.setUniform3f("vVCToIJK",L[0],L[1],L[2]),l.setUniform3i("volumeDimensions",p[0],p[1],p[2]),l.setUniform3f("volumeSpacings",x[0],x[1],x[2]),!e._openGLRenderWindow.getWebgl2()){const P=e.scalarTexture.getVolumeInfo();l.setUniformf("texWidth",e.scalarTexture.getWidth()),l.setUniformf("texHeight",e.scalarTexture.getHeight()),l.setUniformi("xreps",P.xreps),l.setUniformi("xstride",P.xstride),l.setUniformi("ystride",P.ystride)}const R=new Float64Array(3),D=new Float64Array(3);for(let P=0;P<6;++P){switch(P){case 1:Ee(R,-1,0,0),Ee(D,T[0],T[2],T[4]);break;case 2:Ee(R,0,1,0),Ee(D,T[1],T[3],T[5]);break;case 3:Ee(R,0,-1,0),Ee(D,T[0],T[2],T[4]);break;case 4:Ee(R,0,0,1),Ee(D,T[1],T[3],T[5]);break;case 5:Ee(R,0,0,-1),Ee(D,T[0],T[2],T[4]);break;case 0:default:Ee(R,1,0,0),Ee(D,T[1],T[3],T[5]);break}Oc(R,R,e.idxNormalMatrix),Re(D,D,e.idxToView);const K=-1*Ve(D,R);l.setUniform3f(`vPlaneNormal${P}`,R[0],R[1],R[2]),l.setUniformf(`vPlaneDistance${P}`,K)}if(t.isLabelmapOutlineRequired(s)){const K=e.currentInput.getWorldToIndex();l.setUniformMatrix("vWCtoIDX",K);const U=i.getActiveCamera(),[N,k]=U.getClippingRange(),z=U.getDistance();U.setClippingRange(z,z+.1);const j=e.openGLCamera.getKeyMatrices(i);lt(e.projectionToWorld,j.wcpc),U.setClippingRange(N,k),e.openGLCamera.getKeyMatrices(i),l.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const $=t.getRenderTargetSize();l.setUniformf("vpWidth",$[0]),l.setUniformf("vpHeight",$[1]);const re=t.getRenderTargetOffset();l.setUniformf("vpOffsetX",re[0]/$[0]),l.setUniformf("vpOffsetY",re[1]/$[1])}if(lt(e.projectionToView,o.vcpc),l.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lightComplexity===0)return;let I=0;const b=[],F=[],W=[];if(i.getLights().forEach(P=>{if(P.getSwitch()>0){const U=P.getColor(),N=P.getIntensity();b[0+I*3]=U[0]*N,b[1+I*3]=U[1]*N,b[2+I*3]=U[2]*N;const k=P.getDirection();Ee(R,k[0],k[1],k[2]),Oc(R,R,o.normalMatrix),kt(R,R),F[0+I*3]=R[0],F[1+I*3]=R[1],F[2+I*3]=R[2],W[0+I*3]=-.5*R[0],W[1+I*3]=-.5*R[1],W[2+I*3]=-.5*(R[2]-1),I++}}),l.setUniformi("twoSidedLighting",i.getTwoSidedLighting()),l.setUniformi("lightNum",I),l.setUniform3fv("lightColor",b),l.setUniform3fv("lightDirectionVC",F),l.setUniform3fv("lightHalfAngleVC",W),e.lightComplexity===3){I=0;const P=[],K=[],U=[],N=[],k=[];i.getLights().forEach(z=>{if(z.getSwitch()>0){const $=z.getAttenuationValues();K[0+I*3]=$[0],K[1+I*3]=$[1],K[2+I*3]=$[2],N[I]=z.getExponent(),U[I]=z.getConeAngle(),k[I]=z.getPositional();const re=z.getTransformedPosition();Re(re,re,e.modelToView),P[0+I*3]=re[0],P[1+I*3]=re[1],P[2+I*3]=re[2],I+=1}}),l.setUniform3fv("lightPositionVC",P),l.setUniform3fv("lightAttenuation",K),l.setUniformfv("lightConeAngle",U),l.setUniformfv("lightExponent",N),l.setUniformiv("lightPositional",k)}if(e.renderable.getVolumetricScatteringBlending()>0&&(l.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),l.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),l.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),l.setUniformf("anisotropy",e.renderable.getAnisotropy()),l.setUniformf("anisotropy2",e.renderable.getAnisotropy()**2)),e.renderable.getLocalAmbientOcclusion()&&s.getProperty().getAmbient()>0){const P=e.renderable.getLAOKernelSize();l.setUniformi("kernelSize",P);const K=[];for(let U=0;U<P;U++)K[U*2]=Math.random()*.5,K[U*2+1]=Math.random()*.5;l.setUniform2fv("kernelSample",K),l.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}},t.setPropertyShaderParameters=(a,i,s)=>{const o=a.getProgram();o.setUniformi("ctexture",e.colorTexture.getTextureUnit()),o.setUniformi("otexture",e.opacityTexture.getTextureUnit()),o.setUniformi("jtexture",e.jitterTexture.getTextureUnit()),o.setUniformi("ttexture",e.labelOutlineThicknessTexture.getTextureUnit());const c=e.scalarTexture.getVolumeInfo(),l=s.getProperty(),f=e.scalarTexture.getComponents(),u=t.useIndependentComponents(l);if(u)for(let p=0;p<f;p++)o.setUniformf(`mix${p}`,s.getProperty().getComponentWeight(p));for(let p=0;p<f;p++){const h=u?p:0,d=c.scale[p],v=l.getScalarOpacity(h).getRange(),C=d/(v[1]-v[0]),y=(c.offset[p]-v[0])/(v[1]-v[0]);o.setUniformf(`oshift${p}`,y),o.setUniformf(`oscale${p}`,C);const x=l.getRGBTransferFunction(h).getRange(),S=(c.offset[p]-x[0])/(x[1]-x[0]),w=d/(x[1]-x[0]);o.setUniformf(`cshift${p}`,S),o.setUniformf(`cscale${p}`,w)}if(e.gopacity)if(u)for(let p=0;p<f;++p){const h=c.scale[p];if(l.getUseGradientOpacity(p)){const m=l.getGradientOpacityMinimumOpacity(p),v=l.getGradientOpacityMaximumOpacity(p);o.setUniformf(`gomin${p}`,m),o.setUniformf(`gomax${p}`,v);const C=[l.getGradientOpacityMinimumValue(p),l.getGradientOpacityMaximumValue(p)];o.setUniformf(`goscale${p}`,h*(v-m)/(C[1]-C[0])),o.setUniformf(`goshift${p}`,-C[0]*(v-m)/(C[1]-C[0])+m)}else o.setUniformf(`gomin${p}`,1),o.setUniformf(`gomax${p}`,1),o.setUniformf(`goscale${p}`,0),o.setUniformf(`goshift${p}`,1)}else{const p=c.scale[f-1],h=l.getGradientOpacityMinimumOpacity(0),d=l.getGradientOpacityMaximumOpacity(0);o.setUniformf("gomin0",h),o.setUniformf("gomax0",d);const m=[l.getGradientOpacityMinimumValue(0),l.getGradientOpacityMaximumValue(0)];o.setUniformf("goscale0",p*(d-h)/(m[1]-m[0])),o.setUniformf("goshift0",-m[0]*(d-h)/(m[1]-m[0])+h)}if(t.isLabelmapOutlineRequired(s)===!0){const p=s.getProperty().getLabelOutlineOpacity();o.setUniformf("outlineOpacity",p)}e.lightComplexity>0&&(o.setUniformf("vAmbient",l.getAmbient()),o.setUniformf("vDiffuse",l.getDiffuse()),o.setUniformf("vSpecular",l.getSpecular()),o.setUniformf("vSpecularPower",l.getSpecularPower()))},t.getClippingPlaneShaderParameters=(a,i,s)=>{if(e.renderable.getClippingPlanes().length>0){const o=e.openGLCamera.getKeyMatrices(i),c=[],l=[],f=[],u=e.renderable.getClippingPlanes(),g=u.length;for(let h=0;h<g;++h){const d=u[h].getNormal(),m=u[h].getOrigin();Oc(d,d,o.normalMatrix),Re(m,m,o.wcvc);const v=-1*Ve(m,d);c.push(d[0]),c.push(d[1]),c.push(d[2]),l.push(v),f.push(m[0]),f.push(m[1]),f.push(m[2])}const p=a.getProgram();p.setUniform3fv("vClipPlaneNormals",c),p.setUniformfv("vClipPlaneDistances",l),p.setUniform3fv("vClipPlaneOrigins",f),p.setUniformi("clip_numPlanes",g)}},t.delete=g0(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:a,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[a,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:a,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[a,i]},t.getCurrentSampleDistance=a=>{const i=a.getVTKWindow().getInteractor(),s=e.renderable.getSampleDistance();if(i.isAnimating()){const o=e.renderable.getInteractionSampleDistanceFactor();return s*o}return s},t.renderPieceStart=(a,i)=>{const s=a.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,s.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=s.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const c=s.getRecentAnimationFrameRate(),l=s.getDesiredUpdateRate()/c;(l>1.15||l<.85)&&(e._lastScale*=l),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const c=e._openGLRenderWindow.getFramebufferSize(),l=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(l*c[0]),e._smallViewportHeight=Math.ceil(l*c[1]),e._smallViewportHeight>c[1]&&(e._smallViewportHeight=c[1]),e._smallViewportWidth>c[0]&&(e._smallViewportWidth=c[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer();else{const u=e.framebuffer.getSize();(!u||u[0]!==c[0]||u[1]!==c[1])&&(e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const f=e.context;f.clearColor(0,0,0,0),f.colorMask(!0,!0,!0,!0),f.clear(f.COLOR_BUFFER_BIT),f.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/c[0],e._smallViewportHeight/c[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(a,i),i.getProperty().getInterpolationType()===o2.NEAREST?(e.scalarTexture.setMinificationFilter(ee.NEAREST),e.scalarTexture.setMagnificationFilter(ee.NEAREST)):(e.scalarTexture.setMinificationFilter(ee.LINEAR),e.scalarTexture.setMagnificationFilter(ee.LINEAR)),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(a,i)=>{const s=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,a,i),s.drawArrays(s.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=(a,i)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const l=e.copyShader;e.copyVAO=Jg.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(l,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Rf("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const s=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,s[0],s[1]);const o=e.framebuffer.getColorTexture();o.activate(),e.copyShader.setUniformi("texture",o.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const c=e.context;c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.deactivate(),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(a,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){Rf("No input!");return}t.renderPieceStart(a,i),t.renderPieceDraw(a,i),t.renderPieceFinish(a,i)},t.computeBounds=(a,i)=>{if(!t.getInput()){Es(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(a,i)=>{t.getNeedToRebuildBufferObjects(a,i)&&t.buildBufferObjects(a,i)},t.getNeedToRebuildBufferObjects=(a,i)=>{var s,o,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((s=e.scalarTexture)!=null&&s.getHandle())||!((o=e.colorTexture)!=null&&o.getHandle())||!((c=e.labelOutlineThicknessTexture)!=null&&c.getHandle())},t.buildBufferObjects=(a,i)=>{var x,S;const s=e.currentInput;if(!s)return;const o=s.getPointData()&&s.getPointData().getScalars();if(!o)return;const c=i.getProperty();if(!e.jitterTexture.getHandle()){const w=new Uint8Array(1024);for(let E=0;E<32*32;++E)w[E]=255*Math.random();e.jitterTexture.setMinificationFilter(ee.LINEAR),e.jitterTexture.setMagnificationFilter(ee.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,ce.UNSIGNED_CHAR,w)}const l=o.getNumberOfComponents(),f=t.useIndependentComponents(c),u=f?l:1,g=c.getScalarOpacity(),p=e._openGLRenderWindow.getGraphicsResourceForObject(g);let h=lr(g,f,u);if(!(p!=null&&p.oglObject)||p.hash!==h){e.opacityTexture=ke.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const w=1024,E=w*2*u,L=new Float32Array(E),R=new Float32Array(w);for(let D=0;D<u;++D){const I=c.getScalarOpacity(D),b=t.getCurrentSampleDistance(a)/c.getScalarOpacityUnitDistance(D),F=I.getRange();I.getTable(F[0],F[1],w,R,1);for(let W=0;W<w;++W)L[D*w*2+W]=1-(1-R[W])**b,L[D*w*2+W+w]=L[D*w*2+W]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(ee.LINEAR),e.opacityTexture.setMagnificationFilter(ee.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(w,2*u,1,ce.FLOAT,L);else{const D=new Uint8ClampedArray(E);for(let I=0;I<E;++I)D[I]=255*L[I];e.opacityTexture.create2DFromRaw(w,2*u,1,ce.UNSIGNED_CHAR,D)}g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.opacityTexture,h),g!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=g)}else e.opacityTexture=p.oglObject;const m=c.getRGBTransferFunction();h=lr(m,f,u);const v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((x=v==null?void 0:v.oglObject)!=null&&x.getHandle())||(v==null?void 0:v.hash)!==h){e.colorTexture=ke.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const w=1024,E=w*2*u*3,L=new Uint8ClampedArray(E),R=new Float32Array(w*3);for(let D=0;D<u;++D){const I=c.getRGBTransferFunction(D),b=I.getRange();I.getTable(b[0],b[1],w,R,1);for(let F=0;F<w*3;++F)L[D*w*6+F]=255*R[F],L[D*w*6+F+w*3]=255*R[F]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(ee.LINEAR),e.colorTexture.setMagnificationFilter(ee.LINEAR),e.colorTexture.create2DFromRaw(w,2*u,3,ce.UNSIGNED_CHAR,L),m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,h),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=v.oglObject;t.updateLabelOutlineThicknessTexture(i);const y=e._openGLRenderWindow.getGraphicsResourceForObject(o);if(h=v5(s,o),!((S=y==null?void 0:y.oglObject)!=null&&S.getHandle())||(y==null?void 0:y.hash)!==h){e.scalarTexture=ke.newInstance(),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const w=s.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(w[0],w[1],w[2],o,e.renderable.getPreferSizeOverAccuracy()),o&&(e._openGLRenderWindow.setGraphicsResourceForObject(o,e.scalarTexture,h),o!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(o,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=o)}else e.scalarTexture=y.oglObject;if(!e.tris.getCABO().getElementCount()){const w=new Float32Array(12);for(let D=0;D<4;D++)w[D*3]=D%2*2-1,w[D*3+1]=D>1?1:-1,w[D*3+2]=-1;const E=new Uint16Array(8);E[0]=3,E[1]=0,E[2]=1,E[3]=3,E[4]=3,E[5]=0,E[6]=3,E[7]=2;const L=le.newInstance({numberOfComponents:3,values:w});L.setName("points");const R=le.newInstance({numberOfComponents:1,values:E});e.tris.getCABO().createVBO(R,"polys",On.SURFACE,{points:L,cellOffset:0})}e.VBOBuildTime.modified()},t.updateLabelOutlineThicknessTexture=a=>{var l;const i=a.getProperty().getLabelOutlineThickness(),s=e._openGLRenderWindow.getGraphicsResourceForObject(i),o=`${i.join("-")}`;if(!((l=s==null?void 0:s.oglObject)!=null&&l.getHandle())||(s==null?void 0:s.hash)!==o){e.labelOutlineThicknessTexture=ke.newInstance(),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const f=1024,u=1,g=f*u,p=new Uint8Array(g);for(let h=0;h<f;++h){const d=typeof i[h]<"u"?i[h]:i[0];p[h]=d}e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(ee.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(ee.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(f,u,1,ce.UNSIGNED_CHAR,p),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,o),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=s.oglObject},t.isLabelmapOutlineRequired=a=>{const i=a.getProperty(),s=e.renderable;return i.getUseLabelOutline()||s.getBlendMode()===Rc.LABELMAP_EDGE_PROJECTION_BLEND}}const SL={context:null,VBOBuildTime:null,scalarTexture:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function km(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SL,n),st.extend(t,e,n),ha.implementBuildShadersWithReplacements(t,e,n),e.VBOBuildTime={},Ue(e.VBOBuildTime,{mtime:0}),e.tris=Ta.newInstance(),e.jitterTexture=ke.newInstance(),e.jitterTexture.setWrapS(Ko.REPEAT),e.jitterTexture.setWrapT(Ko.REPEAT),e.framebuffer=Cu.newInstance(),e.idxToView=te(new Float64Array(16)),e.idxNormalMatrix=jn(new Float64Array(9)),e.modelToView=te(new Float64Array(16)),e.projectionToView=te(new Float64Array(16)),e.projectionToWorld=te(new Float64Array(16)),ft(t,e,["context"]),xL(t,e)}const Um=Le(km,"vtkOpenGLVolumeMapper");var Pm={newInstance:Um,extend:km};Tt("vtkVolumeMapper",Um);function wL(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),t.buildBufferObjects=(n,r)=>{var d;const a=e.currentInput;if(!a)return;const i=r.getProperty();if(!e.jitterTexture.getHandle()){const m=new Uint8Array(1024);for(let v=0;v<32*32;++v)m[v]=255*Math.random();e.jitterTexture.setMinificationFilter(ee.LINEAR),e.jitterTexture.setMagnificationFilter(ee.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,ce.UNSIGNED_CHAR,m)}const{numberOfComponents:s}=a.get("numberOfComponents"),o=t.useIndependentComponents(i),c=i.getScalarOpacity(),l=e._openGLRenderWindow.getGraphicsResourceForObject(c);let f=lr(c,o,s);if(!(l!=null&&l.oglObject)||l.hash!==f){e.opacityTexture=ke.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const m=1024,v=m*2*s,C=new Float32Array(v),y=new Float32Array(m);for(let T=0;T<s;++T){const x=i.getScalarOpacity(T),S=t.getCurrentSampleDistance(n)/i.getScalarOpacityUnitDistance(T),w=x.getRange();x.getTable(w[0],w[1],m,y,1);for(let E=0;E<m;++E)C[T*m*2+E]=1-(1-y[E])**S,C[T*m*2+E+m]=C[T*m*2+E]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(ee.LINEAR),e.opacityTexture.setMagnificationFilter(ee.LINEAR),e._openGLRenderWindow.getWebgl2()&&e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(m,2*s,1,ce.FLOAT,C);else{const T=new Uint8ClampedArray(v);for(let x=0;x<v;++x)T[x]=255*C[x];e.opacityTexture.create2DFromRaw(m,2*s,1,ce.UNSIGNED_CHAR,T)}c&&(e._openGLRenderWindow.setGraphicsResourceForObject(c,e.opacityTexture,f),c!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=c)}else e.opacityTexture=l.oglObject;const g=i.getRGBTransferFunction();f=lr(g,o,s);const p=e._openGLRenderWindow.getGraphicsResourceForObject(g);if(!((d=p==null?void 0:p.oglObject)!=null&&d.getHandle())||(p==null?void 0:p.hash)!==f){e.colorTexture=ke.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const m=1024,v=m*2*s*3,C=new Uint8ClampedArray(v),y=new Float32Array(m*3);for(let T=0;T<s;++T){const x=i.getRGBTransferFunction(T),S=x.getRange();x.getTable(S[0],S[1],m,y,1);for(let w=0;w<m*3;++w)C[T*m*6+w]=255*y[w],C[T*m*6+w+m*3]=255*y[w]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(ee.LINEAR),e.colorTexture.setMagnificationFilter(ee.LINEAR),e.colorTexture.create2DFromRaw(m,2*s,3,ce.UNSIGNED_CHAR,C),g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.colorTexture,f),g!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=g)}else e.colorTexture=p.oglObject;if(t.updateLabelOutlineThicknessTexture(r),f=`${a.getMTime()}-${e.scalarTexture.getMTime()}`,e.scalarTextureString!==f){const m=a.getDimensions();e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.enableUseHalfFloat(!1);const v=e.scalarTexture.getTextureParameters(),C=a.get("dataType").dataType;let y=!0;if((v==null?void 0:v.dataType)===C&&(v==null?void 0:v.width)===m[0]&&(v==null?void 0:v.height)===m[1]&&(v==null?void 0:v.depth)===m[2]&&(y=!1),y){const T=e.context.getExtension("EXT_texture_norm16");e.scalarTexture.setOglNorm16Ext(T),e.scalarTexture.resetFormatAndType(),e.scalarTexture.setTextureParameters({width:m[0],height:m[1],depth:m[2],numberOfComponents:s,dataType:C}),e.scalarTexture.create3DFromRaw(m[0],m[1],m[2],s,C,null),e.scalarTexture.update3DFromRaw()}else e.scalarTexture.deactivate(),e.scalarTexture.update3DFromRaw();e.scalarTextureString=f}if(!e.tris.getCABO().getElementCount()){const m=new Float32Array(12);for(let T=0;T<4;T++)m[T*3]=T%2*2-1,m[T*3+1]=T>1?1:-1,m[T*3+2]=-1;const v=new Uint16Array(8);v[0]=3,v[1]=0,v[2]=1,v[3]=3,v[4]=3,v[5]=0,v[6]=3,v[7]=2;const C=le.newInstance({numberOfComponents:3,values:m});C.setName("points");const y=le.newInstance({numberOfComponents:1,values:v});e.tris.getCABO().createVBO(y,"polys",On.SURFACE,{points:C,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(n,r)=>{var a,i,s,o,c,l;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<r.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<r.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<((a=e.scalarTexture)==null?void 0:a.getMTime())||e.VBOBuildTime.getMTime()<((i=e.colorTexture)==null?void 0:i.getMTime())||e.VBOBuildTime.getMTime()<((s=e.labelOutlineThicknessTexture)==null?void 0:s.getMTime())||!((o=e.scalarTexture)!=null&&o.getHandle())||!((c=e.colorTexture)!=null&&c.getHandle())||!((l=e.labelOutlineThicknessTexture)!=null&&l.getHandle())}}const EL={};function bm(t,e,n={}){Object.assign(e,EL,n),Pm.extend(t,e,n),e.scalarTexture=n.scalarTexture,e.previousState={},wL(t,e)}const RL=O.newInstance(bm,"vtkStreamingOpenGLVolumeMapper"),OL={newInstance:RL,extend:bm},Gm=Object.create(null);function St(t,e){Gm[t]=e}function ML(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,a=n.getClassName(r++),i=!1;const s=Object.keys(e.overrides);for(;a&&!i;)s.includes(a)?i=!0:a=n.getClassName(r++);if(!i)return null;const o=e.getModelInitialValues(n),c=e.overrides[a](o);return c.setMyFactory(t),c},e.overrides=Gm,e.getModelInitialValues=n=>{const r={};return n.getClassName()==="vtkSharedVolumeMapper"&&(r.scalarTexture=n.getScalarTexture()),r}}const DL={};function Bm(t,e,n={}){Object.assign(e,DL,n),Zg.extend(t,e,n),ML(t,e),St("vtkActor",QM.newInstance),St("vtkActor2D",nD.newInstance),St("vtkCamera",sD.newInstance),St("vtkGlyph3DMapper",LV.newInstance),St("vtkImageMapper",PV.newInstance),St("vtkImageSlice",AV.newInstance),St("vtkMapper",Ru.newInstance),St("vtkPixelSpaceCallbackMapper",HV.newInstance),St("vtkRenderer",ZV.newInstance),St("vtkSkybox",tL.newInstance),St("vtkSphereMapper",oL.newInstance),St("vtkStickMapper",gL.newInstance),St("vtkTexture",ke.newInstance),St("vtkVolume",mL.newInstance),St("vtkVolumeMapper",Pm.newInstance),St("vtkSharedVolumeMapper",OL.newInstance)}const VL=O.newInstance(Bm,"vtkStreamingOpenGLViewNodeFactory"),LL={newInstance:VL,extend:Bm};function _L(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function Am(t,e,n={}){Object.assign(e,n),qM.extend(t,e,n),e.myFactory=LL.newInstance(),St("vtkRenderWindow",Wm),_L(t,e)}const Wm=O.newInstance(Am,"vtkStreamingOpenGLRenderWindow"),NL={newInstance:Wm,extend:Am},{vtkDebugMacro:J0}=O;function IL(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),i=te(new Float64Array(16)),s=te(new Float64Array(16)),o=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),f=te(new Float64Array(16)),u=te(new Float64Array(16)),g=new Float64Array(3),p=new Float64Array(3);function h(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const d=t.getViewMatrix();e.viewUp[0]=d[4],e.viewUp[1]=d[5],e.viewUp[2]=d[6],t.modified()},t.setPosition=(d,m,v)=>{d===e.position[0]&&m===e.position[1]&&v===e.position[2]||(e.position[0]=d,e.position[1]=m,e.position[2]=v,t.computeDistance(),t.modified())},t.setFocalPoint=(d,m,v)=>{d===e.focalPoint[0]&&m===e.focalPoint[1]&&v===e.focalPoint[2]||(e.focalPoint[0]=d,e.focalPoint[1]=m,e.focalPoint[2]=v,t.computeDistance(),t.modified())},t.setDistance=d=>{if(e.distance===d)return;e.distance=d,e.distance<1e-20&&(e.distance=1e-20,J0("Distance is set to minimum."));const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,t.modified()},t.computeDistance=()=>{const d=e.focalPoint[0]-e.position[0],m=e.focalPoint[1]-e.position[1],v=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(d*d+m*m+v*v),e.distance<1e-20){e.distance=1e-20,J0("Distance is set to minimum.");const C=e.directionOfProjection;e.focalPoint[0]=e.position[0]+C[0]*e.distance,e.focalPoint[1]=e.position[1]+C[1]*e.distance,e.focalPoint[2]=e.position[2]+C[2]*e.distance}e.directionOfProjection[0]=d/e.distance,e.directionOfProjection[1]=m/e.distance,e.directionOfProjection[2]=v/e.distance,h()},t.dolly=d=>{if(d<=0)return;const m=e.distance/d;t.setPosition(e.focalPoint[0]-m*e.directionOfProjection[0],e.focalPoint[1]-m*e.directionOfProjection[1],e.focalPoint[2]-m*e.directionOfProjection[2])},t.roll=d=>{const m=e.position,v=e.focalPoint,C=e.viewUp,y=new Float64Array([C[0],C[1],C[2],0]);te(f);const T=new Float64Array([v[0]-m[0],v[1]-m[1],v[2]-m[2]]);_n(f,f,We(d),T),za(y,y,f),e.viewUp[0]=y[0],e.viewUp[1]=y[1],e.viewUp[2]=y[2],t.modified()},t.azimuth=d=>{const m=e.focalPoint;te(u),at(u,u,m),_n(u,u,We(d),e.viewUp),at(u,u,[-m[0],-m[1],-m[2]]),Re(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.yaw=d=>{const m=e.position;te(u),at(u,u,m),_n(u,u,We(d),e.viewUp),at(u,u,[-m[0],-m[1],-m[2]]),Re(p,e.focalPoint,u),t.setFocalPoint(p[0],p[1],p[2])},t.elevation=d=>{const m=e.focalPoint,v=t.getViewMatrix(),C=[-v[0],-v[1],-v[2]];te(u),at(u,u,m),_n(u,u,We(d),C),at(u,u,[-m[0],-m[1],-m[2]]),Re(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.pitch=d=>{const m=e.position,v=t.getViewMatrix(),C=[v[0],v[1],v[2]];te(u),at(u,u,m),_n(u,u,We(d),C),at(u,u,[-m[0],-m[1],-m[2]]),Re(p,e.focalPoint,u),t.setFocalPoint(...p)},t.zoom=d=>{d<=0||(e.parallelProjection?e.parallelScale/=d:e.viewAngle/=d,t.modified())},t.translate=(d,m,v)=>{const C=[d,m,v];Ml(e.position,C,e.position),Ml(e.focalPoint,C,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=d=>{const m=[...e.viewUp,1],v=[],C=[],y=[];m[0]+=e.position[0],m[1]+=e.position[1],m[2]+=e.position[2],za(v,[...e.position,1],d),za(C,[...e.focalPoint,1],d),za(y,m,d),y[0]-=v[0],y[1]-=v[1],y[2]-=v[2],t.setPosition(...v.slice(0,3)),t.setFocalPoint(...C.slice(0,3)),t.setViewUp(...y.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=d=>{let m=d;m<1e-20&&(m=1e-20,J0("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+m)},t.setThicknessFromFocalPoint=d=>{let m=d;m<1e-20&&(m=1e-20,J0("Thickness is set to minimum.")),t.setClippingRange(e.distance-m/2,e.distance+m/2)},t.setRoll=d=>{},t.getRoll=()=>{},t.setObliqueAngles=(d,m)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=d=>{},t.getCameraLightTransformMatrix=d=>(Ze(d,e.cameraLightTransform),d),t.computeCameraLightTransform=()=>{Ze(i,t.getViewMatrix()),lt(i,i),Rg(s,[e.distance,e.distance,e.distance]),ge(i,i,s),te(e.cameraLightTransform),at(e.cameraLightTransform,i,[0,0,-1])},t.deepCopy=d=>{},t.physicalOrientationToWorldDirection=d=>{const m=gd(d[0],d[1],d[2],d[3]),v=oi(),C=gd(0,0,1,0);return yS(v,m),fd(C,m,C),fd(C,C,v),[C[0],C[1],C[2]]},t.getPhysicalToWorldMatrix=d=>{t.getWorldToPhysicalMatrix(d),lt(d,d)},t.getWorldToPhysicalMatrix=d=>{te(d);const m=[3];cr(e.physicalViewNorth,e.physicalViewUp,m),d[0]=m[0],d[1]=m[1],d[2]=m[2],d[4]=e.physicalViewUp[0],d[5]=e.physicalViewUp[1],d[6]=e.physicalViewUp[2],d[8]=-e.physicalViewNorth[0],d[9]=-e.physicalViewNorth[1],d[10]=-e.physicalViewNorth[2],me(d,d),Ee(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Nr(d,d,o),at(d,d,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=d=>{lt(i,d),Re(o,n,i),t.computeDistance();const m=e.distance;t.setPosition(o[0],o[1],o[2]),Re(c,r,i),Nt(c,c,o),kt(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),Re(l,a,i),Nt(l,l,o),kt(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(m)},t.computeViewParametersFromPhysicalMatrix=d=>{t.getWorldToPhysicalMatrix(i),ge(i,d,i),t.computeViewParametersFromViewMatrix(i)},t.setViewMatrix=d=>{e.viewMatrix=d,e.viewMatrix&&(Ze(i,e.viewMatrix),t.computeViewParametersFromViewMatrix(i),me(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;w8(i,e.position,e.focalPoint,e.viewUp),me(i,i);const d=new Float64Array(16);return Ze(d,i),d},t.setProjectionMatrix=d=>{e.projectionMatrix=d},t.getProjectionMatrix=(d,m,v)=>{const C=new Float64Array(16);if(te(C),e.projectionMatrix){const x=1/e.physicalScale;return Ee(o,x,x,x),Ze(C,e.projectionMatrix),Nr(C,C,o),me(C,C),C}te(i);const y=e.clippingRange[1]-e.clippingRange[0],T=[e.clippingRange[0]+(m+1)*y/2,e.clippingRange[0]+(v+1)*y/2];if(e.parallelProjection){const x=e.parallelScale*d,S=e.parallelScale,w=(e.windowCenter[0]-1)*x,E=(e.windowCenter[0]+1)*x,L=(e.windowCenter[1]-1)*S,R=(e.windowCenter[1]+1)*S;Mg(i,w,E,L,R,T[0],T[1]),me(i,i)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const x=Math.tan(We(e.viewAngle)/2);let S,w;e.useHorizontalViewAngle===!0?(S=e.clippingRange[0]*x,w=e.clippingRange[0]*x/d):(S=e.clippingRange[0]*x*d,w=e.clippingRange[0]*x);const E=(e.windowCenter[0]-1)*S,L=(e.windowCenter[0]+1)*S,R=(e.windowCenter[1]-1)*w,D=(e.windowCenter[1]+1)*w,I=T[0],b=T[1];i[0]=2*I/(L-E),i[5]=2*I/(D-R),i[2]=(E+L)/(L-E),i[6]=(R+D)/(D-R),i[10]=-(I+b)/(b-I),i[14]=-1,i[11]=-2*I*b/(b-I),i[15]=0}}return Ze(C,i),C},t.getCompositeProjectionMatrix=(d,m,v)=>{const C=t.getViewMatrix(),y=t.getProjectionMatrix(d,m,v);return ge(y,C,y),y},t.setDirectionOfProjection=(d,m,v)=>{if(e.directionOfProjection[0]===d&&e.directionOfProjection[1]===m&&e.directionOfProjection[2]===v)return;e.directionOfProjection[0]=d,e.directionOfProjection[1]=m,e.directionOfProjection[2]=v;const C=e.directionOfProjection;e.focalPoint[0]=e.position[0]+C[0]*e.distance,e.focalPoint[1]=e.position[1]+C[1]*e.distance,e.focalPoint[2]=e.position[2]+C[2]*e.distance,h()},t.setDeviceAngles=(d,m,v,C)=>{const y=[3];cr(e.physicalViewNorth,e.physicalViewUp,y);const T=te(new Float64Array(16));_n(T,T,We(d),e.physicalViewUp),_n(T,T,We(m),y),_n(T,T,We(v),e.physicalViewNorth),_n(T,T,We(-C),e.physicalViewUp);const x=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),S=new Float64Array(e.physicalViewNorth);Re(x,x,T),Re(S,S,T),t.setDirectionOfProjection(x[0],x[1],x[2]),t.setViewUp(S[0],S[1],S[2]),t.modified()},t.setOrientationWXYZ=(d,m,v,C)=>{const y=te(new Float64Array(16));if(d!==0&&(m!==0||v!==0||C!==0)){const S=We(d),w=oi();Dg(w,[m,v,C],S),ml(y,w)}const T=new Float64Array(3);Re(T,[0,0,-1],y);const x=new Float64Array(3);Re(x,[0,1,0],y),t.setDirectionOfProjection(...T),t.setViewUp(...x),t.modified()},t.computeClippingRange=d=>{let m=null,v=null;m=e.viewPlaneNormal,v=e.position;const C=-m[0],y=-m[1],T=-m[2],x=-(C*v[0]+y*v[1]+T*v[2]),S=[C*d[0]+y*d[2]+T*d[4]+x,1e-18];for(let w=0;w<2;w++)for(let E=0;E<2;E++)for(let L=0;L<2;L++){const R=C*d[L]+y*d[2+E]+T*d[4+w]+x;S[0]=R<S[0]?R:S[0],S[1]=R>S[1]?R:S[1]}return S}}const FL={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:Ca(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function zm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FL,n),O.obj(t,e),O.get(t,e,["distance"]),O.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),O.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),O.setGetArray(t,e,["clippingRange","windowCenter"],2),O.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),IL(t,e)}const kL=O.newInstance(zm,"vtkCamera");var y5={newInstance:kL,extend:zm};function UL(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?Re(n,e.position,e.transformMatrix):Ee(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?Re(n,e.focalPoint,e.transformMatrix):Ee(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(jt(e.direction,e.focalPoint,e.position),ui(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const a=new Float64Array(3);jt(a,e.position,r),e.focalPoint=a},t.setDirectionAngle=(r,a)=>{const i=We(r),s=We(a);t.setPosition(Math.cos(i)*Math.sin(s),Math.sin(i),Math.cos(i)*Math.cos(s)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const PL={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function bL(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PL,n),O.obj(t,e),O.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),O.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),UL(t,e)}const GL=O.newInstance(bL,"vtkLight");var BL={newInstance:GL};const{vtkErrorMacro:bc}=O;function AL(t){return()=>bc(`vtkViewport::${t} - NOT IMPLEMENTED`)}function WL(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const a=e.props.filter(i=>i!==r);e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(r);const i=r.getNestedProps();if(i&&i.length)for(let s=0;s<i.length;s++)n(i[s],a);return a}t.getViewPropsWithNestedProps=()=>{const r=[];for(let a=0;a<e.props.length;a++)n(e.props[a],r);return r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>bc("call displayToView on your view instead"),t.viewToDisplay=()=>bc("callviewtodisplay on your view instead"),t.getSize=()=>bc("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,a,i)=>{const s=t.normalizedDisplayToNormalizedViewport(r,a,i);return t.normalizedViewportToProjection(s[0],s[1],s[2])},t.normalizedDisplayToNormalizedViewport=(r,a,i)=>{const s=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/s[0],(a-e.viewport[1])/s[1],i]},t.normalizedViewportToProjection=(r,a,i)=>[r*2-1,a*2-1,i*2-1],t.projectionToNormalizedDisplay=(r,a,i)=>{const s=t.projectionToNormalizedViewport(r,a,i);return t.normalizedViewportToNormalizedDisplay(s[0],s[1],s[2])},t.normalizedViewportToNormalizedDisplay=(r,a,i)=>{const s=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*s[0]+e.viewport[0],a*s[1]+e.viewport[1],i]},t.projectionToNormalizedViewport=(r,a,i)=>[(r+1)*.5,(a+1)*.5,(i+1)*.5],t.PickPropFrom=AL("PickPropFrom")}const zL={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function $m(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zL,n),O.obj(t,e),O.event(t,e,"event"),O.setGetArray(t,e,["viewport"],4),O.setGetArray(t,e,["background","background2"],3),WL(t,e)}const $L=O.newInstance($m,"vtkViewport");var jL={newInstance:$L,extend:$m};const{vtkDebugMacro:Ws,vtkErrorMacro:zr,vtkWarningMacro:HL}=bt;function oh(t){return()=>zr(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function KL(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Ws("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const i=t.getActiveCameraAndResetIfCreated();e.lights.forEach(s=>{s.lightTypeIsSceneLight()||(s.lightTypeIsHeadLight()?(s.setPositionFrom(i.getPositionByReference()),s.setFocalPointFrom(i.getFocalPointByReference()),s.modified(i.getMTime())):s.lightTypeIsCameraLight()?s.setTransformMatrix(i.getCameraLightTransformMatrix(Ca())):zr("light has unknown light type",s.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=oh("allocateTime"),t.updateGeometry=oh("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=i=>{Ws(t.getClassName(),t,"setting Layer to ",i),e.layer!==i&&(e.layer=i,t.modified()),t.setPreserveColorBuffer(!!i)},t.setActiveCamera=i=>e.activeCamera===i?!1:(e.activeCamera=i,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:i}),!0),t.makeCamera=()=>{const i=y5.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:i}),i},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(i=>{e.actors=e.actors.concat(i.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=i=>{e.actors=e.actors.filter(s=>s!==i),t.removeViewProp(i),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(s=>{t.removeViewProp(s)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(i=>{e.volumes=e.volumes.concat(i.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=i=>{e.volumes=e.volumes.filter(s=>s!==i),t.removeViewProp(i),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(s=>{t.removeViewProp(s)}),e.volumes=[],t.modified()},t.hasLight=i=>e.lights.includes(i),t.addLight=i=>{i&&!t.hasLight(i)&&(e.lights.push(i),t.modified())},t.removeLight=i=>{e.lights=e.lights.filter(s=>s!==i),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=i=>{e.lights=i,t.modified()},t.makeLight=BL.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(i,s,o,c)=>{let l=t.normalizedDisplayToProjection(i,s,o);return l=t.projectionToView(l[0],l[1],l[2],c),t.viewToWorld(l[0],l[1],l[2])},t.worldToNormalizedDisplay=(i,s,o,c)=>{let l=t.worldToView(i,s,o);return l=t.viewToProjection(l[0],l[1],l[2],c),t.projectionToNormalizedDisplay(l[0],l[1],l[2])},t.viewToWorld=(i,s,o)=>{if(e.activeCamera===null)return zr("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();lt(c,c),me(c,c);const l=new Float64Array([i,s,o]);return Re(l,l,c),l},t.projectionToView=(i,s,o,c)=>{if(e.activeCamera===null)return zr("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);lt(l,l),me(l,l);const f=new Float64Array([i,s,o]);return Re(f,f,l),f},t.worldToView=(i,s,o)=>{if(e.activeCamera===null)return zr("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();me(c,c);const l=new Float64Array([i,s,o]);return Re(l,l,c),l},t.viewToProjection=(i,s,o,c)=>{if(e.activeCamera===null)return zr("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);me(l,l);const f=new Float64Array([i,s,o]);return Re(f,f,l),f},t.computeVisiblePropBounds=()=>{e.allBounds[0]=_e.INIT_BOUNDS[0],e.allBounds[1]=_e.INIT_BOUNDS[1],e.allBounds[2]=_e.INIT_BOUNDS[2],e.allBounds[3]=_e.INIT_BOUNDS[3],e.allBounds[4]=_e.INIT_BOUNDS[4],e.allBounds[5]=_e.INIT_BOUNDS[5];let i=!0;t.invokeEvent(n);for(let s=0;s<e.props.length;++s){const o=e.props[s];if(o.getVisibility()&&o.getUseBounds()){const c=o.getBounds();c&&kc(c)&&(i=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return i&&(Es(e.allBounds),Ws("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const s=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),o=[0,0,0];if(!kc(s))return Ws("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return zr("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),o[0]=(s[0]+s[1])/2,o[1]=(s[2]+s[3])/2,o[2]=(s[4]+s[5])/2;let l=s[1]-s[0],f=s[3]-s[2],u=s[5]-s[4];l*=l,f*=f,u*=u;let g=l+f+u;g=g===0?1:g,g=Math.sqrt(g)*.5;const p=We(e.activeCamera.getViewAngle()),h=g,d=g/Math.sin(p*.5),m=e.activeCamera.getViewUp();return Math.abs(oe(m,c))>.999&&(HL("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-m[2],m[0],m[1])),e.activeCamera.setFocalPoint(o[0],o[1],o[2]),e.activeCamera.setPosition(o[0]+d*c[0],o[1]+d*c[1],o[2]+d*c[2]),t.resetCameraClippingRange(s),e.activeCamera.setParallelScale(h),e.activeCamera.setPhysicalScale(g),e.activeCamera.setPhysicalTranslation(-o[0],-o[1],-o[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){const s=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!kc(s))return Ws("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return zr("Trying to reset clipping range of non-existent camera"),!1;const o=e.activeCamera.computeClippingRange(s);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const l=We(e.activeCamera.getViewAngle());c=.2*Math.tan(l/2)*o[1]}return o[1]-o[0]<c&&(c=c-o[1]+o[0],o[1]+=c/2,o[0]-=c/2),o[0]<0&&(o[0]=0),o[0]=.99*o[0]-(o[1]-o[0])*e.clippingRangeExpansion,o[1]=1.01*o[1]+(o[1]-o[0])*e.clippingRangeExpansion,o[0]=o[0]>=o[1]?.01*o[1]:o[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),o[0]<e.nearClippingPlaneTolerance*o[1]&&(o[0]=e.nearClippingPlaneTolerance*o[1]),e.activeCamera.setClippingRange(o[0],o[1]),t.invokeEvent(r),!1},t.setRenderWindow=i=>{i!==e._renderWindow&&(e._vtkWindow=i,e._renderWindow=i)},t.visibleActorCount=()=>e.props.filter(i=>i.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let i=e.mtime;const s=e.activeCamera?e.activeCamera.getMTime():0;s>i&&(i=s);const o=e._createdLight?e._createdLight.getMTime():0;return o>i&&(i=o),i},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const qL={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:da(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function jm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,qL,n),jL.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Xt(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),ft(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),ws(t,e,["actors","volumes","lights"]),Ig(t,e,["background"],4,1),f0(t,e,["renderWindow"]),KL(t,e)}const XL=Le(jm,"vtkRenderer");var YL={newInstance:XL,extend:jm};const ZL={Unknown:0,LeftController:1,RightController:2},QL={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},JL={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var Hm={Device:ZL,Input:QL,Axis:JL};const{Device:ec,Input:Ia}=Hm,{vtkWarningMacro:tc,vtkErrorMacro:nc,normalizeWheel:e_,vtkOnceErrorMacro:t_}=O,Si={ctrlKey:!1,altKey:!1,shiftKey:!1},Of={"xr-standard":[Ia.Trigger,Ia.Grip,Ia.TrackPad,Ia.Thumbstick,Ia.A,Ia.B]},C5=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function zs(t){t.cancelable&&t.preventDefault()}function rc(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:a}=n;e[r]=a}),e}function n_(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,a=new Map;let i=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=d=>{nc("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=d=>{e.interactorStyle!==d&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=d,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>tc("empty event loop");function s(d,m){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(d,m))}t.getCurrentRenderer=()=>(e.currentRenderer||s(0,0),e.currentRenderer);function o(d){const m=e._view.getCanvas(),v=m.getBoundingClientRect(),C=m.width/v.width,y=m.height/v.height,T={x:C*(d.clientX-v.left),y:y*(v.height-d.clientY+v.top),z:0};return(a.size<=1||!e.currentRenderer)&&s(T.x,T.y),T}const c=e._getScreenEventPositionFor||o;function l(d){return{controlKey:d.ctrlKey,altKey:d.altKey,shiftKey:d.shiftKey}}function f(d){const m=l(d);return{key:d.key,keyCode:d.charCode,...m}}function u(d){return d.pointerType||""}const g=()=>{if(e.container===null)return;const{container:d}=e;d.addEventListener("contextmenu",zs),d.addEventListener("wheel",t.handleWheel),d.addEventListener("DOMMouseScroll",t.handleWheel),d.addEventListener("pointerenter",t.handlePointerEnter),d.addEventListener("pointerleave",t.handlePointerLeave),d.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),d.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),d.addEventListener("pointerup",t.handlePointerUp),d.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),d.style.touchAction="none",d.style.userSelect="none",d.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=d=>{if(d===null)return;n.setContainer(d)&&g()};const p=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,i=1;const{container:d}=e;d&&(d.removeEventListener("contextmenu",zs),d.removeEventListener("wheel",t.handleWheel),d.removeEventListener("DOMMouseScroll",t.handleWheel),d.removeEventListener("pointerenter",t.handlePointerEnter),d.removeEventListener("pointerleave",t.handlePointerLeave),d.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),d.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),d.removeEventListener("pointerup",t.handlePointerUp),d.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),a.clear()};t.unbindEvents=()=>{p(),n.setContainer(null)},t.handleKeyPress=d=>{const m=f(d);t.keyPressEvent(m)},t.handleKeyDown=d=>{const m=f(d);t.keyDownEvent(m)},t.handleKeyUp=d=>{const m=f(d);t.keyUpEvent(m)},t.handlePointerEnter=d=>{const m={...l(d),position:c(d),deviceType:u(d)};t.pointerEnterEvent(m),m.deviceType==="mouse"&&t.mouseEnterEvent(m)},t.handlePointerLeave=d=>{const m={...l(d),position:c(d),deviceType:u(d)};t.pointerLeaveEvent(m),m.deviceType==="mouse"&&t.mouseLeaveEvent(m)},t.handlePointerDown=d=>{if(!(d.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&zs(d),d.target.hasPointerCapture(d.pointerId)&&d.target.releasePointerCapture(d.pointerId),e.container.setPointerCapture(d.pointerId),a.has(d.pointerId)&&tc("[RenderWindowInteractor] duplicate pointerId detected"),a.set(d.pointerId,{pointerId:d.pointerId,position:c(d)}),d.pointerType){case"pen":case"touch":t.handleTouchStart(d);break;case"mouse":default:t.handleMouseDown(d);break}},t.handlePointerUp=d=>{if(a.has(d.pointerId))switch(e.preventDefaultOnPointerUp&&zs(d),a.delete(d.pointerId),e.container.releasePointerCapture(d.pointerId),d.pointerType){case"pen":case"touch":t.handleTouchEnd(d);break;case"mouse":default:t.handleMouseUp(d);break}},t.handlePointerCancel=d=>{if(a.has(d.pointerId))switch(a.delete(d.pointerId),d.pointerType){case"pen":case"touch":t.handleTouchEnd(d);break;case"mouse":default:t.handleMouseUp(d);break}},t.handlePointerMove=d=>{if(a.has(d.pointerId)){const m=a.get(d.pointerId);m.position=c(d)}switch(d.pointerType){case"pen":case"touch":t.handleTouchMove(d);break;case"mouse":default:t.handleMouseMove(d);break}},t.handleMouseDown=d=>{const m={...l(d),position:c(d),deviceType:u(d)};switch(d.button){case 0:t.leftButtonPressEvent(m);break;case 1:t.middleButtonPressEvent(m);break;case 2:t.rightButtonPressEvent(m);break;default:nc(`Unknown mouse button pressed: ${d.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var d;return(d=document.exitPointerLock)==null?void 0:d.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function h(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=d=>{if(d===void 0){nc("undefined requester, can not start animating");return}if(r.has(d)){tc("requester is already registered for animating");return}r.add(d),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=d=>{const m=Date.now()+d;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,m),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(d){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(d)){if(!m){const v=d&&d.getClassName?d.getClassName():d;tc(`${v} did not request an animation`)}return}r.delete(d),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(d,m,v)=>{d.inputSources.forEach(C=>{const y=C.gripSpace==null?null:m.getPose(C.gripSpace,v),T=C.gripSpace==null?null:m.getPose(C.targetRaySpace,v),x=C.gamepad,S=C.handedness;if(x){x.index in e.lastGamepadValues||(e.lastGamepadValues[x.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let w=0;w<x.buttons.length;++w)w in e.lastGamepadValues[x.index][S].buttons||(e.lastGamepadValues[x.index][S].buttons[w]=!1),e.lastGamepadValues[x.index][S].buttons[w]!==x.buttons[w].pressed&&y!=null&&(t.button3DEvent({gamepad:x,position:y.transform.position,orientation:y.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,pressed:x.buttons[w].pressed,device:C.handedness==="left"?ec.LeftController:ec.RightController,input:Of[x.mapping]&&Of[x.mapping][w]?Of[x.mapping][w]:Ia.Trigger}),e.lastGamepadValues[x.index][S].buttons[w]=x.buttons[w].pressed),e.lastGamepadValues[x.index][S].buttons[w]&&y!=null&&t.move3DEvent({gamepad:x,position:y.transform.position,orientation:y.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,device:C.handedness==="left"?ec.LeftController:ec.RightController})}})},t.handleMouseMove=d=>{const m={...l(d),position:c(d),deviceType:u(d)};e.moveTimeoutID===0?t.startMouseMoveEvent(m):(t.mouseMoveEvent(m),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const d=Date.now();e._animationFrameCount++,d-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(d-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=d,e._animationFrameCount=1),t.animationEvent(),h(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=d=>{zs(d);const m={...e_(d),...l(d),position:c(d),deviceType:u(d)};e.wheelTimeoutID===0&&(Math.abs(m.spinY)>=.3?i=Math.abs(m.spinY):i=1),m.spinY/=i,e.wheelTimeoutID===0?(t.startMouseWheelEvent(m),t.mouseWheelEvent(m)):(t.mouseWheelEvent(m),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=d=>{const m={...l(d),position:c(d),deviceType:u(d)};switch(d.button){case 0:t.leftButtonReleaseEvent(m);break;case 1:t.middleButtonReleaseEvent(m);break;case 2:t.rightButtonReleaseEvent(m);break;default:nc(`Unknown mouse button released: ${d.button}`);break}},t.handleTouchStart=d=>{const m=[...a.values()];if(e.recognizeGestures&&m.length>1){const v=rc(a);if(m.length===2){const C={...l(Si),position:m[0].position,deviceType:u(d)};t.leftButtonReleaseEvent(C)}t.recognizeGesture("TouchStart",v)}else if(m.length===1){const v={...l(Si),position:c(d),deviceType:u(d)};t.leftButtonPressEvent(v)}},t.handleTouchMove=d=>{const m=[...a.values()];if(e.recognizeGestures&&m.length>1){const v=rc(a);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(Si),position:m[0].position,deviceType:u(d)};t.mouseMoveEvent(v)}},t.handleTouchEnd=d=>{const m=[...a.values()];if(e.recognizeGestures)if(m.length===0){const v={...l(Si),position:c(d),deviceType:u(d)};t.leftButtonReleaseEvent(v)}else if(m.length===1){const v=rc(a);t.recognizeGesture("TouchEnd",v);const C={...l(Si),position:m[0].position,deviceType:u(d)};t.leftButtonPressEvent(C)}else{const v=rc(a);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(Si),position:m[0].position,deviceType:u(d)};t.leftButtonReleaseEvent(v)}},t.setView=d=>{e._view!==d&&(e._view=d,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var d,m,v;return(v=(m=(d=e._view)==null?void 0:d.getRenderable())==null?void 0:m.getRenderersByReference())==null?void 0:v[0]},t.findPokedRenderer=function(){var S,w;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const v=(w=(S=e._view)==null?void 0:S.getRenderable())==null?void 0:w.getRenderers();if(!v||v.length===0)return null;v.sort((E,L)=>E.getLayer()-L.getLayer());let C=null,y=null,T=null,x=v.length;for(;x--;){const E=v[x];if(e._view.isInViewport(d,m,E)&&E.getInteractive()){T=E;break}C===null&&E.getInteractive()&&(C=E),y===null&&e._view.isInViewport(d,m,E)&&(y=E)}return T===null&&(T=C),T===null&&(T=y),T==null&&(T=v[0]),T},t.render=()=>{!t.isAnimating()&&!e.inRender&&h()},C5.forEach(d=>{const m=d.charAt(0).toLowerCase()+d.slice(1);t[`${m}Event`]=v=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){t_(`
          Can not forward events without a current renderer on the interactor.
        `);return}const y={type:d,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...v};t[`invoke${d}`](y)}}),t.recognizeGesture=(d,m)=>{if(Object.keys(m).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),d==="TouchStart"){Object.keys(m).forEach(R=>{e.startingEventPositions[R]=m[R]}),e.currentGesture="Start";return}if(d==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let v=0;const C=[],y=[];Object.keys(m).forEach(R=>{C[v]=m[R],y[v]=e.startingEventPositions[R],v++});const T=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y)),x=Math.sqrt((C[0].x-C[1].x)*(C[0].x-C[1].x)+(C[0].y-C[1].y)*(C[0].y-C[1].y));let S=Ol(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),w=Ol(Math.atan2(C[1].y-C[0].y,C[1].x-C[0].x)),E=w-S;w=w+180>=360?w-180:w+180,S=S+180>=360?S-180:S+180,Math.abs(w-S)<Math.abs(E)&&(E=w-S);const L=[];if(L[0]=(C[0].x-y[0].x+C[1].x-y[1].x)/2,L[1]=(C[0].y-y[0].y+C[1].y-y[1].y)/2,d==="TouchMove")if(e.currentGesture==="Start"){let R=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);R<15&&(R=15);const D=Math.abs(x-T),I=x*3.1415926*Math.abs(E)/360,b=Math.sqrt(L[0]*L[0]+L[1]*L[1]);if(D>R&&D>I&&D>b){e.currentGesture="Pinch";const F={scale:1,touches:m};t.startPinchEvent(F)}else if(I>R&&I>b){e.currentGesture="Rotate";const F={rotation:0,touches:m};t.startRotateEvent(F)}else if(b>R){e.currentGesture="Pan";const F={translation:[0,0],touches:m};t.startPanEvent(F)}}else{if(e.currentGesture==="Rotate"){const R={rotation:E,touches:m};t.rotateEvent(R)}if(e.currentGesture==="Pinch"){const R={scale:x/T,touches:m};t.pinchEvent(R)}if(e.currentGesture==="Pan"){const R={translation:L,touches:m};t.panEvent(R)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=d=>{e._forcedRenderer=!!d,e.currentRenderer=d},t.setContainer=d=>{p();const m=n.setContainer(d??null);return m&&g(),m},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const r_={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function Km(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,r_,n),O.obj(t,e),e._animationExtendedEnd=0,O.event(t,e,"RenderEvent"),C5.forEach(r=>O.event(t,e,r)),O.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),O.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),O.moveToProtected(t,e,["view"]),n_(t,e)}const a_=O.newInstance(Km,"vtkRenderWindowInteractor");var i_={newInstance:a_,extend:Km,handledEvents:C5,...Hm};const{vtkErrorMacro:s_}=O,o_=[1,-1,1,-1,1,-1];function c_(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=O.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];t.setTuple(n,a)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,a)=>t.insertNextTuple([n,r,a]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const a=t.getRange(0);e.bounds[0]=a[0],e.bounds[1]=a[1];const i=t.getRange(1);e.bounds[2]=i[0],e.bounds[3]=i[1];const s=t.getRange(2);return e.bounds[4]=s[0],e.bounds[5]=s[1],e.bounds}if(t.getNumberOfComponents()!==2)return s_(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),o_;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const l_={empty:!0,numberOfComponents:3,dataType:ce.FLOAT,bounds:[1,-1,1,-1,1,-1]};function qm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,l_,n),le.extend(t,e,n),c_(t,e)}const u_=O.newInstance(qm,"vtkPoints");var c2={newInstance:u_,extend:qm};function Xm(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function Ym(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const f_={extractCellSizes:Xm,getNumberOfCells:Ym};function g_(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=Ym(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=Xm(t.getData())),e.cellSizes),t.resize=r=>{const a=t.getNumberOfTuples();n.resize(r);const i=t.getNumberOfTuples();i<a&&(i===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let a=r;const i=e.values[a++];return e.values.subarray(a,a+i)},t.insertNextCell=r=>{const a=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),a}}function p_(t){return{empty:!0,numberOfComponents:1,dataType:ce.UNSIGNED_INT,...t}}function Zm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};le.extend(t,e,p_(n)),g_(t,e)}const d_=O.newInstance(Zm,"vtkCellArray");var qo={newInstance:d_,extend:Zm,...f_};function h_(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let a=e.points.getData();a.length!==3*e.pointsIds.length&&(a=O.newTypedArray(n.getDataType(),3*e.pointsIds.length));const i=n.getData();e.pointsIds.forEach((s,o)=>{let c=3*s,l=3*o;a[l]=i[c],a[++l]=i[++c],a[++l]=i[++c]}),e.points.setData(a)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let a=n.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let a=1;a<n;a++)e.points.getPoint(a,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else Es(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let a=0;a<3;a++)r=e.bounds[2*a+1]-e.bounds[2*a],n+=r*r;return n},t.getParametricDistance=n=>{let r,a=0;for(let i=0;i<3;i++)n[i]<0?r=-n[i]:n[i]>1?r=n[i]-1:r=0,r>a&&(a=r);return a},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,a,i,s,o,c)=>{},t.evaluatePosition=(n,r,a,i,s,o)=>{O.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const m_={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Qm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,m_,n),O.obj(t,e),e.points||(e.points=c2.newInstance()),O.get(t,e,["points","pointsIds"]),h_(t,e)}const v_=O.newInstance(Qm,"vtkCell");var kl={newInstance:v_,extend:Qm};function y_(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function C_(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),a=n.getNumberOfCells(),i=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let s=0;s<a;++s){const{cellPointIds:o}=n.getCellPoints(s);o.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let s=0;s<a;++s){const{cellPointIds:o}=n.getCellPoints(s);o.forEach(c=>{t.insertCellReference(c,i[c]++,s)})}}else{for(let s=0;s<a;s++)kl.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let s=0;s<a;++s)kl.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,i[c]++,s)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(a=>a!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{y_(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,a)=>{e.array[n].cells[r]=a}}const T_={array:null,maxId:0,extend:0};function Jm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,T_,n),O.obj(t,e),C_(t,e)}const x_=O.newInstance(Jm,"vtkCellLinks");var S_={newInstance:x_,extend:Jm};const Ne={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},l2=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function w_(t){return t<l2.length?l2[t]:"UnknownClass"}function E_(t){return l2.findIndex(t)}function R_(t){return t<Ne.VTK_QUADRATIC_EDGE||t===Ne.VTK_CONVEX_POINT_SET||t===Ne.VTK_POLYHEDRON}function O_(t){return t===Ne.VTK_TRIANGLE_STRIP||t===Ne.VTK_POLY_LINE||t===Ne.VTK_POLY_VERTEX}const M_={getClassNameFromTypeId:w_,getTypeIdFromClassName:E_,isLinear:R_,hasSubCells:O_};function D_(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,a)=>{e.typeArray[n]=r,e.locationArray[n]=a,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,a)=>{e.size=n,e.typeArray=r,e.locationArray=a,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=Ne.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let a=0;a<r;++a)if(n===t.getCellType(a))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const V_={size:0,maxId:-1,extend:1e3};function e7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V_,n),O.obj(t,e),O.get(t,e,["size","maxId","extend"]),O.getArray(t,e,["typeArray","locationArray"]),D_(t,e)}const L_=O.newInstance(e7,"vtkCellTypes");var __={newInstance:L_,extend:e7,...M_};const N_={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var t7={IntersectionState:N_};const{IntersectionState:Gc}=t7;function Bi(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const a={t:Number.MIN_VALUE,distance:0},i=[];let s;i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2];const o=i[0]*(t[0]-e[0])+i[1]*(t[1]-e[1])+i[2]*(t[2]-e[2]),c=oe(i,i);let l=1e-5*o;return c!==0&&(a.t=o/c),l<0&&(l=-l),-l<c&&c<l||c<=0||a.t<0?s=e:a.t>1?s=n:(s=i,i[0]=e[0]+a.t*i[0],i[1]=e[1]+a.t*i[1],i[2]=e[2]+a.t*i[2]),r&&(r[0]=s[0],r[1]=s[1],r[2]=s[2]),a.distance=er(s,t),a}function n7(t,e,n,r,a,i){const s=[],o=[],c=[];a[0]=0,i[0]=0,Rr(e,t,s),Rr(r,n,o),Rr(n,t,c);const l=[oe(s,s),-oe(s,o),-oe(s,o),oe(o,o)],f=[];if(f[0]=oe(s,c),f[1]=-oe(o,c),A9(l,f,2)===0){let u=Number.MAX_VALUE;const g=[t,e,n,r],p=[n,n,t,t],h=[r,r,e,e];i[0],i[0],a[0],a[0],a[0],a[0],i[0],i[0];let d;for(let m=0;m<4;m++)d=Bi(g[m],p[m],h[m]),d.distance<u&&(u=d.distance);return Gc.ON_LINE}return a[0]=f[0],i[0]=f[1],a[0]>=0&&a[0]<=1&&i[0]>=0&&i[0]<=1?Gc.YES_INTERSECTION:Gc.NO_INTERSECTION}const I_={distanceToLine:Bi,intersection:n7};function F_(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,a,i,s,o)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;const l=[],f=[],u=[];e.points.getPoint(0,f),e.points.getPoint(1,u);const g=[],p=[],h=n7(r,a,f,u,g,p);if(c.t=g[0],c.betweenPoints=n(c.t),o[0]=p[0],h===Gc.YES_INTERSECTION){for(let d=0;d<3;d++)s[d]=f[d]+o[0]*(u[d]-f[d]),l[d]=r[d]+c.t*(a[d]-r[d]);if(er(s,l)<=i*i)return c.intersect=1,c}else{let d;if(c.t<0)return d=Bi(r,f,u,s),d.distance<=i*i&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return d=Bi(a,f,u,s),d.distance<=i*i&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(o[0]<0)return o[0]=0,d=Bi(f,r,a,s),c.t=d.t,d.distance<=i*i&&(c.intersect=1),c;if(o[0]>1)return o[0]=1,d=Bi(u,r,a,s),c.t=d.t,d.distance<=i*i&&(c.intersect=1),c}return c},t.evaluateLocation=(r,a,i)=>{const s=[],o=[];e.points.getPoint(0,s),e.points.getPoint(1,o);for(let c=0;c<3;c++)a[c]=s[c]+r[0]*(o[c]-s[c]);i[0]=1-r[0],i[1]=r[0]},t.evaluateOrientation=(r,a,i)=>e.orientations?(Mc(a,e.orientations[0],e.orientations[1],r[0]),i[0]=1-r[0],i[1]=r[0],!0):!1}const k_={orientations:null};function r7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,k_,n),kl.extend(t,e,n),O.setGet(t,e,["orientations"]),F_(t,e)}const U_=O.newInstance(r7,"vtkLine");var Tn={newInstance:U_,extend:r7,...I_,...t7};function P_(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Gn(e.points):e.points=c2.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,a),e.points=c2.newInstance(),e.points.shallowCopy(r.getPoints())}}const b_={};function a7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,b_,n),Rs.extend(t,e,n),O.setGet(t,e,["points"]),P_(t,e)}const G_=O.newInstance(a7,"vtkPointSet");var B_={newInstance:G_,extend:a7};function T5(t,e,n,r){const a=n[0]-e[0],i=n[1]-e[1],s=n[2]-e[2],o=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];r[0]=i*l-s*c,r[1]=s*o-a*l,r[2]=a*c-i*o}function Ul(t,e,n,r){T5(t,e,n,r);const a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);a!==0&&(r[0]/=a,r[1]/=a,r[2]/=a)}function A_(t,e,n,r,a,i){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1;const c=[],l=[],f=[],u=[],g=[];Ul(t,e,n,u),Ul(r,a,i,g);const p=-oe(u,t),h=-oe(g,r),d=[oe(g,t)+h,oe(g,e)+h,oe(g,n)+h];if(d[0]*d[1]>s&&d[0]*d[2]>s)return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:f};const m=[oe(u,r)+p,oe(u,a)+p,oe(u,i)+p];if(m[0]*m[1]>s&&m[0]*m[2]>s)return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:f};if(Math.abs(u[0]-g[0])<1e-9&&Math.abs(u[1]-g[1])<1e-9&&Math.abs(u[2]-g[2])<1e-9&&Math.abs(p-h)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:f};const v=[t,e,n],C=[r,a,i],y=oe(u,g),T=(p-h*y)/(y*y-1),x=(h-p*y)/(y*y-1),S=[T*u[0]+x*g[0],T*u[1]+x*g[1],T*u[2]+x*g[2]],w=cr(u,g,[]);ui(w);let E=0,L=0;const R=[],D=[];let I=50,b=50;for(let P=0;P<3;P++){const K=P,U=(P+1)%3,N=Ft.intersectWithLine(v[K],v[U],r,g);N.intersection&&N.t>0-s&&N.t<1+s&&(N.t<1+s&&N.t>1-s&&(I=E),R[E++]=oe(N.x,w)-oe(S,w));const k=Ft.intersectWithLine(C[K],C[U],t,u);k.intersection&&k.t>0-s&&k.t<1+s&&(k.t<1+s&&k.t>1-s&&(b=L),D[L++]=oe(k.x,w)-oe(S,w))}if(E>2){E--;const P=R[2];R[2]=R[I],R[I]=P}if(L>2){L--;const P=D[2];D[2]=D[b],D[b]=P}if(E!==2||L!==2)return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:f};if(Number.isNaN(R[0])||Number.isNaN(R[1])||Number.isNaN(D[0])||Number.isNaN(D[1]))return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:f};if(R[0]>R[1]){const P=R[1];R[1]=R[0],R[0]=P}if(D[0]>D[1]){const P=D[1];D[1]=D[0],D[0]=P}let F,W;return R[1]<D[0]||D[1]<R[0]?{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:f}:(R[0]<D[0]?R[1]<D[1]?(f[0]=2,f[1]=1,F=D[0],W=R[1]):(f[0]=2,f[1]=2,F=D[0],W=D[1]):R[1]<D[1]?(f[0]=1,f[1]=1,F=R[0],W=R[1]):(f[0]=1,f[1]=2,F=R[0],W=D[1]),H1(S,w,F,c),H1(S,w,W,l),{intersect:!0,coplanar:o,pt1:c,pt2:l,surfaceId:f})}const W_={computeNormalDirection:T5,computeNormal:Ul,intersectWithTriangle:A_};function z_(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,a,i,s)=>{const o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};s[2]=0;const c=[],l=a*a,f=[],u=[],g=[];e.points.getPoint(0,f),e.points.getPoint(1,u),e.points.getPoint(2,g);const p=[],h=[];if(Ul(f,u,g,p),p[0]!==0||p[1]!==0||p[2]!==0){const y=Ft.intersectWithLine(n,r,f,p);if(o.betweenPoints=y.betweenPoints,o.t=y.t,i[0]=y.x[0],i[1]=y.x[1],i[2]=y.x[2],!y.intersection)return s[0]=0,s[1]=0,o.intersect=0,o;const T=t.evaluatePosition(i,c,s,h);if(T.evaluation>=0)return T.dist2<=l?(o.intersect=1,o):(o.intersect=T.evaluation,o)}const d=er(f,u),m=er(u,g),v=er(g,f);e.line||(e.line=Tn.newInstance()),d>m&&d>v?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,u)):m>v&&m>d?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,g)):(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f));const C=e.line.intersectWithLine(n,r,a,i,s);if(o.betweenPoints=C.betweenPoints,o.t=C.t,C.intersect){const y=[],T=[],x=[];for(let S=0;S<3;S++)y[S]=f[S]-g[S],T[S]=u[S]-g[S],x[S]=i[S]-g[S];return s[0]=oe(x,y)/v,s[1]=oe(x,T)/m,o.intersect=1,o}return s[0]=0,s[1]=0,o.intersect=0,o},t.evaluatePosition=(n,r,a,i)=>{const s={subId:0,dist2:0,evaluation:-1};let o,c;const l=[],f=[],u=[],g=[];let p;const h=[],d=[],m=[];let v=0,C=0;const y=[];let T,x,S,w=[];const E=[],L=[],R=[];s.subId=0,a[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,f),e.points.getPoint(0,u),T5(l,f,u,g),Ft.generalizedProjectPoint(n,l,g,R);let D=0;for(o=0;o<3;o++)g[o]<0?p=-g[o]:p=g[o],p>D&&(D=p,C=o);for(c=0,o=0;o<3;o++)o!==C&&(y[c++]=o);for(o=0;o<2;o++)h[o]=R[y[o]]-u[y[o]],d[o]=l[y[o]]-u[y[o]],m[o]=f[y[o]]-u[y[o]];if(v=ze(d,m),v===0)return a[0]=0,a[1]=0,s.evaluation=-1,s;if(a[0]=ze(h,m)/v,a[1]=ze(d,h)/v,i[0]=1-(a[0]+a[1]),i[1]=a[0],i[2]=a[1],i[0]>=0&&i[0]<=1&&i[1]>=0&&i[1]<=1&&i[2]>=0&&i[2]<=1)r&&(s.dist2=er(R,n),r[0]=R[0],r[1]=R[1],r[2]=R[2]),s.evaluation=1;else{let I;if(r){if(i[1]<0&&i[2]<0)for(T=er(n,u),x=Tn.distanceToLine(n,l,u,I,E),S=Tn.distanceToLine(n,u,f,I,L),T<x?(s.dist2=T,w=u):(s.dist2=x,w=E),S<s.dist2&&(s.dist2=S,w=L),o=0;o<3;o++)r[o]=w[o];else if(i[2]<0&&i[0]<0)for(T=er(n,l),x=Tn.distanceToLine(n,l,u,I,E),S=Tn.distanceToLine(n,l,f,I,L),T<x?(s.dist2=T,w=l):(s.dist2=x,w=E),S<s.dist2&&(s.dist2=S,w=L),o=0;o<3;o++)r[o]=w[o];else if(i[1]<0&&i[0]<0)for(T=er(n,f),x=Tn.distanceToLine(n,f,u,I,E),S=Tn.distanceToLine(n,l,f,I,L),T<x?(s.dist2=T,w=f):(s.dist2=x,w=E),S<s.dist2&&(s.dist2=S,w=L),o=0;o<3;o++)r[o]=w[o];else if(i[0]<0){const b=Tn.distanceToLine(n,l,f,r);s.dist2=b.distance}else if(i[1]<0){const b=Tn.distanceToLine(n,f,u,r);s.dist2=b.distance}else if(i[2]<0){const b=Tn.distanceToLine(n,l,u,r);s.dist2=b.distance}}s.evaluation=0}return s},t.evaluateLocation=(n,r,a)=>{const i=[],s=[],o=[];e.points.getPoint(0,i),e.points.getPoint(1,s),e.points.getPoint(2,o);const c=1-n[0]-n[1];for(let l=0;l<3;l++)r[l]=i[l]*c+s[l]*n[0]+o[l]*n[1];a[0]=c,a[1]=n[0],a[2]=n[1]},t.getParametricDistance=n=>{let r,a=0;const i=[];i[0]=n[0],i[1]=n[1],i[2]=1-n[0]-n[1];for(let s=0;s<3;s++)i[s]<0?r=-i[s]:i[s]>1?r=i[s]-1:r=0,r>a&&(a=r);return a}}const $_={};function i7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$_,n),kl.extend(t,e,n),z_(t,e)}const j_=O.newInstance(i7,"vtkTriangle");var H_={newInstance:j_,extend:i7,...W_};const Mf=["verts","lines","polys","strips"],{vtkWarningMacro:ch}=O,K_={[Ne.VTK_LINE]:Tn,[Ne.VTK_POLY_LINE]:Tn,[Ne.VTK_TRIANGLE]:H_};function q_(t,e){e.classHierarchy.push("vtkPolyData");function n(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,i=>i.toUpperCase()).replace(/\s+/g,"")}Mf.forEach(a=>{t[`getNumberOf${n(a)}`]=()=>e[a].getNumberOfCells(),e[a]?e[a]=Gn(e[a]):e[a]=qo.newInstance()}),t.getNumberOfCells=()=>Mf.reduce((a,i)=>a+e[i].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(a){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(a,i),Mf.forEach(s=>{e[s]=qo.newInstance(),e[s].shallowCopy(a.getReferenceByName(s))})},t.buildCells=()=>{const a=t.getNumberOfVerts(),i=t.getNumberOfLines(),s=t.getNumberOfPolys(),o=t.getNumberOfStrips(),c=a+i+s+o,l=new Uint8Array(c);let f=l;const u=new Uint32Array(c);let g=u;if(a){let p=0;e.verts.getCellSizes().forEach((h,d)=>{g[d]=p,f[d]=h>1?Ne.VTK_POLY_VERTEX:Ne.VTK_VERTEX,p+=h+1}),g=g.subarray(a),f=f.subarray(a)}if(i){let p=0;e.lines.getCellSizes().forEach((h,d)=>{g[d]=p,f[d]=h>2?Ne.VTK_POLY_LINE:Ne.VTK_LINE,h===1&&ch("Building VTK_LINE ",d," with only one point, but VTK_LINE needs at least two points. Check the input."),p+=h+1}),g=g.subarray(i),f=f.subarray(i)}if(s){let p=0;e.polys.getCellSizes().forEach((h,d)=>{switch(g[d]=p,h){case 3:f[d]=Ne.VTK_TRIANGLE;break;case 4:f[d]=Ne.VTK_QUAD;break;default:f[d]=Ne.VTK_POLYGON;break}h<3&&ch("Building VTK_TRIANGLE ",d," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),p+=h+1}),g+=g.subarray(s),f+=f.subarray(s)}if(o){let p=0;f.fill(Ne.VTK_TRIANGLE_STRIP,0,o),e.strips.getCellSizes().forEach((h,d)=>{g[d]=p,p+=h+1})}e.cells=__.newInstance(),e.cells.setCellTypes(c,l,u)},t.buildLinks=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=S_.newInstance(),a>0?e.links.allocate(a):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=a=>e.cells.getCellType(a),t.getCellPoints=a=>{const i=t.getCellType(a);let s=null;switch(i){case Ne.VTK_VERTEX:case Ne.VTK_POLY_VERTEX:s=e.verts;break;case Ne.VTK_LINE:case Ne.VTK_POLY_LINE:s=e.lines;break;case Ne.VTK_TRIANGLE:case Ne.VTK_QUAD:case Ne.VTK_POLYGON:s=e.polys;break;case Ne.VTK_TRIANGLE_STRIP:s=e.strips;break;default:return s=null,{type:0,cellPointIds:null}}const o=e.cells.getCellLocation(a),c=s.getCell(o);return{cellType:i,cellPointIds:c}},t.getPointCells=a=>e.links.getCells(a),t.getCellEdgeNeighbors=(a,i,s)=>{const o=e.links.getLink(i),c=e.links.getLink(s);return o.cells.filter(l=>l!==a&&c.cells.indexOf(l)!==-1)},t.getCell=function(a){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const s=t.getCellPoints(a),o=i||K_[s.cellType].newInstance();return o.initialize(t.getPoints(),s.cellPointIds),o}}const X_={};function s7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,X_,n),B_.extend(t,e,n),O.get(t,e,["cells","links"]),O.setGet(t,e,["verts","lines","polys","strips"]),q_(t,e)}const Y_=O.newInstance(s7,"vtkPolyData");var ei={newInstance:Y_,extend:s7};const Z_=1e-6;function Q_(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((a,i)=>a+r[i]),t.modified()},t.getOrientationWXYZ=()=>{const r=oi();W1(r,e.rotation);const a=new Float64Array(3),i=vS(a,r);return[Ol(i),a[0],a[1],a[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return W1(r,e.rotation)},t.rotateX=r=>{r!==0&&(Sg(e.rotation,e.rotation,We(r)),t.modified())},t.rotateY=r=>{r!==0&&(wg(e.rotation,e.rotation,We(r)),t.modified())},t.rotateZ=r=>{r!==0&&(Eg(e.rotation,e.rotation,We(r)),t.modified())},t.rotateWXYZ=(r,a,i,s)=>{if(r===0||a===0&&i===0&&s===0)return;const o=We(r),c=oi();Dg(c,[a,i,s],o);const l=new Float64Array(16);ml(l,c),ge(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-Z_)return;const a=ml(new Float64Array(16),r);ge(e.rotation,e.rotation,a),t.modified()},t.setOrientation=(r,a,i)=>r===e.orientation[0]&&a===e.orientation[1]&&i===e.orientation[2]?!1:(e.orientation=[r,a,i],te(e.rotation),t.rotateZ(i),t.rotateX(r),t.rotateY(a),t.modified(),!0),t.setUserMatrix=r=>d0(e.userMatrix,r)?!1:(Ze(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){te(e.matrix),e.userMatrix&&ge(e.matrix,e.matrix,e.userMatrix),at(e.matrix,e.matrix,e.origin),at(e.matrix,e.matrix,e.position),ge(e.matrix,e.matrix,e.rotation),Nr(e.matrix,e.matrix,e.scale),at(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),me(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let a=0;a<4;++a)(r===a?1:0)!==e.matrix[r+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>_e.getCenter(e.bounds),t.getLength=()=>_e.getLength(e.bounds),t.getXRange=()=>_e.getXRange(e.bounds),t.getYRange=()=>_e.getYRange(e.bounds),t.getZRange=()=>_e.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const J_={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function o7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,J_,n),xm.extend(t,e,n),e.matrixMTime={},O.obj(e.matrixMTime),O.get(t,e,["bounds","isIdentity"]),O.getArray(t,e,["orientation"]),O.setGetArray(t,e,["origin","position","scale"],3),e.matrix=te(new Float64Array(16)),e.rotation=te(new Float64Array(16)),e.userMatrix=te(new Float64Array(16)),e.transform=null,Q_(t,e)}const eN=O.newInstance(o7,"vtkProp3D");var x5={newInstance:eN,extend:o7};const{vtkDebugMacro:tN}=O;function nN(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=m0.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){tN("Recomputing bounds..."),e.mapperBounds=r.concat();const a=[];_e.getCorners(r,a),t.computeMatrix();const i=new Float64Array(16);me(i,e.matrix),a.forEach(s=>Re(s,s,i)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((s,o)=>o%2===0?a.reduce((c,l)=>c>l[o/2]?l[o/2]:c,s):a.reduce((c,l)=>c<l[(o-1)/2]?l[(o-1)/2]:c,s)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=n.getMTime();if(e.property!==null){const a=e.property.getMTime();r=a>r?a:r}if(e.backfaceProperty!==null){const a=e.backfaceProperty.getMTime();r=a>r?a:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let a=e.mapper.getMTime();r=a>r?a:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),r=a>r?a:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,a)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,a)}}const rN={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function aN(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rN,n),x5.extend(t,e,n),e.boundsMTime={},O.obj(e.boundsMTime),O.set(t,e,["property"]),O.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),nN(t,e)}O.newInstance(aN,"vtkActor");function iN(t,e){const n=t.invokeResize;delete t.invokeResize,e.renderWindow=tE.newInstance(),e.rendererMap={},e.openGLRenderWindow=NL.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=i_.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:r,id:a,background:i})=>{const s=YL.newInstance({viewport:r,background:i||e.background});e.renderWindow.addRenderer(s),e.rendererMap[a]=s},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=r=>{const a=t.getRenderer(r);e.renderWindow.removeRenderer(a),a.delete(),delete e.rendererMap[r]},t.getRenderer=r=>e.rendererMap[r],t.getRenderers=()=>{const{rendererMap:r}=e;return Object.keys(r).map(i=>({id:i,renderer:r[i]}))},t.resize=()=>{if(e.container){const{width:r,height:a}=e.container;e.openGLRenderWindow.setSize(Math.floor(r),Math.floor(a)),n(),e.renderWindow.render()}},t.setContainer=r=>{e.container=r,e.openGLRenderWindow.setContainer(e.container)},t.delete=O.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const sN={background:[0,0,0],container:null};function c7(t,e,n={}){Object.assign(e,sN,n),O.obj(t,e),O.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),O.event(t,e,"resize"),iN(t,e)}const oN=O.newInstance(c7),cN={newInstance:oN,extend:c7},{vtkErrorMacro:ac}=O;function lN(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let n,r=0,a=0;e.nodes.length>0&&(r=e.nodes[0].y);for(let i=1;i<e.nodes.length;i++){if(n=e.nodes[i].y,n!==r)if(n>r)switch(a){case 0:case 1:a=1;break;case 2:default:a=3;break}else switch(a){case 0:case 2:a=2;break;case 1:default:a=3;break}if(r=n,a===3)break}switch(a){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(let r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let n=1,r=0,a=0;for(;a<e.nodes.length;a++)if(e.nodes[a].y!==0){n=0;break}return n?r=Number.MAX_VALUE:a>0?r=e.nodes[a-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=(n,r)=>{const a=e.nodes.length;return n<0||n>=a?(ac("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=(n,r)=>{const a=e.nodes.length;if(n<0||n>=a)return ac("Index out of range!"),-1;const i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(n,r)=>t.addPointLong(n,r,.5,0),t.addPointLong=(n,r,a,i)=>{if(a<0||a>1)return ac("Midpoint outside range [0.0, 1.0]"),-1;if(i<0||i>1)return ac("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const s={x:n,y:r,midpoint:a,sharpness:i};e.nodes.push(s),t.sortAndUpdateRange();let o;for(o=0;o<e.nodes.length&&e.nodes[o].x!==n;o++);return o<e.nodes.length?o:-1},t.setNodes=n=>{e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((r,a)=>r.x-a.x),t.updateRange()||t.modified()},t.updateRange=()=>{const n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;const a=r;let i=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(n,r,a,i)=>{t.sortAndUpdateRange();for(let s=0;s<e.nodes.length;)e.nodes[s].x>=n&&e.nodes[s].x<=a?e.nodes.splice(s,1):s++;t.addPoint(n,r,.5,0),t.addPoint(a,i,.5,0)},t.getValue=n=>{const r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=n=>{if(n.length<2)return 0;const r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(n,r)=>{const a=t.findMinimumXDistance();return Math.ceil((r-n)/a)},t.findMinimumXDistance=()=>{const n=e.nodes.length;if(n<2)return-1;let r=e.nodes[1].x-e.nodes[0].x;for(let a=0;a<n-1;a++){const i=e.nodes[a+1].x-e.nodes[a].x;i<r&&(r=i)}return r},t.getTable=function(n,r,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,o,c=0;const l=e.nodes.length;let f=0;l!==0&&(f=e.nodes[l-1].y);let u=0,g=0,p=0,h=0,d=0,m=0,v=0;for(o=0;o<a;o++){const C=s*o;for(a>1?u=n+o/(a-1)*(r-n):u=.5*(n+r);c<l&&u>e.nodes[c].x;)c++,c<l&&(g=e.nodes[c-1].x,p=e.nodes[c].x,h=e.nodes[c-1].y,d=e.nodes[c].y,m=e.nodes[c-1].midpoint,v=e.nodes[c-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(c>=l)i[C]=e.clamping?f:0;else if(c===0)i[C]=e.clamping?e.nodes[0].y:0;else{let y=(u-g)/(p-g);if(y<m?y=.5*y/m:y=.5+.5*(y-m)/(1-m),v>.99)if(y<.5){i[C]=h;continue}else{i[C]=d;continue}if(v<.01){i[C]=(1-y)*h+y*d;continue}y<.5?y=.5*(y*2)**(1+10*v):y>.5&&(y=1-.5*((1-y)*2)**(1+10*v));const T=y*y,x=T*y,S=2*x-3*T+1,w=-2*x+3*T,E=x-2*T+y,L=x-T,R=d-h,D=(1-v)*R;i[C]=S*h+w*d+E*D+L*D;const I=h<d?h:d,b=h>d?h:d;i[C]=i[C]<I?I:i[C],i[C]=i[C]>b?b:i[C]}}}}const uN={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function l7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uN,n),O.obj(t,e),e.nodes=[],O.setGet(t,e,["allowDuplicateScalars","clamping"]),O.setArray(t,e,["range"],2),O.getArray(t,e,["range"]),lN(t,e)}const fN=O.newInstance(l7,"vtkPiecewiseFunction");var Xo={newInstance:fN,extend:l7};const{BlendMode:$r,FilterMode:no}=p8;function gN(t,e,n,r,a){let i=null;return a?(i=a,i.removeAllPoints()):i=Xo.newInstance(),i.addPointLong(-1024,0,1,1),i.addPoint(t,e),i.addPoint(n,r),i}const pN={createRadonTransferFunction:gN};function dN(t,e){e.classHierarchy.push("vtkVolumeMapper");const n={...t};t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=da(),e.bounds},t.update=()=>{t.getInputData()},t.setBlendModeToComposite=()=>{t.setBlendMode($r.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode($r.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode($r.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode($r.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode($r.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode($r.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>O.enumToString($r,e.blendMode),t.setAverageIPScalarRange=(r,a)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(r,a)},t.getFilterModeAsString=()=>O.enumToString(no,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(no.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(no.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(no.RAW)},t.setGlobalIlluminationReach=r=>n.setGlobalIlluminationReach(Bn(r,0,1)),t.setVolumetricScatteringBlending=r=>n.setVolumetricScatteringBlending(Bn(r,0,1)),t.setVolumeShadowSamplingDistFactor=r=>n.setVolumeShadowSamplingDistFactor(r>=1?r:1),t.setAnisotropy=r=>n.setAnisotropy(Bn(r,-.99,.99)),t.setLAOKernelSize=r=>n.setLAOKernelSize(Kg(Bn(r,1,32))),t.setLAOKernelRadius=r=>n.setLAOKernelRadius(r>=1?r:1)}const hN={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:$r.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:no.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function u7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hN,n),u5.extend(t,e,n),O.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),O.setGetArray(t,e,["ipScalarRange"],2),O.event(t,e,"lightingActivated"),dN(t,e)}const mN=O.newInstance(u7,"vtkVolumeMapper");var vN={newInstance:mN,extend:u7,...pN};function yN(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const n=t.delete;t.delete=()=>{e.scalarTexture=null,n()}}const CN={scalarTexture:null};function f7(t,e,n={}){Object.assign(e,CN,n),vN.extend(t,e,n),O.setGet(t,e,["scalarTexture"]),yN(t,e)}const TN=O.newInstance(f7,"vtkSharedVolumeMapper"),xN={newInstance:TN,extend:f7};function SN(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(s,o,c,l,f,u,g)=>{e.inputDataType=f,e.inputNumComps=l,n(s,o,c,l,f,u,g)},t.update3DFromRaw=()=>{const{volumeId:s}=e;if(!s)return;const o=ie.getVolume(s);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),o.isDynamicVolume()){i();return}return t.hasUpdatedFrames()&&a()};const r=t.modified;t.setUpdatedFrame=s=>{e.updatedFrames[s]=!0,r()},t.modified=()=>{r();const s=ie.getVolume(e.volumeId);if(!s)return;const o=s.imageIds;for(let c=0;c<o.length;c++)e.updatedFrames[c]=!0};function a(){const o=ie.getVolume(e.volumeId).imageIds;for(let c=0;c<e.updatedFrames.length;c++)if(e.updatedFrames[c]){const l=ie.getImage(o[c]);if(!l)continue;const f=l.voxelManager.getScalarData(),u=e.context,g=f.constructor.name,[p]=t.updateArrayDataTypeForGL(g,[f]);t.bind();const h=c;u.texSubImage3D(e.target,0,0,0,h,e.width,e.height,1,e.format,e.openGLDataType,p),t.deactivate(),e.updatedFrames[c]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function i(){const s=ie.getVolume(e.volumeId),o=s.getCurrentTimePointImageIds();if(!o.length)return!1;let c;for(let l=0;l<o.length;l++){const f=o[l],u=ie.getImage(f);let g;u?(g=u.voxelManager.getScalarData(),c=g.constructor):(c=d8(s.dataType,!0),g=new c(e.width*e.height));const p=e.context,h=g.constructor.name,[d]=t.updateArrayDataTypeForGL(h,[g]);t.bind();let m=l;p.texSubImage3D(e.target,0,0,0,m,e.width,e.height,1,e.format,e.openGLDataType,d),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(s=>s),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=s=>{e.volumeId=s},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:s,height:o,depth:c,numberOfComponents:l,dataType:f})=>{e.width??(e.width=s),e.height??(e.height=o),e.depth??(e.depth=c),e.inputNumComps??(e.inputNumComps=l),e.inputDataType??(e.inputDataType=f)},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const wN={updatedFrames:[]};function g7(t,e,n={}){Object.assign(e,wN,n),ke.extend(t,e,n),SN(t,e)}const EN=O.newInstance(g7,"vtkStreamingOpenGLTexture"),RN={newInstance:EN,extend:g7},ON={isPerformingCoordinateTransformation:!1};function p7(t,e,n={}){Object.assign(e,ON,n),y5.extend(t,e,n),O.setGet(t,e,["isPerformingCoordinateTransformation"]),DN(t,e)}const MN=O.newInstance(p7,"vtkSlabCamera");function DN(t,e){e.classHierarchy.push("vtkSlabCamera");const n=te(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(a,i,s)=>{const o=Ca();if(e.projectionMatrix){const g=1/e.physicalScale;return Ee(r,g,g,g),Ze(o,e.projectionMatrix),Nr(o,o,r),me(o,o),o}te(n);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const f=l-c,u=[c+(i+1)*f/2,c+(s+1)*f/2];if(e.parallelProjection){const g=e.parallelScale*a,p=e.parallelScale,h=(e.windowCenter[0]-1)*g,d=(e.windowCenter[0]+1)*g,m=(e.windowCenter[1]-1)*p,v=(e.windowCenter[1]+1)*p;Mg(n,h,d,m,v,u[0],u[1]),me(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const g=Math.tan(bn.radiansFromDegrees(e.viewAngle)/2);let p,h;e.useHorizontalViewAngle===!0?(p=c*g,h=c*g/a):(p=c*g*a,h=c*g);const d=(e.windowCenter[0]-1)*p,m=(e.windowCenter[0]+1)*p,v=(e.windowCenter[1]-1)*h,C=(e.windowCenter[1]+1)*h,y=u[0],T=u[1];n[0]=2*y/(m-d),n[5]=2*y/(C-v),n[2]=(d+m)/(m-d),n[6]=(v+C)/(C-v),n[10]=-(y+T)/(T-y),n[14]=-1,n[11]=-2*y*T/(T-y),n[15]=0}}return Ze(o,n),o}}const VN={newInstance:MN,extend:p7};function nr(t){return an(t,"vtkVolume")||an(t,"vtkImageSlice")}function an(t,e){return!!("isA"in t?t:t.actor).isA(e)}function ps(t,e){const{direction:n,spacing:r}=t,a=n.slice(0,3),i=n.slice(3,6),s=n.slice(6,9),o=[Ve(a,e),Ve(i,e),Ve(s,e)],c=ne();return Ee(c,o[0]*r[0],o[1]*r[1],o[2]*r[2]),ua(c)}function Pl(t,e,n){const{direction:r,spacing:a,imageIds:i}=t;if(!i.length)return;const s=r.slice(6,9),o=Ve(s,n);if(Math.abs(o)<1-Ir)return;const l=ps({direction:r,spacing:a},n)/2;let f;for(let u=0;u<i.length;u++){const g=i[u],{imagePositionPatient:p}=Z("imagePlaneModule",g),h=ne();jt(h,e,p);const d=Ve(h,n);Math.abs(d)<l&&(f=g)}return f}const LN=t=>t,lh=1e-6;let d7=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=te(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?mx:LN}rotateFromDirections(e,n){const r=new Float64Array(3),a=new Float64Array(3),i=new Float64Array(16);Ee(r,e[0],e[1],e[2]),Ee(a,n[0],n[1],n[2]),kt(r,r),kt(a,a);const s=Ve(r,a);return s>=1?this:(ut(this.tmp,r,a),ua(this.tmp)<lh&&(ut(this.tmp,[1,0,0],e),ua(this.tmp)<lh&&ut(this.tmp,[0,1,0],e)),Og(i,Math.acos(s),this.tmp),ge(this.matrix,this.matrix,i),this)}rotate(e,n){return Ee(this.tmp,...n),kt(this.tmp,this.tmp),_n(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return Sg(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return wg(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return Eg(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return Ee(this.tmp,e,n,r),at(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return Ee(this.tmp,e,n,r),Nr(this.matrix,this.matrix,this.tmp),this}multiply(e){return ge(this.matrix,this.matrix,e),this}multiply3x3(e){return ge(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return lt(this.matrix,this.matrix),this}identity(){return te(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(d0($g,this.matrix))return this;const a=r===-1?e.length:n+r*3;for(let i=n;i<a;i+=3)Ee(this.tmp,e[i],e[i+1],e[i+2]),Re(this.tmp,this.tmp,this.matrix),e[i]=this.tmp[0],e[i+1]=this.tmp[1],e[i+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&Ze(this.matrix,e),this}};function _N(){return new d7(!0)}function NN(){return new d7(!1)}var Ha={buildFromDegree:_N,buildFromRadian:NN};function h7(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}const IN=Ir*Ir,Df=t=>Math.abs(Math.abs(t)-1)<IN,Vf=(t,e)=>Df(t[e])||Df(t[e+1])||Df(t[e+2]),FN=t=>Vf(t,0)&&Vf(t,3)&&Vf(t,6);function Mu(t,e,n){const r=t.getMapper().getInputData();let a;const i=r.getDirection();if(FN(i))a=h7(t);else{const[u,g,p]=r.getDimensions();a=[[0,0,0],[u-1,0,0],[0,g-1,0],[u-1,g-1,0],[0,0,p-1],[u-1,0,p-1],[0,g-1,p-1],[u-1,g-1,p-1]].map(d=>r.indexToWorld(d))}const s=Ha.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);a.forEach(u=>s.apply(u));const o=[...n];s.apply(o);const c=o[0];let l=1/0,f=-1/0;for(let u=0;u<8;u++){const g=a[u][0];g>f&&(f=g),g<l&&(l=g)}return{min:l,max:f,current:c,actor:t,viewPlaneNormal:e,focalPoint:n}}function es(t,e,n,r,a,i){const{min:s,max:o,current:c}=n,l=ne();jt(l,e,t);const f=Math.round((o-s)/a),g=(c-s)/(o-s)*f;let p=Math.round(g),h=[t[0]-r[0]*g*a,t[1]-r[1]*g*a,t[2]-r[2]*g*a];p+=i,p>f?p=f:p<0&&(p=0);const d=p*a;h=[h[0]+r[0]*d,h[1]+r[1]*d,h[2]+r[2]*d];const m=[h[0]+l[0],h[1]+l[1],h[2]+l[2]];return{newFocalPoint:h,newPosition:m}}const kN={RGB:0,HSV:1,LAB:2,DIVERGING:3},UN={LINEAR:0,LOG10:1};var m7={ColorSpace:kN,Scale:UN};const{ColorSpace:xn,Scale:S5}=m7,{ScalarMappingTarget:ic}=d5,{vtkDebugMacro:PN,vtkErrorMacro:fr,vtkWarningMacro:bN}=O;function uh(t,e){const n=t[0],r=t[1],a=t[2],i=Math.sqrt(n*n+r*r+a*a),s=i>.001?Math.acos(n/i):0,o=s>.001?Math.atan2(a,r):0;e[0]=i,e[1]=s,e[2]=o}function GN(t,e){const n=t[0],r=t[1],a=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(a),e[2]=n*Math.sin(r)*Math.sin(a)}function fh(t,e){if(t[0]>=e-.1)return t[2];const n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function BN(t,e){let n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function gh(t,e,n,r){const a=[],i=[];ja(e,a),ja(n,i);const s=[],o=[];uh(a,s),uh(i,o);let c=t;if(s[1]>.05&&o[1]>.05&&BN(s[2],o[2])>.33*Math.PI){let u=Math.max(s[0],o[0]);u=Math.max(88,u),t<.5?(o[0]=u,o[1]=0,o[2]=0,c*=2):(s[0]=u,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&o[1]>.05?s[2]=fh(o,s[0]):o[1]<.05&&s[1]>.05&&(o[2]=fh(s,o[0]));const l=[];l[0]=(1-c)*s[0]+c*o[0],l[1]=(1-c)*s[1]+c*o[1],l[2]=(1-c)*s[2]+c*o[2];const f=[];GN(l,f),Dl(f,r)}function AN(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(n,r,a,i)=>t.addRGBPointLong(n,r,a,i,.5,0),t.addRGBPointLong=function(n,r,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(s<0||s>1)return fr("Midpoint outside range [0.0, 1.0]"),-1;if(o<0||o>1)return fr("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const c={x:n,r,g:a,b:i,midpoint:s,sharpness:o};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==n;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(n,r,a,i)=>t.addHSVPointLong(n,r,a,i,.5,0),t.addHSVPointLong=function(n,r,a,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return Pa([r,a,i],c),t.addRGBPoint(n,c[0],c[1],c[2],s,o)},t.setNodes=n=>{if(e.nodes!==n){const r=JSON.stringify(e.nodes);e.nodes=n;const a=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==a)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const n=JSON.stringify(e.nodes);e.nodes.sort((i,s)=>i.x-s.x);const r=JSON.stringify(e.nodes),a=t.updateRange();return!a&&n!==r?(t.modified(),!0):a},t.updateRange=()=>{const n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];const r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r=0;for(;r<e.nodes.length&&e.nodes[r].x!==n;r++);const a=r;if(r>=e.nodes.length)return-1;let i=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(i=t.updateRange()),i||t.modified(),a},t.movePoint=(n,r)=>{if(n!==r){t.removePoint(r);for(let a=0;a<e.nodes.length;a++)if(e.nodes[a].x===n){e.nodes[a].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(n,r,a,i,s,o,c,l)=>{t.sortAndUpdateRange();for(let f=0;f<e.nodes.length;)e.nodes[f].x>=n&&e.nodes[f].x<=s?e.nodes.splice(f,1):f++;t.addRGBPointLong(n,r,a,i,.5,0),t.addRGBPointLong(s,o,c,l,.5,0),t.modified()},t.addHSVSegment=(n,r,a,i,s,o,c,l)=>{const f=[r,a,i],u=[o,c,l],g=[],p=[];Pa(f,g),Pa(u,p),t.addRGBSegment(n,g[0],g[1],g[2],s,p[0],p[1],p[2])},t.mapValue=n=>{const r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=(n,r)=>{if(e.indexedLookup){const a=t.getSize(),i=t.getAnnotatedValueIndexInternal(n);if(i<0||a===0){const s=t.getNanColorByReference();r[0]=s[0],r[1]=s[1],r[2]=s[2]}else{const s=[];t.getNodeValue(i%a,s),r[0]=s[1],r[1]=s[2],r[2]=s[3]}return}t.getTable(n,n,1,r)},t.getRedValue=n=>{const r=[];return t.getColor(n,r),r[0]},t.getGreenValue=n=>{const r=[];return t.getColor(n,r),r[1]},t.getBlueValue=n=>{const r=[];return t.getColor(n,r),r[2]},t.getTable=(n,r,a,i)=>{const s=Number(n),o=Number(r);if(Vl(s)||Vl(o)){for(let L=0;L<a;L++)i[L*3+0]=e.nanColor[0],i[L*3+1]=e.nanColor[1],i[L*3+2]=e.nanColor[2];return}let c=0;const l=e.nodes.length;let f=0,u=0,g=0;l!==0&&(f=e.nodes[l-1].r,u=e.nodes[l-1].g,g=e.nodes[l-1].b);let p=0,h=0,d=0;const m=[0,0,0],v=[0,0,0];let C=0,y=0;const T=[];let x=e.scale===S5.LOG10;x&&(x=e.mappingRange[0]>0);let S=0,w=0,E=0;x&&(S=Math.log10(s),w=Math.log10(o));for(let L=0;L<a;L++){const R=3*L;if(a>1?x?(E=S+L/(a-1)*(w-S),p=10**E):p=s+L/(a-1)*(o-s):x?(E=.5*(S+w),p=10**E):p=.5*(s+o),e.discretize){const D=e.mappingRange;if(p>=D[0]&&p<=D[1]){const I=e.numberOfValues,b=D[1]-D[0];if(I<=1)p=D[0]+b/2;else{const F=(p-D[0])/b,W=Kg(I*F);p=D[0]+W/(I-1)*b}}}for(;c<l&&p>e.nodes[c].x;)c++,c<l&&(h=e.nodes[c-1].x,d=e.nodes[c].x,x&&(h=Math.log10(h),d=Math.log10(d)),m[0]=e.nodes[c-1].r,v[0]=e.nodes[c].r,m[1]=e.nodes[c-1].g,v[1]=e.nodes[c].g,m[2]=e.nodes[c-1].b,v[2]=e.nodes[c].b,C=e.nodes[c-1].midpoint,y=e.nodes[c-1].sharpness,C<1e-5&&(C=1e-5),C>.99999&&(C=.99999));if(p>e.mappingRange[1])i[R]=0,i[R+1]=0,i[R+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(i[R]=e.aboveRangeColor[0],i[R+1]=e.aboveRangeColor[1],i[R+2]=e.aboveRangeColor[2]):(i[R]=f,i[R+1]=u,i[R+2]=g));else if(p<e.mappingRange[0]||K9(p)&&p<0)i[R]=0,i[R+1]=0,i[R+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(i[R]=e.belowRangeColor[0],i[R+1]=e.belowRangeColor[1],i[R+2]=e.belowRangeColor[2]):l>0&&(i[R]=e.nodes[0].r,i[R+1]=e.nodes[0].g,i[R+2]=e.nodes[0].b));else if(c===0&&(Math.abs(p-s)<1e-6||e.discretize))l>0?(i[R]=e.nodes[0].r,i[R+1]=e.nodes[0].g,i[R+2]=e.nodes[0].b):(i[R]=0,i[R+1]=0,i[R+2]=0);else{let D=0;if(x?D=(E-h)/(d-h):D=(p-h)/(d-h),D<C?D=.5*D/C:D=.5+.5*(D-C)/(1-C),y>.99)if(D<.5){i[R]=m[0],i[R+1]=m[1],i[R+2]=m[2];continue}else{i[R]=v[0],i[R+1]=v[1],i[R+2]=v[2];continue}if(y<.01){if(e.colorSpace===xn.RGB)i[R]=(1-D)*m[0]+D*v[0],i[R+1]=(1-D)*m[1]+D*v[1],i[R+2]=(1-D)*m[2]+D*v[2];else if(e.colorSpace===xn.HSV){const k=[],z=[];Js(m,k),Js(v,z),e.hSVWrap&&(k[0]-z[0]>.5||z[0]-k[0]>.5)&&(k[0]>z[0]?k[0]-=1:z[0]-=1);const j=[];j[0]=(1-D)*k[0]+D*z[0],j[0]<0&&(j[0]+=1),j[1]=(1-D)*k[1]+D*z[1],j[2]=(1-D)*k[2]+D*z[2],Pa(j,T),i[R]=T[0],i[R+1]=T[1],i[R+2]=T[2]}else if(e.colorSpace===xn.LAB){const k=[],z=[];ja(m,k),ja(v,z);const j=[];j[0]=(1-D)*k[0]+D*z[0],j[1]=(1-D)*k[1]+D*z[1],j[2]=(1-D)*k[2]+D*z[2],Dl(j,T),i[R]=T[0],i[R+1]=T[1],i[R+2]=T[2]}else e.colorSpace===xn.DIVERGING?(gh(D,m,v,T),i[R]=T[0],i[R+1]=T[1],i[R+2]=T[2]):fr("ColorSpace set to invalid value.",e.colorSpace);continue}D<.5?D=.5*(D*2)**(1+10*y):D>.5&&(D=1-.5*((1-D)*2)**(1+10*y));const I=D*D,b=I*D,F=2*b-3*I+1,W=-2*b+3*I,P=b-2*I+D,K=b-I;let U,N;if(e.colorSpace===xn.RGB)for(let k=0;k<3;k++)U=v[k]-m[k],N=(1-y)*U,i[R+k]=F*m[k]+W*v[k]+P*N+K*N;else if(e.colorSpace===xn.HSV){const k=[],z=[];Js(m,k),Js(v,z),e.hSVWrap&&(k[0]-z[0]>.5||z[0]-k[0]>.5)&&(k[0]>z[0]?k[0]-=1:z[0]-=1);const j=[];for(let $=0;$<3;$++)U=z[$]-k[$],N=(1-y)*U,j[$]=F*k[$]+W*z[$]+P*N+K*N,$===0&&j[$]<0&&(j[$]+=1);Pa(j,T),i[R]=T[0],i[R+1]=T[1],i[R+2]=T[2]}else if(e.colorSpace===xn.LAB){const k=[],z=[];ja(m,k),ja(v,z);const j=[];for(let $=0;$<3;$++)U=z[$]-k[$],N=(1-y)*U,j[$]=F*k[$]+W*z[$]+P*N+K*N;Dl(j,T),i[R]=T[0],i[R+1]=T[1],i[R+2]=T[2]}else e.colorSpace===xn.DIVERGING?(gh(D,m,v,T),i[R]=T[0],i[R+1]=T[1],i[R+2]=T[2]):fr("ColorSpace set to invalid value.");for(let k=0;k<3;k++)i[R+k]=i[R+k]<0?0:i[R+k],i[R+k]=i[R+k]>1?1:i[R+k]}}},t.getUint8Table=function(n,r,a){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===a&&e.tableWithAlpha!==i)return e.table;if(e.nodes.length===0)return fr("Attempting to lookup a value with no points in the function"),e.table;const s=i?4:3;(e.tableSize!==a||e.tableWithAlpha!==i)&&(e.table=new Uint8Array(a*s),e.tableSize=a,e.tableWithAlpha=i);const o=[];t.getTable(n,r,a,o);for(let c=0;c<a;c++)e.table[c*s+0]=Math.floor(o[c*3+0]*255+.5),e.table[c*s+1]=Math.floor(o[c*3+1]*255+.5),e.table[c*s+2]=Math.floor(o[c*3+2]*255+.5),i&&(e.table[c*s+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=n=>{t.removeAllPoints();const r=n.getNumberOfComponents();for(let a=0;a<n.getNumberOfTuples();a++)switch(r){case 3:{e.nodes.push({x:a,r:n.getComponent(a,0),g:n.getComponent(a,1),b:n.getComponent(a,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:n.getComponent(a,0),r:n.getComponent(a,1),g:n.getComponent(a,2),b:n.getComponent(a,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:a,r:n.getComponent(a,0),g:n.getComponent(a,1),b:n.getComponent(a,2),midpoint:n.getComponent(a,4),sharpness:n.getComponent(a,5)});break}case 6:{e.nodes.push({x:n.getComponent(a,0),r:n.getComponent(a,1),g:n.getComponent(a,2),b:n.getComponent(a,3),midpoint:n.getComponent(a,4),sharpness:n.getComponent(a,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(n,r,a,i)=>{let s=0;t.removeAllPoints(),a>1&&(s=(r-n)/(a-1));for(let o=0;o<a;o++){const c={x:n+s*o,r:i[o*3],g:i[o*3+1],b:i[o*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(n,r)=>n<0||n>=e.nodes.length?(fr("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1),t.setNodeValue=(n,r)=>{if(n<0||n>=e.nodes.length)return fr("Index out of range!"),-1;const a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{var r;if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const n=((r=e.nodes)==null?void 0:r.length)??0;return Math.max(4094,n)},t.getIndexedColor=(n,r)=>{const a=t.getSize();if(a>0&&n>=0){const s=[];t.getNodeValue(n%a,s);for(let o=0;o<3;++o)r[o]=s[o+1];r[3]=1;return}const i=t.getNanColorByReference();r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1},t.fillFromDataPointer=(n,r)=>{if(!(n<=0||!r)){t.removeAllPoints();for(let a=0;a<n;a++)t.addRGBPoint(r[a*4],r[a*4+1],r[a*4+2],r[a*4+3])}},t.setMappingRange=(n,r)=>{const a=[n,r],i=t.getRange();if(i[1]===a[1]&&i[0]===a[0])return;if(a[1]===a[0]){fr("attempt to set zero width color range");return}const s=(a[1]-a[0])/(i[1]-i[0]),o=a[0]-i[0]*s;for(let c=0;c<e.nodes.length;++c)e.nodes[c].x=e.nodes[c].x*s+o;e.mappingRange[0]=a[0],e.mappingRange[1]=a[1],t.modified()},t.adjustRange=n=>{const r=t.getRange(),a=[];r[0]<n[0]?(t.getColor(n[0],a),t.addRGBPoint(n[0],a[0],a[1],a[2])):(t.getColor(r[0],a),t.addRGBPoint(n[0],a[0],a[1],a[2])),r[1]>n[1]?(t.getColor(n[1],a),t.addRGBPoint(n[1],a[0],a[1],a[2])):(t.getColor(r[1],a),t.addRGBPoint(n[1],a[0],a[1],a[2])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return 1},t.estimateMinNumberOfSamples=(n,r)=>{const a=t.findMinimumXDistance();return Math.ceil((r-n)/a)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let n=Number.MAX_VALUE;for(let r=0;r<e.nodes.length-1;r++){const a=e.nodes[r+1].x-e.nodes[r].x;a<n&&(n=a)}return n},t.mapScalarsThroughTable=(n,r,a,i)=>{if(t.getSize()===0){PN("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,a,i):t.mapData(n,r,a,i)},t.mapData=(n,r,a,i)=>{if(t.getSize()===0){bN("Transfer Function Has No Points!");return}const s=Math.floor(t.getAlpha()*255+.5),o=n.getNumberOfTuples(),c=n.getNumberOfComponents(),l=r.getData(),f=n.getData(),u=[];if(a===ic.RGBA)for(let g=0;g<o;g++){const p=f[g*c+i];t.getColor(p,u),l[g*4]=Math.floor(u[0]*255+.5),l[g*4+1]=Math.floor(u[1]*255+.5),l[g*4+2]=Math.floor(u[2]*255+.5),l[g*4+3]=s}if(a===ic.RGB)for(let g=0;g<o;g++){const p=f[g*c+i];t.getColor(p,u),l[g*3]=Math.floor(u[0]*255+.5),l[g*3+1]=Math.floor(u[1]*255+.5),l[g*3+2]=Math.floor(u[2]*255+.5)}if(a===ic.LUMINANCE)for(let g=0;g<o;g++){const p=f[g*c+i];t.getColor(p,u),l[g]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(a===ic.LUMINANCE_ALPHA)for(let g=0;g<o;g++){const p=f[g*c+i];t.getColor(p,u),l[g*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),l[g*2+1]=s}},t.applyColorMap=n=>{const r=JSON.stringify(e.colorSpace);n.ColorSpace&&(e.colorSpace=xn[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(fr(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),e.colorSpace=xn.RGB));let a=r!==JSON.stringify(e.colorSpace);const i=a||JSON.stringify(e.nanColor);if(n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);a=a||i!==JSON.stringify(e.nanColor);const s=a||JSON.stringify(e.nodes);if(n.RGBPoints){const l=n.RGBPoints.length;e.nodes=[];const f=.5,u=0;for(let g=0;g<l;g+=4)e.nodes.push({x:n.RGBPoints[g],r:n.RGBPoints[g+1],g:n.RGBPoints[g+2],b:n.RGBPoints[g+3],midpoint:f,sharpness:u})}const o=t.sortAndUpdateRange(),c=!o&&(a||s!==JSON.stringify(e.nodes));return c&&t.modified(),o||c}}const WN={clamping:!0,colorSpace:xn.RGB,hSVWrap:!0,scale:S5.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function v7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WN,n),d5.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},O.obj(e.buildTime),O.get(t,e,["buildTime","mappingRange"]),O.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:xn},{type:"enum",name:"scale",enum:S5}]),O.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),O.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),AN(t,e)}const zN=O.newInstance(v7,"vtkColorTransferFunction");var fi={newInstance:zN,extend:v7,...m7},$N=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const ds=Object.create(null);$N.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{ds[t.Name]=t});const hs=Object.keys(ds);hs.sort();function jN(t){return ds[t]}function HN(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(ds[t.Name]||(hs.push(t.Name),hs.sort()),ds[t.Name]=t)}function KN(t){const e=hs.indexOf(t);e>-1&&hs.splice(e,1),delete ds[t]}var bl={addPreset:HN,removePresetByName:KN,getPresetByName:jN,rgbPresetNames:hs};function y0(t){return Ho.get(t)}function Du(){return Ho.getAll()}const Gl=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",qN=t=>Array.isArray(t)?[]:{},Yo=(t,e)=>e&&e.clone===!0&&Gl(t)?C0(qN(t),t,e):t,ph=(t,e,n)=>{const r=t.slice();return e.forEach(function(a,i){typeof r[i]>"u"?r[i]=Yo(a,n):Gl(a)?r[i]=C0(t[i],a,n):t.indexOf(a)===-1&&(r[i]=Yo(a,n))}),r},XN=(t,e,n)=>{const r={};return Gl(t)&&Object.keys(t).forEach(function(a){r[a]=Yo(t[a],n)}),Object.keys(e).forEach(function(a){!Gl(e[a])||!t[a]?r[a]=Yo(e[a],n):r[a]=C0(t[a],e[a],n)}),r},C0=(t={},e={},n=void 0)=>{const r=Array.isArray(e),i=(n||{arrayMerge:ph}).arrayMerge||ph;return r?Array.isArray(t)?i(t,e,n):Yo(e,n):XN(t,e,n)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const y7=Symbol("Comlink.proxy"),YN=Symbol("Comlink.endpoint"),C7=Symbol("Comlink.releaseProxy"),Lf=Symbol("Comlink.finalizer"),Bc=Symbol("Comlink.thrown"),T7=t=>typeof t=="object"&&t!==null||typeof t=="function",ZN={canHandle:t=>T7(t)&&t[y7],serialize(t){const{port1:e,port2:n}=new MessageChannel;return S7(t,e),[n,[n]]},deserialize(t){return t.start(),u2(t)}},QN={canHandle:t=>T7(t)&&Bc in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},x7=new Map([["proxy",ZN],["throw",QN]]);function JN(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function S7(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(a){if(!a||!a.data)return;if(!JN(n,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:i,type:s,path:o}=Object.assign({path:[]},a.data),c=(a.data.argumentList||[]).map(Ga);let l;try{const f=o.slice(0,-1).reduce((g,p)=>g[p],t),u=o.reduce((g,p)=>g[p],t);switch(s){case"GET":l=u;break;case"SET":f[o.slice(-1)[0]]=Ga(a.data.value),l=!0;break;case"APPLY":l=u.apply(f,c);break;case"CONSTRUCT":{const g=new u(...c);l=O7(g)}break;case"ENDPOINT":{const{port1:g,port2:p}=new MessageChannel;S7(t,p),l=aI(g,[g])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[Bc]:0}}Promise.resolve(l).catch(f=>({value:f,[Bc]:0})).then(f=>{const[u,g]=Wl(f);e.postMessage(Object.assign(Object.assign({},u),{id:i}),g),s==="RELEASE"&&(e.removeEventListener("message",r),w7(e),Lf in t&&typeof t[Lf]=="function"&&t[Lf]())}).catch(f=>{const[u,g]=Wl({value:new TypeError("Unserializable return value"),[Bc]:0});e.postMessage(Object.assign(Object.assign({},u),{id:i}),g)})}),e.start&&e.start()}function eI(t){return t.constructor.name==="MessagePort"}function w7(t){eI(t)&&t.close()}function u2(t,e){const n=new Map;return t.addEventListener("message",function(a){const{data:i}=a;if(!i||!i.id)return;const s=n.get(i.id);if(s)try{s(i)}finally{n.delete(i.id)}}),f2(t,n,[],e)}function sc(t){if(t)throw new Error("Proxy has been released and is not useable")}function E7(t){return Mi(t,new Map,{type:"RELEASE"}).then(()=>{w7(t)})}const Bl=new WeakMap,Al="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Bl.get(t)||0)-1;Bl.set(t,e),e===0&&E7(t)});function tI(t,e){const n=(Bl.get(e)||0)+1;Bl.set(e,n),Al&&Al.register(t,e,t)}function nI(t){Al&&Al.unregister(t)}function f2(t,e,n=[],r=function(){}){let a=!1;const i=new Proxy(r,{get(s,o){if(sc(a),o===C7)return()=>{nI(i),E7(t),e.clear(),a=!0};if(o==="then"){if(n.length===0)return{then:()=>i};const c=Mi(t,e,{type:"GET",path:n.map(l=>l.toString())}).then(Ga);return c.then.bind(c)}return f2(t,e,[...n,o])},set(s,o,c){sc(a);const[l,f]=Wl(c);return Mi(t,e,{type:"SET",path:[...n,o].map(u=>u.toString()),value:l},f).then(Ga)},apply(s,o,c){sc(a);const l=n[n.length-1];if(l===YN)return Mi(t,e,{type:"ENDPOINT"}).then(Ga);if(l==="bind")return f2(t,e,n.slice(0,-1));const[f,u]=dh(c);return Mi(t,e,{type:"APPLY",path:n.map(g=>g.toString()),argumentList:f},u).then(Ga)},construct(s,o){sc(a);const[c,l]=dh(o);return Mi(t,e,{type:"CONSTRUCT",path:n.map(f=>f.toString()),argumentList:c},l).then(Ga)}});return tI(i,t),i}function rI(t){return Array.prototype.concat.apply([],t)}function dh(t){const e=t.map(Wl);return[e.map(n=>n[0]),rI(e.map(n=>n[1]))]}const R7=new WeakMap;function aI(t,e){return R7.set(t,e),t}function O7(t){return Object.assign(t,{[y7]:!0})}function Wl(t){for(const[e,n]of x7)if(n.canHandle(t)){const[r,a]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},a]}return[{type:"RAW",value:t},R7.get(t)||[]]}function Ga(t){switch(t.type){case"HANDLER":return x7.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Mi(t,e,n,r){return new Promise(a=>{const i=iI();e.set(i,a),t.start&&t.start(),t.postMessage(Object.assign({id:i},n),r)})}function iI(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class M7{constructor(){this.workerRegistry={},this.workerPoolManager=new Lg("webworker")}registerWorker(e,n,r={}){var c;const{maxWorkerInstances:a=1,overwrite:i=!1,autoTerminateOnIdle:s={enabled:!1,idleTimeThreshold:3e3}}=r;if(this.workerRegistry[e]&&!i){console.warn(`Worker type '${e}' is already registered...`);return}i&&((c=this.workerRegistry[e])!=null&&c.idleCheckIntervalId)&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const o={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:s.enabled,idleCheckIntervalId:null,idleTimeThreshold:s.idleTimeThreshold};o.loadCounters=Array(a).fill(0),o.lastActiveTime=Array(a).fill(null);for(let l=0;l<a;l++){const f=n();o.instances.push(u2(f)),o.nativeWorkers.push(f),o.workerFn=n}this.workerRegistry[e]=o}getNextWorkerAPI(e){const n=this.workerRegistry[e];if(!n)return console.error(`Worker type '${e}' is not registered.`),null;const r=n.instances.filter(s=>s!==null);let a=0,i=n.loadCounters[0]||0;for(let s=1;s<r.length;s++){const o=n.loadCounters[s]||0;o<i&&(a=s,i=o)}if(n.instances[a]===null){const s=n.workerFn();n.instances[a]=u2(s),n.nativeWorkers[a]=s}return n.loadCounters[a]+=1,{api:n.instances[a],index:a}}executeTask(e,n,r={},{requestType:a=se.Compute,priority:i=0,options:s={},callbacks:o=[]}={}){return new Promise((c,l)=>{const f=async()=>{const{api:u,index:g}=this.getNextWorkerAPI(e);if(!u){const p=new Error(`No available worker instance for '${e}'`);console.error(p),l(p);return}try{let p=[];o.length&&(p=o.map(m=>O7(m)));const h=this.workerRegistry[e];h.processing=!0;const d=await u[n](r,...p);h.processing=!1,h.lastActiveTime[g]=Date.now(),h.autoTerminateOnIdle&&!h.idleCheckIntervalId&&h.idleTimeThreshold&&(h.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,h.idleTimeThreshold)},h.idleTimeThreshold)),c(d)}catch(p){console.error(`Error executing method '${n}' on worker '${e}':`,p),l(p)}finally{this.workerRegistry[e].loadCounters[g]--}};this.workerPoolManager.addRequest(f,a,s,i)})}terminateIdleWorkers(e,n){const r=this.workerRegistry[e];if(r.processing)return;const a=Date.now();r.instances.forEach((i,s)=>{const o=r.lastActiveTime[s],c=o!==null&&r.loadCounters[s]>0,l=a-o;!c&&l>n&&this.terminateWorkerInstance(e,s)})}terminate(e){const n=this.workerRegistry[e];if(!n){console.error(`Worker type '${e}' is not registered.`);return}n.instances.forEach((r,a)=>{this.terminateWorkerInstance(e,a)})}terminateWorkerInstance(e,n){const r=this.workerRegistry[e],a=r.instances[n];a!==null&&(a[C7](),r.nativeWorkers[n].terminate(),r.instances[n]=null,r.lastActiveTime[n]=null)}}let ro=!1;const g2={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,strictZSpacingForVolumeViewport:!0},peerImport:t=>null};let Ka={...g2,rendering:{...g2.rendering}},yo=null;function sI(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function oI(){const t=sI();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function D7(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function cI(t=Ka){var n;return ro||(Ka=C0(g2,t),D7()&&((n=t.rendering)!=null&&n.preferSizeOverAccuracy?Ka.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),oI()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),Ka.rendering.useCPURendering=!0),ro=!0,yo||(yo=new M7),ro)}function w5(){return!D7()}function Co(){return Ka.rendering.useCPURendering}function V7(){return ro}function E5(){return Ka}function L7(){return yo||(yo=new M7),yo}function lI(t){return Ka.peerImport(t)}const R5=new Map;function uI(t){R5.set(t.Name,t)}function Zo(t){return R5.get(t)}function _7(){return Array.from(R5.keys())}function O5(t,e){const n=bl.rgbPresetNames.map(o=>bl.getPresetByName(o)),r=_7().map(o=>Zo(o)),i=n.concat(r).find(o=>{const{RGBPoints:c}=o;if(c.length!==t.length)return!1;for(let l=0;l<c.length;l+=4)if(!yt(c.slice(l+1,l+4),t.slice(l+1,l+4)))return!1;return!0});if(!i)return null;const s=[];if(an(e,"vtkVolume")){const o=e.getProperty().getScalarOpacity(0).getDataPointer();if(!o)return{name:i.Name};for(let c=0;c<o.length;c+=2)s.push({value:o[c],opacity:o[c+1]})}return{name:i.Name,opacity:s}}const fI=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:O5,getColormap:Zo,getColormapNames:_7,registerColormap:uI},Symbol.toStringTag,{value:"Module"}));function To(t){if(!t)return;const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}function M5(t,e){const n=Math.abs(e-t)+1,r=(t+e+1)/2;return{windowWidth:n,windowCenter:r}}function xo(t,e){const n=e-.5-(t-1)/2,r=e-.5+(t-1)/2;return{lower:n,upper:r}}const gI=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:xo,toWindowLevel:M5},Symbol.toStringTag,{value:"Module"}));function D5(t,e=1024){const{windowWidth:n,windowCenter:r}=M5(t.lower,t.upper),a=(c,l,f)=>l-f/4*Math.log((1-c)/c),s=Array.from({length:e},(c,l)=>(l+1)/(e+2)).flatMap(c=>[a(c,r,n),c,c,c,.5,0]),o=fi.newInstance();return o.buildFunctionFromArray(le.newInstance({values:s,numberOfComponents:6})),o}function V5(t,e){return t.worldToIndex(e).map(Math.round)}function zl(t){const e=t.getSize(),n=[];for(let r=0;r<e;r++){const a=[];t.getNodeValue(r,a),n.push(a)}return n}function Vu(t,e){e!=null&&e.length&&(t.removeAllPoints(),e.forEach(n=>{t.addRGBPoint(...n)}))}const pI=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:zl,setTransferFunctionNodes:Vu},Symbol.toStringTag,{value:"Module"})),{InterpolationType:ao,OpacityMode:dI}=Fm,{vtkErrorMacro:_f}=O,Ac=4;function hI(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=()=>{let a=e.mtime,i;for(let s=0;s<Ac;s++)e.componentData[s].colorChannels===1?e.componentData[s].grayTransferFunction&&(i=e.componentData[s].grayTransferFunction.getMTime(),a=a>i?a:i):e.componentData[s].colorChannels===3&&e.componentData[s].rGBTransferFunction&&(i=e.componentData[s].rGBTransferFunction.getMTime(),a=a>i?a:i),e.componentData[s].scalarOpacity&&(i=e.componentData[s].scalarOpacity.getMTime(),a=a>i?a:i),e.componentData[s].gradientOpacity&&(e.componentData[s].disableGradientOpacity||(i=e.componentData[s].gradientOpacity.getMTime(),a=a>i?a:i));return a},t.getColorChannels=a=>a<0||a>3?(_f("Bad index - must be between 0 and 3"),0):e.componentData[a].colorChannels,t.setGrayTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[a].grayTransferFunction!==i&&(e.componentData[a].grayTransferFunction=i,s=!0),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1,s=!0),s&&t.modified(),s},t.getGrayTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[a].grayTransferFunction===null&&(e.componentData[a].grayTransferFunction=Xo.newInstance(),e.componentData[a].grayTransferFunction.addPoint(0,0),e.componentData[a].grayTransferFunction.addPoint(1024,1),e.componentData[a].colorChannels!==1&&(e.componentData[a].colorChannels=1),t.modified()),e.componentData[a].grayTransferFunction},t.setRGBTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[a].rGBTransferFunction!==i&&(e.componentData[a].rGBTransferFunction=i,s=!0),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3,s=!0),s&&t.modified(),s},t.getRGBTransferFunction=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[a].rGBTransferFunction===null&&(e.componentData[a].rGBTransferFunction=fi.newInstance(),e.componentData[a].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[a].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[a].colorChannels!==3&&(e.componentData[a].colorChannels=3),t.modified()),e.componentData[a].rGBTransferFunction},t.setScalarOpacity=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[a].scalarOpacity!==i?(e.componentData[a].scalarOpacity=i,t.modified(),!0):!1},t.getScalarOpacity=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[a].scalarOpacity===null&&(e.componentData[a].scalarOpacity=Xo.newInstance(),e.componentData[a].scalarOpacity.addPoint(0,1),e.componentData[a].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[a].scalarOpacity},t.setComponentWeight=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(a<0||a>=Ac)return _f("Invalid index"),!1;const s=Math.min(1,Math.max(0,i));return e.componentData[a].componentWeight!==s?(e.componentData[a].componentWeight=s,t.modified(),!0):!1},t.getComponentWeight=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return a<0||a>=Ac?(_f("Invalid index"),0):e.componentData[a].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(ao.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(ao.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(ao.FAST_LINEAR),t.getInterpolationTypeAsString=()=>O.enumToString(ao,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(a=>{const i=O.capitalize(a);t[`set${i}`]=(s,o)=>e.componentData[s][`${a}`]!==o?(e.componentData[s][`${a}`]=o,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(a=>{const i=O.capitalize(a);t[`get${i}`]=s=>e.componentData[s][`${a}`]})}const mI={colorMixPreset:null,independentComponents:!0,interpolationType:ao.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function vI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,mI,n),O.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<Ac;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:dI.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}O.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),O.setGetArray(t,e,["labelOutlineThickness"]),hI(t,e)}const yI=O.newInstance(vI,"vtkVolumeProperty");var CI={newInstance:yI,...Fm};const{vtkDebugMacro:TI}=O;function xI(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>t,t.makeProperty=CI.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=a=>a[0].map((i,s)=>a.map(o=>o[s]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((a,i)=>a&&i[0]===i[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){TI("Recomputing bounds..."),e.mapperBounds=n.map(s=>s);const a=[];_e.getCorners(n,a),t.computeMatrix();const i=new Float64Array(16);me(i,e.matrix),a.forEach(s=>Re(s,s,i)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((s,o)=>o%2===0?a.reduce((c,l)=>c>l[o/2]?l[o/2]:c,s):a.reduce((c,l)=>c<l[(o-1)/2]?l[(o-1)/2]:c,s)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}const SI={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function N7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SI,n),x5.extend(t,e,n),e.boundsMTime={},O.obj(e.boundsMTime),O.set(t,e,["property"]),O.setGet(t,e,["mapper"]),O.getArray(t,e,["bounds"],6),xI(t,e)}const wI=O.newInstance(N7,"vtkVolume");var EI={newInstance:wI,extend:N7};const{vtkErrorMacro:RI}=O;class OI{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const n=e[0],r=e[e.length-1];if(n===r||e.length<2)return;const a=this.segmentMapping[n],i=this.segmentMapping[r];if(a!==void 0&&i!==void 0)if(Math.abs(a)===Math.abs(i)){const s=a<i?i:a,o=this.segments[s];if(a>0)for(let c=1;c<e.length-1;c++)o.push(e[c]);else for(let c=1;c<e.length-1;c++)o.unshift(e[e.length-1-c]);this.faces.push(o),this.segments[s]=null,this.segmentMapping[n]=void 0,this.segmentMapping[r]=void 0}else{const s=Math.abs(a),o=Math.abs(i),c=this.segments[s],l=this.segments[o];this.segments[s]=null,this.segments[o]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(a!==void 0){if(a>0){const s=this.segments[a];for(let o=1;o<e.length;o++)s.push(e[o]);this.segmentMapping[r]=a}else{const s=this.segments[-a];this.segmentMapping[r]=a;for(let o=1;o<e.length;o++)s.unshift(e[o])}this.segmentMapping[n]=void 0}else if(i!==void 0){if(i>0){const s=this.segments[i];for(let o=1;o<e.length;o++)s.push(e[e.length-1-o]);this.segmentMapping[n]=i}else{const s=this.segments[-i];this.segmentMapping[n]=i;for(let o=1;o<e.length;o++)s.unshift(e[e.length-o-1])}this.segmentMapping[r]=void 0}else{const s=this.segments.length;this.segments.push(e),this.segmentMapping[n]=-s,this.segmentMapping[r]=s}}}function MI(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(n,r)=>{const a=n[0];if(!a){RI("Invalid or missing input");return}const i=ei.newInstance();i.shallowCopy(a);const s=new OI,o=a.getLines().getData();let c=0;for(;c<o.length;){const g=o[c++],p=[];for(let h=0;h<g;h++)p.push(o[c+h]);s.addSegment(p),c+=g}const{faces:l}=s;let f=l.length;for(let g=0;g<l.length;g++)f+=l[g].length;const u=new Uint16Array(f);c=0;for(let g=0;g<l.length;g++){const p=l[g];u[c++]=p.length;for(let h=0;h<p.length;h++)u[c++]=p[h]}i.setPolys(qo.newInstance({values:u,name:"faces"})),r[0]=i}}const DI={};function I7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DI,n),O.obj(t,e),O.algo(t,e,1,1),MI(t,e)}const VI=O.newInstance(I7,"vtkClosedPolyLineToSurfaceFilter");var LI={newInstance:VI,extend:I7};const{vtkErrorMacro:hh}=bt;function _I(t){const e=t.getPolys().getData(),n=t.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<e.length){r.cellSize=e[r.polyIdx];const a=r.polyIdx+1,i=a+r.cellSize;r.polyIdx=i;let s=0;for(let o=a;o<i;++o)r.cell[s++]=e[o]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const a=r.stripIdx-2,i=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let s=0;for(let o=a;o<i;++o)r.cell[s++]=n[o]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function NI(t,e){e.classHierarchy.push("vtkCutter");const n={...t};t.getMTime=()=>{let a=n.getMTime();return e.cutFunction&&(a=Math.max(a,e.cutFunction.getMTime())),a};function r(a,i){const s=a.getPoints(),o=s.getData(),c=s.getNumberOfPoints(),l=[],f=[],u=[];(!e.cutScalars||e.cutScalars.length<c)&&(e.cutScalars=new Float32Array(c));let g=0,p=0;for(;g<o.length;)e.cutScalars[p++]=e.cutFunction.evaluateFunction(o[g++],o[g++],o[g++]);const h=[],d=new Array(3),m=new Array(3),v=[];for(const y=_I(a);!y.done;y.next()){if(y.cellSize<=2)continue;for(let E=0;E<y.cellSize;)v[E]=e.cutScalars[y.cell[E++]];const T=v[0]>0;let x=!0;for(let E=1;E<y.cell.length;E++)if(v[E]>0!==T){x=!1;break}if(x)continue;const S=[];for(let E=0;E<y.cellSize;E++){const L=E+1===y.cellSize?0:E+1,R=v[E]>0;if(v[L]>0===R)continue;let I=E,b=L,F=v[b]-v[I];F<=0&&(I=L,b=E,F*=-1);let W=0;F!==0&&(W=(e.cutValue-v[I])/F);const P=y.cell[I],K=y.cell[b];d[0]=o[P*3],d[1]=o[P*3+1],d[2]=o[P*3+2],m[0]=o[K*3],m[1]=o[K*3+1],m[2]=o[K*3+2];const U=[d[0]+W*(m[0]-d[0]),d[1]+W*(m[1]-d[1]),d[2]+W*(m[2]-d[2])];S.push({pointEdge1:P,pointEdge2:K,intersectedPoint:U,newPointID:-1})}for(let E=0;E<S.length;E++){const L=S[E];let R=!1;for(let D=0;D<h.length;D++){const I=h[D],b=L.pointEdge1===I.pointEdge1&&L.pointEdge2===I.pointEdge2,F=L.intersectedPoint[0]===I.intersectedPoint[0]&&L.intersectedPoint[1]===I.intersectedPoint[1]&&L.intersectedPoint[2]===I.intersectedPoint[2];if(b||F){R=!0,S[E].newPointID=h[D].newPointID;break}}R||(l.push(L.intersectedPoint[0]),l.push(L.intersectedPoint[1]),l.push(L.intersectedPoint[2]),S[E].newPointID=l.length/3-1,h.push(S[E]))}const w=S.length;w===2?f.push(w,S[0].newPointID,S[1].newPointID):w>2&&(u.push(w),S.forEach(E=>{u.push(E.newPointID)}))}i.getPoints().setData(mu(s.getDataType(),l),3),f.length!==0&&i.getLines().setData(Uint16Array.from(f)),u.length!==0&&i.getPolys().setData(Uint16Array.from(u))}t.requestData=(a,i)=>{const s=a[0];if(!s){hh("Invalid or missing input");return}if(!e.cutFunction){hh("Missing cut function");return}const o=ei.newInstance();r(s,o),i[0]=o}}const II={cutFunction:null,cutScalars:null,cutValue:0};function F7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,II,n),Ue(t,e),Fg(t,e,1,1),ft(t,e,["cutFunction","cutValue"]),NI(t,e)}const FI=Le(F7,"vtkCutter");var kI={newInstance:FI,extend:F7};const UI=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],PI=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function bI(t,e){e.classHierarchy.push("vtkCubeSource");function n(r,a){if(e.deleted)return;const i=ei.newInstance();a[0]=i;const s=24,o=O.newTypedArray(e.pointType,s*3);i.getPoints().setData(o,3);const c=O.newTypedArray(e.pointType,s*3),l=le.newInstance({name:"Normals",values:c,numberOfComponents:3});i.getPointData().setNormals(l);let f=2;e.generate3DTextureCoordinates===!0&&(f=3);const u=O.newTypedArray(e.pointType,s*f),g=le.newInstance({name:"TextureCoordinates",values:u,numberOfComponents:f});i.getPointData().setTCoords(g);const p=[0,0,0],h=[0,0,0],d=[0,0];let m=0;p[0]=-e.xLength/2,h[0]=-1,h[1]=0,h[2]=0;for(let v=0;v<2;v++){p[1]=-e.yLength/2;for(let C=0;C<2;C++){d[1]=p[1]+.5,p[2]=-e.zLength/2;for(let y=0;y<2;y++)d[0]=(p[2]+.5)*(1-2*v),o[m*3]=p[0],o[m*3+1]=p[1],o[m*3+2]=p[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=d[0],u[m*f+1]=d[1]):(u[m*f]=2*v-1,u[m*f+1]=2*C-1,u[m*f+2]=2*y-1),m++,p[2]+=e.zLength;p[1]+=e.yLength}p[0]+=e.xLength,h[0]+=2}p[1]=-e.yLength/2,h[1]=-1,h[0]=0,h[2]=0;for(let v=0;v<2;v++){p[0]=-e.xLength/2;for(let C=0;C<2;C++){d[0]=(p[0]+.5)*(2*v-1),p[2]=-e.zLength/2;for(let y=0;y<2;y++)d[1]=(p[2]+.5)*-1,o[m*3]=p[0],o[m*3+1]=p[1],o[m*3+2]=p[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=d[0],u[m*f+1]=d[1]):(u[m*f]=2*C-1,u[m*f+1]=2*v-1,u[m*f+2]=2*y-1),m++,p[2]+=e.zLength;p[0]+=e.xLength}p[1]+=e.yLength,h[1]+=2}p[2]=-e.zLength/2,h[2]=-1,h[0]=0,h[1]=0;for(let v=0;v<2;v++){p[1]=-e.yLength/2;for(let C=0;C<2;C++){d[1]=p[1]+.5,p[0]=-e.xLength/2;for(let y=0;y<2;y++)d[0]=(p[0]+.5)*(2*v-1),o[m*3]=p[0],o[m*3+1]=p[1],o[m*3+2]=p[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=d[0],u[m*f+1]=d[1]):(u[m*f]=2*y-1,u[m*f+1]=2*C-1,u[m*f+2]=2*v-1),m++,p[0]+=e.xLength;p[1]+=e.yLength}p[2]+=e.zLength,h[2]+=2}if(e.rotations&&Ha.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(o).apply(c),e.center&&Ha.buildFromRadian().translate(...e.center).apply(o),e.matrix){Ha.buildFromRadian().setMatrix(e.matrix).apply(o);const v=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];Ha.buildFromRadian().setMatrix(v).apply(c)}e.generateFaces?i.getPolys().deepCopy(e._polys):i.getPolys().initialize(),e.generateLines?(i.getLines().deepCopy(e._lineCells),i.getPointData().setNormals(null)):i.getLines().initialize(),i.modified()}t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let a=0;a<arguments.length;a++)r.push(a<0||arguments.length<=a?void 0:arguments[a]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))},t.requestData=n}const GI={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function k7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GI,n),O.obj(t,e),O.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),O.setGetArray(t,e,["center","rotations"],3),O.setGetArray(t,e,["matrix"],16),e._polys=qo.newInstance({values:Uint16Array.from(PI)}),e._lineCells=qo.newInstance({values:Uint16Array.from(UI)}),O.moveToProtected(t,e,["polys","lineCells"]),O.algo(t,e,0,1),bI(t,e)}const BI=O.newInstance(k7,"vtkCubeSource");var AI={newInstance:BI,extend:k7};const{vtkErrorMacro:mh}=O;function WI(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const n={...t};t.requestData=(r,a)=>{const i=r[0];if(!i||!i.isA("vtkImageData")){mh("Invalid or missing input");return}const s=i.getSpatialExtent();if(!s){mh("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(s),e._cubeSource.setMatrix(i.getIndexToWorld()),a[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(n.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const zI={};function U7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zI,n),O.obj(t,e),O.algo(t,e,1,1),e._cubeSource=AI.newInstance(),O.moveToProtected(t,e,["cubeSource","tmpOut"]),WI(t,e)}const $I=O.newInstance(U7,"vtkImageDataOutlineFilter");var jI={newInstance:$I,extend:U7};let L5;function HI(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(n,r)=>(Re(r,n,e.matrix),r),t.transformPoints=(n,r)=>{const a=new Float64Array(3),i=new Float64Array(3);for(let s=0;s<n.length;s+=3)a[0]=n[s],a[1]=n[s+1],a[2]=n[s+2],Re(i,a,e.matrix),r[s]=i[0],r[s+1]=i[1],r[s+2]=i[2];return r},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(n,r)=>(e.preMultiplyFlag?ge(r,e.matrix,n):ge(r,n,e.matrix),r),t.transformMatrices=(n,r)=>{const a=new Float64Array(16),i=new Float64Array(16),s=e.preMultiplyFlag?()=>ge(i,e.matrix,a):()=>ge(i,a,e.matrix);for(let o=0;o<n.length;o+=16){for(let c=0;c<16;++c)a[c]=n[o+c];s();for(let c=0;c<16;++c)r[o+c]=i[c]}return r},t.getInverse=()=>L5({matrix:bn.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag})}const KI={preMultiplyFlag:!1,matrix:[...$g]};function P7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KI,n),O.obj(t,e),O.setGet(t,e,["preMultiplyFlag"]),O.setGetArray(t,e,["matrix"],16),HI(t,e)}L5=O.newInstance(P7,"vtkTransform");var qI={newInstance:L5,extend:P7},XI=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,YI=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:Oa}=bt;function vh(t,e,n){return e.identity(n),t.reduce((r,a,i)=>i===0?a?e.copy(r,a):e.identity(r):a?e.multiply(r,r,a):r,n)}function ZI(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");function n(a){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>a.unregisterGraphicsResourceUser(i,t))}t.buildPass=a=>{if(a){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(i.getActiveCamera());const s=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),s&&!s.isDeleted()&&s!==e._openGLRenderWindow&&n(s),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(a,i)=>{a&&(e.currentRenderPass=i,t.render())},t.zBufferPass=a=>{a&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=a=>t.zBufferPass(a),t.opaquePass=a=>{a&&t.render()},t.getCoincidentParameters=(a,i)=>e.renderable.getResolveCoincidentTopology()==Kn.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const a=e._openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,a)},t.renderPiece=(a,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){Oa("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(a,i),t.renderPieceDraw(a,i),t.renderPieceFinish(a,i),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(a,i)=>{t.updateBufferObjects(a,i),i.getProperty().getInterpolationType()===Ja.NEAREST?(e.openGLTexture.setMinificationFilter(ee.NEAREST),e.openGLTexture.setMagnificationFilter(ee.NEAREST),e.colorTexture.setMinificationFilter(ee.NEAREST),e.colorTexture.setMagnificationFilter(ee.NEAREST),e.pwfTexture.setMinificationFilter(ee.NEAREST),e.pwfTexture.setMagnificationFilter(ee.NEAREST)):(e.openGLTexture.setMinificationFilter(ee.LINEAR),e.openGLTexture.setMagnificationFilter(ee.LINEAR),e.colorTexture.setMinificationFilter(ee.LINEAR),e.colorTexture.setMagnificationFilter(ee.LINEAR),e.pwfTexture.setMinificationFilter(ee.LINEAR),e.pwfTexture.setMagnificationFilter(ee.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(a,i)=>{const s=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,a,i),s.drawArrays(s.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(a,i)=>{},t.updateBufferObjects=(a,i)=>{t.getNeedToRebuildBufferObjects(a,i)&&t.buildBufferObjects(a,i)},t.getNeedToRebuildBufferObjects=(a,i)=>{var s,o,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||!((s=e.openGLTexture)!=null&&s.getHandle())||!((o=e.colorTexture)!=null&&o.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(a,i)=>{var w,E,L,R;const s=e.currentInput;if(!s)return;const o=(w=s.getPointData())==null?void 0:w.getScalars();if(!o)return;const c=o.getNumberOfComponents();let l=v5(s,o);const f=e._openGLRenderWindow.getGraphicsResourceForObject(o);if(!((E=f==null?void 0:f.oglObject)!=null&&E.getHandle())||(f==null?void 0:f.hash)!==l){e.openGLTexture=ke.newInstance(),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const D=s.getDimensions();e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create3DFilterableFromDataArray(D[0],D[1],D[2],o),e._openGLRenderWindow.setGraphicsResourceForObject(o,e.openGLTexture,l),o!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(o,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=o}else e.openGLTexture=f.oglObject;const g=i.getProperty(),p=g.getIndependentComponents(),h=p?c:1,d=p?2*h:1,m=g.getRGBTransferFunction();l=lr(m,p,h);const v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((L=v==null?void 0:v.oglObject)!=null&&L.getHandle())||(v==null?void 0:v.hash)!==l){const I=1024*d*3,b=new Uint8ClampedArray(I);if(e.colorTexture=ke.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const F=new Float32Array(3072);for(let W=0;W<h;W++){const P=g.getRGBTransferFunction(W),K=P.getRange();if(P.getTable(K[0],K[1],1024,F,1),p)for(let U=0;U<1024*3;U++)b[W*1024*6+U]=255*F[U],b[W*1024*6+U+1024*3]=255*F[U];else for(let U=0;U<1024*3;U++)b[W*1024*6+U]=255*F[U]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,d,3,ce.UNSIGNED_CHAR,b)}else{for(let F=0;F<1024*3;++F)b[F]=255*F/(1023*3),b[F+1]=255*F/(1023*3),b[F+2]=255*F/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,ce.UNSIGNED_CHAR,b)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,l),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=v.oglObject;const y=g.getPiecewiseFunction();l=lr(y,p,h);const T=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!((R=T==null?void 0:T.oglObject)!=null&&R.getHandle())||(T==null?void 0:T.hash)!==l){const I=1024*d,b=new Uint8ClampedArray(I);if(e.pwfTexture=ke.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),y){const F=new Float32Array(I),W=new Float32Array(1024);for(let P=0;P<h;++P){const K=g.getPiecewiseFunction(P);if(K===null)F.fill(1);else{const U=K.getRange();if(K.getTable(U[0],U[1],1024,W,1),p)for(let N=0;N<1024;N++)F[P*1024*2+N]=W[N],F[P*1024*2+N+1024]=W[N];else for(let N=0;N<1024;N++)F[P*1024*2+N]=W[N]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,d,1,ce.FLOAT,F)}else b.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,ce.UNSIGNED_CHAR,b);y&&(e._openGLRenderWindow.setGraphicsResourceForObject(y,e.pwfTexture,l),y!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(y,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=y)}else e.pwfTexture=T.oglObject;const S=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==S){const D=le.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});D.setName("points");const I=le.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),b={points:D,cellOffset:0};if(e.renderable.getSlabThickness()>0){const F=e.resliceGeom.getPointData().getNormals();F?b.normals=F:Oa("Slab mode requested without normals")}e.tris.getCABO().createVBO(I,"polys",On.SURFACE,b)}e.VBOBuildString=S,e.VBOBuildTime.modified()},t.updateShaders=(a,i,s)=>{if(e.lastBoundBO=a,t.getNeedToRebuildShaders(a,i,s)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,s);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);c!==a.getProgram()&&(a.setProgram(c),a.getVAO().releaseGraphicsResources()),a.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(a.getProgram());a.getVAO().bind(),t.setMapperShaderParameters(a,i,s),t.setCameraShaderParameters(a,i,s),t.setPropertyShaderParameters(a,i,s)},t.setMapperShaderParameters=(a,i,s)=>{const o=a.getProgram();if(a.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>a.getAttributeUpdateTime().getMTime()||a.getShaderSourceTime().getMTime()>a.getAttributeUpdateTime().getMTime())){o.isUniformUsed("texture1")&&o.setUniformi("texture1",e.openGLTexture.getTextureUnit()),o.isAttributeUsed("vertexWC")&&(a.getVAO().addAttributeArray(o,a.getCABO(),"vertexWC",a.getCABO().getVertexOffset(),a.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Oa("Error setting vertexWC in shader VAO.")),o.isAttributeUsed("normalWC")&&(a.getVAO().addAttributeArray(o,a.getCABO(),"normalWC",a.getCABO().getNormalOffset(),a.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Oa("Error setting normalWC in shader VAO.")),o.isUniformUsed("slabThickness")&&o.setUniformf("slabThickness",e.renderable.getSlabThickness()),o.isUniformUsed("spacing")&&o.setUniform3fv("spacing",e.currentInput.getSpacing()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabTrapezoid")&&o.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const l=a.getCABO().getCoordShiftAndScaleEnabled()?a.getCABO().getInverseShiftAndScaleMatrix():null;if(o.isUniformUsed("WCTCMatrix")){const f=e.currentInput,u=f.getDimensions();Ze(e.tmpMat4,f.getIndexToWorld()),at(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),Nr(e.tmpMat4,e.tmpMat4,u),lt(e.tmpMat4,e.tmpMat4),l&&ge(e.tmpMat4,e.tmpMat4,l),o.setUniformMatrix("WCTCMatrix",e.tmpMat4)}o.isUniformUsed("vboScaling")&&o.setUniform3fv("vboScaling",a.getCABO().getCoordScale()??[1,1,1]),a.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&a.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),a.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,s);a.getProgram().setUniformf("coffset",c.offset),a.getProgram().isUniformUsed("cfactor")&&a.getProgram().setUniformf("cfactor",c.factor)}},t.setCameraShaderParameters=(a,i,s)=>{const o=e._openGLCamera.getKeyMatrices(i),c=e._openGLImageSlice.getKeyMatrices(),f=a.getCABO().getCoordShiftAndScaleEnabled()?a.getCABO().getInverseShiftAndScaleMatrix():null,u=a.getProgram();u.isUniformUsed("MCPCMatrix")&&(te(e.tmpMat4),u.setUniformMatrix("MCPCMatrix",vh([o.wcpc,c.mcwc,f],yl,e.tmpMat4))),u.isUniformUsed("MCVCMatrix")&&(te(e.tmpMat4),u.setUniformMatrix("MCVCMatrix",vh([o.wcvc,c.mcwc,f],yl,e.tmpMat4)))},t.setPropertyShaderParameters=(a,i,s)=>{const o=a.getProgram(),c=s.getProperty(),l=c.getOpacity();o.setUniformf("opacity",l);const f=e.openGLTexture.getComponents(),u=c.getIndependentComponents();if(u)for(let d=0;d<f;++d)o.setUniformf(`mix${d}`,c.getComponentWeight(d));const g=e.openGLTexture.getVolumeInfo();for(let d=0;d<f;d++){let m=c.getColorWindow(),v=c.getColorLevel();const C=u?d:0,y=c.getRGBTransferFunction(C);if(y&&c.getUseLookupTableScalarRange()){const S=y.getRange();m=S[1]-S[0],v=.5*(S[1]+S[0])}const T=g.scale[d]/m,x=(g.offset[d]-v)/m+.5;o.setUniformf(`cshift${d}`,x),o.setUniformf(`cscale${d}`,T)}const p=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",p);for(let d=0;d<f;d++){let m=1,v=0;const C=u?d:0,y=c.getPiecewiseFunction(C);if(y){const T=y.getRange(),x=T[1]-T[0],S=.5*(T[0]+T[1]);m=g.scale[d]/x,v=(g.offset[d]-S)/x+.5}o.setUniformf(`pwfshift${d}`,v),o.setUniformf(`pwfscale${d}`,m)}const h=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",h),o.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(a,i,s)=>{var p;const o=e.openGLTexture.getComponents(),c=s.getProperty().getIndependentComponents(),l=e.renderable.getSlabThickness(),f=e.renderable.getSlabType(),u=e.renderable.getSlabTrapezoidIntegration();let g=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(g=!0),g||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((p=a.getProgram())==null?void 0:p.getHandle())===0||e.lastTextureComponents!==o||e.lastIndependentComponents!==c||e.lastSlabThickness!==l||e.lastSlabType!==f||e.lastSlabTrapezoidIntegration!==u?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=c,e.lastSlabThickness=l,e.lastSlabType=f,e.lastSlabTrapezoidIntegration=u,!0):!1},t.getShaderTemplate=(a,i,s)=>{a.Vertex=XI,a.Fragment=YI,a.Geometry=""},t.replaceShaderValues=(a,i,s)=>{if(t.replaceShaderTCoord(a,i,s),t.replaceShaderPositionVC(a,i,s),e.haveSeenDepthRequest){let o=a.Fragment;o=G.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=G.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,a.Fragment=o}t.replaceShaderCoincidentOffset(a,i,s)},t.replaceShaderTCoord=(a,i,s)=>{let o=a.Vertex;const c=a.Geometry;let l=a.Fragment;const f=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],u=e.renderable.getSlabThickness();o=G.substitute(o,"//VTK::TCoord::Dec",f).result;const g=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];o=G.substitute(o,"//VTK::TCoord::Impl",g).result;const p=e.openGLTexture.getComponents(),h=s.getProperty().getIndependentComponents();let d=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(h){for(let v=1;v<p;v++)d=d.concat([`uniform float cshift${v};`,`uniform float cscale${v};`,`uniform float pwfshift${v};`,`uniform float pwfscale${v};`]);switch(p){case 1:d=d.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:d=d.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Oa("Unsupported number of independent coordinates.")}}u>0&&(d=d.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),d=d.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),l=G.substitute(l,"//VTK::TCoord::Dec",d).result;let m=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(u>0&&(m=m.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),h){const v=["r","g","b","a"];for(let C=0;C<p;++C)m=m.concat([`vec3 tcolor${C} = mix${C} * texture2D(colorTexture1, vec2(tvalue.${v[C]} * cscale${C} + cshift${C}, height${C})).rgb;`,`float compWeight${C} = mix${C} * texture2D(pwfTexture1, vec2(tvalue.${v[C]} * pwfscale${C} + pwfshift${C}, height${C})).r;`]);switch(p){case 1:m=m.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:m=m.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Oa("Unsupported number of independent coordinates.")}}else switch(p){case 1:m=m.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:m=m.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}l=G.substitute(l,"//VTK::TCoord::Impl",m).result,a.Vertex=o,a.Fragment=l,a.Geometry=c},t.replaceShaderPositionVC=(a,i,s)=>{let o=a.Vertex;const c=a.Geometry;let l=a.Fragment;const f=e.renderable.getSlabThickness();let u=["attribute vec4 vertexWC;"];u=u.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),f>0&&(u=u.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),o=G.substitute(o,"//VTK::PositionVC::Dec",u).result;let g=["gl_Position = MCPCMatrix * vertexWC;"];f>0&&(g=g.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),o=G.substitute(o,"//VTK::PositionVC::Impl",g).result,o=G.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let p=[];f>0&&(p=p.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),l=G.substitute(l,"//VTK::PositionVC::Dec",p).result,a.Vertex=o,a.Geometry=c,a.Fragment=l};function r(a){bn.normalize(a);const i=[0,0,0];for(let s=0;s<3;++s){gS(i),i[s]=1;const o=bn.dot(a,i);if(o<-.999||o>.999)return[!0,s]}return[!1,2]}t.updateResliceGeometry=()=>{var u;let a="";const i=e.currentInput,s=i==null?void 0:i.getBounds();let o=!0,c=2;const l=e.renderable.getSlicePolyData(),f=e.renderable.getSlicePlane();if(l)a=a.concat(`PolyData${l.getMTime()}`);else if(f){a=a.concat(`Plane${f.getMTime()}`);const g=Tg();i&&(a=a.concat(`Image${i.getMTime()}`),h8(g,...i.getDirection()),o0(g,g));const p=[...f.getNormal()];Oc(p,p,g),[o,c]=r(p)}else{const g=Ft.newInstance();g.setNormal(0,0,1);let p=[0,1,0,1,0,1];i&&(p=s),g.setOrigin(p[0],p[2],.5*(p[5]+p[4])),e.renderable.setSlicePlane(g),a=a.concat(`Plane${f==null?void 0:f.getMTime()}`),i&&(a=a.concat(`Image${i.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==a){if(l)e.resliceGeom||(e.resliceGeom=ei.newInstance()),e.resliceGeom.getPoints().setData(l.getPoints().getData(),3),e.resliceGeom.getPolys().setData(l.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(l.getPointData().getNormals());else if(f)if(o){const g=new Float32Array(12),p=i.worldToIndex(f.getOrigin(),[0,0,0]),h=[(c+1)%3,(c+2)%3].sort(),d=i.getSpatialExtent();let m=0;for(let x=0;x<2;++x)for(let S=0;S<2;++S)g[m+c]=p[c],g[m+h[0]]=d[2*h[0]+S],g[m+h[1]]=d[2*h[1]+x],m+=3;e.transform.setMatrix(i.getIndexToWorld()),e.transform.transformPoints(g,g);const v=new Uint16Array(8);v[0]=3,v[1]=0,v[2]=1,v[3]=3,v[4]=3,v[5]=0,v[6]=3,v[7]=2;const C=f.getNormal();bn.normalize(C);const y=new Float32Array(12);for(let x=0;x<4;++x)y[3*x]=C[0],y[3*x+1]=C[1],y[3*x+2]=C[2];e.resliceGeom||(e.resliceGeom=ei.newInstance()),e.resliceGeom.getPoints().setData(g,3),e.resliceGeom.getPolys().setData(v,1);const T=le.newInstance({numberOfComponents:3,values:y,name:"Normals"});e.resliceGeom.getPointData().setNormals(T)}else{e.outlineFilter.setInputData(i),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(f),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=ei.newInstance());const g=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(g.getPoints().getData(),3),e.resliceGeom.getPolys().setData(g.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(g.getPointData().getNormals());const p=f.getNormal(),h=e.resliceGeom.getNumberOfPoints();bn.normalize(p);const d=new Float32Array(h*3);for(let v=0;v<h;++v)d[3*v]=p[0],d[3*v+1]=p[1],d[3*v+2]=p[2];const m=le.newInstance({numberOfComponents:3,values:d,name:"Normals"});e.resliceGeom.getPointData().setNormals(m)}else Oa("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=a,(u=e.resliceGeom)==null||u.modified()}},t.setOpenGLTexture=a=>{a&&(e.openGLTexture=a,e._externalOpenGLTexture=!0)},t.delete=g0(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const QI={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1};function JI(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QI,n),st.extend(t,e,n),ha.implementReplaceShaderCoincidentOffset(t,e,n),ha.implementBuildShadersWithReplacements(t,e,n),e.tris=Ta.newInstance(),e.openGLTexture=null,e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},Ue(e.VBOBuildTime),e.tmpMat4=te(new Float64Array(16)),e.outlineFilter=jI.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=ei.newInstance(),e.cutter=kI.newInstance(),e.lineToSurfaceFilter=LI.newInstance(),e.transform=qI.newInstance(),Xt(t,e,["openGLTexture"]),ZI(t,e)}const eF=Le(JI,"vtkOpenGLImageResliceMapper");Tt("vtkImageResliceMapper",eF);const Ma={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:oc}=O;function tF(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function n(r){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(a=>r.unregisterGraphicsResourceUser(a,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const a=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),a&&!a.isDeleted()&&a!==e._openGLRenderWindow&&n(a),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(r,a)=>{r&&(e.currentRenderPass=a,t.render())},t.opaqueZBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(r,a)=>e.renderable.getResolveCoincidentTopology()===Kn.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,r)},t.renderPiece=(r,a)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a))},t.renderPieceStart=(r,a)=>{t.updateBufferObjects(r,a)},t.renderPieceDraw=(r,a)=>{const i=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,a),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,a)=>{},t.updateBufferObjects=(r,a)=>{t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a),a.getProperty().getInterpolationType()===Ja.NEAREST?(e.volumeTexture.setMinificationFilter(ee.NEAREST),e.volumeTexture.setMagnificationFilter(ee.NEAREST),e.colorTexture.setMinificationFilter(ee.NEAREST),e.colorTexture.setMagnificationFilter(ee.NEAREST),e.pwfTexture.setMinificationFilter(ee.NEAREST),e.pwfTexture.setMagnificationFilter(ee.NEAREST)):(e.volumeTexture.setMinificationFilter(ee.LINEAR),e.volumeTexture.setMagnificationFilter(ee.LINEAR),e.colorTexture.setMinificationFilter(ee.LINEAR),e.colorTexture.setMagnificationFilter(ee.LINEAR),e.pwfTexture.setMinificationFilter(ee.LINEAR),e.pwfTexture.setMagnificationFilter(ee.LINEAR))},t.getNeedToRebuildBufferObjects=(r,a)=>{var s;const i=e.VBOBuildTime.getMTime();return i<t.getMTime()||i<e.renderable.getMTime()||i<a.getMTime()||i<e.currentImageDataInput.getMTime()||i<e.currentCenterlineInput.getMTime()||!((s=e.volumeTexture)!=null&&s.getHandle())},t.buildBufferObjects=(r,a)=>{var E,L,R,D;const i=e.currentImageDataInput,s=e.currentCenterlineInput,o=(E=i==null?void 0:i.getPointData())==null?void 0:E.getScalars();if(!o)return;const c=e._openGLRenderWindow.getGraphicsResourceForObject(o),l=v5(i,o);if(!((L=c==null?void 0:c.oglObject)!=null&&L.getHandle())||(c==null?void 0:c.hash)!==l){e.volumeTexture=ke.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const I=i.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray(I[0],I[1],I[2],o,e.renderable.getPreferSizeOverAccuracy()),e._openGLRenderWindow.setGraphicsResourceForObject(o,e.volumeTexture,l),o!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(o,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=o}else e.volumeTexture=c.oglObject;const u=o.getNumberOfComponents(),g=a.getProperty(),p=g.getIndependentComponents(),h=p?u:1,d=p?2*h:1,m=g.getRGBTransferFunction(),v=lr(m,p,h),C=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((R=C==null?void 0:C.oglObject)!=null&&R.getHandle())||(C==null?void 0:C.hash)!==v){const b=1024*d*3,F=new Uint8ClampedArray(b);if(e.colorTexture=ke.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const W=new Float32Array(3072);for(let P=0;P<h;P++){const K=g.getRGBTransferFunction(P),U=K.getRange();if(K.getTable(U[0],U[1],1024,W,1),p)for(let N=0;N<1024*3;N++)F[P*1024*6+N]=255*W[N],F[P*1024*6+N+1024*3]=255*W[N];else for(let N=0;N<1024*3;N++)F[P*1024*6+N]=255*W[N]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,d,3,ce.UNSIGNED_CHAR,F)}else{for(let W=0;W<1024*3;++W)F[W]=255*W/(1023*3),F[W+1]=255*W/(1023*3),F[W+2]=255*W/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,ce.UNSIGNED_CHAR,F)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,v),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=C.oglObject;const T=g.getPiecewiseFunction(),x=lr(T,p,h),S=e._openGLRenderWindow.getGraphicsResourceForObject(T);if(!((D=S==null?void 0:S.oglObject)!=null&&D.getHandle())||(S==null?void 0:S.hash)!==x){const b=1024*d,F=new Uint8ClampedArray(b);if(e.pwfTexture=ke.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),T){const W=new Float32Array(b),P=new Float32Array(1024);for(let K=0;K<h;++K){const U=g.getPiecewiseFunction(K);if(U===null)W.fill(1);else{const N=U.getRange();if(U.getTable(N[0],N[1],1024,P,1),p)for(let k=0;k<1024;k++)W[K*1024*2+k]=P[k],W[K*1024*2+k+1024]=P[k];else for(let k=0;k<1024;k++)W[K*1024*2+k]=P[k]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,d,1,ce.FLOAT,W)}else F.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,ce.UNSIGNED_CHAR,F);T&&(e._openGLRenderWindow.setGraphicsResourceForObject(T,e.pwfTexture,x),T!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(T,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=T)}else e.pwfTexture=S.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<s.getMTime()){const I=s.getNumberOfPoints(),b=I<=1?0:I-1,F=s.getDistancesToFirstPoint(),W=e.renderable.getHeight(),P=4*b,K=new Float32Array(3*P),U=e.renderable.getWidth();for(let pe=0,he=0;pe<b;++pe)K.set([0,W-F[pe],0],he),he+=3,K.set([U,W-F[pe],0],he),he+=3,K.set([U,W-F[pe+1],0],he),he+=3,K.set([0,W-F[pe+1],0],he),he+=3;const N=le.newInstance({numberOfComponents:3,values:K});N.setName("points");const k=new Uint16Array(5*b);for(let pe=0,he=0,Yt=0;pe<b;++pe)k.set([4,Yt+3,Yt+2,Yt+1,Yt],he),he+=5,Yt+=4;const z=le.newInstance({numberOfComponents:1,values:k}),j=s.getPoints(),$=new Float32Array(3*P),re=new Array(3),xt=new Array(3);for(let pe=0,he=0;pe<b;++pe)j.getPoint(pe,re),j.getPoint(pe+1,xt),$.set(re,he),he+=3,$.set(re,he),he+=3,$.set(xt,he),he+=3,$.set(xt,he),he+=3;const Me=le.newInstance({numberOfComponents:3,values:$,name:"centerlinePosition"}),Gt=new Float32Array(P);for(let pe=0,he=0;pe<b;++pe)Gt.set([0,1,3,2],he),he+=4;const Mt=le.newInstance({numberOfComponents:1,values:Gt,name:"quadIndex"}),tt=[Me,Mt];if(!e.renderable.getUseUniformOrientation()){const pe=e.renderable.getOrientedCenterline().getOrientations()??[],he=new Float32Array(4*P),Yt=new Float32Array(4*P);for(let qn=0;qn<b;++qn){const bu=pe[qn],Gu=pe[qn+1];for(let xa=0;xa<4;++xa){const Vs=4*(xa+4*qn);he.set(bu,Vs),Yt.set(Gu,Vs)}}const R0=le.newInstance({numberOfComponents:4,values:he,name:"centerlineTopOrientation"}),Pu=le.newInstance({numberOfComponents:4,values:Yt,name:"centerlineBotOrientation"});tt.push(R0,Pu)}e.tris.getCABO().createVBO(z,"polys",On.SURFACE,{points:N,customAttributes:tt}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(r,a,i)=>{const s=e.volumeTexture.getComponents(),o=i.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),f=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return r.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==f||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==s||e.lastIndependentComponents!==o?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=f,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=o,!0):!1},t.buildShaders=(r,a,i)=>{t.getShaderTemplate(r,a,i),t.replaceShaderValues(r,a,i)},t.replaceShaderValues=(r,a,i)=>{let s=r.Vertex,o=r.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];s=G.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=G.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],f=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),f&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),s=G.substitute(s,"//VTK::Color::Dec",l).result;const g=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(g.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),f&&g.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):g.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),s=G.substitute(s,"//VTK::Color::Impl",g).result;const p=e.volumeTexture.getComponents(),h=i.getProperty().getIndependentComponents();let d=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];f&&d.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(d.push("in vec3 samplingDirVSOutput;"),f&&d.push("in vec3 projectionDirVSOutput;")):(d.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),f&&d.push("uniform vec3 bitangentDirection;"));const m=e.renderable.getCenterPoint();if(m&&d.push("uniform vec3 globalCenterPoint;"),h){for(let C=1;C<p;C++)d=d.concat([`uniform float cshift${C};`,`uniform float cscale${C};`,`uniform float pwfshift${C};`,`uniform float pwfscale${C};`]);switch(p){case 1:d=d.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:d=d.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:oc("Unsupported number of independent coordinates.")}}o=G.substitute(o,"//VTK::TCoord::Dec",d).result;let v=[];if(u?(v.push("vec3 samplingDirection = samplingDirVSOutput;"),f&&v.push("vec3 projectionDirection = projectionDirVSOutput;")):(v.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),f&&v.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),m?v.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):v.push("float horizontalOffset = quadOffsetVSOutput.x;"),v.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),f){const C=e.renderable.getProjectionMode();switch(C){case Ma.MIN:v.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case Ma.MAX:case Ma.AVERAGE:default:v.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(v.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),C){case Ma.MAX:v.push("  tvalue = max(tvalue, sampledTextureValue);");break;case Ma.MIN:v.push("  tvalue = min(tvalue, sampledTextureValue);");break;case Ma.AVERAGE:default:v.push("  tvalue = tvalue + sampledTextureValue;");break}v.push("}"),C===Ma.AVERAGE&&v.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else v.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(h){const C=["r","g","b","a"];for(let y=0;y<p;++y)v=v.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${C[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${C[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(p){case 1:v=v.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:v=v.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:oc("Unsupported number of independent coordinates.")}}else switch(p){case 1:v=v.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:v=v.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}o=G.substitute(o,"//VTK::TCoord::Impl",v).result,e.haveSeenDepthRequest&&(o=G.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=G.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=s,r.Fragment=o,t.replaceShaderClip(r,a,i),t.replaceShaderCoincidentOffset(r,a,i)},t.replaceShaderClip=(r,a,i)=>{let s=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(O.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),s=G.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,s=G.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=G.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=G.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=s,r.Fragment=o},t.getShaderTemplate=(r,a,i)=>{r.Vertex=m5,r.Fragment=v0,r.Geometry=""},t.setMapperShaderParameters=(r,a,i)=>{const s=r.getProgram(),o=r.getCABO();o.getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(s,o,"vertexMC",o.getVertexOffset(),o.getStride(),e.context.FLOAT,3,e.context.FALSE)||oc("Error setting vertexMC in shader VAO.")),r.getCABO().getCustomData().forEach(p=>{p&&s.isAttributeUsed(p.name)&&!r.getVAO().addAttributeArray(s,o,p.name,p.offset,o.getStride(),e.context.FLOAT,p.components,e.context.FALSE)&&oc(`Error setting ${p.name} in shader VAO.`)}),r.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(s.setUniformi("volumeTexture",c),s.setUniformf("width",e.renderable.getWidth()),r.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),s.isUniformUsed("tangentDirection")){const p=e.renderable.getTangentDirection();r.getProgram().setUniform3fArray("tangentDirection",p)}if(s.isUniformUsed("bitangentDirection")){const p=e.renderable.getBitangentDirection();r.getProgram().setUniform3fArray("bitangentDirection",p)}if(s.isUniformUsed("centerlineOrientation")){const p=e.renderable.getUniformOrientation();r.getProgram().setUniform4fv("centerlineOrientation",p)}if(s.isUniformUsed("globalCenterPoint")){const p=e.renderable.getCenterPoint();s.setUniform3fArray("globalCenterPoint",p)}if(e.renderable.isProjectionEnabled()){const p=e.currentImageDataInput,h=p.getSpacing(),d=p.getDimensions(),m=e.renderable.getProjectionSlabThickness(),v=e.renderable.getProjectionSlabNumberOfSamples(),C=pS([],h,d);s.setUniform3fArray("volumeSizeMC",C),s.setUniformi("projectionSlabNumberOfSamples",v);const y=-.5*m;s.setUniformf("projectionConstantOffset",y);const T=m/(v-1);s.setUniformf("projectionStepLength",T)}const l=e.currentImageDataInput,f=l.getWorldToIndex(),u=Rg(new Float32Array(16),O8([],l.getDimensions())),g=vl(u,u,f);if(s.setUniformMatrix("MCTCMatrix",g),e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let p=e.renderable.getNumberOfClippingPlanes();p>6&&(O.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),p=6);const d=o.getCoordShiftAndScaleEnabled()?o.getInverseShiftAndScaleMatrix():null,m=d?Ze(e.imagematinv,i.getMatrix()):i.getMatrix();d&&(me(m,m),ge(m,m,d),me(m,m)),me(e.imagemat,e.currentImageDataInput.getIndexToWorld()),ge(e.imagematinv,m,e.imagemat);const v=[];for(let C=0;C<p;C++){const y=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,C,y);for(let T=0;T<4;T++)v.push(y[T])}s.setUniformi("numClipPlanes",p),s.setUniform4fv("clipPlanes",v)}if(s.isUniformUsed("coffset")){const p=t.getCoincidentParameters(a,i);s.setUniformf("coffset",p.offset),s.isUniformUsed("cfactor")&&s.setUniformf("cfactor",p.factor)}},t.setCameraShaderParameters=(r,a,i)=>{const s=e.openGLImageSlice.getKeyMatrices().mcwc,o=e.openGLCamera.getKeyMatrices(a).wcpc;if(ge(e.imagemat,o,s),r.getCABO().getCoordShiftAndScaleEnabled()){const c=r.getCABO().getInverseShiftAndScaleMatrix();ge(e.imagemat,e.imagemat,c)}r.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(r,a,i)=>{const s=r.getProgram(),o=i.getProperty(),c=o.getOpacity();s.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),f=o.getIndependentComponents();if(f)for(let h=0;h<l;++h)s.setUniformf(`mix${h}`,o.getComponentWeight(h));const u=e.volumeTexture.getVolumeInfo();for(let h=0;h<l;h++){let d=o.getColorWindow(),m=o.getColorLevel();const v=f?h:0,C=o.getRGBTransferFunction(v);if(C&&o.getUseLookupTableScalarRange()){const x=C.getRange();d=x[1]-x[0],m=.5*(x[1]+x[0])}const y=u.scale[h]/d,T=(u.offset[h]-m)/d+.5;s.setUniformf(`cshift${h}`,T),s.setUniformf(`cscale${h}`,y)}const g=e.colorTexture.getTextureUnit();s.setUniformi("colorTexture1",g);for(let h=0;h<l;h++){let d=1,m=0;const v=f?h:0,C=o.getPiecewiseFunction(v);if(C){const y=C.getRange(),T=y[1]-y[0],x=.5*(y[0]+y[1]);d=u.scale[h]/T,m=(u.offset[h]-x)/T+.5}s.setUniformf(`pwfshift${h}`,m),s.setUniformf(`pwfscale${h}`,d)}const p=e.pwfTexture.getTextureUnit();s.setUniformi("pwfTexture1",p)},t.updateShaders=(r,a,i)=>{if(t.getNeedToRebuildShaders(r,a,i)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,i);const o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);o!==r.getProgram()&&(r.setProgram(o),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,a,i),t.setCameraShaderParameters(r,a,i),t.setPropertyShaderParameters(r,a,i)},t.delete=O.chain(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const nF={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function rF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nF,n),st.extend(t,e,n),ha.implementReplaceShaderCoincidentOffset(t,e,n),O.algo(t,e,2,0),e.tris=Ta.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=te(new Float64Array(16)),e.imagematinv=te(new Float64Array(16)),e.VBOBuildTime={},O.obj(e.VBOBuildTime,{mtime:0}),tF(t,e)}const aF=O.newInstance(rF,"vtkOpenGLImageCPRMapper");Tt("vtkImageCPRMapper",aF);const b7=Object.create(null);function Os(t,e){b7[t]=e}function iF(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const sF={};function oF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sF,n),e.overrides=b7,Zg.extend(t,e,n),iF(t,e)}O.newInstance(oF,"vtkWebGPUViewNodeFactory");function cF(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,a,i)=>{if(te(n),e.renderable.getParallelProjection()){const s=e.renderable.getParallelScale(),o=s*r,c=s,l=(i[0]-1)*o,f=(i[0]+1)*o,u=(i[1]-1)*c,g=(i[1]+1)*c,p=1/(f-l),h=1/(g-u);n[0]=2*p,n[5]=2*h,n[10]=1/(a[1]-a[0]),n[12]=(f+l)*p,n[13]=(g+u)*h,n[14]=a[1]/(a[1]-a[0])}else{const s=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let o,c;e.renderable.getUseHorizontalViewAngle()===!0?(o=a[0]*s,c=a[0]*s/r):(o=a[0]*s*r,c=a[0]*s);const l=(i[0]-1)*o,f=(i[0]+1)*o,u=(i[1]-1)*c,g=(i[1]+1)*c;n[0]=2*a[0]/(f-l),n[5]=2*a[0]/(g-u),n[12]=(l+f)/(f-l),n[13]=(u+g)/(g-u),n[10]=0,n[14]=a[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let a=-r[0]/n;return a=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(a*(r[1]-r[0])),.5*a+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),a=n.getParent();if(Math.max(a.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const i=e.renderable.getViewMatrix();Ze(e.keyMatrices.normalMatrix,i),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,lt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),me(e.keyMatrices.wcvc,i);const s=n.getStabilizedCenterByReference();at(e.keyMatrices.scvc,e.keyMatrices.wcvc,s);const o=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,c,e.renderable.getWindowCenterByReference()),ge(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),lt(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const lF={keyMatrixTime:null,keyMatrices:null};function uF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lF,n),st.extend(t,e,n),e.keyMatrixTime={},O.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},O.setGet(t,e,["keyMatrixTime"]),cF(t,e)}const fF=O.newInstance(uF);Os("vtkCamera",fF);function gF(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let a=0;a<e.bindables.length;a++)e.bindables[a]!==n[a]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let a=0;a<e.bindables.length;a++){const i=e.bindables[a].getBindGroupLayoutEntry();i.binding=a,r.push(i)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let i=0;i<e.bindables.length;i++){const s=e.bindables[i].getBindGroupTime().getMTime();r=s>r?s:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const a=[];for(let i=0;i<e.bindables.length;i++){const s=e.bindables[i].getBindGroupEntry();s.binding=i,a.push(s)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:a,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],a=n.getBindGroupLayoutCount(e.label);for(let i=0;i<e.bindables.length;i++)r.push(e.bindables[i].getShaderCode(i,a));return r.join(`
`)}}const pF={device:null,handle:null,label:null};function G7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pF,n),O.obj(t,e),e.bindables=[],e.bindGroupTime={},O.obj(e.bindGroupTime,{mtime:0}),O.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),O.setGet(t,e,["label","device","arrayInformation"]),gF(t,e)}const dF=O.newInstance(G7);var B7={newInstance:dF,extend:G7};function hF(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const mF={device:null,handle:null};function A7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mF,n),O.obj(t,e),O.get(t,e,["lastCameraMTime"]),O.setGet(t,e,["device","handle"]),hF(t,e)}const vF=O.newInstance(A7,"vtkWebGPUShaderModule");var yF={newInstance:vF,extend:A7};function CF(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const a=Array.isArray(n)?n.join(`
`):n;let i=!1;t.search(e)!==-1&&(i=!0);let s="";r&&(s="g");const o=new RegExp(e,s),c=t.replace(o,a);return{replace:i,result:c}}function TF(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),a=n.getHash(),i=e._shaderModules.keys();for(let o=0;o<i.length;o++){const c=i[o];if(c.getHash()===a&&c.getType()===r)return e._shaderModules.get(c)}const s=yF.newInstance();return s.initialize(e.device,n),e._shaderModules.set(n,s),s}}const xF={shaderModules:null,device:null,window:null};function W7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xF,n),e._shaderModules=new Map,O.obj(t,e),O.setGet(t,e,["device","window"]),TF(t,e)}const SF=O.newInstance(W7,"vtkWebGPUShaderCache");var ln={newInstance:SF,extend:W7,substitute:CF};function wF(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const a=[];for(let i=0;i<e.layouts.length;i++)a.push(e.layouts[i].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:a}),e.pipelineDescription.layout=e.pipelineLayout;for(let i=0;i<e.shaderDescriptions.length;i++){const s=e.shaderDescriptions[i],o=n.getShaderModule(s);s.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),s.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const EF={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function z7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EF,n),Ue(t,e),e.layouts=[],e.shaderDescriptions=[],Xt(t,e,["handle","pipelineDescription"]),ft(t,e,["device","renderEncoder","topology","vertexState"]),wF(t,e)}const RF=Le(z7,"vtkWebGPUPipeline");var OF={newInstance:RF,extend:z7};function MF(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(a)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const a=[];let i=[];if(r&&a.push(r.getShaderCode()),n||e.builtinInputNames.length){const s=[];if(s.push(`struct ${e.type}Input
{`),n){const o=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),l=n.getOutputInterpolationsByReference();for(let f=0;f<o.length;f++)l[f]!==void 0?s.push(`  @location(${f}) @interpolate(${l[f]}) ${o[f]} : ${c[f]},`):s.push(`  @location(${f}) ${o[f]} : ${c[f]},`)}for(let o=0;o<e.builtinInputNames.length;o++)s.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);s.length>1&&(s.push("};"),i=s,a[a.length-1]+=",",a.push(`input: ${e.type}Input`))}if(a.length&&(e.code=ln.substitute(e.code,"//VTK::IOStructs::Input",a).result),e.outputNames.length+e.builtinOutputNames.length){const s=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?s.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):s.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)s.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);s.push("};"),i=i.concat(s),e.code=ln.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=ln.substitute(e.code,"//VTK::IOStructs::Dec",i).result}}const DF={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function $7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DF,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],O.obj(t,e),O.setGet(t,e,["type","hash","code"]),O.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),MF(t,e)}const VF=O.newInstance($7,"vtkWebGPUShaderDescription");var yh={newInstance:VF,extend:$7};const Ch={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function LF(t){return!t||t.length<6?0:t in Ch?Ch[t]:(fe(`unknown format ${t}`),null)}function _F(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return fe(`unknown format ${t}`),0;const a=5-r/2;return e*a}function NF(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function IF(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{fe(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){fe(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function FF(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{fe(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function kF(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function UF(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";fe(`unknown format ${t}`)}}var rr={getDetailsFromTextureFormat:LF,getByteStrideFromBufferFormat:_F,getNumberOfComponentsFromBufferFormat:NF,getNativeTypeFromBufferFormat:IF,getShaderTypeFromBufferFormat:FF,getByteStrideFromShaderFormat:kF,getNativeTypeFromShaderFormat:UF};function PF(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function bF(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",i=r;Array.isArray(i)||(i=[i]);for(let s=0;s<e.inputs.length;s++)if(PF(e.inputs[s].names,i)){if(e.inputs[s].buffer===n)return;e.inputs[s].buffer=n;return}e.inputs.push({buffer:n,stepMode:a,names:i}),e.inputs=e.inputs.sort((s,o)=>s.names[0]<o.names[0]?-1:s.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let a=0;a<e.inputs.length;a++)for(let i=0;i<e.inputs[a].names.length;i++){const s=e.inputs[a].buffer.getArrayInformation()[i],o=rr.getShaderTypeFromBufferFormat(s.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[a].names[i]} : ${o}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let a=0;for(let i=0;i<e.inputs.length;i++){const s=e.inputs[i].buffer,o={arrayStride:s.getStrideInBytes(),stepMode:e.inputs[i].stepMode,attributes:[]},c=s.getArrayInformation();for(let l=0;l<e.inputs[i].names.length;l++)o.attributes.push({shaderLocation:a,offset:c[l].offset,format:c[l].format}),a++;r.push(o)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const GF={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function j7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GF,n),Ue(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],ft(t,e,["created","device","handle","indexBuffer"]),bF(t,e)}const BF=Le(j7,"vtkWebGPUVertexInput");var AF={newInstance:BF,extend:j7};const WF=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,zF=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function $F(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,a)=>{const i=yh.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),s=yh.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),o=r.getShaderDescriptions();o.push(i),o.push(s);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),u=c.match(l).filter((g,p,h)=>h.indexOf(g)===p).map(g=>`replaceShader${g.substring(7,g.length-2)}`);for(let g=0;g<u.length;g++){const p=u[g];p!=="replaceShaderIOStructs"&&e.shaderReplacements.has(p)&&e.shaderReplacements.get(p)(n,r,a)}t.replaceShaderIOStructs(n,r,a)},t.replaceShaderIOStructs=(n,r,a)=>{const i=r.getShaderDescription("vertex");i.replaceShaderCode(null,a),r.getShaderDescription("fragment").replaceShaderCode(i)},t.replaceShaderRenderEncoder=(n,r,a)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,a)=>{if(!e.WebGPURenderer)return;const i=e.WebGPURenderer.getBindGroup().getShaderCode(r),s=r.getShaderDescription("vertex");let o=s.getCode();o=ln.substitute(o,"//VTK::Renderer::Dec",[i]).result,s.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=ln.substitute(o,"//VTK::Renderer::Dec",[i]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,a)=>{const i=e.bindGroup.getShaderCode(r),s=r.getShaderDescription("vertex");let o=s.getCode();o=ln.substitute(o,"//VTK::Mapper::Dec",[i]).result,s.setCode(o);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=c.getCode(),o=ln.substitute(o,"//VTK::Mapper::Dec",[i]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,a)=>{const i=r.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let s=i.getCode();s=ln.substitute(s,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,i.setCode(s)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,a)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const a=e.vertexInput.getIndexBuffer();a?n.drawIndexed(a.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const a=e.textureViews[r].getSampler();a&&n.push(a)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=OF.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const jF={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function H7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jF,n),st.extend(t,e,n),e.textureViews=[],e.vertexInput=AF.newInstance(),e.bindGroup=B7.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||zF,e.vertexShaderTemplate=e.vertexShaderTemplate||WF,e.shaderReplacements=new Map,O.get(t,e,["pipeline","vertexInput"]),O.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),$F(t,e)}const HF=O.newInstance(H7,"vtkWebGPUSimpleMapper");var KF={newInstance:HF,extend:H7};function qF(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,a)=>{const i=r.getShaderDescription("vertex");i.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),i.addOutput("vec4<f32>","vertexVC");let s=i.getCode();s=ln.substitute(s,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,i.setCode(s)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const XF={};function K7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XF,n),KF.extend(t,e,n),qF(t,e)}const YF=O.newInstance(K7,"vtkWebGPUFullScreenQuad");var p2={newInstance:YF,extend:K7};const ZF={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},QF={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var T0={BufferUsage:ZF,PrimitiveTypes:QF};const Nf=["getMappedRange","mapAsync","unmap"];function JF(t,e,n,r){const a=r.byteLength,i=t.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),s=i.getMappedRange(0,a);new Uint8Array(s).set(new Uint8Array(r)),i.unmap();const o=t.createCommandEncoder();o.copyBufferToBuffer(i,0,e,n,a);const c=o.finish();t.queue.submit([c]),i.destroy()}function ek(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{JF(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n.byteLength,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=n.byteLength,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<Nf.length;n++)t[Nf[n]]=function(){return e.handle[Nf[n]](...arguments)}}const tk={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function q7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tk,n),O.obj(t,e),O.get(t,e,["handle","sizeInBytes","usage"]),O.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),ek(t,e)}const nk=O.newInstance(q7);var d2={newInstance:nk,extend:q7,...T0};const{Representation:Th}=m0,{PrimitiveTypes:qr}=T0;class rk{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function ak(t){switch(t){case qr.Points:return"points";case qr.Lines:return"lines";case qr.Triangles:case qr.TriangleEdges:return"polys";case qr.TriangleStripEdges:case qr.TriangleStrips:return"strips";default:return""}}function cc(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function ik(t,e,n){const r=t.length;for(let s=0;s<r;s++){let o=t[s];if(n.cellProvokedMap.has(o)){n.ibo[n.iboId++]=n.cellProvokedMap.get(o);for(let c=s+1;c<s+r;c++){o=t[c%r];const l=cc(n,o,e);n.ibo[n.iboId++]=l}return}}for(let s=0;s<r;s++){let o=t[s];if(!n.provokedPointIds[o]){let c=cc(n,o,e);n.provokedPointIds[o]=1,n.cellProvokedMap.set(o,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let l=s+1;l<s+r;l++)o=t[l%r],c=cc(n,o,e),n.ibo[n.iboId++]=c;return}}let a=t[0],i=n.flatId;n.cellProvokedMap.set(a,i),n.flatIdToPointId[n.flatId]=a,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=i;for(let s=1;s<r;s++)a=t[s],i=cc(n,a,e),n.ibo[n.iboId++]=i}function sk(t,e,n){const r=t.length;n.iboSize+=r;for(let a=0;a<r;a++){const i=t[a];if(n.cellProvokedMap.has(i))return}for(let a=0;a<r;a++){const i=t[a];if(!n.provokedPointIds[i]){n.provokedPointIds[i]=1,n.cellProvokedMap.set(i,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let dr;const xh=new Uint32Array(1),Cn=new Uint32Array(2),Br=new Uint32Array(3),If={anythingToPoints(t,e,n,r,a){for(let i=0;i<t;++i)xh[0]=e[n+i],dr(xh,r,a)},linesToWireframe(t,e,n,r,a){for(let i=0;i<t-1;++i)Cn[0]=e[n+i],Cn[1]=e[n+i+1],dr(Cn,r,a)},polysToWireframe(t,e,n,r,a){if(t>2)for(let i=0;i<t;++i)Cn[0]=e[n+i],Cn[1]=e[n+(i+1)%t],dr(Cn,r,a)},stripsToWireframe(t,e,n,r,a){if(t>2){for(let i=0;i<t-1;++i)Cn[0]=e[n+i],Cn[1]=e[n+i+1],dr(Cn,r,a);for(let i=0;i<t-2;i++)Cn[0]=e[n+i],Cn[1]=e[n+i+2],dr(Cn,r,a)}},polysToSurface(t,e,n,r,a){for(let i=0;i<t-2;i++)Br[0]=e[n],Br[1]=e[n+i+1],Br[2]=e[n+i+2],dr(Br,r,a)},stripsToSurface(t,e,n,r,a){for(let i=0;i<t-2;i++)Br[0]=e[n+i],Br[1]=e[n+i+1+i%2],Br[2]=e[n+i+1+(i+1)%2],dr(Br,r,a)}};function ok(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,a=n.primitiveType,i=n.representation,s=n.cellOffset,o=r.getData(),c=o.length,l=ak(a),f=n.numberOfPoints,u={provokedPointIds:new Uint8Array(f),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new rk};let g=null;i===Th.POINTS||a===qr.Points?g=If.anythingToPoints:i===Th.WIREFRAME||a===qr.Lines?g=If[`${l}ToWireframe`]:g=If[`${l}ToSurface`],dr=sk;let p=s||0;for(let h=0;h<c;)u.cellProvokedMap.clear(),g(o[h],o,h+1,p,u),h+=o[h]+1,p++;f<=65535?u.flatIdToPointId=new Uint16Array(f+u.extraPoints):u.flatIdToPointId=new Uint32Array(f+u.extraPoints),f+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(f):u.pointIdToFlatId=new Int32Array(f),f+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),n.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),n.format="uint32"),p<=65535?u.flatIdToCellId=new Uint16Array(f+u.extraPoints):u.flatIdToCellId=new Uint32Array(f+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),dr=ik,p=s||0;for(let h=0;h<c;)u.cellProvokedMap.clear(),g(o[h],o,h+1,p,u),h+=o[h]+1,p++;delete u.provokedPointIds,delete u.pointIdToFlatId,n.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}const ck={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function X7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ck,n),d2.extend(t,e,n),O.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),ok(t,e)}const lk=O.newInstance(X7);var uk={newInstance:lk,extend:X7,...T0};const{BufferUsage:Ar}=T0,{vtkErrorMacro:fk}=bt,{VtkDataTypes:Da}=le,gk={};function pk(t){let e;switch(t.getDataType()){case Da.UNSIGNED_CHAR:e="uint8";break;case Da.FLOAT:e="float32";break;case Da.UNSIGNED_INT:e="uint32";break;case Da.INT:e="sint32";break;case Da.DOUBLE:e="float32";break;case Da.UNSIGNED_SHORT:e="uint16";break;case Da.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||fk(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function Sh(t,e,n,r,a){const i={},s=t.getFlatSize();if(!s)return i;let o=[0,0,0,0];a.shift&&(a.shift.length?o=a.shift:o.fill(a.shift));let c=[1,1,1,1];a.scale&&(a.scale.length?c=a.scale:c.fill(a.scale));const l=Object.prototype.hasOwnProperty.call(a,"packExtra")?a.packExtra:!1;let f,u=0;const g=n+(l?1:0),p=Ss(r,s*g);let h=t.getFlatIdToPointId();a.cellData&&(h=t.getFlatIdToCellId()),n===1?f=function(m){p[u++]=c[0]*e[m]+o[0]}:n===2?f=function(m){p[u++]=c[0]*e[m]+o[0],p[u++]=c[1]*e[m+1]+o[1]}:n===3&&!l?f=function(m){p[u++]=c[0]*e[m]+o[0],p[u++]=c[1]*e[m+1]+o[1],p[u++]=c[2]*e[m+2]+o[2]}:n===3&&l?f=function(m){p[u++]=c[0]*e[m]+o[0],p[u++]=c[1]*e[m+1]+o[1],p[u++]=c[2]*e[m+2]+o[2],p[u++]=c[3]*1+o[3]}:n===4&&(f=function(m){p[u++]=c[0]*e[m]+o[0],p[u++]=c[1]*e[m+1]+o[1],p[u++]=c[2]*e[m+2]+o[2],p[u++]=c[3]*e[m+3]+o[3]});for(let d=0;d<s;d++){const m=n*h[d];f(m)}return i.nativeArray=p,i}function dk(t,e,n,r){const a=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],i=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],s=[];return cr(a,i,s),ui(s),s}function hk(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const a=new Int8Array(t.getNumberOfCells()*4),i=r.length;let s=0;for(let o=0;o<i;){const c=dk(n,r[o+1],r[o+2],r[o+3]);a[s++]=127*c[0],a[s++]=127*c[1],a[s++]=127*c[2],a[s++]=127,o+=r[o]+1}return a}function mk(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let a,i;if(r.usage===Ar.Index&&(a=uk.newInstance({label:r.label}),a.setDevice(e.device),i=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,a.buildIndexBuffer(r),a.createAndWrite(r.nativeArray,i),a.setArrayInformation([{format:r.format}])),a||(a=d2.newInstance({label:r.label}),a.setDevice(e.device)),r.usage===Ar.UniformArray&&(i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,i)),r.usage===Ar.Storage&&(i=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,i)),r.usage===Ar.Texture&&(i=GPUBufferUsage.COPY_SRC,a.createAndWrite(r.nativeArray,i)),r.usage===Ar.PointArray){i=GPUBufferUsage.VERTEX;const s=rr.getNativeTypeFromBufferFormat(r.format),o=Sh(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),s,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});a.createAndWrite(o.nativeArray,i),a.setStrideInBytes(rr.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===Ar.NormalsFromPoints){i=GPUBufferUsage.VERTEX;const s=rr.getNativeTypeFromBufferFormat(r.format),o=hk(r.cells,r.dataArray),c=Sh(r.indexBuffer,o,4,s,{cellData:!0});a.createAndWrite(c.nativeArray,i),a.setStrideInBytes(rr.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===Ar.RawVertex&&(i=GPUBufferUsage.VERTEX,a.createAndWrite(r.nativeArray,i),a.setStrideInBytes(rr.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format}])),a.setSourceTime(r.time),a}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,a)=>{const i=pk(r),s={hash:`${r.getMTime()}I${a.getMTime()}${i}`,usage:Ar.PointArray,format:i,dataArray:r,indexBuffer:a};return t.getBuffer(s)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=d2.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const vk={device:null,fullScreenQuadBuffer:null};function yk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vk,n),Ue(t,e),ft(t,e,["device"]),mk(t,e)}Le(yk);var Y7={...gk,...T0};const{BufferUsage:Ck}=Y7,{vtkErrorMacro:wi}=O;function Tk(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){wi(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const a=rr.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:a,offset:e.sizeInBytes,nativeType:rr.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=a},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:Ck.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=O.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,a)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){wi(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[i];t.createView(s.nativeType);const o=e[s.nativeType];o[(s.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=a},t.setArray=(n,r,a)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){wi(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[i];t.createView(s.nativeType);const o=e[s.nativeType],c=(s.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let l=0;l<a.length;l++)o[c+l]=a[l]},t.setAllInstancesFromArray=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){wi(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[a];t.createView(i.nativeType);const s=e[i.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(i.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let f=0;f<o;f++)s[l+f]=r[c*o+f]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){wi(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[a];t.createView(i.nativeType);const s=e[i.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(i.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let f=0;f<o;f++)s[l+f]=r[c*o+f]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){wi(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[a];t.createView(i.nativeType);const s=e[i.nativeType],o=9;for(let c=0;c<e.numberOfInstances;c++){const l=(i.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let f=0;f<3;f++)for(let u=0;u<3;u++)s[l+f*4+u]=r[c*o+f*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const a=[`struct ${e.label}StructEntry
{`];for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];a.push(`  ${s.name}: ${s.type},`)}return a.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),a.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const xk={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function Z7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xk,n),O.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},O.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},O.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},O.get(t,e,["bindGroupTime"]),O.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),Tk(t,e)}const Sk=O.newInstance(Z7,"vtkWebGPUStorageBuffer");var wk={newInstance:Sk,extend:Z7};const{BufferUsage:Ek}=Y7,{vtkErrorMacro:Ff}=O;function Rk(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Ff(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:rr.getByteStrideFromShaderFormat(r),offset:-1,nativeType:rr.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let a=4;for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];s.sizeInBytes%16===0&&(a=Math.max(16,a)),s.sizeInBytes%8===0&&(a=Math.max(8,a))}for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];s.packed===!1&&s.sizeInBytes%16===0&&(s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes)}for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];if(s.packed===!1&&s.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(c.packed===!1&&c.sizeInBytes===4){s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];if(!s.packed&&s.sizeInBytes%8===0)for(let o=i+1;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(!c.packed&&c.sizeInBytes%8===0){s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];if(!s.packed&&s.sizeInBytes%8===0){let o=!1;for(let c=0;!o&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let f=c+1;f<e.bufferEntries.length;f++){const u=e.bufferEntries[f];if(!u.packed&&u.sizeInBytes===4){s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,o=!0;break}}}}}for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];!s.packed&&s.sizeInBytes>4&&(s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes)}for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];s.packed||(s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let i=0;i<e.bufferEntries.length;i++)e._bufferEntryNames.set(e.bufferEntries[i].name,i);e.sizeInBytes=n,e.sizeInBytes=a*Math.ceil(e.sizeInBytes/a),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:Ek.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=O.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(n);if(a===void 0){Ff(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[a];t.createView(i.nativeType);const s=e[i.nativeType];i.lastValue!==r&&(s[i.offset/s.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),i.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(n);if(a===void 0){Ff(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[a];t.createView(i.nativeType);const s=e[i.nativeType];let o=!1;for(let c=0;c<r.length;c++)(!i.lastValue||i.lastValue[c]!==r[c])&&(s[i.offset/s.BYTES_PER_ELEMENT+c]=r[c],o=!0);o&&(e.sendDirty=!0,i.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const a=[`struct ${e.label}Struct
{`];for(let i=0;i<e.bufferEntries.length;i++){const s=e.bufferEntries[i];a.push(`  ${s.name}: ${s.type},`)}return a.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),a.join(`
`)}}const Ok={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function Q7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ok,n),O.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},O.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},O.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,O.get(t,e,["binding","bindGroupTime"]),O.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),Rk(t,e)}const Mk=O.newInstance(Q7,"vtkWebGPUUniformBuffer");var So={newInstance:Mk,extend:Q7};const{vtkDebugMacro:Dk}=bt,wh=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,Vk=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,lc=new Float64Array(16),Eh=new Float64Array(16);function Lk(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function _k(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),a=e.camera.getDirectionOfProjectionByReference(),i=[],s=[];c0(s,a,.5*(n[0]+n[1])),pn(i,r,s),jt(s,i,e.stabilizedCenter),D8(s)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=i,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(Dk("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const a=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",a.wcvc),e.UBO.setArray("SCPCMatrix",a.scpc),e.UBO.setArray("PCSCMatrix",a.pcsc),e.UBO.setArray("SCVCMatrix",a.scvc),e.UBO.setArray("VCPCMatrix",a.vcpc),e.UBO.setArray("WCVCNormals",a.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const i=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[i.usize,i.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const s=e._parent.getDevice();e.UBO.sendIfNeeded(s)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let a=`${e.renderable.getMTime()}`;for(let i=0;i<n.length;i++)a+=n[i].getMTime();if(a!==e.lightTimeString){const i=new Float32Array(n.length*4),s=new Float32Array(n.length*4),o=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let f=0;f<n.length;f++){const u=f*4,g=n[f].getPosition();Re(g,g,r.wcvc),i[u]=g[0],i[u+1]=g[1],i[u+2]=g[2],i[u+3]=0,s[u]=-n[f].getDirection()[0],s[u+1]=-n[f].getDirection()[1],s[u+2]=-n[f].getDirection()[2],s[u+3]=0,o[u]=n[f].getColor()[0],o[u+1]=n[f].getColor()[1],o[u+2]=n[f].getColor()[2],o[u+3]=n[f].getIntensity()*5,c[u]=Lk(n[f]),c[u+1]=Math.cos(We(n[f].getConeAngle())),c[u+2]=Math.cos(We(n[f].getConeAngle()+n[f].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",i),e.SSBO.setAllInstancesFromArray("LightDir",s),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=a},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var i;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=p2.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(wh);const s=So.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((i=e.backgroundTex)!=null&&i.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(Vk);const s=So.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s);const o=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(o.getReady()){const c=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const l=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:l,magFilter:l,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=p2.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(wh);const s=So.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s)}const r=e.webgpuCamera.getKeyMatrices(t),a=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",a),me(Eh,r.normalMatrix),vl(lc,r.scvc,r.pcsc),vl(lc,Eh,lc),e.clearFSQ.getUBO().setArray("FSQMatrix",lc),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],i=n[1]-r[1],s=e._parent.normalizedDisplayToDisplay(a,i),o=Math.round(s[0]),c=Math.round(s[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-o,p=Math.round(u[1])-c;return g<0&&(g=0),p<0&&(p=0),{usize:g,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const Nk={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function Ik(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Nk,n),st.extend(t,e,n),e.UBO=So.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=wk.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=B7.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=te(new Float64Array(16)),e.stabilizedTime={},Ue(e.stabilizedTime,{mtime:0}),Xt(t,e,["bindGroup","stabilizedTime"]),ws(t,e,["stabilizedCenter"]),ft(t,e,["renderEncoder","selector","suppressClear","UBO"]),_k(t,e)}const Fk=Le(Ik,"vtkWebGPURenderer");Os("vtkRenderer",Fk);function kk(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const Uk={device:null,handle:null,label:null,options:null};function J7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Uk,n),O.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},O.obj(e.bindGroupTime,{mtime:0}),O.get(t,e,["bindGroupTime","handle","options"]),O.setGet(t,e,["bindGroupLayoutEntry","device","label"]),kk(t,e)}const Pk=O.newInstance(J7);var bk={newInstance:Pk,extend:J7};const{SlicingMode:Rh}=Ou,Gk=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function Bk(t,e,n){if(e.apply(t)){const a=t.getIndependentComponents();return`${t.getMTime()}-${a}-${n}`}return"0"}const sn=new Float64Array(16),Zn=new Float64Array(16),uc=new Float64Array(16),gr=new Float64Array(4),ot=new Float64Array(4);function Ak(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=a=>{if(a){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const i=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(i.getActiveCamera())}},t.translucentPass=a=>{a&&t.render()},t.opaquePass=a=>{a&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const a=e.currentInput.getExtent();a[0]===a[1]||a[2]===a[3]||a[4]===a[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const a=e.UBO.getSendTime(),i=e.WebGPUImageSlice.getRenderable(),s=i.getMapper();if(t.getMTime()>a||e.renderable.getMTime()>a||i.getProperty().getMTime()>a){const o=s.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();te(sn),at(sn,sn,c);const l=i.getMatrix();me(Zn,l),lt(Zn,Zn),ge(sn,Zn,sn);const f=o.getWorldToIndex();ge(sn,f,sn),lt(uc,sn),du(Zn,[.5,.5,.5]),ge(sn,Zn,sn);const u=o.getDimensions();te(Zn),Nr(Zn,Zn,[1/u[0],1/u[1],1/u[2]]),ge(sn,Zn,sn),e.UBO.setArray("SCTCMatrix",sn);const g=e.currentInput.getExtent(),{ijkMode:p}=e.renderable.getClosestIJKAxis();let h=e.renderable.getSlice();p!==e.renderable.getSlicingMode()&&(h=e.renderable.getSliceAtPosition(h));let d=2,m=0,v=1;p===Rh.I?(d=0,m=1,v=2):p===Rh.J&&(d=1,m=2,v=0),gr[d]=h,gr[m]=g[m*2]-.5,gr[v]=g[v*2]-.5,gr[3]=1,za(gr,gr,uc),e.UBO.setArray("Origin",gr),ot[d]=h,ot[m]=g[m*2+1]+.5,ot[v]=g[v*2]-.5,ot[3]=1,za(ot,ot,uc),ud(ot,ot,gr),ot[3]=1,e.UBO.setArray("Axis1",ot),ot[d]=h,ot[m]=g[m*2]-.5,ot[v]=g[v*2+1]+.5,ot[3]=1,za(ot,ot,uc),ud(ot,ot,gr),ot[3]=1,e.UBO.setArray("Axis2",ot);const C=[1,1,1,1],y=[0,0,0,0],T=e.textureViews[0],x=T.getTexture().getScale(),S=T.getTexture().getNumberOfComponents();for(let w=0;w<S;w++){let E=i.getProperty().getColorWindow(),L=i.getProperty().getColorLevel();const D=i.getProperty().getRGBTransferFunction(0);if(D){const I=D.getRange();E=I[1]-I[0],L=.5*(I[1]+I[0])}C[w]=x/E,y[w]=-L/E+.5}e.UBO.setArray("cScale",C),e.UBO.setArray("cShift",y),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const a=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const s=1,o=Bk(a,a.getRGBTransferFunction,s);if(e.colorTextureString!==o){e.numRows=s;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=a.getRGBTransferFunction();if(l){const f=new Float32Array(e.rowLength*3);for(let u=0;u<s;u++){l=a.getRGBTransferFunction(u);const g=l.getRange();l.getTable(g[0],g[1],e.rowLength,f,1);for(let p=0;p<e.rowLength;p++){const h=u*e.rowLength*8+p*4;c[h]=255*f[p*3],c[h+1]=255*f[p*3+1],c[h+2]=255*f[p*3+2],c[h+3]=255;for(let d=0;d<4;d++)c[h+e.rowLength*4+d]=c[h+d]}}}else for(let f=0;f<e.rowLength;++f){const u=255*f/(e.rowLength-1);c[f*4]=u,c[f*4+1]=u,c[f*4+2]=u,c[f*4+3]=255;for(let g=0;g<4;g++)c[f*4+e.rowLength*4+g]=c[f*4+g]}{const f={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},g=e.device.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[1]=g}e.colorTextureString=o}};const n=t.updateBuffers;t.updateBuffers=()=>{n();const a=e.device.getTextureManager().getTextureForImageData(e.currentInput),i=e.textureViews;if(!i[0]||i[0].getTexture()!==a){const c=a.createView("imgTexture");i[0]=c}t.updateLUTImage(),t.updateUBO();const o=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===Ja.NEAREST?"nearest":"linear";(!e.clampSampler||o!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=bk.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:o,magFilter:o}),e.additionalBindables=[e.clampSampler])};const r=t.getShaderReplacements();t.replaceShaderPosition=(a,i,s)=>{const o=i.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=ln.substitute(c,"//VTK::Position::Impl",l).result,o.setCode(c)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(a,i,s)=>{const o=i.getShaderDescription("vertex");e.dimensions===2?o.addOutput("vec2<f32>","tcoordVS"):o.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(a,i,s)=>{const o=i.getShaderDescription("fragment");let c=o.getCode();e.dimensions===3?c=ln.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=ln.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=ln.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,o.setCode(c)},r.set("replaceShaderImage",t.replaceShaderImage)}const Wk={rowLength:1024};function zk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wk,n),p2.extend(t,e,n),t.setFragmentShaderTemplate(Gk),e.UBO=So.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},Ue(e.lutBuildTime,{mtime:0}),e.imagemat=te(new Float64Array(16)),e.imagematinv=te(new Float64Array(16)),e.VBOBuildTime={},Ue(e.VBOBuildTime),Ak(t,e)}const $k=Le(zk,"vtkWebGPUImageMapper");Os("vtkImageMapper",$k);function jk(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix(),a=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-a[0],e.bufferShift[1]=r[7]-a[1],e.bufferShift[2]=r[11]-a[2],me(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?te(e.keyMatrices.normalMatrix):(Ze(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,lt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),me(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),at(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),at(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const Hk={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function Kk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hk,n),st.extend(t,e,n),e.keyMatricesTime={},Ue(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},Ue(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:te(new Float64Array(16))},e.bufferShift=[0,0,0,0],Xt(t,e,["propID","keyMatricesTime"]),jk(t,e)}const qk=Le(Kk,"vtkWebGPUImageSlice");Os("vtkImageSlice",qk);function Xk(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=a=>{!e.renderable||!e.renderable.getVisibility()||a&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(a,i)=>{if(a){if(!e.renderable||!e.renderable.getVisibility())return;const s=e.renderable.getMapper().getBounds();if(!s||s.length!==6||s[0]>s[1])return;i.addVolume(t)}};const n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=(a,i)=>{const s=e.renderable.getMapper().getInputData();if(!s)return;const o=s.getExtent(),c=e.renderable.getMatrix();let l=0;for(let f=4;f<6;f++){n[2]=o[f];for(let u=2;u<4;u++){n[1]=o[u];for(let g=0;g<2;g++){n[0]=o[g],s.indexToWorld(n,r);let p=i+l*3;a[p++]=c[0]*r[0]+c[1]*r[1]+c[2]*r[2]+c[3],a[p++]=c[4]*r[0]+c[5]*r[1]+c[6]*r[2]+c[7],a[p++]=c[8]*r[0]+c[9]*r[1]+c[10]*r[2]+c[11],l++}}}},t.getKeyMatrices=a=>{if(Math.max(e.renderable.getMTime(),a.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const i=e.renderable.getMatrix(),s=a.getStabilizedCenterByReference();me(e.keyMatrices.bcwc,i),at(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-s[0],-s[1],-s[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const Yk={propID:void 0,keyMatricesTime:null};function Zk(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yk,n),st.extend(t,e,n),e.keyMatricesTime={},O.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},O.get(t,e,["propID","keyMatricesTime"]),Xk(t,e)}const Qk=O.newInstance(Zk,"vtkWebGPUVolume");Os("vtkVolume",Qk);function Jk(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const a=e.WebGPURenderer.getAspectRatio(),i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),i,a,s,o)}}const eU={};function tU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eU,n),st.extend(t,e,n),Jk(t,e)}const nU=O.newInstance(tU,"vtkWebGPUPixelSpaceCallbackMapper");Os("vtkPixelSpaceCallbackMapper",nU);class ev{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numTimePoints=null;const{imageIds:n,scaling:r,dimensions:a,spacing:i,origin:s,direction:o,dataType:c,volumeId:l,referencedVolumeId:f,metadata:u,referencedImageIds:g,additionalDetails:p,voxelManager:h,numberOfComponents:d}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:m}=e;this.imageIds=n,this.volumeId=l,this.metadata=u,this.dimensions=a,this.spacing=i,this.origin=s,this.direction=o,this.dataType=c,this.vtkOpenGLTexture=RN.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=h??Ke.createImageVolumeVoxelManager({dimensions:a,imageIds:n,numberOfComponents:d}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],m||(m=f5.newInstance(),m.setDimensions(a),m.setSpacing(i),m.setDirection(o),m.setOrigin(s)),m.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:d||1}),m.set({hasScalarVolume:!1}),this.imageData=m,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),r&&(this.scaling=r),f&&(this.referencedVolumeId=f),g&&(this.referencedImageIds=g),p&&(this.additionalDetails=p)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,n)=>{const r=zn(e);this._imageIdsIndexMap.set(e,n),this._imageURIsIndexMap.set(r,n)})}isDynamicVolume(){return this.numTimePoints>1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){ie.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(n=>ie.getImage(n))}}function tv(t){const e=t[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:a,highBit:i,photometricInterpretation:s,samplesPerPixel:o}=Z("imagePixelModule",e),c=[],l=Z("voiLutModule",e);let f;if(l){const{windowWidth:C,windowCenter:y}=l;if(f=l==null?void 0:l.voiLUTFunction,Array.isArray(C))for(let T=0;T<C.length;T++)c.push({windowWidth:C[T],windowCenter:y[T]});else c.push({windowWidth:C,windowCenter:y})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:g}=Z("generalSeriesModule",e),{imageOrientationPatient:p,pixelSpacing:h,frameOfReferenceUID:d,columns:m,rows:v}=Z("imagePlaneModule",e);return{BitsAllocated:r,BitsStored:a,SamplesPerPixel:o,HighBit:i,PhotometricInterpretation:s,PixelRepresentation:n,Modality:u,ImageOrientationPatient:p,PixelSpacing:h,FrameOfReferenceUID:d,Columns:m,Rows:v,voiLut:c,VOILUTFunction:f,SeriesInstanceUID:g}}function nv(t,e){const{imagePositionPatient:n,imageOrientationPatient:r}=Z("imagePlaneModule",t[0]);if(!e){const h=Qe(r[0],r[1],r[2]),d=Qe(r[3],r[4],r[5]);e=ne(),ut(e,h,d)}const a=ne(),i=t[0].split(":")[0]==="wadouri";Ee(a,n[0],n[1],n[2]);let s,o;function c(h){const{imagePositionPatient:d}=Z("imagePlaneModule",h),m=ne();return jt(m,n,d),Ve(m,e)}if(i){const h=[t[0],t[Math.floor(t.length/2)]];s=t;const d=c(h[0]),m=c(h[1]);d-m<0&&s.reverse();const v=Z("imagePlaneModule",h[1]);if(!v)throw new Error("Incomplete metadata required for volume construction.");const C=ne();jt(C,n,v.imagePositionPatient);const y=Ve(C,e);o=Math.abs(y)/Math.floor(t.length/2)}else{const h=t.map(m=>({distance:c(m),imageId:m}));h.sort((m,v)=>v.distance-m.distance),s=h.map(m=>m.imageId);const d=h.length;o=Math.abs(h[d-1].distance-h[0].distance)/(d-1)}const{imagePositionPatient:l,sliceThickness:f,spacingBetweenSlices:u}=Z("imagePlaneModule",s[0]),{strictZSpacingForVolumeViewport:g}=E5().rendering;return o===0&&!g&&(f&&u?(console.log("Could not calculate zSpacing. Using spacingBetweenSlices"),o=u):f?(console.log("Could not calculate zSpacing and no spacingBetweenSlices. Using sliceThickness"),o=f):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),o=1)),{zSpacing:o,origin:l,sortedImageIds:s}}function rv(t){const e=Z("modalityLutModule",t)||{},n=Z("generalSeriesModule",t)||{},{modality:r}=n,a={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:r},i=Z("scalingModule",t)||{};return{...a,...r==="PT"&&{suvbw:i.suvbw,suvbsa:i.suvbsa,suvlbm:i.suvlbm}}}const _5=t=>Object.values(t).some(n=>typeof n=="number"&&!Number.isInteger(n));function av(t,e){const n=tv(t),{ImageOrientationPatient:r,PixelSpacing:a,Columns:i,Rows:s}=n,o=Qe(r[0],r[1],r[2]),c=Qe(r[3],r[4],r[5]),l=ne();ut(l,o,c);const{zSpacing:f,origin:u,sortedImageIds:g}=nv(t,l),p=t.length,h=[a[1],a[0],f],d=[i,s,p].map(v=>Math.floor(v)),m=[...o,...c,...l];return{dimensions:d,spacing:h,origin:u,dataType:rU(g,n),direction:m,metadata:n,imageIds:g,volumeId:e,voxelManager:null,numberOfComponents:n.PhotometricInterpretation==="RGB"?3:1}}function rU(t,e){const{BitsAllocated:n,PixelRepresentation:r}=e,a=r===1,[i,s,o]=[0,Math.floor(t.length/2),t.length-1],c=[i,s,o].map(g=>rv(t[g])),l=c.some(g=>g.rescaleIntercept<0||g.rescaleSlope<0),f=c.some(g=>_5(g)),u=w5();switch(n){case 8:if(a)throw new Error("8 Bit signed images are not yet supported by this plugin.");return"Uint8Array";case 16:return u&&f?"Float32Array":a||l?"Int16Array":!a&&!l?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";default:throw new Error(`Bits allocated of ${n} is not defined to generate scalarData for the volume.`)}}let $l=class iv{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const n=new iv("as iterator");return e.then(r=>{try{n.add(r,!0)}catch(a){n.reject(a)}},r=>{n.reject(r)}),n}add(e,n=!1){this.nextValue=e,this.done||(this.done=n),this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){var n;this.rejectReason=e,(n=this.waiting)==null||n.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,n)=>{this.waiting.resolve=e,this.waiting.reject=n})),await this.waiting.promise}yield this.nextValue}async forEach(e,n){let r=0;try{for await(const a of this){const{done:i}=this;try{await e(a,i,r),r++}catch(s){if(!i){console.warn("Caught exception in intermediate value",s);continue}if(n)n(s,i);else throw s}}}catch(a){if(n)n(a,!0);else throw a}}generate(e,n){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},r=>{this.reject(r),n?n(r):console.warn("Couldn't process because",r)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const kf=new Map,Oh="imageRetrieveConfiguration",Qo={IMAGE_RETRIEVE_CONFIGURATION:Oh,clear:()=>{kf.clear()},add:(t,e)=>{kf.set(t,e)},get:(t,...e)=>{if(t===Oh)return e.map(n=>kf.get(n)).find(n=>n!==void 0)}};xs(Qo.get.bind(Qo));function sv(t){const e=Du(),n=[];return e.forEach(r=>{const i=r.getVolumeViewports().filter(s=>s.hasVolumeId(t));n.push(...i)}),n}const h2=t=>{const e=aU(t);e!=null&&e.length&&e.forEach(({renderingEngine:n,viewportIds:r})=>{n.hasBeenDestroyed||n.renderViewports(r)})};function aU(t){const e=Du(),n=[];return e.forEach(r=>{const a=sv(t);a.length&&n.push({renderingEngine:r,viewportIds:a.map(i=>i.id)})}),n}const Mh=[{id:"initialImages",retrieveType:"single"}],iU=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],Uf=[{offset:-1,imageQualityStatus:fn.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:fn.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:fn.FAR_REPLICATE}],sU=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:se.Thumbnail,priority:5,nearbyFrames:Uf},{id:"quarterThumb",decimate:4,offset:3,requestType:se.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:Uf},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:se.Thumbnail,retrieveType:"multipleFast",nearbyFrames:Uf},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:se.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:se.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:se.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:se.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function ov(t,e,n=0){const r=[];for(let a=n;a<t.length;a+=e)r.push(a);return r}function oU(t,e,n){var r;if((r=e==null?void 0:e.nearbyRequests)!=null&&r.length)for(const a of e.nearbyRequests)try{const{itemId:i,imageQualityStatus:s}=a,o=ie.getImageQuality(i);if(o!==void 0&&o>=s)continue;const c={...n,imageId:i,imageQualityStatus:s};ie.setPartialImage(i,c),t.successCallback(i,c)}catch(i){console.warn("Couldn't fill nearby item ",a.itemId,i)}}const zi=class zi{constructor(e){this.stages=e.stages||Mh,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,n){return new cU(this,e,n).loadImages()}};zi.createProgressive=cv,zi.interleavedRetrieveStages={stages:sU},zi.singleRetrieveStages={stages:Mh},zi.sequentialRetrieveStages={stages:iU};let jl=zi;class cU{constructor(e,n,r){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new $l("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=n,this.listener=r}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const n of e)this.addRequest(n);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,n){const{imageId:r,next:a}=e,i=(f,u)=>{this.listener.errorCallback(r,c||!a,f),u&&this.updateStageStatus(e.stage,f)},s=(n.loader||ci)(r,n),o=$l.as(s);let c=!1;return o.forEach(async(f,u)=>{const g=ie.getImageQuality(r);if(!f){console.warn("No image retrieved",r);return}const{imageQualityStatus:p}=f;if(c||(c=p===fn.FULL_RESOLUTION),g!==void 0&&g>p){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(r,f),this.displayedIterator.add(f),u&&this.updateStageStatus(e.stage),oU(this.listener,e,f)},i).finally(()=>{if(!c&&a)ie.setPartialImage(r),this.addRequest(a,n.streamingData);else{c||this.listener.errorCallback(r,!0,"Couldn't decode"),this.outstandingRequests--;for(let f=a;f;f=f.next)this.updateStageStatus(f.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),o.getDonePromise().catch(f=>null)}addRequest(e,n={}){const{imageId:r,stage:a}=e,i=this.listener.getLoaderImageOptions(r);if(!i)return;const{retrieveType:s="default"}=a,{retrieveOptions:o}=this,c=o[s]||o.default,l={...i,retrieveType:s,retrieveOptions:c,streamingData:n},f=a.priority??-5,u=a.requestType||se.Interaction,g={imageId:r};or.addRequest(this.sendRequest.bind(this,e,l),u,g,f)}updateStageStatus(e,n,r=!1){const{id:a}=e,i=this.stageStatusMap.get(a);if(i&&(i.imageLoadPendingCount--,n?i.imageLoadFailedCount++:r||i.totalImageCount++,!r&&!i.stageStartTime&&(i.stageStartTime=Date.now()),!i.imageLoadPendingCount)){const{imageLoadFailedCount:s,totalImageCount:o,stageStartTime:c=Date.now(),startTime:l}=i,f={stageId:a,numberOfFailures:s,numberOfImages:o,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};Q(de,X.IMAGE_RETRIEVAL_STAGE,f),this.stageStatusMap.delete(a)}}createStageRequests(){const e=new Array,n=new Map,r=(a,i)=>{const s=i<0?this.imageIds.length+i:i<1?Math.floor((this.imageIds.length-1)*i):i,o=this.imageIds[s];if(!o)throw new Error(`No value found to add to requests at ${i}`);const c={imageId:o,stage:a,index:s,nearbyRequests:this.findNearbyRequests(s,a)};this.addStageStatus(a);const l=n.get(o);l?l.next=c:e.push(c),n.set(o,c)};for(const a of this.stages)(a.positions||ov(this.imageIds,a.decimate||1,a.offset??0)).forEach(s=>{r(a,s)});return e}findNearbyRequests(e,n){const r=new Array;if(!n.nearbyFrames)return r;for(const a of n.nearbyFrames){const i=e+a.offset;i<0||i>=this.imageIds.length||r.push({itemId:this.imageIds[i],imageQualityStatus:a.imageQualityStatus,index:i})}return r}addStageStatus(e){const{id:n}=e,r=this.stageStatusMap.get(n)||{stageId:n,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return r.imageLoadPendingCount++,this.stageStatusMap.set(n,r),r}}function cv(t){return new jl(t)}const Dh=se.Prefetch;class lU extends ev{constructor(e,n){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:r}=this;if(!r||!r.loading)return;r.loading=!1,r.cancelled=!0,this.clearLoadCallbacks();const a=({additionalDetails:i})=>i.volumeId!==this.volumeId;or.filterRequests(a)},this.loadStatus=n.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:n}=this,{numFrames:r}=this;for(let a=0;a<r;a++)n.setUpdatedFrame(a);this.modified(),e&&h2(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:n,framesProcessed:r,totalNumFrames:a}=e,{volumeId:i,reRenderFraction:s,loadStatus:o,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(n>this.reRenderTarget||r===a)&&(this.reRenderTarget+=s,h2(i)),r===a){o.callbacks.forEach(u=>u(e));const f={FrameOfReferenceUID:l,volumeId:i};Q(de,X.IMAGE_VOLUME_LOADING_COMPLETED,f)}}updateTextureAndTriggerEvents(e,n,r=fn.FULL_RESOLUTION){const a=this.imageIdIndexToFrameIndex(e),{cachedFrames:i,numFrames:s,totalNumFrames:o}=this,{FrameOfReferenceUID:c}=this.metadata;if(i[a]>r||i[a]===fn.FULL_RESOLUTION)return;const f=r===fn.FULL_RESOLUTION;i[e]=r,this.framesUpdated++,f&&(this.framesLoaded++,this.framesProcessed++);const u={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:s,framesProcessed:this.framesProcessed};Q(de,X.IMAGE_VOLUME_MODIFIED,u),f&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:s,totalNumFrames:o,complete:f,imageQualityStatus:r}),this.vtkOpenGLTexture.setUpdatedFrame(a),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,n){const r=this.getImageIdIndex(e),{imageQualityStatus:a}=n;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",r);return}this.updateTextureAndTriggerEvents(r,e,a),this.isDynamicVolume()&&this.checkTimePointCompletion(r)}errorCallback(e,n,r){if(!n)return;const{totalNumFrames:a,numFrames:i}=this,s=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===a&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:s,error:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:i,totalNumFrames:a}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const o={error:r,imageIdIndex:s,imageId:e};Q(de,X.IMAGE_LOAD_ERROR,o)}load(e){const{imageIds:n,loadStatus:r,numFrames:a}=this,{transferSyntaxUID:i}=Z("transferSyntax",n[0])||{},s=Z(Qo.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,i,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:s?(s.create||jl.createProgressive)(s):this,r.loading===!0)return;const{loaded:o}=this.loadStatus,c=n.length;if(o){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:a,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:n}=Z("transferSyntax",e)||{},r=Z("imagePlaneModule",e)||{},{rows:a,columns:i}=r,s=this.getImageIdIndex(e),o=Z("modalityLutModule",e)||{},c=Z("generalSeriesModule",e)||{},l={rescaleSlope:o.rescaleSlope,rescaleIntercept:o.rescaleIntercept,modality:c.modality};if(l.modality==="PT"){const p=Z("scalingModule",e);p&&(this._addScalingToVolume(p),l.suvbw=p.suvbw)}const f=_5(l),u=w5();if(this.isPreScaled=!0,l&&l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:p,rescaleIntercept:h}=l;this.isPreScaled=typeof p=="number"&&typeof h=="number"}return!u&&f&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:a,columns:i},allowFloatRendering:u,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:Dh,transferSyntaxUID:n,additionalDetails:{imageId:e,imageIdIndex:s,volumeId:this.volumeId}}}callLoadImage(e,n,r){const{cachedFrames:a}=this;if(a[n]===fn.FULL_RESOLUTION)return;const i=o=>{const{image:c}=o.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(n),de.removeEventListener(X.IMAGE_CACHE_IMAGE_ADDED,i))};return de.addEventListener(X.IMAGE_CACHE_IMAGE_ADDED,i),$l.as(ci(e,r)).forEach(o=>{this.successCallback(e,o)},this.errorCallback.bind(this,n,e))}getImageIdsRequests(e,n){this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),e.map(i=>{const s=this.getImageIdIndex(i),o=Dh,c=n,l=this.getLoaderImageOptions(i);return{callLoadImage:this.callLoadImage.bind(this),imageId:i,imageIdIndex:s,options:l,priority:c,requestType:o,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(n=>{if(!n)return;const{callLoadImage:r,imageId:a,imageIdIndex:i,options:s,priority:o,requestType:c,additionalDetails:l}=n;or.addRequest(r.bind(this,a,i,s),c,l,o)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(r=>{console.debug("progressive loading failed to complete",r)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:n,suvlbm:r,suvbsa:a}=e,i={};r&&(i.suvbwToSuvlbm=r/n),a&&(i.suvbwToSuvbsa=a/n),n&&(i.suvbw=n),this.scaling={PT:i}}checkTimePointCompletion(e){}}class uU extends lU{constructor(e,n){e.imageIds||(e.imageIds=n.imageIds),super(e,n),this.getImageIdsToLoad=()=>{const{imageIds:r}=this;return this.numFrames=r.length,r}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:n}=this;return this.getImageIdsRequests(n,e)}}function fU(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function n(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[h,d]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],m=[0,h,d];await Promise.all(m.map(v=>new Promise((C,y)=>{const T=e.imageIds[v];or.addRequest(async()=>{RS(T).then(()=>{console.log(`Prefetched imageId: ${T}`),C(!0)}).catch(x=>{y(x)})},se.Prefetch,{volumeId:t},1)}))).catch(console.error)}const a=av(e.imageIds,t),{dimensions:i,spacing:s,origin:o,direction:c,metadata:l,imageIds:f,dataType:u,numberOfComponents:g}=a;return new uU({volumeId:t,metadata:l,dimensions:i,spacing:s,origin:o,direction:c,imageIds:f,dataType:u,numberOfComponents:g},{imageIds:f,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const r=n();return{promise:r,decache:()=>{r.then(a=>{a.destroy(),a=null})},cancel:()=>{r.then(a=>{a.cancelLoading()})}}}const lv={};let Wc=fU;function uv(t,e){const n=t.indexOf(":"),r=t.substring(0,n);let a=lv[r];if(a==null){if(Wc==null||typeof Wc!="function")throw new Error(`No volume loader for scheme ${r} has been registered`);a=Wc}const i=a(t,e);return i.promise.then(function(s){Q(de,X.VOLUME_LOADED,{volume:s})},function(s){const o={volumeId:t,error:s};Q(de,X.VOLUME_LOADED_FAILED,o)}),i}function gU(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=ie.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=uv(t,e),n.promise.then(r=>r))}async function pU(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=ie.getVolumeLoadObject(t);return n!==void 0||(n=uv(t,e),ie.putVolumeLoadObject(t,n)),n.promise}function dU(){return Object.keys(lv)}function hU(){return Wc.name}function mU(t,e){const n=xN.newInstance();E5().rendering.preferSizeOverAccuracy&&n.setPreferSizeOverAccuracy(!0),n.setInputData(t);const r=t.getSpacing(),a=(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(a),n.setScalarTexture(e),n}function fv(t){let e=t[0],n=t[0],r;const a=t.length;for(let i=1;i<a;i++)r=t[i],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const vU=0,yU=se.Prefetch;async function N5(t,e){let n=TU(e);!n&&e.imageIds.length&&(n=await xU(e),n=CU(e,n)),!(n.lower===0&&n.upper===0||n.lower===void 0||n.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(n.lower,n.upper)}function CU(t,e){const n=t.imageIds,r=Math.floor(n.length/2),a=n[r],i=Z("generalSeriesModule",a)||{};return SU(i.modality,t)?{lower:0,upper:5}:e}function TU(t){const{imageIds:e,metadata:n}=t;let r;if(e.length){const a=Math.floor(e.length/2),i=e[a],s=Z("voiLutModule",i);if(s!=null&&s.windowWidth&&s.windowCenter){const{windowWidth:o,windowCenter:c}=s,l=Array.isArray(o)?o[0]:o,f=Array.isArray(c)?c[0]:c;l!==0&&(r={windowWidth:l,windowCenter:f})}}else r=n.voiLut[0];if(r&&(r.windowWidth!==0||r.windowCenter!==0)){const{lower:a,upper:i}=xo(Number(r.windowWidth),Number(r.windowCenter));return{lower:a,upper:i}}}async function xU(t){var h;const{imageIds:e}=t,n=Math.floor(e.length/2),r=t.imageIds[n],a=Z("generalSeriesModule",r)||{},{modality:i}=a,s=Z("modalityLutModule",r)||{},o={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:i};let c;if(i==="PT"){const d=Z("scalingModule",r);d&&(c={...o,suvbw:d.suvbw})}const l={priority:vU,requestType:yU,preScale:{scalingParameters:c}};let f=ie.getImage(r);(h=t.referencedImageIds)!=null&&h.length||(f=await ci(r,{...l,ignoreCache:!0}));const u=f.getPixelData(),{min:g,max:p}=fv(u);return{lower:g,upper:p}}function SU(t,e){var n;return!(t!=="PT"||!e.isPreScaled||!((n=e.scaling)!=null&&n.PT.suvbw))}async function Vh(t,e,n,r=!1){const{volumeId:a,callback:i,blendMode:s}=t,o=await gU(a);if(!o)throw new Error(`imageVolume with id: ${o.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=o,f=mU(c,l);s&&f.setBlendMode(s);const u=EI.newInstance();u.setMapper(f);const{numberOfComponents:g}=c.get("numberOfComponents");return u.getProperty().set({viewportId:n}),g===3&&u.getProperty().setIndependentComponents(!1),await N5(u,o),i&&i({volumeActor:u,volumeId:a}),r||wU(e,n,u,a),u}function wU(t,e,n,r){const a=n.getProperty().getRGBTransferFunction(0).getRange(),i={viewportId:e,range:{lower:a[0],upper:a[1]},volumeId:r};Q(t,X.VOI_MODIFIED,i)}const gv=t=>{const e="volumeId:",n=t.includes(e)?t.substring(e.length):t,r=n.indexOf("sliceIndex=");return r===-1?n:n.substring(0,r-1)},EU=1+Ir,RU=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),Lh=t=>!!dU().find(e=>RU(t.volumeId,e));function I5(t,e,n,r=!1){const{viewPlaneNormal:a}=e,i=t.getActors();if(!i.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s=i.map(l=>{const f=l.referencedId??l.uid;return ie.getVolume(f)}).filter(l=>!!l);if(n){const l=gv(n),f=s.findIndex(h=>l.includes(h.volumeId)),u=s[f],{uid:g}=i[f],p=_h(u,a,t,r);return{imageVolume:u,spacingInNormalDirection:p,actorUID:g}}if(!s.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const o={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=s.find(Lh);for(let l=0;l<s.length;l++){const f=s[l];if(c&&!Lh(f))continue;const u=_h(f,a,t);u*EU<o.spacingInNormalDirection&&(o.spacingInNormalDirection=u,o.imageVolume=f,o.actorUID=i[l].uid)}return o}function _h(t,e,n,r=!1){const{slabThickness:a}=n.getProperties();let i=a;return(!a||!r)&&(i=ps(t,e)),i}function Hl(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=I5(t,e);if(!r)return;const{viewPlaneNormal:a,focalPoint:i}=e,s=t.getActors().find(h=>h.referencedId===r.volumeId||h.uid===r.volumeId);s||console.warn("No actor found for with actorUID of",r.volumeId);const o=s.actor,c=Mu(o,a,i),{min:l,max:f,current:u}=c,g=Math.round((f-l)/n)+1;let p=(u-l)/(f-l)*g;return p=Math.floor(p),p>g-1?p=g-1:p<0&&(p=0),{numberOfSlices:g,imageIndex:p}}const Ai={};function OU(t){Ai[t]!==void 0&&delete Ai[t]}function MU(t){const{renderingEngineId:e,viewportId:n}=t.detail,a=y0(e).getViewport(n);if(!("setVolumes"in a))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");Ai[a.id]===void 0&&(Ai[a.id]=0);const i=Hl(a);if(!i){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${a.id}`);return}const{numberOfSlices:s,imageIndex:o}=i;if(Ai[a.id]===o)return;Ai[a.id]=o;const c={imageIndex:o,viewportId:n,renderingEngineId:e,numberOfSlices:s};Q(a.element,X.VOLUME_NEW_IMAGE,c)}function pv(t,e,n){const[r,a,i]=t,[s,o,c]=e,[l,f,u,g]=n,p=s-r,h=o-a,d=c-i,m=-1*(l*r+f*a+u*i-g)/(l*p+f*h+u*d),v=p*m+r,C=h*m+a,y=d*m+i;return[v,C,y]}function dv(t,e,n=!1){const[r,a,i]=t,s=r*e[0]+a*e[1]+i*e[2];if(n){const o=Math.sqrt(r*r+a*a+i*i);return[r/o,a/o,i/o,s/o]}return[r,a,i,s]}function DU(t,e,n){const[r,a,i,s]=t,[o,c,l,f]=e,[u,g,p,h]=n,d=Ys(r,o,u,a,c,g,i,l,p),m=Ys(s,f,h,a,c,g,i,l,p),v=Ys(r,o,u,s,f,h,i,l,p),C=Ys(r,o,u,a,c,g,s,f,h),y=Na(m)/Na(d),T=Na(v)/Na(d),x=Na(C)/Na(d);return[y,T,x]}function hv(t,e,n=!1){const[r,a,i,s]=t,[o,c,l]=e,f=r*o+a*c+i*l-s,u=Math.abs(f)/Math.sqrt(r*r+a*a+i*i);return(n?Math.sign(f):1)*u}const VU=Object.freeze(Object.defineProperty({__proto__:null,linePlaneIntersection:pv,planeDistanceToPoint:hv,planeEquation:dv,threePlaneIntersection:DU},Symbol.toStringTag,{value:"Module"}));function m2(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function Jo(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(Jo);{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=Jo(t[n]));return e}}const Ro=class Ro{constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=Wt.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=n=>{},this.viewportWidgets=new Map,this.addWidget=(n,r)=>{this.viewportWidgets.set(n,r)},this.getWidget=n=>this.viewportWidgets.get(n),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(r=>{if(r.getEnabled()&&r.setEnabled(!1),r.getActor&&r.getRenderer){const a=r.getActor(),i=r.getRenderer();i&&a&&i.removeActor(a)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=Jo(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=Jo(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===Wt.NO_DATA||this.viewportStatus===Wt.LOADING||(this.viewportStatus=Wt.RENDERED)}getRenderingEngine(){return Ho.get(this.renderingEngineId)}getRenderer(){var n;const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return(n=e.offscreenMultiRenderWindow)==null?void 0:n.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){var r,a;this.options=structuredClone(e),(r=this.options)!=null&&r.displayArea&&this.setDisplayArea((a=this.options)==null?void 0:a.displayArea),n&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;const a=this.getCamera(),{viewPlaneNormal:i,viewUp:s,focalPoint:o,position:c}=a,l=ut(ne(),i,s);let f=jo(ne(),s);const u=Ya(ne(),i),g=R8(c,o),h=r.getDimensions().map(x=>Math.floor(x/2)),d=[h[0],h[1],h[2]],m=r.indexToWorld(d,ne()),v=this._getFocalPointForResetCamera(m,a,{resetPan:!0,resetToCenter:!1}),C=Nt(ne(),o,v),y=ua(C),T=x=>{const S=c0(ne(),x,2*Ve(C,x));return Nt(S,S,C),kt(S,S),S};if(e){const x=T(f),S=zt(ne(),v,x,y),w=zt(ne(),S,u,g);this.setCamera({viewPlaneNormal:u,position:w,focalPoint:S}),this.flipHorizontal=!this.flipHorizontal}if(n){f=Ya(f,s);const x=T(l),S=zt(ne(),v,x,y),w=zt(ne(),S,u,g);this.setCamera({focalPoint:S,viewPlaneNormal:u,viewUp:f,position:w}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&nr(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const n=this.getActors();let r=n[0];return e&&(r=n.find(i=>i.referencedId===e)),!r||!nr(r)?null:r.actor}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors(),this.addActors(e,{resetCamera:!0})}_removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist for this viewport`);return}this.getRenderer().removeViewProp(n.actor),this._actors.delete(e)}removeActors(e){e.forEach(n=>{this._removeActor(n)})}addActors(e,n={}){const{resetCamera:r=!1}=n,a=this.getRenderingEngine();if(!a||a.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(o=>{this.addActor(o)});const i=this.getViewPresentation(),s=this.getViewReference();this.resetCamera(),r||(this.setViewReference(s),this.setViewPresentation(i))}addActor(e){const{uid:n,actor:r}=e,a=this.getRenderingEngine();if(!a||a.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}const i=this.getRenderer();i==null||i.addActor(r),this._actors.set(n,Object.assign({},e)),this.updateCameraClippingPlanesAndRange()}removeAllActors(){var e;(e=this.getRenderer())==null||e.removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,n,r){const a=r[0],i=r[1],s=r[2],o=a*n[0]+i*n[1]+s*n[2],c=e.getBounds(),l=this._getEdges(c),f=[];for(const u of l){const[[g,p,h],[d,m,v]]=u;if(a*(d-g)+i*(m-p)+s*(v-h)===0)continue;const C=pv([g,p,h],[d,m,v],[a,i,s,o]);this._isInBounds(C,c)&&f.push(C)}return f}setInterpolationType(e,n){}setDisplayArea(e,n=!1){var s;if(!e)return;const{storeAsInitialCamera:r,type:a}=e;r&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:i}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),a==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(((s=this.getProperties())==null?void 0:s.interpolationType)??xr.LINEAR),this.setDisplayAreaFit(e)),r&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=i,!n&&!i){const o={viewportId:this.id,displayArea:e,storeAsInitialCamera:r};Q(this.element,X.DISPLAY_AREA_MODIFIED,o),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:n=1}=e,r=this.canvas,a=r.height,i=r.width;if(a<8||i<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(xr.NEAREST),this.setCamera({parallelScale:a*c/(2*n)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:f,viewUp:u,viewPlaneNormal:g}=this.getCamera(),p=ne();if(r.height%2&&zt(p,p,u,n*.5*c),r.width%2){const h=ut(ne(),u,g);zt(p,p,h,n*.5*c)}!p[0]&&!p[1]&&!p[2]||this.setCamera({focalPoint:pn(ne(),l,p),position:pn(ne(),f,p)})}setDisplayAreaFit(e){const{imageArea:n,imageCanvasPoint:r}=e,a=(window==null?void 0:window.devicePixelRatio)||1,i=this.getDefaultImageData();if(!i)return;const s=this.sWidth/a,o=this.sHeight/a,c=i.getDimensions(),l=this.worldToCanvas(i.indexToWorld([0,0,0])),f=this.worldToCanvas(i.indexToWorld([c[0]-1,c[1]-1,c[2]])),u=[Math.abs(f[0]-l[0]),Math.abs(f[1]-l[1])],[g,p]=u;if(n){const[h,d]=n,m=Math.abs(h*g/s),v=Math.abs(d*p/o),C=this.getZoom(),y=this.getZoom(this.fitToCanvasCamera),x=Math.min(1/m,1/v)*C/y;this.setZoom(x,!1)}if(r){const{imagePoint:h,canvasPoint:d=h||[.5,.5]}=r,[m,v]=d,C=s*(m-.5),y=o*(v-.5),[T,x]=h||d,S=1,w=S*g*(.5-T),E=S*p*(.5-x),L=w+C,R=E+y,D=[L,R];Vg(D,D,this.getPan()),this.setPan(D,!1)}}getDisplayArea(){var e;return(e=this.options)==null?void 0:e.displayArea}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetToCenter:a=!0,storeAsInitialCamera:i=!0}=e||{},s=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const o=this.getCamera(),c=s.computeVisiblePropBounds(),l=[0,0,0],f=this.getDefaultImageData();if(f){const b=f.getSpacing();c[0]=c[0]+b[0]/2,c[1]=c[1]-b[0]/2,c[2]=c[2]+b[1]/2,c[3]=c[3]-b[1]/2,c[4]=c[4]+b[2]/2,c[5]=c[5]-b[2]/2}const u=this.getVtkActiveCamera(),g=u.getViewPlaneNormal(),p=u.getViewUp();if(l[0]=(c[0]+c[1])/2,l[1]=(c[2]+c[3])/2,l[2]=(c[4]+c[5])/2,f){const F=f.getDimensions().map(P=>Math.floor(P/2)),W=[F[0],F[1],F[2]];f.indexToWorld(W,l)}const{widthWorld:h,heightWorld:d}=this._getWorldDistanceViewUpAndViewRight(c,p,g),m=[this.sWidth,this.sHeight],v=h/d,C=m[0]/m[1],y=v/C,T=y<1?this.insetImageMultiplier*d/2:this.insetImageMultiplier*d*y/2,x=Ro.boundsRadius(c)*(this.type===Ae.VOLUME_3D?10:1),S=this.insetImageMultiplier*x,w=Math.abs(bn.dot(p,g))>.999?[-p[2],p[0],p[1]]:p,E=this._getFocalPointForResetCamera(l,o,{resetPan:n,resetToCenter:a}),L=[E[0]+S*g[0],E[1]+S*g[1],E[2]+S*g[2]];s.resetCameraClippingRange(c);const R=[-Xe.MAXIMUM_RAY_DISTANCE,Xe.MAXIMUM_RAY_DISTANCE];u.setPhysicalScale(x),u.setPhysicalTranslation(-E[0],-E[1],-E[2]),this.setCamera({parallelScale:r?T:o.parallelScale,focalPoint:E,position:L,viewAngle:90,viewUp:w,clippingRange:R});const D=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),i&&this.setInitialCamera(D),r&&this.setZoom(1,i);const I={type:"ResetCameraEvent",renderer:s};return s.invokeEvent(I),this.triggerCameraModifiedEventIfNecessary(o,D),f&&this.options.displayArea&&r&&n&&a&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const r=this.getVtkActiveCamera().getFocalPoint(),a=this.canvasToWorld([0,0]),i=this.worldToCanvas(Nt([0,0,0],e.focalPoint,a)),s=this.worldToCanvas(Nt([0,0,0],r,a));return Cl([0,0],i,s)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:a,position:i}=r,s=this.canvasToWorld([0,0]),o=Cl([0,0],e,this.getPan());if(Math.abs(o[0])<1&&Math.abs(o[1])<1&&!n)return;const c=Nt(ne(),this.canvasToWorld(o),s),l=Nt(ne(),a,c),f=Nt(ne(),i,c);this.setCamera({...r,focalPoint:l,position:f},n)}getZoom(e=this.initialCamera){if(!e)return 1;const n=this.getVtkActiveCamera(),{parallelScale:r}=e;return r/n.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:a}=this.initialCamera,i=a/e;r.parallelScale===i&&!n||this.setCamera({...r,parallelScale:i},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),a=this._getViewImageDataIntersections(e,n,r);let i=0,s=0,o=0;return a.forEach(([l,f,u])=>{i+=l,s+=f,o+=u}),[i/a.length,s/a.length,o/a.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){return this.getRenderer().getActiveCamera()}getCameraNoRotation(){const e=this.getVtkActiveCamera(),n=(o,c)=>o.some(l=>isNaN(l))?c:o,r=n([...e.getViewUp()],[0,1,0]),a=n([...e.getViewPlaneNormal()],[0,0,-1]),i=n([...e.getPosition()],[0,0,1]),s=n([...e.getFocalPoint()],[0,0,0]);return{viewUp:r,viewPlaneNormal:a,position:i,focalPoint:s,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,n=!1){const r=this.getVtkActiveCamera(),a=this.getCamera(),i=Object.assign({},a,e),{viewUp:s,viewPlaneNormal:o,position:c,focalPoint:l,parallelScale:f,viewAngle:u,flipHorizontal:g,flipVertical:p,clippingRange:h}=e;if(g!==void 0){const v=g&&!this.flipHorizontal||!g&&this.flipHorizontal;v&&this.flip({flipHorizontal:v})}if(p!==void 0){const v=p&&!this.flipVertical||!p&&this.flipVertical;v&&this.flip({flipVertical:v})}s!==void 0&&r.setViewUp(s),o!==void 0&&r.setDirectionOfProjection(-o[0],-o[1],-o[2]),c!==void 0&&r.setPosition(...c),l!==void 0&&r.setFocalPoint(...l),f!==void 0&&r.setParallelScale(f),u!==void 0&&r.setViewAngle(u),h!==void 0&&r.setClippingRange(h);const d=a.focalPoint,m=a.viewUp;if(d&&l||m&&s){const v=r.getViewPlaneNormal(),C=r.getViewUp();let y=!1,T=!1;if(l){const x=[l[0]-d[0],l[1]-d[1],l[2]-d[2]];y=Math.abs(bn.dot(x,v))>0}if(s&&(T=!yt(C,m)),y||T){const x=this.getDefaultActor();if(!(x!=null&&x.actor))return;an(x,"vtkActor")||this.updateClippingPlanesForActors(i),(an(x,"vtkImageSlice")||this.type===Ae.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}n&&this.setInitialCamera(i),this.triggerCameraModifiedEventIfNecessary(a,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Q(this.element,X.CAMERA_MODIFIED,r)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(r=>{if(!r.actor)return;const a=r.actor.getMapper();let i=r!=null&&r.clippingFilter?r==null?void 0:r.clippingFilter.getClippingPlanes():a.getClippingPlanes();i.length===0&&(r!=null&&r.clippingFilter)&&(i=[Ft.newInstance(),Ft.newInstance()]);let s=Xe.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(s=r.slabThickness);const{viewPlaneNormal:o,focalPoint:c}=e;this.setOrientationOfClippingPlanes(i,s,o,c),Q(this.element,X.CLIPPING_PLANES_UPDATED,{actorEntry:r,focalPoint:c,vtkPlanes:i,viewport:this})})}setOrientationOfClippingPlanes(e,n,r,a){if(e.length<2)return;const i=[r[0],r[1],r[2]];bn.multiplyScalar(i,n),e[0].setNormal(r);const s=[0,0,0];bn.subtract(a,i,s),e[0].setOrigin(s),e[1].setNormal(-r[0],-r[1],-r[2]);const o=[0,0,0];bn.add(a,i,o),e[1].setOrigin(o)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const n=e.actor.getMapper();let r=e!=null&&e.clippingFilter?e==null?void 0:e.clippingFilter.getClippingPlanes():n.getClippingPlanes();return r.length===0&&(e!=null&&e.clippingFilter)&&(r=[Ft.newInstance(),Ft.newInstance()]),r}_getWorldDistanceViewUpAndViewRight(e,n,r){const a=this._getCorners(e),i=this._getCorners(e),s=ut(ne(),n,r);let o=Ha.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);a.forEach(g=>o.apply(g));let c=1/0,l=-1/0;for(let g=0;g<8;g++){const p=a[g][0];p>l&&(l=p),p<c&&(c=p)}o=Ha.buildFromDegree().identity().rotateFromDirections([s[0],s[1],s[2]],[1,0,0]),i.forEach(g=>o.apply(g));let f=1/0,u=-1/0;for(let g=0;g<8;g++){const p=i[g][0];p>u&&(u=p),p<f&&(f=p)}return{widthWorld:u-f,heightWorld:l-c}}getViewReference(e={}){const{focalPoint:n,viewPlaneNormal:r,viewUp:a}=this.getCamera();return{FrameOfReferenceUID:this.getFrameOfReferenceUID(),cameraFocalPoint:n,viewPlaneNormal:r,viewUp:a,sliceIndex:e.sliceIndex??this.getSliceIndex()}}isReferenceViewable(e,n){if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:r}=e,a=this.getCamera();return r&&!yt(r,a.viewPlaneNormal)&&!yt(Ya(a.viewPlaneNormal,a.viewPlaneNormal),r)?n==null?void 0:n.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0}){const n={},{rotation:r,displayArea:a,zoom:i,pan:s}=e;r&&(n.rotation=this.getRotation()),a&&(n.displayArea=this.getDisplayArea());const o=this.getZoom();return i&&(n.zoom=o),s&&(n.pan=this.getPan(),dd(n.pan,n.pan,1/o)),n}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:n,zoom:r=this.getZoom(),pan:a,rotation:i}=e;n!==this.getDisplayArea()&&this.setDisplayArea(n),this.setZoom(r),a&&this.setPan(dd([0,0],a,r)),i>=0&&this.setRotation(i)}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,n,{resetPan:r=!0,resetToCenter:a=!0}){if(a&&r)return e;if(a&&!r)return m2(n.focalPoint)?e:n.focalPoint;if(!a&&r){const i=n,s=i.focalPoint,o=i.viewPlaneNormal,c=Nt(ne(),e,s),l=Ve(c,o),f=zt(ne(),e,o,-1*l);return[f[0],f[1],f[2]]}if(!r&&!a)return m2(n.focalPoint)?e:n.focalPoint}_isInBounds(e,n){const[r,a,i,s,o,c]=n,[l,f,u]=e;return!(l<r||l>a||f<i||f>s||u<o||u>c)}_getEdges(e){const[n,r,a,i,s,o,c,l]=this._getCorners(e);return[[n,r],[n,s],[n,a],[r,i],[r,o],[a,i],[a,c],[i,l],[s,c],[s,o],[o,l],[c,l]]}static boundsRadius(e){const n=(e[1]-e[0])**2,r=(e[3]-e[2])**2,a=(e[5]-e[4])**2;return Math.sqrt(n+r+a||1)*.5}setDataIds(e,n){throw new Error("Unsupported operatoin setDataIds")}};Ro.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},Ro.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let ms=Ro;function mv(t,e,n=!1){const r=t.getCamera(),{focalPoint:a,viewPlaneNormal:i}=r,{spacingInNormalDirection:s,actorUID:o}=I5(t,r,e,n);if(!o)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(o);if(!c)return console.warn("No actor found for with actorUID of",o),null;const l=c.actor;return{sliceRange:Mu(l,i,a),spacingInNormalDirection:s,camera:r}}function wo(t,e,n=!1){const{sliceRange:r,spacingInNormalDirection:a,camera:i}=mv(t,e,n),{min:s,max:o,current:c}=r,l=Math.round((o-s)/a),u=(c-s)/(o-s)*l,g=Math.round(u);return{numScrollSteps:l,currentStepIndex:g,sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:a,camera:i}}}function vv(t){let e=[];const[n,r]=t.getRange();t.getTable(n,r,1024,e),e=e.filter((p,h)=>h%3===0);const a=[...Array(1024).keys()].map((p,h)=>n+(r-n)/1023*h),i=e[256],s=Math.log((1-i)/i),o=a[256],c=e[256*3],l=Math.log((1-c)/c),f=a[256*3],u=Math.round(4*(f-o)/(s-l)),g=Math.round(o+u*s/4);return[Math.round(g-u/2),Math.round(g+u/2)]}function yv(t,e){const n=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=LU(n),a=r[0],i=r[1]-r[0],s=fi.newInstance(),o=[];for(let T=0;T<n.length;T+=4){let x=n[T];const S=n[T+1],w=n[T+2],E=n[T+3];x=(x-a)/i,o.push([x,S,w,E])}_U(o,r,s),t.getProperty().setRGBTransferFunction(0,s);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=Xo.newInstance(),f=[];for(let T=0;T<c.length;T+=2){let x=c[T];const S=c[T+1];x=(x-a)/i,f.push([x,S])}NU(f,r,l);const u=t.getProperty();u.setScalarOpacity(0,l);const[g,p,h,d]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);u.setUseGradientOpacity(0,!0),u.setGradientOpacityMinimumValue(0,g),u.setGradientOpacityMinimumOpacity(0,p),u.setGradientOpacityMaximumValue(0,h),u.setGradientOpacityMaximumOpacity(0,d),e.interpolation==="1"&&u.setInterpolationTypeToFastLinear(),u.setShade(e.shade==="1");const m=parseFloat(e.ambient),v=parseFloat(e.diffuse),C=parseFloat(e.specular),y=parseFloat(e.specularPower);u.setAmbient(m),u.setDiffuse(v),u.setSpecular(C),u.setSpecularPower(y)}function LU(t){let e=1/0,n=-1/0;for(let a=0;a<t.length;a+=4)e=Math.min(e,t[a]),n=Math.max(n,t[a]);const r=(n-e)/2;return{shiftRange:[-r,r],min:e,max:n}}function _U(t,e,n){const r=e[1]-e[0],a=t.map(([i,s,o,c])=>[i*r+e[0],s,o,c]);return n.removeAllPoints(),a.forEach(([i,s,o,c])=>n.addRGBPoint(i,s,o,c)),a}function NU(t,e,n){const r=e[1]-e[0],a=t.map(([i,s])=>[i*r+e[0],s]);return n.removeAllPoints(),a.forEach(([i,s])=>n.addPoint(i,s)),a}class Lu extends ms{constructor(e){if(super(e),this.useCPURendering=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=a=>{const i=this.getPan(this.fitToCanvasCamera),s=this.getPan(),o=this.getCamera(),c=Tl([0,0],i,s);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),f=l?Ya([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:f}),this.rotateCamera(a);const u=this.getPan(),g=this.getPan(this.fitToCanvasCamera),p=Tl([0,0],u,g),h=Vg([0,0],i,p);if(this.setPan(h,!1),this._suppressCameraModifiedEvents)return;const d=this.getCamera(),m={previousCamera:o,camera:d,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Q(this.element,X.CAMERA_MODIFIED,m)},this.getDefaultProperties=a=>{let i;return a!==void 0&&(i=this.perVolumeIdDefaultProperties.get(a)),i!==void 0?i:{...this.globalDefaultProperties}},this.getProperties=a=>{var x;if(!this._getApplicableVolumeActor(a))return;const{colormap:s,VOILUTFunction:o,interpolationType:c,invert:l,slabThickness:f,preset:u}=this.viewportProperties;if(a||(a=this.getVolumeId()),!ie.getVolume(a))return null;const p=this.getActors().find(S=>S.referencedId===a);if(!p)return;const d=p.actor.getProperty().getRGBTransferFunction(0),[m,v]=((x=this.viewportProperties)==null?void 0:x.VOILUTFunction)==="SIGMOID"?vv(d):d.getRange(),C={lower:m,upper:v},y=this.getColormap(a);return{colormap:a&&y?y:s,voiRange:C,VOILUTFunction:o,interpolationType:c,invert:l,slabThickness:f,preset:u}},this.getColormap=a=>{const i=this._getApplicableVolumeActor(a);if(!i)return;const{volumeActor:s}=i,o=this._getOrCreateColorTransferFunction(a),{nodes:c}=o.getState(),l=c.reduce((u,g)=>(u.push(g.x,g.r,g.g,g.b),u),[]);return O5(l,s)},this.getRotation=()=>{const{viewUp:a,viewPlaneNormal:i,flipVertical:s}=this.getCameraNoRotation(),o=s?Ya([0,0,0],this.initialViewUp):this.initialViewUp;if(!o)return 0;const c=M8(o,a)*180/Math.PI,l=ut([0,0,0],o,a);return Ve(l,i)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=a=>{var h,d;const i=this.getVtkActiveCamera();(h=i.setIsPerformingCoordinateTransformation)==null||h.call(i,!0);const s=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[a[0]*f,a[1]*f],g=[u[0]+this.sx,u[1]+this.sy];g[1]=l[1]-g[1];const p=c.displayToWorld(g[0],g[1],0,s);return(d=i.setIsPerformingCoordinateTransformation)==null||d.call(i,!1),[p[0],p[1],p[2]]},this.worldToCanvas=a=>{var h;const i=this.getVtkActiveCamera();(h=i.setIsPerformingCoordinateTransformation)==null||h.call(i,!0);const s=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...a,s);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy],g=window.devicePixelRatio||1,p=[u[0]/g,u[1]/g];return i.setIsPerformingCoordinateTransformation(!1),p},this.hasImageURI=a=>this.getActors().filter(s=>an(s,"vtkVolume")).some(({uid:s,referencedId:o})=>{const c=ie.getVolume(o||s);return c!=null&&c.imageIds?c.imageIds.map(zn).includes(a):!1}),this.getImageIds=a=>{const i=this._getApplicableVolumeActor(a);if(!i)throw new Error(`No actor found for the given volumeId: ${a}`);const s=i.volumeId,o=ie.getVolume(s);if(!o)throw new Error(`imageVolume with id: ${s} does not exist in cache`);return o.imageIds},this.useCPURendering=Co(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const n=this.getRenderer(),r=VN.newInstance();switch(n.setActiveCamera(r),this.type){case Ae.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case Ae.VOLUME_3D:r.setParallelProjection(!0);break;case Ae.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,n=!0){const{viewPlaneNormal:r,viewUp:a}=this._getOrientationVectors(e),i=this.getVtkActiveCamera();i.setDirectionOfProjection(-r[0],-r[1],-r[2]),i.setViewUpFrom(a),this.initialViewUp=a,n&&this.resetCamera()}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=a.bind(this);function r(i){const{viewportId:s}=i.detail;s!==this.id||this.isDisabled||!this.getImageData()||MU(i)}function a(i){const{viewportId:s}=i.detail;s===this.id&&(this.element.removeEventListener(X.CAMERA_MODIFIED,e),de.removeEventListener(X.ELEMENT_DISABLED,n),OU(s))}this.element.removeEventListener(X.CAMERA_MODIFIED,e),this.element.addEventListener(X.CAMERA_MODIFIED,e),de.addEventListener(X.ELEMENT_DISABLED,n)}setVOILUTFunction(e,n,r){Object.values(Er).includes(e)||(e=Er.LINEAR);const{voiRange:a}=this.getProperties();this.setVOI(a,n,r),this.viewportProperties.VOILUTFunction=e}setColormap(e,n,r){const a=this._getApplicableVolumeActor(n);if(!a)return;const{volumeActor:i}=a,s=fi.newInstance();let o=Zo(e.name);const{name:c}=e;if(o||(o=bl.getPresetByName(c)),!o)throw new Error(`Colormap ${e} not found`);const l=i.getProperty().getRGBTransferFunction(0).getRange();if(s.applyColorMap(o),s.setMappingRange(l[0],l[1]),i.getProperty().setRGBTransferFunction(0,s),this.viewportProperties.colormap=e,!r){const f={viewportId:this.id,colormap:e,volumeId:n};Q(this.element,X.VOI_MODIFIED,f),Q(this.element,X.COLORMAP_MODIFIED,f)}}setOpacity(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:a}=r,i=Xo.newInstance();if(typeof e.opacity=="number"){const s=a.getProperty().getRGBTransferFunction(0).getRange();i.addPoint(s[0],e.opacity),i.addPoint(s[1],e.opacity)}else e.opacity.forEach(({opacity:s,value:o})=>{i.addPoint(o,s)});a.getProperty().setScalarOpacity(0,i),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity}setInvert(e,n,r){const a=this._getApplicableVolumeActor(n);if(!a)return;const i=a.volumeId,s=this._getOrCreateColorTransferFunction(i);if(To(s),this.viewportProperties.invert=e,!r){const o={...this.getVOIModifiedEventDetail(i),invertStateChanged:!0};Q(this.element,X.VOI_MODIFIED,o)}}getVOIModifiedEventDetail(e){const n=this._getApplicableVolumeActor(e);if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);const i=n.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),s=this.getColormap(e),{VOILUTFunction:o,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:i[0],upper:i[1]},volumeId:n.volumeId,VOILUTFunction:o,colormap:s,invert:c}}_getOrCreateColorTransferFunction(e){const n=this._getApplicableVolumeActor(e);if(!n)return null;const{volumeActor:r}=n,a=r.getProperty().getRGBTransferFunction(0);if(a)return a;const i=fi.newInstance();return r.getProperty().setRGBTransferFunction(0,i),i}setInterpolationType(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:a}=r;a.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,n,r=!1){const a=this._getApplicableVolumeActor(n);if(!a)return;const{volumeActor:i}=a,s=a.volumeId,o=e;if(typeof o>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");const{VOILUTFunction:c}=this.getProperties(s);if(c===Er.SAMPLED_SIGMOID){const l=D5(o);i.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:f}=o;i.getProperty().getRGBTransferFunction(0).setRange(l,f)}if(!r){const l={...this.getVOIModifiedEventDetail(s)};Q(this.element,X.VOI_MODIFIED,l)}this.viewportProperties.voiRange=o}rotateCamera(e){const n=e-this.getRotation();this.getVtkActiveCamera().roll(-n)}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(n,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const n=super.getViewReference(e),r=this.getVolumeId(e);if((e==null?void 0:e.forFrameOfReference)!==!1&&(n.volumeId=r),typeof(e==null?void 0:e.sliceIndex)!="number")return n;const{viewPlaneNormal:a}=n,i=(e==null?void 0:e.sliceIndex)-this.getSliceIndex(),{sliceRangeInfo:s}=wo(this,r,!0),{sliceRange:o,spacingInNormalDirection:c,camera:l}=s,{focalPoint:f,position:u}=l,{newFocalPoint:g}=es(f,u,o,a,c,i);return n.cameraFocalPoint=g,n}isReferenceViewable(e,n){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,n))return!1;if(n!=null&&n.withNavigation)return!0;const r=this.getSliceIndex(),{sliceIndex:a}=e;return Array.isArray(a)?a[0]<=r&&r<=a[1]:a===void 0||a===r}scroll(e=1){const n=this.getVolumeId(),{sliceRangeInfo:r}=wo(this,n,!0);if(!r)return;const{sliceRange:a,spacingInNormalDirection:i,camera:s}=r,{focalPoint:o,viewPlaneNormal:c,position:l}=s,{newFocalPoint:f,newPosition:u}=es(o,l,a,c,i,e);this.setCamera({focalPoint:f,position:u})}setViewReference(e){if(!e)return;const n=this.getVolumeId(),{viewPlaneNormal:r,FrameOfReferenceUID:a,cameraFocalPoint:i,viewUp:s}=e;let{sliceIndex:o}=e;const{focalPoint:c,viewPlaneNormal:l,position:f}=this.getCamera(),u=F8(l,r),g=yt(l,r);if(typeof o=="number"&&e.volumeId===n&&(u||g)){const{currentStepIndex:p,sliceRangeInfo:h,numScrollSteps:d}=wo(this,n,!0),{sliceRange:m,spacingInNormalDirection:v}=h;u&&(o=d-o-1);const C=o-p,{newFocalPoint:y,newPosition:T}=es(c,f,m,l,v,C);this.setCamera({focalPoint:y,position:T})}else if(a===this.getFrameOfReferenceUID()){if(r&&!u&&!g){this.setOrientation({viewPlaneNormal:r,viewUp:s}),this.setViewReference(e);return}if(i){const p=Nt([0,0,0],i,c),h=r??l,d=Ve(p,h);yt(d,0)||c0(p,h,d);const m=pn([0,0,0],c,p),v=pn([0,0,0],f,p);this.setCamera({focalPoint:m,position:v})}}else throw new Error(`Incompatible view refs: ${a}!==${this.getFrameOfReferenceUID()}`)}setProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:a,preset:i,interpolationType:s,slabThickness:o}={},c,l=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:a,preset:i,slabThickness:o}),r!==void 0&&this.viewportProperties.invert!==r&&this.setInvert(r,c,l),a!=null&&a.name&&this.setColormap(a,c,l),(a==null?void 0:a.opacity)!=null&&this.setOpacity(a,c),e!==void 0&&this.setVOI(e,c,l),typeof s<"u"&&this.setInterpolationType(s),n!==void 0&&this.setVOILUTFunction(n,c,l),i!==void 0&&this.setPreset(i,c,l),o!==void 0&&(this.setSlabThickness(o),this.viewportProperties.slabThickness=o)}resetToDefaultProperties(e){var r,a;const n=this.globalDefaultProperties;(r=n.colormap)!=null&&r.name&&this.setColormap(n.colormap,e),((a=n.colormap)==null?void 0:a.opacity)!=null&&this.setOpacity(n.colormap,e),n.voiRange!==void 0&&this.setVOI(n.voiRange,e),n.VOILUTFunction!==void 0&&this.setVOILUTFunction(n.VOILUTFunction,e),n.invert!==void 0&&this.setInvert(n.invert,e),n.slabThickness!==void 0&&(this.setSlabThickness(n.slabThickness),this.viewportProperties.slabThickness=n.slabThickness),n.preset!==void 0&&this.setPreset(n.preset,e,!1),n.preset!==void 0&&this.setPreset(n.preset,e,!1),this.render()}setPreset(e,n,r){const a=this._getApplicableVolumeActor(n);if(!a)return;const{volumeActor:i}=a;let s=e;typeof s=="string"&&(s=MS.find(o=>o.name===e)),s&&(yv(i,s),this.viewportProperties.preset=s,this.render(),r||Q(this.element,X.PRESET_MODIFIED,{viewportId:this.id,volumeId:a.volumeId,actor:i,presetName:s.name}))}async setVolumes(e,n=!1,r=!1){const a=ie.getVolume(e[0].volumeId);if(!a)throw new Error(`imageVolume with id: ${a.volumeId} does not exist, you need to create/allocate the volume first`);const i=a.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,i),this._FrameOfReferenceUID=i,e.forEach(o=>{this._addVolumeId(o.volumeId)});const s=[];for(let o=0;o<e.length;o++){const{volumeId:c,actorUID:l,slabThickness:f,...u}=e[o],g=await Vh(e[o],this.element,this.id,r),p=l||_r();s.push({uid:p,actor:g,slabThickness:f,referencedId:c,...u})}this._setVolumeActors(s),this.viewportStatus=Wt.PRE_RENDER,this.initializeColorTransferFunction(e),Q(this.element,X.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:s}),n&&this.render()}async addVolumes(e,n=!1,r=!1){const a=ie.getVolume(e[0].volumeId);if(!a)throw new Error(`imageVolume with id: ${a.volumeId} does not exist`);const i=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(s=>{this._addVolumeId(s.volumeId)});for(let s=0;s<e.length;s++){const{volumeId:o,visibility:c,actorUID:l,slabThickness:f,...u}=e[s],g=await Vh(e[s],this.element,this.id,r);c||g.setVisibility(!1);const p=l||_r();i.push({uid:p,actor:g,slabThickness:f,referencedId:o,...u})}this.addActors(i),this.initializeColorTransferFunction(e),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const n=e[0].volumeId,r=this._getOrCreateColorTransferFunction(n);!this.initialTransferFunctionNodes&&r&&(this.initialTransferFunctionNodes=zl(r))}_getApplicableVolumeActor(e){const n=this.getActors();if(!(n!=null&&n.length))return;if(e){const a=n.find(i=>i.referencedId===e);return a?{volumeActor:a.actor,volumeId:e,actorUID:a.uid}:void 0}const r=n[0];return{volumeActor:r.actor,volumeId:r.referencedId,actorUID:r.uid}}async _isValidVolumeInputArray(e,n){const r=e.length;for(let a=1;a<r;a++){const i=ie.getVolume(e[a].volumeId);if(n!==i.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const n of this.volumeIds)if(n.includes(e))return!0;return!1}getImageData(e){var o,c,l;if(!this.getDefaultActor())return;e||(e=this.getVolumeId());const r=(o=this.getActors())==null?void 0:o.find(f=>f.referencedId===e);if(!an(r,"vtkVolume"))return;const a=r.actor,i=ie.getVolume(e),s=a.getMapper().getInputData();return{dimensions:s.getDimensions(),spacing:s.getSpacing(),origin:s.getOrigin(),direction:s.getDirection(),imageData:a.getMapper().getInputData(),metadata:{Modality:(c=i==null?void 0:i.metadata)==null?void 0:c.Modality,FrameOfReferenceUID:(l=i==null?void 0:i.metadata)==null?void 0:l.FrameOfReferenceUID},get scalarData(){var f;return(f=i==null?void 0:i.voxelManager)==null?void 0:f.getScalarData()},scaling:i==null?void 0:i.scaling,hasPixelSpacing:!0,voxelManager:i==null?void 0:i.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,n){super.setCamera(e,n),this.setCameraClippingRange()}_setVolumeActors(e){for(let n=0;n<e.length;n++)this.viewportProperties.invert=!1;this.setActors(e)}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}else{if(typeof e=="string"&&$a[e])return this.viewportProperties.orientation=e,$a[e];throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys($a).join(", ")}`)}}getSlabThickness(){const e=this.getActors();let n=Xe.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}getIntensityFromWorld(e){const n=this.getDefaultActor();if(!an(n,"vtkVolume"))return;const{actor:r}=n,a=r.getMapper().getInputData(),i=ie.getVolume(this.getVolumeId()),s=V5(a,e);return i.voxelManager.getAtIJKPoint(s)}getVolumeId(e){const n=this.getActors();if(!n)return;if(!(e!=null&&e.volumeId)){const a=n.find(i=>i.actor.getClassName()==="vtkVolume");return(a==null?void 0:a.referencedId)||(a==null?void 0:a.uid)}const r=n.find(a=>a.actor.getClassName()==="vtkVolume"&&a.referencedId===(e==null?void 0:e.volumeId));return(r==null?void 0:r.referencedId)||(r==null?void 0:r.uid)}getViewReferenceId(e={}){var c;let{volumeId:n,sliceIndex:r}=e;if(!n){const l=this.getActors();if(!l)return;n=(c=l.find(f=>f.actor.getClassName()==="vtkVolume"))==null?void 0:c.referencedId}const a=this.getSliceIndex();r??(r=a);const{viewPlaneNormal:i,focalPoint:s}=this.getCamera(),o=n.includes("?")?"&":"?";return`volumeId:${n}${o}sliceIndex=${r}&viewPlaneNormal=${i.join(",")}&focalPoint=${s.join(",")}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}}function Qr(t,e){const{imageData:n}=t.getImageData(),r=t.canvasToWorld(e);return V5(n,r)}function Cv(t,e){return t.indexToWorld(e)}function IU(t,e){const{imageData:n}=t.getImageData(),r=Cv(n,e);return t.worldToCanvas(r)}class e0 extends Lu{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:r}=Hl(this)||{};return r},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=r=>{const{viewPlaneNormal:a,focalPoint:i}=this.getCamera(),s=this.getImageData(r);if(!s)return;const{origin:o,direction:c,spacing:l}=s,f=ps({direction:c,spacing:l},a),u=ne();jt(u,i,o);const g=Ve(u,a);return Math.round(Math.abs(g)/f)},this.getSliceIndex=()=>{const{imageIndex:r}=Hl(this)||{};return r},this.getCurrentImageId=()=>{const r=this.getDefaultActor();if(!r||!an(r,"vtkVolume"))return;const a=ie.getVolume(this.getVolumeId());if(!a)return;const{viewPlaneNormal:i,focalPoint:s}=this.getCamera();return Pl(a,s,i)},this.getSlicePlaneCoordinates=()=>{const r=this.getDefaultActor();if(!(r!=null&&r.actor))return console.warn("No image data found for calculating vtkPlanes."),[];const a=this.getVolumeId(),i=ie.getVolume(a),s=this.getCamera(),{focalPoint:o,position:c,viewPlaneNormal:l}=s,f=ps(i,l),u=Mu(r.actor,l,o),g=Math.round((u.current-u.min)/f),p=Math.round((u.max-u.current)/f),h=this.getSliceIndex(),d=[];for(let m=-g;m<=p;m++){const{newFocalPoint:v}=es(o,c,u,l,f,m);d.push({sliceIndex:h+m,point:v})}return d};const{orientation:n}=this.options;if(n&&n!==us.ACQUISITION){this.applyViewOrientation(n);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,n=!1,r=!1){const a=ie.getVolume(e[0].volumeId);if(!a)throw new Error(`imageVolume with id: ${a.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(a),this._useAcquisitionPlaneForViewPlane=!1),super.setVolumes(e,n,r)}async addVolumes(e,n=!1,r=!1){const a=ie.getVolume(e[0].volumeId);if(!a)throw new Error(`imageVolume with id: ${a.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(a),this._useAcquisitionPlaneForViewPlane=!1),super.addVolumes(e,n,r)}jumpToWorld(e){const{focalPoint:n}=this.getCamera(),r=[0,0,0];jt(r,e,n);const a=this.getCamera(),i=a.viewPlaneNormal,s=Ve(r,i),o=Qe(i[0],i[1],i[2]);if(c0(o,o,s),Math.abs(o[0])>.001||Math.abs(o[1])>.001||Math.abs(o[2])>.001){const c=[0,0,0],l=[0,0,0];pn(c,a.focalPoint,o),pn(l,a.position,o),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,n=!0){let r,a;if(typeof e=="string"){if($a[e])({viewPlaneNormal:r,viewUp:a}=$a[e]);else if(e==="acquisition")({viewPlaneNormal:r,viewUp:a}=this._getAcquisitionPlaneOrientation());else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:a}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:r,viewUp:a}=e),this.applyViewOrientation(e);n&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-Xe.MAXIMUM_RAY_DISTANCE,Xe.MAXIMUM_RAY_DISTANCE):e.setClippingRange(Xe.MINIMUM_SLAB_THICKNESS,Xe.MAXIMUM_RAY_DISTANCE)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const n=this.getVolumeId(),r=ie.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:a}=r,i=a.slice(6,9).map(o=>-o),s=a.slice(3,6).map(o=>-o);return{viewPlaneNormal:i,viewUp:s}}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:a}=e;n=a.slice(6,9).map(i=>-i),r=a.slice(3,6).map(i=>-i)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.initialViewUp=r,this.resetCamera()}setBlendMode(e,n=[],r=!1){let a=this.getActors();n&&n.length>0&&(a=a.filter(i=>n.includes(i.uid))),a.forEach(i=>{var c;const{actor:s}=i,o=s.getMapper();(c=o.setBlendMode)==null||c.call(o,e)}),r&&this.render()}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetRotation:a=!0,resetToCenter:i=!0,suppressEvents:s=!1,resetOrientation:o=!0}=e||{},{orientation:c}=this.viewportProperties;c&&o&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:n,resetZoom:r,resetToCenter:i});const l=this.getVtkActiveCamera(),f=l.getViewPlaneNormal(),u=l.getFocalPoint();if(this.getActors().forEach(p=>{if(!p.actor)return;const h=p.actor.getMapper();if(h.getClippingPlanes().length===0&&!(p!=null&&p.clippingFilter)){const m=Ft.newInstance(),v=Ft.newInstance(),C=[m,v];let y=Xe.MINIMUM_SLAB_THICKNESS;p.slabThickness&&(y=p.slabThickness),this.setOrientationOfClippingPlanes(C,y,f,u),h.addClippingPlane(m),h.addClippingPlane(v)}}),a&&$a[this.viewportProperties.orientation]!==void 0){const p=$a[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:p.viewUp,viewPlaneNormal:p.viewPlaneNormal})}if(!s){const p={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};Q(this.element,X.CAMERA_RESET,p)}return!0}setSlabThickness(e,n=[]){e<.1&&(e=.1);let r=this.getActors();n&&n.length>0&&(r=r.filter(i=>n.includes(i.uid))),r.forEach(i=>{an(i,"vtkVolume")&&(i.slabThickness=e)});const a=this.getCamera();this.updateClippingPlanesForActors(a),this.triggerCameraModifiedEventIfNecessary(a,a),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(r=>{an(r,"vtkVolume")&&(r.slabThickness=Xe.MINIMUM_SLAB_THICKNESS)});const n=this.getCamera();this.updateClippingPlanesForActors(n),this.triggerCameraModifiedEventIfNecessary(n,n),this.viewportProperties.slabThickness=void 0}getSliceViewInfo(){const{width:e,height:n}=this.getCanvas(),r=Qr(this,[0,0]),a=Qr(this,[e-1,0]),i=Qr(this,[0,n-1]),s=jt(ne(),a,r),o=jt(ne(),i,r),c=ut(ne(),s,o);kt(s,s),kt(o,o),kt(c,c);const{dimensions:l}=this.getImageData(),[f,u,g]=l,d=[[0,0,0],[f-1,0,0],[0,u-1,0],[f-1,u-1,0],[0,0,g-1],[f-1,0,g-1],[0,u-1,g-1],[f-1,u-1,g-1]].map(R=>IU(this,R)).reduce((R,D)=>(R.minX=Math.min(R.minX,D[0]),R.minY=Math.min(R.minY,D[1]),R.maxX=Math.max(R.maxX,D[0]),R.maxY=Math.max(R.maxY,D[1]),R),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),m=Qr(this,[d.minX,d.minY]),v=v8(s[0],s[1],s[2],0,o[0],o[1],o[2],0,c[0],c[1],c[2],0,m[0],m[1],m[2],1),C=Qr(this,[d.maxX,d.maxY]),y=jt(ne(),C,m),T=lt(Ca(),v),{viewPlaneNormal:x}=this.getCamera();if(x.filter(R=>Math.abs(R)>Ir).length>1)throw new Error("getSliceInfo is not supported for oblique views");const w=x.findIndex(R=>Math.abs(R)>1-Ir);if(w===-1)throw new Error("Unable to determine slice axis");const E=Ve(s,y)+1,L=Ve(o,y)+1;return{sliceIndex:this.getSliceIndex(),width:E,height:L,slicePlane:w,sliceToIndexMatrix:v,indexToSliceMatrix:T}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const n=super.getViewReference(e);if(!(n!=null&&n.volumeId))return;const r=ie.getVolume(n.volumeId);return n.referencedImageId=Pl(r,n.cameraFocalPoint,n.viewPlaneNormal),n}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=Xe.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=ie.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(N5(n.actor,r),nr(n)){const l=n.actor.getProperty().getRGBTransferFunction(0);Vu(l,this.initialTransferFunctionNodes)}const a={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),Q(this.element,X.VOI_MODIFIED,a)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:n}=this.getCamera(),r=Xe.MINIMUM_SLAB_THICKNESS;return e.map(({point:a,sliceIndex:i})=>{const s=[Ft.newInstance(),Ft.newInstance()];return this.setOrientationOfClippingPlanes(s,r,n,a),{sliceIndex:i,planes:s.map(o=>({normal:o.getNormal(),origin:o.getOrigin()}))}})}}function FU(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(O.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),da())}const kU={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function UU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kU,n),u5.extend(t,e,n),O.setGet(t,e,["slice","useCustomExtents"]),O.setGetArray(t,e,["customDisplayExtent"],6),O.setGetArray(t,e,["backgroundColor"],4),FU(t,e)}var PU={extend:UU};function Tv(t,e,n){const r=n.getCurrentImage(),a=r.getExtent(),i=[a[0],a[2],a[4]],{ijkMode:s}=n.getClosestIJKAxis();let o=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();s!==n.getSlicingMode()&&(o=n.getSliceAtPosition(o)),i[s]+=o;const c=[0,0,0];r.indexToWorld(i,c),i[s]+=1;const l=[0,0,0];r.indexToWorld(i,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],kt(l,l);const f=Ft.intersectWithLine(t,e,c,l);if(f.intersection){const u=f.x,g=[0,0,0];return r.worldToIndex(u,g),{t:f.t,absoluteIJK:g}}return null}function bU(t,e,n){const r=Tv(t,e,n);if(r){const i=n.getCurrentImage().getExtent(),s=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return s[0]<i[0]||s[0]>i[1]||s[1]<i[2]||s[1]>i[3]||s[2]<i[4]||s[2]>i[5]?null:{t:r.t,ijk:s}}return null}function GU(t,e,n){const r=Tv(t,e,n);if(r){const i=n.getCurrentImage().getExtent(),s=r.absoluteIJK,o=[Math.floor(s[0]),Math.floor(s[1]),Math.floor(s[2])];if(o[0]<i[0]||o[0]>i[1]-1||o[1]<i[2]||o[1]>i[3]-1||o[2]<i[4]||o[2]>(i[5]?i[5]-1:i[5]))return null;const c=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];return{t:r.t,ijk:o,pCoords:c}}return null}const{staticOffsetAPI:BU,otherStaticMethods:AU}=Eu,{SlicingMode:Ce}=Ou;function WU(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=r=>{const a=t.getCurrentImage();let i;if(r.length===3)i=r;else if(Number.isFinite(r)){const f=a.getBounds();switch(e.slicingMode){case Ce.X:i=[r,(f[3]+f[2])/2,(f[5]+f[4])/2];break;case Ce.Y:i=[(f[1]+f[0])/2,r,(f[5]+f[4])/2];break;case Ce.Z:i=[(f[1]+f[0])/2,(f[3]+f[2])/2,r];break}}const s=[0,0,0];a.worldToIndex(i,s);const o=a.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case Ce.I:l=Bn(s[0],o[0],o[1]);break;case Ce.J:l=Bn(s[1],o[2],o[3]);break;case Ce.K:l=Bn(s[2],o[4],o[5]);break;default:return 0}return l},t.setSliceFromCamera=r=>{const a=r.getFocalPoint();switch(e.slicingMode){case Ce.I:case Ce.J:case Ce.K:{const i=t.getSliceAtPosition(a);t.setSlice(i)}break;case Ce.X:t.setSlice(a[0]);break;case Ce.Y:t.setSlice(a[1]);break;case Ce.Z:t.setSlice(a[2]);break}},t.setXSlice=r=>{t.setSlicingMode(Ce.X),t.setSlice(r)},t.setYSlice=r=>{t.setSlicingMode(Ce.Y),t.setSlice(r)},t.setZSlice=r=>{t.setSlicingMode(Ce.Z),t.setSlice(r)},t.setISlice=r=>{t.setSlicingMode(Ce.I),t.setSlice(r)},t.setJSlice=r=>{t.setSlicingMode(Ce.J),t.setSlice(r)},t.setKSlice=r=>{t.setSlicingMode(Ce.K),t.setSlice(r)},t.getSlicingModeNormal=()=>{const r=[0,0,0],a=t.getCurrentImage().getDirection();switch(e.slicingMode){case Ce.X:r[0]=1;break;case Ce.Y:r[1]=1;break;case Ce.Z:r[2]=1;break;case Ce.I:Ic(a,[1,0,0],r);break;case Ce.J:Ic(a,[0,1,0],r);break;case Ce.K:Ic(a,[0,0,1],r);break}return r};function n(){let r;switch(e.slicingMode){case Ce.X:r=0;break;case Ce.Y:r=1;break;case Ce.Z:r=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const a=t.getCurrentImage().getDirection(),i=q9(a);let s=0;for(;s<3&&i[r+3*s]===0;++s);const o=i[r+3*s]<0;e.closestIJKAxis={ijkMode:s,flip:o}}t.setSlicingMode=r=>{e.slicingMode!==r&&(e.slicingMode=r,t.getCurrentImage()&&n(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===Ce.NONE)&&t.getCurrentImage()&&n(),e.closestIJKAxis),t.getBounds=()=>{const r=t.getCurrentImage();if(!r)return da();if(!e.useCustomExtents)return r.getBounds();const a=e.customDisplayExtent.slice(),{ijkMode:i}=t.getClosestIJKAxis();let s=e.slice;switch(i!==e.slicingMode&&(s=t.getSliceAtPosition(e.slice)),i){case Ce.I:a[0]=s,a[1]=s;break;case Ce.J:a[2]=s,a[3]=s;break;case Ce.K:a[4]=s,a[5]=s;break}return r.extentToBounds(a)},t.getBoundsForSlice=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=t.getCurrentImage();if(!i)return da();const s=i.getSpatialExtent(),{ijkMode:o}=t.getClosestIJKAxis();let c=r;switch(o!==e.slicingMode&&(c=t.getSliceAtPosition(r)),o){case Ce.I:s[0]=c-a,s[1]=c+a;break;case Ce.J:s[2]=c-a,s[3]=c+a;break;case Ce.K:s[4]=c-a,s[5]=c+a;break}return i.extentToBounds(s)},t.intersectWithLineForPointPicking=(r,a)=>bU(r,a,t),t.intersectWithLineForCellPicking=(r,a)=>GU(r,a,t),t.getCurrentImage=()=>t.getInputData()}const zU={slicingMode:Ce.NONE,closestIJKAxis:{ijkMode:Ce.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function xv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zU,n),PU.extend(t,e,n),O.get(t,e,["slicingMode"]),O.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),Eu.implementCoincidentTopologyMethods(t,e),WU(t,e)}const $U=O.newInstance(xv,"vtkImageMapper");var jU={newInstance:$U,extend:xv,...BU,...AU,...Ou};const{InterpolationType:zc}=NV,{vtkErrorMacro:Nh}=O,$c=4;function HU(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let n=e.mtime,r;for(let a=0;a<$c;a++)e.componentData[a].rGBTransferFunction&&(r=e.componentData[a].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[a].piecewiseFunction&&(r=e.componentData[a].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=n,i=r;return Number.isInteger(n)||(i=n,a=0),e.componentData[a].rGBTransferFunction!==i?(e.componentData[a].rGBTransferFunction=i,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=n,i=r;return Number.isInteger(n)||(i=n,a=0),e.componentData[a].piecewiseFunction!==i?(e.componentData[a].piecewiseFunction=i,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=n,i=r;return Number.isInteger(n)||(i=n,a=0),t.setPiecewiseFunction(a,i)},t.getScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(n<0||n>=$c)return Nh("Invalid index"),!1;const a=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==a?(e.componentData[n].componentWeight=a,t.modified(),!0):!1},t.getComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return n<0||n>=$c?(Nh("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(zc.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(zc.LINEAR),t.getInterpolationTypeAsString=()=>O.enumToString(zc,e.interpolationType)}const KU={independentComponents:!1,interpolationType:zc.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function qU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,KU,n),O.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<$c;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}O.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),O.setGetArray(t,e,["labelOutlineThickness"]),HU(t,e)}const XU=O.newInstance(qU,"vtkImageProperty");var YU={newInstance:XU};const{vtkDebugMacro:ZU}=O;function QU(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=YU.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=a=>a[0].map((i,s)=>a.map(o=>o[s]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((a,i)=>a&&i[0]===i[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){ZU("Recomputing bounds..."),e.mapperBounds=n.map(i=>i),t.computeMatrix();const a=new Float64Array(16);me(a,e.matrix),_e.transformBounds(n,a,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=(n,r)=>{const a=e.mapper.getBoundsForSlice(n,r);if(!_e.isValid(a))return a;t.computeMatrix();const i=new Float64Array(16);return me(i,e.matrix),_e.transformBounds(a,i)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}if(e.property!==null){let r=e.property.getMTime();n=r>n?r:n,e.property.getRGBTransferFunction()!==null&&(r=e.property.getRGBTransferFunction().getMTime(),n=r>n?r:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const JU={mapper:null,property:null,bounds:[..._e.INIT_BOUNDS]};function Sv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JU,n),x5.extend(t,e,n),e.boundsMTime={},O.obj(e.boundsMTime),O.set(t,e,["property"]),O.setGet(t,e,["mapper"]),O.getArray(t,e,["bounds"],6),QU(t,e)}const eP=O.newInstance(Sv,"vtkImageSlice");var tP={newInstance:eP,extend:Sv};function wv(t){const e=fi.newInstance();let n=0,r=1024;return t.lower!==void 0&&t.upper!==void 0&&(n=t.lower,r=t.upper),e.addRGBPoint(n,0,0,0),e.addRGBPoint(r,1,1,1),e}function Ev(t,e){const n=e.voxelManager.getScalarData();if(!t.getPointData)return;const r=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const a=new Uint8Array(e.columns*e.rows*3);for(let i=0;i<e.columns*e.rows;i++)a[i*3]=n[i*4],a[i*3+1]=n[i*4+1],a[i*3+2]=n[i*4+2];e.rgba=!1,e.getPixelData=()=>a,r.set(a)}else r.set(n);t.modified()}function ue(){return window.performance?performance.now():Date.now()}function nP(t,e){return function(n){const r=((n-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(r,0),255)}}function rP(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,a=t.lut[t.lut.length-1]>>n,i=t.firstValueMapped+t.lut.length-1;return function(s){return s<t.firstValueMapped?r:s>=i?a:t.lut[s-t.firstValueMapped]>>n}}function Rv(t,e,n){return n?rP(n):nP(t,e)}function aP(t,e,n,r,a){const i=t.maxPixelValue,s=t.minPixelValue,o=Math.min(s,0);if(t.cachedLut===void 0){const f=i-o+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(f)}const c=t.cachedLut.lutArray,l=Rv(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,a);if(r)for(let f=s;f<=i;f++)c[f+-o]=255-l(f);else for(let f=s;f<=i;f++)c[f+-o]=l(f);return c}function iP(t,e,n){let r=ue();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ue()-r;const i=t.minPixelValue;let s=0,o=0;const c=a.length;if(r=ue(),i<0)for(;o<c;)n[s++]=e[a[o++]+-i],n[s++]=e[a[o++]+-i],n[s]=e[a[o]+-i],o+=2,s+=2;else for(;o<c;)n[s++]=e[a[o++]],n[s++]=e[a[o++]],n[s]=e[a[o]],o+=2,s+=2;t.stats.lastStoredPixelDataToCanvasImageDataTime=ue()-r}function sP(t,e,n){let r=ue();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ue()-r;const i=t.minPixelValue;let s=0,o=0;const c=a.length;if(r=ue(),i<0)for(;o<c;)n[s++]=e[a[o++]+-i],n[s++]=e[a[o++]+-i],n[s++]=e[a[o++]+-i],n[s++]=a[o++];else for(;o<c;)n[s++]=e[a[o++]],n[s++]=e[a[o++]],n[s++]=e[a[o++]],n[s++]=a[o++];t.stats.lastStoredPixelDataToCanvasImageDataTime=ue()-r}class Ms{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new Ms;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],a=this.m[0]*e[2]+this.m[2]*e[3],i=this.m[1]*e[2]+this.m[3]*e[3],s=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],o=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=i,this.m[4]=s,this.m[5]=o}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,a=-this.m[2]*e,i=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=i,this.m[4]=s,this.m[5]=o}rotate(e){const n=Math.cos(e),r=Math.sin(e),a=this.m[0]*n+this.m[2]*r,i=this.m[1]*n+this.m[3]*r,s=this.m[0]*-r+this.m[2]*n,o=this.m[1]*-r+this.m[3]*n;this.m[0]=a,this.m[1]=i,this.m[2]=s,this.m[3]=o}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function t0(t,e){const n=new Ms;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let a=t.viewport.scale,i=t.viewport.scale;const s=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),o=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?a*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(i*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(a=t.viewport.displayedArea.columnPixelSpacing,i=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(o*i),l=t.canvas.width/(s*a);a=i=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?a*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(i*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(a,i),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-o/2),n}function F5(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const a=t0(t).getMatrix();e.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])}function k5(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function Kl(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const a=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=a}function U5(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}function oP(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(aP(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function cP(t,e,n){const r=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=document.createElement("canvas"));const a=t.renderingTools.renderCanvas,{windowWidth:i,windowCenter:s}=t.viewport.voi;if((i===256||i===255)&&(s===128||s===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!k5(t,e)&&!n)return a;(a.width!==e.width||a.height!==e.height)&&Kl(t,e);let o=ue();const c=oP(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=ue()-o;const l=t.renderingTools.renderCanvasData,f=t.renderingTools.renderCanvasContext;return e.rgba?sP(e,c,l.data):iP(e,c,l.data),o=ue(),f.putImageData(l,0,0),e.stats.lastPutImageDataTime=ue()-o,a}function lP(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,F5(t,r);const a=cP(t,n,e),i=t.viewport.displayedArea.tlhc.x-1,s=t.viewport.displayedArea.tlhc.y-1,o=t.viewport.displayedArea.brhc.x-i,c=t.viewport.displayedArea.brhc.y-s;r.drawImage(a,i,s,o,c,0,0,o,c),t.renderingTools=U5(t)}function uP(t,e,n){let r=ue();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ue()-r;const i=a.length,s=t.minPixelValue;let o=3,c=0;if(r=ue(),a instanceof Int16Array)if(s<0)for(;c<i;)n[o]=e[a[c++]+-s],o+=4;else for(;c<i;)n[o]=e[a[c++]],o+=4;else if(a instanceof Uint16Array)for(;c<i;)n[o]=e[a[c++]],o+=4;else if(s<0)for(;c<i;)n[o]=e[a[c++]+-s],o+=4;else for(;c<i;)n[o]=e[a[c++]],o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=ue()-r}function fP(t,e,n){let r=ue();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ue()-r;const i=a.length;let s=3,o=0;for(r=ue();o<i;)n[s]=e(a[o++]),s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=ue()-r}function gP(t,e,n){let r=ue();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ue()-r;const i=a.length,s=t.minPixelValue;let o=0,c=0,l;if(r=ue(),a instanceof Int16Array)if(s<0)for(;c<i;)l=e[a[c++]+-s],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else for(;c<i;)l=e[a[c++]],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else if(a instanceof Uint16Array)for(;c<i;)l=e[a[c++]],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else if(s<0)for(;c<i;)l=e[a[c++]+-s],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else for(;c<i;)l=e[a[c++]],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=ue()-r}function pP(t,e){if(dP(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,a=n-r,i=(n+r)/2;t.voi===void 0?t.voi={windowWidth:a,windowCenter:i}:(t.voi.windowWidth=a,t.voi.windowCenter=i)}function dP(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function Ih(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function hP(t,e){return n=>n*t+e}function mP(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return a=>a<t.firstValueMapped?e:a>=r?n:t.lut[a]}function vP(t,e,n){return n?mP(n):hP(t,e)}function yP(t,e,n,r,a,i){const s=t.maxPixelValue,o=t.minPixelValue,c=Math.min(o,0);if(t.cachedLut===void 0){const g=s-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(g)}const l=t.cachedLut.lutArray,f=vP(t.slope,t.intercept,a),u=Rv(e,n,i);if(t.isPreScaled)if(r)for(let g=o;g<=s;g++)l[g+-c]=255-u(g);else for(let g=o;g<=s;g++)l[g+-c]=u(g);else if(r)for(let g=o;g<=s;g++)l[g+-c]=255-u(f(g));else for(let g=o;g<=s;g++)l[g+-c]=u(f(g));return l}function Ov(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&Ih(t.cachedLut.modalityLUT,e.modalityLUT)&&Ih(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!n||(pP(e,t),yP(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function CP(t,e,n,r=!0){const a=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||a)&&(t.renderingTools.renderCanvas=document.createElement("canvas"),Kl(t,e));const i=t.renderingTools.renderCanvas;if(!k5(t,e)&&!n)return i;(i.width!==e.width||i.height!==e.height)&&Kl(t,e),e.stats=e.stats||{};const s=t.renderingTools.renderCanvasData,o=t.renderingTools.renderCanvasContext;let c=ue();e.stats.lastLutGenerateTime=ue()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:f,windowCenter:u}=l.voi,g=u-f/2,d=255/(u+f/2-g);let m;l.invert?m=v=>255-(v-g)*d:m=v=>(v-g)*d,fP(e,m,s.data)}else{const f=Ov(e,l,n);r?uP(e,f,s.data):gP(e,f,s.data)}return c=ue(),o.putImageData(s,0,0),e.stats.lastPutImageDataTime=ue()-c,i}function TP(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,F5(t,r);const a=CP(t,n,e),i=t.viewport.displayedArea.tlhc.x-1,s=t.viewport.displayedArea.tlhc.y-1,o=t.viewport.displayedArea.brhc.x-i,c=t.viewport.displayedArea.brhc.y-s;r.drawImage(a,i,s,o,c,0,0,o,c),t.renderingTools=U5(t)}const v2=0,y2=1,xP=2;function SP(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const a=Math.floor(t*6),i=6*t-a,s=n*(1-e),o=n*(1-e*i),c=n*(1-e*(1-i));switch(a){case 0:case 6:r[0]=n,r[1]=c,r[2]=s;break;case 1:r[0]=o,r[1]=n,r[2]=s;break;case 2:r[0]=s,r[1]=n,r[2]=c;break;case 3:r[0]=s,r[1]=o,r[2]=n;break;case 4:r[0]=c,r[1]=s,r[2]=n;break;case 5:r[0]=n,r[1]=s,r[2]=o;break}return r}function wP(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+v2+1.5:t>e.Range[1]?n=e.MaxIndex+y2+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class P5{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,a,i,s;n?(r=(this.HueRange[1]-this.HueRange[0])/n,a=(this.SaturationRange[1]-this.SaturationRange[0])/n,i=(this.ValueRange[1]-this.ValueRange[0])/n,s=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=a=i=s=0;for(let o=0;o<=n;o++){const c=this.HueRange[0]+o*r,l=this.SaturationRange[0]+o*a,f=this.ValueRange[0]+o*i,u=this.AlphaRange[0]+o*s,g=SP(c,l,f),p=[0,0,0,0];switch(this.Ramp){case"scurve":p[0]=Math.floor(127.5*(1+Math.cos((1-g[0])*Math.PI))),p[1]=Math.floor(127.5*(1+Math.cos((1-g[1])*Math.PI))),p[2]=Math.floor(127.5*(1+Math.cos((1-g[2])*Math.PI))),p[3]=Math.floor(u*255);break;case"linear":p[0]=Math.floor(g[0]*255+.5),p[1]=Math.floor(g[1]*255+.5),p[2]=Math.floor(g[2]*255+.5),p[3]=Math.floor(u*255+.5);break;case"sqrt":p[0]=Math.floor(Math.sqrt(g[0])*255+.5),p[1]=Math.floor(Math.sqrt(g[1])*255+.5),p[2]=Math.floor(Math.sqrt(g[2])*255+.5),p[3]=Math.floor(Math.sqrt(u)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(p)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+v2,r=e+y2,a=e+xP;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[a]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=wP(e,n);return r===this.NumberOfColors+v2?r=0:r===this.NumberOfColors+y2&&(r=this.NumberOfColors-1),r}setTableValue(e,n,r,a,i){let s;if(typeof n=="number"&&r!==void 0&&a!==void 0&&i!==void 0)s=[n,r,a,i];else if(Array.isArray(n))s=n;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=s,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const Fh=[0,0,0,0];function EP(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),a=[];for(;n-- >0;)a.push(t),t+=r;return a[a.length-1]=e,a}function RP(t,e){let n=0,r=t.length-1;for(;n<=r;){const a=n+Math.floor((r-n)/2),i=t[a];if(i===e)return a;e<i?r=a-1:n=a+1}return n}function OP(t,e){let n;const r=[],a=e.length;for(t.sort(function(i,s){return i-s}),n=0;n<a;n++)r[n]=RP(t,e[n]);return r}function Pf(t,e,n){let r;const a=[],i=[],s=[],o=[];for(n=n===null?1:n,r=0;r<e.length;r++){const f=e[r];a.push((t-1)*f[0]),i.push(f[1]),s.push(f[1])}const c=EP(0,1,t);for(r=0;r<t;r++)c[r]=(t-1)*Math.pow(c[r],n);const l=OP(a,c);for(r=1;r<t-1;r++){const f=l[r],u=(c[r]-a[f-1])/(a[f]-a[f-1]),g=i[f]-s[f-1];o[r]=u*g+s[f-1]}return o[0]=s[0],o[t-1]=i[e.length-1],o}function MP(t,e,n){let r;const a=[];e=e===null?256:e,n=n===null?1:n;const i=Pf(e,t.red,n),s=Pf(e,t.green,n),o=Pf(e,t.blue,n);for(r=0;r<e;r++){const c=Math.round(i[r]*255),l=Math.round(s[r]*255),f=Math.round(o[r]*255),u=[c,l,f,255];a.push(u)}return a}function DP(t,e){let n=yd[t];return n||(n=yd[t]={name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=MP(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(a){n.name=a},getNumberOfColors(){return n.colors.length},setNumberOfColors(a){for(;n.colors.length<a;)n.colors.push(Fh);n.colors.length=a},getColor(a){return this.isValidIndex(a)?n.colors[a]:Fh},getColorRepeating(a){const i=n.colors.length;return a=i?a%i:0,this.getColor(a)},setColor(a,i){this.isValidIndex(a)&&(n.colors[a]=i)},addColor(a){n.colors.push(a)},insertColor(a,i){this.isValidIndex(a)&&n.colors.splice(a,1,i)},removeColor(a){this.isValidIndex(a)&&n.colors.splice(a,1)},clearColors(){n.colors=[]},buildLookupTable(a){if(!a)return;const i=n.colors.length;a.setNumberOfTableValues(i);for(let s=0;s<i;s++)a.setTableValue(s,n.colors[s])},createLookupTable(){const a=new P5;return this.buildLookupTable(a),a},isValidIndex(a){return a>=0&&a<n.colors.length}}}function VP(t,e,n,r){let a=ue();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ue()-a;const s=i.length,o=t.minPixelValue;let c=0,l=0,f,u,g;if(a=ue(),n instanceof P5?g=n.Table:g=n,o<0)for(;l<s;)f=e[i[l++]+-o],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<s;)f=e[i[l++]],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=ue()-a}function LP(t,e,n,r){let a=ue();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=ue()-a;const s=i.length,o=t.minPixelValue;let c=0,l=0,f,u,g;if(a=ue(),n instanceof P5?g=n.Table:g=n,o<0)for(;l<s;)f=e(i[l++]+-o),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<s;)f=e(i[l++]),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=ue()-a}function C2(t,e,n){return Math.max(e,Math.min(n,t))}function _P(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=document.createElement("canvas"));const r=t.renderingTools.renderCanvas;let a=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),a&&typeof a=="string"&&(a=DP(a)),!a)throw new Error("renderPseudoColorImage: colormap not found.");const i=a.getId();if(!k5(t,e)&&!n&&t.renderingTools.colormapId===i)return r;(r.width!==e.width||r.height!==e.height)&&Kl(t,e);let s=ue();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==i)&&(a.setNumberOfColors(256),t.renderingTools.colorLUT=a.createLookupTable(),t.renderingTools.colormapId=i);const o=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,f=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:u,windowCenter:g}=l.voi,p=g-u/2,m=255/(g+u/2-p);let v;l.invert?v=C=>C2(Math.floor(255-(C-p)*m),0,255):v=C=>C2(Math.floor((C-p)*m),0,255),LP(e,v,f,o.data)}else{const u=Ov(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=ue()-s,VP(e,u,f,o.data)}return s=ue(),c.putImageData(o,0,0),e.stats.lastPutImageDataTime=ue()-s,r}function NP(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,F5(t,r);const a=_P(t,n,e),i=t.viewport.displayedArea.tlhc.x-1,s=t.viewport.displayedArea.tlhc.y-1,o=t.viewport.displayedArea.brhc.x-i,c=t.viewport.displayedArea.brhc.y-s;r.drawImage(a,i,s,o,c,0,0,o,c),t.renderingTools=U5(t)}function Mv(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=ue();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let i=n.render;i||(t.viewport.colormap?i=NP:n.color?i=lP:i=TP),i(t,e)}const a=ue()-r;n.stats.lastRenderTime=a,t.invalid=!1,t.needsRedraw=!1}function Dv(t){return t0(t)}function fc(t,e){const n=Dv(t);return n.invert(),n.transformPoint(e)}const IP={viewport:{}};function FP(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function kP(){const t=FP();return Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t},IP.viewport)}function Eo(t,e){if(t==null)throw new Error(e)}function UP(t){return!(t==null||t===0||t===180)}function Vv(t,e=null){return Eo(t,"getImageSize: parameter image must not be undefined"),Eo(t.width,"getImageSize: parameter image must have width"),Eo(t.height,"getImageSize: parameter image must have height"),UP(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function b5(t,e,n=null){Eo(t,"getImageScale: parameter canvas must not be undefined"),Eo(e,"getImageScale: parameter image must not be undefined");const r=Vv(e,n),a=e.rowPixelSpacing||1,i=e.columnPixelSpacing||1;let s=1,o=1;a<i?o=i/a:s=a/i;const c=t.height/r.height/s,l=t.width/r.width/o;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function Lv(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return kP();const a=b5(t,e,0).scaleFactor;let i;return n==="PT"&&e.isPreScaled?i={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(i={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:a,translation:{x:0,y:0},voi:i,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function kh(t,e){return Dv(t).transformPoint(e)}function PP(t){const{image:e}=t;t.viewport.scale=b5(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function bP(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function GP(t,e,n){const r=t.viewport.scale,a=Vv(t.image,t.viewport.rotation),i=Math.round(a.width*r),s=Math.round(a.height*r),o=t.viewport.translation.x,c=t.viewport.translation.y;return i===e&&s<=n||i<=e&&s===n&&o===0&&c===0}function BP(t,e,n){const r=t.viewport.scale,a=t.canvas.width,i=t.canvas.height,s=a/e,o=i/n,c=Math.sqrt(s*o);t.viewport.scale=c*r}function AP(t,e=!1){const n=t.canvas.width,r=t.canvas.height;bP(t),t.image!==void 0&&(e||GP(t,n,r)?PP(t):BP(t,n,r))}function WP(t,e){const{hflip:n,vflip:r,rotation:a}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,a!==0){const i=a*Math.PI/180,s=Math.cos(i),o=Math.sin(i),c=t.x*s-t.y*o,l=t.x*o+t.y*s;t.x=c,t.y=l}return t}function zP(t,e=!0,n=!0){const{canvas:r,image:a,viewport:i}=t,s=b5(r,a,0).scaleFactor;i.vflip=!1,i.hflip=!1,e&&(i.translation.x=0,i.translation.y=0),n&&(i.displayedArea.tlhc.x=1,i.displayedArea.tlhc.y=1,i.displayedArea.brhc.x=a.columns,i.displayedArea.brhc.y=a.rows,i.scale=s)}const $P=1;class ti extends ms{constructor(e){super(e),this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&AP(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=n=>{var r;return(r=this.getImagePlaneReferenceData(n))==null?void 0:r.FrameOfReferenceUID},this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=n=>{const r=jU.newInstance();r.setInputData(n);const a=tP.newInstance();a.setMapper(r);const{preferSizeOverAccuracy:i}=E5().rendering;return i&&r.setPreferSizeOverAccuracy(!0),n.getPointData().getScalars().getNumberOfComponents()>1&&a.getProperty().setIndependentComponents(!1),a},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=n=>{let r;return n!==void 0&&(r=this.perImageIdDefaultProperties.get(n)),r!==void 0?r:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:n,voiRange:r,VOILUTFunction:a,interpolationType:i,invert:s,voiUpdatedWithSetProperties:o}=this;return{colormap:n,voiRange:r,VOILUTFunction:a,interpolationType:i,invert:s,isComputedVOI:!o}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:n}=this._cpuFallbackEnabledElement;return n.rotation},this.getRotationGPU=()=>{const{viewUp:n,viewPlaneNormal:r,flipVertical:a}=this.getCameraNoRotation(),i=a?Ya(ne(),this.initialViewUp):this.initialViewUp,s=M8(i,n)*180/Math.PI,o=ut(ne(),i,n);return Ve(o,r)>=0?s:(360-s)%360},this.setRotation=n=>{const r=this.getCamera();if(this.useCPURendering?this.setRotationCPU(n):this.setRotationGPU(n),this._suppressCameraModifiedEvents)return;const a=this.getCamera(),i={previousCamera:r,camera:a,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Q(this.element,X.CAMERA_MODIFIED,i)},this.renderImageObject=n=>{this._setCSImage(n),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,n)},this._setCSImage=n=>{var r;n.isPreScaled=(r=n.preScale)==null?void 0:r.scaled,this.csImage=n},this.canvasToWorldCPU=(n,r=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[a,i]=fc(this._cpuFallbackEnabledElement,n),{origin:s,spacing:o,direction:c}=this.getImageData(),l=c.slice(0,3),f=c.slice(3,6);return zt(r,s,l,a*o[0]),zt(r,r,f,i*o[1]),r},this.worldToCanvasCPU=n=>{const{spacing:r,direction:a,origin:i}=this.getImageData(),s=a.slice(0,3),o=a.slice(3,6),c=Nt(ne(),n,i),l=[Ve(c,s)/r[0],Ve(c,o)/r[1]];return kh(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPU=n=>{const r=this.getRenderer(),a=this.getVtkActiveCamera(),i=a.getClippingRange(),s=a.getDistance();a.setClippingRange(s,s+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[n[0]*f,n[1]*f],g=[u[0]+this.sx,u[1]+this.sy];g[1]=l[1]-g[1];const p=c.displayToWorld(g[0],g[1],0,r);return a.setClippingRange(i[0],i[1]),[p[0],p[1],p[2]]},this.worldToCanvasGPU=n=>{const r=this.getRenderer(),a=this.getVtkActiveCamera(),i=a.getClippingRange(),s=a.getDistance();a.setClippingRange(s,s+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...n,r);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy];a.setClippingRange(i[0],i[1]);const g=window.devicePixelRatio||1;return[u[0]/g,u[1]/g]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=()=>this.imageIds[this.currentImageIdIndex],this.hasImageId=n=>this.imageIds.includes(n),this.hasImageURI=n=>{const r=this.imageIds;for(let a=0;a<r.length;a++)if(zn(r[a])===n)return!0;return!1},this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(Mv(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(n={})=>{const{resetPan:r=!0,resetZoom:a=!0}=n;return this.resetCameraCPU({resetPan:r,resetZoom:a}),!0},gpu:(n={})=>{const{resetPan:r=!0,resetZoom:a=!0}=n;return this.resetCameraGPU({resetPan:r,resetZoom:a}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:this.canvasToWorldGPU},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:this.worldToCanvasGPU},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:super.getRenderer},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=Co(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.imageIds=[],this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return Co()}_configureRenderingPipeline(e){this.useCPURendering=e??Co();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const r=this.renderingPipelineFunctions[n];this[n]=this.useCPURendering?r.cpu:r.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new Ms,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),n=y5.newInstance();e.setActiveCamera(n);const r=[0,0,-1];this.initialViewUp=[0,-1,0],n.setDirectionOfProjection(-r[0],-r[1],-r[2]),n.setViewUp(...this.initialViewUp),n.setParallelProjection(!0),n.setThicknessFromFocalPoint(.1),n.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){de.addEventListener(X.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),de.removeEventListener(X.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!nr(e))return;const{actor:n}=e,r=n.getMapper().getInputData(),a=this.csImage;return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),get scalarData(){return a==null?void 0:a.voxelManager.getScalarData()},imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...a==null?void 0:a.calibration,...this.calibration},preScale:{...a==null?void 0:a.preScale},voxelManager:a==null?void 0:a.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement,n=e.spacing,r=this.csImage;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:a=>{const i=this.worldToCanvasCPU(a),s=fc(this._cpuFallbackEnabledElement,i);return[s[0],s[1],0]},indexToWorld:(a,i)=>{const s=kh(this._cpuFallbackEnabledElement,[a[0],a[1]]);return this.canvasToWorldCPU(s,i)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...r==null?void 0:r.calibration,...this.calibration},preScale:{...r==null?void 0:r.preScale},voxelManager:r==null?void 0:r.voxelManager}}buildMetadata(e){const n=e.imageId,{pixelRepresentation:r,bitsAllocated:a,bitsStored:i,highBit:s,photometricInterpretation:o,samplesPerPixel:c}=Z("imagePixelModule",n),{windowWidth:l,windowCenter:f,voiLUTFunction:u}=e,{modality:g}=Z("generalSeriesModule",n),p=Z("scalingModule",n),h=Z(Jt.CALIBRATION,n);g==="PT"&&p&&this._addScalingToViewport(p),this.modality=g;const d=this._getValidVOILUTFunction(u);this.VOILUTFunction=d,this.calibration=h;let m=this._getImagePlaneModule(n);return this.useCPURendering||(m=this.calibrateIfNecessary(n,m)),{imagePlaneModule:m,imagePixelModule:{bitsAllocated:a,bitsStored:i,samplesPerPixel:c,highBit:s,photometricInterpretation:o,pixelRepresentation:r,windowWidth:l,windowCenter:f,modality:g,voiLUTFunction:d}}}calibrateIfNecessary(e,n){const r=Z("calibratedPixelSpacing",e),a=this.calibration!==r,{scale:i}=r||{};return this.hasPixelSpacing=i>0||n.rowPixelSpacing>0,n.calibration=r,a&&(this.calibration=r,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:i,calibration:r}),n}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(n,e),this.getCurrentImageId()===n&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:a,interpolationType:i}={},s=!1){this.viewportStatus=this.csImage?Wt.PRE_RENDER:Wt.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??n,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??r,invert:this.globalDefaultProperties.invert??a,interpolationType:this.globalDefaultProperties.interpolationType??i},typeof e<"u"&&this.setColormap(e),typeof n<"u"&&this.setVOI(n,{suppressEvents:s,voiUpdatedWithSetProperties:!0}),typeof r<"u"&&this.setVOILUTFunction(r,s),typeof a<"u"&&this.setInvertColor(a),typeof i<"u"&&this.setInterpolationType(i)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=Wt.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(xr.LINEAR);const n=this.getTransferFunction();Vu(n,this.initialTransferFunctionNodes);const a=zl(n).reduce((o,c)=>(o.push(c[0],c[1],c[2],c[3]),o),[]),i=this.getDefaultActor(),s=O5(a,i.actor);this.setColormap(s)}resetToDefaultProperties(){var a;this.cpuRenderingInvalidated=!0,this.viewportStatus=Wt.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),n=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;(a=n.colormap)!=null&&a.name&&this.setColormap(n.colormap);let r;n.voiRange==null?r=this._getVOIRangeForCurrentImage():r=n.voiRange,this.setVOI(r),this.setInterpolationType(xr.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:n,invert:r}=this;this.setVOI(e),this.setInterpolationType(n),this.setInvertColor(r)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement,{direction:r}=e,a=r.slice(6,9).map(u=>-u);let i=r.slice(3,6).map(u=>-u);if(n.rotation){const u=Og(Ca(),n.rotation*Math.PI/180,a);i=Re(ne(),i,u)}const s=[this.element.clientWidth/2,this.element.clientHeight/2],o=this.canvasToWorld(s),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),f=R8(c,l)/2;return{parallelProjection:!0,focalPoint:o,position:[0,0,0],parallelScale:f,scale:n.scale,viewPlaneNormal:[a[0],a[1],a[2]],viewUp:[i[0],i[1],i[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,a=this.getCameraCPU(),{focalPoint:i,parallelScale:s,scale:o,flipHorizontal:c,flipVertical:l}=e,{clientHeight:f}=this.element;if(i){const g=this.worldToCanvasCPU(i),p=fc(this._cpuFallbackEnabledElement,g),h=this.worldToCanvasCPU(a.focalPoint),d=fc(this._cpuFallbackEnabledElement,h),m=L8();Cl(m,pd(p[0],p[1]),pd(d[0],d[1]));const v=WP({x:m[0],y:m[1]},n);n.translation.x-=v.x,n.translation.y-=v.y}if(s){const{rowPixelSpacing:g}=r,p=f*g*.5/s;n.scale=p,n.parallelScale=s}if(o){const{rowPixelSpacing:g}=r;n.scale=o,n.parallelScale=f*g*.5/o}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=t0(this._cpuFallbackEnabledElement);const u={previousCamera:a,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Q(this.element,X.CAMERA_MODIFIED,u)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,focalPoint:[...e.map(r=>-r),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOILUTFunction(e,n){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const r=this._getValidVOILUTFunction(e);let a=!1;this.VOILUTFunction!==r&&(a=!0),this.VOILUTFunction=r;const{voiRange:i}=this.getProperties();this.setVOI(i,{suppressEvents:n,forceRecreateLUTFunction:a})}setRotationCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.rotation=e}setRotationGPU(e){const n=this.getPan(this.fitToCanvasCamera),r=this.getPan(),a=Tl([0,0],n,r);this.setPan(a,!1);const{flipVertical:i}=this.getCamera(),s=i?Ya(ne(),this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:s}),this.getVtkActiveCamera().roll(-e);const o=this.getPan(),c=this.getPan(this.fitToCanvasCamera),l=Tl([0,0],o,c),f=Vg([0,0],n,l);this.setPan(f,!1)}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n||!nr(n))return;const{actor:r}=n;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.pixelReplication=e!==xr.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n&&(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(n&&nr(n)){if(an(n,"vtkVolume")){const a=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&To(a),this.invert=e}else if(an(n,"vtkImageSlice")){const a=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&To(a),this.invert=e}}}setVOICPU(e,n={}){const{suppressEvents:r=!1}=n,{viewport:a,image:i}=this._cpuFallbackEnabledElement;if(!a||!i)return;if(typeof e>"u"){const{windowWidth:o,windowCenter:c}=i,l=Array.isArray(o)?o[0]:o,f=Array.isArray(c)?c[0]:c;a.voi={windowWidth:l,windowCenter:f};const{lower:u,upper:g}=xo(l,f);e={lower:u,upper:g}}else{const{lower:o,upper:c}=e,{windowCenter:l,windowWidth:f}=M5(o,c);a.voi||(a.voi={windowWidth:0,windowCenter:0}),a.voi.windowWidth=f,a.voi.windowCenter=l}this.voiRange=e;const s={viewportId:this.id,range:e};r||Q(this.element,X.VOI_MODIFIED,s)}getTransferFunction(){const e=this.getDefaultActor();return!e||!nr(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,n={}){const{suppressEvents:r=!1,forceRecreateLUTFunction:a=!1,voiUpdatedWithSetProperties:i=!1}=n;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!a&&!this.stackInvalidated)return;const s=this.getDefaultActor();if(!s||!nr(s))return;const o=s.actor;let c=e;if(typeof c>"u"){const p=o.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:p[0],upper:p[1]}}o.getProperty().setUseLookupTableScalarRange(!0);let l=o.getProperty().getRGBTransferFunction(0);const f=this.VOILUTFunction===Er.SAMPLED_SIGMOID;if((f||!l||a)&&(l=(f?D5:wv)(c),this.invert&&To(l),o.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=zl(l)),f||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=i),r)return;const u={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};Q(this.element,X.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:n,suvlbm:r,suvbsa:a}=e,i={};r&&(i.suvbwToSuvlbm=r/n),a&&(i.suvbwToSuvbsa=a/n),this.scaling.PT=i}_getNumCompsFromPhotometricInterpretation(e){let n=1;return(e==="RGB"||e.includes("YBR")||e==="PALETTE COLOR")&&(n=3),n}getImageDataMetadata(e){const{imagePlaneModule:n,imagePixelModule:r}=this.buildMetadata(e);let a,i;a=n.rowCosines,i=n.columnCosines,(a==null||i==null)&&(a=[1,0,0],i=[0,1,0]);const s=Qe(a[0],a[1],a[2]),o=Qe(i[0],i[1],i[2]),c=ne();ut(c,s,o);let l=n.imagePositionPatient;l==null&&(l=[0,0,0]);const f=n.columnPixelSpacing||e.columnPixelSpacing,u=n.rowPixelSpacing||e.rowPixelSpacing,g=e.columns,p=e.rows,h=$P,d=1,m=e.numberOfComponents||this._getNumCompsFromPhotometricInterpretation(r.photometricInterpretation);return{bitsAllocated:r.bitsAllocated,numberOfComponents:m,origin:l,direction:[...s,...o,...c],dimensions:[g,p,d],spacing:[f,u,h],numVoxels:g*p*d,imagePlaneModule:n,imagePixelModule:r}}matchImagesForOverlay(e,n){return(a=>{const i=Z(Jt.IMAGE_PLANE,n),s=Z(Jt.IMAGE_PLANE,a),o=i.imageOrientationPatient,c=s.imageOrientationPatient;if(o&&c){if(yt(i.imageOrientationPatient,s.imageOrientationPatient)){const f=i.imagePositionPatient,u=s.imagePositionPatient;if(f&&u&&yt(f,u)){const p=i.rows,h=i.columns,d=s.rows,m=s.columns;if(p===d&&h===m)return a}}}else{const l=i.rows,f=i.columns,u=s.rows,g=s.columns;if(l===u&&f===g)return a}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const n=this.imageIds[e];if(!n)return;const r=Z(Jt.IMAGE_PLANE,n);if(!r)return;const{imagePositionPatient:a,frameOfReferenceUID:i}=r;let{rowCosines:s,columnCosines:o}=r;s||(s=[1,0,0]),o||(o=[0,1,0]);const c=ut([0,0,0],o,s);return{FrameOfReferenceUID:i,viewPlaneNormal:c,cameraFocalPoint:a,referencedImageId:n,sliceIndex:e}}_getCameraOrientation(e){const n=e.slice(6,9).map(a=>-a),r=e.slice(3,6).map(a=>-a);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}createVTKImageData({origin:e,direction:n,dimensions:r,spacing:a,numberOfComponents:i,pixelArray:s}){const o=new s.constructor(s.length),c=le.newInstance({name:"Pixels",numberOfComponents:i,values:o}),l=f5.newInstance();return l.setDimensions(r),l.setSpacing(a),l.setDirection(n),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:a,numberOfComponents:i,pixelArray:s}){try{this._imageData=this.createVTKImageData({origin:e,direction:n,dimensions:r,spacing:a,numberOfComponents:i,pixelArray:s})}catch(o){console.error(o)}}async setStack(e,n=0){this._throwIfDestroyed(),this.imageIds=e,this.currentImageIdIndex=n,this.targetImageIdIndex=n;const r=Z(Qo.IMAGE_RETRIEVE_CONFIGURATION,e[n],"stack");this.imagesLoader=r?(r.create||cv)(r):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=xr.LINEAR,this.invert=!1,this.viewportStatus=Wt.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const a=await this._setImageIdIndex(n),i={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return Q(this.element,X.VIEWPORT_NEW_IMAGE_SET,i),a}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,a]=n.getSpacing(),[i,s]=n.getDimensions(),o=this._getImagePlaneModule(e.imageId),c=n.getDirection(),l=c.slice(0,3),f=c.slice(3,6),u=n.getPointData().getScalars().getDataType(),g=yt(r,e.columnPixelSpacing),p=yt(a,e.rowPixelSpacing),h=g||e.columnPixelSpacing===null&&r===1,d=p||e.rowPixelSpacing===null&&a===1,m=i===e.columns,v=s===e.rows,C=yt(o.rowCosines,l),y=yt(o.columnCosines,f),T=u===e.voxelManager.getScalarData().constructor.name;return h&&d&&m&&v&&C&&y&&T}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r),Ev(this._imageData,e)}_loadAndDisplayImage(e,n){return this.useCPURendering?this._loadAndDisplayImageCPU(e,n):this._loadAndDisplayImageGPU(e,n)}_loadAndDisplayImageCPU(e,n){return new Promise((r,a)=>{function i(p,h,d){if(this.currentImageIdIndex!==h)return;const m=p.voxelManager.getScalarData(),v=p.preScale,C=v==null?void 0:v.scalingParameters,y=(v==null?void 0:v.scaled)&&(C==null?void 0:C.rescaleIntercept)%1!==0||(C==null?void 0:C.rescaleSlope)%1!==0;if(m instanceof Float32Array&&y){const x={min:p.maxPixelValue,max:p.minPixelValue},E=Math.abs(x.max-x.min)/65535,L=x.min,R=m.length,D=new Uint16Array(R);let I=65535,b=0;for(let F=0;F<R;F++){const W=Math.floor((m[F]-L)/E);D[F]=W,I=Math.min(I,W),b=Math.max(b,W)}p.minPixelValue=I,p.maxPixelValue=b,p.slope=E,p.intercept=L,p.getPixelData=()=>D,p.preScale={...p.preScale,scaled:!1}}this._setCSImage(p),this.viewportStatus=Wt.PRE_RENDER;const T={image:p,imageId:d,imageIdIndex:h,viewportId:this.id,renderingEngineId:this.renderingEngineId};Q(this.element,X.STACK_NEW_IMAGE,T),this._updateToDisplayImageCPU(p),this.render(),this.currentImageIdIndex=h,r(d)}function s(p,h,d){const m={error:p,imageIdIndex:h,imageId:d};this.suppressEvents||Q(de,X.IMAGE_LOAD_ERROR,m),a(p)}function o(p,h,d){return ci(p,d).then(m=>{i.call(this,m,h,p)},m=>{s.call(this,m,h,p)})}const c=-5,l=se.Interaction,f={imageId:e,imageIdIndex:n},u={useRGBA:!0,requestType:l},g={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};Q(this.element,X.PRE_STACK_NEW_IMAGE,g),or.addRequest(o.bind(this,e,n,u),l,f,c)})}successCallback(e,n){var l,f;const r=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==r)return;const a=(l=this.csImage)==null?void 0:l.imageFrame,i=n==null?void 0:n.imageFrame,s=(a==null?void 0:a.photometricInterpretation)||((f=this.csImage)==null?void 0:f.photometricInterpretation),o=(i==null?void 0:i.photometricInterpretation)||(n==null?void 0:n.photometricInterpretation);s!==o&&(this.stackInvalidated=!0),this._setCSImage(n);const c={image:n,imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(n),Q(this.element,X.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=r}errorCallback(e,n,r){if(!n)return;const a=this.imageIds.indexOf(e),i={error:r,imageIdIndex:a,imageId:e};Q(de,X.IMAGE_LOAD_ERROR,i)}getLoaderImageOptions(e){const n=this.imageIds.indexOf(e),{transferSyntaxUID:r}=Z("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:r,priority:5,requestType:se.Interaction,additionalDetails:{imageId:e,imageIdIndex:n}}}async loadImages(e,n){const r=await Promise.allSettled(e.map(i=>{const s=this.getLoaderImageOptions(i);return ci(i,s).then(o=>(n.successCallback(i,o),i),o=>(n.errorCallback(i,!0,o),i))})),a=r.filter(i=>i.status==="rejected");if(a&&a.length){const i=new CustomEvent(X.IMAGE_LOAD_ERROR,{detail:a,cancelable:!0});de.dispatchEvent(i)}return r}_loadAndDisplayImageGPU(e,n){const r={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};return Q(this.element,X.PRE_STACK_NEW_IMAGE,r),this.imagesLoader.loadImages([e],this).then(a=>e)}_updateToDisplayImageCPU(e){const n=this.getImageDataMetadata(e),r=Lv(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:a,windowWidth:i}=r.voi;this.voiRange=xo(i,a),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...n},this.cpuImagePixelData=e.voxelManager.getScalarData();const s=Object.assign({},r,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?r:s,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=t0(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const n=[];e.forEach(r=>{const{imageId:a,...i}=r,s=ie.getImage(a),{origin:o,dimensions:c,direction:l,spacing:f,numberOfComponents:u}=this.getImageDataMetadata(s),g=this.createVTKImageData({origin:o,dimensions:c,direction:l,spacing:f,numberOfComponents:u,pixelArray:s.voxelManager.getScalarData()}),p=this.createActorMapper(g);p&&(n.push({uid:r.actorUID??_r(),actor:p,referencedId:a,...i}),r.callback&&r.callback({imageActor:p,imageId:r.imageId}))}),this.addActors(n)}_updateActorToDisplayImageId(e){const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getViewPresentation();if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(r),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:a,direction:i,dimensions:s,spacing:o,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),f=e.voxelManager.getScalarData();this._createVTKImageData({origin:a,direction:i,dimensions:s,spacing:o,numberOfComponents:c,pixelArray:f}),this._updateVTKImageDataFromCornerstoneImage(e);const u=this.createActorMapper(this._imageData),g=this.getActors();g.length&&g[0].uid===this.id?g[0].actor=u:g.unshift({uid:this.id,actor:u}),this.setActors(g);const{viewPlaneNormal:p,viewUp:h}=this._getCameraOrientation(i),d=this.getCamera();this.setCameraNoEvent({viewUp:h,viewPlaneNormal:p}),this.initialViewUp=h,this.resetCameraNoEvent(),this.setViewPresentation(r),this.triggerCameraEvent(this.getCamera(),d);const m=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const v=this._getInitialVOIRange(e);this.setVOI(v,{forceRecreateLUTFunction:!!m}),this.initialInvert=!!m,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.globalDefaultProperties.voiRange;const{windowCenter:n,windowWidth:r}=e;let a=this._getVOIRangeFromWindowLevel(r,n);return a=this._getPTPreScaledRange()||a,a}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){var e;return!(this.modality!=="PT"||!this.csImage.isPreScaled||!((e=this.csImage.preScale)!=null&&e.scalingParameters.suvbw))}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,n){let r,a;if(typeof n=="number"&&typeof e=="number"?(r=n,a=e):Array.isArray(n)&&Array.isArray(e)&&(r=n[0],a=e[0]),r!==void 0&&a!==void 0)return xo(a,r)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=Wt.PRE_RENDER;const n=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const r=this.perImageIdDefaultProperties.get(n);r!==void 0?this.setProperties(r):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return n}resetCameraCPU({resetPan:e=!0,resetZoom:n=!0}){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;zP(this._cpuFallbackEnabledElement,e,n);const{scale:a}=this._cpuFallbackEnabledElement.viewport,{clientWidth:i,clientHeight:s}=this.element,o=[i/2,s/2],c=this.canvasToWorldCPU(o);this.setCameraCPU({focalPoint:c,scale:a})}resetCameraGPU({resetPan:e,resetZoom:n}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:!0})}scroll(e,n=!0,r=!1){const a=this.imageIds,i=this.targetImageIdIndex,s=a.length;let o=i+e;o=Math.max(0,o),r?o=o%s:o=Math.min(s-1,o),this.targetImageIdIndex=o;const c=a[o];ie.isLoaded(c)||!n?this.setImageIdIndex(o):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(o)},40));const f={newImageIdIndex:o,imageId:c,direction:e};o!==i&&Q(this.element,X.STACK_VIEWPORT_SCROLL,f)}setImageIdIndex(e){return this._throwIfDestroyed(),this.currentImageIdIndex===e?Promise.resolve(this.getCurrentImageId()):this._setImageIdIndex(e)}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Q(this.element,X.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Q(this.element,X.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}jumpToWorld(e){const n=this.getImageIds(),r=this.getImageData(),{direction:a,spacing:i}=r,s=Pl({direction:a,spacing:i,imageIds:n},e,this.getCamera().viewPlaneNormal),o=n.indexOf(s);return o===-1?!1:(this.setImageIdIndex(o),this.render(),!0)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:n}=this.csImage;return this._getVOIRangeFromWindowLevel(n,e)}_getValidVOILUTFunction(e){return Object.values(Er).includes(e)?e:Er.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:n}=this.getImageData();return{width:n[0],height:n[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,n={}){if(!super.isReferenceViewable(e,n))return!1;const{referencedImageId:r,sliceIndex:a}=e;if(e.volumeId&&!r)return n.asVolume;let i=this.getCurrentImageIdIndex(),s=this.imageIds[i];if(n.withNavigation&&typeof a=="number"&&(i=a,s=this.imageIds[i]),!s)return!1;if(n.asOverlay&&r&&this.matchImagesForOverlay(s,r))return!0;let{imageURI:o}=n;o||(o=zn(s));const l=zn(r)===o;if(l)return l;const{cameraFocalPoint:f}=e;if(n.asNearbyProjection&&f){const{spacing:u,direction:g,origin:p}=this.getImageData(),h=g.slice(6,9),d=ps({direction:g,spacing:u},h),m=Nt(ne(),f,p),v=Ve(m,h),C=d/2;if(Math.abs(v)<=C)return!0}return!1}getViewReference(e={}){const{sliceIndex:n=this.getCurrentImageIdIndex()}=e,r=super.getViewReference(e),a=this.imageIds[n];if(a){if(r.referencedImageId=a,this.getCurrentImageIdIndex()!==n){const i=this.getImagePlaneReferenceData(n);if(!i)return;Object.assign(r,i)}return r}}setViewReference(e){if(!e)return;const{referencedImageId:n,sliceIndex:r}=e;if(typeof r=="number"&&n&&n===this.imageIds[r])this.scroll(r-this.targetImageIdIndex);else{const a=this.imageIds.indexOf(n);if(a!==-1)this.scroll(a-this.targetImageIdIndex);else throw new Error("Unsupported - referenced image id not found")}}getViewReferenceId(e={}){const{sliceIndex:n=this.currentImageIdIndex}=e;if(Array.isArray(n))throw new Error("Use of slice ranges for stacks not supported");return`imageId:${this.imageIds[n]}`}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const n=Zo(e.name);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const r={viewportId:this.id,colormap:e};Q(this.element,X.COLORMAP_MODIFIED,r)}setColormapGPU(e){const a=this.getDefaultActor().actor.getProperty(),i=a.getRGBTransferFunction(),s=Zo(e.name)||bl.getPresetByName(e.name);if(i)i.applyColorMap(s),i.setMappingRange(this.voiRange.lower,this.voiRange.upper),a.setRGBTransferFunction(0,i);else{const c=fi.newInstance();c.applyColorMap(s),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),a.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const o={viewportId:this.id,colormap:e};Q(this.element,X.COLORMAP_MODIFIED,o)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){var a;const n=Z(Jt.IMAGE_PLANE,e);this.hasPixelSpacing=!n.usingDefaultValues||((a=this.calibration)==null?void 0:a.scale)>0,this.calibration||(this.calibration=n.calibration);const r={...n};return r.columnPixelSpacing||(r.columnPixelSpacing=1),r.rowPixelSpacing||(r.rowPixelSpacing=1),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}}class _v extends Lu{constructor(e){super(e),this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:n,orientation:r}=this.options,a=this.getVtkActiveCamera();n!=null&&a.setParallelProjection(n),r&&r!==us.ACQUISITION&&this.applyViewOrientation(r)}resetCamera({resetPan:e=!0,resetZoom:n=!0,resetToCenter:r=!0}={}){super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:r});const a=this.getVtkActiveCamera();return a.getParallelProjection()?a.setClippingRange(-Xe.MAXIMUM_RAY_DISTANCE,Xe.MAXIMUM_RAY_DISTANCE):a.setClippingRange(Xe.MINIMUM_SLAB_THICKNESS,Xe.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,n){return null}setBlendMode(e,n,r){return null}resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=Xe.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=ie.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(N5(n.actor,r),nr(n)){const a=n.actor.getProperty().getRGBTransferFunction(0);Vu(a,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),Q(this.element,X.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-Xe.MAXIMUM_RAY_DISTANCE,Xe.MAXIMUM_RAY_DISTANCE):e.setClippingRange(Xe.MINIMUM_SLAB_THICKNESS,Xe.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}const Nv="viewport-element",Iv="cornerstone-canvas",Uh=1e-4;function jP(t){const e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.imageRendering="pixelated",e.classList.add(Iv),t.appendChild(e),e}function HP(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(Nv),t.appendChild(e),e}function vr(t){const e=`canvas.${Iv}`,n=`div.${Nv}`,r=t.querySelector(n)||HP(t),a=r.querySelector(e);if(a)return a;const i=jP(r),s=r.getBoundingClientRect(),o=window.devicePixelRatio||1,c=Math.ceil(s.width*o),l=Math.ceil(s.height*o);return i.width=c,i.height=l,i}async function KP(t,e,n,r=!1,a=!1){n.forEach(s=>{const o=t.getViewport(s);if(!o)throw new Error(`Viewport with Id ${s} does not exist`);if(!(o instanceof Lu))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const i=n.map(async s=>{await t.getViewport(s).setVolumes(e,r,a)});await Promise.all(i)}class qP{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,n){this.transferFunction[e]=n}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const n=this.transferFunction[0],r=n.getRedValue(e),a=n.getGreenValue(e),i=n.getBlueValue(e);return[r,a,i,this.opacity]}}class XP{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class YP{constructor(e,n){this.canvasProperties=new qP(this),this.visibility=!1,this.mapper=new XP(this),this.className="CanvasActor",this.derivedImage=n,this.viewport=e}renderRLE(e,n,r){const{width:a,height:i}=this.image;let{canvas:s}=this;(!s||s.width!==a||s.height!==i)&&(this.canvas=s=new window.OffscreenCanvas(a,i));const o=s.getContext("2d"),c=o.createImageData(a,i),{data:l}=c;l.fill(0);const{map:f}=r;let u=1/0,g=1/0,p=-1/0,h=-1/0;for(let v=0;v<i;v++){const C=f.getRun(v,0);if(!C)continue;g=Math.min(g,v),h=Math.max(h,v);const y=v*a<<2;let T;for(const x of C){const{start:S,end:w,value:E}=x;if(E===0){T||(T=[]),T.push(C.indexOf(x));continue}u=Math.min(u,S),p=Math.max(p,w);const L=this.canvasProperties.getColor(E).map(D=>D*255);let R=y+(S<<2);for(let D=S;D<w;D++)l[R++]=L[0],l[R++]=L[1],l[R++]=L[2],l[R++]=L[3]}}if(u>a)return;const d=p-u,m=h-g;o.putImageData(c,0,0,u-1,g-1,d+2,m+2),n.drawImage(s,u,g,d,m,u,g,d,m)}render(e,n){if(!this.visibility)return;const r=this.image||this.getImage(),{width:a,height:i}=r,s=r.getScalarData();if(!s)return;const{voxelManager:o}=r;if(o&&o.map.getRun){this.renderRLE(e,n,o);return}let{canvas:c}=this;(!c||c.width!==a||c.height!==i)&&(this.canvas=c=new window.OffscreenCanvas(a,i));const l=c.getContext("2d"),f=l.createImageData(a,i),{data:u}=f;let g=0,p=0,h=1/0,d=1/0,m=-1/0,v=-1/0;for(let T=0;T<i;T++)for(let x=0;x<a;x++){const S=s[g++];if(S){h=Math.min(x,h),d=Math.min(T,d),m=Math.max(x,m),v=Math.max(T,v);const w=this.canvasProperties.getColor(S);u[p]=w[0]*255,u[p+1]=w[1]*255,u[p+2]=w[2]*255,u[p+3]=127}p+=4}if(h>a)return;const C=m-h+1,y=v-d+1;l.putImageData(f,0,0,h,d,C,y),n.drawImage(c,h,d,C,y,h,d,C,y)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:n=>e.imageData.worldToIndex(n),indexToWorld:(n,r)=>e.imageData.indexToWorld(n,r),getDimensions:()=>e.dimensions,getScalarData:()=>{var n;return(n=this.derivedImage)==null?void 0:n.getPixelData()},getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:n=>{this.derivedImage=n,this.image=null},modified:()=>null}),this.image}}function G5(t,e){const{pointInShapeFn:n,callback:r,boundsIJK:a,returnPoints:i=!1}=e;let s,o,c,l,f,u,g;const{numComps:p}=t;if(t.getScalarData?g=t.getScalarData():g=t.getPointData().getScalars().getData(),!g){console.warn("No scalar data found for imageData",t);return}const h=t.getDimensions();a?[[s,o],[c,l],[f,u]]=a:(s=0,o=h[0],c=0,l=h[1],f=0,u=h[2]);const d=Qe(s,c,f),m=t.getDirection(),v=m.slice(0,3),C=m.slice(3,6),y=m.slice(6,9),T=t.getSpacing(),[x,S,w]=T,E=t.indexToWorld(d),L=Qe(v[0]*x,v[1]*x,v[2]*x),R=Qe(C[0]*S,C[1]*S,C[2]*S),D=Qe(y[0]*w,y[1]*w,y[2]*w),I=p||g.length/h[2]/h[1]/h[0],b=h[0]*I,F=h[1]*b,W=[],P=Zi(E);for(let K=f;K<=u;K++){const U=Zi(P);for(let N=c;N<=l;N++){const k=Zi(P);for(let z=s;z<=o;z++){const j=[z,N,K];if(n(P,j)){const $=K*F+N*b+z*I;let re;I>2?re=[g[$],g[$+1],g[$+2]]:re=g[$],W.push({value:re,index:$,pointIJK:j,pointLPS:P.slice()}),r&&r({value:re,index:$,pointIJK:j,pointLPS:P})}pn(P,P,L)}jo(P,k),pn(P,P,R)}jo(P,U),pn(P,P,D)}return i?W:void 0}const Oo=class Oo extends ms{constructor(e){super({...e,canvas:e.canvas||vr(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const n=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(n)?this.numberOfFrames:n},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const n=this.canvas,{clientWidth:r,clientHeight:a}=n;(n.width!==r||n.height!==a)&&(n.width=r,n.height=a),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(n,r=[0,0,0])=>{const a=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio(),s=[a[0]*i,a[1]*i],o=[n[0]-s[0],n[1]-s[1]];return r.splice(0,2,o[0]/i,o[1]/i),r},this.worldToCanvas=n=>{const r=this.videoCamera.panWorld,a=this.getWorldToCanvasRatio();return[(n[0]+r[0])*a,(n[1]+r[1])*a]},this.getRotation=()=>0,this.canvasToIndex=n=>{const r=this.getTransform();return r.invert(),r.transformPoint(n.map(a=>a*devicePixelRatio))},this.indexToCanvas=n=>this.getTransform().transformPoint(n).map(a=>a/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{var o;const n=window.devicePixelRatio||1,a=this.getTransform().getMatrix(),i=this.canvasContext;i.resetTransform(),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.transform(a[0]/n,a[1]/n,a[2]/n,a[3]/n,a[4]/n,a[5]/n),i.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const c of this.getActors())c.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),Q(this.element,X.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),Q(this.element,X.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(o=this.initialRender)==null||o.call(this);const s=this.getFrameNumber();this.isPlaying&&(s<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):s>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const n=typeof e=="string"?e:e.imageId,r=Z(Jt.IMAGE_PLANE,n);let a=r.rowCosines,i=r.columnCosines;(a==null||i==null)&&(a=[1,0,0],i=[0,1,0]);const s=Qe(a[0],a[1],a[2]),o=Qe(i[0],i[1],i[2]),{rows:c,columns:l}=r,f=ne();ut(f,s,o);let u=r.imagePositionPatient;u==null&&(u=[0,0,0]);const g=r.columnPixelSpacing||1,p=r.rowPixelSpacing||1,h=r.columns,d=r.rows,m=1,v=1;return this.hasPixelSpacing=!!r.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:u,rows:c,columns:l,direction:[...s,...o,...f],dimensions:[h,d,v],spacing:[g,p,m],hasPixelSpacing:this.hasPixelSpacing,numVoxels:h*d*v,imagePlaneModule:r}}setDataIds(e,n){var r;this.setVideo(e[0],(((r=n.viewReference)==null?void 0:r.sliceIndex)||0)+1)}setVideo(e,n){this.imageId=Array.isArray(e)?e[0]:e;const r=Z(Jt.IMAGE_URL,e);if(!(r!=null&&r.rendered))throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:a}=r,i=Z(Jt.GENERAL_SERIES,e);this.modality=i==null?void 0:i.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:s,numberOfFrames:o}=Z(Jt.CINE,e);return this.numberOfFrames=o,this.setVideoURL(a).then(()=>((!o||o===1)&&(o=Math.round(this.videoElement.duration*(s||30))),s||(s=Math.round(o/this.videoElement.duration)),this.fps=s,this.numberOfFrames=o,this.setFrameRange([1,o]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(n||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(n||1),c(this)},25)})))}async setVideoURL(e){return new Promise(n=>{this.videoElement.src=e,this.videoElement.preload="auto";const r=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",r),this.refreshRenderValues(),n(!0)};this.videoElement.addEventListener("loadedmetadata",r)})}getImageIds(){const e=new Array(this.numberOfFrames),n=this.imageId.replace(/[0-9]+$/,"");for(let r=0;r<this.numberOfFrames;r++)e[r]=`${n}${r+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const n=this.videoElement,r=this.renderFrame,i=n.currentTime+e*this.scrollSpeed/this.fps;n.currentTime=i;const s=o=>{r(),n.removeEventListener("seeked",s)};n.addEventListener("seeked",s)}async start(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=0,e.paused){const r=a=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async end(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=e.duration,e.paused){const r=a=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async setTime(e){const n=this.videoElement,r=this.renderFrame;if(n.currentTime=e,n.paused){const a=i=>{r(),n.removeEventListener("seeked",a)};n.addEventListener("seeked",a)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,n=$o.FRAME){this.scrollSpeed=n===$o.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){var i;if(((i=this.scalarData)==null?void 0:i.frameNumber)===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const s=new Uint8ClampedArray;return s.getRange=()=>[0,255],s.frameNumber=-1,s}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");n.drawImage(this.videoElement,0,0);const a=n.getImageData(0,0,e.width,e.height).data;return a.getRange=()=>[0,255],a.frameNumber=this.getFrameNumber(),this.scalarData=a,a}getImageData(){const{metadata:e}=this,n=e.spacing,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:i=>{const s=this.worldToCanvas(i),o=this.canvasToIndex(s);return[o[0],o[1],0]},indexToWorld:(i,s)=>{const o=this.indexToCanvas([i[0],i[1]]);return this.canvasToWorld(o,s)}},a={dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(i,s)=>G5(s.imageData,{pointInShapeFn:s.isInObject??(()=>!0),callback:i,boundsIJK:s.boundsIJK,returnPoints:s.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(r,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),a}hasImageURI(e){const n=e.match(Oo.frameRangeExtractor),r=n?e.substring(0,n.index):e;return this.imageId.includes(r)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,n=128){const r=n-e/2,a=n+e/2-1;this.setVOI({lower:r,upper:a}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite){this.feFilter=null;return}const e=this.averageWhite||[255,255,255],n=Math.max(...e),r=e.map(c=>n/c),{lower:a=0,upper:i=255}=this.voiRange||{},s=(i-a+1)/255,o=a/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${r[0]*s} 0 0 0 ${o}           0 ${r[1]*s} 0 0 ${o}           0 0 ${r[2]*s} 0 ${o}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:n,focalPoint:r}=e;if(n&&(this.videoCamera.parallelScale=this.element.clientHeight/2/n),r!==void 0){const a=this.worldToCanvas(r),i=[this.element.clientWidth/2,this.element.clientHeight/2],s=[(a[0]-i[0])/this.videoCamera.parallelScale,(a[1]-i[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-s[0],this.videoCamera.panWorld[1]-s[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(){return this.imageId.replace("/frames/1",this.isPlaying?`/frames/${this.frameRange[0]}-${this.frameRange[1]}`:`/frames/${this.getFrameNumber()}`)}getViewReferenceId(e={}){const{sliceIndex:n}=e;return n===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(n)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${n[0]+1}-${n[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+n}`)}`}isReferenceViewable(e,n={}){let{imageURI:r}=n;const{referencedImageId:a,sliceIndex:i}=e;if(!super.isReferenceViewable(e))return!1;const s=this.getCurrentImageId();if(!r){const u=s.indexOf(":");r=s.substring(u+1,s.length-1)}if(n.withNavigation)return!0;const o=this.getSliceIndex();if(Array.isArray(i))return o>=i[0]&&o<=i[1];if(i!==void 0)return o===i;if(!a)return!1;const c=a.match(Oo.frameRangeExtractor);if(!c[2])return!0;const l=c[2].split("-").map(u=>Number(u)),f=o+1;return l[0]<=f&&f<=(l[1]??l[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){let n=(e==null?void 0:e.sliceIndex)??this.getSliceIndex();return n||(n=this.isPlaying?[this.frameRange[0]-1,this.frameRange[1]-1]:this.getCurrentImageIdIndex()),{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:n}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,n=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(n),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const n=Math.floor(this.videoWidth*e),r=Math.floor(this.videoHeight*e),a=(this.canvas.offsetWidth-n)/2,i=(this.canvas.offsetHeight-r)/2,s=a/e,o=i/e;this.videoCamera.panWorld=[s,o],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,n=window.devicePixelRatio||1,r=this.getWorldToCanvasRatio(),a=this.getCanvasToWorldRatio(),i=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],s=[i[0]*a,i[1]*a],o=new Ms;return o.scale(n,n),o.translate(i[0],i[1]),o.scale(r,r),o.translate(e[0],e[1]),o.translate(-s[0],-s[1]),o}updateCameraClippingPlanesAndRange(){}addImages(e){const n=this.getActors();e.forEach(r=>{const a=ie.getImage(r.imageId),i=this.createActorMapper(a),s=r.actorUID??_r();i&&(n.push({uid:s,actor:i}),r.callback&&r.callback({imageActor:i,imageId:r.imageId}))}),this.setActors(n)}createActorMapper(e){return new YP(this,e)}};Oo.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let T2=Oo;const ZP=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`,Ph=Symbol.for("map"),QP="postrender",$i=class $i extends ms{constructor(e){super({...e,canvas:e.canvas||vr(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const r=this.canvas,{clientWidth:a,clientHeight:i}=r;(r.width!==a||r.height!==i)&&(r.width=a,r.height=i),this.refreshRenderValues()},this.canvasToWorld=r=>{if(!this.metadata)return;const[a,i]=this.canvasToIndex(r),{origin:s,spacing:o,direction:c}=this.getImageData(),l=Qe(0,0,0),f=c.slice(0,3),u=c.slice(3,6);return zt(l,s,f,a*o[0]),zt(l,l,u,i*o[1]),[l[0],l[1],l[2]]},this.worldToCanvas=r=>{if(!this.metadata)return;const{spacing:a,direction:i,origin:s}=this.metadata,o=i.slice(0,3),c=i.slice(3,6),l=Nt([0,0,0],r,s),f=[Ve(l,o)/a[0],Ve(l,c)/a[1]];return this.indexToCanvas(f)},this.postrender=()=>{this.refreshRenderValues(),Q(this.element,X.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=r=>{const a=this.getTransform();return a.invert(),a.transformPoint(r)},this.indexToCanvas=r=>this.getTransform().transformPoint(r),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=_r(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const n=this.element.firstElementChild;n.insertBefore(this.microscopyElement,n.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){var n;this.removeEventListeners(),(n=this.viewer)==null||n.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null}getImageDataMetadata(e=0){var L;const n=this.metadataDicomweb.reduce((R,D)=>(R==null?void 0:R.NumberOfFrames)<D.NumberOfFrames?D:R),{TotalPixelMatrixColumns:r,TotalPixelMatrixRows:a,ImageOrientationSlide:i,ImagedVolumeWidth:s,ImagedVolumeHeight:o,ImagedVolumeDepth:c}=n,l=Z(Jt.IMAGE_PLANE,this.imageIds[e]);let f=i.slice(0,3),u=i.slice(3,6);(f==null||u==null)&&(f=[1,0,0],u=[0,1,0]);const g=Qe(f[0],f[1],f[2]),p=Qe(u[0],u[1],u[2]),h=ne();ut(h,g,p);const{XOffsetInSlideCoordinateSystem:d=0,YOffsetInSlideCoordinateSystem:m=0,ZOffsetInSlideCoordinateSystem:v=0}=((L=n.TotalPixelMatrixOriginSequence)==null?void 0:L[0])||{},C=[d,m,v],y=s/r,T=o/a,x=r,S=a,w=c,E=1;return this.hasPixelSpacing=!!(s&&o),{bitsAllocated:8,numberOfComponents:3,origin:C,direction:[...g,...p,...h],dimensions:[x,S,E],spacing:[y,T,w],hasPixelSpacing:this.hasPixelSpacing,numVoxels:x*S*E,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){}resetProperties(){this.setProperties({})}getScalarData(){return null}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:n}=e,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:i=>{const s=this.worldToCanvas(i),o=this.canvasToIndex(s);return[o[0],o[1],0]},indexToWorld:i=>{const s=this.indexToCanvas([i[0],i[1]]);return this.canvasToWorld(s)}};return{dimensions:e.dimensions,spacing:n,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(i,s)=>G5(s.imageData,{pointInShapeFn:s.isInObject??(()=>!0),callback:i,boundsIJK:s.boundsIJK,returnPoints:s.returnPoints??!1})}}}hasImageURI(e){return!0}setCamera(e){const n=this.getCamera(),{parallelScale:r,focalPoint:a}=e,i=this.getView(),{xSpacing:s}=this.internalCamera;if(r){const c=this.element.clientHeight/r,l=1/s/c;i.setResolution(l)}if(a){const c=this.worldToCanvas(a),l=this.canvasToIndex(c);i.setCenter(l)}const o=this.getCamera();this.triggerCameraModifiedEventIfNecessary(n,o)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:n}=this.internalCamera,r=e*n,a=[this.element.clientWidth/2,this.element.clientHeight/2],i=this.canvasToWorld(a);return{parallelProjection:!0,focalPoint:i,position:i,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*r,viewPlaneNormal:[0,0,1]}}setDataIds(e,n){(n==null?void 0:n.miniNavigationOverlay)!==!1&&$i.addMiniNavigationOverlayCss();const r=(n==null?void 0:n.webClient)||Z(Jt.WADO_WEB_CLIENT,e[0]);if(!r)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);return this.setWSI(e,r)}async setWSI(e,n){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e;const r=await $i.getDicomMicroscopyViewer();this.frameOfReferenceUID=null;const a=this.imageIds.map(o=>{var u,g,p;const c=n.getDICOMwebMetadata(o);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=(u=c["00080008"])==null?void 0:u.Value;(l==null?void 0:l.length)===1&&(c["00080008"].Value=l[0].split("\\"));const f=(p=(g=c["00200052"])==null?void 0:g.Value)==null?void 0:p[0];return this.frameOfReferenceUID?f!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=f,c}),i=[];a.forEach(o=>{const c=new r.metadata.VLWholeSlideMicroscopyImage({metadata:o}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?i.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=i;const s=new r.viewer.VolumeImageViewer({client:n,metadata:i,controls:["overview","position"],retrieveRendered:!1,bindings:{}});s.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),s.deactivateDragPanInteraction(),this.viewer=s,this.map=s[Ph],this.map.on(QP,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const n=this.getCamera();this.setCamera({parallelScale:n.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[Ph],n=window;return n.map=e,n.viewer=this.viewer,n.view=e==null?void 0:e.getView(),n.wsi=this,e==null?void 0:e.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const n=e.getResolution();if(!n||n<Ir)return;const r=e.getCenter(),a=e.getProjection().getExtent(),i=e.getRotation(),s=e.getZoom(),{metadata:{spacing:[o,c]}}=this,l=1/n/o;Object.assign(this.internalCamera,{extent:a,centerIndex:r,worldToCanvasRatio:l,xSpacing:o,ySpacing:c,resolution:n,rotation:i,zoom:s})}getZoom(){var e;return(e=this.getView())==null?void 0:e.getZoom()}setZoom(e){var n;(n=this.getView())==null||n.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:n,rotation:r}=this.internalCamera,a=[this.canvas.width/2,this.canvas.height/2],i=new Ms;return i.translate(a[0],a[1]),i.rotate(r),i.scale(1/n,-1/n),i.translate(-e[0],-e[1]),i}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=ZP,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};$i.getDicomMicroscopyViewer=async()=>lI("dicom-microscopy-viewer"),$i.overlayCssId="overlayCss";let x2=$i;const Fv={[Ae.ORTHOGRAPHIC]:e0,[Ae.PERSPECTIVE]:e0,[Ae.STACK]:ti,[Ae.VOLUME_3D]:_v,[Ae.VIDEO]:T2,[Ae.WHOLE_SLIDE]:x2};function Ei(t){return Fv[t].useCustomRenderingPipeline}const bh=2;class kv{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const a=this._getViewportsAsArray().map(i=>{if(i.getFrameOfReferenceUID()===n)return i.id});this.renderViewports(a)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let a=0;a<n.length;a++){const i=n[a];if(this._needsRender.has(i.id)){const s=this.renderViewportUsingCustomOrVtkPipeline(i);if(r.push(s),i.setRendered(),this._needsRender.delete(i.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(a=>{a!=null&&a.element&&Q(a.element,X.IMAGE_RENDERED,a)})},this.id=e||_r(),this.useCPURendering=Co(),Ho.set(this),!V7())throw new Error("@cornerstonejs/core is not initialized, run init() first");this.useCPURendering||(this.offscreenMultiRenderWindow=cN.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer)),this._viewports=new Map,this.hasBeenDestroyed=!1}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:a}=n;if(!r)throw new Error("No element provided");this.getViewport(a)&&this.disableElement(a);const{type:s}=n,o=Ei(s);!this.useCPURendering&&!o?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const c=vr(r),{background:l}=n.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!Ei(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),n.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],a=[];n.forEach(i=>{!this.useCPURendering&&!Ei(i.type)?r.push(i):a.push(i)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(a),n.forEach(i=>{const s=vr(i.element),{background:o}=i.defaultOptions;this.fillCanvasWithBackgroundColor(s,o)})}resize(e=!0,n=!0){this._throwIfDestroyed();const r=this._getViewportsAsArray(),a=[],i=[];r.forEach(s=>{Ei(s.type)?i.push(s):a.push(s)}),a.length&&this._resizeVTKViewports(a,n,e),i.length&&this._resizeUsingCustomResizeHandler(i,n,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n)throw new Error(`Viewport with Id ${e} does not exist`);if(!(n instanceof ti))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return n}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(n=>n instanceof ti)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof Lu;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(this.useCPURendering||(this._getViewportsAsArray().forEach(n=>{this.offscreenMultiRenderWindow.removeRenderer(n.id)}),this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),Ho.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let a;if(n){const i=n.map(s=>Math.floor(255*s));a=`rgb(${i[0]}, ${i[1]}, ${i[2]})`}else a="black";r.fillStyle=a,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let a=r;return(!a||Object.keys(a).length===0)&&(a={background:[0,0,0],orientation:null,displayArea:null},n===Ae.ORTHOGRAPHIC&&(a={...a,orientation:us.AXIAL})),{...e,defaultOptions:a}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0){e.forEach(a=>{typeof a.resize=="function"&&a.resize()}),e.forEach(a=>{const i=a.getCamera();a.resetCamera(),n&&a.setCamera(i)}),r&&this.render()}_resizeVTKViewports(e,n=!0,r=!0){const a=e.map(i=>vr(i.element));if(a.forEach(i=>{const s=window.devicePixelRatio||1;i.width=i.clientWidth*s,i.height=i.clientHeight*s}),a.length){const{offScreenCanvasWidth:i,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(a);this._resize(e,i,s)}e.forEach(i=>{const s=i.getCamera(),o=i.getRotation(),{flipHorizontal:c}=s;i.resetCameraForResize();const l=i.getDisplayArea();n&&(l?(c&&i.setCamera({flipHorizontal:c}),o&&i.setViewPresentation({rotation:o})):i.setCamera(s))}),r&&this.render()}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(f=>Ei(f.type)===!1),a=r.map(f=>f.canvas),i=vr(e.element);a.push(i);const{offScreenCanvasWidth:s,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(a),c=this._resize(r,s,o),l={...e,canvas:i};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:s,offScreenCanvasHeight:o,xOffset:c})}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addVtkjsDrivenViewport(e,n){const{element:r,canvas:a,viewportId:i,type:s,defaultOptions:o}=e;r.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:f}=n,{sxStartDisplayCoords:u,syStartDisplayCoords:g,sxEndDisplayCoords:p,syEndDisplayCoords:h,sx:d,sy:m,sWidth:v,sHeight:C}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,f);this.offscreenMultiRenderWindow.addRenderer({viewport:[u,g,p,h],id:i,background:o.background?o.background:[0,0,0]});const y={id:i,element:r,renderingEngineId:this.id,type:s,canvas:a,sx:d,sy:m,sWidth:v,sHeight:C,defaultOptions:o||{}};let T;if(s===Ae.STACK)T=new ti(y);else if(s===Ae.ORTHOGRAPHIC||s===Ae.PERSPECTIVE)T=new e0(y);else if(s===Ae.VOLUME_3D)T=new _v(y);else throw new Error(`Viewport Type ${s} is not supported`);this._viewports.set(i,T);const x={element:r,viewportId:i,renderingEngineId:this.id};T.suppressEvents||Q(de,X.ELEMENT_ENABLED,x)}addCustomViewport(e){const{element:n,viewportId:r,type:a,defaultOptions:i}=e;n.tabIndex=-1;const s=vr(n),{clientWidth:o,clientHeight:c}=s;(s.width!==o||s.height!==c)&&(s.width=o,s.height=c);const l={id:r,renderingEngineId:this.id,element:n,type:a,canvas:s,sx:0,sy:0,sWidth:o,sHeight:c,defaultOptions:i||{}},f=Fv[a],u=new f(l);this._viewports.set(r,u);const g={element:n,viewportId:r,renderingEngineId:this.id};Q(de,X.ELEMENT_ENABLED,g)}setCustomViewports(e){e.forEach(n=>{this.addCustomViewport(n)})}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(s=>vr(s.element));n.forEach(s=>{const o=window.devicePixelRatio||1,c=s.getBoundingClientRect();s.width=c.width*o,s.height=c.height*o});const{offScreenCanvasWidth:r,offScreenCanvasHeight:a}=this._resizeOffScreenCanvas(n);let i=0;for(let s=0;s<e.length;s++){const o=e[s],c=n[s],l={...o,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:r,offScreenCanvasHeight:a,xOffset:i}),i+=c.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,a=Math.max(...e.map(s=>s.height));let i=0;return e.forEach(s=>{i+=s.width}),n.width=i,n.height=a,r.resize(),{offScreenCanvasWidth:i,offScreenCanvasHeight:a}}_resize(e,n,r){let a=0;for(let i=0;i<e.length;i++){const s=e[i],{sxStartDisplayCoords:o,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:f,sx:u,sy:g,sWidth:p,sHeight:h}=this._getViewportCoordsOnOffScreenCanvas(s,n,r,a);a+=s.canvas.width,s.sx=u,s.sy=g,s.sWidth=p,s.sHeight=h,this.offscreenMultiRenderWindow.getRenderer(s.id).setViewport([o,c,l,f])}return a}_getViewportCoordsOnOffScreenCanvas(e,n,r,a){const{canvas:i}=e,{width:s,height:o}=i,c=a,l=0,f=c/n,u=l+(r-o)/r,g=s/n,p=o/r;return{sxStartDisplayCoords:f,syStartDisplayCoords:u,sxEndDisplayCoords:f+g,syEndDisplayCoords:u+p,sx:c,sy:l,sWidth:s,sHeight:o}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(r.length){for(let a=0;a<r.length;a++){const{renderer:i,id:s}=r[a];this._needsRender.has(s)?i.setDraw(!0):i.setDraw(!1)}n.render();for(let a=0;a<r.length;a++)r[a].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(e.sWidth<bh||e.sHeight<bh){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(Ei(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,s=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,s)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:a,sx:i,sy:s,sWidth:o,sHeight:c,id:l,renderingEngineId:f,suppressEvents:u}=e,{width:g,height:p}=a;return a.getContext("2d").drawImage(n,i,s,o,c,0,0,g,p),{element:r,suppressEvents:u,viewportId:l,renderingEngineId:f,viewportStatus:e.viewportStatus}}_resetViewport(e){const n=this.id,{element:r,canvas:a,id:i}=e,s={element:r,viewportId:i,renderingEngineId:n};e.removeWidgets(),Q(de,X.ELEMENT_DISABLED,s),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),a.getContext("2d").clearRect(0,0,a.width,a.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){const e=this._debugRender();JP(e)}_debugRender(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();for(let c=0;c<r.length;c++)r[c].renderer.setDraw(!0);n.render();const s=e.getOpenGLRenderWindow().get3DContext().canvas,o=s.toDataURL();return this._getViewportsAsArray().forEach(c=>{const{sx:l,sy:f,sWidth:u,sHeight:g}=c,p=c.canvas,{width:h,height:d}=p;p.getContext("2d").drawImage(s,l,f,u,g,0,0,h,d)}),o}}function JP(t){const e=document.createElement("a");e.download="viewport.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}var In;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(In||(In={}));class _u{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,n,r){const a=e.indexOf(".");if(a!==-1){const s=e.substring(0,a);let o=this._children.get(s);o||(o=new _u(this._target),this._children.set(s,o)),e=e.substring(a+1),o.addEventListener(e,n,r)}else this._addEventListener(e,n,r)}removeEventListener(e,n,r){const a=e.indexOf(".");if(a!==-1){const s=e.substring(0,a),o=this._children.get(s);if(!o)return;e=e.substring(a+1),o.removeEventListener(e,n,r),o.isEmpty&&this._children.delete(s)}else this._removeEventListener(e,n,r)}reset(){Array.from(this._children.entries()).forEach(([e,n])=>{if(n.reset(),n.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,n,r){let a=this._eventListeners.get(e);a||(a=new Map,this._eventListeners.set(e,a));const s=(r==null?void 0:r.capture)??!1?In.Capture:In.Bubble,o=a.get(n)??In.None;if(o&s){console.warn("A listener is already registered for this phase");return}a.set(n,o|s),this._target.addEventListener(e,n,r)}_removeEventListener(e,n,r){const i=(r==null?void 0:r.capture)??!1?In.Capture:In.Bubble,s=this._eventListeners.get(e);if(!s)return;(n?[n]:Array.from(s.keys())).forEach(c=>{const l=s.get(c)??In.None;if(!!!(l&i))return;this._target.removeEventListener(e,c,r);const u=l^i;u===In.None?s.delete(c):s.set(c,u)}),s.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,n){Array.from(n.entries()).forEach(([r,a])=>{const i=In.Capture;for(let s=i;a;s<<=1){if(!(a&s))continue;const o=s===In.Capture;this.removeEventListener(e,r,{capture:o}),a^=s}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,n])=>{this._unregisterAllListeners(e,n)})}}class eb{constructor(){this._targetsEventListeners=new Map}addEventListener(e,n,r,a){let i=this._targetsEventListeners.get(e);i||(i=new _u(e),this._targetsEventListeners.set(e,i)),i.addEventListener(n,r,a)}removeEventListener(e,n,r,a){const i=this._targetsEventListeners.get(e);i&&(i.removeEventListener(n,r,a),i.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,n])=>{n.reset(),this._targetsEventListeners.delete(e)})}}const tb=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:eb,TargetEventListeners:_u},Symbol.toStringTag,{value:"Module"}));function nb(t,e){const n=t.getSize();for(let r=0;r<n;r++){const a=[];t.getNodeValue(r,a),a[1]=a[1]*e,a[2]=a[2]*e,a[3]=a[3]*e,t.setNodeValue(r,a)}}const rb=Symbol("LastRuntimeId"),ab={},ib=4294967295,sb="-";function ob(t,e,n){return cb(t!==null&&typeof t=="object"?t:ab,rb,(typeof n=="number"&&n>0?n:ib)>>>0).join(typeof e=="string"?e:sb)}function cb(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let a=!0,i=0;a&&i<r.length;++i){let s=r[i]|0;s<n?(a=!1,s=s+1):(s=0,i+1===r.length&&r.push(0)),r[i]=s}return r}const Gh={},lb={add:(t,e)=>{const n=zn(t);Gh[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=zn(e);return Gh[n]}}};function ub(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function fb(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function gb(t,e){let n;e?n=[y0(e)]:n=Du();const r=[];return n.forEach(a=>{const i=t.getActors(),s=a.getVolumeViewports();for(const o of s){const c=o.getActors();if(c.length!==i.length)continue;i.every(({uid:f})=>c.find(u=>f===u.uid))&&r.push(o)}}),r}const Uv=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function Pv(t,e,n=void 0,r="_thumbnails",a={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const i=!e.imageId,s=!i&&e,o=i&&e,l=`renderGPUViewport-${s.imageId||o.volumeId}`,f=document.createElement("div"),u=window.devicePixelRatio||1;a.displayArea||(a.displayArea={imageArea:[1,1]});const g=t.width,p=t.height;f.style.width=`${g/u+Uh}px`,f.style.height=`${p/u+Uh}px`,f.style.visibility="hidden",f.style.position="absolute",document.body.appendChild(f);const h=l.split(":").join("-");f.setAttribute("viewport-id-for-remove",h);const d=vr(f),m=y0(r)||new kv(r);let v=m.getViewport(l);if(!v){const C={viewportId:l,type:i?Ae.ORTHOGRAPHIC:Ae.STACK,element:f,defaultOptions:{...a,suppressEvents:!0}};m.enableElement(C),v=m.getViewport(l)}return new Promise(C=>{let y=!1,{viewReference:T}=a;const x=S=>{if(y)return;if(T){const I=T;T=null,v.setViewReference(I),v.render();return}t.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,t.width,t.height);const E=v.canvasToWorld([0,0]),L=v.canvasToWorld([d.width/u,0]),R=v.canvasToWorld([0,d.height/u]),D=1;y=!0,f.removeEventListener(X.IMAGE_RENDERED,x),setTimeout(()=>{m.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${h}"]`).forEach(b=>{b.remove()})},0),C({origin:E,bottomLeft:R,topRight:L,thicknessMm:D})};f.addEventListener(X.IMAGE_RENDERED,x),i?v.setVolumes([o],!1,!0):v.renderImageObject(e),v.resetCamera(),n==="PT"&&!Uv(s)&&v.setProperties({voiRange:{lower:s.minPixelValue,upper:s.maxPixelValue}}),v.render()})}function bv(t,e,n,r,a){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const s=e,o=Lv(t,s,n),c={canvas:t,viewport:o,image:s,renderingTools:{}};c.transform=t0(c);const l=!0;return new Promise((f,u)=>{Mv(c,l),f(null)})}function pb(t){const{canvas:e,imageId:n,viewReference:r,requestType:a=se.Thumbnail,priority:i=-5,renderingEngineId:s="_thumbnails",useCPURendering:o=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:f}=t,u=r==null?void 0:r.volumeId,g=u&&!n,p=r&&f?{...f,viewReference:r}:f,h=o?bv:Pv;return new Promise((d,m)=>{function v(x,S){var R;const{modality:w}=Z("generalSeriesModule",S)||{},E=!g&&x,L=g&&x;E&&(E.isPreScaled=E.isPreScaled||((R=E.preScale)==null?void 0:R.scaled)),c&&(e.height=256,e.width=256),l&&E&&(e.width=E&&e.height*E.width/E.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,L&&o&&m(new Error("CPU rendering of volume not supported")),h(e,x,w,s,p).then(d)}function C(x,S){console.error(x,S),m(x)}function y(x,S,w){return ci(x,w).then(E=>{v.call(this,E,x)},E=>{C.call(this,E,x)})}const T={useRGBA:!!o,requestType:a};if(u){const x=ie.getVolume(u);x||m(new Error(`Volume id ${u} not found in cache`));const S=x.imageIds[0];v(x,S)}else or.addRequest(y.bind(null,n,null,T),a,{imageId:n},i)})}function db(t,e){const n=Z("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:a,imagePositionPatient:i}=n;let{columnPixelSpacing:s,rowPixelSpacing:o}=n;s||(s=1),o||(o=1);const c=ne();zt(c,i,r,-s/2),zt(c,c,a,-o/2);const l=ne();jt(l,e,c);const f=Ve(l,a),u=Ve(l,r);return[f/o,u/s]}function hb(t,e){const n=Z("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:a,imagePositionPatient:i}=n;let{columnPixelSpacing:s,rowPixelSpacing:o}=n;s||(s=1),o||(o=1);const c=ne();return zt(c,i,a,o*(e[0]-.5)),zt(c,c,r,s*(e[1]-.5)),Array.from(c)}function mb(t){const e=Du(),n=[];return e.forEach(r=>{r.getViewports().forEach(i=>{i.hasImageURI(t)&&n.push(i)})}),n}function vb(t,e){const n=yb(t,e);return n?n.index:null}function yb(t,e){const n=e.getImageIds(),r=e.getCurrentImageIdIndex();if(n.length===0)return null;const a=c=>{const l=Cb(c);if(!l)return null;const f=dv(l.planeNormal,l.imagePositionPatient);return hv(f,t)},i={distance:a(n[r])??1/0,index:r},s=n.slice(r+1);for(let c=0;c<s.length;c++){const l=s[c],f=a(l);if(f!==null)if(f<=i.distance)i.distance=f,i.index=c+r+1;else break}const o=n.slice(0,r);for(let c=o.length-1;c>=0;c--){const l=o[c],f=a(l);if(!(f===null||f===i.distance))if(f<i.distance)i.distance=f,i.index=c;else break}return i.distance===1/0?null:i}function Cb(t){const e=Z("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:a}=e,i=Ee(ne(),...n),s=Ee(ne(),...r),o=ut(ne(),i,s);return{rowCosines:n,columnCosines:r,imagePositionPatient:a,planeNormal:o}}function Tb(t){const{width:e,height:n}=t.getCanvas(),{sliceToIndexMatrix:r,indexToSliceMatrix:a}=t.getSliceViewInfo(),i=Qr(t,[0,0]),s=Qr(t,[e-1,0]),o=Qr(t,[0,n-1]),c=jt(ne(),s,i),l=jt(ne(),o,i),f=ut(ne(),c,l);kt(c,c),kt(l,l),kt(f,f);const u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),g=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!od(1,u)||!od(1,g))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:p}=t.getImageData(),h=t.getSliceViewInfo(),d=p.getSliceData(h);return{width:h.width,height:h.height,scalarData:d,sliceToIndexMatrix:r,indexToSliceMatrix:a}}const Va={},ql={add:(t,e)=>{const[n,r]=t,a=`${n}_${r}`;Va[a]||(Va[a]={}),Va[a]=e},get:(t,e,n)=>{if(t!=="spatialRegistrationModule")return;const r=`${e}_${n}`;if(Va[r])return Va[r];const a=`${n}_${e}`;if(Va[a])return lt(Ca(),Va[a])}};xs(ql.get.bind(ql));const xb=.05;function Sb(t,e){const n=t.getSliceIndex(),r=e.getSliceIndex(),a=Z("imagePlaneModule",n.toString()),i=Z("imagePlaneModule",r.toString());if(!a||!i){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:s}=i;if(!a.imageOrientationPatient.every((g,p)=>Math.abs(g-s[p])<xb)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",a==null?void 0:a.imageOrientationPatient,i==null?void 0:i.imageOrientationPatient);return}const c=a.imagePositionPatient,l=i.imagePositionPatient,f=Nt(ne(),c,l),u=du(Ca(),f);ql.add([t.id,e.id],u)}function wb(t){const{imageData:e,dimensions:n}=t.getImageData(),{canvas:r}=t,a=window.devicePixelRatio,i=[0,0],s=[r.width/a,0],o=[r.width/a,r.height/a],c=[0,r.height/a],l=t.canvasToWorld(i),f=t.canvasToWorld(s),u=t.canvasToWorld(o),g=t.canvasToWorld(c),p=e.worldToIndex(l),h=e.worldToIndex(f),d=e.worldToIndex(u),m=e.worldToIndex(g);return Eb({dimensions:n,imageData:e,topLeftImage:p,topRightImage:h,bottomRightImage:d,bottomLeftImage:m,topLeftWorld:l,topRightWorld:f,bottomRightWorld:u,bottomLeftWorld:g})}function Eb({dimensions:t,imageData:e,topLeftImage:n,topRightImage:r,bottomRightImage:a,bottomLeftImage:i,topLeftWorld:s,topRightWorld:o,bottomRightWorld:c,bottomLeftWorld:l}){const f=gc(n,t)?s:e.indexToWorld([0,0,0]),u=gc(r,t)?o:e.indexToWorld([t[0]-1,0,0]),g=gc(a,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),p=gc(i,t)?l:e.indexToWorld([0,t[1]-1,0]);return[f,u,p,g]}function gc(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}class Wi{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:a=128}=e,i=n*r;this.growSize=a,this.array=new ArrayBuffer(i*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(e){for(let n=0;n<this._length;n++)e(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;return this.data.subarray(n,n+this._dimensions)}getPointArray(e){const n=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;for(let a=0;a<this._dimensions;a++)n.push(this.data[a+r]);return n}grow(e=1,n=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const r=this.data.length+n,a=new ArrayBuffer(r*this._dimensions*this._byteSize),i=new Float32Array(a);i.set(this.data),this.data=i,this.array=a}reverse(){const e=Math.floor(this._length/2);for(let n=0;n<e;n++){const r=n*this._dimensions,a=(this._length-1-n)*this._dimensions;for(let i=0;i<this._dimensions;i++){const s=this.data[r+i];this.data[r+i]=this.data[a+i],this.data[a+i]=s}}}push(e){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=e[r];this._length++}map(e){const n=[];for(let r=0;r<this._length;r++)n.push(e(this.getPoint(r),r));return n}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:n,y:r,z:a}=e;return this.forEach(i=>{n.push(i[0]),r.push(i[1]),a&&a.push(i[2])}),e}static fromXYZ({x:e,y:n,z:r}){const a=Wi.create3(e.length);let i=0;for(let s=0;s<e.length;s++)a.data[i++]=e[s],a.data[i++]=n[s],a.data[i++]=r?r[s]:0;return a._length=e.length,a}subselect(e=10,n=0){const r=new Wi({initialSize:e,dimensions:this._dimensions});for(let a=0;a<e;a++){const i=(n+Math.floor(this.length*a/e))%this.length;r.push(this.getPoint(i))}return r}static create3(e=128){return new Wi({initialSize:e,dimensions:3})}static create2(e=128){return new Wi({initialSize:e,dimensions:2})}}function B5(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return Rb(e,n)}function Rb(t,e){if(!e||!t)return;const n=y0(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const a=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:a}}function Ob(t){const e=B5(t);if(!e)return;const{viewport:n}=e;if(!(n instanceof ti))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()}function Mb(t){const e=t[0],{modality:n,seriesInstanceUID:r}=Z("generalSeriesModule",e),{imageOrientationPatient:a,pixelSpacing:i,frameOfReferenceUID:s,columns:o,rows:c}=Z("imagePlaneModule",e),l={modality:n,imageOrientationPatient:a,pixelSpacing:i,columns:o,rows:c,seriesInstanceUID:r};return t.every(u=>{const{modality:g,seriesInstanceUID:p}=Z("generalSeriesModule",u),{imageOrientationPatient:h,pixelSpacing:d,columns:m,rows:v}=Z("imagePlaneModule",u);return p===l.seriesInstanceUID&&g===l.modality&&m===l.columns&&v===l.rows&&yt(h,l.imageOrientationPatient)&&yt(d,l.pixelSpacing)})}const Db=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function Gv(t){return t?(Array.isArray(t)?t:[t]).find(n=>Db.has(n)):!1}async function Vb({viewport:t,options:e={}}){const n=t.getRenderingEngine();let r=e.volumeId||`${_r()}`;r.split(":").length===0&&(r=`${hU()}:${r}`);const{id:a,element:i}=t,s=e.viewportId||a,o=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();n.enableElement({viewportId:s,type:Ae.ORTHOGRAPHIC,element:i,defaultOptions:{background:e.background,orientation:e.orientation}}),(await pU(r,{imageIds:o})).load();const u=n.getViewport(s);await KP(n,[{volumeId:r}],[s]);const g=()=>{u.render(),i.removeEventListener(X.VOLUME_VIEWPORT_NEW_VOLUME,g)};return(()=>{i.addEventListener(X.VOLUME_VIEWPORT_NEW_VOLUME,g)})(),u.setViewPresentation(c),u.setViewReference(l),u.render(),u}async function Lb({viewport:t,options:e}){const n=t,{id:r,element:a}=n,i=t.getRenderingEngine(),{background:s}=e,o=e.viewportId||r,c=ie.getVolume(n.getVolumeId());if(!(c instanceof ev))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:o,type:Ae.STACK,element:a,defaultOptions:{background:s}},f=n.getViewReference();i.enableElement(l);const u=i.getViewport(o);return await u.setStack(c.imageIds),u.setViewReference(f),u.render(),u}function Bv(t,e=2){if(Array.isArray(t))return t.map(a=>Bv(a,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const n=Math.abs(t);if(n<1e-4)return`${t}`;const r=n>=100?e-2:n>=10?e-1:n>=1?e:n>=.1?e+1:n>=.01?e+2:n>=.001?e+3:e+4;return t.toFixed(r)}function _b(t){return Math.round(t/Ir)*Ir}function Nb(t,e,n){const r=t.length===e*n*4,a=t.length===e*n*3;if(r||a){const i=new Float32Array(e*n);let s=0,o=0;const c=r?4:3;for(let l=0;l<e;l++)for(let f=0;f<n;f++){const u=t[s],g=t[s+1],p=t[s+2];i[o]=(u+g+p)/3,s+=c,o++}return i}else return t}function Ib(t){if(t instanceof e0)return ie.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function Fb(t,e){const n=[...t];return e>=n.length?(Bh(n),n):(Bh(n),n.slice(0,e))}function Bh(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function bf(t){const e=t.toString(16);return e.length==1?"0"+e:e}function kb(t,e,n){return"#"+bf(t)+bf(e)+bf(n)}function Ub(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const Pb=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:Ub,rgbToHex:kb},Symbol.toStringTag,{value:"Module"}));function bb(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),t===e}}function Gb(t,e,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!n?void 0:n(e).metadata.Modality;throw new Error("Invalid viewport type")}const Bb=(t,e)=>t.reduce((n,r)=>((n[r[e]]=n[r[e]]||[]).push(r),n),{});function Ab(t){const e=t.map(s=>{const{imagePositionPatient:o}=Z("imagePlaneModule",s)||{};return{imageId:s,imagePositionPatient:o}});if(!e.every(s=>s.imagePositionPatient))return null;const n=Bb(e,"imagePositionPatient"),r=Object.keys(n),a=n[r[0]].length;return a===1||!r.every(s=>n[s].length===a)?null:n}function Wb(t,e){const n={};let r=[];const a=Object.keys(t);for(let i=0;i<a.length;i++){const s=new Set,o=t[a[i]];for(let c=0;c<o.length;c++){const l=e(o[c].imageId)||0;if(n[l]=n[l]||[],n[l].push({imageId:o[c].imageId}),s.add(l),s.size-1<c)return}if(i==0)r=Array.from(s);else if(!Hb(r,s))return}return n}function $s(t,e){const n=Z(e,t);try{return parseFloat(n)}catch{return}}function zb(t){const e=Z("20011003",t);try{const{InlineBinary:n}=e;if(n){const r=atob(n),a=new ArrayBuffer(r.length),i=new DataView(a);for(let s=0;s<r.length;s++)i.setUint8(s,r.charCodeAt(s));return new Float32Array(a)[0]}return parseFloat(e)}catch{return}}function $b(t){let e=Z("0019100c",t)||Z("0019100C",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n)),parseFloat(e)}catch{return}}function jb(t){let e=Z("00431039",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n).split("//")),parseFloat(e[0])%1e5}catch{return}}function Hb(t,e){if(t.length!=e.size)return!1;for(let n=0;n<t.length;n++)if(!e.has(t[n]))return!1;return!0}function Kb(t){const e=Z("petImageModule",t);return e?e.frameReferenceTime:0}function Av(t){const e=Ab(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],r=[a=>$s(a,n[0]),a=>$s(a,n[1]),a=>$s(a,n[2]),a=>$s(a,n[3]),a=>$s(a,n[4]),zb,$b,jb,Kb];for(let a=0;a<r.length;a++){const i=Wb(e,r[a]);if(i)return{imageIdGroups:Object.keys(i).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>i[c].map(l=>l.imageId)),splittingTag:n[a]}}return{imageIdGroups:[t],splittingTag:null}}function qb(t){const{imageIdGroups:e,splittingTag:n}=Av(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:n}}function Xb(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:a,suvbw:i}=e;if(e.modality==="PT"&&typeof i=="number")for(let s=0;s<n;s++)t[s]=i*(t[s]*r+a);else for(let s=0;s<n;s++)t[s]=t[s]*r+a;return t}function Wv(t,e,n){return Math.min(Math.max(e,t),n)}function zv(t,e){if(!B5(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof ti&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:r,delta:a,scrollSlabs:i}=e;if(t instanceof e0)Yb(t,r,a,i);else{const s=t.getCurrentImageIdIndex();if(s+a>t.getImageIds().length-1||s+a<0){const o={imageIdIndex:s,direction:a};Q(de,X.STACK_SCROLL_OUT_OF_BOUNDS,o)}t.scroll(a,e.debounceLoading,e.loop)}}function Yb(t,e,n,r=!1){const a=r,{numScrollSteps:i,currentStepIndex:s,sliceRangeInfo:o}=wo(t,e,a);if(!o)return;const{sliceRange:c,spacingInNormalDirection:l,camera:f}=o,{focalPoint:u,viewPlaneNormal:g,position:p}=f,{newFocalPoint:h,newPosition:d}=es(u,p,c,g,l,n);t.setCamera({focalPoint:h,position:d}),t.render();const m=s+n,v={volumeId:e,viewport:t,delta:n,desiredStepIndex:m,currentStepIndex:s,numScrollSteps:i,currentImageId:t.getCurrentImageId()};(m>i||m<0)&&t.getCurrentImageId()?Q(de,X.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,v):Q(de,X.VOLUME_VIEWPORT_SCROLL,v)}async function Zb(t,e={}){const{imageIndex:n,debounceLoading:r,volumeId:a}=e,i=B5(t);if(!i)throw new Error("Element has been disabled");const{viewport:s}=i,{imageIndex:o,numberOfSlices:c}=Qb(s,r),f=Jb(c,n)-o;zv(s,{delta:f,debounceLoading:r,volumeId:a})}function Qb(t,e){return t instanceof ti?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function Jb(t,e){const n=t-1;return Wv(e,0,n)}const eG=(t,e)=>Gb(t,e,ie.getVolume),$v=Object.freeze(Object.defineProperty({__proto__:null,PointsManager:Wi,ProgressiveIterator:$l,RLEVoxelMap:_8,VoxelManager:Ke,actorIsA:an,applyPreset:yv,autoLoad:h2,calculateViewportsSpatialRegistration:Sb,calibratedPixelSpacingMetadataProvider:lb,clamp:C2,clip:Wv,color:Pb,colormap:fI,convertStackToVolumeViewport:Vb,convertToGrayscale:Nb,convertVolumeToStackViewport:Lb,createLinearRGBTransferFunction:wv,createSigmoidRGBTransferFunction:D5,decimate:ov,deepClone:Jo,deepEqual:bb,deepMerge:C0,eventListener:tb,generateVolumePropsFromImageIds:av,genericMetadataProvider:Cg,getBufferConfiguration:dx,getClosestImageId:Pl,getClosestStackImageIndexForPoint:vb,getCurrentVolumeViewportSlice:Tb,getDynamicVolumeInfo:qb,getImageLegacy:Ob,getImageSliceDataForVolumeViewport:Hl,getMinMax:fv,getRandomSampleFromArray:Fb,getRuntimeId:ob,getScalingParameters:rv,getSliceRange:Mu,getSpacingInNormalDirection:ps,getTargetVolumeAndSpacingInNormalDir:I5,getViewportImageCornersInWorld:wb,getViewportImageIds:Ib,getViewportModality:eG,getViewportsWithImageURI:mb,getViewportsWithVolumeId:sv,getVoiFromSigmoidRGBTransferFunction:vv,getVolumeActorCorners:h7,getVolumeId:gv,getVolumeSliceRangeInfo:mv,getVolumeViewportScrollInfo:wo,getVolumeViewportsContainingSameVolumes:gb,hasFloatScalingParameters:_5,hasNaNValues:m2,imageIdToURI:zn,imageRetrieveMetadataProvider:Qo,imageToWorldCoords:hb,indexWithinDimensions:fb,invertRgbTransferFunction:To,isEqual:yt,isEqualAbs:xS,isEqualNegative:F8,isImageActor:nr,isOpposite:ub,isPTPrescaledWithSUV:Uv,isValidVolume:Mb,isVideoTransferSyntax:Gv,jumpToSlice:Zb,loadImageToCanvas:pb,makeVolumeMetadata:tv,planar:VU,pointInShapeCallback:G5,renderToCanvasCPU:bv,renderToCanvasGPU:Pv,roundNumber:Bv,roundToPrecision:_b,scaleArray:Xb,scaleRgbTransferFunction:nb,scroll:zv,snapFocalPointToSlice:es,sortImageIdsAndGetSpacing:nv,spatialRegistrationMetadataProvider:ql,splitImageIdsBy4DTags:Av,transferFunctionUtils:pI,transformIndexToWorld:Cv,transformWorldToIndex:V5,triggerEvent:Q,updateVTKImageDataWithCornerstoneImage:Ev,uuidv4:_r,windowLevel:gI,worldToImageCoords:db},Symbol.toStringTag,{value:"Module"})),x0=new Lg("imageRetrievalPool");x0.setMaxSimultaneousRequests(se.Interaction,200);x0.setMaxSimultaneousRequests(se.Thumbnail,200);x0.setMaxSimultaneousRequests(se.Prefetch,200);x0.grabDelay=0;function jv(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let a=0,i=0;if(n){for(let s=0;s<r;s++)e[i++]=t[a++],e[i++]=t[a++],e[i++]=t[a++],e[i++]=255;return}e.set(t)}function Hv(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let a=0,i=0,s=r,o=r*2;if(n)for(let c=0;c<r;c++)e[a++]=t[i++],e[a++]=t[s++],e[a++]=t[o++],e[a++]=255;else for(let c=0;c<r;c++)e[a++]=t[i++],e[a++]=t[s++],e[a++]=t[o++]}function Kv(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let a=0,i=0;if(n){for(let s=0;s<r;s++){const o=t[a++],c=t[a++],l=t[a++];e[i++]=o+1.402*(l-128),e[i++]=o-.34414*(c-128)-.71414*(l-128),e[i++]=o+1.772*(c-128),e[i++]=255}return}for(let s=0;s<r;s++){const o=t[a++],c=t[a++],l=t[a++];e[i++]=o+1.402*(l-128),e[i++]=o-.34414*(c-128)-.71414*(l-128),e[i++]=o+1.772*(c-128)}}function qv(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let a=0,i=0,s=r,o=r*2;if(n){for(let c=0;c<r;c++){const l=t[i++],f=t[s++],u=t[o++];e[a++]=l+1.402*(u-128),e[a++]=l-.34414*(f-128)-.71414*(u-128),e[a++]=l+1.772*(f-128),e[a++]=255}return}for(let c=0;c<r;c++){const l=t[i++],f=t[s++],u=t[o++];e[a++]=l+1.402*(u-128),e[a++]=l-.34414*(f-128)-.71414*(u-128),e[a++]=l+1.772*(f-128)}}function tG(t,e,n){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const r=t.length/2;let a=0,i=0;if(n){for(let s=0;s<r;s+=2){const o=t[a++],c=t[a++],l=t[a++],f=t[a++];e[i++]=o+1.402*(f-128),e[i++]=o-.34414*(l-128)-.71414*(f-128),e[i++]=o+1.772*(l-128),e[i++]=255,e[i++]=c+1.402*(f-128),e[i++]=c-.34414*(l-128)-.71414*(f-128),e[i++]=c+1.772*(l-128),e[i++]=255}return}for(let s=0;s<r;s+=2){const o=t[a++],c=t[a++],l=t[a++],f=t[a++];e[i++]=o+1.402*(f-128),e[i++]=o-.34414*(l-128)-.71414*(f-128),e[i++]=o+1.772*(l-128),e[i++]=c+1.402*(f-128),e[i++]=c-.34414*(l-128)-.71414*(f-128),e[i++]=c+1.772*(l-128)}}function Gf(t,e){const n=t.length,r=new Uint8ClampedArray(n);for(let a=0;a<n;++a)r[a]=t[a]>>e;return r}function Bf(t,e,n){const r=t[`${e}PaletteColorLookupTableData`];if(r)return Promise.resolve(r);const a=Z("imagePixelModule",t.imageId);return a&&typeof a.then=="function"?a.then(i=>i?i[`${e}PaletteColorLookupTableData`]:n):Promise.resolve(a?a[`${e}PaletteColorLookupTableData`]:n)}function Xv(t,e,n){const r=t.columns*t.rows,a=t.pixelData;Promise.all([Bf(t,"red",null),Bf(t,"green",null),Bf(t,"blue",null)]).then(([i,s,o])=>{if(!i||!s||!o)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=i.length;let l=0,f=0;const u=t.redPaletteColorLookupTableDescriptor[1],g=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,p=Gf(i,g),h=Gf(s,g),d=Gf(o,g);if(n){for(let m=0;m<r;++m){let v=a[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=p[v],e[f++]=h[v],e[f++]=d[v],e[f++]=255}return}for(let m=0;m<r;++m){let v=a[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=p[v],e[f++]=h[v],e[f++]=d[v]}})}function Af(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function Wf(t,e,n){const r=[],a=t.elements[e];for(let i=0;i<n[0];i++)n[2]===16?r[i]=t.uint16(e,i):r[i]=t.byteArray[i+a.dataOffset];return r}function nG(t,e){e.redPaletteColorLookupTableDescriptor=Af(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=Af(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=Af(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const n=e.redPaletteColorLookupTableDescriptor[0],a=t.elements.x00281201.length===n?8:16;e.redPaletteColorLookupTableDescriptor[2]!==a&&(e.redPaletteColorLookupTableDescriptor[2]=a,e.greenPaletteColorLookupTableDescriptor[2]=a,e.bluePaletteColorLookupTableDescriptor[2]=a),e.redPaletteColorLookupTableData=Wf(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=Wf(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=Wf(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function rG(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function Yv(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return rG(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&nG(t,e),e}function aG(t,e){let n=e.uint16("x00283002",0);n===0&&(n=65535);let r=0;t===0?r=e.uint16("x00283002",1):r=e.int16("x00283002",1);const a=e.uint16("x00283002",2),i={id:"1",firstValueMapped:r,numBitsPerEntry:a,lut:[]};for(let s=0;s<n;s++)t===0?i.lut[s]=e.uint16("x00283006",s):i.lut[s]=e.int16("x00283006",s);return i}function S2(t,e){if(!e||!e.items||!e.items.length)return;const n=[];for(let r=0;r<e.items.length;r++){const a=e.items[r].dataSet,i=aG(t,a);i&&n.push(i)}return n}function iG(t){const e=t.uint16("x00280103"),n=t.uint16("x00280101");return e===0?0:-1<<n-1}function Zv(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const n=t.floatString("x00281052"),r=t.floatString("x00281053");return n!==void 0&&r!==void 0?iG(t)*r+n<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function Hn(t,e,n){const r=[],a=t.string(e);if(!a)return;const i=a.split("\\");if(!(n&&i.length<n)){for(let s=0;s<i.length;s++)r.push(parseFloat(i[s]));return r}}var Qv={exports:{}};/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */(function(t,e){(function(n,r){t.exports=r(D9)})(cn,function(n){return a=[function(s,o){s.exports=n},function(s,o,c){c.r(o),c.d(o,"isStringVr",function(){return f}),c.d(o,"isPrivateTag",function(){return u}),c.d(o,"parsePN",function(){return g}),c.d(o,"parseTM",function(){return p}),c.d(o,"parseDA",function(){return d}),c.d(o,"explicitElementToString",function(){return m}),c.d(o,"explicitDataSetToJS",function(){return v}),c.d(o,"createJPEGBasicOffsetTable",function(){return T}),c.d(o,"parseDicomDataSetExplicit",function(){return j}),c.d(o,"parseDicomDataSetImplicit",function(){return $}),c.d(o,"readFixedString",function(){return E}),c.d(o,"alloc",function(){return re}),c.d(o,"version",function(){return xt}),c.d(o,"bigEndianByteArrayParser",function(){return Me}),c.d(o,"ByteStream",function(){return tt}),c.d(o,"sharedCopy",function(){return Gt}),c.d(o,"DataSet",function(){return D}),c.d(o,"findAndSetUNElementLength",function(){return w}),c.d(o,"findEndOfEncapsulatedElement",function(){return S}),c.d(o,"findItemDelimitationItemAndSetElementLength",function(){return I}),c.d(o,"littleEndianByteArrayParser",function(){return pe}),c.d(o,"parseDicom",function(){return R0}),c.d(o,"readDicomElementExplicit",function(){return z}),c.d(o,"readDicomElementImplicit",function(){return F}),c.d(o,"readEncapsulatedImageFrame",function(){return xa}),c.d(o,"readEncapsulatedPixelData",function(){return Vs}),c.d(o,"readEncapsulatedPixelDataFromFragments",function(){return qn}),c.d(o,"readPart10Header",function(){return he}),c.d(o,"readSequenceItemsExplicit",function(){return N}),c.d(o,"readSequenceItemsImplicit",function(){return K}),c.d(o,"readSequenceItem",function(){return W}),c.d(o,"readTag",function(){return x});var l={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},f=function(M){return l[M]},u=function(M){if(M=parseInt(M[4],16),isNaN(M))throw"dicomParser.isPrivateTag: cannot parse last character of group";return M%2==1},g=function(M){if(M!==void 0)return M=M.split("^"),{familyName:M[0],givenName:M[1],middleName:M[2],prefix:M[3],suffix:M[4]}};function p(M,_){if(2<=M.length){var B=parseInt(M.substring(0,2),10),V=4<=M.length?parseInt(M.substring(2,4),10):void 0,A=6<=M.length?parseInt(M.substring(4,6),10):void 0,H=8<=M.length?M.substring(7,13):void 0,H=H?parseInt(H,10)*Math.pow(10,6-H.length):void 0;if(_&&(isNaN(B)||V!==void 0&&isNaN(V)||A!==void 0&&isNaN(A)||H!==void 0&&isNaN(H)||B<0||23<B||V&&(V<0||59<V)||A&&(A<0||59<A)||H&&(H<0||999999<H)))throw"invalid TM '".concat(M,"'");return{hours:B,minutes:V,seconds:A,fractionalSeconds:H}}if(_)throw"invalid TM '".concat(M,"'")}function h(M,_,B){return!isNaN(B)&&0<_&&_<=12&&0<M&&M<=function(V,A){switch(V){case 2:return A%4==0&&A%100||A%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(_,B)}function d(M,_){if(M&&M.length===8){var B=parseInt(M.substring(0,4),10),V=parseInt(M.substring(4,6),10),A=parseInt(M.substring(6,8),10);if(_&&h(A,V,B)!==!0)throw"invalid DA '".concat(M,"'");return{year:B,month:V,day:A}}if(_)throw"invalid DA '".concat(M,"'")}function m(M,_){if(M===void 0||_===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(_.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var B,V=_.vr,A=_.tag;function H(xe,Pe){for(var vn="",nt=0;nt<xe;nt++)nt!==0&&(vn+="/"),vn+=Pe.call(M,A,nt).toString();return vn}if(f(V)===!0)B=M.string(A);else{if(V==="AT"){var J=M.uint32(A);return J===void 0?void 0:"x".concat((J=J<0?4294967295+J+1:J).toString(16).toUpperCase())}V==="US"?B=H(_.length/2,M.uint16):V==="SS"?B=H(_.length/2,M.int16):V==="UL"?B=H(_.length/4,M.uint32):V==="SL"?B=H(_.length/4,M.int32):V==="FD"?B=H(_.length/8,M.double):V==="FL"&&(B=H(_.length/4,M.float))}return B}function v(M,_){if(M===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";_=_||{omitPrivateAttibutes:!0,maxElementLength:128};var B,V={};for(B in M.elements){var A=M.elements[B];if(_.omitPrivateAttibutes!==!0||!u(B))if(A.items){for(var H=[],J=0;J<A.items.length;J++)H.push(v(A.items[J].dataSet,_));V[B]=H}else{var xe=void 0;A.length<_.maxElementLength&&(xe=m(M,A)),V[B]=xe!==void 0?xe:{dataOffset:A.dataOffset,length:A.length}}}return V}function C(M,_){return M.byteArray[_]===255&&M.byteArray[_+1]===217}function y(M,_,B){for(var V,A,H=B;H<_.fragments.length;H++)if(V=M,A=H,A=_.fragments[A],!(!C(V,A.position+A.length-2)&&!C(V,A.position+A.length-3)))return H}function T(M,_,B){if(M===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(_===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(_.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(_.encapsulatedPixelData!==!0||_.hadUndefinedLength!==!0||_.basicOffsetTable===void 0||_.fragments===void 0||_.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(B&&B.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";B=B||_.fragments;for(var V=[],A=0;;){V.push(_.fragments[A].offset);var H=y(M,_,A);if(H===void 0||H===_.fragments.length-1)return V;A=H+1}}function x(B){if(B===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var _=256*B.readUint16()*256,B=B.readUint16();return"x".concat("00000000".concat((_+B).toString(16)).substr(-8))}function S(M,_,B){if(M===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(_===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(_.encapsulatedPixelData=!0,_.basicOffsetTable=[],_.fragments=[],x(M)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var V=M.readUint32()/4,A=0;A<V;A++){var H=M.readUint32();_.basicOffsetTable.push(H)}for(var J=M.position;M.position<M.byteArray.length;){var xe=x(M),Pe=M.readUint32();if(xe==="xfffee0dd")return M.seek(Pe),void(_.length=M.position-_.dataOffset);if(xe!=="xfffee000")return B&&B.push("unexpected tag ".concat(xe," while searching for end of pixel data element with undefined length")),Pe>M.byteArray.length-M.position&&(Pe=M.byteArray.length-M.position),_.fragments.push({offset:M.position-J-8,position:M.position,length:Pe}),M.seek(Pe),void(_.length=M.position-_.dataOffset);_.fragments.push({offset:M.position-J-8,position:M.position,length:Pe}),M.seek(Pe)}B&&B.push("pixel data element ".concat(_.tag," missing sequence delimiter tag xfffee0dd"))}function w(M,_){if(M===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var B=M.byteArray.length-8;M.position<=B;)if(M.readUint16()===65534){var V=M.readUint16();if(V===57565)return M.readUint32()!==0&&M.warnings("encountered non zero length following item delimiter at position ".concat(M.position-4," while reading element of undefined length with tag ").concat(_.tag)),void(_.length=M.position-_.dataOffset)}_.length=M.byteArray.length-_.dataOffset,M.seek(M.byteArray.length-M.position)}function E(M,_,B){if(B<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(_+B>M.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var V,A="",H=0;H<B;H++){if((V=M[_+H])===0)return _+=B,A;A+=String.fromCharCode(V)}return A}function L(M,_){for(var B=0;B<_.length;B++){var V=_[B];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(M,V.key,V)}}function R(M,_){return M.parser!==void 0?M.parser:_}var D=function(){function M(V,A,H){(function(J,xe){if(!(J instanceof xe))throw new TypeError("Cannot call a class as a function")})(this,M),this.byteArrayParser=V,this.byteArray=A,this.elements=H}var _,B;return _=M,(B=[{key:"uint16",value:function(V,A){if(V=this.elements[V],A=A!==void 0?A:0,V&&V.length!==0)return R(V,this.byteArrayParser).readUint16(this.byteArray,V.dataOffset+2*A)}},{key:"int16",value:function(V,A){if(V=this.elements[V],A=A!==void 0?A:0,V&&V.length!==0)return R(V,this.byteArrayParser).readInt16(this.byteArray,V.dataOffset+2*A)}},{key:"uint32",value:function(V,A){if(V=this.elements[V],A=A!==void 0?A:0,V&&V.length!==0)return R(V,this.byteArrayParser).readUint32(this.byteArray,V.dataOffset+4*A)}},{key:"int32",value:function(V,A){if(V=this.elements[V],A=A!==void 0?A:0,V&&V.length!==0)return R(V,this.byteArrayParser).readInt32(this.byteArray,V.dataOffset+4*A)}},{key:"float",value:function(V,A){if(V=this.elements[V],A=A!==void 0?A:0,V&&V.length!==0)return R(V,this.byteArrayParser).readFloat(this.byteArray,V.dataOffset+4*A)}},{key:"double",value:function(V,A){if(V=this.elements[V],A=A!==void 0?A:0,V&&V.length!==0)return R(V,this.byteArrayParser).readDouble(this.byteArray,V.dataOffset+8*A)}},{key:"numStringValues",value:function(V){if(V=this.elements[V],V&&0<V.length)return V=E(this.byteArray,V.dataOffset,V.length).match(/\\/g),V===null?1:V.length+1}},{key:"string",value:function(V,A){if(V=this.elements[V],V&&V.Value)return V.Value;if(V&&0<V.length)return V=E(this.byteArray,V.dataOffset,V.length),0<=A?V.split("\\")[A].trim():V.trim()}},{key:"text",value:function(V,A){if(V=this.elements[V],V&&0<V.length)return V=E(this.byteArray,V.dataOffset,V.length),0<=A?V.split("\\")[A].replace(/ +$/,""):V.replace(/ +$/,"")}},{key:"floatString",value:function(V,A){var H=this.elements[V];if(H&&0<H.length&&(A=this.string(V,A=A!==void 0?A:0),A!==void 0))return parseFloat(A)}},{key:"intString",value:function(V,A){var H=this.elements[V];if(H&&0<H.length&&(A=this.string(V,A=A!==void 0?A:0),A!==void 0))return parseInt(A)}},{key:"attributeTag",value:function(V){var A=this.elements[V];if(A&&A.length===4){var H=R(A,this.byteArrayParser).readUint16,V=this.byteArray,A=A.dataOffset;return"x".concat("00000000".concat((256*H(V,A)*256+H(V,A+2)).toString(16)).substr(-8))}}}])&&L(_.prototype,B),Object.defineProperty(_,"prototype",{writable:!1}),M}();function I(M,_){if(M===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var B=M.byteArray.length-8;M.position<=B;)if(M.readUint16()===65534){var V=M.readUint16();if(V===57357)return M.readUint32()!==0&&M.warnings("encountered non zero length following item delimiter at position ".concat(M.position-4," while reading element of undefined length with tag ").concat(_.tag)),void(_.length=M.position-_.dataOffset)}_.length=M.byteArray.length-_.dataOffset,M.seek(M.byteArray.length-M.position)}var b=function(M,_){return M.vr!==void 0?M.vr==="SQ":_.position+4<=_.byteArray.length?(M=x(_),_.seek(-4),M==="xfffee000"||M==="xfffee0dd"):(_.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function F(M,_,B){if(M===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var V=x(M),V={tag:V,vr:B!==void 0?B(V):void 0,length:M.readUint32(),dataOffset:M.position};return V.length===4294967295&&(V.hadUndefinedLength=!0),V.tag===_||(!b(V,M)||u(V.tag)&&!V.hadUndefinedLength?V.hadUndefinedLength?I(M,V):M.seek(V.length):(K(M,V,B),u(V.tag)&&(V.items=void 0))),V}function W(M){if(M===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var _={tag:x(M),length:M.readUint32(),dataOffset:M.position};if(_.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(M.position);return _}function P(M,_){var B=W(M);return B.length===4294967295?(B.hadUndefinedLength=!0,B.dataSet=function(V,A){for(var H={};V.position<V.byteArray.length;){var J=F(V,void 0,A);if((H[J.tag]=J).tag==="xfffee00d")return new D(V.byteArrayParser,V.byteArray,H)}return V.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new D(V.byteArrayParser,V.byteArray,H)}(M,_),B.length=M.position-B.dataOffset):(B.dataSet=new D(M.byteArrayParser,M.byteArray,{}),$(B.dataSet,M,M.position+B.length,{vrCallback:_})),B}function K(M,_,B){if(M===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(_===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";_.items=[],(_.length===4294967295?function(V,A,H){for(;V.position+4<=V.byteArray.length;){var J=x(V);if(V.seek(-4),J==="xfffee0dd")return A.length=V.position-A.dataOffset,V.seek(8);J=P(V,H),A.items.push(J)}V.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),A.length=V.byteArray.length-A.dataOffset}:function(V,A,H){for(var J=A.dataOffset+A.length;V.position<J;){var xe=P(V,H);A.items.push(xe)}})(M,_,B)}function U(M,_){var B=W(M);return B.length===4294967295?(B.hadUndefinedLength=!0,B.dataSet=function(V,A){for(var H={};V.position<V.byteArray.length;){var J=z(V,A);if((H[J.tag]=J).tag==="xfffee00d")return new D(V.byteArrayParser,V.byteArray,H)}return A.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new D(V.byteArrayParser,V.byteArray,H)}(M,_),B.length=M.position-B.dataOffset):(B.dataSet=new D(M.byteArrayParser,M.byteArray,{}),j(B.dataSet,M,M.position+B.length)),B}function N(M,_,B){if(M===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(_===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";_.items=[],(_.length===4294967295?function(V,A,H){for(;V.position+4<=V.byteArray.length;){var J=x(V);if(V.seek(-4),J==="xfffee0dd")return A.length=V.position-A.dataOffset,V.seek(8);J=U(V,H),A.items.push(J)}H.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),A.length=V.position-A.dataOffset}:function(V,A,H){for(var J=A.dataOffset+A.length;V.position<J;){var xe=U(V,H);A.items.push(xe)}})(M,_,B)}var k=function(M){return M==="OB"||M==="OD"||M==="OL"||M==="OW"||M==="SQ"||M==="OF"||M==="UC"||M==="UR"||M==="UT"||M==="UN"?4:2};function z(M,_,B){if(M===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var V={tag:x(M),vr:M.readFixedString(2)};return k(V.vr)===2?V.length=M.readUint16():(M.seek(2),V.length=M.readUint32()),V.dataOffset=M.position,V.length===4294967295&&(V.hadUndefinedLength=!0),V.tag===B||(V.vr==="SQ"?N(M,V,_):V.length===4294967295?V.tag==="x7fe00010"?S(M,V,_):(V.vr==="UN"?K:I)(M,V):M.seek(V.length)),V}function j(M,_,B){var V=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(B=B===void 0?_.byteArray.length:B,_===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(B<_.position||B>_.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var A=M.elements;_.position<B;){var H=z(_,M.warnings,V.untilTag);if((A[H.tag]=H).tag===V.untilTag)return}if(_.position>B)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function $(M,_,B){var V=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(B=B===void 0?M.byteArray.length:B,_===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(B<_.position||B>_.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var A=M.elements;_.position<B;){var H=F(_,V.untilTag,V.vrCallback);if((A[H.tag]=H).tag===V.untilTag)return}}function re(M,_){if(typeof Buffer<"u"&&M instanceof Buffer)return Buffer.alloc(_);if(M instanceof Uint8Array)return new Uint8Array(_);throw"dicomParser.alloc: unknown type for byteArray"}var xt="1.8.12",Me={readUint16:function(M,_){if(_<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(_+2>M.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(M[_]<<8)+M[_+1]},readInt16:function(M,_){if(_<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(_+2>M.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return _=(M[_]<<8)+M[_+1],_=32768&_?_-65535-1:_},readUint32:function(M,_){if(_<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(_+4>M.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*M[_]+M[_+1])+M[_+2])+M[_+3]},readInt32:function(M,_){if(_<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(_+4>M.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(M[_]<<24)+(M[_+1]<<16)+(M[_+2]<<8)+M[_+3]},readFloat:function(M,_){if(_<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(_+4>M.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var B=new Uint8Array(4);return B[3]=M[_],B[2]=M[_+1],B[1]=M[_+2],B[0]=M[_+3],new Float32Array(B.buffer)[0]},readDouble:function(M,_){if(_<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(_+8>M.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var B=new Uint8Array(8);return B[7]=M[_],B[6]=M[_+1],B[5]=M[_+2],B[4]=M[_+3],B[3]=M[_+4],B[2]=M[_+5],B[1]=M[_+6],B[0]=M[_+7],new Float64Array(B.buffer)[0]}};function Gt(M,_,B){if(typeof Buffer<"u"&&M instanceof Buffer)return M.slice(_,_+B);if(M instanceof Uint8Array)return new Uint8Array(M.buffer,M.byteOffset+_,B);throw"dicomParser.from: unknown type for byteArray"}function Mt(M,_){for(var B=0;B<_.length;B++){var V=_[B];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(M,V.key,V)}}var tt=function(){function M(V,A,H){if(function(J,xe){if(!(J instanceof xe))throw new TypeError("Cannot call a class as a function")}(this,M),V===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(A===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(A instanceof Uint8Array)&&(typeof Buffer>"u"||!(A instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(H<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(H>=A.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=V,this.byteArray=A,this.position=H||0,this.warnings=[]}var _,B;return _=M,(B=[{key:"seek",value:function(V){if(this.position+V<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=V}},{key:"readByteStream",value:function(V){if(this.position+V>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var A=Gt(this.byteArray,this.position,V);return this.position+=V,new M(this.byteArrayParser,A)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var V=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,V}},{key:"readUint32",value:function(){var V=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,V}},{key:"readFixedString",value:function(V){var A=E(this.byteArray,this.position,V);return this.position+=V,A}}])&&Mt(_.prototype,B),Object.defineProperty(_,"prototype",{writable:!1}),M}(),pe={readUint16:function(M,_){if(_<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(_+2>M.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return M[_]+256*M[_+1]},readInt16:function(M,_){if(_<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(_+2>M.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return _=M[_]+(M[_+1]<<8),_=32768&_?_-65535-1:_},readUint32:function(M,_){if(_<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(_+4>M.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return M[_]+256*M[_+1]+256*M[_+2]*256+256*M[_+3]*256*256},readInt32:function(M,_){if(_<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(_+4>M.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return M[_]+(M[_+1]<<8)+(M[_+2]<<16)+(M[_+3]<<24)},readFloat:function(M,_){if(_<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(_+4>M.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var B=new Uint8Array(4);return B[0]=M[_],B[1]=M[_+1],B[2]=M[_+2],B[3]=M[_+3],new Float32Array(B.buffer)[0]},readDouble:function(M,_){if(_<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(_+8>M.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var B=new Uint8Array(8);return B[0]=M[_],B[1]=M[_+1],B[2]=M[_+2],B[3]=M[_+3],B[4]=M[_+4],B[5]=M[_+5],B[6]=M[_+6],B[7]=M[_+7],new Float64Array(B.buffer)[0]}};function he(M){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(M===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var B=_.TransferSyntaxUID,V=new tt(pe,M);return function(){var A=function(){if(V.getSize()<=132&&B)return!1;if(V.seek(128),V.readFixedString(4)==="DICM")return!0;if(!(_||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return V.seek(0),!1}(),H=[],J={};if(!A)return V.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:B}},warnings:H};for(;V.position<V.byteArray.length;){var xe=V.position,Pe=z(V,H);if("x0002ffff"<Pe.tag){V.position=xe;break}Pe.parser=pe,J[Pe.tag]=Pe}return(A=new D(V.byteArrayParser,V.byteArray,J)).warnings=V.warnings,A.position=V.position,A}()}var Yt="1.2.840.10008.1.2.2";function R0(M){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(M===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var B,V=function(H){if(H.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return H=H.elements.x00020010,H&&H.Value||E(M,H.dataOffset,H.length)};function A(Pe){var xe=V(Pe),J=xe!=="1.2.840.10008.1.2",xe=function(vn,nt){var Au=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(vn!=="1.2.840.10008.1.2.1.99")return new tt(vn===Yt?Me:pe,M,nt);if(_&&_.inflater)return vn=_.inflater(M,nt),new tt(pe,vn,0);if(Au==!0){var yn=c(0),Ur=Gt(M,nt,M.length-nt),yn=yn.inflateRawSync(Ur),Ur=re(M,yn.length+nt);return M.copy(Ur,0,0,nt),yn.copy(Ur,nt),new tt(pe,Ur,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return yn=M.slice(nt),Ur=pako.inflateRaw(yn),(yn=re(M,Ur.length+nt)).set(M.slice(0,nt),0),yn.set(Ur,nt),new tt(pe,yn,0)}(xe,Pe.position),Pe=new D(xe.byteArrayParser,xe.byteArray,{});Pe.warnings=xe.warnings;try{(J?j:$)(Pe,xe,xe.byteArray.length,_)}catch(vn){throw{exception:vn,dataSet:Pe}}return Pe}return function(H,J){for(var xe in H.elements)H.elements.hasOwnProperty(xe)&&(J.elements[xe]=H.elements[xe]);return H.warnings!==void 0&&(J.warnings=H.warnings.concat(J.warnings)),J}(B=he(M,_),A(B))}var Pu=function(M,_,B){for(var V=0,A=_;A<_+B;A++)V+=M[A].length;return V};function qn(M,J,B,V,A){if(A=A||J.fragments,M===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(J===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(B===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((V=V||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(J.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(J.encapsulatedPixelData!==!0||J.hadUndefinedLength!==!0||J.basicOffsetTable===void 0||J.fragments===void 0||J.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(B<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(B>=J.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(V<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(B+V>J.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var H=new tt(M.byteArrayParser,M.byteArray,J.dataOffset),J=W(H);if(J.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";H.seek(J.length);var xe=H.position;if(V===1)return Gt(H.byteArray,xe+A[B].offset+8,A[B].length);for(var J=Pu(A,B,V),Pe=re(H.byteArray,J),vn=0,nt=B;nt<B+V;nt++)for(var Au=xe+A[nt].offset+8,yn=0;yn<A[nt].length;yn++)Pe[vn++]=H.byteArray[Au++];return Pe}var bu=function(M,_){for(var B=0;B<M.length;B++)if(M[B].offset===_)return B},Gu=function(M,_,B,V){if(M===_.length-1)return B.length-V;for(var A=_[M+1],H=V+1;H<B.length;H++)if(B[H].offset===A)return H-V;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function xa(M,_,B,V,A){if(V=V||_.basicOffsetTable,A=A||_.fragments,M===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(_===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(B===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(V===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(_.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(_.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(_.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(_.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(V.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(B<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(B>=V.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var H=V[B],H=bu(A,H);if(H===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return qn(M,_,H,Gu(B,V,A,H),A)}var Bu=!1;function Vs(M,_,B){if(Bu||(Bu=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),M===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(_===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(B===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(_.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(_.encapsulatedPixelData!==!0||_.hadUndefinedLength!==!0||_.basicOffsetTable===void 0||_.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(B<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return _.basicOffsetTable.length!==0?xa(M,_,B):qn(M,_,0,_.fragments.length)}o.default={isStringVr:f,isPrivateTag:u,parsePN:g,parseTM:p,parseDA:d,explicitElementToString:m,explicitDataSetToJS:v,createJPEGBasicOffsetTable:T,parseDicomDataSetExplicit:j,parseDicomDataSetImplicit:$,readFixedString:E,alloc:re,version:xt,bigEndianByteArrayParser:Me,ByteStream:tt,sharedCopy:Gt,DataSet:D,findAndSetUNElementLength:w,findEndOfEncapsulatedElement:S,findItemDelimitationItemAndSetElementLength:I,littleEndianByteArrayParser:pe,parseDicom:R0,readDicomElementExplicit:z,readDicomElementImplicit:F,readEncapsulatedImageFrame:xa,readEncapsulatedPixelData:Vs,readEncapsulatedPixelDataFromFragments:qn,readPart10Header:he,readSequenceItemsExplicit:N,readSequenceItemsImplicit:K,readSequenceItem:W,readTag:x,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],i={},r.m=a,r.c=i,r.d=function(s,o,c){r.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:c})},r.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r.t=function(s,o){if(1&o&&(s=r(s)),8&o||4&o&&typeof s=="object"&&s&&s.__esModule)return s;var c=Object.create(null);if(r.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:s}),2&o&&typeof s!="string")for(var l in s)r.d(c,l,(function(f){return s[f]}).bind(null,l));return c},r.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return r.d(o,"a",o),o},r.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},r.p="",r(r.s=1);function r(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return a[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var a,i})})(Qv);var Ye=Qv.exports;function S0(t){const e=t.indexOf(":");let n=t.substring(e+1);const r=n.indexOf("frame=");let a;if(r!==-1){const o=n.substring(r+6);a=parseInt(o,10),n=n.substring(0,r-1)}const i=t.substring(0,e),s=a!==void 0?a-1:void 0;return{scheme:i,url:n,frame:a,pixelDataFrame:s}}let w2={open(t,e){t.open("get",e,!0)},beforeSend(){},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function Jv(t){w2=Object.assign(w2,t)}function w0(){return w2}function Nu(t,e,n={},r={}){const a=w0(),i=c=>{if(typeof a.errorInterceptor=="function"){const l=new Error("request failed");l.request=c,l.response=c.response,l.status=c.status,a.errorInterceptor(l)}},s=new XMLHttpRequest,o=new Promise((c,l)=>{a.open(s,t,n,r);const f=a.beforeSend(s,e,n,r);s.responseType="arraybuffer";const u=Object.assign({},n,f);Object.keys(u).forEach(function(g){u[g]!==null&&(g==="Accept"&&t.indexOf("accept=")!==-1||s.setRequestHeader(g,u[g]))}),r.deferred={resolve:c,reject:l},r.url=t,r.imageId=e,s.onloadstart=function(g){a.onloadstart&&a.onloadstart(g,r),Q(de,"cornerstoneimageloadstart",{url:t,imageId:e})},s.onloadend=function(g){a.onloadend&&a.onloadend(g,r),Q(de,"cornerstoneimageloadend",{url:t,imageId:e})},s.onreadystatechange=function(g){if(a.onreadystatechange){a.onreadystatechange(g,r);return}s.readyState===4&&(s.status===200||s.status===206?a.beforeProcessing(s).then(c).catch(()=>{i(s),l(s)}):(i(s),l(s)))},s.onprogress=function(g){g.loaded,g.lengthComputable&&g.total,a.onprogress&&a.onprogress(g,r)},s.onerror=function(){i(s),l(s)},s.onabort=function(){i(s),l(s)},s.send()});return o.xhr=s,o}function sG(t,e,n){if(n+t.length>e.length)return!1;let r=n;for(let a=0;a<t.length;a++)if(t[a]!==e[r++])return!1;return!0}function oG(t){const e=new Uint8Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e}function E2(t,e,n){n=n||0;const r=oG(e);for(let a=n;a<t.length;a++)if(r[0]===t[a]&&sG(r,t,a))return a;return-1}const{ImageQualityStatus:Ah}=di;function A5(t,e,n){n||(n={});const r=new Uint8Array(e),a=!!(n!=null&&n.isPartial);if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:a?Ah.SUBRESOLUTION:Ah.FULL_RESOLUTION,pixelData:r};let{tokenIndex:i,responseHeaders:s,boundary:o,multipartContentType:c}=n;if(i||(i=E2(r,`\r
\r
`)),i===-1)throw new Error("invalid response - no multipart mime header");if(!o&&(s=uG(r,0,i).split(`\r
`),o=cG(s),!o))throw new Error("invalid response - no boundary marker");const l=i+4,f=E2(r,o,l);if(f===-1&&!a)throw new Error("invalid response - terminating boundary not found");return c||(c=lG(s)),n.tokenIndex=i,n.boundary=o,n.responseHeaders=s,n.multipartContentType=c,n.isPartial=f===-1,{contentType:c,extractDone:!a||f!==-1,tokenIndex:i,responseHeaders:s,boundary:o,multipartContentType:c,pixelData:e.slice(l,f-2)}}function cG(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function lG(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function uG(t,e,n){e=e||0,n=n||t.length-e;let r="";for(let a=e;a<e+n;a++)r+=String.fromCharCode(t[a]);return r}const{ImageQualityStatus:Wh}=di;function W5(t,e=!0){return e?t.imageQualityStatus??Wh.FULL_RESOLUTION:Wh.SUBRESOLUTION}const{ProgressiveIterator:fG}=$v;function ey(t,e,n={},r={}){const a=w0(),{retrieveOptions:i={},streamingData:s={}}=r,o=i.minChunkSize||128*1024,c=f=>{if(typeof a.errorInterceptor=="function"){const u=new Error("request failed");a.errorInterceptor(u)}},l=new fG("streamRequest");return l.generate(async(f,u)=>{var h,d;const g=(h=a.beforeSend)==null?void 0:h.call(a,null,t,n,{}),p=Object.assign({},n,g);Object.keys(p).forEach(function(m){p[m]===null&&(p[m]=void 0),m==="Accept"&&t.indexOf("accept=")!==-1&&(p[m]=void 0)});try{const m=await fetch(t,{headers:p,signal:void 0});if(m.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${m.status}`);const v=m.body.getReader(),C=m.headers,y=C.get("content-type"),T=Number(C.get("Content-Length"));let x=!1,S=s.encodedData,w=s.lastSize||0;for(s.isPartial=!0;!x;){const{done:E,value:L}=await v.read();if(S=gG(S,L),!S){if(x)throw new Error(`Done but no image frame available ${e}`);continue}if(x=E||S.byteLength===T,!x&&S.length<w+o)continue;w=S.length,s.isPartial=!E;const R=A5(y,S,s),D=W5(i,x),I={url:t,imageId:e,...R,percentComplete:E?100:((d=R.pixelData)==null?void 0:d.length)*100/T,imageQualityStatus:D,done:x};f.add(I,x)}}catch(m){c(),console.error(m),u(m)}}),l.getNextPromise()}function gG(t,e){if(!t)return e;if(!e)return t;const n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}const pG={xhrRequest:Nu,streamRequest:ey,setOptions:Jv,getOptions:w0};function dG(t){const e=t.elements.x7fe00010.fragments,n=t.byteArray.length;for(const r of e){const{position:a,length:i}=r;i>n-a&&(console.log(`Truncated fragment, changing fragment length from ${r.length} to ${n-a}`),r.length=n-a)}return t}function hG(t){let e=Ye.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let n;try{n=Ye.parseDicom(t)}catch(r){console.error(r),console.log("pixel data dataset:",r.dataSet),n=r.dataSet}return e.elements.x7fe00010=n.elements.x7fe00010,e=dG(e),e}async function ty(t,e,n){const r=hG(t),{uri:a,imageId:i,fileTotalLength:s}=n;return r.fetchMore=async function(o){const c=Object.assign({uri:a,imageId:i,fetchedLength:t.length,lengthToFetch:s-t.length},o),{fetchedLength:l,lengthToFetch:f}=c,{arrayBuffer:u}=await e(a,i,{byteRange:`${l}-${l+f}`}),g=new Uint8Array(u),p=new Uint8Array(r.byteArray.length+g.length);return p.set(r.byteArray),p.set(g,r.byteArray.length),ty(p,e,n)},r}function mG(t,e){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:a}=ry(t);if(r||n>1){const{shared:i,perFrame:s}=ny(r,a,e);return{NumberOfFrames:n,PerFrameFunctionalInformation:s,SharedFunctionalInformation:i}}return{NumberOfFrames:n}}function ny(t,e,n){const r={};(e?Object.values(e.items[0].dataSet.elements):[]).map(i=>r[i.tag]=i);const a={};return(t?Object.values(t.items[n-1].dataSet.elements):[]).map(i=>a[i.tag]=i),{shared:r,perFrame:a}}function ry(t){if(!t)return;const{elements:e,...n}=t,{x52009230:r,x52009229:a,...i}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:a,otherElements:i,otherAttributtes:n}}function vG(t,e){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:a,otherElements:i}=ry(e);if(r||n>1){const{shared:s,perFrame:o}=ny(r,a,t),c={elements:{...i,...s,...o}},l=Object.create(e);return Object.assign(l,c)}return e}let dt={};const yG=()=>{dt={}};function z5(t){if(dt[t])return dt[t]}function CG(t){const e=z5(t);return ay(e)}function ay(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function TG(t){return t.indexOf("&frame=")}function xG(t){const e=TG(t),n=e===-1?t:t.slice(0,e),r=parseInt(t.slice(e+7),10)||1;let a;return dt[n]?a=dt[n].dataSet:a=void 0,{dataSet:a,frame:r}}function SG(t){const e=[],n=z5(t);if(ay(n)){const r=n.intString("x00280008");for(let a=1;a<=r;a++)e.push(`${t}&frame=${a}`)}else e.push(t);return e}const iy={_get:z5,generateMultiframeWADOURIs:SG,retrieveMultiframeDataset:xG,isMultiframeDataset:CG};let vs=0,Fa={};function wG(t){return dt[t]!==void 0}function EG(t){let e;if(t.includes("&frame=")){const{frame:n,dataSet:r}=iy.retrieveMultiframeDataset(t);e=vG(n,r)}else dt[t]&&(e=dt[t].dataSet);return e}function RG(t,e){const n=dt[t];if(!n){console.error(`No loaded dataSet for uri ${t}`);return}vs-=n.dataSet.byteArray.length,n.dataSet=e,vs+=e.byteArray.length,Q(de,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:Iu()})}function OG(t,e=Nu,n){if(dt[t])return new Promise(i=>{dt[t].cacheCount++,i(dt[t].dataSet)});if(Fa[t])return Fa[t].cacheCount++,Fa[t];const r=e(t,n),a=new Promise((i,s)=>{r.then(async function(o){const c={isPartialContent:!1,fileTotalLength:null};if(!(o instanceof ArrayBuffer)){if(!o.arrayBuffer)return s(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=o.flags.isPartialContent,c.fileTotalLength=o.flags.fileTotalLength,o=o.arrayBuffer}const l=new Uint8Array(o);let f;try{c.isPartialContent?f=await ty(l,e,{uri:t,imageId:n,fileTotalLength:c.fileTotalLength}):f=Ye.parseDicom(l)}catch(u){return s(u)}dt[t]={dataSet:f,cacheCount:a.cacheCount},vs+=f.byteArray.length,i(f),Q(de,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:Iu()})},s).then(()=>{delete Fa[t]},()=>{delete Fa[t]})});return a.cacheCount=1,Fa[t]=a,a}function MG(t){dt[t]&&(dt[t].cacheCount--,dt[t].cacheCount===0&&(vs-=dt[t].dataSet.byteArray.length,delete dt[t],Q(de,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:Iu()})))}function Iu(){return{cacheSizeInBytes:vs,numberOfDataSetsCached:Object.keys(dt).length}}function DG(){yG(),Fa={},vs=0}const ts={isLoaded:wG,load:OG,unload:MG,getInfo:Iu,purge:DG,get:EG,update:RG};function VG(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const a=t.elements[`${r}3000`];if(!a)continue;const i=[];for(let s=0;s<a.length;s++)for(let o=0;o<8;o++){const c=t.byteArray[a.dataOffset+s];i[s*8+o]=c>>o&1}e.push({rows:t.uint16(`${r}0010`),columns:t.uint16(`${r}0011`),type:t.string(`${r}0040`),x:t.int16(`${r}0050`,1)-1,y:t.int16(`${r}0050`,0)-1,pixelData:i,description:t.string(`${r}0022`),label:t.string(`${r}1500`),roiArea:t.string(`${r}1301`),roiMean:t.string(`${r}1302`),roiStandardDeviation:t.string(`${r}1303`)})}return{overlays:e}}function Ds(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function $5(t,e){const n=t.string("x00080008");if(n){const r=n.split("\\");if(r.length>e)return r[e]}}function LG(t){let e;const n=t.string("x00080060");if(n!=null&&n.includes("NM")){const r=$5(t,2);r&&Ds(r)&&t.elements.x00540022&&(e=Hn(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function _G(t){let e;const n=t.string("x00080060");if(n!=null&&n.includes("NM")){const r=$5(t,2);r&&Ds(r)&&t.elements.x00540022&&(e=Hn(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function zh(t){let e=Hn(t,"x00200037",6);return!e&&t.elements.x00209116&&(e=Hn(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=LG(t)),e}function $h(t){let e=Hn(t,"x00200032",3);return!e&&t.elements.x00209113&&(e=Hn(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=_G(t)),e}function jh(t){let e=Hn(t,"x00280030",2);return!e&&t.elements.x00289110&&(e=Hn(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function Hh(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}function sy(t,e,n){const r={};for(const a of n)try{const i=e(a,t);if(i){const s={};for(const o in i)if(o in i){const c=NG(o);s[c]=i[o]}Object.assign(r,s)}}catch(i){console.error(`Error retrieving ${a} data:`,i)}return r}const NG=t=>t.charAt(0).toUpperCase()+t.slice(1),oy=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function Kh(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(r=>{const a=r.dataSet.double("x0018602c"),i=r.dataSet.double("x0018602e"),s=r.dataSet.uint16("x00186024"),o=r.dataSet.uint16("x00186026"),c=r.dataSet.uint16("x0018601a"),l=r.dataSet.uint16("x0018601e"),f=r.dataSet.uint16("x00186018"),u=r.dataSet.uint16("x0018601c"),g=r.dataSet.int32("x00186020")||null,p=r.dataSet.int32("x00186022")||null,h=r.dataSet.uint16("x0018602a"),d=r.dataSet.uint16("x00186028"),m=r.dataSet.uint16("x00186012"),v=r.dataSet.uint16("x00186014"),C=r.dataSet.uint16("x00186016"),y=r.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:p,physicalDeltaX:a,physicalDeltaY:i,physicalUnitsXDirection:s,physicalUnitsYDirection:o,referencePhysicalPixelValueY:h,referencePhysicalPixelValueX:d,regionSpatialFormat:m,regionDataType:v,regionFlags:C,transducerFrequency:y}})}function j5(t,e){const{MetadataModules:n}=di;if(Array.isArray(e))return;const r=S0(e);if(t===n.MULTIFRAME){const s=iy.retrieveMultiframeDataset(r.url);return s.dataSet?mG(s.dataSet,s.frame):void 0}let a=r.url;r.frame&&(a=`${a}&frame=${r.frame}`);const i=ts.get(a);if(i)return cy(t,e,i)}function cy(t,e,n){const{MetadataModules:r}=di;if(t===r.GENERAL_STUDY)return{studyDescription:n.string("x00081030"),studyDate:Ye.parseDA(n.string("x00080020")),studyTime:Ye.parseTM(n.string("x00080030")||""),accessionNumber:n.string("x00080050")};if(t===r.GENERAL_SERIES)return{modality:n.string("x00080060"),seriesInstanceUID:n.string("x0020000e"),seriesNumber:n.intString("x00200011"),studyInstanceUID:n.string("x0020000d"),seriesDate:Ye.parseDA(n.string("x00080021")),seriesTime:Ye.parseTM(n.string("x00080031")||""),acquisitionDate:Ye.parseDA(n.string("x00080022")),acquisitionTime:Ye.parseTM(n.string("x00080032")||"")};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:n.string("x00080018"),instanceNumber:n.intString("x00200013"),lossyImageCompression:n.string("x00282110"),lossyImageCompressionRatio:n.floatString("x00282112"),lossyImageCompressionMethod:n.string("x00282114")};if(t===r.PATIENT)return{patientID:n.string("x00100020"),patientName:n.string("x00100010")};if(t===r.PATIENT_STUDY)return{patientAge:n.intString("x00101010"),patientSize:n.floatString("x00101020"),patientSex:n.string("x00100040"),patientWeight:n.floatString("x00101030")};if(t===r.NM_MULTIFRAME_GEOMETRY){const a=n.string("x00080060"),i=$5(n,2);return{modality:a,imageType:n.string("x00080008"),imageSubType:i,imageOrientationPatient:zh(n),imagePositionPatient:$h(n),sliceThickness:Hh(n),pixelSpacing:jh(n),numberOfFrames:n.uint16("x00280008"),isNMReconstructable:Ds(i)&&a.includes("NM")}}if(t===r.IMAGE_PLANE){const a=zh(n),i=$h(n),s=jh(n),o=Hh(n);let c=null,l=null;s&&(l=s[0],c=s[1]);let f=null,u=null;return a&&(f=[parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])],u=[parseFloat(a[3]),parseFloat(a[4]),parseFloat(a[5])]),{frameOfReferenceUID:n.string("x00200052"),rows:n.uint16("x00280010"),columns:n.uint16("x00280011"),imageOrientationPatient:a,rowCosines:f,columnCosines:u,imagePositionPatient:i,sliceThickness:o,sliceLocation:n.floatString("x00201041"),pixelSpacing:s,rowPixelSpacing:l,columnPixelSpacing:c}}if(t===r.CINE)return{frameTime:n.floatString("x00181063")};if(t===r.IMAGE_PIXEL)return Yv(n);if(t===r.VOI_LUT){const a=Zv(n);return{windowCenter:Hn(n,"x00281050",1),windowWidth:Hn(n,"x00281051",1),voiLUTSequence:S2(a,n.elements.x00283010)}}if(t===r.MODALITY_LUT)return{rescaleIntercept:n.floatString("x00281052"),rescaleSlope:n.floatString("x00281053"),rescaleType:n.string("x00281054"),modalityLUTSequence:S2(n.uint16("x00280103"),n.elements.x00283000)};if(t===r.SOP_COMMON)return{sopClassUID:n.string("x00080016"),sopInstanceUID:n.string("x00080018")};if(t===r.PET_ISOTOPE){const a=n.elements.x00540016;if(a===void 0)return;const i=a.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Ye.parseTM(i.string("x00181072")||""),radionuclideTotalDose:i.floatString("x00181074"),radionuclideHalfLife:i.floatString("x00181075")}}}if(t===r.OVERLAY_PLANE)return VG(n);if(t==="transferSyntax"){let a;try{a=n.string("x00020010")}catch{}return{transferSyntaxUID:a}}if(t===r.PET_SERIES)return{correctedImage:n.string("x00280051"),units:n.string("x00541001"),decayCorrection:n.string("x00541102")};if(t===r.PET_IMAGE)return{frameReferenceTime:n.floatString(n.string("x00541300")||""),actualFrameDuration:n.intString(n.string("x00181242"))};if(t===r.ULTRASOUND_ENHANCED_REGION)return Kh(n);if(t===r.CALIBRATION&&n.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:Kh(n)};if(t==="instance")return sy(e,j5,oy)}let Fu=[];function IG(t){return`dicomfile:${Fu.push(t)-1}`}function FG(t){return Fu[t]}function kG(t){Fu[t]=void 0}function UG(){Fu=[]}const ly={add:IG,get:FG,remove:kG,purge:UG};function PG(t){const e=t.intString("x00280008"),n=t.elements.x7fe00010;return e!==n.fragments.length}function uy(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return Ye.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(PG(t)){const l=Ye.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return Ye.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,l)}const n=t.elements.x7fe00010.fragments,r=new Ye.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),a=Ye.readSequenceItem(r);if(a.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";r.seek(a.length);const i=r.position;if(e+1>n.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const o=i+n[e].offset+8,c=n[e].length;return new Uint8Array(r.byteArray.buffer.slice(r.byteArray.byteOffset+o,r.byteArray.byteOffset+o+c))}function bG(t,e){return t&1<<e}function fy(t,e,n){const r=new Uint8Array(n);for(let a=0;a<n;a++){const i=Math.floor(a/8),s=t[i+e],o=a%8;r[a]=bG(s,o)?1:0}return r}function gy(t,e){const n=t.elements.x7fe00010||t.elements.x7fe00008,r=t.uint16("x00280100"),a=t.uint16("x00280010"),i=t.uint16("x00280011");let s=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(s=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=n.dataOffset,l=a*i*s;let f;if(r===8){if(f=c+e*l,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l))}else if(r===16){if(f=c+e*l*2,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*2))}else if(r===1){if(f=c+e*l*.125,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return fy(t.byteArray,f,l)}else if(r===32){if(f=c+e*l*4,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*4))}throw new Error("unsupported pixel format")}function py(t){const e=S0(t),n=parseInt(e.url,10),r=ly.get(n);return new Promise((a,i)=>{const s=new FileReader;s.onload=o=>{const c=o.target.result;a(c)},s.onerror=i,s.readAsArrayBuffer(r)})}function H5(t,e=0){const n=t.elements.x7fe00010||t.elements.x7fe00008;return n?n.encapsulatedPixelData?uy(t,e):gy(t,e):null}function K5(t){let e=t[0],n=t[0],r;const a=t.length;for(let i=1;i<a;i++)r=t[i],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}function GG(t,e){let n;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?n=Uint8Array:e<=65535&&(n=Uint16Array):t>=-128&&e<=127?n=Int8Array:t>=-32768&&e<=32767&&(n=Int16Array)),n||Float32Array}function zf(t,e,n){t.planarConfiguration===0?jv(t.pixelData,e,n):Hv(t.pixelData,e,n)}function BG(t,e,n){t.planarConfiguration===0?Kv(t.pixelData,e,n):qv(t.pixelData,e,n)}function dy(t,e,n){if(t.photometricInterpretation==="RGB")zf(t,e,n);else if(t.photometricInterpretation==="YBR_RCT")zf(t,e,n);else if(t.photometricInterpretation==="YBR_ICT")zf(t,e,n);else if(t.photometricInterpretation==="PALETTE COLOR")Xv(t,e,n);else if(t.photometricInterpretation==="YBR_FULL_422")tG(t.pixelData,e,n);else if(t.photometricInterpretation==="YBR_FULL")BG(t,e,n);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function AG(t){if(t===void 0)return!1;const{rows:e,columns:n,photometricInterpretation:r,pixelDataLength:a,planarConfiguration:i}=t;return a===4*n*e||r==="PALETTE COLOR"?!1:r.endsWith("420")?a===(3*Math.ceil(n/2)+Math.floor(n/2))*e:r.endsWith("422")?a===(3*Math.ceil(n/2)+Math.floor(n/2))*Math.ceil(e/2)+Math.floor(e/2)*n:r!=="RGB"||i===1}function WG(t){return zG(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function zG(t){let e;try{return decodeURIComponent(escape(t))}catch(n){if(e=n,e instanceof URIError)return t;throw e}}function hy(t,e,n){const r=new Date().getTime(),a=new Blob([e],{type:"image/jpeg"});return new Promise((i,s)=>{const o=new FileReader;o.readAsBinaryString===void 0?o.readAsArrayBuffer(a):o.readAsBinaryString(a),o.onload=function(){const c=new Image;c.onload=function(){n.height=c.height,n.width=c.width,t.rows=c.height,t.columns=c.width;const l=n.getContext("2d");l.drawImage(this,0,0);const f=l.getImageData(0,0,c.width,c.height),u=new Date().getTime();t.pixelData=new Uint8Array(f.data.buffer),t.imageData=f,t.decodeTimeInMS=u-r;const g=K5(t.pixelData);t.smallestPixelValue=g.min,t.largestPixelValue=g.max,t.pixelDataLength=t.pixelData.length,i(t)},c.onerror=function(l){s(l)},o.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(WG(o.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(o.result)}`},o.onerror=c=>{s(c)}})}function Zt(t,e,n,r,a){const i={...r};delete i.loader,delete i.streamingData;const s=L7(),o=i.priority||void 0;return i.transferPixelData&&n.buffer,s.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:n,options:i,decodeConfig:a},{priority:o,requestType:i==null?void 0:i.requestType})}function $G(t,e,n,r,a={},i){switch(e){case"1.2.840.10008.1.2":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.1":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.2":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.1.99":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.5":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?hy(t,n,r):Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.51":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.57":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.70":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.80":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.81":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.90":return Zt(t,e,n,a,i);case"1.2.840.10008.1.2.4.91":return Zt(t,e,n,a,i);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return Zt(t,e,n,a,i)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function my(t){const e=Z("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function jG(t,e){const n=t.get("modalityLutModule",e)||{},r=t.get("generalSeriesModule",e)||{},{modality:a}=r,i={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:a},s=t.get("scalingModule",e)||{};return{...i,...a==="PT"&&{suvbw:s.suvbw}}}function vy(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}let qh="";function HG(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function KG(t){const e=t.smallestPixelValue,n=t.largestPixelValue,r=GG(e,n);if(r){const a=new r(t.pixelData);t.pixelData=a}else throw new Error("Could not apply a typed array to the pixel data")}function qG(t,e){const n=t.length/4;let r=0,a=0;for(let i=0;i<n;i++)e[a++]=t[r++],e[a++]=t[r++],e[a++]=t[r++],r++;return e}function ku(t,e,n,r={}){const a=r.useRGBA;if(r.preScale={enabled:r.preScale&&r.preScale.enabled!==void 0?r.preScale.enabled:!0},!(e!=null&&e.length))return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:i}=di,s=document.createElement("canvas"),o=my(t);if(o.decodeLevel=r.decodeLevel,r.allowFloatRendering=w5(),r.preScale.enabled){const u=jG(px,t);u&&(r.preScale={...r.preScale,scalingParameters:u})}const{decodeConfig:c}=w0();Object.keys(o).forEach(u=>{(typeof o[u]=="function"||o[u]instanceof Promise)&&delete o[u]});const l=$G(o,n,e,s,r,c),f=vy(o.photometricInterpretation);return new Promise((u,g)=>{l.then(function(p){let h=!1;if(r.targetBuffer&&r.targetBuffer.type&&!f){const{arrayBuffer:E,type:L,offset:R=0,length:D}=r.targetBuffer,I=p.pixelDataLength,b=R,F=D??I-b,W={Uint8Array,Uint16Array,Int16Array,Float32Array};if(F!==p.pixelDataLength)throw new Error(`target array for image does not have the same length (${F}) as the decoded image length (${p.pixelDataLength}).`);const P=W[L],K=E?new P(E,b,F):new P(p.pixelData);if(F!==p.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");p.pixelData=K,h=!0}h||KG(p);const d=Z(i.IMAGE_PLANE,t)||{},m=Z(i.VOI_LUT,t)||{},v=Z(i.MODALITY_LUT,t)||{},C=Z(i.SOP_COMMON,t)||{},y=Z(i.CALIBRATION,t)||{},{rows:T,columns:x}=p;if(f){if(AG(p)){s.height=p.rows,s.width=p.columns;let R=s.getContext("2d").createImageData(p.columns,p.rows);a||(R={...R,data:new Uint8ClampedArray(3*p.columns*p.rows)}),dy(p,R.data,a),p.imageData=R,p.pixelData=R.data,p.pixelDataLength=R.data.length}else if(!a&&p.pixelDataLength===4*T*x){const L=new Uint8Array(p.pixelData.length/4*3);p.pixelData=qG(p.pixelData,L),p.pixelDataLength=p.pixelData.length}const E=K5(p.pixelData);p.smallestPixelValue=E.min,p.largestPixelValue=E.max}const S=Ke.createImageVoxelManager({scalarData:p.pixelData,width:p.columns,height:p.rows,numberOfComponents:p.samplesPerPixel}),w={imageId:t,dataType:p.pixelData.constructor.name,color:f,calibration:y,columnPixelSpacing:d.columnPixelSpacing,columns:p.columns,height:p.rows,preScale:p.preScale,intercept:v.rescaleIntercept?v.rescaleIntercept:0,slope:v.rescaleSlope?v.rescaleSlope:1,invert:p.photometricInterpretation==="MONOCHROME1",minPixelValue:p.smallestPixelValue,maxPixelValue:p.largestPixelValue,rowPixelSpacing:d.rowPixelSpacing,rows:p.rows,sizeInBytes:p.pixelData.byteLength,width:p.columns,windowCenter:m.windowCenter?m.windowCenter[0]:void 0,windowWidth:m.windowWidth?m.windowWidth[0]:void 0,voiLUTFunction:m.voiLUTFunction?m.voiLUTFunction:void 0,decodeTimeInMS:p.decodeTimeInMS,floatPixelData:void 0,imageFrame:p,voxelManager:S,rgba:f&&a,getPixelData:()=>p.pixelData,getCanvas:void 0,numberOfComponents:p.samplesPerPixel};if(w.color&&(w.getCanvas=function(){if(qh===t)return s;const E=w.columns,L=w.rows;s.height=L,s.width=E;const R=s.getContext("2d"),D=R.createImageData(E,L),I=p.pixelData;if(I.length===E*L*4)for(let b=0;b<I.length;b++)D.data[b]=I[b];else if(I.length===E*L*3){let b=0;for(let F=0;F<I.length;F+=3)D.data[b++]=I[F],D.data[b++]=I[F+1],D.data[b++]=I[F+2],D.data[b++]=255}return p.pixelData=D.data,p.pixelDataLength=D.data.length,p.imageData=D,R.putImageData(p.imageData,0,0),qh=t,s}),v.modalityLUTSequence&&v.modalityLUTSequence.length>0&&HG(C.sopClassUID)&&(w.modalityLUT=v.modalityLUTSequence[0]),m.voiLUTSequence&&m.voiLUTSequence.length>0&&(w.voiLUT=m.voiLUTSequence[0]),w.color&&(w.windowWidth=256,w.windowCenter=128),w.windowCenter===void 0||w.windowWidth===void 0){const E=w.imageFrame.smallestPixelValue,L=w.imageFrame.largestPixelValue;w.windowWidth=L-E,w.windowCenter=(L+E)/2}u(w)},g)})}function XG(t,e){t.decache=function(){const n=S0(e);ts.unload(n.url)}}function yy(t,e,n=0,r,a,i){const s=new Date().getTime(),o={cancelFn:void 0,promise:void 0};return o.promise=new Promise((c,l)=>{t.then(f=>{const u=H5(f,n),g=f.string("x00020010"),p=new Date().getTime(),h=ku(e,u,g,a);XG(o,e),h.then(d=>{d=d,d.data=f,d.sharedCacheKey=r;const m=new Date().getTime();d.loadTimeInMS=p-s,d.totalTimeInMS=m-s,i!==void 0&&i.imageDoneCallback!==void 0&&i.imageDoneCallback(d),c(d)},function(d){l({error:d,dataSet:f})})},function(f){l({error:f})})}),o}function YG(t,e,n=0,r,a){const i=new Date().getTime();return{promise:new Promise((o,c)=>{const l=new Date().getTime();let f;try{const u=H5(t,n),g=t.string("x00020010");f=ku(e,u,g,a)}catch(u){c({error:u,dataSet:t});return}f.then(u=>{u=u,u.data=t,u.sharedCacheKey=r;const g=new Date().getTime();u.loadTimeInMS=l-i,u.totalTimeInMS=g-i,o(u)},c)}),cancelFn:void 0}}function Cy(t){if(t==="dicomweb"||t==="wadouri")return Nu;if(t==="dicomfile")return py}function jc(t,e={}){const n=S0(t);e=Object.assign({},e),delete e.loader;const r=Cy(n.scheme);if(ts.isLoaded(n.url)){const i=ts.get(n.url,r,t);return YG(i,t,n.pixelDataFrame,n.url,e)}const a=ts.load(n.url,r,t);return yy(a,t,n.frame,n.url,e)}function Ty(){Dc("dicomweb",jc),Dc("wadouri",jc),Dc("dicomfile",jc),xs(j5)}const ZG={getImagePixelModule:Yv,getLUTs:S2,getModalityLUTOutputPixelRepresentation:Zv,getNumberValues:Hn,metaDataProvider:j5,metadataForDataset:cy},QG={metaData:ZG,dataSetCacheManager:ts,fileManager:ly,getEncapsulatedImageFrame:uy,getUncompressedImageFrame:gy,loadFileRequest:py,loadImageFromPromise:yy,getLoaderForScheme:Cy,getPixelData:H5,loadImage:jc,parseImageId:S0,unpackBinaryFrame:fy,register:Ty};function ae(t,e,n){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?n:t.Value[e]}function JG(t,e,n){const r=ae(t,e,n);if(r!==void 0)return parseFloat(String(r))}function we(t,e){const n=ae(t,e);if(n!==void 0)return parseFloat(n)}function _t(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const n=[];for(let r=0;r<t.Value.length;r++)n.push(parseFloat(t.Value[r]));return n}function eB(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const a=ae(t[`${r}3000`]);if(!a)continue;const i=[];for(let s=0;s<a.length;s++)for(let o=0;o<8;o++){const c=t.Value[a.dataOffset+s];i[s*8+o]=c>>o&1}e.push({rows:we(t[`${r}0010`]),columns:we(t[`${r}0011`]),type:ae(t[`${r}0040`]),x:we(t[`${r}0050`],1)-1,y:we(t[`${r}0050`],0)-1,pixelData:i,description:ae(t[`${r}0022`]),label:ae(t[`${r}1500`]),roiArea:ae(t[`${r}1301`]),roiMean:ae(t[`${r}1302`]),roiStandardDeviation:ae(t[`${r}1303`])})}return{overlays:e}}function Uu(t){const e=t.indexOf(":");return t.substring(e+1)}function ns(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function xy(t,e,n){const r=(e?Object.values(e[0]):[]).map(i=>i[0]).filter(i=>i!==void 0&&typeof i=="object"),a=(t?Object.values(t[n-1]):[]).map(i=>i.Value[0]).filter(i=>i!==void 0&&typeof i=="object");return{shared:r,perFrame:a}}function Sy(t){let{52009230:e,52009229:n,"00280008":r,...a}=t;return e=ns(e,!1),n=ns(n,!1),r=ns(r),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:n,NumberOfFrames:r,rest:a}}function tB(t,e){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:r,NumberOfFrames:a,rest:i}=Sy(e);if(n||a>1){const{shared:s,perFrame:o}=xy(n,r,t),c=Object.assign(e,{frameNumber:t});return[...s,...o].forEach(l=>{Object.entries(l).forEach(([f,u])=>{c[f]=u})}),Object.assign(i,{"00280008":a},c)}return e}let E0=[],Xl={};function wy(t){const e=t.indexOf("/frames/")+8,n=t.slice(0,e),r=parseInt(t.slice(e),10);return{metadata:E0[`${n}1`],frame:r}}function nB(t){const e=Uu(t);return wy(e)}function rB(t){const e=ae(t["00280008"]);return e&&e>1}function aB(t,e){const n=Uu(t);Object.defineProperty(e,"isMultiframe",{value:rB(e),enumerable:!1}),E0[n]=e}function iB(t){const e=Uu(t),n=E0[e];if(n&&!(n!=null&&n.isMultiframe))return n;const r=Xl[e];if(r)return r;const a=wy(e);if(!a||!a.metadata)return;const{metadata:i,frame:s}=a;if(i){const o=tB(s,i);return Xl[e]=o,o}}function sB(t){const e=Uu(t);E0[e]=void 0,Xl[e]=void 0}function oB(){E0=[],Xl={}}const q5={add:aB,get:iB,remove:sB,purge:oB};function Ey(t){return ae(t["00080060"]).includes("NM")}function X5(t,e){const n=ns(t["00080008"],!1);if(n)return n[e]}function cB(t){let e;const n=X5(t,2);if(n&&Ds(n)){const r=ns(t["00540022"]);r&&(e=_t(r["00200037"],6))}return e}function lB(t){let e;const n=X5(t,2);if(n&&Ds(n)){const r=ns(t["00540022"]);r&&(e=_t(r["00200032"],3))}return e}function Xh(t){let e=_t(t["00200037"],6);return!e&&Ey(t)&&(e=cB(t)),e}function Yh(t){let e=_t(t["00200032"],3);return!e&&Ey(t)&&(e=lB(t)),e}function Lt(t,e){const n=_t(t[e]);return n?n[0]:null}function uB(t){var e;return(e=t==null?void 0:t.Value)!=null&&e.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function Zh(t){const e=uB(t["00186011"]);return!e||!e.length?null:e.map(r=>{const a=Lt(r,"0018602C"),i=Lt(r,"0018602E"),s=Lt(r,"00186024"),o=Lt(r,"00186026"),c=Lt(r,"0018601A"),l=Lt(r,"0018601E"),f=Lt(r,"00186018"),u=Lt(r,"0018601C"),g=Lt(r,"00186020"),p=Lt(r,"00186022"),h=Lt(r,"0018602A"),d=Lt(r,"00186028"),m=Lt(r,"00186012"),v=Lt(r,"00186014"),C=Lt(r,"00186016"),y=Lt(r,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:p,physicalDeltaX:a,physicalDeltaY:i,physicalUnitsXDirection:s,physicalUnitsYDirection:o,referencePhysicalPixelValueY:h,referencePhysicalPixelValueX:d,regionSpatialFormat:m,regionDataType:v,regionFlags:C,transducerFrequency:y}})}function Y5(t,e){const{MetadataModules:n}=di;if(t===n.MULTIFRAME){const{metadata:a,frame:i}=nB(e);if(!a)return;const{PerFrameFunctionalGroupsSequence:s,SharedFunctionalGroupsSequence:o,NumberOfFrames:c}=Sy(a);if(s||c>1){const{shared:l,perFrame:f}=xy(s,o,i);return{NumberOfFrames:c,PerFrameFunctionalInformation:f,SharedFunctionalInformation:l}}return{NumberOfFrames:c}}const r=q5.get(e);if(r){if(t===n.GENERAL_STUDY)return{studyDescription:ae(r["00081030"]),studyDate:Ye.parseDA(ae(r["00080020"])),studyTime:Ye.parseTM(ae(r["00080030"],0,"")),accessionNumber:ae(r["00080050"])};if(t===n.GENERAL_SERIES)return{modality:ae(r["00080060"]),seriesInstanceUID:ae(r["0020000E"]),seriesNumber:we(r["00200011"]),studyInstanceUID:ae(r["0020000D"]),seriesDate:Ye.parseDA(ae(r["00080021"])),seriesTime:Ye.parseTM(ae(r["00080031"],0,"")),acquisitionDate:Ye.parseDA(ae(r["00080022"])),acquisitionTime:Ye.parseTM(ae(r["00080032"],0,""))};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:ae(r["00080018"]),instanceNumber:we(r["00200013"]),lossyImageCompression:ae(r["00282110"]),lossyImageCompressionRatio:we(r["00282112"]),lossyImageCompressionMethod:ae(r["00282114"])};if(t===n.PATIENT)return{patientID:ae(r["00100020"]),patientName:ae(r["00100010"])};if(t===n.PATIENT_STUDY)return{patientAge:we(r["00101010"]),patientSize:we(r["00101020"]),patientSex:ae(r["00100040"]),patientWeight:we(r["00101030"])};if(t===n.NM_MULTIFRAME_GEOMETRY){const a=ae(r["00080060"]),i=X5(r,2);return{modality:a,imageType:ae(r["00080008"]),imageSubType:i,imageOrientationPatient:Xh(r),imagePositionPatient:Yh(r),sliceThickness:we(r["00180050"]),spacingBetweenSlices:we(r["00180088"]),pixelSpacing:_t(r["00280030"],2),numberOfFrames:we(r["00280008"]),isNMReconstructable:Ds(i)&&a.includes("NM")}}if(t===n.IMAGE_PLANE){let a=Xh(r),i=Yh(r);const s=_t(r["00280030"],2);let o=null,c=null,l=null,f=null,u=!1;return s?(c=s[0],o=s[1]):(u=!0,c=1,o=1),a?(l=[parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])],f=[parseFloat(a[3]),parseFloat(a[4]),parseFloat(a[5])]):(l=[0,1,0],f=[0,0,-1],u=!0,a=[...l,...f]),i||(i=[0,0,0],u=!0),{frameOfReferenceUID:ae(r["00200052"]),rows:we(r["00280010"]),columns:we(r["00280011"]),imageOrientationPatient:a,rowCosines:l,columnCosines:f,imagePositionPatient:i,sliceThickness:we(r["00180050"]),sliceLocation:we(r["00201041"]),pixelSpacing:s,rowPixelSpacing:c,columnPixelSpacing:o,usingDefaultValues:u}}if(t===n.ULTRASOUND_ENHANCED_REGION)return Zh(r);if(t===n.CALIBRATION&&ae(r["00080060"])==="US")return{sequenceOfUltrasoundRegions:Zh(r)};if(t===n.IMAGE_URL)return fB(e,r);if(t===n.CINE)return gB(e,r);if(t===n.IMAGE_PIXEL)return{samplesPerPixel:we(r["00280002"]),photometricInterpretation:ae(r["00280004"]),rows:we(r["00280010"]),columns:we(r["00280011"]),bitsAllocated:we(r["00280100"]),bitsStored:we(r["00280101"]),highBit:ae(r["00280102"]),pixelRepresentation:we(r["00280103"]),planarConfiguration:we(r["00280006"]),pixelAspectRatio:ae(r["00280034"]),smallestPixelValue:we(r["00280106"]),largestPixelValue:we(r["00280107"]),redPaletteColorLookupTableDescriptor:_t(r["00281101"]),greenPaletteColorLookupTableDescriptor:_t(r["00281102"]),bluePaletteColorLookupTableDescriptor:_t(r["00281103"]),redPaletteColorLookupTableData:_t(r["00281201"]),greenPaletteColorLookupTableData:_t(r["00281202"]),bluePaletteColorLookupTableData:_t(r["00281203"])};if(t===n.VOI_LUT)return{windowCenter:_t(r["00281050"],1),windowWidth:_t(r["00281051"],1)};if(t===n.MODALITY_LUT)return{rescaleIntercept:we(r["00281052"]),rescaleSlope:we(r["00281053"]),rescaleType:ae(r["00281054"])};if(t===n.SOP_COMMON)return{sopClassUID:ae(r["00080016"]),sopInstanceUID:ae(r["00080018"])};if(t===n.PET_ISOTOPE){const a=ae(r["00540016"]);return a===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:Ye.parseTM(ae(a["00181072"],0,"")),radiopharmaceuticalStartDateTime:ae(a["00181078"],0,""),radionuclideTotalDose:we(a["00181074"]),radionuclideHalfLife:we(a["00181075"])}}}if(t===n.OVERLAY_PLANE)return eB(r);if(t==="transferSyntax")return Ry(e,r);if(t===n.PET_SERIES)return{correctedImage:ae(r["00280051"]),units:ae(r["00541001"]),decayCorrection:ae(r["00541102"])};if(t===n.PET_IMAGE)return{frameReferenceTime:we(r["00541300"]),actualFrameDuration:we(r["00181242"])};if(t==="instance")return sy(e,Y5,oy)}}function fB(t,e){const{transferSyntaxUID:n}=Ry(t,e),r=Gv(n),a=t.substring(7),i=a.replace("/frames/","/thumbnail/");let s=a.replace("/frames/","/rendered/");return r&&(s=s.replace("/rendered/1","/rendered")),{isVideo:r,rendered:s,thumbnail:i}}function gB(t,e){return{cineRate:ae(e["00180040"]),numberOfFrames:we(e["00280008"])}}function Ry(t,e){return{transferSyntaxUID:ae(e["00020010"])||ae(e["00083002"])}}function pB(t,e,n={},r={}){const a=w0(),{retrieveOptions:i={},streamingData:s}=r,o=s.chunkSize||hB(e,i,"chunkSize")||65536,c=f=>{if(typeof a.errorInterceptor=="function"){const u=new Error("request failed");a.errorInterceptor(u)}else console.warn("rangeRequest:Caught",f)};return new Promise(async(f,u)=>{const g=Object.assign({},n);Object.keys(g).forEach(function(p){(g[p]===null||g[p]===void 0)&&delete g[p]});try{s.encodedData||(s.chunkSize=o,s.rangesFetched=0);const p=mB(s,i),{encodedData:h,responseHeaders:d}=await dB(t,g,p,s),m=d.get("content-type"),{totalBytes:v}=s,C=v===h.byteLength,y=A5(m,h,{isPartial:!0}),T=W5(i,C||y.extractDone);f({...y,imageQualityStatus:T,percentComplete:y.extractDone?100:o*100/v})}catch(p){c(p),console.error(p),u(p)}})}async function dB(t,e,n,r){n&&(e=Object.assign(e,{Range:`bytes=${n[0]}-${n[1]}`}));let{encodedData:a}=r;if(n[1]&&(a==null?void 0:a.byteLength)>n[1])return r;const i=await fetch(t,{headers:e,signal:void 0}),s=await i.arrayBuffer(),o=new Uint8Array(s),{status:c}=i;let l;a?(l=new Uint8Array(a.length+o.length),l.set(a,0),l.set(o,a.length),r.rangesFetched=1):(l=new Uint8Array(o.length),l.set(o,0),r.rangesFetched++),r.encodedData=a=l,r.responseHeaders=i.headers;const f=i.headers.get("Content-Range");return f?r.totalBytes=Number(f.split("/")[1]):c!==206||!n?r.totalBytes=a==null?void 0:a.byteLength:n[1]===""||(a==null?void 0:a.length)<n[1]?r.totalBytes=a.byteLength:r.totalBytes=Number.MAX_SAFE_INTEGER,r}function hB(t,e,n){const r=e[n];if(typeof r!="function")return r;const a=q5.get(t);return r(a,t)}function mB(t,e){const{totalBytes:n,encodedData:r,chunkSize:a=65536}=t,{rangeIndex:i=0}=e;return i===-1&&(!n||!r)?[0,""]:i===-1||(r==null?void 0:r.byteLength)>n-a?[(r==null?void 0:r.byteLength)||0,""]:[(r==null?void 0:r.byteLength)||0,a*(i+1)-1]}function Z5(t,e,n="application/octet-stream",r){const{streamingData:a,retrieveOptions:i={}}=r||{},s={Accept:n};let o=i.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${i.urlArguments}`:t;if(i.framesPath&&(o=o.replace("/frames/",i.framesPath)),(a==null?void 0:a.url)!==o&&(r.streamingData={url:o}),i.rangeIndex!==void 0)return pB(o,e,s,r);if(i.streaming)return ey(o,e,s,r);const c=Nu(o,e,s),{xhr:l}=c;return c.then(function(f){const u=l.getResponseHeader("Content-Type")||"application/octet-stream",g=A5(u,new Uint8Array(f));return g.imageQualityStatus=W5(i,!0),g})}const{ProgressiveIterator:Qh}=$v,{ImageQualityStatus:Jh}=di,vB=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function yB(t){const e="1.2.840.10008.1.2";if(!t)return e;const n=t.split(";"),r={};n.forEach(i=>{const s=i.split("=");if(s.length!==2)return;const o=s[1].trim().replace(/"/g,"");r[s[0].trim()]=o});const a={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return r["transfer-syntax"]?r["transfer-syntax"]:t&&!Object.keys(r).length&&a[t]?a[t]:r.type&&a[r.type]?a[r.type]:a[t]?a[t]:e}function CB(){return x0}const TB="multipart/related; type=application/octet-stream; transfer-syntax=*";function Oy(t,e={}){const n=CB(),r=new Date().getTime(),a=new Qh("decompress");async function i(f,u,g){a.generate(async p=>{var m;const h=Qh.as(Z5(f,u,g,e));let d=10;for await(const v of h){const{pixelData:C,imageQualityStatus:y=Jh.FULL_RESOLUTION,percentComplete:T,done:x=!0,extractDone:S=!0}=v,w=yB(v.contentType);if(!S&&!vB.has(w))continue;const E=v.decodeLevel??(y===Jh.FULL_RESOLUTION?0:xB(T,(m=e.retrieveOptions)==null?void 0:m.decodeLevel));if(!(!x&&d<=E))try{const L={...e,decodeLevel:E},R=await ku(u,C,w,L),D=new Date().getTime();R.loadTimeInMS=D-r,R.transferSyntaxUID=w,R.imageQualityStatus=y,p.add(R,x),d=E}catch(L){if(S)throw console.warn("Couldn't decode",L),L}}})}const s=e.requestType||se.Interaction,o=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,l=t.substring(7);return n.addRequest(i.bind(this,l,t,TB),s,o,c),{promise:a.getDonePromise(),cancelFn:void 0}}function xB(t,e=4){const n=t/100-.02;return n>1/4?Math.min(e,0):n>1/16?Math.min(e,1):n>1/64?Math.min(e,2):Math.min(e,3)}function My(){Dc("wadors",Oy),xs(Y5)}const SB={getNumberString:JG,getNumberValue:we,getNumberValues:_t,getValue:ae,metaDataProvider:Y5},wB={metaData:SB,findIndexOfString:E2,getPixelData:Z5,loadImage:Oy,metaDataManager:q5,register:My};function EB(){My(),Ty()}const RB=()=>new Worker(new URL("/corenerstone-test-react-vite/assets/decodeImageFrameWorker-TXqc1un-.js",import.meta.url),{type:"module"});function OB(t={}){Jv(t),EB();const e=L7(),n=(t==null?void 0:t.maxWebWorkers)||MB();e.registerWorker("dicomImageLoader",RB,{maxWorkerInstances:n})}function MB(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function DB(t,e){if(e=e||t.transferSyntax,t.bitsAllocated===8&&e==="1.2.840.10008.1.2.4.50"&&(t.samplesPerPixel===3||t.samplesPerPixel===4))return!0}const VB={IMPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2",EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1",DEFLATED_EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1.99",EXPLICIT_VR_BIG_ENDIAN:"1.2.840.10008.1.2.2",JPEG_BASELINE_PROCESS_1:"1.2.840.10008.1.2.4.50",JPEG_EXTENDED_PROCESS_2_4:"1.2.840.10008.1.2.4.51",JPEG_EXTENDED_PROCESSES_3_5:"1.2.840.10008.1.2.4.52",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_6_8:"1.2.840.10008.1.2.4.53",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_7_9:"1.2.840.10008.1.2.4.54",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_10_12:"1.2.840.10008.1.2.4.55",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_11_13:"1.2.840.10008.1.2.4.56",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_14:"1.2.840.10008.1.2.4.57",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_15:"1.2.840.10008.1.2.4.58",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_16_18:"1.2.840.10008.1.2.4.59",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_17_19:"1.2.840.10008.1.2.4.60",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_20_22:"1.2.840.10008.1.2.4.61",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_21_23:"1.2.840.10008.1.2.4.62",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_24_26:"1.2.840.10008.1.2.4.63",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_25_27:"1.2.840.10008.1.2.4.64",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_28:"1.2.840.10008.1.2.4.65",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_29:"1.2.840.10008.1.2.4.66",JPEG_LOSSLESS_NONHIERARCHICAL_FIRST_ORDER_PREDICTION_PROCESS_14:"1.2.840.10008.1.2.4.70",JPEG_LS_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.80",JPEG_LS_LOSSY_NEAR_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.81",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.90",JPEG_2000_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.91",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.92",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.93",JPIP_REFERENCED:"1.2.840.10008.1.2.4.94",JPIP_REFERENCED_DEFLATE:"1.2.840.10008.1.2.4.95",MPEG2_MAIN_PROFILE_MAIN_LEVEL:"1.2.840.10008.1.2.4.100",MPEG4_AVC_H264_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.101",MPEG4_AVC_H264_BD_COMPATIBLE_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.102",MPEG4_AVC_H264_HIGH_PROFILE_FOR_2D_VIDEO:"1.2.840.10008.1.2.4.103",MPEG4_AVC_H264_HIGH_PROFILE_FOR_3D_VIDEO:"1.2.840.10008.1.2.4.104",JPIP_LOSSLESS:"1.2.840.10008.1.2.4.96",JPIP_PART2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.97",RFC_2557_MIME_ENCAPSULATION:"1.2.840.10008.1.2.6.1",JPEG_XR_IMAGE_COMPRESSION:"1.2.840.10008.1.2.6.2",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.90R",JPEG_2000_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.91R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.92R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.93R"},LB=Object.freeze(Object.defineProperty({__proto__:null,transferSyntaxes:VB},Symbol.toStringTag,{value:"Module"})),_B={constants:LB,convertRGBColorByPixel:jv,convertRGBColorByPlane:Hv,convertYBRFullByPixel:Kv,convertYBRFullByPlane:qv,convertPALETTECOLOR:Xv,wadouri:QG,wadors:wB,init:OB,convertColorSpace:dy,createImage:ku,decodeJPEGBaseline8BitColor:hy,getImageFrame:my,getPixelData:Z5,getMinMax:K5,isColorImage:vy,isJPEGBaseline8BitColor:DB,internal:pG};async function NB(){V7()||(await cI(),await _B.init({}))}const IB="dicomweb:/corenerstone-test-react-vite/1.dcm";function FB(){const[t,e]=ka.useState(!0),[n,r]=ka.useState(""),a=ka.useRef(null);ka.useEffect(()=>{n&&i()},[n]);const i=async()=>{const s="re-0",o="vp-0";if(!(a!=null&&a.current))return;const c=y0(s)||new kv(s),l={viewportId:o,element:a==null?void 0:a.current,type:Ae.STACK};c.getViewport(o)||c.enableElement(l);const f=c.getViewport(o);f.setStack([n],0),f.render(),e(!1)};return ka.useEffect(()=>{NB().then(()=>{ci(IB).then(s=>{r(s.imageId)})})},[]),js.jsx("div",{className:"w-full h-[100vh] flex items-center justify-center",ref:a,children:t?js.jsx("span",{children:"Loading ..."}):js.jsx(js.Fragment,{})})}g8(document.getElementById("root")).render(js.jsx(FB,{}));
