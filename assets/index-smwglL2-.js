(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var tn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function fM(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var k9={exports:{}},Sg={},F9={exports:{}},Re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bl=Symbol.for("react.element"),gM=Symbol.for("react.portal"),dM=Symbol.for("react.fragment"),pM=Symbol.for("react.strict_mode"),hM=Symbol.for("react.profiler"),mM=Symbol.for("react.provider"),vM=Symbol.for("react.context"),yM=Symbol.for("react.forward_ref"),CM=Symbol.for("react.suspense"),TM=Symbol.for("react.memo"),SM=Symbol.for("react.lazy"),i4=Symbol.iterator;function xM(t){return t===null||typeof t!="object"?null:(t=i4&&t[i4]||t["@@iterator"],typeof t=="function"?t:null)}var U9={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A9=Object.assign,B9={};function O0(t,e,n){this.props=t,this.context=e,this.refs=B9,this.updater=n||U9}O0.prototype.isReactComponent={};O0.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};O0.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function G9(){}G9.prototype=O0.prototype;function n5(t,e,n){this.props=t,this.context=e,this.refs=B9,this.updater=n||U9}var r5=n5.prototype=new G9;r5.constructor=n5;A9(r5,O0.prototype);r5.isPureReactComponent=!0;var a4=Array.isArray,W9=Object.prototype.hasOwnProperty,i5={current:null},$9={key:!0,ref:!0,__self:!0,__source:!0};function z9(t,e,n){var r,i={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)W9.call(e,r)&&!$9.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:bl,type:t,key:a,ref:o,props:i,_owner:i5.current}}function wM(t,e){return{$$typeof:bl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function a5(t){return typeof t=="object"&&t!==null&&t.$$typeof===bl}function EM(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var o4=/\/+/g;function kd(t,e){return typeof t=="object"&&t!==null&&t.key!=null?EM(""+t.key):e.toString(36)}function df(t,e,n,r,i){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case bl:case gM:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+kd(o,0):r,a4(i)?(n="",t!=null&&(n=t.replace(o4,"$&/")+"/"),df(i,e,n,"",function(l){return l})):i!=null&&(a5(i)&&(i=wM(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(o4,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",a4(t))for(var s=0;s<t.length;s++){a=t[s];var c=r+kd(a,s);o+=df(a,e,n,c,i)}else if(c=xM(t),typeof c=="function")for(t=c.call(t),s=0;!(a=t.next()).done;)a=a.value,c=r+kd(a,s++),o+=df(a,e,n,c,i);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ou(t,e,n){if(t==null)return t;var r=[],i=0;return df(t,r,"","",function(a){return e.call(n,a,i++)}),r}function OM(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Mn={current:null},pf={transition:null},DM={ReactCurrentDispatcher:Mn,ReactCurrentBatchConfig:pf,ReactCurrentOwner:i5};function H9(){throw Error("act(...) is not supported in production builds of React.")}Re.Children={map:ou,forEach:function(t,e,n){ou(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ou(t,function(){e++}),e},toArray:function(t){return ou(t,function(e){return e})||[]},only:function(t){if(!a5(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Re.Component=O0;Re.Fragment=dM;Re.Profiler=hM;Re.PureComponent=n5;Re.StrictMode=pM;Re.Suspense=CM;Re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DM;Re.act=H9;Re.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=A9({},t.props),i=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=i5.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(c in e)W9.call(e,c)&&!$9.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&s!==void 0?s[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:bl,type:t.type,key:i,ref:a,props:r,_owner:o}};Re.createContext=function(t){return t={$$typeof:vM,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:mM,_context:t},t.Consumer=t};Re.createElement=z9;Re.createFactory=function(t){var e=z9.bind(null,t);return e.type=t,e};Re.createRef=function(){return{current:null}};Re.forwardRef=function(t){return{$$typeof:yM,render:t}};Re.isValidElement=a5;Re.lazy=function(t){return{$$typeof:SM,_payload:{_status:-1,_result:t},_init:OM}};Re.memo=function(t,e){return{$$typeof:TM,type:t,compare:e===void 0?null:e}};Re.startTransition=function(t){var e=pf.transition;pf.transition={};try{t()}finally{pf.transition=e}};Re.unstable_act=H9;Re.useCallback=function(t,e){return Mn.current.useCallback(t,e)};Re.useContext=function(t){return Mn.current.useContext(t)};Re.useDebugValue=function(){};Re.useDeferredValue=function(t){return Mn.current.useDeferredValue(t)};Re.useEffect=function(t,e){return Mn.current.useEffect(t,e)};Re.useId=function(){return Mn.current.useId()};Re.useImperativeHandle=function(t,e,n){return Mn.current.useImperativeHandle(t,e,n)};Re.useInsertionEffect=function(t,e){return Mn.current.useInsertionEffect(t,e)};Re.useLayoutEffect=function(t,e){return Mn.current.useLayoutEffect(t,e)};Re.useMemo=function(t,e){return Mn.current.useMemo(t,e)};Re.useReducer=function(t,e,n){return Mn.current.useReducer(t,e,n)};Re.useRef=function(t){return Mn.current.useRef(t)};Re.useState=function(t){return Mn.current.useState(t)};Re.useSyncExternalStore=function(t,e,n){return Mn.current.useSyncExternalStore(t,e,n)};Re.useTransition=function(){return Mn.current.useTransition()};Re.version="18.3.1";F9.exports=Re;var eo=F9.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RM=eo,MM=Symbol.for("react.element"),LM=Symbol.for("react.fragment"),IM=Object.prototype.hasOwnProperty,VM=RM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_M={key:!0,ref:!0,__self:!0,__source:!0};function j9(t,e,n){var r,i={},a=null,o=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)IM.call(e,r)&&!_M.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:MM,type:t,key:a,ref:o,props:i,_owner:VM.current}}Sg.Fragment=LM;Sg.jsx=j9;Sg.jsxs=j9;k9.exports=Sg;var uc=k9.exports,K9={exports:{}},Jn={},q9={exports:{}},X9={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(A,b){var F=A.length;A.push(b);e:for(;0<F;){var $=F-1>>>1,j=A[$];if(0<i(j,b))A[$]=b,A[F]=j,F=$;else break e}}function n(A){return A.length===0?null:A[0]}function r(A){if(A.length===0)return null;var b=A[0],F=A.pop();if(F!==b){A[0]=F;e:for(var $=0,j=A.length,z=j>>>1;$<z;){var ge=2*($+1)-1,Pt=A[ge],Ae=ge+1,Dt=A[Ae];if(0>i(Pt,F))Ae<j&&0>i(Dt,Pt)?(A[$]=Dt,A[Ae]=F,$=Ae):(A[$]=Pt,A[ge]=F,$=ge);else if(Ae<j&&0>i(Dt,F))A[$]=Dt,A[Ae]=F,$=Ae;else break e}}return b}function i(A,b){var F=A.sortIndex-b.sortIndex;return F!==0?F:A.id-b.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();t.unstable_now=function(){return o.now()-s}}var c=[],l=[],f=1,u=null,g=3,d=!1,h=!1,p=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(A){for(var b=n(l);b!==null;){if(b.callback===null)r(l);else if(b.startTime<=A)r(l),b.sortIndex=b.expirationTime,e(c,b);else break;b=n(l)}}function T(A){if(p=!1,C(A),!h)if(n(c)!==null)h=!0,U(S);else{var b=n(l);b!==null&&K(T,b.startTime-A)}}function S(A,b){h=!1,p&&(p=!1,v(E),E=-1),d=!0;var F=g;try{for(C(b),u=n(c);u!==null&&(!(u.expirationTime>b)||A&&!R());){var $=u.callback;if(typeof $=="function"){u.callback=null,g=u.priorityLevel;var j=$(u.expirationTime<=b);b=t.unstable_now(),typeof j=="function"?u.callback=j:u===n(c)&&r(c),C(b)}else r(c);u=n(c)}if(u!==null)var z=!0;else{var ge=n(l);ge!==null&&K(T,ge.startTime-b),z=!1}return z}finally{u=null,g=F,d=!1}}var x=!1,w=null,E=-1,M=5,O=-1;function R(){return!(t.unstable_now()-O<M)}function _(){if(w!==null){var A=t.unstable_now();O=A;var b=!0;try{b=w(!0,A)}finally{b?P():(x=!1,w=null)}}else x=!1}var P;if(typeof y=="function")P=function(){y(_)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,W=N.port2;N.port1.onmessage=_,P=function(){W.postMessage(null)}}else P=function(){m(_,0)};function U(A){w=A,x||(x=!0,P())}function K(A,b){E=m(function(){A(t.unstable_now())},b)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(A){A.callback=null},t.unstable_continueExecution=function(){h||d||(h=!0,U(S))},t.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<A?Math.floor(1e3/A):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(A){switch(g){case 1:case 2:case 3:var b=3;break;default:b=g}var F=g;g=b;try{return A()}finally{g=F}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(A,b){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var F=g;g=A;try{return b()}finally{g=F}},t.unstable_scheduleCallback=function(A,b,F){var $=t.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?$+F:$):F=$,A){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=F+j,A={id:f++,callback:b,priorityLevel:A,startTime:F,expirationTime:j,sortIndex:-1},F>$?(A.sortIndex=F,e(l,A),n(c)===null&&A===n(l)&&(p?(v(E),E=-1):p=!0,K(T,F-$))):(A.sortIndex=j,e(c,A),h||d||(h=!0,U(S))),A},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(A){var b=g;return function(){var F=g;g=b;try{return A.apply(this,arguments)}finally{g=F}}}})(X9);q9.exports=X9;var bM=q9.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NM=eo,Yn=bM;function J(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Y9=new Set,Kc={};function zo(t,e){Qs(t,e),Qs(t+"Capture",e)}function Qs(t,e){for(Kc[t]=e,t=0;t<e.length;t++)Y9.add(e[t])}var Di=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cp=Object.prototype.hasOwnProperty,PM=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,s4={},c4={};function kM(t){return cp.call(c4,t)?!0:cp.call(s4,t)?!1:PM.test(t)?c4[t]=!0:(s4[t]=!0,!1)}function FM(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function UM(t,e,n,r){if(e===null||typeof e>"u"||FM(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ln(t,e,n,r,i,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var sn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){sn[t]=new Ln(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];sn[e]=new Ln(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){sn[t]=new Ln(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){sn[t]=new Ln(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){sn[t]=new Ln(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){sn[t]=new Ln(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){sn[t]=new Ln(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){sn[t]=new Ln(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){sn[t]=new Ln(t,5,!1,t.toLowerCase(),null,!1,!1)});var o5=/[\-:]([a-z])/g;function s5(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(o5,s5);sn[e]=new Ln(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(o5,s5);sn[e]=new Ln(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(o5,s5);sn[e]=new Ln(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){sn[t]=new Ln(t,1,!1,t.toLowerCase(),null,!1,!1)});sn.xlinkHref=new Ln("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){sn[t]=new Ln(t,1,!1,t.toLowerCase(),null,!0,!0)});function c5(t,e,n,r){var i=sn.hasOwnProperty(e)?sn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(UM(e,n,i,r)&&(n=null),r||i===null?kM(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var bi=NM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,su=Symbol.for("react.element"),fs=Symbol.for("react.portal"),gs=Symbol.for("react.fragment"),l5=Symbol.for("react.strict_mode"),lp=Symbol.for("react.profiler"),Z9=Symbol.for("react.provider"),J9=Symbol.for("react.context"),u5=Symbol.for("react.forward_ref"),up=Symbol.for("react.suspense"),fp=Symbol.for("react.suspense_list"),f5=Symbol.for("react.memo"),Hi=Symbol.for("react.lazy"),Q9=Symbol.for("react.offscreen"),l4=Symbol.iterator;function $0(t){return t===null||typeof t!="object"?null:(t=l4&&t[l4]||t["@@iterator"],typeof t=="function"?t:null)}var yt=Object.assign,Fd;function fc(t){if(Fd===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Fd=e&&e[1]||""}return`
`+Fd+t}var Ud=!1;function Ad(t,e){if(!t||Ud)return"";Ud=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(o!==1||s!==1)do if(o--,s--,0>s||i[o]!==a[s]){var c=`
`+i[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=s);break}}}finally{Ud=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?fc(t):""}function AM(t){switch(t.tag){case 5:return fc(t.type);case 16:return fc("Lazy");case 13:return fc("Suspense");case 19:return fc("SuspenseList");case 0:case 2:case 15:return t=Ad(t.type,!1),t;case 11:return t=Ad(t.type.render,!1),t;case 1:return t=Ad(t.type,!0),t;default:return""}}function gp(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case gs:return"Fragment";case fs:return"Portal";case lp:return"Profiler";case l5:return"StrictMode";case up:return"Suspense";case fp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case J9:return(t.displayName||"Context")+".Consumer";case Z9:return(t._context.displayName||"Context")+".Provider";case u5:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case f5:return e=t.displayName||null,e!==null?e:gp(t.type)||"Memo";case Hi:e=t._payload,t=t._init;try{return gp(t(e))}catch{}}return null}function BM(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gp(e);case 8:return e===l5?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ca(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ey(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function GM(t){var e=ey(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function cu(t){t._valueTracker||(t._valueTracker=GM(t))}function ty(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=ey(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Qf(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function dp(t,e){var n=e.checked;return yt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function u4(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ca(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ny(t,e){e=e.checked,e!=null&&c5(t,"checked",e,!1)}function pp(t,e){ny(t,e);var n=Ca(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?hp(t,e.type,n):e.hasOwnProperty("defaultValue")&&hp(t,e.type,Ca(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function f4(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function hp(t,e,n){(e!=="number"||Qf(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var gc=Array.isArray;function _s(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ca(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function mp(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(J(91));return yt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function g4(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(J(92));if(gc(n)){if(1<n.length)throw Error(J(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ca(n)}}function ry(t,e){var n=Ca(e.value),r=Ca(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function d4(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function iy(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function vp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?iy(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var lu,ay=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(lu=lu||document.createElement("div"),lu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=lu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Oc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},WM=["Webkit","ms","Moz","O"];Object.keys(Oc).forEach(function(t){WM.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Oc[e]=Oc[t]})});function oy(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Oc.hasOwnProperty(t)&&Oc[t]?(""+e).trim():e+"px"}function sy(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=oy(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var $M=yt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yp(t,e){if(e){if($M[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(J(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(J(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(J(61))}if(e.style!=null&&typeof e.style!="object")throw Error(J(62))}}function Cp(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tp=null;function g5(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Sp=null,bs=null,Ns=null;function p4(t){if(t=kl(t)){if(typeof Sp!="function")throw Error(J(280));var e=t.stateNode;e&&(e=Dg(e),Sp(t.stateNode,t.type,e))}}function cy(t){bs?Ns?Ns.push(t):Ns=[t]:bs=t}function ly(){if(bs){var t=bs,e=Ns;if(Ns=bs=null,p4(t),e)for(t=0;t<e.length;t++)p4(e[t])}}function uy(t,e){return t(e)}function fy(){}var Bd=!1;function gy(t,e,n){if(Bd)return t(e,n);Bd=!0;try{return uy(t,e,n)}finally{Bd=!1,(bs!==null||Ns!==null)&&(fy(),ly())}}function Xc(t,e){var n=t.stateNode;if(n===null)return null;var r=Dg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(J(231,e,typeof n));return n}var xp=!1;if(Di)try{var z0={};Object.defineProperty(z0,"passive",{get:function(){xp=!0}}),window.addEventListener("test",z0,z0),window.removeEventListener("test",z0,z0)}catch{xp=!1}function zM(t,e,n,r,i,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(f){this.onError(f)}}var Dc=!1,e1=null,t1=!1,wp=null,HM={onError:function(t){Dc=!0,e1=t}};function jM(t,e,n,r,i,a,o,s,c){Dc=!1,e1=null,zM.apply(HM,arguments)}function KM(t,e,n,r,i,a,o,s,c){if(jM.apply(this,arguments),Dc){if(Dc){var l=e1;Dc=!1,e1=null}else throw Error(J(198));t1||(t1=!0,wp=l)}}function Ho(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function dy(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function h4(t){if(Ho(t)!==t)throw Error(J(188))}function qM(t){var e=t.alternate;if(!e){if(e=Ho(t),e===null)throw Error(J(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return h4(i),t;if(a===r)return h4(i),e;a=a.sibling}throw Error(J(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,s=i.child;s;){if(s===n){o=!0,n=i,r=a;break}if(s===r){o=!0,r=i,n=a;break}s=s.sibling}if(!o){for(s=a.child;s;){if(s===n){o=!0,n=a,r=i;break}if(s===r){o=!0,r=a,n=i;break}s=s.sibling}if(!o)throw Error(J(189))}}if(n.alternate!==r)throw Error(J(190))}if(n.tag!==3)throw Error(J(188));return n.stateNode.current===n?t:e}function py(t){return t=qM(t),t!==null?hy(t):null}function hy(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=hy(t);if(e!==null)return e;t=t.sibling}return null}var my=Yn.unstable_scheduleCallback,m4=Yn.unstable_cancelCallback,XM=Yn.unstable_shouldYield,YM=Yn.unstable_requestPaint,It=Yn.unstable_now,ZM=Yn.unstable_getCurrentPriorityLevel,d5=Yn.unstable_ImmediatePriority,vy=Yn.unstable_UserBlockingPriority,n1=Yn.unstable_NormalPriority,JM=Yn.unstable_LowPriority,yy=Yn.unstable_IdlePriority,xg=null,Kr=null;function QM(t){if(Kr&&typeof Kr.onCommitFiberRoot=="function")try{Kr.onCommitFiberRoot(xg,t,void 0,(t.current.flags&128)===128)}catch{}}var Vr=Math.clz32?Math.clz32:nL,eL=Math.log,tL=Math.LN2;function nL(t){return t>>>=0,t===0?32:31-(eL(t)/tL|0)|0}var uu=64,fu=4194304;function dc(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function r1(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,a=t.pingedLanes,o=n&268435455;if(o!==0){var s=o&~i;s!==0?r=dc(s):(a&=o,a!==0&&(r=dc(a)))}else o=n&~i,o!==0?r=dc(o):a!==0&&(r=dc(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Vr(e),i=1<<n,r|=t[n],e&=~i;return r}function rL(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iL(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-Vr(a),s=1<<o,c=i[o];c===-1?(!(s&n)||s&r)&&(i[o]=rL(s,e)):c<=e&&(t.expiredLanes|=s),a&=~s}}function Ep(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Cy(){var t=uu;return uu<<=1,!(uu&4194240)&&(uu=64),t}function Gd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Nl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Vr(e),t[e]=n}function aL(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Vr(n),a=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~a}}function p5(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Vr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var He=0;function Ty(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Sy,h5,xy,wy,Ey,Op=!1,gu=[],ca=null,la=null,ua=null,Yc=new Map,Zc=new Map,Xi=[],oL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function v4(t,e){switch(t){case"focusin":case"focusout":ca=null;break;case"dragenter":case"dragleave":la=null;break;case"mouseover":case"mouseout":ua=null;break;case"pointerover":case"pointerout":Yc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zc.delete(e.pointerId)}}function H0(t,e,n,r,i,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=kl(e),e!==null&&h5(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function sL(t,e,n,r,i){switch(e){case"focusin":return ca=H0(ca,t,e,n,r,i),!0;case"dragenter":return la=H0(la,t,e,n,r,i),!0;case"mouseover":return ua=H0(ua,t,e,n,r,i),!0;case"pointerover":var a=i.pointerId;return Yc.set(a,H0(Yc.get(a)||null,t,e,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Zc.set(a,H0(Zc.get(a)||null,t,e,n,r,i)),!0}return!1}function Oy(t){var e=so(t.target);if(e!==null){var n=Ho(e);if(n!==null){if(e=n.tag,e===13){if(e=dy(n),e!==null){t.blockedOn=e,Ey(t.priority,function(){xy(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function hf(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Dp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Tp=r,n.target.dispatchEvent(r),Tp=null}else return e=kl(n),e!==null&&h5(e),t.blockedOn=n,!1;e.shift()}return!0}function y4(t,e,n){hf(t)&&n.delete(e)}function cL(){Op=!1,ca!==null&&hf(ca)&&(ca=null),la!==null&&hf(la)&&(la=null),ua!==null&&hf(ua)&&(ua=null),Yc.forEach(y4),Zc.forEach(y4)}function j0(t,e){t.blockedOn===e&&(t.blockedOn=null,Op||(Op=!0,Yn.unstable_scheduleCallback(Yn.unstable_NormalPriority,cL)))}function Jc(t){function e(i){return j0(i,t)}if(0<gu.length){j0(gu[0],t);for(var n=1;n<gu.length;n++){var r=gu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ca!==null&&j0(ca,t),la!==null&&j0(la,t),ua!==null&&j0(ua,t),Yc.forEach(e),Zc.forEach(e),n=0;n<Xi.length;n++)r=Xi[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Xi.length&&(n=Xi[0],n.blockedOn===null);)Oy(n),n.blockedOn===null&&Xi.shift()}var Ps=bi.ReactCurrentBatchConfig,i1=!0;function lL(t,e,n,r){var i=He,a=Ps.transition;Ps.transition=null;try{He=1,m5(t,e,n,r)}finally{He=i,Ps.transition=a}}function uL(t,e,n,r){var i=He,a=Ps.transition;Ps.transition=null;try{He=4,m5(t,e,n,r)}finally{He=i,Ps.transition=a}}function m5(t,e,n,r){if(i1){var i=Dp(t,e,n,r);if(i===null)Zd(t,e,r,a1,n),v4(t,r);else if(sL(i,t,e,n,r))r.stopPropagation();else if(v4(t,r),e&4&&-1<oL.indexOf(t)){for(;i!==null;){var a=kl(i);if(a!==null&&Sy(a),a=Dp(t,e,n,r),a===null&&Zd(t,e,r,a1,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else Zd(t,e,r,null,n)}}var a1=null;function Dp(t,e,n,r){if(a1=null,t=g5(r),t=so(t),t!==null)if(e=Ho(t),e===null)t=null;else if(n=e.tag,n===13){if(t=dy(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return a1=t,null}function Dy(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ZM()){case d5:return 1;case vy:return 4;case n1:case JM:return 16;case yy:return 536870912;default:return 16}default:return 16}}var ta=null,v5=null,mf=null;function Ry(){if(mf)return mf;var t,e=v5,n=e.length,r,i="value"in ta?ta.value:ta.textContent,a=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[a-r];r++);return mf=i.slice(t,1<r?1-r:void 0)}function vf(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function du(){return!0}function C4(){return!1}function Qn(t){function e(n,r,i,a,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(a):a[s]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?du:C4,this.isPropagationStopped=C4,this}return yt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=du)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=du)},persist:function(){},isPersistent:du}),e}var D0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},y5=Qn(D0),Pl=yt({},D0,{view:0,detail:0}),fL=Qn(Pl),Wd,$d,K0,wg=yt({},Pl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:C5,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==K0&&(K0&&t.type==="mousemove"?(Wd=t.screenX-K0.screenX,$d=t.screenY-K0.screenY):$d=Wd=0,K0=t),Wd)},movementY:function(t){return"movementY"in t?t.movementY:$d}}),T4=Qn(wg),gL=yt({},wg,{dataTransfer:0}),dL=Qn(gL),pL=yt({},Pl,{relatedTarget:0}),zd=Qn(pL),hL=yt({},D0,{animationName:0,elapsedTime:0,pseudoElement:0}),mL=Qn(hL),vL=yt({},D0,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),yL=Qn(vL),CL=yt({},D0,{data:0}),S4=Qn(CL),TL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},SL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wL(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=xL[t])?!!e[t]:!1}function C5(){return wL}var EL=yt({},Pl,{key:function(t){if(t.key){var e=TL[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=vf(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?SL[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:C5,charCode:function(t){return t.type==="keypress"?vf(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?vf(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),OL=Qn(EL),DL=yt({},wg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),x4=Qn(DL),RL=yt({},Pl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:C5}),ML=Qn(RL),LL=yt({},D0,{propertyName:0,elapsedTime:0,pseudoElement:0}),IL=Qn(LL),VL=yt({},wg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),_L=Qn(VL),bL=[9,13,27,32],T5=Di&&"CompositionEvent"in window,Rc=null;Di&&"documentMode"in document&&(Rc=document.documentMode);var NL=Di&&"TextEvent"in window&&!Rc,My=Di&&(!T5||Rc&&8<Rc&&11>=Rc),w4=" ",E4=!1;function Ly(t,e){switch(t){case"keyup":return bL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Iy(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ds=!1;function PL(t,e){switch(t){case"compositionend":return Iy(e);case"keypress":return e.which!==32?null:(E4=!0,w4);case"textInput":return t=e.data,t===w4&&E4?null:t;default:return null}}function kL(t,e){if(ds)return t==="compositionend"||!T5&&Ly(t,e)?(t=Ry(),mf=v5=ta=null,ds=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return My&&e.locale!=="ko"?null:e.data;default:return null}}var FL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function O4(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!FL[t.type]:e==="textarea"}function Vy(t,e,n,r){cy(r),e=o1(e,"onChange"),0<e.length&&(n=new y5("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Mc=null,Qc=null;function UL(t){Wy(t,0)}function Eg(t){var e=ms(t);if(ty(e))return t}function AL(t,e){if(t==="change")return e}var _y=!1;if(Di){var Hd;if(Di){var jd="oninput"in document;if(!jd){var D4=document.createElement("div");D4.setAttribute("oninput","return;"),jd=typeof D4.oninput=="function"}Hd=jd}else Hd=!1;_y=Hd&&(!document.documentMode||9<document.documentMode)}function R4(){Mc&&(Mc.detachEvent("onpropertychange",by),Qc=Mc=null)}function by(t){if(t.propertyName==="value"&&Eg(Qc)){var e=[];Vy(e,Qc,t,g5(t)),gy(UL,e)}}function BL(t,e,n){t==="focusin"?(R4(),Mc=e,Qc=n,Mc.attachEvent("onpropertychange",by)):t==="focusout"&&R4()}function GL(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Eg(Qc)}function WL(t,e){if(t==="click")return Eg(e)}function $L(t,e){if(t==="input"||t==="change")return Eg(e)}function zL(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var br=typeof Object.is=="function"?Object.is:zL;function el(t,e){if(br(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!cp.call(e,i)||!br(t[i],e[i]))return!1}return!0}function M4(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function L4(t,e){var n=M4(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=M4(n)}}function Ny(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Ny(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Py(){for(var t=window,e=Qf();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Qf(t.document)}return e}function S5(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function HL(t){var e=Py(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Ny(n.ownerDocument.documentElement,n)){if(r!==null&&S5(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!t.extend&&a>r&&(i=r,r=a,a=i),i=L4(n,a);var o=L4(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var jL=Di&&"documentMode"in document&&11>=document.documentMode,ps=null,Rp=null,Lc=null,Mp=!1;function I4(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Mp||ps==null||ps!==Qf(r)||(r=ps,"selectionStart"in r&&S5(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Lc&&el(Lc,r)||(Lc=r,r=o1(Rp,"onSelect"),0<r.length&&(e=new y5("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ps)))}function pu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var hs={animationend:pu("Animation","AnimationEnd"),animationiteration:pu("Animation","AnimationIteration"),animationstart:pu("Animation","AnimationStart"),transitionend:pu("Transition","TransitionEnd")},Kd={},ky={};Di&&(ky=document.createElement("div").style,"AnimationEvent"in window||(delete hs.animationend.animation,delete hs.animationiteration.animation,delete hs.animationstart.animation),"TransitionEvent"in window||delete hs.transitionend.transition);function Og(t){if(Kd[t])return Kd[t];if(!hs[t])return t;var e=hs[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in ky)return Kd[t]=e[n];return t}var Fy=Og("animationend"),Uy=Og("animationiteration"),Ay=Og("animationstart"),By=Og("transitionend"),Gy=new Map,V4="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Da(t,e){Gy.set(t,e),zo(e,[t])}for(var qd=0;qd<V4.length;qd++){var Xd=V4[qd],KL=Xd.toLowerCase(),qL=Xd[0].toUpperCase()+Xd.slice(1);Da(KL,"on"+qL)}Da(Fy,"onAnimationEnd");Da(Uy,"onAnimationIteration");Da(Ay,"onAnimationStart");Da("dblclick","onDoubleClick");Da("focusin","onFocus");Da("focusout","onBlur");Da(By,"onTransitionEnd");Qs("onMouseEnter",["mouseout","mouseover"]);Qs("onMouseLeave",["mouseout","mouseover"]);Qs("onPointerEnter",["pointerout","pointerover"]);Qs("onPointerLeave",["pointerout","pointerover"]);zo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));zo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));zo("onBeforeInput",["compositionend","keypress","textInput","paste"]);zo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));zo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));zo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XL=new Set("cancel close invalid load scroll toggle".split(" ").concat(pc));function _4(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,KM(r,e,void 0,t),t.currentTarget=null}function Wy(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;_4(i,s,l),a=c}else for(o=0;o<r.length;o++){if(s=r[o],c=s.instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;_4(i,s,l),a=c}}}if(t1)throw t=wp,t1=!1,wp=null,t}function tt(t,e){var n=e[bp];n===void 0&&(n=e[bp]=new Set);var r=t+"__bubble";n.has(r)||($y(e,t,2,!1),n.add(r))}function Yd(t,e,n){var r=0;e&&(r|=4),$y(n,t,r,e)}var hu="_reactListening"+Math.random().toString(36).slice(2);function tl(t){if(!t[hu]){t[hu]=!0,Y9.forEach(function(n){n!=="selectionchange"&&(XL.has(n)||Yd(n,!1,t),Yd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[hu]||(e[hu]=!0,Yd("selectionchange",!1,e))}}function $y(t,e,n,r){switch(Dy(e)){case 1:var i=lL;break;case 4:i=uL;break;default:i=m5}n=i.bind(null,e,n,t),i=void 0,!xp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Zd(t,e,n,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;s!==null;){if(o=so(s),o===null)return;if(c=o.tag,c===5||c===6){r=a=o;continue e}s=s.parentNode}}r=r.return}gy(function(){var l=a,f=g5(n),u=[];e:{var g=Gy.get(t);if(g!==void 0){var d=y5,h=t;switch(t){case"keypress":if(vf(n)===0)break e;case"keydown":case"keyup":d=OL;break;case"focusin":h="focus",d=zd;break;case"focusout":h="blur",d=zd;break;case"beforeblur":case"afterblur":d=zd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=T4;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=dL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=ML;break;case Fy:case Uy:case Ay:d=mL;break;case By:d=IL;break;case"scroll":d=fL;break;case"wheel":d=_L;break;case"copy":case"cut":case"paste":d=yL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=x4}var p=(e&4)!==0,m=!p&&t==="scroll",v=p?g!==null?g+"Capture":null:g;p=[];for(var y=l,C;y!==null;){C=y;var T=C.stateNode;if(C.tag===5&&T!==null&&(C=T,v!==null&&(T=Xc(y,v),T!=null&&p.push(nl(y,T,C)))),m)break;y=y.return}0<p.length&&(g=new d(g,h,null,n,f),u.push({event:g,listeners:p}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",g&&n!==Tp&&(h=n.relatedTarget||n.fromElement)&&(so(h)||h[Ri]))break e;if((d||g)&&(g=f.window===f?f:(g=f.ownerDocument)?g.defaultView||g.parentWindow:window,d?(h=n.relatedTarget||n.toElement,d=l,h=h?so(h):null,h!==null&&(m=Ho(h),h!==m||h.tag!==5&&h.tag!==6)&&(h=null)):(d=null,h=l),d!==h)){if(p=T4,T="onMouseLeave",v="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(p=x4,T="onPointerLeave",v="onPointerEnter",y="pointer"),m=d==null?g:ms(d),C=h==null?g:ms(h),g=new p(T,y+"leave",d,n,f),g.target=m,g.relatedTarget=C,T=null,so(f)===l&&(p=new p(v,y+"enter",h,n,f),p.target=C,p.relatedTarget=m,T=p),m=T,d&&h)t:{for(p=d,v=h,y=0,C=p;C;C=Yo(C))y++;for(C=0,T=v;T;T=Yo(T))C++;for(;0<y-C;)p=Yo(p),y--;for(;0<C-y;)v=Yo(v),C--;for(;y--;){if(p===v||v!==null&&p===v.alternate)break t;p=Yo(p),v=Yo(v)}p=null}else p=null;d!==null&&b4(u,g,d,p,!1),h!==null&&m!==null&&b4(u,m,h,p,!0)}}e:{if(g=l?ms(l):window,d=g.nodeName&&g.nodeName.toLowerCase(),d==="select"||d==="input"&&g.type==="file")var S=AL;else if(O4(g))if(_y)S=$L;else{S=GL;var x=BL}else(d=g.nodeName)&&d.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(S=WL);if(S&&(S=S(t,l))){Vy(u,S,n,f);break e}x&&x(t,g,l),t==="focusout"&&(x=g._wrapperState)&&x.controlled&&g.type==="number"&&hp(g,"number",g.value)}switch(x=l?ms(l):window,t){case"focusin":(O4(x)||x.contentEditable==="true")&&(ps=x,Rp=l,Lc=null);break;case"focusout":Lc=Rp=ps=null;break;case"mousedown":Mp=!0;break;case"contextmenu":case"mouseup":case"dragend":Mp=!1,I4(u,n,f);break;case"selectionchange":if(jL)break;case"keydown":case"keyup":I4(u,n,f)}var w;if(T5)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else ds?Ly(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(My&&n.locale!=="ko"&&(ds||E!=="onCompositionStart"?E==="onCompositionEnd"&&ds&&(w=Ry()):(ta=f,v5="value"in ta?ta.value:ta.textContent,ds=!0)),x=o1(l,E),0<x.length&&(E=new S4(E,t,null,n,f),u.push({event:E,listeners:x}),w?E.data=w:(w=Iy(n),w!==null&&(E.data=w)))),(w=NL?PL(t,n):kL(t,n))&&(l=o1(l,"onBeforeInput"),0<l.length&&(f=new S4("onBeforeInput","beforeinput",null,n,f),u.push({event:f,listeners:l}),f.data=w))}Wy(u,e)})}function nl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function o1(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Xc(t,n),a!=null&&r.unshift(nl(t,a,i)),a=Xc(t,e),a!=null&&r.push(nl(t,a,i))),t=t.return}return r}function Yo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function b4(t,e,n,r,i){for(var a=e._reactName,o=[];n!==null&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(c!==null&&c===r)break;s.tag===5&&l!==null&&(s=l,i?(c=Xc(n,a),c!=null&&o.unshift(nl(n,c,s))):i||(c=Xc(n,a),c!=null&&o.push(nl(n,c,s)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var YL=/\r\n?/g,ZL=/\u0000|\uFFFD/g;function N4(t){return(typeof t=="string"?t:""+t).replace(YL,`
`).replace(ZL,"")}function mu(t,e,n){if(e=N4(e),N4(t)!==e&&n)throw Error(J(425))}function s1(){}var Lp=null,Ip=null;function Vp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _p=typeof setTimeout=="function"?setTimeout:void 0,JL=typeof clearTimeout=="function"?clearTimeout:void 0,P4=typeof Promise=="function"?Promise:void 0,QL=typeof queueMicrotask=="function"?queueMicrotask:typeof P4<"u"?function(t){return P4.resolve(null).then(t).catch(eI)}:_p;function eI(t){setTimeout(function(){throw t})}function Jd(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Jc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Jc(e)}function fa(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function k4(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var R0=Math.random().toString(36).slice(2),Hr="__reactFiber$"+R0,rl="__reactProps$"+R0,Ri="__reactContainer$"+R0,bp="__reactEvents$"+R0,tI="__reactListeners$"+R0,nI="__reactHandles$"+R0;function so(t){var e=t[Hr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ri]||n[Hr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=k4(t);t!==null;){if(n=t[Hr])return n;t=k4(t)}return e}t=n,n=t.parentNode}return null}function kl(t){return t=t[Hr]||t[Ri],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ms(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(J(33))}function Dg(t){return t[rl]||null}var Np=[],vs=-1;function Ra(t){return{current:t}}function at(t){0>vs||(t.current=Np[vs],Np[vs]=null,vs--)}function Ye(t,e){vs++,Np[vs]=t.current,t.current=e}var Ta={},mn=Ra(Ta),Fn=Ra(!1),Oo=Ta;function e0(t,e){var n=t.type.contextTypes;if(!n)return Ta;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Un(t){return t=t.childContextTypes,t!=null}function c1(){at(Fn),at(mn)}function F4(t,e,n){if(mn.current!==Ta)throw Error(J(168));Ye(mn,e),Ye(Fn,n)}function zy(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(J(108,BM(t)||"Unknown",i));return yt({},n,r)}function l1(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ta,Oo=mn.current,Ye(mn,t),Ye(Fn,Fn.current),!0}function U4(t,e,n){var r=t.stateNode;if(!r)throw Error(J(169));n?(t=zy(t,e,Oo),r.__reactInternalMemoizedMergedChildContext=t,at(Fn),at(mn),Ye(mn,t)):at(Fn),Ye(Fn,n)}var fi=null,Rg=!1,Qd=!1;function Hy(t){fi===null?fi=[t]:fi.push(t)}function rI(t){Rg=!0,Hy(t)}function Ma(){if(!Qd&&fi!==null){Qd=!0;var t=0,e=He;try{var n=fi;for(He=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}fi=null,Rg=!1}catch(i){throw fi!==null&&(fi=fi.slice(t+1)),my(d5,Ma),i}finally{He=e,Qd=!1}}return null}var ys=[],Cs=0,u1=null,f1=0,or=[],sr=0,Do=null,hi=1,mi="";function Xa(t,e){ys[Cs++]=f1,ys[Cs++]=u1,u1=t,f1=e}function jy(t,e,n){or[sr++]=hi,or[sr++]=mi,or[sr++]=Do,Do=t;var r=hi;t=mi;var i=32-Vr(r)-1;r&=~(1<<i),n+=1;var a=32-Vr(e)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,hi=1<<32-Vr(e)+i|n<<i|r,mi=a+t}else hi=1<<a|n<<i|r,mi=t}function x5(t){t.return!==null&&(Xa(t,1),jy(t,1,0))}function w5(t){for(;t===u1;)u1=ys[--Cs],ys[Cs]=null,f1=ys[--Cs],ys[Cs]=null;for(;t===Do;)Do=or[--sr],or[sr]=null,mi=or[--sr],or[sr]=null,hi=or[--sr],or[sr]=null}var Xn=null,Kn=null,ct=!1,Er=null;function Ky(t,e){var n=lr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function A4(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Xn=t,Kn=fa(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Xn=t,Kn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Do!==null?{id:hi,overflow:mi}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=lr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Xn=t,Kn=null,!0):!1;default:return!1}}function Pp(t){return(t.mode&1)!==0&&(t.flags&128)===0}function kp(t){if(ct){var e=Kn;if(e){var n=e;if(!A4(t,e)){if(Pp(t))throw Error(J(418));e=fa(n.nextSibling);var r=Xn;e&&A4(t,e)?Ky(r,n):(t.flags=t.flags&-4097|2,ct=!1,Xn=t)}}else{if(Pp(t))throw Error(J(418));t.flags=t.flags&-4097|2,ct=!1,Xn=t}}}function B4(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Xn=t}function vu(t){if(t!==Xn)return!1;if(!ct)return B4(t),ct=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Vp(t.type,t.memoizedProps)),e&&(e=Kn)){if(Pp(t))throw qy(),Error(J(418));for(;e;)Ky(t,e),e=fa(e.nextSibling)}if(B4(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(J(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Kn=fa(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Kn=null}}else Kn=Xn?fa(t.stateNode.nextSibling):null;return!0}function qy(){for(var t=Kn;t;)t=fa(t.nextSibling)}function t0(){Kn=Xn=null,ct=!1}function E5(t){Er===null?Er=[t]:Er.push(t)}var iI=bi.ReactCurrentBatchConfig;function q0(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(J(309));var r=n.stateNode}if(!r)throw Error(J(147,t));var i=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var s=i.refs;o===null?delete s[a]:s[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(J(284));if(!n._owner)throw Error(J(290,t))}return t}function yu(t,e){throw t=Object.prototype.toString.call(e),Error(J(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function G4(t){var e=t._init;return e(t._payload)}function Xy(t){function e(v,y){if(t){var C=v.deletions;C===null?(v.deletions=[y],v.flags|=16):C.push(y)}}function n(v,y){if(!t)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function i(v,y){return v=ha(v,y),v.index=0,v.sibling=null,v}function a(v,y,C){return v.index=C,t?(C=v.alternate,C!==null?(C=C.index,C<y?(v.flags|=2,y):C):(v.flags|=2,y)):(v.flags|=1048576,y)}function o(v){return t&&v.alternate===null&&(v.flags|=2),v}function s(v,y,C,T){return y===null||y.tag!==6?(y=o2(C,v.mode,T),y.return=v,y):(y=i(y,C),y.return=v,y)}function c(v,y,C,T){var S=C.type;return S===gs?f(v,y,C.props.children,T,C.key):y!==null&&(y.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Hi&&G4(S)===y.type)?(T=i(y,C.props),T.ref=q0(v,y,C),T.return=v,T):(T=Ef(C.type,C.key,C.props,null,v.mode,T),T.ref=q0(v,y,C),T.return=v,T)}function l(v,y,C,T){return y===null||y.tag!==4||y.stateNode.containerInfo!==C.containerInfo||y.stateNode.implementation!==C.implementation?(y=s2(C,v.mode,T),y.return=v,y):(y=i(y,C.children||[]),y.return=v,y)}function f(v,y,C,T,S){return y===null||y.tag!==7?(y=mo(C,v.mode,T,S),y.return=v,y):(y=i(y,C),y.return=v,y)}function u(v,y,C){if(typeof y=="string"&&y!==""||typeof y=="number")return y=o2(""+y,v.mode,C),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case su:return C=Ef(y.type,y.key,y.props,null,v.mode,C),C.ref=q0(v,null,y),C.return=v,C;case fs:return y=s2(y,v.mode,C),y.return=v,y;case Hi:var T=y._init;return u(v,T(y._payload),C)}if(gc(y)||$0(y))return y=mo(y,v.mode,C,null),y.return=v,y;yu(v,y)}return null}function g(v,y,C,T){var S=y!==null?y.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return S!==null?null:s(v,y,""+C,T);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case su:return C.key===S?c(v,y,C,T):null;case fs:return C.key===S?l(v,y,C,T):null;case Hi:return S=C._init,g(v,y,S(C._payload),T)}if(gc(C)||$0(C))return S!==null?null:f(v,y,C,T,null);yu(v,C)}return null}function d(v,y,C,T,S){if(typeof T=="string"&&T!==""||typeof T=="number")return v=v.get(C)||null,s(y,v,""+T,S);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case su:return v=v.get(T.key===null?C:T.key)||null,c(y,v,T,S);case fs:return v=v.get(T.key===null?C:T.key)||null,l(y,v,T,S);case Hi:var x=T._init;return d(v,y,C,x(T._payload),S)}if(gc(T)||$0(T))return v=v.get(C)||null,f(y,v,T,S,null);yu(y,T)}return null}function h(v,y,C,T){for(var S=null,x=null,w=y,E=y=0,M=null;w!==null&&E<C.length;E++){w.index>E?(M=w,w=null):M=w.sibling;var O=g(v,w,C[E],T);if(O===null){w===null&&(w=M);break}t&&w&&O.alternate===null&&e(v,w),y=a(O,y,E),x===null?S=O:x.sibling=O,x=O,w=M}if(E===C.length)return n(v,w),ct&&Xa(v,E),S;if(w===null){for(;E<C.length;E++)w=u(v,C[E],T),w!==null&&(y=a(w,y,E),x===null?S=w:x.sibling=w,x=w);return ct&&Xa(v,E),S}for(w=r(v,w);E<C.length;E++)M=d(w,v,E,C[E],T),M!==null&&(t&&M.alternate!==null&&w.delete(M.key===null?E:M.key),y=a(M,y,E),x===null?S=M:x.sibling=M,x=M);return t&&w.forEach(function(R){return e(v,R)}),ct&&Xa(v,E),S}function p(v,y,C,T){var S=$0(C);if(typeof S!="function")throw Error(J(150));if(C=S.call(C),C==null)throw Error(J(151));for(var x=S=null,w=y,E=y=0,M=null,O=C.next();w!==null&&!O.done;E++,O=C.next()){w.index>E?(M=w,w=null):M=w.sibling;var R=g(v,w,O.value,T);if(R===null){w===null&&(w=M);break}t&&w&&R.alternate===null&&e(v,w),y=a(R,y,E),x===null?S=R:x.sibling=R,x=R,w=M}if(O.done)return n(v,w),ct&&Xa(v,E),S;if(w===null){for(;!O.done;E++,O=C.next())O=u(v,O.value,T),O!==null&&(y=a(O,y,E),x===null?S=O:x.sibling=O,x=O);return ct&&Xa(v,E),S}for(w=r(v,w);!O.done;E++,O=C.next())O=d(w,v,E,O.value,T),O!==null&&(t&&O.alternate!==null&&w.delete(O.key===null?E:O.key),y=a(O,y,E),x===null?S=O:x.sibling=O,x=O);return t&&w.forEach(function(_){return e(v,_)}),ct&&Xa(v,E),S}function m(v,y,C,T){if(typeof C=="object"&&C!==null&&C.type===gs&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case su:e:{for(var S=C.key,x=y;x!==null;){if(x.key===S){if(S=C.type,S===gs){if(x.tag===7){n(v,x.sibling),y=i(x,C.props.children),y.return=v,v=y;break e}}else if(x.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Hi&&G4(S)===x.type){n(v,x.sibling),y=i(x,C.props),y.ref=q0(v,x,C),y.return=v,v=y;break e}n(v,x);break}else e(v,x);x=x.sibling}C.type===gs?(y=mo(C.props.children,v.mode,T,C.key),y.return=v,v=y):(T=Ef(C.type,C.key,C.props,null,v.mode,T),T.ref=q0(v,y,C),T.return=v,v=T)}return o(v);case fs:e:{for(x=C.key;y!==null;){if(y.key===x)if(y.tag===4&&y.stateNode.containerInfo===C.containerInfo&&y.stateNode.implementation===C.implementation){n(v,y.sibling),y=i(y,C.children||[]),y.return=v,v=y;break e}else{n(v,y);break}else e(v,y);y=y.sibling}y=s2(C,v.mode,T),y.return=v,v=y}return o(v);case Hi:return x=C._init,m(v,y,x(C._payload),T)}if(gc(C))return h(v,y,C,T);if($0(C))return p(v,y,C,T);yu(v,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,y!==null&&y.tag===6?(n(v,y.sibling),y=i(y,C),y.return=v,v=y):(n(v,y),y=o2(C,v.mode,T),y.return=v,v=y),o(v)):n(v,y)}return m}var n0=Xy(!0),Yy=Xy(!1),g1=Ra(null),d1=null,Ts=null,O5=null;function D5(){O5=Ts=d1=null}function R5(t){var e=g1.current;at(g1),t._currentValue=e}function Fp(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ks(t,e){d1=t,O5=Ts=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Pn=!0),t.firstContext=null)}function gr(t){var e=t._currentValue;if(O5!==t)if(t={context:t,memoizedValue:e,next:null},Ts===null){if(d1===null)throw Error(J(308));Ts=t,d1.dependencies={lanes:0,firstContext:t}}else Ts=Ts.next=t;return e}var co=null;function M5(t){co===null?co=[t]:co.push(t)}function Zy(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,M5(e)):(n.next=i.next,i.next=n),e.interleaved=n,Mi(t,r)}function Mi(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ji=!1;function L5(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Jy(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ci(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ga(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Ue&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Mi(t,n)}return i=r.interleaved,i===null?(e.next=e,M5(r)):(e.next=i.next,i.next=e),r.interleaved=e,Mi(t,n)}function yf(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,p5(t,n)}}function W4(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=e:a=a.next=e}else i=a=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function p1(t,e,n,r){var i=t.updateQueue;ji=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,o===null?a=l:o.next=l,o=c;var f=t.alternate;f!==null&&(f=f.updateQueue,s=f.lastBaseUpdate,s!==o&&(s===null?f.firstBaseUpdate=l:s.next=l,f.lastBaseUpdate=c))}if(a!==null){var u=i.baseState;o=0,f=l=c=null,s=a;do{var g=s.lane,d=s.eventTime;if((r&g)===g){f!==null&&(f=f.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=t,p=s;switch(g=e,d=n,p.tag){case 1:if(h=p.payload,typeof h=="function"){u=h.call(d,u,g);break e}u=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=p.payload,g=typeof h=="function"?h.call(d,u,g):h,g==null)break e;u=yt({},u,g);break e;case 2:ji=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,g=i.effects,g===null?i.effects=[s]:g.push(s))}else d={eventTime:d,lane:g,tag:s.tag,payload:s.payload,callback:s.callback,next:null},f===null?(l=f=d,c=u):f=f.next=d,o|=g;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;g=s,s=g.next,g.next=null,i.lastBaseUpdate=g,i.shared.pending=null}}while(!0);if(f===null&&(c=u),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=f,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);Mo|=o,t.lanes=o,t.memoizedState=u}}function $4(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(J(191,i));i.call(r)}}}var Fl={},qr=Ra(Fl),il=Ra(Fl),al=Ra(Fl);function lo(t){if(t===Fl)throw Error(J(174));return t}function I5(t,e){switch(Ye(al,e),Ye(il,t),Ye(qr,Fl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:vp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=vp(e,t)}at(qr),Ye(qr,e)}function r0(){at(qr),at(il),at(al)}function Qy(t){lo(al.current);var e=lo(qr.current),n=vp(e,t.type);e!==n&&(Ye(il,t),Ye(qr,n))}function V5(t){il.current===t&&(at(qr),at(il))}var ht=Ra(0);function h1(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var e2=[];function _5(){for(var t=0;t<e2.length;t++)e2[t]._workInProgressVersionPrimary=null;e2.length=0}var Cf=bi.ReactCurrentDispatcher,t2=bi.ReactCurrentBatchConfig,Ro=0,mt=null,Bt=null,Kt=null,m1=!1,Ic=!1,ol=0,aI=0;function ln(){throw Error(J(321))}function b5(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!br(t[n],e[n]))return!1;return!0}function N5(t,e,n,r,i,a){if(Ro=a,mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Cf.current=t===null||t.memoizedState===null?lI:uI,t=n(r,i),Ic){a=0;do{if(Ic=!1,ol=0,25<=a)throw Error(J(301));a+=1,Kt=Bt=null,e.updateQueue=null,Cf.current=fI,t=n(r,i)}while(Ic)}if(Cf.current=v1,e=Bt!==null&&Bt.next!==null,Ro=0,Kt=Bt=mt=null,m1=!1,e)throw Error(J(300));return t}function P5(){var t=ol!==0;return ol=0,t}function $r(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kt===null?mt.memoizedState=Kt=t:Kt=Kt.next=t,Kt}function dr(){if(Bt===null){var t=mt.alternate;t=t!==null?t.memoizedState:null}else t=Bt.next;var e=Kt===null?mt.memoizedState:Kt.next;if(e!==null)Kt=e,Bt=t;else{if(t===null)throw Error(J(310));Bt=t,t={memoizedState:Bt.memoizedState,baseState:Bt.baseState,baseQueue:Bt.baseQueue,queue:Bt.queue,next:null},Kt===null?mt.memoizedState=Kt=t:Kt=Kt.next=t}return Kt}function sl(t,e){return typeof e=="function"?e(t):e}function n2(t){var e=dr(),n=e.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=t;var r=Bt,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var s=o=null,c=null,l=a;do{var f=l.lane;if((Ro&f)===f)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var u={lane:f,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(s=c=u,o=r):c=c.next=u,mt.lanes|=f,Mo|=f}l=l.next}while(l!==null&&l!==a);c===null?o=r:c.next=s,br(r,e.memoizedState)||(Pn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do a=i.lane,mt.lanes|=a,Mo|=a,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function r2(t){var e=dr(),n=e.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,a=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do a=t(a,o.action),o=o.next;while(o!==i);br(a,e.memoizedState)||(Pn=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function e7(){}function t7(t,e){var n=mt,r=dr(),i=e(),a=!br(r.memoizedState,i);if(a&&(r.memoizedState=i,Pn=!0),r=r.queue,k5(i7.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||Kt!==null&&Kt.memoizedState.tag&1){if(n.flags|=2048,cl(9,r7.bind(null,n,r,i,e),void 0,null),Xt===null)throw Error(J(349));Ro&30||n7(n,e,i)}return i}function n7(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function r7(t,e,n,r){e.value=n,e.getSnapshot=r,a7(e)&&o7(t)}function i7(t,e,n){return n(function(){a7(e)&&o7(t)})}function a7(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!br(t,n)}catch{return!0}}function o7(t){var e=Mi(t,1);e!==null&&_r(e,t,1,-1)}function z4(t){var e=$r();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sl,lastRenderedState:t},e.queue=t,t=t.dispatch=cI.bind(null,mt,t),[e.memoizedState,t]}function cl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function s7(){return dr().memoizedState}function Tf(t,e,n,r){var i=$r();mt.flags|=t,i.memoizedState=cl(1|e,n,void 0,r===void 0?null:r)}function Mg(t,e,n,r){var i=dr();r=r===void 0?null:r;var a=void 0;if(Bt!==null){var o=Bt.memoizedState;if(a=o.destroy,r!==null&&b5(r,o.deps)){i.memoizedState=cl(e,n,a,r);return}}mt.flags|=t,i.memoizedState=cl(1|e,n,a,r)}function H4(t,e){return Tf(8390656,8,t,e)}function k5(t,e){return Mg(2048,8,t,e)}function c7(t,e){return Mg(4,2,t,e)}function l7(t,e){return Mg(4,4,t,e)}function u7(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function f7(t,e,n){return n=n!=null?n.concat([t]):null,Mg(4,4,u7.bind(null,e,t),n)}function F5(){}function g7(t,e){var n=dr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&b5(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function d7(t,e){var n=dr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&b5(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function p7(t,e,n){return Ro&21?(br(n,e)||(n=Cy(),mt.lanes|=n,Mo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Pn=!0),t.memoizedState=n)}function oI(t,e){var n=He;He=n!==0&&4>n?n:4,t(!0);var r=t2.transition;t2.transition={};try{t(!1),e()}finally{He=n,t2.transition=r}}function h7(){return dr().memoizedState}function sI(t,e,n){var r=pa(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},m7(t))v7(e,n);else if(n=Zy(t,e,n,r),n!==null){var i=On();_r(n,t,r,i),y7(n,e,r)}}function cI(t,e,n){var r=pa(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(m7(t))v7(e,i);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,br(s,o)){var c=e.interleaved;c===null?(i.next=i,M5(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=Zy(t,e,i,r),n!==null&&(i=On(),_r(n,t,r,i),y7(n,e,r))}}function m7(t){var e=t.alternate;return t===mt||e!==null&&e===mt}function v7(t,e){Ic=m1=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function y7(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,p5(t,n)}}var v1={readContext:gr,useCallback:ln,useContext:ln,useEffect:ln,useImperativeHandle:ln,useInsertionEffect:ln,useLayoutEffect:ln,useMemo:ln,useReducer:ln,useRef:ln,useState:ln,useDebugValue:ln,useDeferredValue:ln,useTransition:ln,useMutableSource:ln,useSyncExternalStore:ln,useId:ln,unstable_isNewReconciler:!1},lI={readContext:gr,useCallback:function(t,e){return $r().memoizedState=[t,e===void 0?null:e],t},useContext:gr,useEffect:H4,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Tf(4194308,4,u7.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Tf(4194308,4,t,e)},useInsertionEffect:function(t,e){return Tf(4,2,t,e)},useMemo:function(t,e){var n=$r();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$r();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=sI.bind(null,mt,t),[r.memoizedState,t]},useRef:function(t){var e=$r();return t={current:t},e.memoizedState=t},useState:z4,useDebugValue:F5,useDeferredValue:function(t){return $r().memoizedState=t},useTransition:function(){var t=z4(!1),e=t[0];return t=oI.bind(null,t[1]),$r().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=mt,i=$r();if(ct){if(n===void 0)throw Error(J(407));n=n()}else{if(n=e(),Xt===null)throw Error(J(349));Ro&30||n7(r,e,n)}i.memoizedState=n;var a={value:n,getSnapshot:e};return i.queue=a,H4(i7.bind(null,r,a,t),[t]),r.flags|=2048,cl(9,r7.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=$r(),e=Xt.identifierPrefix;if(ct){var n=mi,r=hi;n=(r&~(1<<32-Vr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ol++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=aI++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},uI={readContext:gr,useCallback:g7,useContext:gr,useEffect:k5,useImperativeHandle:f7,useInsertionEffect:c7,useLayoutEffect:l7,useMemo:d7,useReducer:n2,useRef:s7,useState:function(){return n2(sl)},useDebugValue:F5,useDeferredValue:function(t){var e=dr();return p7(e,Bt.memoizedState,t)},useTransition:function(){var t=n2(sl)[0],e=dr().memoizedState;return[t,e]},useMutableSource:e7,useSyncExternalStore:t7,useId:h7,unstable_isNewReconciler:!1},fI={readContext:gr,useCallback:g7,useContext:gr,useEffect:k5,useImperativeHandle:f7,useInsertionEffect:c7,useLayoutEffect:l7,useMemo:d7,useReducer:r2,useRef:s7,useState:function(){return r2(sl)},useDebugValue:F5,useDeferredValue:function(t){var e=dr();return Bt===null?e.memoizedState=t:p7(e,Bt.memoizedState,t)},useTransition:function(){var t=r2(sl)[0],e=dr().memoizedState;return[t,e]},useMutableSource:e7,useSyncExternalStore:t7,useId:h7,unstable_isNewReconciler:!1};function Sr(t,e){if(t&&t.defaultProps){e=yt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Up(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:yt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Lg={isMounted:function(t){return(t=t._reactInternals)?Ho(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=On(),i=pa(t),a=Ci(r,i);a.payload=e,n!=null&&(a.callback=n),e=ga(t,a,i),e!==null&&(_r(e,t,i,r),yf(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=On(),i=pa(t),a=Ci(r,i);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=ga(t,a,i),e!==null&&(_r(e,t,i,r),yf(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=On(),r=pa(t),i=Ci(n,r);i.tag=2,e!=null&&(i.callback=e),e=ga(t,i,r),e!==null&&(_r(e,t,r,n),yf(e,t,r))}};function j4(t,e,n,r,i,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!el(n,r)||!el(i,a):!0}function C7(t,e,n){var r=!1,i=Ta,a=e.contextType;return typeof a=="object"&&a!==null?a=gr(a):(i=Un(e)?Oo:mn.current,r=e.contextTypes,a=(r=r!=null)?e0(t,i):Ta),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Lg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=a),e}function K4(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Lg.enqueueReplaceState(e,e.state,null)}function Ap(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},L5(t);var a=e.contextType;typeof a=="object"&&a!==null?i.context=gr(a):(a=Un(e)?Oo:mn.current,i.context=e0(t,a)),i.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Up(t,e,a,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Lg.enqueueReplaceState(i,i.state,null),p1(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function i0(t,e){try{var n="",r=e;do n+=AM(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:i,digest:null}}function i2(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Bp(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var gI=typeof WeakMap=="function"?WeakMap:Map;function T7(t,e,n){n=Ci(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){C1||(C1=!0,Yp=r),Bp(t,e)},n}function S7(t,e,n){n=Ci(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Bp(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Bp(t,e),typeof r!="function"&&(da===null?da=new Set([this]):da.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function q4(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new gI;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=DI.bind(null,t,e,n),e.then(t,t))}function X4(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Y4(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ci(-1,1),e.tag=2,ga(n,e,1))),n.lanes|=1),t)}var dI=bi.ReactCurrentOwner,Pn=!1;function Sn(t,e,n,r){e.child=t===null?Yy(e,null,n,r):n0(e,t.child,n,r)}function Z4(t,e,n,r,i){n=n.render;var a=e.ref;return ks(e,i),r=N5(t,e,n,r,a,i),n=P5(),t!==null&&!Pn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Li(t,e,i)):(ct&&n&&x5(e),e.flags|=1,Sn(t,e,r,i),e.child)}function J4(t,e,n,r,i){if(t===null){var a=n.type;return typeof a=="function"&&!H5(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,x7(t,e,a,r,i)):(t=Ef(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&i)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:el,n(o,r)&&t.ref===e.ref)return Li(t,e,i)}return e.flags|=1,t=ha(a,r),t.ref=e.ref,t.return=e,e.child=t}function x7(t,e,n,r,i){if(t!==null){var a=t.memoizedProps;if(el(a,r)&&t.ref===e.ref)if(Pn=!1,e.pendingProps=r=a,(t.lanes&i)!==0)t.flags&131072&&(Pn=!0);else return e.lanes=t.lanes,Li(t,e,i)}return Gp(t,e,n,r,i)}function w7(t,e,n){var r=e.pendingProps,i=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ye(xs,zn),zn|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ye(xs,zn),zn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,Ye(xs,zn),zn|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,Ye(xs,zn),zn|=r;return Sn(t,e,i,n),e.child}function E7(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Gp(t,e,n,r,i){var a=Un(n)?Oo:mn.current;return a=e0(e,a),ks(e,i),n=N5(t,e,n,r,a,i),r=P5(),t!==null&&!Pn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Li(t,e,i)):(ct&&r&&x5(e),e.flags|=1,Sn(t,e,n,i),e.child)}function Q4(t,e,n,r,i){if(Un(n)){var a=!0;l1(e)}else a=!1;if(ks(e,i),e.stateNode===null)Sf(t,e),C7(e,n,r),Ap(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,s=e.memoizedProps;o.props=s;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=gr(l):(l=Un(n)?Oo:mn.current,l=e0(e,l));var f=n.getDerivedStateFromProps,u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";u||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==r||c!==l)&&K4(e,o,r,l),ji=!1;var g=e.memoizedState;o.state=g,p1(e,r,o,i),c=e.memoizedState,s!==r||g!==c||Fn.current||ji?(typeof f=="function"&&(Up(e,n,f,r),c=e.memoizedState),(s=ji||j4(e,n,s,r,g,c,l))?(u||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Jy(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:Sr(e.type,s),o.props=l,u=e.pendingProps,g=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=gr(c):(c=Un(n)?Oo:mn.current,c=e0(e,c));var d=n.getDerivedStateFromProps;(f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==u||g!==c)&&K4(e,o,r,c),ji=!1,g=e.memoizedState,o.state=g,p1(e,r,o,i);var h=e.memoizedState;s!==u||g!==h||Fn.current||ji?(typeof d=="function"&&(Up(e,n,d,r),h=e.memoizedState),(l=ji||j4(e,n,l,r,g,h,c)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,h,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,h,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=h),o.props=r,o.state=h,o.context=c,r=l):(typeof o.componentDidUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return Wp(t,e,n,r,a,i)}function Wp(t,e,n,r,i,a){E7(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&U4(e,n,!1),Li(t,e,a);r=e.stateNode,dI.current=e;var s=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=n0(e,t.child,null,a),e.child=n0(e,null,s,a)):Sn(t,e,s,a),e.memoizedState=r.state,i&&U4(e,n,!0),e.child}function O7(t){var e=t.stateNode;e.pendingContext?F4(t,e.pendingContext,e.pendingContext!==e.context):e.context&&F4(t,e.context,!1),I5(t,e.containerInfo)}function e8(t,e,n,r,i){return t0(),E5(i),e.flags|=256,Sn(t,e,n,r),e.child}var $p={dehydrated:null,treeContext:null,retryLane:0};function zp(t){return{baseLanes:t,cachePool:null,transitions:null}}function D7(t,e,n){var r=e.pendingProps,i=ht.current,a=!1,o=(e.flags&128)!==0,s;if((s=o)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Ye(ht,i&1),t===null)return kp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=_g(o,r,0,null),t=mo(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=zp(n),e.memoizedState=$p,t):U5(e,o));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return pI(t,e,o,r,s,i,n);if(a){a=r.fallback,o=e.mode,i=t.child,s=i.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ha(i,c),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?a=ha(s,a):(a=mo(a,o,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o=o===null?zp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~n,e.memoizedState=$p,r}return a=t.child,t=a.sibling,r=ha(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function U5(t,e){return e=_g({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Cu(t,e,n,r){return r!==null&&E5(r),n0(e,t.child,null,n),t=U5(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function pI(t,e,n,r,i,a,o){if(n)return e.flags&256?(e.flags&=-257,r=i2(Error(J(422))),Cu(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=_g({mode:"visible",children:r.children},i,0,null),a=mo(a,i,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&n0(e,t.child,null,o),e.child.memoizedState=zp(o),e.memoizedState=$p,a);if(!(e.mode&1))return Cu(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,a=Error(J(419)),r=i2(a,r,void 0),Cu(t,e,o,r)}if(s=(o&t.childLanes)!==0,Pn||s){if(r=Xt,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,Mi(t,i),_r(r,t,i,-1))}return z5(),r=i2(Error(J(421))),Cu(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=RI.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,Kn=fa(i.nextSibling),Xn=e,ct=!0,Er=null,t!==null&&(or[sr++]=hi,or[sr++]=mi,or[sr++]=Do,hi=t.id,mi=t.overflow,Do=e),e=U5(e,r.children),e.flags|=4096,e)}function t8(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Fp(t.return,e,n)}function a2(t,e,n,r,i){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function R7(t,e,n){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(Sn(t,e,r.children,n),r=ht.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&t8(t,n,e);else if(t.tag===19)t8(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ye(ht,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&h1(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),a2(e,!1,i,n,a);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&h1(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}a2(e,!0,n,null,a);break;case"together":a2(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Sf(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Li(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Mo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(J(153));if(e.child!==null){for(t=e.child,n=ha(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ha(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function hI(t,e,n){switch(e.tag){case 3:O7(e),t0();break;case 5:Qy(e);break;case 1:Un(e.type)&&l1(e);break;case 4:I5(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Ye(g1,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ye(ht,ht.current&1),e.flags|=128,null):n&e.child.childLanes?D7(t,e,n):(Ye(ht,ht.current&1),t=Li(t,e,n),t!==null?t.sibling:null);Ye(ht,ht.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return R7(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ye(ht,ht.current),r)break;return null;case 22:case 23:return e.lanes=0,w7(t,e,n)}return Li(t,e,n)}var M7,Hp,L7,I7;M7=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Hp=function(){};L7=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,lo(qr.current);var a=null;switch(n){case"input":i=dp(t,i),r=dp(t,r),a=[];break;case"select":i=yt({},i,{value:void 0}),r=yt({},r,{value:void 0}),a=[];break;case"textarea":i=mp(t,i),r=mp(t,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=s1)}yp(n,r);var o;n=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(o in s)s.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Kc.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(s=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&c!==s&&(c!=null||s!=null))if(l==="style")if(s){for(o in s)!s.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&s[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(a=a||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Kc.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&tt("scroll",t),a||s===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(e.updateQueue=l)&&(e.flags|=4)}};I7=function(t,e,n,r){n!==r&&(e.flags|=4)};function X0(t,e){if(!ct)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function un(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function mI(t,e,n){var r=e.pendingProps;switch(w5(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return un(e),null;case 1:return Un(e.type)&&c1(),un(e),null;case 3:return r=e.stateNode,r0(),at(Fn),at(mn),_5(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(vu(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Er!==null&&(Qp(Er),Er=null))),Hp(t,e),un(e),null;case 5:V5(e);var i=lo(al.current);if(n=e.type,t!==null&&e.stateNode!=null)L7(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(J(166));return un(e),null}if(t=lo(qr.current),vu(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[Hr]=e,r[rl]=a,t=(e.mode&1)!==0,n){case"dialog":tt("cancel",r),tt("close",r);break;case"iframe":case"object":case"embed":tt("load",r);break;case"video":case"audio":for(i=0;i<pc.length;i++)tt(pc[i],r);break;case"source":tt("error",r);break;case"img":case"image":case"link":tt("error",r),tt("load",r);break;case"details":tt("toggle",r);break;case"input":u4(r,a),tt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},tt("invalid",r);break;case"textarea":g4(r,a),tt("invalid",r)}yp(n,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];o==="children"?typeof s=="string"?r.textContent!==s&&(a.suppressHydrationWarning!==!0&&mu(r.textContent,s,t),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(a.suppressHydrationWarning!==!0&&mu(r.textContent,s,t),i=["children",""+s]):Kc.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&tt("scroll",r)}switch(n){case"input":cu(r),f4(r,a,!0);break;case"textarea":cu(r),d4(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=s1)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=iy(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Hr]=e,t[rl]=r,M7(t,e,!1,!1),e.stateNode=t;e:{switch(o=Cp(n,r),n){case"dialog":tt("cancel",t),tt("close",t),i=r;break;case"iframe":case"object":case"embed":tt("load",t),i=r;break;case"video":case"audio":for(i=0;i<pc.length;i++)tt(pc[i],t);i=r;break;case"source":tt("error",t),i=r;break;case"img":case"image":case"link":tt("error",t),tt("load",t),i=r;break;case"details":tt("toggle",t),i=r;break;case"input":u4(t,r),i=dp(t,r),tt("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=yt({},r,{value:void 0}),tt("invalid",t);break;case"textarea":g4(t,r),i=mp(t,r),tt("invalid",t);break;default:i=r}yp(n,i),s=i;for(a in s)if(s.hasOwnProperty(a)){var c=s[a];a==="style"?sy(t,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&ay(t,c)):a==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&qc(t,c):typeof c=="number"&&qc(t,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Kc.hasOwnProperty(a)?c!=null&&a==="onScroll"&&tt("scroll",t):c!=null&&c5(t,a,c,o))}switch(n){case"input":cu(t),f4(t,r,!1);break;case"textarea":cu(t),d4(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ca(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?_s(t,!!r.multiple,a,!1):r.defaultValue!=null&&_s(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=s1)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return un(e),null;case 6:if(t&&e.stateNode!=null)I7(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(J(166));if(n=lo(al.current),lo(qr.current),vu(e)){if(r=e.stateNode,n=e.memoizedProps,r[Hr]=e,(a=r.nodeValue!==n)&&(t=Xn,t!==null))switch(t.tag){case 3:mu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&mu(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Hr]=e,e.stateNode=r}return un(e),null;case 13:if(at(ht),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ct&&Kn!==null&&e.mode&1&&!(e.flags&128))qy(),t0(),e.flags|=98560,a=!1;else if(a=vu(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(J(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(J(317));a[Hr]=e}else t0(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;un(e),a=!1}else Er!==null&&(Qp(Er),Er=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ht.current&1?Wt===0&&(Wt=3):z5())),e.updateQueue!==null&&(e.flags|=4),un(e),null);case 4:return r0(),Hp(t,e),t===null&&tl(e.stateNode.containerInfo),un(e),null;case 10:return R5(e.type._context),un(e),null;case 17:return Un(e.type)&&c1(),un(e),null;case 19:if(at(ht),a=e.memoizedState,a===null)return un(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)X0(a,!1);else{if(Wt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=h1(t),o!==null){for(e.flags|=128,X0(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ye(ht,ht.current&1|2),e.child}t=t.sibling}a.tail!==null&&It()>a0&&(e.flags|=128,r=!0,X0(a,!1),e.lanes=4194304)}else{if(!r)if(t=h1(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),X0(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!ct)return un(e),null}else 2*It()-a.renderingStartTime>a0&&n!==1073741824&&(e.flags|=128,r=!0,X0(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(n=a.last,n!==null?n.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=It(),e.sibling=null,n=ht.current,Ye(ht,r?n&1|2:n&1),e):(un(e),null);case 22:case 23:return $5(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?zn&1073741824&&(un(e),e.subtreeFlags&6&&(e.flags|=8192)):un(e),null;case 24:return null;case 25:return null}throw Error(J(156,e.tag))}function vI(t,e){switch(w5(e),e.tag){case 1:return Un(e.type)&&c1(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return r0(),at(Fn),at(mn),_5(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return V5(e),null;case 13:if(at(ht),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(J(340));t0()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return at(ht),null;case 4:return r0(),null;case 10:return R5(e.type._context),null;case 22:case 23:return $5(),null;case 24:return null;default:return null}}var Tu=!1,pn=!1,yI=typeof WeakSet=="function"?WeakSet:Set,re=null;function Ss(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Tt(t,e,r)}else n.current=null}function jp(t,e,n){try{n()}catch(r){Tt(t,e,r)}}var n8=!1;function CI(t,e){if(Lp=i1,t=Py(),S5(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,s=-1,c=-1,l=0,f=0,u=t,g=null;t:for(;;){for(var d;u!==n||i!==0&&u.nodeType!==3||(s=o+i),u!==a||r!==0&&u.nodeType!==3||(c=o+r),u.nodeType===3&&(o+=u.nodeValue.length),(d=u.firstChild)!==null;)g=u,u=d;for(;;){if(u===t)break t;if(g===n&&++l===i&&(s=o),g===a&&++f===r&&(c=o),(d=u.nextSibling)!==null)break;u=g,g=u.parentNode}u=d}n=s===-1||c===-1?null:{start:s,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ip={focusedElem:t,selectionRange:n},i1=!1,re=e;re!==null;)if(e=re,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,re=t;else for(;re!==null;){e=re;try{var h=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var p=h.memoizedProps,m=h.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?p:Sr(e.type,p),m);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(T){Tt(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,re=t;break}re=e.return}return h=n8,n8=!1,h}function Vc(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var a=i.destroy;i.destroy=void 0,a!==void 0&&jp(e,n,a)}i=i.next}while(i!==r)}}function Ig(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Kp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function V7(t){var e=t.alternate;e!==null&&(t.alternate=null,V7(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Hr],delete e[rl],delete e[bp],delete e[tI],delete e[nI])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _7(t){return t.tag===5||t.tag===3||t.tag===4}function r8(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_7(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=s1));else if(r!==4&&(t=t.child,t!==null))for(qp(t,e,n),t=t.sibling;t!==null;)qp(t,e,n),t=t.sibling}function Xp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Xp(t,e,n),t=t.sibling;t!==null;)Xp(t,e,n),t=t.sibling}var Qt=null,wr=!1;function ki(t,e,n){for(n=n.child;n!==null;)b7(t,e,n),n=n.sibling}function b7(t,e,n){if(Kr&&typeof Kr.onCommitFiberUnmount=="function")try{Kr.onCommitFiberUnmount(xg,n)}catch{}switch(n.tag){case 5:pn||Ss(n,e);case 6:var r=Qt,i=wr;Qt=null,ki(t,e,n),Qt=r,wr=i,Qt!==null&&(wr?(t=Qt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Qt.removeChild(n.stateNode));break;case 18:Qt!==null&&(wr?(t=Qt,n=n.stateNode,t.nodeType===8?Jd(t.parentNode,n):t.nodeType===1&&Jd(t,n),Jc(t)):Jd(Qt,n.stateNode));break;case 4:r=Qt,i=wr,Qt=n.stateNode.containerInfo,wr=!0,ki(t,e,n),Qt=r,wr=i;break;case 0:case 11:case 14:case 15:if(!pn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&jp(n,e,o),i=i.next}while(i!==r)}ki(t,e,n);break;case 1:if(!pn&&(Ss(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Tt(n,e,s)}ki(t,e,n);break;case 21:ki(t,e,n);break;case 22:n.mode&1?(pn=(r=pn)||n.memoizedState!==null,ki(t,e,n),pn=r):ki(t,e,n);break;default:ki(t,e,n)}}function i8(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new yI),e.forEach(function(r){var i=MI.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function mr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=t,o=e,s=o;e:for(;s!==null;){switch(s.tag){case 5:Qt=s.stateNode,wr=!1;break e;case 3:Qt=s.stateNode.containerInfo,wr=!0;break e;case 4:Qt=s.stateNode.containerInfo,wr=!0;break e}s=s.return}if(Qt===null)throw Error(J(160));b7(a,o,i),Qt=null,wr=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Tt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)N7(e,t),e=e.sibling}function N7(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(mr(e,t),Ar(t),r&4){try{Vc(3,t,t.return),Ig(3,t)}catch(p){Tt(t,t.return,p)}try{Vc(5,t,t.return)}catch(p){Tt(t,t.return,p)}}break;case 1:mr(e,t),Ar(t),r&512&&n!==null&&Ss(n,n.return);break;case 5:if(mr(e,t),Ar(t),r&512&&n!==null&&Ss(n,n.return),t.flags&32){var i=t.stateNode;try{qc(i,"")}catch(p){Tt(t,t.return,p)}}if(r&4&&(i=t.stateNode,i!=null)){var a=t.memoizedProps,o=n!==null?n.memoizedProps:a,s=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{s==="input"&&a.type==="radio"&&a.name!=null&&ny(i,a),Cp(s,o);var l=Cp(s,a);for(o=0;o<c.length;o+=2){var f=c[o],u=c[o+1];f==="style"?sy(i,u):f==="dangerouslySetInnerHTML"?ay(i,u):f==="children"?qc(i,u):c5(i,f,u,l)}switch(s){case"input":pp(i,a);break;case"textarea":ry(i,a);break;case"select":var g=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var d=a.value;d!=null?_s(i,!!a.multiple,d,!1):g!==!!a.multiple&&(a.defaultValue!=null?_s(i,!!a.multiple,a.defaultValue,!0):_s(i,!!a.multiple,a.multiple?[]:"",!1))}i[rl]=a}catch(p){Tt(t,t.return,p)}}break;case 6:if(mr(e,t),Ar(t),r&4){if(t.stateNode===null)throw Error(J(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(p){Tt(t,t.return,p)}}break;case 3:if(mr(e,t),Ar(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Jc(e.containerInfo)}catch(p){Tt(t,t.return,p)}break;case 4:mr(e,t),Ar(t);break;case 13:mr(e,t),Ar(t),i=t.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(G5=It())),r&4&&i8(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(pn=(l=pn)||f,mr(e,t),pn=l):mr(e,t),Ar(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!f&&t.mode&1)for(re=t,f=t.child;f!==null;){for(u=re=f;re!==null;){switch(g=re,d=g.child,g.tag){case 0:case 11:case 14:case 15:Vc(4,g,g.return);break;case 1:Ss(g,g.return);var h=g.stateNode;if(typeof h.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,h.props=e.memoizedProps,h.state=e.memoizedState,h.componentWillUnmount()}catch(p){Tt(r,n,p)}}break;case 5:Ss(g,g.return);break;case 22:if(g.memoizedState!==null){o8(u);continue}}d!==null?(d.return=g,re=d):o8(u)}f=f.sibling}e:for(f=null,u=t;;){if(u.tag===5){if(f===null){f=u;try{i=u.stateNode,l?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(s=u.stateNode,c=u.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=oy("display",o))}catch(p){Tt(t,t.return,p)}}}else if(u.tag===6){if(f===null)try{u.stateNode.nodeValue=l?"":u.memoizedProps}catch(p){Tt(t,t.return,p)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;f===u&&(f=null),u=u.return}f===u&&(f=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:mr(e,t),Ar(t),r&4&&i8(t);break;case 21:break;default:mr(e,t),Ar(t)}}function Ar(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(_7(n)){var r=n;break e}n=n.return}throw Error(J(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(qc(i,""),r.flags&=-33);var a=r8(t);Xp(t,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,s=r8(t);qp(t,s,o);break;default:throw Error(J(161))}}catch(c){Tt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function TI(t,e,n){re=t,P7(t)}function P7(t,e,n){for(var r=(t.mode&1)!==0;re!==null;){var i=re,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Tu;if(!o){var s=i.alternate,c=s!==null&&s.memoizedState!==null||pn;s=Tu;var l=pn;if(Tu=o,(pn=c)&&!l)for(re=i;re!==null;)o=re,c=o.child,o.tag===22&&o.memoizedState!==null?s8(i):c!==null?(c.return=o,re=c):s8(i);for(;a!==null;)re=a,P7(a),a=a.sibling;re=i,Tu=s,pn=l}a8(t)}else i.subtreeFlags&8772&&a!==null?(a.return=i,re=a):a8(t)}}function a8(t){for(;re!==null;){var e=re;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pn||Ig(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!pn)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Sr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&$4(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}$4(e,o,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var f=l.memoizedState;if(f!==null){var u=f.dehydrated;u!==null&&Jc(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}pn||e.flags&512&&Kp(e)}catch(g){Tt(e,e.return,g)}}if(e===t){re=null;break}if(n=e.sibling,n!==null){n.return=e.return,re=n;break}re=e.return}}function o8(t){for(;re!==null;){var e=re;if(e===t){re=null;break}var n=e.sibling;if(n!==null){n.return=e.return,re=n;break}re=e.return}}function s8(t){for(;re!==null;){var e=re;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ig(4,e)}catch(c){Tt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){Tt(e,i,c)}}var a=e.return;try{Kp(e)}catch(c){Tt(e,a,c)}break;case 5:var o=e.return;try{Kp(e)}catch(c){Tt(e,o,c)}}}catch(c){Tt(e,e.return,c)}if(e===t){re=null;break}var s=e.sibling;if(s!==null){s.return=e.return,re=s;break}re=e.return}}var SI=Math.ceil,y1=bi.ReactCurrentDispatcher,A5=bi.ReactCurrentOwner,ur=bi.ReactCurrentBatchConfig,Ue=0,Xt=null,Ut=null,on=0,zn=0,xs=Ra(0),Wt=0,ll=null,Mo=0,Vg=0,B5=0,_c=null,Nn=null,G5=0,a0=1/0,li=null,C1=!1,Yp=null,da=null,Su=!1,na=null,T1=0,bc=0,Zp=null,xf=-1,wf=0;function On(){return Ue&6?It():xf!==-1?xf:xf=It()}function pa(t){return t.mode&1?Ue&2&&on!==0?on&-on:iI.transition!==null?(wf===0&&(wf=Cy()),wf):(t=He,t!==0||(t=window.event,t=t===void 0?16:Dy(t.type)),t):1}function _r(t,e,n,r){if(50<bc)throw bc=0,Zp=null,Error(J(185));Nl(t,n,r),(!(Ue&2)||t!==Xt)&&(t===Xt&&(!(Ue&2)&&(Vg|=n),Wt===4&&Yi(t,on)),An(t,r),n===1&&Ue===0&&!(e.mode&1)&&(a0=It()+500,Rg&&Ma()))}function An(t,e){var n=t.callbackNode;iL(t,e);var r=r1(t,t===Xt?on:0);if(r===0)n!==null&&m4(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&m4(n),e===1)t.tag===0?rI(c8.bind(null,t)):Hy(c8.bind(null,t)),QL(function(){!(Ue&6)&&Ma()}),n=null;else{switch(Ty(r)){case 1:n=d5;break;case 4:n=vy;break;case 16:n=n1;break;case 536870912:n=yy;break;default:n=n1}n=$7(n,k7.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function k7(t,e){if(xf=-1,wf=0,Ue&6)throw Error(J(327));var n=t.callbackNode;if(Fs()&&t.callbackNode!==n)return null;var r=r1(t,t===Xt?on:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=S1(t,r);else{e=r;var i=Ue;Ue|=2;var a=U7();(Xt!==t||on!==e)&&(li=null,a0=It()+500,ho(t,e));do try{EI();break}catch(s){F7(t,s)}while(!0);D5(),y1.current=a,Ue=i,Ut!==null?e=0:(Xt=null,on=0,e=Wt)}if(e!==0){if(e===2&&(i=Ep(t),i!==0&&(r=i,e=Jp(t,i))),e===1)throw n=ll,ho(t,0),Yi(t,r),An(t,It()),n;if(e===6)Yi(t,r);else{if(i=t.current.alternate,!(r&30)&&!xI(i)&&(e=S1(t,r),e===2&&(a=Ep(t),a!==0&&(r=a,e=Jp(t,a))),e===1))throw n=ll,ho(t,0),Yi(t,r),An(t,It()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(J(345));case 2:Ya(t,Nn,li);break;case 3:if(Yi(t,r),(r&130023424)===r&&(e=G5+500-It(),10<e)){if(r1(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){On(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=_p(Ya.bind(null,t,Nn,li),e);break}Ya(t,Nn,li);break;case 4:if(Yi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Vr(r);a=1<<o,o=e[o],o>i&&(i=o),r&=~a}if(r=i,r=It()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*SI(r/1960))-r,10<r){t.timeoutHandle=_p(Ya.bind(null,t,Nn,li),r);break}Ya(t,Nn,li);break;case 5:Ya(t,Nn,li);break;default:throw Error(J(329))}}}return An(t,It()),t.callbackNode===n?k7.bind(null,t):null}function Jp(t,e){var n=_c;return t.current.memoizedState.isDehydrated&&(ho(t,e).flags|=256),t=S1(t,e),t!==2&&(e=Nn,Nn=n,e!==null&&Qp(e)),t}function Qp(t){Nn===null?Nn=t:Nn.push.apply(Nn,t)}function xI(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!br(a(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Yi(t,e){for(e&=~B5,e&=~Vg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Vr(e),r=1<<n;t[n]=-1,e&=~r}}function c8(t){if(Ue&6)throw Error(J(327));Fs();var e=r1(t,0);if(!(e&1))return An(t,It()),null;var n=S1(t,e);if(t.tag!==0&&n===2){var r=Ep(t);r!==0&&(e=r,n=Jp(t,r))}if(n===1)throw n=ll,ho(t,0),Yi(t,e),An(t,It()),n;if(n===6)throw Error(J(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ya(t,Nn,li),An(t,It()),null}function W5(t,e){var n=Ue;Ue|=1;try{return t(e)}finally{Ue=n,Ue===0&&(a0=It()+500,Rg&&Ma())}}function Lo(t){na!==null&&na.tag===0&&!(Ue&6)&&Fs();var e=Ue;Ue|=1;var n=ur.transition,r=He;try{if(ur.transition=null,He=1,t)return t()}finally{He=r,ur.transition=n,Ue=e,!(Ue&6)&&Ma()}}function $5(){zn=xs.current,at(xs)}function ho(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,JL(n)),Ut!==null)for(n=Ut.return;n!==null;){var r=n;switch(w5(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&c1();break;case 3:r0(),at(Fn),at(mn),_5();break;case 5:V5(r);break;case 4:r0();break;case 13:at(ht);break;case 19:at(ht);break;case 10:R5(r.type._context);break;case 22:case 23:$5()}n=n.return}if(Xt=t,Ut=t=ha(t.current,null),on=zn=e,Wt=0,ll=null,B5=Vg=Mo=0,Nn=_c=null,co!==null){for(e=0;e<co.length;e++)if(n=co[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}co=null}return t}function F7(t,e){do{var n=Ut;try{if(D5(),Cf.current=v1,m1){for(var r=mt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}m1=!1}if(Ro=0,Kt=Bt=mt=null,Ic=!1,ol=0,A5.current=null,n===null||n.return===null){Wt=1,ll=e,Ut=null;break}e:{var a=t,o=n.return,s=n,c=e;if(e=on,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,f=s,u=f.tag;if(!(f.mode&1)&&(u===0||u===11||u===15)){var g=f.alternate;g?(f.updateQueue=g.updateQueue,f.memoizedState=g.memoizedState,f.lanes=g.lanes):(f.updateQueue=null,f.memoizedState=null)}var d=X4(o);if(d!==null){d.flags&=-257,Y4(d,o,s,a,e),d.mode&1&&q4(a,l,e),e=d,c=l;var h=e.updateQueue;if(h===null){var p=new Set;p.add(c),e.updateQueue=p}else h.add(c);break e}else{if(!(e&1)){q4(a,l,e),z5();break e}c=Error(J(426))}}else if(ct&&s.mode&1){var m=X4(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),Y4(m,o,s,a,e),E5(i0(c,s));break e}}a=c=i0(c,s),Wt!==4&&(Wt=2),_c===null?_c=[a]:_c.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var v=T7(a,c,e);W4(a,v);break e;case 1:s=c;var y=a.type,C=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(da===null||!da.has(C)))){a.flags|=65536,e&=-e,a.lanes|=e;var T=S7(a,s,e);W4(a,T);break e}}a=a.return}while(a!==null)}B7(n)}catch(S){e=S,Ut===n&&n!==null&&(Ut=n=n.return);continue}break}while(!0)}function U7(){var t=y1.current;return y1.current=v1,t===null?v1:t}function z5(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),Xt===null||!(Mo&268435455)&&!(Vg&268435455)||Yi(Xt,on)}function S1(t,e){var n=Ue;Ue|=2;var r=U7();(Xt!==t||on!==e)&&(li=null,ho(t,e));do try{wI();break}catch(i){F7(t,i)}while(!0);if(D5(),Ue=n,y1.current=r,Ut!==null)throw Error(J(261));return Xt=null,on=0,Wt}function wI(){for(;Ut!==null;)A7(Ut)}function EI(){for(;Ut!==null&&!XM();)A7(Ut)}function A7(t){var e=W7(t.alternate,t,zn);t.memoizedProps=t.pendingProps,e===null?B7(t):Ut=e,A5.current=null}function B7(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=vI(n,e),n!==null){n.flags&=32767,Ut=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Wt=6,Ut=null;return}}else if(n=mI(n,e,zn),n!==null){Ut=n;return}if(e=e.sibling,e!==null){Ut=e;return}Ut=e=t}while(e!==null);Wt===0&&(Wt=5)}function Ya(t,e,n){var r=He,i=ur.transition;try{ur.transition=null,He=1,OI(t,e,n,r)}finally{ur.transition=i,He=r}return null}function OI(t,e,n,r){do Fs();while(na!==null);if(Ue&6)throw Error(J(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(J(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(aL(t,a),t===Xt&&(Ut=Xt=null,on=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Su||(Su=!0,$7(n1,function(){return Fs(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=ur.transition,ur.transition=null;var o=He;He=1;var s=Ue;Ue|=4,A5.current=null,CI(t,n),N7(n,t),HL(Ip),i1=!!Lp,Ip=Lp=null,t.current=n,TI(n),YM(),Ue=s,He=o,ur.transition=a}else t.current=n;if(Su&&(Su=!1,na=t,T1=i),a=t.pendingLanes,a===0&&(da=null),QM(n.stateNode),An(t,It()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(C1)throw C1=!1,t=Yp,Yp=null,t;return T1&1&&t.tag!==0&&Fs(),a=t.pendingLanes,a&1?t===Zp?bc++:(bc=0,Zp=t):bc=0,Ma(),null}function Fs(){if(na!==null){var t=Ty(T1),e=ur.transition,n=He;try{if(ur.transition=null,He=16>t?16:t,na===null)var r=!1;else{if(t=na,na=null,T1=0,Ue&6)throw Error(J(331));var i=Ue;for(Ue|=4,re=t.current;re!==null;){var a=re,o=a.child;if(re.flags&16){var s=a.deletions;if(s!==null){for(var c=0;c<s.length;c++){var l=s[c];for(re=l;re!==null;){var f=re;switch(f.tag){case 0:case 11:case 15:Vc(8,f,a)}var u=f.child;if(u!==null)u.return=f,re=u;else for(;re!==null;){f=re;var g=f.sibling,d=f.return;if(V7(f),f===l){re=null;break}if(g!==null){g.return=d,re=g;break}re=d}}}var h=a.alternate;if(h!==null){var p=h.child;if(p!==null){h.child=null;do{var m=p.sibling;p.sibling=null,p=m}while(p!==null)}}re=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,re=o;else e:for(;re!==null;){if(a=re,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Vc(9,a,a.return)}var v=a.sibling;if(v!==null){v.return=a.return,re=v;break e}re=a.return}}var y=t.current;for(re=y;re!==null;){o=re;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,re=C;else e:for(o=y;re!==null;){if(s=re,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Ig(9,s)}}catch(S){Tt(s,s.return,S)}if(s===o){re=null;break e}var T=s.sibling;if(T!==null){T.return=s.return,re=T;break e}re=s.return}}if(Ue=i,Ma(),Kr&&typeof Kr.onPostCommitFiberRoot=="function")try{Kr.onPostCommitFiberRoot(xg,t)}catch{}r=!0}return r}finally{He=n,ur.transition=e}}return!1}function l8(t,e,n){e=i0(n,e),e=T7(t,e,1),t=ga(t,e,1),e=On(),t!==null&&(Nl(t,1,e),An(t,e))}function Tt(t,e,n){if(t.tag===3)l8(t,t,n);else for(;e!==null;){if(e.tag===3){l8(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(da===null||!da.has(r))){t=i0(n,t),t=S7(e,t,1),e=ga(e,t,1),t=On(),e!==null&&(Nl(e,1,t),An(e,t));break}}e=e.return}}function DI(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=On(),t.pingedLanes|=t.suspendedLanes&n,Xt===t&&(on&n)===n&&(Wt===4||Wt===3&&(on&130023424)===on&&500>It()-G5?ho(t,0):B5|=n),An(t,e)}function G7(t,e){e===0&&(t.mode&1?(e=fu,fu<<=1,!(fu&130023424)&&(fu=4194304)):e=1);var n=On();t=Mi(t,e),t!==null&&(Nl(t,e,n),An(t,n))}function RI(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),G7(t,n)}function MI(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(e),G7(t,n)}var W7;W7=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Fn.current)Pn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Pn=!1,hI(t,e,n);Pn=!!(t.flags&131072)}else Pn=!1,ct&&e.flags&1048576&&jy(e,f1,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Sf(t,e),t=e.pendingProps;var i=e0(e,mn.current);ks(e,n),i=N5(null,e,r,t,i,n);var a=P5();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Un(r)?(a=!0,l1(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,L5(e),i.updater=Lg,e.stateNode=i,i._reactInternals=e,Ap(e,r,t,n),e=Wp(null,e,r,!0,a,n)):(e.tag=0,ct&&a&&x5(e),Sn(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Sf(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=II(r),t=Sr(r,t),i){case 0:e=Gp(null,e,r,t,n);break e;case 1:e=Q4(null,e,r,t,n);break e;case 11:e=Z4(null,e,r,t,n);break e;case 14:e=J4(null,e,r,Sr(r.type,t),n);break e}throw Error(J(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Sr(r,i),Gp(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Sr(r,i),Q4(t,e,r,i,n);case 3:e:{if(O7(e),t===null)throw Error(J(387));r=e.pendingProps,a=e.memoizedState,i=a.element,Jy(t,e),p1(e,r,null,n);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=i0(Error(J(423)),e),e=e8(t,e,r,n,i);break e}else if(r!==i){i=i0(Error(J(424)),e),e=e8(t,e,r,n,i);break e}else for(Kn=fa(e.stateNode.containerInfo.firstChild),Xn=e,ct=!0,Er=null,n=Yy(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(t0(),r===i){e=Li(t,e,n);break e}Sn(t,e,r,n)}e=e.child}return e;case 5:return Qy(e),t===null&&kp(e),r=e.type,i=e.pendingProps,a=t!==null?t.memoizedProps:null,o=i.children,Vp(r,i)?o=null:a!==null&&Vp(r,a)&&(e.flags|=32),E7(t,e),Sn(t,e,o,n),e.child;case 6:return t===null&&kp(e),null;case 13:return D7(t,e,n);case 4:return I5(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=n0(e,null,r,n):Sn(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Sr(r,i),Z4(t,e,r,i,n);case 7:return Sn(t,e,e.pendingProps,n),e.child;case 8:return Sn(t,e,e.pendingProps.children,n),e.child;case 12:return Sn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,Ye(g1,r._currentValue),r._currentValue=o,a!==null)if(br(a.value,o)){if(a.children===i.children&&!Fn.current){e=Li(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var s=a.dependencies;if(s!==null){o=a.child;for(var c=s.firstContext;c!==null;){if(c.context===r){if(a.tag===1){c=Ci(-1,n&-n),c.tag=2;var l=a.updateQueue;if(l!==null){l=l.shared;var f=l.pending;f===null?c.next=c:(c.next=f.next,f.next=c),l.pending=c}}a.lanes|=n,c=a.alternate,c!==null&&(c.lanes|=n),Fp(a.return,n,e),s.lanes|=n;break}c=c.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(J(341));o.lanes|=n,s=o.alternate,s!==null&&(s.lanes|=n),Fp(o,n,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}Sn(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ks(e,n),i=gr(i),r=r(i),e.flags|=1,Sn(t,e,r,n),e.child;case 14:return r=e.type,i=Sr(r,e.pendingProps),i=Sr(r.type,i),J4(t,e,r,i,n);case 15:return x7(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Sr(r,i),Sf(t,e),e.tag=1,Un(r)?(t=!0,l1(e)):t=!1,ks(e,n),C7(e,r,i),Ap(e,r,i,n),Wp(null,e,r,!0,t,n);case 19:return R7(t,e,n);case 22:return w7(t,e,n)}throw Error(J(156,e.tag))};function $7(t,e){return my(t,e)}function LI(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lr(t,e,n,r){return new LI(t,e,n,r)}function H5(t){return t=t.prototype,!(!t||!t.isReactComponent)}function II(t){if(typeof t=="function")return H5(t)?1:0;if(t!=null){if(t=t.$$typeof,t===u5)return 11;if(t===f5)return 14}return 2}function ha(t,e){var n=t.alternate;return n===null?(n=lr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ef(t,e,n,r,i,a){var o=2;if(r=t,typeof t=="function")H5(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case gs:return mo(n.children,i,a,e);case l5:o=8,i|=8;break;case lp:return t=lr(12,n,e,i|2),t.elementType=lp,t.lanes=a,t;case up:return t=lr(13,n,e,i),t.elementType=up,t.lanes=a,t;case fp:return t=lr(19,n,e,i),t.elementType=fp,t.lanes=a,t;case Q9:return _g(n,i,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Z9:o=10;break e;case J9:o=9;break e;case u5:o=11;break e;case f5:o=14;break e;case Hi:o=16,r=null;break e}throw Error(J(130,t==null?t:typeof t,""))}return e=lr(o,n,e,i),e.elementType=t,e.type=r,e.lanes=a,e}function mo(t,e,n,r){return t=lr(7,t,r,e),t.lanes=n,t}function _g(t,e,n,r){return t=lr(22,t,r,e),t.elementType=Q9,t.lanes=n,t.stateNode={isHidden:!1},t}function o2(t,e,n){return t=lr(6,t,null,e),t.lanes=n,t}function s2(t,e,n){return e=lr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function VI(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gd(0),this.expirationTimes=Gd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gd(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function j5(t,e,n,r,i,a,o,s,c){return t=new VI(t,e,n,s,c),e===1?(e=1,a===!0&&(e|=8)):e=0,a=lr(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},L5(a),t}function _I(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fs,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function z7(t){if(!t)return Ta;t=t._reactInternals;e:{if(Ho(t)!==t||t.tag!==1)throw Error(J(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Un(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(J(171))}if(t.tag===1){var n=t.type;if(Un(n))return zy(t,n,e)}return e}function H7(t,e,n,r,i,a,o,s,c){return t=j5(n,r,!0,t,i,a,o,s,c),t.context=z7(null),n=t.current,r=On(),i=pa(n),a=Ci(r,i),a.callback=e??null,ga(n,a,i),t.current.lanes=i,Nl(t,i,r),An(t,r),t}function bg(t,e,n,r){var i=e.current,a=On(),o=pa(i);return n=z7(n),e.context===null?e.context=n:e.pendingContext=n,e=Ci(a,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ga(i,e,o),t!==null&&(_r(t,i,o,a),yf(t,i,o)),o}function x1(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function u8(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function K5(t,e){u8(t,e),(t=t.alternate)&&u8(t,e)}function bI(){return null}var j7=typeof reportError=="function"?reportError:function(t){console.error(t)};function q5(t){this._internalRoot=t}Ng.prototype.render=q5.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(J(409));bg(t,e,null,null)};Ng.prototype.unmount=q5.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Lo(function(){bg(null,t,null,null)}),e[Ri]=null}};function Ng(t){this._internalRoot=t}Ng.prototype.unstable_scheduleHydration=function(t){if(t){var e=wy();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Xi.length&&e!==0&&e<Xi[n].priority;n++);Xi.splice(n,0,t),n===0&&Oy(t)}};function X5(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Pg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function f8(){}function NI(t,e,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var l=x1(o);a.call(l)}}var o=H7(e,r,t,0,null,!1,!1,"",f8);return t._reactRootContainer=o,t[Ri]=o.current,tl(t.nodeType===8?t.parentNode:t),Lo(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var l=x1(c);s.call(l)}}var c=j5(t,0,!1,null,null,!1,!1,"",f8);return t._reactRootContainer=c,t[Ri]=c.current,tl(t.nodeType===8?t.parentNode:t),Lo(function(){bg(e,c,n,r)}),c}function kg(t,e,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var s=i;i=function(){var c=x1(o);s.call(c)}}bg(e,o,t,i)}else o=NI(n,e,t,i,r);return x1(o)}Sy=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=dc(e.pendingLanes);n!==0&&(p5(e,n|1),An(e,It()),!(Ue&6)&&(a0=It()+500,Ma()))}break;case 13:Lo(function(){var r=Mi(t,1);if(r!==null){var i=On();_r(r,t,1,i)}}),K5(t,1)}};h5=function(t){if(t.tag===13){var e=Mi(t,134217728);if(e!==null){var n=On();_r(e,t,134217728,n)}K5(t,134217728)}};xy=function(t){if(t.tag===13){var e=pa(t),n=Mi(t,e);if(n!==null){var r=On();_r(n,t,e,r)}K5(t,e)}};wy=function(){return He};Ey=function(t,e){var n=He;try{return He=t,e()}finally{He=n}};Sp=function(t,e,n){switch(e){case"input":if(pp(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Dg(r);if(!i)throw Error(J(90));ty(r),pp(r,i)}}}break;case"textarea":ry(t,n);break;case"select":e=n.value,e!=null&&_s(t,!!n.multiple,e,!1)}};uy=W5;fy=Lo;var PI={usingClientEntryPoint:!1,Events:[kl,ms,Dg,cy,ly,W5]},Y0={findFiberByHostInstance:so,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kI={bundleType:Y0.bundleType,version:Y0.version,rendererPackageName:Y0.rendererPackageName,rendererConfig:Y0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=py(t),t===null?null:t.stateNode},findFiberByHostInstance:Y0.findFiberByHostInstance||bI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xu.isDisabled&&xu.supportsFiber)try{xg=xu.inject(kI),Kr=xu}catch{}}Jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=PI;Jn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!X5(e))throw Error(J(200));return _I(t,e,null,n)};Jn.createRoot=function(t,e){if(!X5(t))throw Error(J(299));var n=!1,r="",i=j7;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=j5(t,1,!1,null,null,n,!1,r,i),t[Ri]=e.current,tl(t.nodeType===8?t.parentNode:t),new q5(e)};Jn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(J(188)):(t=Object.keys(t).join(","),Error(J(268,t)));return t=py(e),t=t===null?null:t.stateNode,t};Jn.flushSync=function(t){return Lo(t)};Jn.hydrate=function(t,e,n){if(!Pg(e))throw Error(J(200));return kg(null,t,e,!0,n)};Jn.hydrateRoot=function(t,e,n){if(!X5(t))throw Error(J(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",o=j7;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=H7(e,null,t,1,n??null,i,!1,a,o),t[Ri]=e.current,tl(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Ng(e)};Jn.render=function(t,e,n){if(!Pg(e))throw Error(J(200));return kg(null,t,e,!1,n)};Jn.unmountComponentAtNode=function(t){if(!Pg(t))throw Error(J(40));return t._reactRootContainer?(Lo(function(){kg(null,null,t,!1,function(){t._reactRootContainer=null,t[Ri]=null})}),!0):!1};Jn.unstable_batchedUpdates=W5;Jn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Pg(n))throw Error(J(200));if(t==null||t._reactInternals===void 0)throw Error(J(38));return kg(t,e,n,!1,r)};Jn.version="18.3.1-next-f1338f8080-20240426";function K7(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(K7)}catch(t){console.error(t)}}K7(),K9.exports=Jn;var FI=K9.exports,q7,g8=FI;q7=g8.createRoot,g8.hydrateRoot;class UI{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,n){const r=i=>{this.removeEventListener(e,r),n.call(this,i)};this.addEventListener(e,r)}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}addEventListenerDebounced(e,n,r){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[n]){const a=o=>{i[n]&&clearTimeout(i[n].timeoutId),i[n].timeoutId=setTimeout(()=>{n.call(this,o)},r)};i[n]={original:n,handle:a,timeoutId:null},this.addEventListener(e,a)}}removeEventListenerDebounced(e,n){var r;if((r=this.debouncedListeners[e])!=null&&r[n]){const i=this.debouncedListeners[e][n];this.removeEventListener(e,i.handle),clearTimeout(i.timeoutId),delete this.debouncedListeners[e][n]}}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],i=r.length;for(let a=0;a<i;a++)if(r[a]===n){r.splice(a,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const n=this.listeners[e.type].slice(),r=n.length;for(let i=0;i<r;i++)try{n[i].call(this,e)}catch(a){console.error(`error in event listener of type:  ${e.type}`,a)}return!e.defaultPrevented}}const Y=new UI;function Z(t=Y,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t==null?void 0:t.dispatchEvent(r)}function Dn(t){const e=t.indexOf(":");return t.substring(e+1)}var X;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED"})(X||(X={}));var ye;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(ye||(ye={}));var lt;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(lt||(lt={}));var vi;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(vi||(vi={}));const Of={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},AI={OFF:0,NORMALIZED:1,RAW:2};var X7={BlendMode:Of,FilterMode:AI};const{BlendMode:wu}=X7;var w1;(function(t){t[t.COMPOSITE=wu.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=wu.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=wu.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=wu.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND"})(w1||(w1={}));var o0;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition"})(o0||(o0={}));var Ii;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE"})(Ii||(Ii={}));var eh;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(eh||(eh={}));const BI=eh;var Ti;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID"})(Ti||(Ti={}));var th;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(th||(th={}));const GI=th;var nh;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated"})(nh||(nh={}));const WI=nh;var xn;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(xn||(xn={}));var qn;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(qn||(qn={}));var ul;(function(t){t.FRAME="f",t.SECOND="s"})(ul||(ul={}));const $I=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return ul}},Symbol.toStringTag,{value:"Module"}));var En;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.WADO_WEB_CLIENT="wadoWebClient"})(En||(En={}));var rh;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(rh||(rh={}));const La=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:w1,CalibrationTypes:WI,ContourType:BI,DynamicOperatorType:GI,Events:X,get GenerateImageType(){return rh},GeometryType:Ii,ImageQualityStatus:qn,InterpolationType:vi,MetadataModules:En,OrientationAxis:o0,RequestType:ye,VOILUTFunctionType:Ti,VideoEnums:$I,ViewportStatus:xn,ViewportType:lt},Symbol.toStringTag,{value:"Module"})),zI=1073741824;class HI{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*zI,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{const n=this.getBytesAvailable(),r=Array.from(this._imageCache.values()).reduce((a,o)=>o.sharedCacheKey?a:a+o.sizeInBytes,0);return n+r>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,n=!1)=>{const r=this._imageCache.get(e);if(!r)return;if(r.sharedCacheKey&&!n)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=r;i!=null&&i.cancelFn&&i.cancelFn(),i!=null&&i.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e);if(!n)return;const{volumeLoadObject:r,volume:i}=n;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),r.cancelFn&&r.cancelFn(),i.imageIds&&i.imageIds.forEach(a=>{const o=this._imageCache.get(a);o&&o.sharedCacheKey===e&&(o.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n,{force:!0}),Z(Y,X.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),Z(Y,X.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.putGeometryLoadObject=(e,n)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(n.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const r={loaded:!1,geometryId:e,geometryLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,r),n.promise.then(i=>{try{this._putGeometryCommon(e,i,r)}catch(a){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,a),a}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(!n)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(n.sizeInBytes);const r={geometry:n,geometryId:e};Z(Y,X.GEOMETRY_CACHE_GEOMETRY_REMOVED,r),this._decacheGeometry(e)},this._decacheGeometry=e=>{const n=this._geometryCache.get(e);if(!n)return;const{geometryLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImage=(e,n=qn.FAR_REPLICATE)=>{var i;if(e===void 0)throw new Error("getImage: imageId must not be undefined");const r=this._imageCache.get(e);if(r&&(r.timeStamp=Date.now(),!(((i=r.image)==null?void 0:i.imageQualityStatus)<n)))return r.image},this.getVolume=(e,n=!1)=>{var i;if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const r=this._volumeCache.get(e);return r?(r.timeStamp=Date.now(),r.volume):n?(i=[...this._volumeCache.values()].find(a=>a.volumeId.includes(e)))==null?void 0:i.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(r=>r.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:n=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(!r)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,n),this.incrementImageCacheSize(-r.sizeInBytes);const i={image:r,imageId:e};Z(Y,X.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const r={volume:n,volumeId:e};Z(Y,X.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometryLoadObject}}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function a(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}i.sort(a);const o=i.map(c=>c.imageId);let s=o;n&&(s=o.filter(c=>!n.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),Z(Y,X.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r;for(const c of o)if(this.removeImageLoadObject(c),Z(Y,X.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r}_putImageCommon(e,n,r){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!n){console.warn("Image is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(X.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.image=n,r.sizeInBytes=n.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const i={image:r};Z(Y,X.IMAGE_CACHE_IMAGE_ADDED,i),r.sharedCacheKey=n.sharedCacheKey}async putImageLoadObject(e,n){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const r=this._imageCache.get(e);if(r!=null&&r.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...r,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),this._imageCache.set(e,i),n.promise.then(a=>{try{this._putImageCommon(e,a,i)}catch(o){throw console.debug(`Error in _putImageCommon for image ${e}:`,o),o}}).catch(a=>{throw console.debug(`Error caching image ${e}:`,a),this._imageCache.delete(e),a})}putImageSync(e,n){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,r);try{this._putImageCommon(e,n,r)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){const n=Array.from(this._volumeCache.keys()),r=Dn(e);for(const i of n){const a=this._volumeCache.get(i);if(!a)return;const{volume:o}=a;if(!o.imageIds.length)return;const s=o.getImageURIIndex(r);if(s>-1)return{volume:o,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const n=Dn(e),i=Array.from(this._imageCache.keys()).find(a=>Dn(a)===n);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,n,r){var a;if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}r.loaded=!0,r.volume=n,(a=n.imageIds)==null||a.forEach(o=>{const s=this._imageCache.get(o);s&&(s.sharedCacheKey=e)});const i={volume:r};Z(Y,X.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,n){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const r={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,r);try{this._putVolumeCommon(e,n,r)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(i=>{try{this._putVolumeCommon(e,i,r)}catch(a){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,a),this._volumeCache.delete(e),a}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,n,r){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!n){console.warn("Geometry is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(X.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.geometry=n,r.sizeInBytes=n.sizeInBytes,this.incrementGeometryCacheSize(r.sizeInBytes);const i={geometry:r};Z(Y,X.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,n){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const r={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,r);try{this._putGeometryCommon(e,n,r)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,n){const r=this._imageCache.get(e);if(!r){n&&this._imageCache.set(e,{image:n,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}r.loaded&&(r.loaded=!1,r.imageLoadObject=null,this.incrementImageCacheSize(-r.sizeInBytes),r.sizeInBytes=0),r.image=n||r.image}getImageQuality(e){var r;const n=(r=this._imageCache.get(e))==null?void 0:r.image;return n?n.imageQualityStatus||qn.FULL_RESOLUTION:void 0}}const Q=new HI,Xr=[];function M0(t,e=0){let n;for(n=0;n<Xr.length&&!(Xr[n].priority<=e);n++);Xr.splice(n,0,{priority:e,provider:t})}function jI(t){for(let e=0;e<Xr.length;e++)if(Xr[e].provider===t){Xr.splice(e,1);break}}function KI(){for(;Xr.length>0;)Xr.pop()}function ee(t,...e){for(let n=0;n<Xr.length;n++){const r=Xr[n].provider(t,...e);if(r!==void 0)return r}}const qI=Object.freeze(Object.defineProperty({__proto__:null,addProvider:M0,get:ee,removeAllProviders:KI,removeProvider:jI},Symbol.toStringTag,{value:"Module"}));let Z0={};const ra={add:(t,e)=>{ra.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const n=e.type;Z0[t]||(Z0[t]={}),Z0[t][n]=e.metadata},get:(t,e)=>{var n;return(n=Z0[e])==null?void 0:n[t]},clear:()=>{Z0={}}};M0(ra.get);function Y7(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, or Int16Array");return Float32Array}}function Y5(t,e,n={}){const{isVolumeBuffer:r=!1}=n,i=Y7(t,r),a=i.BYTES_PER_ELEMENT;return{numBytes:e*a,TypedArrayConstructor:i}}function bt(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}var _e=1e-6,Et=typeof Float32Array<"u"?Float32Array:Array,XI=Math.PI/180;function YI(t){return t*XI}function fl(t,e){return Math.abs(t-e)<=_e*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Z5(){var t=new Et(9);return Et!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Fg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function ZI(t){var e=new Et(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function JI(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function hc(t,e,n,r,i,a,o,s,c){var l=new Et(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=c,l}function Z7(t,e,n,r,i,a,o,s,c,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=l,t}function pr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function J5(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Ul(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=f*o-s*l,g=-f*a+s*c,d=l*a-o*c,h=n*u+r*g+i*d;return h?(h=1/h,t[0]=u*h,t[1]=(-f*r+i*l)*h,t[2]=(s*r-i*o)*h,t[3]=g*h,t[4]=(f*n-i*c)*h,t[5]=(-s*n+i*a)*h,t[6]=d*h,t[7]=(-l*n+r*c)*h,t[8]=(o*n-r*a)*h,t):null}function QI(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8];return t[0]=o*f-s*l,t[1]=i*l-r*f,t[2]=r*s-i*o,t[3]=s*c-a*f,t[4]=n*f-i*c,t[5]=i*a-n*s,t[6]=a*l-o*c,t[7]=r*c-n*l,t[8]=n*o-r*a,t}function Za(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8];return e*(l*a-o*c)+n*(-l*i+o*s)+r*(c*i-a*s)}function s0(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],d=n[1],h=n[2],p=n[3],m=n[4],v=n[5],y=n[6],C=n[7],T=n[8];return t[0]=g*r+d*o+h*l,t[1]=g*i+d*s+h*f,t[2]=g*a+d*c+h*u,t[3]=p*r+m*o+v*l,t[4]=p*i+m*s+v*f,t[5]=p*a+m*c+v*u,t[6]=y*r+C*o+T*l,t[7]=y*i+C*s+T*f,t[8]=y*a+C*c+T*u,t}function eV(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=c,t[6]=g*r+d*o+l,t[7]=g*i+d*s+f,t[8]=g*a+d*c+u,t}function tV(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=Math.sin(n),d=Math.cos(n);return t[0]=d*r+g*o,t[1]=d*i+g*s,t[2]=d*a+g*c,t[3]=d*o-g*r,t[4]=d*s-g*i,t[5]=d*c-g*a,t[6]=l,t[7]=f,t[8]=u,t}function nV(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function rV(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function iV(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function aV(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function oV(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function sV(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,l=n*o,f=r*o,u=r*s,g=i*o,d=i*s,h=i*c,p=a*o,m=a*s,v=a*c;return t[0]=1-u-h,t[3]=f-v,t[6]=g+m,t[1]=f+v,t[4]=1-l-h,t[7]=d-p,t[2]=g-m,t[5]=d+p,t[8]=1-l-u,t}function cV(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],h=e[12],p=e[13],m=e[14],v=e[15],y=n*s-r*o,C=n*c-i*o,T=n*l-a*o,S=r*c-i*s,x=r*l-a*s,w=i*l-a*c,E=f*p-u*h,M=f*m-g*h,O=f*v-d*h,R=u*m-g*p,_=u*v-d*p,P=g*v-d*m,N=y*P-C*_+T*R+S*O-x*M+w*E;return N?(N=1/N,t[0]=(s*P-c*_+l*R)*N,t[1]=(c*O-o*P-l*M)*N,t[2]=(o*_-s*O+l*E)*N,t[3]=(i*_-r*P-a*R)*N,t[4]=(n*P-i*O+a*M)*N,t[5]=(r*O-n*_-a*E)*N,t[6]=(p*w-m*x+v*S)*N,t[7]=(m*T-h*w-v*C)*N,t[8]=(h*x-p*T+v*y)*N,t):null}function lV(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function uV(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function fV(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function gV(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function J7(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function dV(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function pV(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function hV(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function mV(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=e[0],g=e[1],d=e[2],h=e[3],p=e[4],m=e[5],v=e[6],y=e[7],C=e[8];return Math.abs(n-u)<=_e*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-g)<=_e*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(i-d)<=_e*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-h)<=_e*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-p)<=_e*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-m)<=_e*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-v)<=_e*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-y)<=_e*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-C)<=_e*Math.max(1,Math.abs(f),Math.abs(C))}var vV=s0,yV=J7;const CV=Object.freeze(Object.defineProperty({__proto__:null,add:gV,adjoint:QI,clone:ZI,copy:JI,create:Z5,determinant:Za,equals:mV,exactEquals:hV,frob:fV,fromMat2d:oV,fromMat4:Fg,fromQuat:sV,fromRotation:iV,fromScaling:aV,fromTranslation:rV,fromValues:hc,identity:pr,invert:Ul,mul:vV,multiply:s0,multiplyScalar:dV,multiplyScalarAndAdd:pV,normalFromMat4:cV,projection:lV,rotate:tV,scale:nV,set:Z7,str:uV,sub:yV,subtract:J7,translate:eV,transpose:J5},Symbol.toStringTag,{value:"Module"}));function Ia(){var t=new Et(16);return Et!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function TV(t){var e=new Et(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function it(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Q7(t,e,n,r,i,a,o,s,c,l,f,u,g,d,h,p){var m=new Et(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=a,m[6]=o,m[7]=s,m[8]=c,m[9]=l,m[10]=f,m[11]=u,m[12]=g,m[13]=d,m[14]=h,m[15]=p,m}function SV(t,e,n,r,i,a,o,s,c,l,f,u,g,d,h,p,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=l,t[9]=f,t[10]=u,t[11]=g,t[12]=d,t[13]=h,t[14]=p,t[15]=m,t}function ie(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xe(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function xt(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],h=e[12],p=e[13],m=e[14],v=e[15],y=n*s-r*o,C=n*c-i*o,T=n*l-a*o,S=r*c-i*s,x=r*l-a*s,w=i*l-a*c,E=f*p-u*h,M=f*m-g*h,O=f*v-d*h,R=u*m-g*p,_=u*v-d*p,P=g*v-d*m,N=y*P-C*_+T*R+S*O-x*M+w*E;return N?(N=1/N,t[0]=(s*P-c*_+l*R)*N,t[1]=(i*_-r*P-a*R)*N,t[2]=(p*w-m*x+v*S)*N,t[3]=(g*x-u*w-d*S)*N,t[4]=(c*O-o*P-l*M)*N,t[5]=(n*P-i*O+a*M)*N,t[6]=(m*T-h*w-v*C)*N,t[7]=(f*w-g*T+d*C)*N,t[8]=(o*_-s*O+l*E)*N,t[9]=(r*O-n*_-a*E)*N,t[10]=(h*x-p*T+v*y)*N,t[11]=(u*T-f*x-d*y)*N,t[12]=(s*M-o*R-c*E)*N,t[13]=(n*R-r*M+i*E)*N,t[14]=(p*C-h*S-m*y)*N,t[15]=(f*S-u*C+g*y)*N,t):null}function xV(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],g=e[10],d=e[11],h=e[12],p=e[13],m=e[14],v=e[15];return t[0]=s*(g*v-d*m)-u*(c*v-l*m)+p*(c*d-l*g),t[1]=-(r*(g*v-d*m)-u*(i*v-a*m)+p*(i*d-a*g)),t[2]=r*(c*v-l*m)-s*(i*v-a*m)+p*(i*l-a*c),t[3]=-(r*(c*d-l*g)-s*(i*d-a*g)+u*(i*l-a*c)),t[4]=-(o*(g*v-d*m)-f*(c*v-l*m)+h*(c*d-l*g)),t[5]=n*(g*v-d*m)-f*(i*v-a*m)+h*(i*d-a*g),t[6]=-(n*(c*v-l*m)-o*(i*v-a*m)+h*(i*l-a*c)),t[7]=n*(c*d-l*g)-o*(i*d-a*g)+f*(i*l-a*c),t[8]=o*(u*v-d*p)-f*(s*v-l*p)+h*(s*d-l*u),t[9]=-(n*(u*v-d*p)-f*(r*v-a*p)+h*(r*d-a*u)),t[10]=n*(s*v-l*p)-o*(r*v-a*p)+h*(r*l-a*s),t[11]=-(n*(s*d-l*u)-o*(r*d-a*u)+f*(r*l-a*s)),t[12]=-(o*(u*m-g*p)-f*(s*m-c*p)+h*(s*g-c*u)),t[13]=n*(u*m-g*p)-f*(r*m-i*p)+h*(r*g-i*u),t[14]=-(n*(s*m-c*p)-o*(r*m-i*p)+h*(r*c-i*s)),t[15]=n*(s*g-c*u)-o*(r*g-i*u)+f*(r*c-i*s),t}function wV(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],f=t[9],u=t[10],g=t[11],d=t[12],h=t[13],p=t[14],m=t[15],v=e*o-n*a,y=e*s-r*a,C=e*c-i*a,T=n*s-r*o,S=n*c-i*o,x=r*c-i*s,w=l*h-f*d,E=l*p-u*d,M=l*m-g*d,O=f*p-u*h,R=f*m-g*h,_=u*m-g*p;return v*_-y*R+C*O+T*M-S*E+x*w}function De(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],g=e[9],d=e[10],h=e[11],p=e[12],m=e[13],v=e[14],y=e[15],C=n[0],T=n[1],S=n[2],x=n[3];return t[0]=C*r+T*s+S*u+x*p,t[1]=C*i+T*c+S*g+x*m,t[2]=C*a+T*l+S*d+x*v,t[3]=C*o+T*f+S*h+x*y,C=n[4],T=n[5],S=n[6],x=n[7],t[4]=C*r+T*s+S*u+x*p,t[5]=C*i+T*c+S*g+x*m,t[6]=C*a+T*l+S*d+x*v,t[7]=C*o+T*f+S*h+x*y,C=n[8],T=n[9],S=n[10],x=n[11],t[8]=C*r+T*s+S*u+x*p,t[9]=C*i+T*c+S*g+x*m,t[10]=C*a+T*l+S*d+x*v,t[11]=C*o+T*f+S*h+x*y,C=n[12],T=n[13],S=n[14],x=n[15],t[12]=C*r+T*s+S*u+x*p,t[13]=C*i+T*c+S*g+x*m,t[14]=C*a+T*l+S*d+x*v,t[15]=C*o+T*f+S*h+x*y,t}function nt(t,e,n){var r=n[0],i=n[1],a=n[2],o,s,c,l,f,u,g,d,h,p,m,v;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],c=e[2],l=e[3],f=e[4],u=e[5],g=e[6],d=e[7],h=e[8],p=e[9],m=e[10],v=e[11],t[0]=o,t[1]=s,t[2]=c,t[3]=l,t[4]=f,t[5]=u,t[6]=g,t[7]=d,t[8]=h,t[9]=p,t[10]=m,t[11]=v,t[12]=o*r+f*i+h*a+e[12],t[13]=s*r+u*i+p*a+e[13],t[14]=c*r+g*i+m*a+e[14],t[15]=l*r+d*i+v*a+e[15]),t}function Vi(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function yr(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.hypot(i,a,o),c,l,f,u,g,d,h,p,m,v,y,C,T,S,x,w,E,M,O,R,_,P,N,W;return s<_e?null:(s=1/s,i*=s,a*=s,o*=s,c=Math.sin(n),l=Math.cos(n),f=1-l,u=e[0],g=e[1],d=e[2],h=e[3],p=e[4],m=e[5],v=e[6],y=e[7],C=e[8],T=e[9],S=e[10],x=e[11],w=i*i*f+l,E=a*i*f+o*c,M=o*i*f-a*c,O=i*a*f-o*c,R=a*a*f+l,_=o*a*f+i*c,P=i*o*f+a*c,N=a*o*f-i*c,W=o*o*f+l,t[0]=u*w+p*E+C*M,t[1]=g*w+m*E+T*M,t[2]=d*w+v*E+S*M,t[3]=h*w+y*E+x*M,t[4]=u*O+p*R+C*_,t[5]=g*O+m*R+T*_,t[6]=d*O+v*R+S*_,t[7]=h*O+y*R+x*_,t[8]=u*P+p*N+C*W,t[9]=g*P+m*N+T*W,t[10]=d*P+v*N+S*W,t[11]=h*P+y*N+x*W,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Q5(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*r,t[5]=o*i+f*r,t[6]=s*i+u*r,t[7]=c*i+g*r,t[8]=l*i-a*r,t[9]=f*i-o*r,t[10]=u*i-s*r,t[11]=g*i-c*r,t}function e3(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],l=e[8],f=e[9],u=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*r,t[1]=o*i-f*r,t[2]=s*i-u*r,t[3]=c*i-g*r,t[8]=a*r+l*i,t[9]=o*r+f*i,t[10]=s*r+u*i,t[11]=c*r+g*i,t}function t3(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],c=e[3],l=e[4],f=e[5],u=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*r,t[1]=o*i+f*r,t[2]=s*i+u*r,t[3]=c*i+g*r,t[4]=l*i-a*r,t[5]=f*i-o*r,t[6]=u*i-s*r,t[7]=g*i-c*r,t}function Ug(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function n3(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function r3(t,e,n){var r=n[0],i=n[1],a=n[2],o=Math.hypot(r,i,a),s,c,l;return o<_e?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=r*r*l+c,t[1]=i*r*l+a*s,t[2]=a*r*l-i*s,t[3]=0,t[4]=r*i*l-a*s,t[5]=i*i*l+c,t[6]=a*i*l+r*s,t[7]=0,t[8]=r*a*l+i*s,t[9]=i*a*l-r*s,t[10]=a*a*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function EV(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function OV(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function DV(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eC(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,c=i+i,l=a+a,f=r*s,u=r*c,g=r*l,d=i*c,h=i*l,p=a*l,m=o*s,v=o*c,y=o*l;return t[0]=1-(d+p),t[1]=u+y,t[2]=g-v,t[3]=0,t[4]=u-y,t[5]=1-(f+p),t[6]=h+m,t[7]=0,t[8]=g+v,t[9]=h-m,t[10]=1-(f+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function RV(t,e){var n=new Et(3),r=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=r*r+i*i+a*a+o*o;return u>0?(n[0]=(s*o+f*r+c*a-l*i)*2/u,n[1]=(c*o+f*i+l*r-s*a)*2/u,n[2]=(l*o+f*a+s*i-c*r)*2/u):(n[0]=(s*o+f*r+c*a-l*i)*2,n[1]=(c*o+f*i+l*r-s*a)*2,n[2]=(l*o+f*a+s*i-c*r)*2),eC(t,e,n),t}function MV(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function tC(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],o=e[5],s=e[6],c=e[8],l=e[9],f=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(c,l,f),t}function ih(t,e){var n=new Et(3);tC(n,e);var r=1/n[0],i=1/n[1],a=1/n[2],o=e[0]*r,s=e[1]*i,c=e[2]*a,l=e[4]*r,f=e[5]*i,u=e[6]*a,g=e[8]*r,d=e[9]*i,h=e[10]*a,p=o+f+h,m=0;return p>0?(m=Math.sqrt(p+1)*2,t[3]=.25*m,t[0]=(u-d)/m,t[1]=(g-c)/m,t[2]=(s-l)/m):o>f&&o>h?(m=Math.sqrt(1+o-f-h)*2,t[3]=(u-d)/m,t[0]=.25*m,t[1]=(s+l)/m,t[2]=(g+c)/m):f>h?(m=Math.sqrt(1+f-o-h)*2,t[3]=(g-c)/m,t[0]=(s+l)/m,t[1]=.25*m,t[2]=(u+d)/m):(m=Math.sqrt(1+h-o-f)*2,t[3]=(s-l)/m,t[0]=(g+c)/m,t[1]=(u+d)/m,t[2]=.25*m),t}function nC(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=i+i,l=a+a,f=o+o,u=i*c,g=i*l,d=i*f,h=a*l,p=a*f,m=o*f,v=s*c,y=s*l,C=s*f,T=r[0],S=r[1],x=r[2];return t[0]=(1-(h+m))*T,t[1]=(g+C)*T,t[2]=(d-y)*T,t[3]=0,t[4]=(g-C)*S,t[5]=(1-(u+m))*S,t[6]=(p+v)*S,t[7]=0,t[8]=(d+y)*x,t[9]=(p-v)*x,t[10]=(1-(u+h))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function LV(t,e,n,r,i){var a=e[0],o=e[1],s=e[2],c=e[3],l=a+a,f=o+o,u=s+s,g=a*l,d=a*f,h=a*u,p=o*f,m=o*u,v=s*u,y=c*l,C=c*f,T=c*u,S=r[0],x=r[1],w=r[2],E=i[0],M=i[1],O=i[2],R=(1-(p+v))*S,_=(d+T)*S,P=(h-C)*S,N=(d-T)*x,W=(1-(g+v))*x,U=(m+y)*x,K=(h+C)*w,A=(m-y)*w,b=(1-(g+p))*w;return t[0]=R,t[1]=_,t[2]=P,t[3]=0,t[4]=N,t[5]=W,t[6]=U,t[7]=0,t[8]=K,t[9]=A,t[10]=b,t[11]=0,t[12]=n[0]+E-(R*E+N*M+K*O),t[13]=n[1]+M-(_*E+W*M+A*O),t[14]=n[2]+O-(P*E+U*M+b*O),t[15]=1,t}function E1(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,c=i+i,l=n*o,f=r*o,u=r*s,g=i*o,d=i*s,h=i*c,p=a*o,m=a*s,v=a*c;return t[0]=1-u-h,t[1]=f+v,t[2]=g-m,t[3]=0,t[4]=f-v,t[5]=1-l-h,t[6]=d+p,t[7]=0,t[8]=g+m,t[9]=d-p,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function IV(t,e,n,r,i,a,o){var s=1/(n-e),c=1/(i-r),l=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*c,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function rC(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var VV=rC;function _V(t,e,n,r,i){var a=1/Math.tan(e/2),o;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function bV(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(o+s),l=2/(i+a);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((o-s)*c*.5),t[9]=(i-a)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function iC(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=(o+a)*l,t[15]=1,t}var i3=iC;function NV(t,e,n,r,i,a,o){var s=1/(e-n),c=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=a*l,t[15]=1,t}function aC(t,e,n,r){var i,a,o,s,c,l,f,u,g,d,h=e[0],p=e[1],m=e[2],v=r[0],y=r[1],C=r[2],T=n[0],S=n[1],x=n[2];return Math.abs(h-T)<_e&&Math.abs(p-S)<_e&&Math.abs(m-x)<_e?ie(t):(f=h-T,u=p-S,g=m-x,d=1/Math.hypot(f,u,g),f*=d,u*=d,g*=d,i=y*g-C*u,a=C*f-v*g,o=v*u-y*f,d=Math.hypot(i,a,o),d?(d=1/d,i*=d,a*=d,o*=d):(i=0,a=0,o=0),s=u*o-g*a,c=g*i-f*o,l=f*a-u*i,d=Math.hypot(s,c,l),d?(d=1/d,s*=d,c*=d,l*=d):(s=0,c=0,l=0),t[0]=i,t[1]=s,t[2]=f,t[3]=0,t[4]=a,t[5]=c,t[6]=u,t[7]=0,t[8]=o,t[9]=l,t[10]=g,t[11]=0,t[12]=-(i*h+a*p+o*m),t[13]=-(s*h+c*p+l*m),t[14]=-(f*h+u*p+g*m),t[15]=1,t)}function PV(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=r[0],c=r[1],l=r[2],f=i-n[0],u=a-n[1],g=o-n[2],d=f*f+u*u+g*g;d>0&&(d=1/Math.sqrt(d),f*=d,u*=d,g*=d);var h=c*g-l*u,p=l*f-s*g,m=s*u-c*f;return d=h*h+p*p+m*m,d>0&&(d=1/Math.sqrt(d),h*=d,p*=d,m*=d),t[0]=h,t[1]=p,t[2]=m,t[3]=0,t[4]=u*m-g*p,t[5]=g*h-f*m,t[6]=f*p-u*h,t[7]=0,t[8]=f,t[9]=u,t[10]=g,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function kV(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function FV(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function UV(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function oC(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function AV(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function BV(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function GV(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function WV(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=t[9],g=t[10],d=t[11],h=t[12],p=t[13],m=t[14],v=t[15],y=e[0],C=e[1],T=e[2],S=e[3],x=e[4],w=e[5],E=e[6],M=e[7],O=e[8],R=e[9],_=e[10],P=e[11],N=e[12],W=e[13],U=e[14],K=e[15];return Math.abs(n-y)<=_e*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-C)<=_e*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(i-T)<=_e*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(a-S)<=_e*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-x)<=_e*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-w)<=_e*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(c-E)<=_e*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-M)<=_e*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(f-O)<=_e*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(u-R)<=_e*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(g-_)<=_e*Math.max(1,Math.abs(g),Math.abs(_))&&Math.abs(d-P)<=_e*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(h-N)<=_e*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(p-W)<=_e*Math.max(1,Math.abs(p),Math.abs(W))&&Math.abs(m-U)<=_e*Math.max(1,Math.abs(m),Math.abs(U))&&Math.abs(v-K)<=_e*Math.max(1,Math.abs(v),Math.abs(K))}var O1=De,$V=oC;const gl=Object.freeze(Object.defineProperty({__proto__:null,add:UV,adjoint:xV,clone:TV,copy:it,create:Ia,determinant:wV,equals:WV,exactEquals:GV,frob:FV,fromQuat:E1,fromQuat2:RV,fromRotation:r3,fromRotationTranslation:eC,fromRotationTranslationScale:nC,fromRotationTranslationScaleOrigin:LV,fromScaling:n3,fromTranslation:Ug,fromValues:Q7,fromXRotation:EV,fromYRotation:OV,fromZRotation:DV,frustum:IV,getRotation:ih,getScaling:tC,getTranslation:MV,identity:ie,invert:xt,lookAt:aC,mul:O1,multiply:De,multiplyScalar:AV,multiplyScalarAndAdd:BV,ortho:i3,orthoNO:iC,orthoZO:NV,perspective:VV,perspectiveFromFieldOfView:bV,perspectiveNO:rC,perspectiveZO:_V,rotate:yr,rotateX:Q5,rotateY:e3,rotateZ:t3,scale:Vi,set:SV,str:kV,sub:$V,subtract:oC,targetTo:PV,translate:nt,transpose:xe},Symbol.toStringTag,{value:"Module"}));function te(){var t=new Et(3);return Et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Us(t){var e=new Et(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ma(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ze(t,e,n){var r=new Et(3);return r[0]=t,r[1]=e,r[2]=n,r}function dl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Fe(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function rn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function rt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function zV(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function HV(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Hn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function dn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function D1(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function vo(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function sC(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function $t(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function fe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function vt(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],c=n[2];return t[0]=i*c-a*s,t[1]=a*o-r*c,t[2]=r*s-i*o,t}function Ee(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function Df(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function cC(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2],c=Math.sqrt(n*n+r*r+i*i),l=Math.sqrt(a*a+o*o+s*s),f=c*l,u=f&&fe(t,e)/f;return Math.acos(Math.min(Math.max(u,-1),1))}function jV(t){return t[0]=0,t[1]=0,t[2]=0,t}function d8(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function p8(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=_e*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=_e*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=_e*Math.max(1,Math.abs(i),Math.abs(s))}var _t=rt,KV=zV,R1=ma;(function(){var t=te();return function(e,n,r,i,a,o){var s,c;for(n||(n=3),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function qV(){var t=new Et(4);return Et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function XV(t,e,n,r){var i=new Et(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function h8(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function YV(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o,t}function uo(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}(function(){var t=qV();return function(e,n,r,i,a,o){var s,c;for(n||(n=4),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function Io(){var t=new Et(4);return Et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function a3(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function ZV(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>_e?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function m8(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],c=n[1],l=n[2],f=n[3];return t[0]=r*f+o*s+i*l-a*c,t[1]=i*f+o*c+a*s-r*l,t[2]=a*f+o*l+r*c-i*s,t[3]=o*f-r*s-i*c-a*l,t}function Rf(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],c=n[0],l=n[1],f=n[2],u=n[3],g,d,h,p,m;return d=i*c+a*l+o*f+s*u,d<0&&(d=-d,c=-c,l=-l,f=-f,u=-u),1-d>_e?(g=Math.acos(d),h=Math.sin(g),p=Math.sin((1-r)*g)/h,m=Math.sin(r*g)/h):(p=1-r,m=r),t[0]=p*i+m*c,t[1]=p*a+m*l,t[2]=p*o+m*f,t[3]=p*s+m*u,t}function JV(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function QV(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[a*3+a]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[a*3+o]-e[o*3+a])*r,t[a]=(e[a*3+i]+e[i*3+a])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}var v8=XV,lC=YV;(function(){var t=te(),e=Ze(1,0,0),n=Ze(0,1,0);return function(r,i,a){var o=fe(i,a);return o<-.999999?(vt(t,e,i),R1(t)<1e-6&&vt(t,n,i),$t(t,t),a3(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(vt(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,lC(r,r))}})();(function(){var t=Io(),e=Io();return function(n,r,i,a,o,s){return Rf(t,r,o,s),Rf(e,i,a,s),Rf(n,t,e,2*s*(1-s)),n}})();(function(){var t=Z5();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],lC(e,QV(e,t))}})();function Si(){var t=new Et(2);return Et!=Float32Array&&(t[0]=0,t[1]=0),t}function y8(t,e){var n=new Et(2);return n[0]=t,n[1]=e,n}function As(t,e,n){return t[0]=e,t[1]=n,t}function o3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function c0(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function C8(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function qt(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function uC(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function e_(t,e){return t[0]*e[0]+t[1]*e[1]}var M1=c0,s3=qt;(function(){var t=Si();return function(e,n,r,i,a,o){var s,c;for(n||(n=2),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,s=r;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}})();class fC{constructor(e,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numberOfComponents=1,this.defaultValue=0,this.pixelDataConstructor=Uint8Array,this.get=i=>{const a=i%this.jMultiple,o=(i-a)/this.jMultiple,s=this.getRLE(a,o);return(s==null?void 0:s.value)||this.defaultValue},this.getRun=(i,a)=>{const o=i+a*this.height;return this.rows.get(o)},this.set=(i,a)=>{if(a===void 0)throw new Error(`Can't set undefined at ${i%this.width}`);const o=i%this.width,s=(i-o)/this.width,c=this.rows.get(s);if(!c){this.rows.set(s,[{start:o,end:o+1,value:a}]);return}const l=this.findIndex(c,o),f=c[l],u=c[l-1];if(!f){if(!u||u.value!==a||u.end!==o){c[l]={start:o,end:o+1,value:a};return}u.end++;return}const{start:g,end:d,value:h}=f;if(a===h&&o>=g)return;const p={start:o,end:o+1,value:a},m=o>g,v=m?l+1:l,y=m?f:u;let C=m?c[l+1]:f;if((y==null?void 0:y.value)===a&&y.end===o){y.end++,(C==null?void 0:C.value)===a&&C.start===o+1?(y.end=C.end,c.splice(l,1)):(C==null?void 0:C.start)===o&&(C.start++,C.start===C.end&&(c.splice(l,1),C=c[l],(C==null?void 0:C.start)===o+1&&C.value===a&&(y.end=C.end,c.splice(l,1))));return}if((C==null?void 0:C.value)===a&&C.start===o+1){C.start--,(y==null?void 0:y.end)>o&&(y.end=o,y.end===y.start&&c.splice(l,1));return}if((C==null?void 0:C.start)===o&&C.end===o+1){C.value=a;const T=c[l+1];(T==null?void 0:T.start)==o+1&&(T==null?void 0:T.value)===a&&(c.splice(l+1,1),C.end=T.end);return}o===(C==null?void 0:C.start)&&C.start++,m&&d>o+1?c.splice(v,0,p,{start:o+1,end:y.end,value:y.value}):c.splice(v,0,p),(y==null?void 0:y.end)>o&&(y.end=o)},this.width=e,this.height=n,this.depth=r,this.jMultiple=e,this.kMultiple=this.jMultiple*n}getRLE(e,n,r=0){const i=this.rows.get(n+r*this.height);if(!i)return;const a=this.findIndex(i,e),o=i[a];return e>=(o==null?void 0:o.start)?o:void 0}findIndex(e,n){for(let r=0;r<e.length;r++){const{end:i}=e[r];if(n<i)return r}return e.length}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numberOfComponents);const{width:r,height:i,numberOfComponents:a}=this;for(let o=0;o<i;o++){const s=this.getRun(o,e);if(s)if(a===1)for(const c of s){const l=o*r,{start:f,end:u,value:g}=c;for(let d=f;d<u;d++)n[l+d]=g}else for(const c of s){const l=o*r*a,{start:f,end:u,value:g}=c;for(let d=f;d<u;d+=a)for(let h=0;h<a;h++)n[l+d+h]=g[h]}}return n}}function gC(t,e,n){return Math.abs(t-e)<=n}function t_(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!gC(t[r],e[r],n))return!1;return!0}function T8(t){return typeof t=="number"}function S8(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function Vt(t,e,n=1e-5){return typeof t!=typeof e||t===null||e===null?!1:T8(t)&&T8(e)?gC(t,e,n):S8(t)&&S8(e)?t_(t,e,n):!1}const dC=t=>typeof t=="number"?-t:t!=null&&t.map?t.map(dC):!t,ah=t=>typeof t=="number"?Math.abs(t):t!=null&&t.map?t.map(ah):t,pC=(t,e,n=void 0)=>Vt(t,dC(e),n),n_=(t,e,n=void 0)=>Vt(ah(t),ah(e),n),r_=5*1024;class ft{constructor(e,n,r){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.numberOfComponents=1,this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(i,a,o)=>{const s=this.toIndex([i,a,o]);return this._get(s)},this.setAtIJK=(i,a,o,s)=>{const c=this.toIndex([i,a,o]),l=this._set(c,s);return l!==!1&&(this.modifiedSlices.add(o),ft.addBounds(this.boundsIJK,[i,a,o])),l},this.getAtIJKPoint=([i,a,o])=>this.getAtIJK(i,a,o),this.setAtIJKPoint=([i,a,o],s)=>{this.setAtIJK(i,a,o,s)},this.getAtIndex=i=>this._get(i),this.setAtIndex=(i,a)=>{const o=this._set(i,a);if(o!==!1){const s=this.toIJK(i);this.modifiedSlices.add(s[2]),ft.addBounds(this.boundsIJK,s)}return o},this.getMiddleSliceData=()=>{const i=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:i,slicePlane:2})},this.forEach=(i,a={})=>{const o=a.boundsIJK||this.getBoundsIJK(),s=a.isInObject||this.isInObject||(()=>!0),c=a.returnPoints||!1,l=a.imageData,f=Math.min(o[0][0],o[0][1]),u=Math.max(o[0][0],o[0][1]),g=Math.min(o[1][0],o[1][1]),d=Math.max(o[1][0],o[1][1]),h=Math.min(o[2][0],o[2][1]),p=Math.max(o[2][0],o[2][1]),m=[];if(l){const{imageData:v}=a,y=v.getDirection(),C=y.slice(0,3),T=y.slice(3,6),S=y.slice(6,9),x=v.getSpacing(),[w,E,M]=x,O=Ze(f,g,h),R=v.indexToWorld(O),_=Ze(C[0]*w,C[1]*w,C[2]*w),P=Ze(T[0]*E,T[1]*E,T[2]*E),N=Ze(S[0]*M,S[1]*M,S[2]*M),W=Us(R);for(let U=h;U<=p;U++){const K=Us(W);for(let A=g;A<=d;A++){const b=Us(W);for(let F=f;F<=u;F++){const $=[F,A,U];if(s(W,$)){const j=this.toIndex($),z=this._get(j);c&&m.push({value:z,index:j,pointIJK:$,pointLPS:W.slice()}),i&&i({value:z,index:j,pointIJK:$,pointLPS:W})}rn(W,W,_)}dl(W,b),rn(W,W,P)}dl(W,K),rn(W,W,N)}return m}if(this.map){for(const v of this.map.keys()){const y=this.toIJK(v);if(!s(null,y))continue;const C=this._get(v);c&&m.push({value:C,index:v,pointIJK:y,pointLPS:null}),i({value:C,index:v,pointIJK:y,pointLPS:null})}return m}else{for(let v=h;v<=p;v++){const y=v*this.frameSize;for(let C=g;C<=d;C++){const T=y+C*this.width;for(let S=f,x=T+S;S<=u;S++,x++){const w=this.getAtIndex(x),E=[S,C,v];s(null,E)&&(c&&m.push({value:w,index:x,pointIJK:E,pointLPS:null}),i({value:w,index:x,pointIJK:[S,C,v],pointLPS:null}))}}}return m}},this.getSliceData=({sliceIndex:i,slicePlane:a})=>{const[o,s,c]=this.dimensions,l=o*s,f=i*l;let u;const g=this.getConstructor();function d(p){return typeof p=="function"}if(!d(g))return new Uint8Array(0);let h;switch(a){case 0:u=s*c,h=new g(u);for(let p=0;p<s;p++)for(let m=0;m<c;m++){const v=i+p*o+m*l;this.setSliceDataValue(h,p*c+m,this._get(v))}break;case 1:u=o*c,h=new g(u);for(let p=0;p<o;p++)for(let m=0;m<c;m++){const v=p+i*o+m*l;this.setSliceDataValue(h,p+m*o,this._get(v))}break;case 2:u=o*s,h=new g(u);for(let p=0;p<u;p++)this.setSliceDataValue(h,p,this._get(f+p));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return h},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=n,this._set=r}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}getScalarData(){if(this.scalarData)return this.scalarData;if(this._getScalarData)return this._getScalarData();throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clear(){var e;this.map&&this.map.clear(),this.boundsIJK.map(n=>{n[0]=1/0,n[1]=-1/0}),this.modifiedSlices.clear(),(e=this.points)==null||e.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}static addBounds(e,n){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(n[0],e[0][0]),e[0][1]=Math.max(n[0],e[0][1]),e[1][0]=Math.min(n[1],e[1][0]),e[1][1]=Math.max(n[1],e[1][1]),e[2][0]=Math.min(n[2],e[2][0]),e[2][1]=Math.max(n[2],e[2][1])}addPoint(e){const n=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,n,r){if(Array.isArray(r))for(let i=0;i<r.length;i++)e[n*r.length+i]=this.toNumber(r[i]);else e[n]=this.toNumber(r)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=3}){const i=new ft(e,a=>(a*=r,[n[a++],n[a++],n[a++]]),(a,o)=>{a*=3;const s=!Vt(n[a],o);return n[a++]=o[0],n[a++]=o[1],n[a++]=o[2],s});return i.numberOfComponents=r,i.scalarData=n,i}static createImageVolumeVoxelManager({dimensions:e,imageIds:n,numberOfComponents:r=1}){const i=e[0]*e[1];function a(l){const f=Math.floor(l/i),u=n[f];if(!u)return console.warn(`ImageId not found for sliceIndex: ${f}`),{pixelData:null,pixelIndex:null};const g=Q.getImage(u);if(!g)return console.warn(`Image not found for imageId: ${u}`),{pixelData:null,pixelIndex:null};const d=g.voxelManager.getScalarData(),h=l%i*r;return{pixelData:d,pixelIndex:h}}function o(l){const{pixelData:f,pixelIndex:u}=a(l);return!f||u===null?null:r===1?f[u]:[f[u],f[u+1],f[u+2]]}function s(l,f){const{pixelData:u,pixelIndex:g}=a(l);if(!u||g===null)return!1;let d=!1;if(r===1)u[g]!==f&&(u[g]=f,d=!0);else{const h=f;for(let p=0;p<r;p++)u[g+p]!==h[p]&&(u[g+p]=h[p],d=!0)}return d}const c=new ft(e,l=>o(l),(l,f)=>s(l,f));return c.numberOfComponents=r,c._getConstructor=()=>{const l=a(0);return l.pixelData?l.pixelData.constructor:null},c.getMiddleSliceData=()=>{const l=Math.floor(e[2]/2);return c.getSliceData({sliceIndex:l,slicePlane:2})},c.getRange=()=>{let l=1/0,f=-1/0;for(const u of n){const g=Q.getImage(u);g.minPixelValue<l&&(l=g.minPixelValue),g.maxPixelValue>f&&(f=g.maxPixelValue)}return[l,f]},c._getScalarDataLength=()=>{const{pixelData:l}=a(0);return l.length*e[2]},c.getCompleteScalarDataArray=()=>{const l=c._getConstructor();if(!l)return new Uint8Array(0);const f=c.getScalarDataLength(),u=new l(f),g=e[0]*e[1]*r;for(let d=0;d<e[2];d++){const{pixelData:h}=a(d*g/r);if(h){const p=d*g;if(r===1)u.set(h,p);else for(let m=0;m<h.length;m+=r)for(let v=0;v<r;v++)u[p+m+v]=h[m+v]}}return u},c.setCompleteScalarDataArray=l=>{const f=e[0]*e[1]*r,u=c._getConstructor();let g=1/0,d=-1/0;for(let h=0;h<e[2];h++){const{pixelData:p}=a(h*f/r);if(p&&u){const m=h*f,v=m+f,y=new u(f);y.set(l.subarray(m,v)),p.set(y);for(let S=0;S<y.length;S++){const x=y[S];g=Math.min(g,x),d=Math.max(d,x)}const C=n[h],T=Q.getImage(C);T&&(T.minPixelValue=g,T.maxPixelValue=d)}}for(let h=0;h<e[2];h++)c.modifiedSlices.add(h);c.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},c}static createScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=1}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/e[0]/e[1]/e[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?ft._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r}):ft._createNumberVolumeVoxelManager({dimensions:e,scalarData:n})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:n,timePoint:r=0,numberOfComponents:i=1}){if(!i){const s=Q.getImage(e[0][0]);if(!s)throw new Error("Unable to determine number of components: No image found");if(i=s.getPixelData().length/(n[0]*n[1]),i>4||i<1||i===2)throw new Error(`Number of components ${i} must be 1, 3 or 4`)}const a=e.map(s=>ft.createImageVolumeVoxelManager({dimensions:n,imageIds:s,numberOfComponents:i})),o=new ft(n,s=>a[r]._get(s),(s,c)=>a[r]._set(s,c));return o.numberOfComponents=i,o.getScalarDataLength=()=>a[r].getScalarDataLength(),o.getConstructor=()=>a[r].getConstructor(),o.getRange=()=>a[r].getRange(),o.getMiddleSliceData=()=>a[r].getMiddleSliceData(),o.setTimePoint=s=>{r=s,o._get=c=>a[r]._get(c),o._set=(c,l)=>a[r]._set(c,l)},o.getAtIndexAndTimePoint=(s,c)=>a[c]._get(s),o.getTimePointScalarData=s=>a[s].getCompleteScalarDataArray(),o.getTimePointScalarData=s=>a[s].getCompleteScalarDataArray(),o.getCurrentTimePointScalarData=()=>a[r].getCompleteScalarDataArray(),o}static createImageVoxelManager({width:e,height:n,scalarData:r,numberOfComponents:i=1}){const a=[e,n,1];if(!i&&(i=r.length/e/n,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?ft._createRGBScalarVolumeVoxelManager({dimensions:a,scalarData:r,numberOfComponents:i}):ft._createNumberVolumeVoxelManager({dimensions:a,scalarData:r})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:n}){const r=new ft(e,i=>n[i],(i,a)=>{const o=n[i]!==a;return n[i]=a,o});return r.scalarData=n,r.getMiddleSliceData=()=>{const i=Math.floor(e[2]/2);return r.getSliceData({sliceIndex:i,slicePlane:2})},r}static createMapVoxelManager({dimension:e}){const n=new Map,r=new ft(e,n.get.bind(n),(i,a)=>n.set(i,a)&&!0);return r.map=n,r}static createHistoryVoxelManager({sourceVoxelManager:e}){const n=new Map,{dimensions:r}=e,i=new ft(r,a=>n.get(a),function(a,o){if(n.has(a))o===n.get(a)&&n.delete(a);else{const s=this.sourceVoxelManager.getAtIndex(a);if(s===o)return!1;n.set(a,s)}this.sourceVoxelManager.setAtIndex(a,o)});return i.map=n,i.scalarData=e.scalarData,i.sourceVoxelManager=e,i}static createLazyVoxelManager({dimensions:e,planeFactory:n}){const r=new Map,[i,a]=e,o=i*a,s=new ft(e,c=>r.get(Math.floor(c/o))[c%o],(c,l)=>{const f=Math.floor(c/o);let u=r.get(f);return u||(u=n(i,a),r.set(f,u)),u[c%o]=l,!0});return s.map=r,s}static createRLEVoxelManager({dimensions:e}){const[n,r,i]=e,a=new fC(n,r,i),o=new ft(e,s=>a.get(s),(s,c)=>(a.set(s,c),!0));return o.map=a,o.getPixelData=a.getPixelData.bind(a),o}static addInstanceToImage(e){const{width:n,height:r}=e,i=e.voxelManager.getScalarData();if(i.length>=n*r){e.voxelManager=ft.createScalarVolumeVoxelManager({dimensions:[n,r,1],scalarData:i});return}e.voxelManager=ft.createRLEVoxelManager({dimensions:[n,r,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=r_}}class c3{constructor(e){this.numRequests={[ye.Interaction]:0,[ye.Thumbnail]:0,[ye.Prefetch]:0,[ye.Compute]:0},this.id=e||bt(),this.requestPool={[ye.Interaction]:{0:[]},[ye.Thumbnail]:{0:[]},[ye.Prefetch]:{0:[]},[ye.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[ye.Interaction]:0,[ye.Thumbnail]:0,[ye.Prefetch]:0,[ye.Compute]:0},this.maxNumRequests={[ye.Interaction]:6,[ye.Thumbnail]:6,[ye.Prefetch]:5,[ye.Compute]:1e3}}setMaxSimultaneousRequests(e,n){this.maxNumRequests[e]=n}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,i=0){const a={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][i]===void 0&&(this.requestPool[n][i]=[]),this.requestPool[n][i].push(a),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(i=>{r[i]=r[i].filter(a=>e(a))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let i=0;i<n;i++){const a=this.getNextRequest(e);if(a===null)return!1;if(a){this.numRequests[e]++,this.awake=!0;let o;try{o=a.requestFn()}catch(s){console.warn("sendRequest failed",s)}o!=null&&o.finally?o.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(ye.Interaction),n=this.sendRequests(ye.Thumbnail),r=this.sendRequests(ye.Prefetch),i=this.sendRequests(ye.Compute);!e&&!n&&!r&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort((r,i)=>r-i)}getRequestPool(){return this.requestPool}}const Jr=new c3("imageLoadPool");Jr.grabDelay=0;Jr.setMaxSimultaneousRequests(ye.Interaction,1e3);Jr.setMaxSimultaneousRequests(ye.Thumbnail,1e3);Jr.setMaxSimultaneousRequests(ye.Prefetch,1e3);const hC={};let i_;function mC(t,e){const n=Q.getImageLoadObject(t);if(n)return x8(n.promise,t),n;const r=t.split(":")[0],i=hC[r]||i_;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${r}'`);const a=i(t,e);return x8(a.promise,t),a}function x8(t,e){Promise.resolve(t).then(n=>{a_(n),Z(Y,X.IMAGE_LOADED,{image:n})}).catch(n=>{const r={imageId:e,error:n};Z(Y,X.IMAGE_LOAD_FAILED,r)})}function a_(t){if(!t.voxelManager){const{width:e,height:n,numberOfComponents:r}=t,i=ft.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:n,numberOfComponents:r});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function o_(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return mC(t,e).promise}function Vo(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=mC(t,e);return Q.getImageLoadObject(t)||Q.putImageLoadObject(t,n),n.promise}function s_(t,e={}){var h;if(t===void 0)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");e.imageId===void 0&&(e.imageId=`derived:${bt()}`);const{imageId:n,skipCreateBuffer:r,onCacheAdd:i}=e,a=ee("imagePlaneModule",t),o=a.rows*a.columns,{TypedArrayConstructor:s}=Y5((h=e.targetBuffer)==null?void 0:h.type,o),c=new s(r?1:o),l=n,f=ee("imagePlaneModule",t);ra.add(l,{type:"imagePlaneModule",metadata:f});const u=ee("generalSeriesModule",t);ra.add(l,{type:"generalSeriesModule",metadata:u}),ra.add(l,{type:"generalImageModule",metadata:{instanceNumber:e.instanceNumber}});const g=ee("imagePixelModule",t);ra.add(l,{type:"imagePixelModule",metadata:{...g,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const d=c_(n,{scalarData:c,onCacheAdd:i,skipCreateBuffer:r,targetBuffer:{type:c.constructor.name},dimensions:[a.columns,a.rows],spacing:[a.columnPixelSpacing,a.rowPixelSpacing],origin:a.imagePositionPatient,direction:a.imageOrientationPatient,frameOfReferenceUID:a.frameOfReferenceUID});return d.referencedImageId=t,Q.getImageLoadObject(n)||Q.putImageSync(n,d),d}function vC(t,e={}){if(t.length===0)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");return t.map((r,i)=>{var o;const a={imageId:((o=e==null?void 0:e.getDerivedImageId)==null?void 0:o.call(e,r))||`derived:${bt()}`,...e};return s_(r,{...a,instanceNumber:i+1})})}function c_(t,e){const{scalarData:n,origin:r,direction:i,targetBuffer:a,skipCreateBuffer:o,onCacheAdd:s,frameOfReferenceUID:c}=e,l=e.dimensions,f=e.spacing;if(!l||!f)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const u=l[0],g=l[1],d=f[0],h=f[1],p={frameOfReferenceUID:c,rows:g,columns:u,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:r??[0,0,0],pixelSpacing:[h,d],rowPixelSpacing:h,columnPixelSpacing:d},m=u*g,v=n.length/m;let y;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");y=n}else if(!o){const{numBytes:_,TypedArrayConstructor:P}=Y5(a==null?void 0:a.type,m);y=new P(m)}let C,T,S;if(y instanceof Uint8Array)C=8,T=8,S=7;else if(y instanceof Uint16Array)C=16,T=16,S=15;else if(y instanceof Int16Array)C=16,T=16,S=15;else if(y instanceof Float32Array)C=32,T=32,S=31;else throw new Error("Unsupported scalarData type");const x={samplesPerPixel:1,photometricInterpretation:y.length>l[0]*l[1]?"RGB":"MONOCHROME2",rows:g,columns:u,bitsAllocated:C,bitsStored:T,highBit:S},w={imagePlaneModule:p,imagePixelModule:x};["imagePlaneModule","imagePixelModule"].forEach(_=>{ra.add(t,{type:_,metadata:w[_]||{}})});const E=ft.createImageVoxelManager({height:g,width:u,numberOfComponents:v,scalarData:y});let M=y[0],O=y[0];for(let _=1;_<y.length;_++)y[_]<M&&(M=y[_]),y[_]>O&&(O=y[_]);const R={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:x.photometricInterpretation==="RGB",numberOfComponents:x.samplesPerPixel,dataType:a==null?void 0:a.type,slope:1,minPixelValue:M,maxPixelValue:O,rows:x.rows,columns:x.columns,getCanvas:void 0,height:x.rows,width:x.columns,rgba:void 0,columnPixelSpacing:p.columnPixelSpacing,rowPixelSpacing:p.rowPixelSpacing,FrameOfReferenceUID:p.frameOfReferenceUID,invert:!1,getPixelData:()=>E.getScalarData(),voxelManager:E,sizeInBytes:n.byteLength};return s==null||s(R),Q.putImageSync(R.imageId,R),R}function Mf(t,e){hC[t]=e}function yC(t,e={}){return vC(t,{...e,targetBuffer:{type:"Uint8Array"}})}const oh={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},dt={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(dt);const Qr=.001;function CC(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&CC(r)}return Object.freeze(t)}const l_={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},ia=CC(l_),TC=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],u_={slicer3D:[160/255,164/255,217/255]},SC=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:u_,CPU_COLORMAPS:oh,EPSILON:Qr,MPR_CAMERA_VALUES:ia,RENDERING_DEFAULTS:dt,VIEWPORT_PRESETS:TC},Symbol.toStringTag,{value:"Module"})),J0={},pl={get:t=>J0[t],set:t=>{const e=t.id;J0[e]=t},delete:t=>delete J0[t],getAll:()=>{const e=Object.keys(J0).map(n=>J0[n]);return e.sort((n,r)=>n.id[0]==="_"&&r.id[0]!=="_"?1:n.id[0]!=="_"&&r.id[0]==="_"?-1:0),e}};var f_=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var o=a[i];if(!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n};const xC=_l(f_);var w8=Object.prototype.toString,wC=function(e){var n=w8.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&w8.call(e.callee)==="[object Function]"),r},c2,E8;function g_(){if(E8)return c2;E8=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=wC,i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),o=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(g){var d=g.constructor;return d&&d.prototype===g},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var g in window)try{if(!l["$"+g]&&e.call(window,g)&&window[g]!==null&&typeof window[g]=="object")try{c(window[g])}catch{return!0}}catch{return!0}return!1}(),u=function(g){if(typeof window>"u"||!f)return c(g);try{return c(g)}catch{return!1}};t=function(d){var h=d!==null&&typeof d=="object",p=n.call(d)==="[object Function]",m=r(d),v=h&&n.call(d)==="[object String]",y=[];if(!h&&!p&&!m)throw new TypeError("Object.keys called on a non-object");var C=o&&p;if(v&&d.length>0&&!e.call(d,0))for(var T=0;T<d.length;++T)y.push(String(T));if(m&&d.length>0)for(var S=0;S<d.length;++S)y.push(String(S));else for(var x in d)!(C&&x==="prototype")&&e.call(d,x)&&y.push(String(x));if(a)for(var w=u(d),E=0;E<s.length;++E)!(w&&s[E]==="constructor")&&e.call(d,s[E])&&y.push(s[E]);return y}}return c2=t,c2}var d_=Array.prototype.slice,p_=wC,O8=Object.keys,Lf=O8?function(e){return O8(e)}:g_(),D8=Object.keys;Lf.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return p_(r)?D8(d_.call(r)):D8(r)})}else Object.keys=Lf;return Object.keys||Lf};var h_=Lf,m_=Error,v_=EvalError,y_=RangeError,C_=ReferenceError,EC=SyntaxError,OC=TypeError,T_=URIError,S_=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,n);if(o.value!==i||o.enumerable!==!0)return!1}return!0},R8=typeof Symbol<"u"&&Symbol,x_=S_,w_=function(){return typeof R8!="function"||typeof Symbol!="function"||typeof R8("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:x_()},l2={__proto__:null,foo:{}},E_=Object,O_=function(){return{__proto__:l2}.foo===l2.foo&&!(l2 instanceof E_)},D_="Function.prototype.bind called on incompatible ",R_=Object.prototype.toString,M_=Math.max,L_="[object Function]",M8=function(e,n){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var a=0;a<n.length;a+=1)r[a+e.length]=n[a];return r},I_=function(e,n){for(var r=[],i=n,a=0;i<e.length;i+=1,a+=1)r[a]=e[i];return r},V_=function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n},__=function(e){var n=this;if(typeof n!="function"||R_.apply(n)!==L_)throw new TypeError(D_+n);for(var r=I_(arguments,1),i,a=function(){if(this instanceof i){var f=n.apply(this,M8(r,arguments));return Object(f)===f?f:this}return n.apply(e,M8(r,arguments))},o=M_(0,n.length-r.length),s=[],c=0;c<o;c++)s[c]="$"+c;if(i=Function("binder","return function ("+V_(s,",")+"){ return binder.apply(this,arguments); }")(a),n.prototype){var l=function(){};l.prototype=n.prototype,i.prototype=new l,l.prototype=null}return i},b_=__,DC=Function.prototype.bind||b_,N_=Function.prototype.call,P_=Object.prototype.hasOwnProperty,k_=DC,F_=k_.call(N_,P_),Ie,U_=m_,A_=v_,B_=y_,G_=C_,l0=EC,Bs=OC,W_=T_,RC=Function,u2=function(t){try{return RC('"use strict"; return ('+t+").constructor;")()}catch{}},yo=Object.getOwnPropertyDescriptor;if(yo)try{yo({},"")}catch{yo=null}var f2=function(){throw new Bs},$_=yo?function(){try{return arguments.callee,f2}catch{try{return yo(arguments,"callee").get}catch{return f2}}}():f2,Zo=w_(),z_=O_(),jt=Object.getPrototypeOf||(z_?function(t){return t.__proto__}:null),ls={},H_=typeof Uint8Array>"u"||!jt?Ie:jt(Uint8Array),Co={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Ie:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Ie:ArrayBuffer,"%ArrayIteratorPrototype%":Zo&&jt?jt([][Symbol.iterator]()):Ie,"%AsyncFromSyncIteratorPrototype%":Ie,"%AsyncFunction%":ls,"%AsyncGenerator%":ls,"%AsyncGeneratorFunction%":ls,"%AsyncIteratorPrototype%":ls,"%Atomics%":typeof Atomics>"u"?Ie:Atomics,"%BigInt%":typeof BigInt>"u"?Ie:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Ie:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Ie:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Ie:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":U_,"%eval%":eval,"%EvalError%":A_,"%Float32Array%":typeof Float32Array>"u"?Ie:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Ie:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Ie:FinalizationRegistry,"%Function%":RC,"%GeneratorFunction%":ls,"%Int8Array%":typeof Int8Array>"u"?Ie:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Ie:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Ie:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Zo&&jt?jt(jt([][Symbol.iterator]())):Ie,"%JSON%":typeof JSON=="object"?JSON:Ie,"%Map%":typeof Map>"u"?Ie:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Zo||!jt?Ie:jt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Ie:Promise,"%Proxy%":typeof Proxy>"u"?Ie:Proxy,"%RangeError%":B_,"%ReferenceError%":G_,"%Reflect%":typeof Reflect>"u"?Ie:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Ie:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Zo||!jt?Ie:jt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Ie:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Zo&&jt?jt(""[Symbol.iterator]()):Ie,"%Symbol%":Zo?Symbol:Ie,"%SyntaxError%":l0,"%ThrowTypeError%":$_,"%TypedArray%":H_,"%TypeError%":Bs,"%Uint8Array%":typeof Uint8Array>"u"?Ie:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Ie:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Ie:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Ie:Uint32Array,"%URIError%":W_,"%WeakMap%":typeof WeakMap>"u"?Ie:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Ie:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Ie:WeakSet};if(jt)try{null.error}catch(t){var j_=jt(jt(t));Co["%Error.prototype%"]=j_}var K_=function t(e){var n;if(e==="%AsyncFunction%")n=u2("async function () {}");else if(e==="%GeneratorFunction%")n=u2("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=u2("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&jt&&(n=jt(i.prototype))}return Co[e]=n,n},L8={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Al=DC,L1=F_,q_=Al.call(Function.call,Array.prototype.concat),X_=Al.call(Function.apply,Array.prototype.splice),I8=Al.call(Function.call,String.prototype.replace),I1=Al.call(Function.call,String.prototype.slice),Y_=Al.call(Function.call,RegExp.prototype.exec),Z_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,J_=/\\(\\)?/g,Q_=function(e){var n=I1(e,0,1),r=I1(e,-1);if(n==="%"&&r!=="%")throw new l0("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new l0("invalid intrinsic syntax, expected opening `%`");var i=[];return I8(e,Z_,function(a,o,s,c){i[i.length]=s?I8(c,J_,"$1"):o||a}),i},eb=function(e,n){var r=e,i;if(L1(L8,r)&&(i=L8[r],r="%"+i[0]+"%"),L1(Co,r)){var a=Co[r];if(a===ls&&(a=K_(r)),typeof a>"u"&&!n)throw new Bs("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:a}}throw new l0("intrinsic "+e+" does not exist!")},MC=function(e,n){if(typeof e!="string"||e.length===0)throw new Bs("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Bs('"allowMissing" argument must be a boolean');if(Y_(/^%?[^%]*%?$/,e)===null)throw new l0("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=Q_(e),i=r.length>0?r[0]:"",a=eb("%"+i+"%",n),o=a.name,s=a.value,c=!1,l=a.alias;l&&(i=l[0],X_(r,q_([0,1],l)));for(var f=1,u=!0;f<r.length;f+=1){var g=r[f],d=I1(g,0,1),h=I1(g,-1);if((d==='"'||d==="'"||d==="`"||h==='"'||h==="'"||h==="`")&&d!==h)throw new l0("property names with quotes must have matching quotes");if((g==="constructor"||!u)&&(c=!0),i+="."+g,o="%"+i+"%",L1(Co,o))s=Co[o];else if(s!=null){if(!(g in s)){if(!n)throw new Bs("base intrinsic for "+e+" exists, but the property is not available.");return}if(yo&&f+1>=r.length){var p=yo(s,g);u=!!p,u&&"get"in p&&!("originalValue"in p.get)?s=p.get:s=s[g]}else u=L1(s,g),s=s[g];u&&!c&&(Co[o]=s)}}return s},tb=MC,If=tb("%Object.defineProperty%",!0)||!1;if(If)try{If({},"a",{value:1})}catch{If=!1}var LC=If,nb=MC,Vf=nb("%Object.getOwnPropertyDescriptor%",!0);if(Vf)try{Vf([],"length")}catch{Vf=null}var rb=Vf,V8=LC,ib=EC,Jo=OC,_8=rb,ab=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new Jo("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new Jo("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Jo("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Jo("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Jo("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Jo("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,o=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,c=!!_8&&_8(e,n);if(V8)V8(e,n,{configurable:o===null&&c?c.configurable:!o,enumerable:i===null&&c?c.enumerable:!i,value:r,writable:a===null&&c?c.writable:!a});else if(s||!i&&!a&&!o)e[n]=r;else throw new ib("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},sh=LC,IC=function(){return!!sh};IC.hasArrayLengthDefineBug=function(){if(!sh)return null;try{return sh([],"length",{value:1}).length!==1}catch{return!0}};var ob=IC,sb=h_,cb=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",lb=Object.prototype.toString,ub=Array.prototype.concat,b8=ab,fb=function(t){return typeof t=="function"&&lb.call(t)==="[object Function]"},VC=ob(),gb=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!fb(r)||!r())return}VC?b8(t,e,n,!0):b8(t,e,n)},_C=function(t,e){var n=arguments.length>2?arguments[2]:{},r=sb(e);cb&&(r=ub.call(r,Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i+=1)gb(t,r[i],e[r[i]],n[r[i]])};_C.supportsDescriptors=!!VC;var bC=_C,_f={exports:{}};typeof self<"u"?_f.exports=self:typeof window<"u"?_f.exports=window:_f.exports=Function("return this")();var NC=_f.exports,db=NC,PC=function(){return typeof tn!="object"||!tn||tn.Math!==Math||tn.Array!==Array?db:tn},pb=bC,hb=PC,mb=function(){var e=hb();if(pb.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},vb=bC,yb=NC,kC=PC,Cb=mb,Tb=kC(),FC=function(){return Tb};vb(FC,{getPolyfill:kC,implementation:yb,shim:Cb});var Sb=FC;const xb=_l(Sb),Or=xb(),UC={vtkObject:()=>null};function Lr(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Or.console&&Or.console.error&&Or.console.error("Invalid VTK object"),null;const e=UC[t.vtkClass];if(!e)return Or.console&&Or.console.error&&Or.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(i=>{n[i]&&typeof n[i]=="object"&&n[i].vtkClass&&(n[i]=Lr(n[i]))});const r=e(n);return r&&r.modified&&r.modified(),r}function wb(t,e){UC[t]=e}Lr.register=wb;class g2 extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let ch=0;const AC=Symbol("void");function Eb(){return ch}const BC={};function to(){}const Ob=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];Ob.forEach(t=>{BC[t]=to});Or.console=console.hasOwnProperty("log")?console:BC;const Sa={debug:to,error:Or.console.error||to,info:Or.console.info||to,log:Or.console.log||to,warn:Or.console.warn||to};function GC(t,e){Sa[t]&&(Sa[t]=e||to)}function WC(){Sa.log(...arguments)}function $C(){Sa.info(...arguments)}function V1(){Sa.debug(...arguments)}function Oe(){Sa.error(...arguments)}function Ag(){Sa.warn(...arguments)}const N8={};function zC(t){N8[t]||(Sa.error(t),N8[t]=!0)}const vn=Object.create(null);vn.Float32Array=Float32Array;vn.Float64Array=Float64Array;vn.Uint8Array=Uint8Array;vn.Int8Array=Int8Array;vn.Uint16Array=Uint16Array;vn.Int16Array=Int16Array;vn.Uint32Array=Uint32Array;vn.Int32Array=Int32Array;vn.Uint8ClampedArray=Uint8ClampedArray;try{vn.BigInt64Array=BigInt64Array,vn.BigUint64Array=BigUint64Array}catch{}function L0(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(vn[t]||Float64Array)(...n)}function Bg(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(vn[t]||Float64Array).from(...n)}function Gg(t){return t.charAt(0).toUpperCase()+t.slice(1)}function wt(t){return Gg(t[0]==="_"?t.slice(1):t)}function HC(t){return t.charAt(0).toLowerCase()+t.slice(1)}function jC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let i=Number(t),a="B";for(;i>n;)i/=n,a=r.pop();return`${i.toFixed(e)} ${a}`}function KC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function qC(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function Db(t){return Object.values(vn).some(e=>t instanceof e)}function Rb(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function Mb(t,e){return Object.keys(t).find(n=>t[n]===e)}function XC(t){return t&&t.isA?t.getState():t}function l3(t){setTimeout(t,0)}function YC(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function je(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};qC(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++ch),!("classHierarchy"in e))e.classHierarchy=new g2("vtkObject");else if(!(e.classHierarchy instanceof g2)){const a=new g2;for(let o=0;o<e.classHierarchy.length;o++)a.push(e.classHierarchy[o]);e.classHierarchy=a}function r(a){n[a]=null}function i(a){function o(){r(a)}return Object.freeze({unsubscribe:o})}return t.isDeleted=()=>!!e.deleted,t.modified=a=>{if(e.deleted){Oe("instance deleted - cannot call any method");return}a&&a<t.getMTime()||(e.mtime=++ch,n.forEach(o=>o&&o(t)))},t.onModified=a=>{if(e.deleted)return Oe("instance deleted - cannot call any method"),null;const o=n.length;return n.push(a),i(o)},t.getMTime=()=>e.mtime,t.isA=a=>{let o=e.classHierarchy.length;for(;o--;)if(e.classHierarchy[o]===a)return!0;return!1},t.getClassName=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-a]},t.set=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(a).forEach(l=>{const f=s?null:t[`set${Gg(l)}`];f&&Array.isArray(a[l])&&f.length>1?c=f(...a[l])||c:f?c=f(a[l])||c:(["mtime"].indexOf(l)===-1&&!o&&Ag(`Warning: Set value to model directly ${l}, ${a[l]}`),c=e[l]!==a[l]||c,e[l]=a[l])}),c},t.get=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];if(!o.length)return e;const c={};return o.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=a=>e[a],t.delete=()=>{Object.keys(e).forEach(a=>delete e[a]),n.forEach((a,o)=>r(o)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const a={...e,vtkClass:t.getClassName()};Object.keys(a).forEach(s=>{a[s]===null||a[s]===void 0||s[0]==="_"?delete a[s]:a[s].isA?a[s]=a[s].getState():Array.isArray(a[s])?a[s]=a[s].map(XC):Db(a[s])&&(a[s]=Array.from(a[s]))});const o={};return Object.keys(a).sort().forEach(s=>{o[s]=a[s]}),o.mtime&&delete o.mtime,o},t.shallowCopy=function(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(a.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${a.getClassName()} into ${t.getClassName()}`);const s=a.get(),c=Object.keys(e).sort();Object.keys(s).sort().forEach(f=>{const u=c.indexOf(f);u===-1?o&&V1(`add ${f} in shallowCopy`):c.splice(u,1),e[f]=s[f]}),c.length&&o&&V1(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const Lb={object(t,e,n){return function(){return{...e[n.name]}}}};function In(t,e,n){n.forEach(r=>{if(typeof r=="object"){const i=Lb[r.type];i?t[`get${wt(r.name)}`]=i(t,e,r):t[`get${wt(r.name)}`]=()=>e[r.name]}else t[`get${wt(r)}`]=()=>e[r]})}const ZC={enum(t,e,n){const r=`_on${wt(n.name)}Changed`;return i=>{var a;if(typeof i=="string"){if(n.enum[i]!==void 0)return e[n.name]!==n.enum[i]?(e[n.name]=n.enum[i],t.modified(),!0):!1;throw Oe(`Set Enum with invalid argument ${n}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[n.name]!==i){if(Object.keys(n.enum).map(o=>n.enum[o]).indexOf(i)!==-1){const o=e[n.name];return e[n.name]=i,(a=e[r])==null||a.call(e,t,e,i,o),t.modified(),!0}throw Oe(`Set Enum outside numeric range ${n}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw Oe(`Set Enum with invalid argument (String/Number) ${n}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){var i;((i=n.params)==null?void 0:i.length)===1&&Ag('Setter of type "object" with a single "param" field is not supported');const r=`_on${wt(n.name)}Changed`;return function(){var l,f;for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];let c;if(o.length>1&&((l=n.params)!=null&&l.length)?c=n.params.reduce((u,g,d)=>Object.assign(u,{[g]:o[d]}),{}):c=o[0],!xC(e[n.name],c)){const u=e[n.name];return e[n.name]=c,(f=e[r])==null||f.call(e,t,e,c,u),t.modified(),!0}return!1}}};function P8(t){if(typeof t=="object"){const e=ZC[t.type];if(e)return(n,r)=>e(n,r,t);throw Oe(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const i=`_on${wt(t)}Changed`;return function(o){var s;if(r.deleted)return Oe("instance deleted - cannot call any method"),!1;if(r[t]!==o){const c=r[t.name];return r[t]=o,(s=r[i])==null||s.call(r,n,r,o,c),n.modified(),!0}return!1}}}function Bl(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${wt(r.name)}`]=P8(r)(t,e):t[`set${wt(r)}`]=P8(r)(t,e)})}function Ot(t,e,n){In(t,e,n),Bl(t,e,n)}function I0(t,e,n){n.forEach(r=>{t[`get${wt(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${wt(r)}ByReference`]=()=>e[r]})}function u3(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(a=>{if(e[a]&&r&&e[a].length!==r)throw new RangeError(`Invalid initial number of values for array (${a})`);const o=`_on${wt(a)}Changed`;t[`set${wt(a)}`]=function(){var d;if(e.deleted)return Oe("instance deleted - cannot call any method"),!1;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];let f=c,u,g=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],g=!0),f==null)u=e[a]!==f;else{if(r&&f.length!==r)if(f.length<r&&i!==void 0)for(f=Array.from(f),g=!1;f.length<r;)f.push(i);else throw new RangeError(`Invalid number of values for array setter (${a})`);u=e[a]==null||e[a].length!==f.length;for(let h=0;!u&&h<f.length;++h)u=e[a][h]!==f[h];u&&g&&(f=Array.from(f))}if(u){const h=e[a.name];e[a]=f,(d=e[o])==null||d.call(e,t,e,f,h),t.modified()}return u},t[`set${wt(a)}From`]=s=>{const c=e[a];s.forEach((l,f)=>{c[f]=l})}})}function f3(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;I0(t,e,n),u3(t,e,n,r,i)}function Gl(t,e,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function g3(t,e,n,r){e.inputData?e.inputData=e.inputData.map(Lr):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Lr):e.inputConnection=[],e.output?e.output=e.output.map(Lr):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Lr):e.inputArrayToProcess=[],e.numberOfInputs=n;function i(d){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){Oe("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){Oe(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[h]!==d||e.inputConnection[h])&&(e.inputData[h]=d,e.inputConnection[h]=null,t.modified&&t.modified())}function a(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[d]&&(e.inputData[d]=e.inputConnection[d]()),e.inputData[d]}function o(d){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){Oe("instance deleted - cannot call any method");return}if(h>=e.numberOfInputs){let p=`algorithm ${t.getClassName()} only has `;p+=`${e.numberOfInputs}`,p+=" input ports. To add more input ports, use addInputConnection()",Oe(p);return}e.inputData[h]=null,e.inputConnection[h]=d}function s(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[d]}function c(){let d=e.numberOfInputs;for(;d&&!e.inputData[d-1]&&!e.inputConnection[d-1];)d--;return d===e.numberOfInputs&&e.numberOfInputs++,d}function l(d){if(e.deleted){Oe("instance deleted - cannot call any method");return}o(d,c())}function f(d){if(e.deleted){Oe("instance deleted - cannot call any method");return}i(d,c())}function u(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(Oe("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[d])}t.shouldUpdate=()=>{var m,v;const d=t.getMTime();let h=1/0,p=r;for(;p--;){if(!e.output[p]||e.output[p].isDeleted())return!0;const y=e.output[p].getMTime();if(y<d)return!0;y<h&&(h=y)}for(p=e.numberOfInputs;p--;)if((m=e.inputConnection[p])!=null&&m.filter.shouldUpdate()||((v=t.getInputData(p))==null?void 0:v.getMTime())>h)return!0;return!1};function g(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const h=()=>u(d);return h.filter=t,h}if(e.numberOfInputs){let d=e.numberOfInputs;for(;d--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=o,t.addInputData=f,t.addInputConnection=l,t.getInputData=a,t.getInputConnection=s}r&&(t.getOutputData=u,t.getOutputPort=g),t.update=()=>{const d=[];if(e.numberOfInputs){let h=0;for(;h<e.numberOfInputs;)d[h]=t.getInputData(h),h++}t.shouldUpdate()&&t.requestData&&t.requestData(d,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=d=>{const h=e.inputArrayToProcess[d],p=e.inputData[d];return h&&p?p[`get${h.fieldAssociation}`]().getArray(h.arrayName):null},t.setInputArrayToProcess=function(d,h,p){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<d;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[d]={arrayName:h,fieldAssociation:p,attributeType:m}}}const d3=Symbol("Event abort");function JC(t,e,n){const r=[],i=t.delete;let a=1;function o(l){for(let f=0;f<r.length;++f){const[u]=r[f];if(u===l){r.splice(f,1);return}}}function s(l){function f(){o(l)}return Object.freeze({unsubscribe:f})}function c(){if(e.deleted){Oe("instance deleted - cannot call any method");return}const l=r.slice();for(let f=0;f<l.length;++f){const[,u,g]=l[f];if(u){if(g<0)setTimeout(()=>u.apply(t,arguments),1-g);else if(u.apply(t,arguments)===d3)break}}}t[`invoke${wt(n)}`]=c,t[`on${wt(n)}`]=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return Oe("instance deleted - cannot call any method"),null;const u=a++;return r.push([u,l,f]),r.sort((g,d)=>d[2]-g[2]),s(u)},t.delete=()=>{i(),r.forEach(l=>{let[f]=l;return o(f)})}}function be(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},a={};return t(a,i,r),Object.freeze(a)};return e&&Lr.register(e,n),n}function Wl(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e.filter(o=>!!o).map(o=>o(...i))}}function p3(t){return t&&t.isA&&t.isA("vtkObject")}function _1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(p3(t)){if(r.indexOf(t)>=0)return n;r.push(t);const i=e(t);i!==void 0&&n.push(i);const a=t.get();Object.keys(a).forEach(o=>{const s=a[o];Array.isArray(s)?s.forEach(c=>{_1(c,e,n,r)}):_1(s,e,n,r)})}return n}function QC(t,e,n){var r=this;let i;const a=function(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];const l=r,f=()=>{i=null,n||t.apply(l,s)},u=n&&!i;clearTimeout(i),i=setTimeout(f,e),u&&t.apply(l,s)};return a.cancel=()=>clearTimeout(i),a}function eT(t,e){let n=!1,r=null;function i(){n=!1,r!==null&&(a(...r),r=null)}function a(){for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];if(n){r=s;return}n=!0,t(...s),setTimeout(i,e)}return a}function h3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,i)=>{e.keystore[r]=i},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let Ib=1;const Eu="__root__";function tT(t,e){h3(t,e);const n=t.delete;e.proxyId=`${Ib++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),In(t,e,["proxyId","proxyGroup","proxyName"]),Ot(t,e,["proxyManager"]);const r={},i={};function a(l,f){i[f]||(i[f]=[]);const u=i[f];for(let g=0;g<l.length;g++)u.push(l[g].name),r[l[g].name]=l[g],l[g].children&&l[g].children.length&&a(l[g].children,l[g].name)}a(e.ui,Eu),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(r).forEach(f=>delete r[f]),Object.keys(i).forEach(f=>delete i[f]),a(e.ui,Eu),t.modified()};function o(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Eu;return i[l]}t.updateProxyProperty=(l,f)=>{const u=r[l];u?Object.assign(u,f):r[l]={...f}},t.activate=()=>{if(e.proxyManager){const l=`setActive${wt(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,f)=>{f in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[f]=[]),e.propertyLinkSubscribers[f].push(l)},t.gcPropertyLinks=l=>{const f=e.propertyLinkSubscribers[l]||[];for(;f.length;)f.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let u=null;const g=[];let d=0,h=!1;function p(T){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(h)return null;const x=[];let w=null;for(d=g.length;d--;){const M=g[d];M.instance===T?w=M:x.push(M)}if(!w)return null;const E=w.instance[`get${wt(w.propertyName)}`]();if(!Rb(E,u)||S){for(u=E,h=!0;x.length;){const M=x.pop();M.instance.set({[M.propertyName]:u})}h=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=E),E}function m(T,S){const x=[];for(d=g.length;d--;){const w=g[d];w.instance===T&&(w.propertyName===S||S===void 0)&&(w.subscription.unsubscribe(),x.push(d))}for(;x.length;)g.splice(x.pop(),1)}function v(T,S){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const w=T.onModified(p),E=g[0];return g.push({instance:T,propertyName:S,subscription:w}),x&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?T.set({[S]:e.propertyLinkMap[l].value}):E&&p(E.instance,!0)),{unsubscribe:()=>m(T,S)}}function y(){for(;g.length;)g.pop().subscription.unsubscribe()}const C={bind:v,unbind:m,unsubscribe:y,persistent:f};return e.propertyLinkMap[l]=C,C};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Eu;const f=[],u=e.proxyId,g=o(l)||[];for(let d=0;d<g.length;d++){const h=g[d],p=t[`get${wt(h)}`],m=p?p():void 0,v={id:u,name:h,value:m},y=s(h);y.length&&(v.children=y),f.push(v)}return f}t.listPropertyNames=()=>s().map(l=>l.name),t.getPropertyByName=l=>s().find(f=>f.name===l),t.getPropertyDomainByName=l=>(r[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let f=l.length;for(;f--;)e.propertyLinkMap[l[f]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:f,property:u,persistent:g,updateOnBind:d,type:h}=e.links[l];if(h==="application"){const p=e.proxyManager.getPropertyLink(f,g);t.registerPropertyLinkForGC(p,"application"),p.bind(t,u,d)}}}l3(c)}function nT(t,e,n){const r=t.delete,i=[],a=Object.keys(n);let o=a.length;for(;o--;){const s=a[o],{modelKey:c,property:l,modified:f=!0}=n[s],u=wt(l),g=wt(s);t[`get${g}`]=e[c][`get${u}`],t[`set${g}`]=e[c][`set${u}`],f&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();r()}}function rT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const c=Object.keys(s);let l=c.length;for(;l--;){const f=c[l];e[f].set(s[f])}}const a=Object.keys(r);let o=a.length;for(;o--;){const s=a[o];e[s]=r[s];const c=n[s];t[`set${wt(s)}`]=l=>{if(l!==e[s]){e[s]=l;const f=c[l];i(f),t.modified()}}}a.length&&In(t,e,a)}const k8=10,F8=40,U8=800;function iT(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*k8,i=n*k8,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=F8,i*=F8):(r*=U8,i*=U8)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:i||r}}var D={algo:g3,capitalize:Gg,chain:Wl,debounce:QC,enumToString:Mb,event:JC,EVENT_ABORT:d3,formatBytesToProperUnit:jC,formatNumbersWithThousandSeparator:KC,get:In,getArray:I0,getCurrentGlobalMTime:Eb,getStateArrayMapFunc:XC,isVtkObject:p3,keystore:h3,measurePromiseExecution:YC,moveToProtected:Gl,newInstance:be,newTypedArray:L0,newTypedArrayFrom:Bg,normalizeWheel:iT,obj:je,proxy:tT,proxyPropertyMapping:nT,proxyPropertyState:rT,safeArrays:qC,set:Bl,setArray:u3,setGet:Ot,setGetArray:f3,setImmediate:l3,setLoggerFunction:GC,throttle:eT,traverseInstanceTree:_1,TYPED_ARRAYS:vn,uncapitalize:HC,VOID:AC,vtkDebugMacro:V1,vtkErrorMacro:Oe,vtkInfoMacro:$C,vtkLogMacro:WC,vtkOnceErrorMacro:zC,vtkWarningMacro:Ag,objectSetterMap:ZC},cn=Object.freeze({__proto__:null,VOID:AC,setLoggerFunction:GC,vtkLogMacro:WC,vtkInfoMacro:$C,vtkDebugMacro:V1,vtkErrorMacro:Oe,vtkWarningMacro:Ag,vtkOnceErrorMacro:zC,TYPED_ARRAYS:vn,newTypedArray:L0,newTypedArrayFrom:Bg,capitalize:Gg,_capitalize:wt,uncapitalize:HC,formatBytesToProperUnit:jC,formatNumbersWithThousandSeparator:KC,setImmediateVTK:l3,measurePromiseExecution:YC,obj:je,get:In,set:Bl,setGet:Ot,getArray:I0,setArray:u3,setGetArray:f3,moveToProtected:Gl,algo:g3,EVENT_ABORT:d3,event:JC,newInstance:be,chain:Wl,isVtkObject:p3,traverseInstanceTree:_1,debounce:QC,throttle:eT,keystore:h3,proxy:tT,proxyPropertyMapping:nT,proxyPropertyState:rT,normalizeWheel:iT,default:D});const Vb={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Se={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},_b=Se.FLOAT;var aT={DefaultDataType:_b,DataTypeByteSize:Vb,VtkDataTypes:Se};const bb="WebGL",b1=Object.create(null);function oT(t,e){b1[t]=e}function Nb(){return Object.keys(b1)}function sT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return b1[t]&&b1[t](e)}function Pb(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return sT(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const i=r.getViewProps(),a=e._views[0].getViewNodeFor(r);i.forEach(o=>{if(o.getVisibility()){n.propCount+=1;const s=o.getMapper&&o.getMapper();if(s&&s.getPrimitiveCount){const c=a.getViewNodeFor(s);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const l=s.getPrimitiveCount();Object.keys(l).forEach(f=>{n[f]||(n[f]=0),n[f]+=l[f]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return D.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(n,r):void 0).filter(i=>!!i)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(i=>i===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const kb={defaultViewAPI:bb,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function cT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kb,n),D.obj(t,e),D.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),D.get(t,e,["neverRendered"]),D.getArray(t,e,["renderers","childRenderWindows"]),D.moveToProtected(t,e,["views"]),D.event(t,e,"completion"),Pb(t,e)}const Fb=D.newInstance(cT,"vtkRenderWindow");var Ub={newInstance:Fb,extend:cT,registerViewConstructor:oT,listViewAPIs:Nb,newAPISpecificView:sT};const hl={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},oe={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var lT={Wrap:hl,Filter:oe};const uT=new Float32Array(1),Ab=new Int32Array(uT.buffer);function Bb(t){uT[0]=t;const e=Ab[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(i===255?0:1)&&e&8388607,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=r&1,n)}function Gb(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var no={fromHalf:Gb,toHalf:Bb},m3={exports:{}};m3.exports;(function(t){(function(e,n,r){function i(c){var l=this,f=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(c),l.s0<0&&(l.s0+=1),l.s1-=f(c),l.s1<0&&(l.s1+=1),l.s2-=f(c),l.s2<0&&(l.s2+=1),f=null}function a(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function o(c,l){var f=new i(c),u=l&&l.state,g=f.next;return g.int32=function(){return f.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,u&&(typeof u=="object"&&a(u,f),g.state=function(){return a(f,{})}),g}function s(){var c=4022871197,l=function(f){f=String(f);for(var u=0;u<f.length;u++){c+=f.charCodeAt(u);var g=.02519603282416938*c;c=g>>>0,g-=c,g*=c,c=g>>>0,g-=c,c+=g*4294967296}return(c>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=o:this.alea=o})(tn,t)})(m3);var Wb=m3.exports,v3={exports:{}};v3.exports;(function(t){(function(e,n,r){function i(s){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var u=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^u^u>>>8},s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xor128=o})(tn,t)})(v3);var $b=v3.exports,y3={exports:{}};y3.exports;(function(t){(function(e,n,r){function i(s){var c=this,l="";c.next=function(){var u=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(u^u<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,f==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xorwow=o})(tn,t)})(y3);var zb=y3.exports,C3={exports:{}};C3.exports;(function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var f=c.x,u=c.i,g,d;return g=f[u],g^=g>>>7,d=g^g<<24,g=f[u+1&7],d^=g^g>>>10,g=f[u+3&7],d^=g^g>>>3,g=f[u+4&7],d^=g^g<<7,g=f[u+7&7],g=g^g<<13,d^=g^g<<9,f[u]=d,c.i=u+1&7,d};function l(f,u){var g,d=[];if(u===(u|0))d[0]=u;else for(u=""+u,g=0;g<u.length;++g)d[g&7]=d[g&7]<<15^u.charCodeAt(g)+d[g+1&7]<<13;for(;d.length<8;)d.push(0);for(g=0;g<8&&d[g]===0;++g);for(g==8?d[7]=-1:d[g],f.x=d,f.i=0,g=256;g>0;--g)f.next()}l(c,s)}function a(s,c){return c.x=s.x.slice(),c.i=s.i,c}function o(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(f.x&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xorshift7=o})(tn,t)})(C3);var Hb=C3.exports,T3={exports:{}};T3.exports;(function(t){(function(e,n,r){function i(s){var c=this;c.next=function(){var f=c.w,u=c.X,g=c.i,d,h;return c.w=f=f+1640531527|0,h=u[g+34&127],d=u[g=g+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,h=u[g]=h^d,c.i=g,h+(f^f>>>16)|0};function l(f,u){var g,d,h,p,m,v=[],y=128;for(u===(u|0)?(d=u,u=null):(u=u+"\0",d=0,y=Math.max(y,u.length)),h=0,p=-32;p<y;++p)u&&(d^=u.charCodeAt((p+32)%u.length)),p===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(m=m+1640531527|0,g=v[p&127]^=d+m,h=g==0?h+1:0);for(h>=128&&(v[(u&&u.length||0)&127]=-1),h=127,p=4*128;p>0;--p)d=v[h+34&127],g=v[h=h+1&127],d^=d<<13,g^=g<<17,d^=d>>>15,g^=g>>>12,v[h]=d^g;f.w=m,f.X=v,f.i=h}l(c,s)}function a(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function o(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(f.X&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.xor4096=o})(tn,t)})(T3);var jb=T3.exports,S3={exports:{}};S3.exports;(function(t){(function(e,n,r){function i(s){var c=this,l="";c.next=function(){var u=c.b,g=c.c,d=c.d,h=c.a;return u=u<<25^u>>>7^g,g=g-d|0,d=d<<24^d>>>8^h,h=h-u|0,c.b=u=u<<20^u>>>12^g,c.c=g=g-d|0,c.d=d<<16^g>>>16^h,c.a=h-u|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):l+=s;for(var f=0;f<l.length+20;f++)c.b^=l.charCodeAt(f)|0,c.next()}function a(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function o(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var g=l.next()>>>11,d=(l.next()>>>0)/4294967296,h=(g+d)/(1<<21);while(h===0);return h},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&a(f,l),u.state=function(){return a(l,{})}),u}n&&n.exports?n.exports=o:this.tychei=o})(tn,t)})(S3);var Kb=S3.exports,fT={exports:{}};const qb={},Xb=Object.freeze(Object.defineProperty({__proto__:null,default:qb},Symbol.toStringTag,{value:"Module"})),gT=fM(Xb);(function(t){(function(e,n,r){var i=256,a=6,o=52,s="random",c=r.pow(i,a),l=r.pow(2,o),f=l*2,u=i-1,g;function d(T,S,x){var w=[];S=S==!0?{entropy:!0}:S||{};var E=v(m(S.entropy?[T,C(n)]:T??y(),3),w),M=new h(w),O=function(){for(var R=M.g(a),_=c,P=0;R<l;)R=(R+P)*i,_*=i,P=M.g(1);for(;R>=f;)R/=2,_/=2,P>>>=1;return(R+P)/_};return O.int32=function(){return M.g(4)|0},O.quick=function(){return M.g(4)/4294967296},O.double=O,v(C(M.S),n),(S.pass||x||function(R,_,P,N){return N&&(N.S&&p(N,M),R.state=function(){return p(M,{})}),P?(r[s]=R,_):R})(O,E,"global"in S?S.global:this==r,S.state)}function h(T){var S,x=T.length,w=this,E=0,M=w.i=w.j=0,O=w.S=[];for(x||(T=[x++]);E<i;)O[E]=E++;for(E=0;E<i;E++)O[E]=O[M=u&M+T[E%x]+(S=O[E])],O[M]=S;(w.g=function(R){for(var _,P=0,N=w.i,W=w.j,U=w.S;R--;)_=U[N=u&N+1],P=P*i+U[u&(U[N]=U[W=u&W+_])+(U[W]=_)];return w.i=N,w.j=W,P})(i)}function p(T,S){return S.i=T.i,S.j=T.j,S.S=T.S.slice(),S}function m(T,S){var x=[],w=typeof T,E;if(S&&w=="object")for(E in T)try{x.push(m(T[E],S-1))}catch{}return x.length?x:w=="string"?T:T+"\0"}function v(T,S){for(var x=T+"",w,E=0;E<x.length;)S[u&E]=u&(w^=S[u&E]*19)+x.charCodeAt(E++);return C(S)}function y(){try{var T;return g&&(T=g.randomBytes)?T=T(i):(T=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(T)),C(T)}catch{var S=e.navigator,x=S&&S.plugins;return[+new Date,e,x,e.screen,C(n)]}}function C(T){return String.fromCharCode.apply(0,T)}if(v(r.random(),n),t.exports){t.exports=d;try{g=gT}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:tn,[],Math)})(fT);var Yb=fT.exports,Zb=Wb,Jb=$b,Qb=zb,eN=Hb,tN=jb,nN=Kb,jo=Yb;jo.alea=Zb;jo.xor128=Jb;jo.xorwow=Qb;jo.xorshift7=eN;jo.xor4096=tN;jo.tychei=nN;var rN=jo;const iN=_l(rN),x3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],aN=[1,0,0,0,1,0,0,0,1],w3=1e-6,E3=1e-12,{vtkErrorMacro:dT,vtkWarningMacro:_o}=D;let pT=0;const A8=20;function $l(t){return()=>dT(`vtkMath::${t} - NOT IMPLEMENTED`)}function Nc(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[n*e+a],t[n*e+a]=t[r*e+a],t[r*e+a]=i}function mc(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[a*e+n],t[a*e+n]=t[a*e+r],t[a*e+r]=i}function Xe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const oN=()=>Math.PI;function gt(t){return t/180*Math.PI}function N1(t){return t*180/Math.PI}const{round:vc,floor:O3,ceil:sN,min:cN,max:lN}=Math;function uN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let i=e,a=t.length;i<a;i+=n)t[i]<r&&(r=t[i]);return r}function fN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let i=e,a=t.length;i<a;i+=n)r<t[i]&&(r=t[i]);return r}function gN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,i=-1/0;for(let a=e,o=t.length;a<o;a+=n)t[a]<r&&(r=t[a]),i<t[a]&&(i=t[a]);return[r,i]}const dN=$l("ceilLog2"),pN=$l("factorial");function cr(t){let e=1;for(;e<t;)e*=2;return e}function yc(t){return t===cr(t)}function hN(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function mN(t,e){if(t<e)return 0;const n=Xe(e);for(let r=0;r<e;++r)n[r]=r;return n}function vN(t,e,n){let r=0;for(let i=e-1;i>=0;--i)if(n[i]<t-e+i){let a=n[i]+1;for(;i<e;)n[i++]=a++;r=1;break}return r}function yN(t){iN(`${t}`,{global:!0}),pT=t}function CN(){return pT}function TN(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const SN=$l("gaussian");function P1(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function xi(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function hT(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function mT(t,e){return t[0]*=e,t[1]*=e,t}function lh(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function xN(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function Te(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function wN(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function ei(t,e,n){const r=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=i,n[2]=a,n}function aa(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function bo(t){const e=aa(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function EN(t,e,n,r){const i=t[0]*t[0],a=t[1]*t[1],o=t[2]*t[2],s=Math.sqrt(i+a+o);let c,l,f;i>a&&i>o?(c=0,l=1,f=2):a>o?(c=1,l=2,f=0):(c=2,l=0,f=1);const u=t[c]/s,g=t[l]/s,d=t[f]/s,h=Math.sqrt(u*u+d*d);if(r!==0){const p=Math.sin(r),m=Math.cos(r);e&&(e[c]=(d*m-u*g*p)/h,e[l]=p*h,e[f]=(-(u*m)-g*d*p)/h),n&&(n[c]=(-(d*p)-u*g*m)/h,n[l]=m*h,n[f]=(u*p-g*d*m)/h)}else e&&(e[c]=d/h,e[l]=0,e[f]=-u/h),n&&(n[c]=-u*g/h,n[l]=h,n[f]=-g*d/h)}function ON(t,e,n){const r=Te(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const i=Te(t,e)/r;for(let a=0;a<3;a++)n[a]=e[a];return hT(n,i),!0}function uh(t,e){return t[0]*e[0]+t[1]*e[1]}function DN(t,e,n){const r=uh(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const i=uh(t,e)/r;for(let a=0;a<2;a++)n[a]=e[a];return mT(n,i),!0}function zr(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function RN(t,e){const n=[0,0,0];return ei(t,e,n),Math.atan2(aa(n),Te(t,e))}function MN(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function LN(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function IN(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function vT(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function yT(t){const e=vT(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function pt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function VN(t,e){let n,r,i;const a=[0,0,0];for(let o=0;o<3;o++)i=Math.abs(t[o*3]),(r=Math.abs(t[o*3+1]))>i&&(i=r),(r=Math.abs(t[o*3+2]))>i&&(i=r),a[o]=1/i;i=a[0]*Math.abs(t[0]),n=0,(r=a[1]*Math.abs(t[3]))>=i&&(i=r,n=1),(r=a[2]*Math.abs(t[6]))>=i&&(n=2),n!==0&&(Nc(t,3,n,0),a[n]=a[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=a[1]*Math.abs(t[4]),n=1,(r=a[2]*Math.abs(t[7]))>=i&&(n=2,Nc(t,3,1,2),a[2]=a[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function _N(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function bN(t,e,n){const r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],f=t[7],u=t[8],g=+pt(s,f,c,u),d=-pt(o,l,c,u),h=+pt(o,l,s,f),p=-pt(i,f,a,u),m=+pt(r,l,a,u),v=-pt(r,l,i,f),y=+pt(i,s,a,c),C=-pt(r,o,a,c),T=+pt(r,o,i,s),S=r*g+i*d+a*h,x=g*e[0]+p*e[1]+y*e[2],w=d*e[0]+m*e[1]+C*e[2],E=h*e[0]+v*e[1]+T*e[2];n[0]=x/S,n[1]=w/S,n[2]=E/S}function bf(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],a=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=i,n[2]=a}function fh(t,e,n){const r=[...t],i=[...e];for(let a=0;a<3;a++)n[a]=r[0]*i[a]+r[1]*i[a+3]+r[2]*i[a+6],n[a+3]=r[3]*i[a]+r[4]*i[a+3]+r[5]*i[a+6],n[a+6]=r[6]*i[a]+r[7]*i[a+3]+r[8]*i[a+6]}function NN(t,e,n,r,i,a,o){r!==i&&dT("Number of columns of A must match number of rows of B.");const s=[...t],c=[...e];for(let l=0;l<n;l++)for(let f=0;f<a;f++){o[l*a+f]=0;for(let u=0;u<r;u++)o[l*a+f]+=s[l*r+u]*c[f+a*u]}}function Gs(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function PN(t,e){const n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=+pt(o,l,s,f),g=-pt(a,c,s,f),d=+pt(a,c,o,l),h=-pt(r,l,i,f),p=+pt(n,c,i,f),m=-pt(n,c,r,l),v=+pt(r,o,i,s),y=-pt(n,a,i,s),C=+pt(n,a,r,o),T=n*u+r*g+i*d;T===0&&_o("Matrix has 0 determinant"),e[0]=u/T,e[3]=g/T,e[6]=d/T,e[1]=h/T,e[4]=p/T,e[7]=m/T,e[2]=v/T,e[5]=y/T,e[8]=C/T}function Wg(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function CT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:w3;if(t.length!==e.length)return!1;function r(i,a){return Math.abs(i-e[a])<=n}return t.every(r)}const zl=CT;function TT(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function ST(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function kN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w3;return zl(t,x3,e)}function FN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:w3;return zl(t,aN,e)}function xT(t,e){const n=t[0]*t[0],r=t[0]*t[1],i=t[0]*t[2],a=t[0]*t[3],o=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],f=t[1]*t[3],u=t[2]*t[3],g=o+s+c;let d=1/(n+g);const h=(n-g)*d;d*=2,e[0]=o*d+h,e[3]=(l+a)*d,e[6]=(f-i)*d,e[1]=(l-a)*d,e[4]=s*d+h,e[7]=(u+r)*d,e[2]=(f+i)*d,e[5]=(u-r)*d,e[8]=c*d+h}function Nf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function gh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=Nf(t[0],n),e[1]=Nf(t[1],n),e[2]=Nf(t[2],n),e}function Hl(t,e,n,r){let i,a,o,s,c,l,f,u,g,d,h,p,m,v,y,C;const T=Xe(e),S=Xe(e),x=(E,M,O)=>{v=E[M],m=E[O],E[M]=v-p*(m+v*d),E[O]=m+p*(v-m*d)};for(ST(e,r),c=0;c<e;c++)T[c]=n[c]=t[c+c*e],S[c]=0;for(i=0;i<A8;i++){for(h=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)h+=Math.abs(t[c*e+s]);if(h===0)break;for(i<3?f=.2*h/(e*e):f=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(v=100*Math.abs(t[c*e+s]),i>3&&Math.abs(n[c])+v===Math.abs(n[c])&&Math.abs(n[s])+v===Math.abs(n[s]))t[c*e+s]=0;else if(Math.abs(t[c*e+s])>f){for(m=n[s]-n[c],Math.abs(m)+v===Math.abs(m)?g=t[c*e+s]/m:(u=.5*m/t[c*e+s],g=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(g=-g)),y=1/Math.sqrt(1+g*g),p=g*y,d=p/(1+y),m=g*t[c*e+s],S[c]-=m,S[s]+=m,n[c]-=m,n[s]+=m,t[c*e+s]=0,a=0;a<=c-1;a++)x(t,a*e+c,a*e+s);for(a=c+1;a<=s-1;a++)x(t,c*e+a,a*e+s);for(a=s+1;a<e;a++)x(t,c*e+a,s*e+a);for(a=0;a<e;a++)x(r,a*e+c,a*e+s)}for(c=0;c<e;c++)T[c]+=S[c],n[c]=T[c],S[c]=0}if(i>=A8)return _o("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(a=0;a<e-1;a++){for(o=a,C=n[o],i=a+1;i<e;i++)(n[i]>=C||Math.abs(n[i]-C)<E3)&&(o=i,C=n[o]);o!==a&&(n[o]=n[a],n[a]=C,mc(r,e,a,o))}const w=(e>>1)+(e&1);for(l=0,i=0;i<e*e;i++)r[i]>=0&&l++;if(l<w)for(i=0;i<e;i++)r[i*e+a]*=-1;return 1}function wT(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=[...n];Hl(a,4,i,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function UN(t,e,n){const r=t[0]*e[0],i=t[0]*e[1],a=t[0]*e[2],o=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],f=t[1]*e[3],u=t[2]*e[0],g=t[2]*e[1],d=t[2]*e[2],h=t[2]*e[3],p=t[3]*e[0],m=t[3]*e[1],v=t[3]*e[2],y=t[3]*e[3];n[0]=r-c-d-y,n[1]=i+s+h-v,n[2]=a-f+u+m,n[3]=o+l-g+p}function ET(t,e){for(let g=0;g<9;g++)e[g]=t[g];const n=Xe(3),r=Xe(3);let i;for(let g=0;g<3;g++){const d=Math.abs(e[g*3]),h=Math.abs(e[g*3+1]),p=Math.abs(e[g*3+2]);i=h>d?h:d,i=p>i?p:i,n[g]=1,i!==0&&(n[g]/=i)}const a=Math.abs(e[0])*n[0],o=Math.abs(e[3])*n[1],s=Math.abs(e[6])*n[2];r[0]=0,i=a,o>=i&&(i=o,r[0]=1),s>=i&&(r[0]=2),r[0]!==0&&(mc(e,3,r[0],0),n[r[0]]=n[0]);const c=Math.abs(e[4])*n[1],l=Math.abs(e[7])*n[2];r[1]=1,i=c,l>=i&&(r[1]=2,mc(e,3,1,2)),r[2]=2;let f=0;if(Wg(e)<0){f=1;for(let g=0;g<9;g++)e[g]=-e[g]}const u=Xe(4);if(wT(e,u),xT(u,e),f)for(let g=0;g<9;g++)e[g]=-e[g];r[1]!==1&&mc(e,3,r[1],1),r[0]!==0&&mc(e,3,r[0],0)}function OT(t,e,n){let r,i,a,o,s,c;const l=[...t];if(Hl(l,3,e,n),e[0]===e[1]&&e[0]===e[2]){TT(n);return}for(Gs(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r*3]),o=0,i=1;i<3;i++)c<(s=Math.abs(n[r*3+i]))&&(c=s,o=i);o!==r&&(s=e[o],e[o]=e[r],e[r]=s,Nc(n,3,r,o)),n[o*3+o]<0&&(n[o*3]=-n[o*3],n[o*3+1]=-n[o*3+1],n[o*3+2]=-n[o*3+2]),i=(o+1)%3,a=(o+2)%3,n[i*3]=0,n[i*3+1]=0,n[i*3+2]=0,n[i*3+i]=1;const f=ei([n[o*3],n[o*3+1],n[o*3+2]],[n[i*3],n[i*3+1],n[i*3+2]],[]);bo(f);const u=ei(f,[n[o*3],n[o*3+1],n[o*3+2]],[]);for(let g=0;g<3;g++)n[a*3+g]=f[g],n[i*3+g]=u[g];Gs(n,n);return}for(c=Math.abs(n[0]),o=0,r=1;r<3;r++)c<(s=Math.abs(n[r*3]))&&(c=s,o=r);if(o!==0){const f=e[o];e[o]=e[0],e[0]=f,Nc(n,3,o,0)}if(Math.abs(n[4])<Math.abs(n[7])){const f=e[2];e[2]=e[1],e[1]=f,Nc(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);Wg(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),Gs(n,n)}function AN(t,e,n,r){let i;const a=[...t],o=Wg(a);if(o<0)for(i=0;i<9;i++)a[i]=-a[i];ET(a,e),Gs(a,a),fh(a,e,r),OT(r,n,r),fh(e,r,e),Gs(r,r),o<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function D3(t,e,n){let r,i,a,o,s=0,c,l,f;const u=Xe(n);for(r=0;r<n;r++){for(o=0,i=0;i<n;i++)(f=Math.abs(t[r*n+i]))>o&&(o=f);if(o===0)return _o("Unable to factor linear system"),0;u[r]=1/o}for(i=0;i<n;i++){for(r=0;r<i;r++){for(c=t[r*n+i],a=0;a<r;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c}for(o=0,r=i;r<n;r++){for(c=t[r*n+i],a=0;a<i;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c,(l=u[r]*Math.abs(c))>=o&&(o=l,s=r)}if(i!==s){for(a=0;a<n;a++)l=t[s*n+a],t[s*n+a]=t[i*n+a],t[i*n+a]=l;u[s]=u[i]}if(e[i]=s,Math.abs(t[i*n+i])<=E3)return _o("Unable to factor linear system"),0;if(i!==n-1)for(l=1/t[i*n+i],r=i+1;r<n;r++)t[r*n+i]*=l}return 1}function R3(t,e,n,r){let i,a,o,s,c;for(o=-1,i=0;i<r;i++){if(s=e[i],c=n[s],n[s]=n[i],o>=0)for(a=o;a<=i-1;a++)c-=t[i*r+a]*n[a];else c!==0&&(o=i);n[i]=c}for(i=r-1;i>=0;i--){for(c=n[i],a=i+1;a<r;a++)c-=t[i*r+a]*n[a];n[i]=c/t[i*r+i]}}function DT(t,e,n){if(n===2){const i=Xe(2),a=pt(t[0],t[1],t[2],t[3]);return a===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/a,i[1]=(-(t[2]*e[0])+t[0]*e[1])/a,e[0]=i[0],e[1]=i[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=Xe(n);return D3(t,r,n)===0?0:(R3(t,r,e,n),1)}function RT(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const a=r||Xe(n),o=i||Xe(n);if(D3(t,a,n)===0)return null;for(let s=0;s<n;s++){for(let c=0;c<n;c++)o[c]=0;o[s]=1,R3(t,a,o,n);for(let c=0;c<n;c++)e[c*n+s]=o[c]}return e}function BN(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let a=i;a<e;a++)Math.abs(t[i*e+a])>r&&(r=Math.abs(t[i*e+a]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<n&&(n=Math.abs(t[i*e+i]));return n===0?Number.MAX_VALUE:r/n}function GN(t,e,n){return Hl(t,3,e,n)}function dh(t,e,n,r){if(t<n)return _o("Insufficient number of samples. Underdetermined."),0;let i,a,o;const s=Xe(n*n),c=Xe(n),l=Xe(n*n);for(o=0;o<t;o++)for(i=0;i<n;i++)for(a=i;a<n;a++)s[i*n+a]+=e[o*n+i]*e[o*n+a];for(i=0;i<n;i++)for(a=0;a<i;a++)s[i*n+a]=s[a*n+i];for(Hl(s,n,c,l),i=0;i<n;i++)r[i]=l[i*n+n-1];return 1}function WN(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<i)return _o("Insufficient number of samples. Underdetermined."),0;const s=Xe(i);let c=1,l,f=0,u,g,d,h=0;if(o){for(g=0;g<i;g++)s[g]=1;for(u=0;u<t;u++)for(g=0;g<i;g++)Math.abs(r[u*i+g])>E3&&(c=0,s[g]=0);if(c&&i===1)return _o("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),dh(t,e,n,a);if(c)h=1;else for(g=0;g<i;g++)s[g]&&(h=1)}h&&(l=Xe(n),f=dh(t,e,n,l));const p=Xe(n*n),m=Xe(n*n),v=Xe(n*i);for(d=0;d<t;d++)for(u=0;u<n;u++){for(g=u;g<n;g++)p[u*n+g]+=e[d*n+u]*e[d*n+g];for(g=0;g<i;g++)v[u*i+g]+=e[d*n+u]*r[d*i+g]}for(u=0;u<n;u++)for(g=0;g<u;g++)p[u*n+g]=p[g*n+u];const y=RT(p,m,n);if(y)for(u=0;u<n;u++)for(g=0;g<i;g++)for(a[u*i+g]=0,d=0;d<n;d++)a[u*i+g]+=m[u*n+d]*v[d*i+g];if(h){for(g=0;g<i;g++)if(s[g])for(u=0;u<n;u++)a[u*i+g]=l[u*i]}return h?f&&y:y}function $N(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function Cc(t,e){let n,r;const[i,a,o]=t,s=1/3,c=1/6,l=2/3;let f=i,u=i;a>f?f=a:a<u&&(u=a),o>f?f=o:o<u&&(u=o);const g=f;g>0?r=(f-u)/f:r=0,r>0?(i===f?n=c*(a-o)/(f-u):a===f?n=s+c*(o-i)/(f-u):n=l+c*(i-a)/(f-u),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=g}function ro(t,e){const[n,r,i]=t,a=1/3,o=1/6,s=2/3,c=5/6;let l,f,u;n>o&&n<=a?(f=1,l=(a-n)/o,u=0):n>a&&n<=.5?(f=1,u=(n-a)/o,l=0):n>.5&&n<=s?(u=1,f=(s-n)/o,l=0):n>s&&n<=c?(u=1,l=(n-s)/o,f=0):n>c&&n<=1?(l=1,u=(1-n)/o,f=0):(l=1,f=n/o,u=0),l=r*l+(1-r),f=r*f+(1-r),u=r*u+(1-r),l*=i,f*=i,u*=i,e[0]=l,e[1]=f,e[2]=u}function MT(t,e){const[n,r,i]=t;let a=(n+16)/116,o=r/500+a,s=a-i/200;a**3>.008856?a**=3:a=(a-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const c=.9505,l=1,f=1.089;e[0]=c*o,e[1]=l*a,e[2]=f*s}function LT(t,e){const[n,r,i]=t,a=.9505,o=1,s=1.089;let c=n/a,l=r/o,f=i/s;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,f>.008856?f**=1/3:f=7.787*f+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-f)}function IT(t,e){const[n,r,i]=t;let a=n*3.2406+r*-1.5372+i*-.4986,o=n*-.9689+r*1.8758+i*.0415,s=n*.0557+r*-.204+i*1.057;a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let c=a;c<o&&(c=o),c<s&&(c=s),c>1&&(a/=c,o/=c,s/=c),a<0&&(a=0),o<0&&(o=0),s<0&&(s=0),e[0]=a,e[1]=o,e[2]=s}function VT(t,e){let[n,r,i]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=n*.4124+r*.3576+i*.1805,e[1]=n*.2126+r*.7152+i*.0722,e[2]=n*.0193+r*.1192+i*.9505}function fo(t,e){const n=[0,0,0];VT(t,n),LT(n,e)}function k1(t,e){const n=[0,0,0];MT(t,n),IT(n,e)}function V0(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function Pf(t){return!(t[1]-t[0]<0)}function zN(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function Ir(t,e,n){return t<e?e:t>n?n:t}function ph(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=Ir(t[0],e[0],n[0]),r[1]=Ir(t[1],e[1],n[1]),r[2]=Ir(t[2],e[2],n[2]),r}function HN(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const jN=$l("GetScalarTypeFittingRange"),KN=$l("GetAdjustedScalarRange");function qN(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function XN(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function YN(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function ZN(t,e,n,r){const i=Xe(3),a=Xe(3),o=Xe(3),s=Xe(3),c=Xe(3),l=Xe(3);for(let T=0;T<3;++T)i[T]=t[T]-e[T],a[T]=e[T]-n[T],o[T]=n[T]-t[T],s[T]=-i[T],c[T]=-a[T],l[T]=-o[T];const f=aa(s),u=aa(c),g=aa(o),d=Xe(3);ei(i,a,d);const h=aa(d),p=f*u*g/(2*h),m=2*h*h,v=u*u*Te(i,l)/m,y=g*g*Te(s,a)/m,C=f*f*Te(o,c)/m;for(let T=0;T<3;++T)r[T]=v*t[T]+y*e[T]+C*n[T];return p}const JN=1/0,QN=-1/0,_T=t=>!Number.isFinite(t),{isFinite:eP,isNaN:hh}=Number,F1=hh;function xa(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function tP(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const i=Math.abs(t[r]);i>e&&(n=r,e=i)}return n}function bT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let a=0;a<e;++a)n[a]=a,r[a]=a;for(let a=e-1;a>0;a--){let o=-1/0,s=0,c=0;for(let l=0;l<=a;++l){const f=n[l];for(let u=0;u<=a;++u){const g=r[u],d=Math.abs(t[f+e*g]);d>o&&(o=d,s=l,c=u)}}[n[a],n[s]]=[n[s],n[a]],[r[a],r[c]]=[r[c],r[a]]}const i=new Array(e*e).fill(0);for(let a=0;a<e;++a){const o=n[a]+e*r[a];i[o]=t[o]<0?-1:1}return i}function NT(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function nP(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(NT).join("")}`}function Ou(t){return Math.round(t*255)}function rP(t){return t.length===3?`rgb(${t.map(Ou).join(", ")})`:`rgba(${Ou(t[0]||0)}, ${Ou(t[1]||0)}, ${Ou(t[2]||0)}, ${t[3]||0})`}var Dr={Pi:oN,radiansFromDegrees:gt,degreesFromRadians:N1,round:vc,floor:O3,ceil:sN,ceilLog2:dN,min:cN,max:lN,arrayMin:uN,arrayMax:fN,arrayRange:gN,isPowerOfTwo:yc,nearestPowerOfTwo:cr,factorial:pN,binomial:hN,beginCombination:mN,nextCombination:vN,randomSeed:yN,getSeed:CN,random:TN,gaussian:SN,add:P1,subtract:xi,multiplyScalar:hT,multiplyScalar2D:mT,multiplyAccumulate:lh,multiplyAccumulate2D:xN,dot:Te,outer:wN,cross:ei,norm:aa,normalize:bo,perpendiculars:EN,projectVector:ON,projectVector2D:DN,distance2BetweenPoints:zr,angleBetweenVectors:RN,gaussianAmplitude:MN,gaussianWeight:LN,dot2D:uh,outer2D:IN,norm2D:vT,normalize2D:yT,determinant2x2:pt,LUFactor3x3:VN,LUSolve3x3:_N,linearSolve3x3:bN,multiply3x3_vect3:bf,multiply3x3_mat3:fh,multiplyMatrix:NN,transpose3x3:Gs,invert3x3:PN,identity3x3:TT,identity:ST,isIdentity:kN,isIdentity3x3:FN,determinant3x3:Wg,quaternionToMatrix3x3:xT,areEquals:CT,areMatricesEqual:zl,roundNumber:Nf,roundVector:gh,matrix3x3ToQuaternion:wT,multiplyQuaternion:UN,orthogonalize3x3:ET,diagonalize3x3:OT,singularValueDecomposition3x3:AN,solveLinearSystem:DT,invertMatrix:RT,luFactorLinearSystem:D3,luSolveLinearSystem:R3,estimateMatrixCondition:BN,jacobi:GN,jacobiN:Hl,solveHomogeneousLeastSquares:dh,solveLeastSquares:WN,hex2float:$N,rgb2hsv:Cc,hsv2rgb:ro,lab2xyz:MT,xyz2lab:LT,xyz2rgb:IT,rgb2xyz:VT,rgb2lab:fo,lab2rgb:k1,uninitializeBounds:V0,areBoundsInitialized:Pf,computeBoundsFromPoints:zN,clampValue:Ir,clampVector:ph,clampAndNormalizeValue:HN,getScalarTypeFittingRange:jN,getAdjustedScalarRange:KN,extentIsWithinOtherExtent:qN,boundsIsWithinOtherBounds:XN,pointIsWithinBounds:YN,solve3PointCircle:ZN,inf:JN,negInf:QN,isInf:_T,isNan:hh,isNaN:hh,isFinite:eP,createUninitializedBounds:xa,getMajorAxisIndex:tP,getSparseOrthogonalMatrix:bT,floatToHex2:NT,floatRGB2HexCode:nP,float2CssRGBA:rP};const{vtkErrorMacro:iP}=cn,{DefaultDataType:aP}=aT,oP=1e-6;function mh(t,e,n){const r=t.length;let i=Number.MAX_VALUE,a=-Number.MAX_VALUE,o,s;for(s=e;s<r;s+=n)if(!Number.isNaN(t[s])){i=t[s],a=i;break}for(;s<r;s+=n)o=t[s],o<i?i=o:o>a&&(a=o);return{min:i,max:a}}function sP(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(i){t>i&&(t=i),e<i&&(e=i),n++,r+=i},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function PT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const i=t.length/n,a=new Float64Array(i);for(let o=0,s=0;o<i;++o){for(let c=s+n;s<c;++s)a[o]+=t[s]*t[s];a[o]**=.5}return mh(a,0,1)}return mh(t,e<0?0:e,n)}function B8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function M3(t){return Object.prototype.toString.call(t).slice(8,-1)}function cP(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,r);const a=aa(r,e);a>n&&(n=a)}return n}const lP={computeRange:PT,createRangeHelper:sP,fastComputeRange:mh,getDataType:M3,getMaxNorm:cP};function uP(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const i=t.getNumberOfComponents(),a=e.values.length/(i>0?i:1);if(r===a)return!0;if(r>a){const o=e.values;return e.values=L0(e.dataType,(r+a)*i),e.values.set(o),!0}return e.size>r*i&&(e.size=r*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const i=r*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+i]},t.setComponent=(r,i,a)=>{a!==e.values[r*e.numberOfComponents+i]&&(e.values[r*e.numberOfComponents+i]=a,t.dataChange())},t.getValue=r=>{const i=r/e.numberOfComponents,a=r%e.numberOfComponents;return t.getComponent(i,a)},t.setValue=(r,i)=>{const a=r/e.numberOfComponents,o=r%e.numberOfComponents;t.setComponent(a,o,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=r;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let a=null;return e.ranges||(e.ranges=B8(e.ranges,e.numberOfComponents)),a=e.ranges[i],a?(e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple):(a=PT(t.getData(),r,e.numberOfComponents),e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple)},t.setRange=(r,i)=>{e.ranges||(e.ranges=B8(e.ranges,e.numberOfComponents));const a={min:r.min,max:r.max};return e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple},t.setTuple=(r,i)=>{const a=r*e.numberOfComponents;for(let o=0;o<e.numberOfComponents;o++)e.values[a+o]=i[o]},t.setTuples=(r,i)=>{let a=r*e.numberOfComponents;const o=Math.min(i.length,e.size-a);for(let s=0;s<o;)e.values[a++]=i[s++]},t.insertTuple=(r,i)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,i),r),t.insertTuples=(r,i)=>{const a=r+i.length/e.numberOfComponents;return e.size<a*e.numberOfComponents&&(e.size=a*e.numberOfComponents,n(a)),t.setTuples(r,i),a},t.insertNextTuple=r=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,r)},t.insertNextTuples=r=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,r)},t.findTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:oP;for(let a=0;a<e.size;a+=e.numberOfComponents)if(Math.abs(r[0]-e.values[a])<=i){let o=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(r[s]-e.values[a+s])>i){o=!1;break}if(o)return a/e.numberOfComponents}return-1},t.getTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=e.numberOfComponents||1,o=r*a;switch(a){case 4:i[3]=e.values[o+3];case 3:i[2]=e.values[o+2];case 2:i[1]=e.values[o+1];case 1:i[0]=e.values[o];break;default:for(let s=a-1;s>=0;--s)i[s]=e.values[o+s]}return i},t.getTuples=(r,i)=>{const a=(r??0)*e.numberOfComponents,o=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(a,o);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>FT({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,i)=>{e.values=r,e.size=r.length,e.dataType=M3(r),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(a=>{r[a]||delete r[a]});const i={};return Object.keys(r).sort().forEach(a=>{i[a]=r[a]}),i.mtime&&delete i.mtime,i},t.deepCopy=r=>{const i=t.getDataType(),a=e.values;t.shallowCopy(r),(a==null?void 0:a.length)>=r.getNumberOfValues()&&i===r.getDataType()?(a.set(r.getData()),e.values=a,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,i,a,o,s,c)=>{const l=e.numberOfComponents||1;(l!==i.getNumberOfComponents()||l!==o.getNumberOfComponents())&&iP("numberOfComponents must match");const f=i.getTuple(a),u=o.getTuple(s),g=[];switch(g.length=l,l){case 4:g[3]=f[3]+(u[3]-f[3])*c;case 3:g[2]=f[2]+(u[2]-f[2])*c;case 2:g[1]=f[1]+(u[1]-f[1])*c;case 1:g[0]=f[0]+(u[0]-f[0])*c;break;default:for(let d=0;d<l;d++)g[d]=f[d]+(u[d]-f[d])*c}return t.insertTuple(r,g)}}const fP={name:"",numberOfComponents:1,dataType:aP,rangeTuple:[0,0]};function kT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,fP,n),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=Bg(e.dataType,e.values)):e.values=L0(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=M3(e.values)),je(t,e),Bl(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");uP(t,e)}const FT=be(kT,"vtkDataArray");var he={newInstance:FT,extend:kT,...lP,...aT};const{vtkErrorMacro:gP}=D,dP=["Build","Render"];function pP(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const i=r.getTraverseOperation(),a=t[i];if(a){a(r);return}t.apply(r,!0);for(let o=0;o<e.children.length;o++)e.children[o].traverse(r);t.apply(r,!1)},t.apply=(r,i)=>{const a=t[r.getOperation()];a&&a(i,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let i=0;i<e.children.length;++i){const o=e.children[i].getViewNodeFor(r);if(o)return o}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(r);return i||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const i=e._renderableChildMap.get(r);if(i!==void 0)return i.setVisited(!0),i;const a=t.createViewNode(r);if(a)return a.setParent(t),a.setVisited(!0),e._renderableChildMap.set(r,a),e.children.push(a),a},t.addMissingNodes=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];t.addMissingNode(a)}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];if(e.children.indexOf(a)===-1){a.setParent(t),e.children.push(a);const s=a.getRenderable();s&&e._renderableChildMap.set(s,a)}a.setVisited(!0)}},t.removeNode=r=>{const i=e.children.findIndex(o=>o===r);if(i<0)return!1;const a=r.getRenderable();return a&&e._renderableChildMap.delete(a),r.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let i=0;i<e.children.length;++i){const a=e.children[i];if(a.getVisited())e.children[r++]=a,a.setVisited(!1);else{const s=a.getRenderable();s&&e._renderableChildMap.delete(s),a.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return gP("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(r);return i&&i.setRenderable(r),i};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const hP={renderable:null,myFactory:null,children:[],visited:!1};function UT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hP,n),D.obj(t,e),D.event(t,e,"event"),e._renderableChildMap=new Map,D.get(t,e,["visited"]),D.setGet(t,e,["_parent","renderable","myFactory"]),D.getArray(t,e,["children"]),D.moveToProtected(t,e,["parent"]),pP(t,e)}const mP=D.newInstance(UT,"vtkViewNode");var ze={newInstance:mP,extend:UT,PASS_TYPES:dP};function vP(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.indexOf(i)!==-1?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const yP={};function AT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yP,n),D.obj(t,e),vP(t,e)}const CP=D.newInstance(AT,"vtkViewNodeFactory");var L3={newInstance:CP,extend:AT};const BT=Object.create(null);function Nt(t,e){BT[t]=e}function TP(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const SP={};function GT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SP,n),e.overrides=BT,L3.extend(t,e,n),TP(t,e)}const xP=D.newInstance(GT,"vtkOpenGLViewNodeFactory");var wP={newInstance:xP,extend:GT};const{Wrap:gi,Filter:Jt}=lT,{VtkDataTypes:Pe}=he,{vtkDebugMacro:d2,vtkErrorMacro:Qo,vtkWarningMacro:G8}=cn,{toHalf:EP}=no;function OP(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(c?e._openGLRenderWindow=c:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(Jt.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(Jt.LINEAR),t.setMagnificationFilter(Jt.LINEAR)):(t.setMinificationFilter(Jt.NEAREST),t.setMagnificationFilter(Jt.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(gi.REPEAT),t.setWrapS(gi.REPEAT),t.setWrapT(gi.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Jt.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Jt.LINEAR_MIPMAP_LINEAR));const f=e.renderable.getCanvas();t.create2DFromRaw(f.width,f.height,4,Pe.UNSIGNED_CHAR,f,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const f=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Jt.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(f.width,f.height,4,Pe.UNSIGNED_CHAR,f.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const l=e.renderable.getInputData(0);if(l&&l.getPointData().getScalars()){const f=l.getExtent(),u=l.getPointData().getScalars(),g=[];for(let d=0;d<e.renderable.getNumberOfInputPorts();++d){const h=e.renderable.getInputData(d),p=h?h.getPointData().getScalars().getData():null;p&&g.push(p)}e.renderable.getInterpolate()&&u.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(Jt.LINEAR_MIPMAP_LINEAR)),g.length%6===0?t.createCubeFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,u.getNumberOfComponents(),u.getDataType(),g):t.create2DFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,u.getNumberOfComponents(),u.getDataType(),u.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()},t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=c=>{c&&e.handle&&(c.activateTexture(t),c.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(c),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let c=!1;if(e.context&&e.handle){let l=0;switch(e.target){case e.context.TEXTURE_2D:l=e.context.TEXTURE_BINDING_2D;break;default:G8("impossible case");break}c=e.context.getIntegerv(l)===e.handle}return c},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(c,l)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(c,l)),e.internalFormat||d2(`Unable to find suitable internal format for T=${c} NC= ${l}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&G8("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(c,l)=>{let f=0;return f=e._openGLRenderWindow.getDefaultTextureInternalFormat(c,l,e.oglNorm16Ext,t.useHalfFloat()),f||(f||(d2("Unsupported internal texture type!"),d2(`Unable to find suitable internal format for T=${c} NC= ${l}`)),f)},t.useHalfFloat=()=>e.enableHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=c=>{e._forceInternalFormat=!0,c!==e.internalFormat&&(e.internalFormat=c,t.modified())},t.getFormat=(c,l)=>(e.format=t.getDefaultFormat(c,l),e.format),t.getDefaultFormat=(c,l)=>{if(e._openGLRenderWindow.getWebgl2())switch(l){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(l){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=c=>{const l=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(c){case Pe.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(e.oglNorm16Ext&&!l&&Pe.SHORT):return e.context.SHORT;case(e.oglNorm16Ext&&!l&&Pe.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(l&&Pe.SHORT):return e.context.HALF_FLOAT;case(l&&Pe.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case Pe.FLOAT:case Pe.VOID:default:return e.context.FLOAT}switch(c){case Pe.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case Pe.FLOAT:case Pe.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const f=e.context.getExtension("OES_texture_half_float");if(f&&e.context.getExtension("OES_texture_half_float_linear"))return f.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(c){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||l)&&(e.openGLDataType=t.getDefaultDataType(c)),e.openGLDataType},t.getShiftAndScale=()=>{let c=0,l=1;switch(e.openGLDataType){case e.context.BYTE:l=127.5,c=l-128;break;case e.context.UNSIGNED_BYTE:l=255,c=0;break;case e.context.SHORT:l=32767.5,c=l-32768;break;case e.context.UNSIGNED_SHORT:l=65536,c=0;break;case e.context.INT:l=21474836475e-1,c=l-2147483648;break;case e.context.UNSIGNED_INT:l=4294967295,c=0;break;case e.context.FLOAT:}return{shift:c,scale:l}},t.getOpenGLFilterMode=c=>{switch(c){case Jt.NEAREST:return e.context.NEAREST;case Jt.LINEAR:return e.context.LINEAR;case Jt.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case Jt.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case Jt.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case Jt.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=c=>{switch(c){case gi.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case gi.REPEAT:return e.context.REPEAT;case gi.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}},t.updateArrayDataTypeForGL=function(c,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const u=[];let g=e.width*e.height*e.components;if(f&&(g*=e.depth),c!==Pe.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let h=0;h<l.length;h++)if(l[h]){const p=l[h].length>g?l[h].subarray(0,g):l[h];u.push(new Float32Array(p))}else u.push(null);if(c!==Pe.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let h=0;h<l.length;h++)if(l[h]){const p=l[h].length>g?l[h].subarray(0,g):l[h];u.push(new Uint8Array(p))}else u.push(null);let d=!1;if(e._openGLRenderWindow.getWebgl2())d=e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");d=h&&e.openGLDataType===h.HALF_FLOAT_OES}if(d)for(let h=0;h<l.length;h++)if(l[h]){const p=new Uint16Array(g),m=l[h];for(let v=0;v<g;v++)p[v]=EP(m[v]);u.push(p)}else u.push(null);if(u.length===0)for(let h=0;h<l.length;h++)u.push(l[h]);return u};function n(c){if(e._openGLRenderWindow.getWebgl2())return c;const l=[],f=e.width,u=e.height,g=e.components;if(c&&(!yc(f)||!yc(u))){const d=e.context.getExtension("OES_texture_half_float"),h=cr(f),p=cr(u),m=h*p*e.components;for(let v=0;v<c.length;v++)if(c[v]!==null){let y=null;const C=u/p,T=f/h;let S=!1;e.openGLDataType===e.context.FLOAT?y=new Float32Array(m):d&&e.openGLDataType===d.HALF_FLOAT_OES?(y=new Uint16Array(m),S=!0):y=new Uint8Array(m);for(let x=0;x<p;x++){const w=x*h*g,E=x*C;let M=Math.floor(E),O=Math.ceil(E);O>=u&&(O=u-1);const R=E-M,_=1-R;M=M*f*g,O=O*f*g;for(let P=0;P<h;P++){const N=P*g,W=P*T;let U=Math.floor(W),K=Math.ceil(W);K>=f&&(K=f-1);const A=W-U;U*=g,K*=g;for(let b=0;b<g;b++)S?y[w+N+b]=no.toHalf(no.fromHalf(c[v][M+U+b])*_*(1-A)+no.fromHalf(c[v][M+K+b])*_*A+no.fromHalf(c[v][O+U+b])*R*(1-A)+no.fromHalf(c[v][O+K+b])*R*A):y[w+N+b]=c[v][M+U+b]*_*(1-A)+c[v][M+K+b]*_*A+c[v][O+U+b]*R*(1-A)+c[v][O+K+b]*R*A}}l.push(y),e.width=h,e.height=p}else l.push(null)}if(l.length===0)for(let d=0;d<c.length;d++)l.push(c[d]);return l}function r(c){var l;return e._openGLRenderWindow?e.resizable||(l=e.renderable)!=null&&l.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&e.oglNorm16Ext&&(c===Pe.UNSIGNED_SHORT||c===Pe.SHORT)):!1:!1}t.create2DFromRaw=function(c,l,f,u,g){let d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(u,!0),t.getInternalFormat(u,f),t.getFormat(u,f),!e.internalFormat||!e.format||!e.openGLDataType)return Qo("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const h=[g],p=t.updateArrayDataTypeForGL(u,h),m=n(p);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,d),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(u)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),m[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,m[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,m[0]),e.generateMipmap&&e.context.generateMipmap(e.target),d&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(u,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(c,l,f,u,g)=>{if(t.getOpenGLDataType(u),t.getInternalFormat(u,f),t.getFormat(u,f),!e.internalFormat||!e.format||!e.openGLDataType)return Qo("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=f,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=g.length/6-1,t.createTexture(),t.bind();const d=t.updateArrayDataTypeForGL(u,g),h=n(d),p=[];let m=e.width,v=e.height;for(let y=0;y<h.length;y++){y%6===0&&y!==0&&(m/=2,v/=2),p[y]=L0(u,v*m*e.components);for(let C=0;C<v;++C){const T=C*m*e.components,S=(v-C-1)*m*e.components;p[y].set(h[y].slice(S,S+m*e.components),T)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(u)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let y=0;y<6;y++){let C=0,T=e.width,S=e.height;for(;T>=1&&S>=1;){let x=null;C<=e.maxLevel&&(x=p[6*C+y]),r(u)?x!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+y,C,0,0,T,S,e.format,e.openGLDataType,x):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+y,C,e.internalFormat,T,S,0,e.format,e.openGLDataType,x),C++,T/=2,S/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(u,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(c,l,f,u)=>(t.getOpenGLDataType(f),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?f===Pe.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Qo("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(f)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),u!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,u)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,u),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(f,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=c=>{if(t.getOpenGLDataType(Pe.UNSIGNED_CHAR),t.getInternalFormat(Pe.UNSIGNED_CHAR,4),t.getFormat(Pe.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Qo("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const l=!e._openGLRenderWindow.getWebgl2()&&(!yc(c.width)||!yc(c.height)),f=document.createElement("canvas");f.width=l?cr(c.width):c.width,f.height=l?cr(c.height):c.height,e.width=f.width,e.height=f.height;const u=f.getContext("2d");u.translate(0,f.height),u.scale(1,-1),u.drawImage(c,0,0,c.width,c.height,0,0,f.width,f.height);const g=f;return r(Pe.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),g!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,g)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,g),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(Pe.UNSIGNED_CHAR,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0};function i(c,l,f){const u=new Array(f),g=new Array(f);for(let d=0;d<f;++d)u[d]=c[d],g[d]=l[d]-c[d]||1;return{scale:g,offset:u}}function a(c,l){for(let f=0;f<c.length;f++){const u=c[f],g=l[f]+u;if(u<-2048||u>2048||g<-2048||g>2048)return!1}return!0}function o(c,l,f,u){t.getOpenGLDataType(c);let g=!1;if(e._openGLRenderWindow.getWebgl2())g=e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");g=h&&e.openGLDataType===h.HALF_FLOAT_OES}const d=g&&(a(l,f)||u);e.canUseHalfFloat=d}function s(c,l){const f=c.getNumberOfComponents(),u=c.getDataType(),g=c.getData(),d=new Array(f),h=new Array(f);for(let m=0;m<f;++m){const[v,y]=c.getRange(m);d[m]=v,h[m]=y}const p=i(d,h,f);return o(u,p.offset,p.scale,l),t.useHalfFloat()||t.getOpenGLDataType(u,!0),{numComps:f,dataType:u,data:g,scaleOffsets:p}}t.create2DFilterableFromRaw=function(c,l,f,u,g){let d=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(c,l,he.newInstance({numberOfComponents:f,dataType:u,values:g}),d)},t.create2DFilterableFromDataArray=function(c,l,f){let u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:g,dataType:d,data:h}=s(f,u);t.create2DFromRaw(c,l,g,d,h)},t.updateVolumeInfoForGL=(c,l)=>{var g,d;let f=!1;const u=t.useHalfFloat();(!((g=e.volumeInfo)!=null&&g.scale)||!((d=e.volumeInfo)!=null&&d.offset))&&(e.volumeInfo={scale:new Array(l),offset:new Array(l)});for(let h=0;h<l;++h)e.volumeInfo.scale[h]=1,e.volumeInfo.offset[h]=0;if(e.oglNorm16Ext&&!u&&c===Pe.SHORT){for(let h=0;h<l;++h)e.volumeInfo.scale[h]=32767;f=!0}if(e.oglNorm16Ext&&!u&&c===Pe.UNSIGNED_SHORT){for(let h=0;h<l;++h)e.volumeInfo.scale[h]=65535;f=!0}if(c===Pe.UNSIGNED_CHAR){for(let h=0;h<l;++h)e.volumeInfo.scale[h]=255;f=!0}return(c===Pe.FLOAT||u&&(c===Pe.SHORT||c===Pe.UNSIGNED_SHORT))&&(f=!0),f},t.create3DFromRaw=(c,l,f,u,g,d)=>{let h=g,p=d;if(!t.updateVolumeInfoForGL(h,u)&&p){const T=c*l*f,S=structuredClone(e.volumeInfo),x=new Float32Array(T*u);e.volumeInfo.offset=S.offset,e.volumeInfo.scale=S.scale;let w=0;const E=S.scale.map(M=>1/M);for(let M=0;M<T;M++)for(let O=0;O<u;O++)x[w]=(p[w]-S.offset[O])*E[O],w++;h=Pe.FLOAT,p=x}if(t.getOpenGLDataType(h),t.getInternalFormat(h,u),t.getFormat(h,u),!e.internalFormat||!e.format||!e.openGLDataType)return Qo("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=u,e.width=c,e.height=l,e.depth=f,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const m=[p],y=t.updateArrayDataTypeForGL(h,m,!0),C=n(y);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(h)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),C[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,C[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,C[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(h,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(c,l,f,u,g,d){let h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(c,l,f,he.newInstance({numberOfComponents:u,dataType:g,values:d}),h)},t.create3DFilterableFromDataArray=function(c,l,f,u){let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:d,dataType:h,data:p,scaleOffsets:m}=s(u,g),v=[],y=[];for(let b=0;b<d;++b)v[b]=0,y[b]=1;if(e.volumeInfo={scale:y,offset:v,dataComputedScale:m.scale,dataComputedOffset:m.offset,width:c,height:l,depth:f},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(c,l,f,d,h,p);const C=c*l*f,T=structuredClone(m);let S=(b,F,$,j,z)=>{b[F]=$},x=Pe.UNSIGNED_CHAR;if(h===Pe.UNSIGNED_CHAR)for(let b=0;b<d;++b)T.offset[b]=0,T.scale[b]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(x=Pe.FLOAT,S=(b,F,$,j,z)=>{b[F]=($-j)/z}):(x=Pe.UNSIGNED_CHAR,S=(b,F,$,j,z)=>{b[F]=255*($-j)/z});if(t.getOpenGLDataType(x),t.getInternalFormat(x,d),t.getFormat(x,d),!e.internalFormat||!e.format||!e.openGLDataType)return Qo("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=d,e.depth=1,e.numberOfDimensions=2;let w=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);w>4096&&(x===Pe.FLOAT||d>=3)&&(w=4096);let E=1,M=1;C>w*w&&(E=Math.ceil(Math.sqrt(C/(w*w))),M=E);let O=Math.sqrt(C)/E;O=cr(O);const R=Math.floor(O*E/c),_=Math.ceil(f/R),P=cr(l*_/M);e.width=O,e.height=P,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=R,e.volumeInfo.yreps=_,e.volumeInfo.xstride=E,e.volumeInfo.ystride=M,e.volumeInfo.offset=T.offset,e.volumeInfo.scale=T.scale;let N;const W=O*P*d;x===Pe.FLOAT?N=new Float32Array(W):N=new Uint8Array(W);let U=0;const K=Math.floor(c/E),A=Math.floor(l/M);for(let b=0;b<_;b++){const F=Math.min(R,f-b*R),$=d*(e.width-F*Math.floor(c/E));for(let j=0;j<A;j++){for(let z=0;z<F;z++){const ge=d*((b*R+z)*c*l+M*j*c);for(let Pt=0;Pt<K;Pt++)for(let Ae=0;Ae<d;Ae++)S(N,U,p[ge+E*Pt*d+Ae],T.offset[Ae],T.scale[Ae]),U++}U+=$}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),r(x)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),N!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,N)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,N),t.deactivate(),!0},t.setOpenGLRenderWindow=c=>{e._openGLRenderWindow!==c&&(t.releaseGraphicsResources(),e._openGLRenderWindow=c,e.context=null,c&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=c=>c&&c.isCurrent()?c.getIntegerv(c.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=c=>{e.enableUseHalfFloat=c}}const DP={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:gi.CLAMP_TO_EDGE,wrapT:gi.CLAMP_TO_EDGE,wrapR:gi.CLAMP_TO_EDGE,minificationFilter:Jt.NEAREST,magnificationFilter:Jt.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function WT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DP,n),ze.extend(t,e,n),e.sendParametersTime={},je(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},je(e.textureBuildTime,{mtime:0}),Bl(t,e,["format","openGLDataType"]),Ot(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),In(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),Gl(t,e,["openGLRenderWindow"]),OP(t,e)}const $T=be(WT,"vtkOpenGLTexture");var Je={newInstance:$T,extend:WT,...lT};Nt("vtkTexture",$T);function RP(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){Oe("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){Oe("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){Oe("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){Oe("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let a=i.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{Oe("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,i.framebufferTexture2D(i.FRAMEBUFFER,a,i.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){Oe("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{Oe("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,i,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){Oe("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else Oe("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){Oe("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else Oe("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){Oe("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=Je.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(oe.LINEAR),r.setMagnificationFilter(oe.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,Se.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const MP={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function zT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MP,n),je(t,e),e.colorBuffers&&Oe("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],I0(t,e,["colorBuffers"]),RP(t,e)}const LP=be(zT,"vtkFramebuffer");var $g={newInstance:LP,extend:zT};function IP(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${D.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}),e.delegates.forEach(i=>{i.traverse(n,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),n.traverse(t)}))}}const VP={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function HT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VP,n),D.obj(t,e),D.get(t,e,["currentOperation"]),D.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),D.moveToProtected(t,e,["currentParent"]),IP(t,e)}const _P=D.newInstance(HT,"vtkRenderPass");var I3={newInstance:_P,extend:HT};const wi={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var jT={ObjectType:wi};const{ObjectType:kf}=jT,bP={};function NP(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(s){switch(s){case kf.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case kf.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case kf.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,i=null,a=!0,o="";t.getType=()=>r,t.setType=s=>{r=s},t.getHandle=()=>i,t.isReady=()=>a===!1,t.generateBuffer=s=>{const c=n(s);return i===null&&(i=e.context.createBuffer(),r=s),n(r)===c},t.upload=(s,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),i),e.context.bufferData(n(r),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,a=!1,!0):(o="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(n(r),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>o}const PP={objectType:kf.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function KT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PP,n),D.obj(t,e),D.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),D.moveToProtected(t,e,["openGLRenderWindow"]),NP(t,e)}const kP=D.newInstance(KT);var yi={newInstance:kP,extend:KT,...bP,...jT};const qT={FLAT:0,GOURAUD:1,PHONG:2},an={POINTS:0,WIREFRAME:1,SURFACE:2},FP=qT;var XT={Shading:qT,Representation:an,Interpolation:FP};const{vtkErrorMacro:W8}=D;function UP(t,e){const n=new Float64Array(3);sC(n,e);const r=new Float64Array(16);return nC(r,Io(),t,n),r}function AP(t,e){return t===null||e===null?!1:!(d8(t,[0,0,0])&&d8(e,[1,1,1]))}function BP(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(wi.ARRAY_BUFFER),t.createVBO=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=a.points.getData();let c=null,l=null,f=null;const u=a.colors?a.colors.getNumberOfComponents():0,g=a.tcoords?a.tcoords.getNumberOfComponents():0;a.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=a.normals.getData()),a.customAttributes&&a.customAttributes.forEach(b=>{b&&(e.customData.push({data:b.getData(),offset:4*e.blockSize,components:b.getNumberOfComponents(),name:b.getName()}),e.blockSize+=b.getNumberOfComponents())}),a.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=g,e.blockSize+=g,l=a.tcoords.getData()),a.colors?(e.colorComponents=a.colors.getNumberOfComponents(),e.colorOffset=0,f=a.colors.getData(),e.colorBO||(e.colorBO=yi.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let d=0,h=0,p=0,m=0,v=0,y=0,C;const T={anythingToPoints(b,F,$,j){for(let z=0;z<b;++z)C(F[$+z],j)},linesToWireframe(b,F,$,j){for(let z=0;z<b-1;++z)C(F[$+z],j),C(F[$+z+1],j)},polysToWireframe(b,F,$,j){if(b>2)for(let z=0;z<b;++z)C(F[$+z],j),C(F[$+(z+1)%b],j)},stripsToWireframe(b,F,$,j){if(b>2){for(let z=0;z<b-1;++z)C(F[$+z],j),C(F[$+z+1],j);for(let z=0;z<b-2;z++)C(F[$+z],j),C(F[$+z+2],j)}},polysToSurface(b,F,$,j){for(let z=0;z<b-2;z++)C(F[$+0],j),C(F[$+z+1],j),C(F[$+z+2],j)},stripsToSurface(b,F,$,j){for(let z=0;z<b-2;z++)C(F[$+z],j),C(F[$+z+1+z%2],j),C(F[$+z+1+(z+1)%2],j)}},S={anythingToPoints(b,F){return b},linesToWireframe(b,F){return b>1?(b-1)*2:0},polysToWireframe(b,F){return b>2?b*2:0},stripsToWireframe(b,F){return b>2?b*4-6:0},polysToSurface(b,F){return b>2?(b-2)*3:0},stripsToSurface(b,F,$){return b>2?(b-2)*3:0}};let x=null,w=null;i===an.POINTS||r==="verts"?(x=T.anythingToPoints,w=S.anythingToPoints):i===an.WIREFRAME||r==="lines"?(x=T[`${r}ToWireframe`],w=S[`${r}ToWireframe`]):(x=T[`${r}ToSurface`],w=S[`${r}ToSurface`]);const E=n.getData(),M=E.length;let O=0;for(let b=0;b<M;)O+=w(E[b],E),b+=E[b]+1;let R=null;const _=new Float32Array(O*e.blockSize);f&&(R=new Uint8Array(O*4));let P=0,N=0,W=0,U=0;for(let b=0;b<3;++b){const F=a.points.getRange(b),$=F[1]-F[0];W+=$*$;const j=.5*(F[1]+F[0]);U+=j*j}if(W>0&&(Math.abs(U)/W>1e6||Math.abs(Math.log10(W))>3||W===0&&U>1e6)){const b=new Float64Array(3),F=new Float64Array(3);for(let $=0;$<3;++$){const j=a.points.getRange($),z=j[1]-j[0];b[$]=.5*(j[1]+j[0]),F[$]=z>0?1/z:1}t.setCoordShiftAndScale(b,F)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(o)if(!o.points&&!o.cells)o.points=new Int32Array(O),o.cells=new Int32Array(O);else{const b=new Int32Array(O+o.points.length);b.set(o.points),o.points=b;const F=new Int32Array(O+o.cells.length);F.set(o.cells),o.cells=F}let A=a.vertexOffset;C=function(F,$){if(o&&(o.points[A]=F,o.cells[A]=y+a.cellOffset),++A,d=F*3,e.coordShiftAndScaleEnabled?(_[P++]=(s[d++]-e.coordShift[0])*e.coordScale[0],_[P++]=(s[d++]-e.coordShift[1])*e.coordScale[1],_[P++]=(s[d++]-e.coordShift[2])*e.coordScale[2]):(_[P++]=s[d++],_[P++]=s[d++],_[P++]=s[d++]),c!==null&&(a.haveCellNormals?h=(y+a.cellOffset)*3:h=F*3,_[P++]=c[h++],_[P++]=c[h++],_[P++]=c[h++]),e.customData.forEach(j=>{v=F*j.components;for(let z=0;z<j.components;++z)_[P++]=j.data[v++]}),l!==null){a.useTCoordsPerCell?p=$*g:p=F*g;for(let j=0;j<g;++j)_[P++]=l[p++]}f!==null&&(a.haveCellScalars?m=(y+a.cellOffset)*u:m=F*u,R[N++]=f[m++],R[N++]=f[m++],R[N++]=f[m++],R[N++]=u===4?f[m++]:255)};for(let b=0;b<M;b+=E[b]+1,y++)x(E[b],E,b+1,y+a.cellOffset);return e.elementCount=O,t.upload(_,wi.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(R,wi.ARRAY_BUFFER)),y},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){W8("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){W8("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!p8(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!p8(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=AP(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=UP(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const GP={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function YT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GP,n),yi.extend(t,e,n),D.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),D.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),BP(t,e)}const WP=D.newInstance(YT);var $P={newInstance:WP,extend:YT};const{vtkErrorMacro:zP}=D;function HP(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return zP(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const jP={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function ZT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jP,n),D.obj(t,e),D.setGet(t,e,["shaderType","source","error","handle","context"]),HP(t,e)}const KP=D.newInstance(ZT,"vtkShader");var p2={newInstance:KP,extend:ZT};const{vtkErrorMacro:Br}=D;function qP(t,e,n,r){const i=typeof n=="string"?n:n.join(`
`),a=r===!1?e:new RegExp(e,"g"),o=t.replace(a,i);return{replace:o!==i,result:o}}function XP(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Br(e.error),0):t.link()?(t.setCompiled(!0),1):(Br(`Links failed: ${e.error}`),0):(Br(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Br(e.fragmentShader.getError()),0):(Br(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Br(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return Br(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix4fv(i,!1,a),!0},t.setUniformMatrix3x3=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix3fv(i,!1,a),!0},t.setUniformf=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(i,r),!0)},t.setUniformfv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(i,r),!0)},t.setUniformi=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(i,r),!0)},t.setUniformiv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(i,r),!0)},t.setUniform2f=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(a,r,i),!0},t.setUniform2fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(i,r),!0)},t.setUniform2i=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(a,r,i),!0},t.setUniform2iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(i,r),!0)},t.setUniform3f=(n,r,i,a)=>{const o=t.findUniform(n);if(o===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(o,r,i,a),!0},t.setUniform3fArray=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(i,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,s[0],s[1],s[2]),!0},t.setUniform3iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(i,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(i,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];let s=a;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(i,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(Br("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return Br("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const YP={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function JT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YP,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=p2.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=p2.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=p2.newInstance(),e.geometryShader.setShaderType("Geometry"),D.obj(t,e),D.get(t,e,["lastCameraMTime"]),D.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),XP(t,e)}const ZP=D.newInstance(JT,"vtkShaderProgram");var k={newInstance:ZP,extend:JT,substitute:qP};function JP(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,1):n.vertexAttribDivisor(o.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const o=i.attributes[a],s=o.isMatrix?o.size:1;for(let c=0;c<s;++c)n.enableVertexAttribArray(o.index+c),n.vertexAttribPointer(o.index+c,o.size,o.type,o.normalize,o.stride,o.offset+o.stride*c/o.size),o.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(o.index+c,0):n.vertexAttribDivisor(o.index+c,0)),n.disableVertexAttribArray(o.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,i,a,o,s,c,l)=>t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,l,0,!1),t.addAttributeArrayWithDivisor=(n,r,i,a,o,s,c,l,f,u)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==wi.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const g=e.context,d={};if(d.name=i,d.index=g.getAttribLocation(e.handleProgram,i),d.offset=a,d.stride=o,d.type=s,d.size=c,d.normalize=l,d.isMatrix=u,d.divisor=f,d.Index===-1)return!1;if(r.bind(),g.enableVertexAttribArray(d.index),g.vertexAttribPointer(d.index,d.size,d.type,d.normalize,d.stride,d.offset),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(d.index,1):g.vertexAttribDivisor(d.index,1)),d.buffer=r.getHandle(),!e.supported){let h=!1;for(let p=0;p<e.buffers.length;++p){const m=e.buffers[p];if(m.buffer===d.buffer){h=!0;let v=!1;for(let y=0;y<m.attributes.length;++y)m.attributes[y].name===i&&(v=!0,m.attributes[y]=d);v||m.attributes.push(d)}}h||e.buffers.push({buffer:d.buffer,attributes:[d]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,i,a,o,s,c,l,f)=>{const u=t.addAttributeArrayWithDivisor(n,r,i,a,o,s,c,l,f,!0);if(!u)return u;const g=e.context,d=g.getAttribLocation(e.handleProgram,i);for(let h=1;h<c;h++)g.enableVertexAttribArray(d+h),g.vertexAttribPointer(d+h,c,s,l,o,a+o*h/c),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(d+h,1):g.vertexAttribDivisor(d+h,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];for(let a=0;a<i.attributes.length;++a)if(i.attributes[a].name===n)return i.attributes.splice(a,1),i.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const QP={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function QT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QP,n),e.buffers=[],D.obj(t,e),D.get(t,e,["supported"]),D.setGet(t,e,["forceEmulation"]),JP(t,e)}const ek=D.newInstance(QT,"vtkOpenGLVertexArrayObject");var V3={newInstance:ek,extend:QT};const Wi={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function tk(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,i,a)=>{if(e.CABO.getElementCount()){const o=t.getOpenGLMode(i),s=t.haveWideLines(n,r),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),o===c.LINES&&s?(t.updateShaders(n,r,a),c.drawArraysInstanced(o,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,a),c.drawArrays(o,0,e.CABO.getElementCount()),c.lineWidth(1));const u=(o===c.POINTS?1:0)||(o===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===an.POINTS||r===Wi.Points?e.context.POINTS:n===an.WIREFRAME||r===Wi.Lines||r===Wi.TrisEdges||r===Wi.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,i)=>!!(i.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,i)=>{if(t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(a,n,r);const o=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);o!==t.getProgram()&&(t.setProgram(o),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,n,r),i.setPropertyShaderParameters(t,n,r),i.setCameraShaderParameters(t,n,r),i.setLightingShaderParameters(t,n,r),i.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,i)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const a=parseFloat(r.getProperty().getLineWidth()),o=a/2;t.getProgram().setUniformf("lineWidthStepSize",a/Math.ceil(a)),t.getProgram().setUniformf("halfLineWidth",o)}e.primitiveType===Wi.Points||r.getProperty().getRepresentation()===an.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,i)=>{let a=n.Vertex;a=k.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,a=k.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,i)&&(a=k.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,a=k.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=a},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Wi.Points?2:e.primitiveType===Wi.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const nk={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function eS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nk,n),D.obj(t,e),e.shaderSourceTime={},D.obj(e.shaderSourceTime),e.attributeUpdateTime={},D.obj(e.attributeUpdateTime),D.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=k.newInstance(),e.VAO=V3.newInstance(),e.CABO=$P.newInstance(),tk(t,e)}const rk=D.newInstance(eS);var ri={newInstance:rk,extend:eS,primTypes:Wi};const{Representation:Tc,Interpolation:Sc}=XT;function $8(t){return()=>D.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function ik(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,i)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==i)&&(e.color[0]=n,e.color[1]=r,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=$8("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=$8("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Sc.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Sc.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Sc.PHONG),t.getInterpolationAsString=()=>D.enumToString(Sc,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(Tc.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Tc.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Tc.POINTS),t.getRepresentationAsString=()=>D.enumToString(Tc,e.representation)}const ak={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Sc.GOURAUD,representation:Tc.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function ok(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ak,n),D.obj(t,e),D.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),D.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),ik(t,e)}const sk=D.newInstance(ok,"vtkProperty");var _0={newInstance:sk,...XT};const{Representation:ck}=_0,{vtkErrorMacro:z8}=D;function lk(t){const e=k.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const uk=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function fk(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),a=he.newInstance({numberOfComponents:3,values:n});a.setName("points");const o=he.newInstance({numberOfComponents:2,values:r});o.setName("tcoords");const s=he.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",ck.SURFACE,{points:a,tcoords:o,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),i=n.getContext();e.framebuffer=$g.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=Je.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(r[0],r[1],4,"Float32Array",null),e.translucentRTexture=Je.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(r[0],r[1],1,"Float32Array",null),e.translucentZTexture=Je.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(r[0],r[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),uk,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||z8("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||z8("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,i)=>{if(e.deleted)return;const a=n.getSize(),o=n.getContext();if(e._supported=!1,r.getSelector()||!o||!n.getWebgl2()||!o.getExtension("EXT_color_buffer_half_float")&&!o.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==a[0]||c[1]!==a[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}o.drawBuffers([o.COLOR_ATTACHMENT0]),o.clearBufferfv(o.COLOR,0,[0,0,0,0]),o.clearBufferfv(o.DEPTH,0,[1]),o.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),r.traverse(i)),o.colorMask(!0,!0,!0,!0),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),o.clearBufferfv(o.COLOR,0,[0,0,0,1]),o.clearBufferfv(o.COLOR,1,[0,0,0,0]),o.enable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFuncSeparate(o.ONE,o.ONE,o.ZERO,o.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),o.drawBuffers([o.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=V3.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),o.depthMask(!1),o.depthFunc(o.ALWAYS),o.viewport(0,0,a[0],a[1]),o.scissor(0,0,a[0],a[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.depthMask(!0),o.depthFunc(o.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=r.getTiledSizeAndOrigin();o.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),o.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?lk:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const gk={framebuffer:null,copyShader:null,tris:null};function tS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gk,n),I3.extend(t,e,n),e.VBOBuildTime={},D.obj(e.VBOBuildTime,{mtime:0}),e.tris=ri.newInstance(),D.get(t,e,["framebuffer"]),fk(t,e)}const dk=D.newInstance(tS,"vtkOpenGLOrderIndependentTranslucentPass");var pk={newInstance:dk,extend:tS};function hk(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const i=n.getRenderable().getNumberOfLayers(),a=n.getRenderable().getRenderersByReference();for(let o=0;o<i;o++)for(let s=0;s<a.length;s++){const c=a[s],l=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===o){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),l.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const f=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=$g.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const u=e.framebuffer.getSize();(u===null||u[0]!==f[0]||u[1]!==f[1])&&(e.framebuffer.create(f[0],f[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),l.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),l.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),l.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=pk.newInstance()),e.translucentPass.traverse(n,l,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),l.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),l.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const mk={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function nS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mk,n),I3.extend(t,e,n),D.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),hk(t,e)}const vk=D.newInstance(nS,"vtkForwardPass");var yk={newInstance:vk,extend:nS};const wn={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var rS={PassTypes:wn};const{vtkErrorMacro:H8,vtkWarningMacro:Ck}=D;function Tk(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:Lr(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(i=>i),e.arrays=r.arrays().map(i=>({array:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const i=r.getName(),{array:a,index:o}=t.getArrayWithIndex(i);return a!=null?(e.arrays[o]={data:r},o):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return t.removeArrayByIndex(i)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((i,a,o)=>a.data.getName()===r?a.data:i,null),t.getArrayWithIndex=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const i=e.arrays[r];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(o=>{const s=t.getFlag(o.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&o){let c=t.getArrayByName(o.getName());if(c)if(o.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<o.getNumberOfTuples()){const l=a>-1?a:i;c.insertTuple(l,o.getTuple(i))}else c.insertTuples(0,o.getTuples());else H8("Unhandled case in passData");else if(i<0||i>o.getNumberOfTuples())t.addArray(o),r.getAttributes(o).forEach(l=>{t.setAttribute(o,l)});else{const l=o.getNumberOfComponents();let f=o.getNumberOfValues();const u=a>-1?a:i;f<=u*l&&(f=(u+1)*l),c=he.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:l,values:D.newTypedArray(o.getDataType(),f),size:0}),c.insertTuple(u,o.getTuple(i)),t.addArray(c),r.getAttributes(o).forEach(g=>{t.setAttribute(c,g)})}}})},t.interpolateData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let f=t.getArrayByName(c.getName());if(f)if(c.getNumberOfComponents()===f.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const u=o>-1?o:i;f.interpolateTuple(u,c,i,c,a,s),Ck("Unexpected case in interpolateData")}else f.insertTuples(c.getTuples());else H8("Unhandled case in interpolateData");else if(i<0||a<0||i>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{const u=c.getNumberOfComponents();let g=c.getNumberOfValues();const d=o>-1?o:i;g<=d*u&&(g=(d+1)*u),f=he.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:D.newTypedArray(c.getDataType(),g),size:0}),f.interpolateTuple(d,c,i,c,a,s),t.addArray(f),r.getAttributes(c).forEach(h=>{t.setAttribute(f,h)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(i=>{const a=i.newClone();return a.deepCopy(i),{data:a}})},t.copyFlags=r=>r.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,i)=>i.data.getMTime()>r?i.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,i)=>r+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(i=>({data:i.data.getState()}))),r}}const Sk={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function iS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sk,n),D.obj(t,e),Tk(t,e)}const xk=D.newInstance(iS,"vtkFieldData");var wk={newInstance:xk,extend:iS};const Ek={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},Ok={MAX:0,EXACT:1,NOLIMIT:2},Dk={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},Rk={DUPLICATEPOINT:1,HIDDENPOINT:2},Mk={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},Lk="vtkGhostType",Ik={DEFAULT:0,SINGLE:1,DOUBLE:2};var aS={AttributeCopyOperations:Mk,AttributeLimitTypes:Ok,AttributeTypes:Ek,CellGhostTypes:Dk,DesiredOutputPrecision:Ik,PointGhostTypes:Rk,ghostArrayName:Lk};const{AttributeTypes:Fi,AttributeCopyOperations:Ua}=aS,{vtkWarningMacro:Du}=D;function Vk(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(o){let s=n.find(c=>Fi[c.toUpperCase()]===o||typeof o!="number"&&c.toLowerCase()===o.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=o=>!0,t.setAttribute=(o,s)=>{const c=r(s);if(o&&c.toUpperCase()==="PEDIGREEIDS"&&!o.isA("vtkDataArray"))return Du(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(o&&!t.checkNumberOfComponents(o,c))return Du(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===o)return l;t.removeArrayByIndex(l)}return o?(l=t.addArray(o),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=o=>n.filter(s=>t[`get${s}`]()===o),t.setActiveAttributeByName=(o,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(o).index,s),t.setActiveAttributeByIndex=(o,s)=>{const c=r(s);if(o>=0&&o<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(o);if(!l.isA("vtkDataArray"))return Du(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return Du(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=o,t.modified(),o}return o===-1&&(e[`active${c}`]=o,t.modified()),-1},t.getActiveAttribute=o=>{const s=r(o);return t[`get${s}`]()},t.removeAllArrays=()=>{n.forEach(o=>{e[`active${o}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=o=>(o!==-1&&n.forEach(s=>{o===e[`active${s}`]?e[`active${s}`]=-1:o<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(o)),n.forEach(o=>{const s=`active${o}`;t[`get${o}`]=()=>t.getArrayByIndex(e[s]),t[`set${o}`]=c=>t.setAttribute(c,o),t[`setActive${o}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,o),t[`copy${o}Off`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[Ua.PASSDATA][Fi[c]]=!1},t[`copy${o}On`]=()=>{const c=o.toUpperCase();e.copyAttributeFlags[Ua.PASSDATA][Fi[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(Ua).filter(o=>o!=="ALLCOPY").forEach(o=>{e.copyAttributeFlags[Ua[o]]=Object.keys(Fi).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,c)=>(s[Fi[c]]=!0,s),[])}),e.copyAttributeFlags[Ua.COPYTUPLE][Fi.GLOBALIDS]=!1,e.copyAttributeFlags[Ua.INTERPOLATE][Fi.GLOBALIDS]=!1,e.copyAttributeFlags[Ua.COPYTUPLE][Fi.PEDIGREEIDS]=!1},t.initialize=D.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(o=>{!e.dataArrays[o].ref&&e.dataArrays[o].type==="vtkDataArray"&&t.addArray(he.newInstance(e.dataArrays[o]))});const a=t.shallowCopy;t.shallowCopy=(o,s)=>{a(o,s),e.arrays=o.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,s),{data:l}})},t.initializeAttributeCopyFlags()}const _k={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function oS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_k,n),wk.extend(t,e,n),D.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),Vk(t,e)}const bk=D.newInstance(oS,"vtkDataSetAttributes");var j8={newInstance:bk,extend:oS,...aS};const Nk={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},Pk={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var kk={FieldDataTypes:Nk,FieldAssociations:Pk};const vh=["pointData","cellData","fieldData"];function Fk(t,e){e.classHierarchy.push("vtkDataSet"),vh.forEach(r=>{e[r]?e[r]=Lr(e[r]):e[r]=j8.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),vh.forEach(a=>{e[a]=j8.newInstance(),e[a].shallowCopy(r.getReferenceByName(a))})}}const Uk={};function sS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Uk,n),D.obj(t,e),D.setGet(t,e,vh),Fk(t,e)}const Ak=D.newInstance(sS,"vtkDataSet");var b0={newInstance:Ak,extend:sS,...kk};const{FieldAssociations:Bk}=b0;function Gk(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,i,a,o)=>{},t.selectAsync=async(n,r,i,a,o)=>{const s=await t.getSourceDataAsync(n,r,i,a,o);return s?s.generateSelection(r,i,a,o):[]}}const Wk={fieldAssociation:Bk.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function cS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wk,n),D.obj(t,e),D.setGet(t,e,["fieldAssociation","captureZValues"]),Gk(t,e)}const $k=D.newInstance(cS,"vtkHardwareSelector");var zk={newInstance:$k,extend:cS};const Hk={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},jk={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var Kk={SelectionContent:Hk,SelectionField:jk};function qk(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const Xk={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function lS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xk,n),D.obj(t,e),e.properties={},D.setGet(t,e,["contentType","fieldType","properties","selectionList"]),qk(t,e)}const Yk=D.newInstance(lS,"vtkSelectionNode");var uS={newInstance:Yk,extend:lS,...Kk};const{PassTypes:Mt}=rS,{SelectionContent:Zk,SelectionField:K8}=uS,{FieldAssociations:Pc}=b0,{vtkErrorMacro:fS}=D,Zi=1;function gS(t){return`${t.propID} ${t.compositeID}`}function dS(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4;return n[i+3]}function pi(t,e,n,r){if(!n)return 0;const i=(e*(r[2]-r[0]+1)+t)*4,a=n[i],o=n[i+1];return(n[i+2]*256+o)*256+a}function pS(t,e){let n=e;return n<<=24,n|=t,n}function Jk(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],a=pi(i[0],i[1],t.pixBuffer[Mt.ACTOR_PASS],t.area);if(a<=0||a-Zi>=t.props.length)return null;const o={};o.valid=!0,o.propID=a-Zi,o.prop=t.props[o.propID];let s=pi(i[0],i[1],t.pixBuffer[Mt.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),o.compositeID=s-Zi,t.captureZValues){const f=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;o.zValue=(256*t.zBuffer[f]+t.zBuffer[f+1])/65535,o.displayPosition=e}if(t.pixBuffer[Mt.ID_LOW24]&&dS(i[0],i[1],t.pixBuffer[Mt.ID_LOW24],t.area)===0)return o;const c=pi(i[0],i[1],t.pixBuffer[Mt.ID_LOW24],t.area),l=pi(i[0],i[1],t.pixBuffer[Mt.ID_HIGH24],t.area);return o.attributeID=pS(c,l),o}}function hS(t,e,n,r,i){const a=[];let o=0;return e.forEach((s,c)=>{const l=uS.newInstance();switch(l.setContentType(Zk.INDICES),t){case Pc.FIELD_ASSOCIATION_CELLS:l.setFieldType(K8.CELL);break;case Pc.FIELD_ASSOCIATION_POINTS:l.setFieldType(K8.POINT);break;default:fS("Unknown field association")}l.getProperties().propID=s.info.propID,l.getProperties().prop=s.info.prop,l.getProperties().compositeID=s.info.compositeID,l.getProperties().attributeID=s.info.attributeID,l.getProperties().pixelCount=s.pixelCount,n&&(l.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],l.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r)),l.setSelectionList(s.attributeIDs),a[o]=l,o++}),a}function Qk(t,e,n,r,i){const a=Math.floor(e),o=Math.floor(n),s=Math.floor(r),c=Math.floor(i),l=new Map,f=[0,0];for(let u=o;u<=c;u++)for(let g=a;g<=s;g++){const h=Jk(t,[g,u],0,f);if(h&&h.valid){const p=gS(h);if(!l.has(p))l.set(p,{info:h,pixelCount:1,attributeIDs:[h.attributeID]});else{const m=l.get(p);m.pixelCount++,t.captureZValues&&h.zValue<m.info.zValue&&(m.info=h),m.attributeIDs.indexOf(h.attributeID)===-1&&m.attributeIDs.push(h.attributeID)}}}return hS(t.fieldAssociation,l,t.captureZValues,t.renderer,t.openGLRenderWindow)}function eF(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=$g.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==r[0]||i[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===Pc.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),a=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),a&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,i,a,o,s)=>{if(e._renderer=r,i===void 0){const l=e._openGLRenderWindow.getSize();t.setArea(0,0,l[0]-1,l[1]-1)}else t.setArea(i,a,o,s);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var l=arguments.length,f=new Array(l),u=0;u<l;u++)f[u]=arguments[u];return Qk(c,...f)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return fS("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const i=[];for(e.currentPass=Mt.MIN_KNOWN_PASS;e.currentPass<=Mt.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Mt.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),i.push(e.currentPass));return i.forEach(a=>{e.currentPass=a,t.processPixelBuffers()}),e.currentPass=Mt.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,i)=>{t.isPropHit(i)&&r.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=r=>{if(r===Mt.ID_HIGH24){if(e.fieldAssociation===Pc.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===Pc.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(i),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===Mt.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const a=i[0].getFramebuffer();a.saveCurrentBindingsAndBuffers(),a.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),a.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let i=0;for(let a=0;a<=e.area[3]-e.area[1];a++)for(let o=0;o<=e.area[2]-e.area[0];o++){let s=pi(o,a,r,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=r=>{e.currentPass===Mt.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Zi),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===Mt.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+Zi)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>D.enumToString(Mt,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,i,a)=>{const o=i<0?0:i;if(o===0){if(a[0]=r[0],a[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const f=[r[0]-e.area[0],r[1]-e.area[1]],u=pi(f[0],f[1],e.pixBuffer[Mt.ACTOR_PASS],e.area);if(u<=0||u-Zi>=e.props.length)return null;const g={};g.valid=!0,g.propID=u-Zi,g.prop=e.props[g.propID];let d=pi(f[0],f[1],e.pixBuffer[Mt.COMPOSITE_INDEX_PASS],e.area);if((d<0||d>16777215)&&(d=0),g.compositeID=d-Zi,e.captureZValues){const m=(f[1]*(e.area[2]-e.area[0]+1)+f[0])*4;g.zValue=(256*e.zBuffer[m]+e.zBuffer[m+1])/65535,g.displayPosition=r}if(e.pixBuffer[Mt.ID_LOW24]&&dS(f[0],f[1],e.pixBuffer[Mt.ID_LOW24],e.area)===0)return g;const h=pi(f[0],f[1],e.pixBuffer[Mt.ID_LOW24],e.area),p=pi(f[0],f[1],e.pixBuffer[Mt.ID_HIGH24],e.area);return g.attributeID=pS(h,p),g}const s=[r[0],r[1]],c=[0,0];let l=t.getPixelInformation(r,0,a);if(l&&l.valid)return l;for(let f=1;f<o;++f){for(let u=s[1]>f?s[1]-f:0;u<=s[1]+f;++u)if(c[1]=u,s[0]>=f&&(c[0]=s[0]-f,l=t.getPixelInformation(c,0,a),l&&l.valid)||(c[0]=s[0]+f,l=t.getPixelInformation(c,0,a),l&&l.valid))return l;for(let u=s[0]>=f?s[0]-(f-1):0;u<=s[0]+(f-1);++u)if(c[0]=u,s[1]>=f&&(c[1]=s[1]-f,l=t.getPixelInformation(c,0,a),l&&l.valid)||(c[1]=s[1]+f,l=t.getPixelInformation(c,0,a),l&&l.valid))return l}return a[0]=r[0],a[1]=r[1],null},t.generateSelection=(r,i,a,o)=>{const s=Math.floor(r),c=Math.floor(i),l=Math.floor(a),f=Math.floor(o),u=new Map,g=[0,0];for(let d=c;d<=f;d++)for(let h=s;h<=l;h++){const p=[h,d],m=t.getPixelInformation(p,0,g);if(m&&m.valid){const v=gS(m);if(!u.has(v))u.set(v,{info:m,pixelCount:1,attributeIDs:[m.attributeID]});else{const y=u.get(v);y.pixelCount++,e.captureZValues&&m.zValue<y.info.zValue&&(y.info=m),y.attributeIDs.indexOf(m.attributeID)===-1&&y.attributeIDs.push(m.attributeID)}}}return hS(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,i)=>{e._openGLRenderWindow=r,e._renderer=i};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const tF={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function mS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tF,n),zk.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),D.setGetArray(t,e,["area"],4),D.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),D.setGetArray(t,e,["propColorValue"],3),D.moveToProtected(t,e,["renderer","openGLRenderWindow"]),D.event(t,e,"event"),eF(t,e)}const nF=D.newInstance(mS,"vtkOpenGLHardwareSelector");var _3={newInstance:nF,extend:mS,...rS},vS={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(v,y){var C=v[0],T=v[1],S=v[2],x=v[3];C+=(T&S|~T&x)+y[0]-680876936|0,C=(C<<7|C>>>25)+T|0,x+=(C&T|~C&S)+y[1]-389564586|0,x=(x<<12|x>>>20)+C|0,S+=(x&C|~x&T)+y[2]+606105819|0,S=(S<<17|S>>>15)+x|0,T+=(S&x|~S&C)+y[3]-1044525330|0,T=(T<<22|T>>>10)+S|0,C+=(T&S|~T&x)+y[4]-176418897|0,C=(C<<7|C>>>25)+T|0,x+=(C&T|~C&S)+y[5]+1200080426|0,x=(x<<12|x>>>20)+C|0,S+=(x&C|~x&T)+y[6]-1473231341|0,S=(S<<17|S>>>15)+x|0,T+=(S&x|~S&C)+y[7]-45705983|0,T=(T<<22|T>>>10)+S|0,C+=(T&S|~T&x)+y[8]+1770035416|0,C=(C<<7|C>>>25)+T|0,x+=(C&T|~C&S)+y[9]-1958414417|0,x=(x<<12|x>>>20)+C|0,S+=(x&C|~x&T)+y[10]-42063|0,S=(S<<17|S>>>15)+x|0,T+=(S&x|~S&C)+y[11]-1990404162|0,T=(T<<22|T>>>10)+S|0,C+=(T&S|~T&x)+y[12]+1804603682|0,C=(C<<7|C>>>25)+T|0,x+=(C&T|~C&S)+y[13]-40341101|0,x=(x<<12|x>>>20)+C|0,S+=(x&C|~x&T)+y[14]-1502002290|0,S=(S<<17|S>>>15)+x|0,T+=(S&x|~S&C)+y[15]+1236535329|0,T=(T<<22|T>>>10)+S|0,C+=(T&x|S&~x)+y[1]-165796510|0,C=(C<<5|C>>>27)+T|0,x+=(C&S|T&~S)+y[6]-1069501632|0,x=(x<<9|x>>>23)+C|0,S+=(x&T|C&~T)+y[11]+643717713|0,S=(S<<14|S>>>18)+x|0,T+=(S&C|x&~C)+y[0]-373897302|0,T=(T<<20|T>>>12)+S|0,C+=(T&x|S&~x)+y[5]-701558691|0,C=(C<<5|C>>>27)+T|0,x+=(C&S|T&~S)+y[10]+38016083|0,x=(x<<9|x>>>23)+C|0,S+=(x&T|C&~T)+y[15]-660478335|0,S=(S<<14|S>>>18)+x|0,T+=(S&C|x&~C)+y[4]-405537848|0,T=(T<<20|T>>>12)+S|0,C+=(T&x|S&~x)+y[9]+568446438|0,C=(C<<5|C>>>27)+T|0,x+=(C&S|T&~S)+y[14]-1019803690|0,x=(x<<9|x>>>23)+C|0,S+=(x&T|C&~T)+y[3]-187363961|0,S=(S<<14|S>>>18)+x|0,T+=(S&C|x&~C)+y[8]+1163531501|0,T=(T<<20|T>>>12)+S|0,C+=(T&x|S&~x)+y[13]-1444681467|0,C=(C<<5|C>>>27)+T|0,x+=(C&S|T&~S)+y[2]-51403784|0,x=(x<<9|x>>>23)+C|0,S+=(x&T|C&~T)+y[7]+1735328473|0,S=(S<<14|S>>>18)+x|0,T+=(S&C|x&~C)+y[12]-1926607734|0,T=(T<<20|T>>>12)+S|0,C+=(T^S^x)+y[5]-378558|0,C=(C<<4|C>>>28)+T|0,x+=(C^T^S)+y[8]-2022574463|0,x=(x<<11|x>>>21)+C|0,S+=(x^C^T)+y[11]+1839030562|0,S=(S<<16|S>>>16)+x|0,T+=(S^x^C)+y[14]-35309556|0,T=(T<<23|T>>>9)+S|0,C+=(T^S^x)+y[1]-1530992060|0,C=(C<<4|C>>>28)+T|0,x+=(C^T^S)+y[4]+1272893353|0,x=(x<<11|x>>>21)+C|0,S+=(x^C^T)+y[7]-155497632|0,S=(S<<16|S>>>16)+x|0,T+=(S^x^C)+y[10]-1094730640|0,T=(T<<23|T>>>9)+S|0,C+=(T^S^x)+y[13]+681279174|0,C=(C<<4|C>>>28)+T|0,x+=(C^T^S)+y[0]-358537222|0,x=(x<<11|x>>>21)+C|0,S+=(x^C^T)+y[3]-722521979|0,S=(S<<16|S>>>16)+x|0,T+=(S^x^C)+y[6]+76029189|0,T=(T<<23|T>>>9)+S|0,C+=(T^S^x)+y[9]-640364487|0,C=(C<<4|C>>>28)+T|0,x+=(C^T^S)+y[12]-421815835|0,x=(x<<11|x>>>21)+C|0,S+=(x^C^T)+y[15]+530742520|0,S=(S<<16|S>>>16)+x|0,T+=(S^x^C)+y[2]-995338651|0,T=(T<<23|T>>>9)+S|0,C+=(S^(T|~x))+y[0]-198630844|0,C=(C<<6|C>>>26)+T|0,x+=(T^(C|~S))+y[7]+1126891415|0,x=(x<<10|x>>>22)+C|0,S+=(C^(x|~T))+y[14]-1416354905|0,S=(S<<15|S>>>17)+x|0,T+=(x^(S|~C))+y[5]-57434055|0,T=(T<<21|T>>>11)+S|0,C+=(S^(T|~x))+y[12]+1700485571|0,C=(C<<6|C>>>26)+T|0,x+=(T^(C|~S))+y[3]-1894986606|0,x=(x<<10|x>>>22)+C|0,S+=(C^(x|~T))+y[10]-1051523|0,S=(S<<15|S>>>17)+x|0,T+=(x^(S|~C))+y[1]-2054922799|0,T=(T<<21|T>>>11)+S|0,C+=(S^(T|~x))+y[8]+1873313359|0,C=(C<<6|C>>>26)+T|0,x+=(T^(C|~S))+y[15]-30611744|0,x=(x<<10|x>>>22)+C|0,S+=(C^(x|~T))+y[6]-1560198380|0,S=(S<<15|S>>>17)+x|0,T+=(x^(S|~C))+y[13]+1309151649|0,T=(T<<21|T>>>11)+S|0,C+=(S^(T|~x))+y[4]-145523070|0,C=(C<<6|C>>>26)+T|0,x+=(T^(C|~S))+y[11]-1120210379|0,x=(x<<10|x>>>22)+C|0,S+=(C^(x|~T))+y[2]+718787259|0,S=(S<<15|S>>>17)+x|0,T+=(x^(S|~C))+y[9]-343485551|0,T=(T<<21|T>>>11)+S|0,v[0]=C+v[0]|0,v[1]=T+v[1]|0,v[2]=S+v[2]|0,v[3]=x+v[3]|0}function a(v){var y=[],C;for(C=0;C<64;C+=4)y[C>>2]=v.charCodeAt(C)+(v.charCodeAt(C+1)<<8)+(v.charCodeAt(C+2)<<16)+(v.charCodeAt(C+3)<<24);return y}function o(v){var y=[],C;for(C=0;C<64;C+=4)y[C>>2]=v[C]+(v[C+1]<<8)+(v[C+2]<<16)+(v[C+3]<<24);return y}function s(v){var y=v.length,C=[1732584193,-271733879,-1732584194,271733878],T,S,x,w,E,M;for(T=64;T<=y;T+=64)i(C,a(v.substring(T-64,T)));for(v=v.substring(T-64),S=v.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<S;T+=1)x[T>>2]|=v.charCodeAt(T)<<(T%4<<3);if(x[T>>2]|=128<<(T%4<<3),T>55)for(i(C,x),T=0;T<16;T+=1)x[T]=0;return w=y*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(w[2],16),M=parseInt(w[1],16)||0,x[14]=E,x[15]=M,i(C,x),C}function c(v){var y=v.length,C=[1732584193,-271733879,-1732584194,271733878],T,S,x,w,E,M;for(T=64;T<=y;T+=64)i(C,o(v.subarray(T-64,T)));for(v=T-64<y?v.subarray(T-64):new Uint8Array(0),S=v.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<S;T+=1)x[T>>2]|=v[T]<<(T%4<<3);if(x[T>>2]|=128<<(T%4<<3),T>55)for(i(C,x),T=0;T<16;T+=1)x[T]=0;return w=y*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(w[2],16),M=parseInt(w[1],16)||0,x[14]=E,x[15]=M,i(C,x),C}function l(v){var y="",C;for(C=0;C<4;C+=1)y+=r[v>>C*8+4&15]+r[v>>C*8&15];return y}function f(v){var y;for(y=0;y<v.length;y+=1)v[y]=l(v[y]);return v.join("")}f(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function v(y,C){return y=y|0||0,y<0?Math.max(y+C,0):Math.min(y,C)}ArrayBuffer.prototype.slice=function(y,C){var T=this.byteLength,S=v(y,T),x=T,w,E,M,O;return C!==n&&(x=v(C,T)),S>x?new ArrayBuffer(0):(w=x-S,E=new ArrayBuffer(w),M=new Uint8Array(E),O=new Uint8Array(this,S,w),M.set(O),E)}}();function u(v){return/[\u0080-\uFFFF]/.test(v)&&(v=unescape(encodeURIComponent(v))),v}function g(v,y){var C=v.length,T=new ArrayBuffer(C),S=new Uint8Array(T),x;for(x=0;x<C;x+=1)S[x]=v.charCodeAt(x);return y?S:T}function d(v){return String.fromCharCode.apply(null,new Uint8Array(v))}function h(v,y,C){var T=new Uint8Array(v.byteLength+y.byteLength);return T.set(new Uint8Array(v)),T.set(new Uint8Array(y),v.byteLength),T}function p(v){var y=[],C=v.length,T;for(T=0;T<C-1;T+=2)y.push(parseInt(v.substr(T,2),16));return String.fromCharCode.apply(String,y)}function m(){this.reset()}return m.prototype.append=function(v){return this.appendBinary(u(v)),this},m.prototype.appendBinary=function(v){this._buff+=v,this._length+=v.length;var y=this._buff.length,C;for(C=64;C<=y;C+=64)i(this._hash,a(this._buff.substring(C-64,C)));return this._buff=this._buff.substring(C-64),this},m.prototype.end=function(v){var y=this._buff,C=y.length,T,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x;for(T=0;T<C;T+=1)S[T>>2]|=y.charCodeAt(T)<<(T%4<<3);return this._finish(S,C),x=f(this._hash),v&&(x=p(x)),this.reset(),x},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(v){return this._buff=v.buff,this._length=v.length,this._hash=v.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(v,y){var C=y,T,S,x;if(v[C>>2]|=128<<(C%4<<3),C>55)for(i(this._hash,v),C=0;C<16;C+=1)v[C]=0;T=this._length*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),S=parseInt(T[2],16),x=parseInt(T[1],16)||0,v[14]=S,v[15]=x,i(this._hash,v)},m.hash=function(v,y){return m.hashBinary(u(v),y)},m.hashBinary=function(v,y){var C=s(v),T=f(C);return y?p(T):T},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(v){var y=h(this._buff.buffer,v),C=y.length,T;for(this._length+=v.byteLength,T=64;T<=C;T+=64)i(this._hash,o(y.subarray(T-64,T)));return this._buff=T-64<C?new Uint8Array(y.buffer.slice(T-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(v){var y=this._buff,C=y.length,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S,x;for(S=0;S<C;S+=1)T[S>>2]|=y[S]<<(S%4<<3);return this._finish(T,C),x=f(this._hash),v&&(x=p(x)),this.reset(),x},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var v=m.prototype.getState.call(this);return v.buff=d(v.buff),v},m.ArrayBuffer.prototype.setState=function(v){return v.buff=g(v.buff,!0),m.prototype.setState.call(this,v)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(v,y){var C=c(new Uint8Array(v)),T=f(C);return y?p(T):T},m})})(vS);var rF=vS.exports;const iF=_l(rF),aF=["lastShaderProgramBound","context","_openGLRenderWindow"];function oF(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,i)=>{let a=r;i.length>0&&(a=k.substitute(a,"VSOut","GSOut").result);const o=e._openGLRenderWindow.getWebgl2();let s=`
`,c=`#version 100
`;o?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),a=k.substitute(a,"//VTK::System::Dec",[`${c}
`,o?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=k.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(o){l=k.substitute(l,"varying","out").result,a=k.substitute(a,"varying","in").result;let u="",g=0;for(;a.includes(`gl_FragData[${g}]`);)a=k.substitute(a,`gl_FragData\\[${g}\\]`,`fragOutput${g}`).result,u+=`layout(location = ${g}) out vec4 fragOutput${g};
`,g++;a=k.substitute(a,"//VTK::Output::Dec",u).result}const f=k.substitute(i,"//VTK::System::Dec",c).result;return{VSSource:l,FSSource:a,GSSource:f}},t.readyShaderProgramArray=(n,r,i)=>{const a=t.replaceShaderValues(n,r,i),o=t.getShaderProgram(a.VSSource,a.FSSource,a.GSSource);return t.readyShaderProgram(o)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,i)=>{const a=`${n}${r}${i}`,o=iF.hash(a);if(!(o in e.shaderPrograms)){const s=k.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(n),s.getFragmentShader().setSource(r),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(o),e.shaderPrograms[o]=s,s}return e.shaderPrograms[o]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const sF={lastShaderProgramBound:null,shaderPrograms:null,context:null};function yS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sF,n),e.shaderPrograms={},D.obj(t,e),D.setGet(t,e,aF),D.moveToProtected(t,e,["openGLRenderWindow"]),oF(t,e)}const cF=D.newInstance(yS,"vtkShaderCache");var lF={newInstance:cF,extend:yS};const{vtkErrorMacro:uF}=D;function fF(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&uF("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const gF={context:null,numberOfTextureUnits:0,textureUnits:0};function CS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gF,n),D.obj(t,e),e.textureUnits=[],D.get(t,e,["numberOfTextureUnits"]),D.setGet(t,e,["context"]),fF(t,e)}const dF=D.newInstance(CS,"vtkOpenGLTextureUnitManager");var pF={newInstance:dF,extend:CS};function hF(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,i)=>{const a=i.getViewportByReference(),o=t.getFramebufferSize();return a[0]*o[0]<=n&&a[2]*o[0]>=n&&a[1]*o[1]<=r&&a[3]*o[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),i=t.getFramebufferSize();return[(r[2]-r[0])*i[0],(r[3]-r[1])*i[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n/a[0],r/a[1],i]},t.normalizedDisplayToDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n*a[0],r*a[1],i]},t.worldToView=(n,r,i,a)=>a.worldToView(n,r,i),t.viewToWorld=(n,r,i,a)=>a.viewToWorld(n,r,i),t.worldToDisplay=(n,r,i,a)=>{const o=a.worldToView(n,r,i),s=t.getViewportSize(a),c=a.viewToProjection(o[0],o[1],o[2],s[0]/s[1]),l=a.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(l[0],l[1],l[2])},t.displayToWorld=(n,r,i,a)=>{const o=t.displayToNormalizedDisplay(n,r,i),s=a.normalizedDisplayToProjection(o[0],o[1],o[2]),c=t.getViewportSize(a),l=a.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return a.viewToWorld(l[0],l[1],l[2])},t.normalizedDisplayToViewport=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=t.normalizedDisplayToDisplay(n,r,i);return[s[0]-o[0]-.5,s[1]-o[1]-.5,i]},t.viewportToNormalizedViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return o&&o[0]!==0&&o[1]!==0?[n/(o[0]-1),r/(o[1]-1),i]:[n,r,i]},t.normalizedViewportToViewport=(n,r,i,a)=>{const o=t.getViewportSize(a);return[n*(o[0]-1),r*(o[1]-1),i]},t.displayToLocalDisplay=(n,r,i)=>{const a=t.getFramebufferSize();return[n,a[1]-r-1,i]},t.viewportToNormalizedDisplay=(n,r,i,a)=>{let o=a.getViewportByReference();o=t.normalizedDisplayToDisplay(o[0],o[1],0);const s=n+o[0]+.5,c=r+o[1]+.5;return t.displayToNormalizedDisplay(s,c,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{D.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,i,a)=>{D.vtkErrorMacro("not implemented")},t.createSelector=()=>{D.vtkErrorMacro("not implemented")}}const mF={size:void 0,selector:void 0};function TS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mF,n),e.size||(e.size=[300,300]),D.getArray(t,e,["size"],2),D.get(t,e,["selector"]),ze.extend(t,e,n),hF(t,e)}const vF=D.newInstance(TS,"vtkRenderWindowViewNode");var yF={newInstance:vF,extend:TS};const CF="__getUnderlyingContext";function TF(){const t=new Map,e={apply(i,a,o){return t.has(o[0])?t.get(o[0]):i.apply(a,o)}};function n(i){return{apply(a,o,s){return t.set(i,s[0]),a.apply(o,s)}}}const r=Object.create(null);return r.getParameter=(i,a,o,s)=>new Proxy(s.bind(i),e),r.depthMask=(i,a,o,s)=>new Proxy(s.bind(i),n(i.DEPTH_WRITEMASK)),{get(i,a,o){if(a===CF)return()=>i;let s=Reflect.get(i,a,i);s instanceof Function&&(s=s.bind(i));const c=r[a];return c?c(i,a,o,s):s}}}const{vtkDebugMacro:q8,vtkErrorMacro:X8}=D,SF={position:"absolute",top:0,left:0,width:"100%",height:"100%"},xF=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Cn(t,e,n){const r=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),a===t.FRAMEBUFFER_COMPLETE}let U1=0;const zg=[];function wF(){U1++,zg.forEach(t=>t(U1))}function EF(){U1--,zg.forEach(t=>t(U1))}function OF(t){zg.push(t)}function DF(t){return zg.pop()}function Y8(t){t.preventDefault()}function RF(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=TF()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",Y8,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function a(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(a),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(g=>{var d;(d=g.setOpenGLRenderWindow)==null||d.call(g,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&wF(),e.textureUnitManager=pF.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&X8("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:u,height:g}=e.el.getBoundingClientRect();e.containerSize=[u,g]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var g;return((g=e.activeFramebuffer)==null?void 0:g.getSize())||e.size},t.getPixelData=(u,g,d,h)=>{const p=new Uint8Array((d-u+1)*(h-g+1)*4);return e.context.readPixels(u,g,d-u+1,h-g+1,e.context.RGBA,e.context.UNSIGNED_BYTE,p),p},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},g=null;const d=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&d&&(g=e.canvas.getContext("webgl2",u),g&&(e.webgl2=!0,q8("using webgl2"))),g||(q8("using webgl1"),g=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(g,r())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{const u=I3.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{const g=e._textureResourceIds.get(u);if(g!==void 0){e.context.activeTexture(e.context.TEXTURE0+g);return}const d=t.getTextureUnitManager().allocate();if(d<0){X8("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,d),e.context.activeTexture(e.context.TEXTURE0+d)},t.deactivateTexture=u=>{const g=e._textureResourceIds.get(u);g!==void 0&&(t.getTextureUnitManager().free(g),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{const g=e._textureResourceIds.get(u);return g!==void 0?g:-1},t.getDefaultTextureByteSize=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case Se.CHAR:case Se.SIGNED_CHAR:case Se.UNSIGNED_CHAR:return 1;case g:case d:case Se.UNSIGNED_SHORT:case Se.SHORT:case Se.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,g){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case Se.UNSIGNED_CHAR:switch(g){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(d&&!h&&Se.UNSIGNED_SHORT):switch(g){case 1:return d.R16_EXT;case 2:return d.RG16_EXT;case 3:return d.RGB16_EXT;case 4:default:return d.RGBA16_EXT}case(d&&!h&&Se.SHORT):switch(g){case 1:return d.R16_SNORM_EXT;case 2:return d.RG16_SNORM_EXT;case 3:return d.RGB16_SNORM_EXT;case 4:default:return d.RGBA16_SNORM_EXT}case Se.UNSIGNED_SHORT:case Se.SHORT:case Se.FLOAT:default:switch(g){case 1:return h?e.context.R16F:e.context.R32F;case 2:return h?e.context.RG16F:e.context.RG32F;case 3:return h?e.context.RGB16F:e.context.RGB32F;case 4:default:return h?e.context.RGBA16F:e.context.RGBA32F}}switch(g){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const g=document.createElement("canvas"),d=g.getContext("2d");g.width=e.canvas.width,g.height=e.canvas.height,d.drawImage(e.canvas,0,0);const h=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(y=>{y.getViewProps().forEach(T=>{if(T.getContainer){const x=T.getContainer().getElementsByTagName("canvas");for(let w=0;w<x.length;w++){const E=x[w],M=E.getBoundingClientRect(),O=M.x-h.x,R=M.y-h.y;d.drawImage(E,O,R)}}})});const v=g.toDataURL(u);g.remove(),t.invokeImageReady(v)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:g=!1,size:d=null,scale:h=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;const p=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:d||h!==1?d||e.size.map(m=>m*h):null},new Promise((m,v)=>{const y=t.onImageReady(C=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=p,y.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(T=>{let{restoreParamsFn:S,arg:x}=T;return S(x)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),m(C);else{const T=document.createElement("img");if(T.style=SF,T.src=C,e._screenshot.placeHolder=e.el.appendChild(T),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),g){const S=g!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(x=>{const w=x.getActiveCamera(),E=w.get("focalPoint","position","parallelScale");return{resetCameraArgs:S?{renderer:x}:void 0,resetCameraFn:S?g:x.resetCamera,restoreParamsFn:w.set,arg:JSON.parse(JSON.stringify(E))}}),e._screenshot.cameras.forEach(x=>{let{resetCameraFn:w,resetCameraArgs:E}=x;return w(E)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const u=t.get3DContext(),g=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return s=g[1],g[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const u=t.get3DContext(),g=u.getExtension("OES_texture_float"),d=u.getExtension("OES_texture_half_float"),h=u.getExtension("WEBGL_debug_renderer_info"),p=u.getExtension("WEBGL_draw_buffers"),m=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),v=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",m&&u.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[g&&Cn(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",g&&Cn(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",g&&Cn(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",g&&Cn(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",g&&Cn(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[d&&Cn(u,u.RGBA,d.HALF_FLOAT_OES)?"RGBA":"",d&&Cn(u,u.RGB,d.HALF_FLOAT_OES)?"RGB":"",d&&Cn(u,u.LUMINANCE,d.HALF_FLOAT_OES)?"LUMINANCE":"",d&&Cn(u,u.ALPHA,d.HALF_FLOAT_OES)?"ALPHA":"",d&&Cn(u,u.LUMINANCE_ALPHA,d.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[g&&Cn(u,u.RGBA,u.FLOAT)?"RGBA":"",g&&Cn(u,u.RGB,u.FLOAT)?"RGB":"",g&&Cn(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",g&&Cn(u,u.ALPHA,u.FLOAT)?"ALPHA":"",g&&Cn(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",p?u.getParameter(p.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",h&&u.getParameter(h.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",h&&u.getParameter(h.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],y={};for(;v.length;){const[C,T,S]=v.pop();T&&(y[T]={label:C,value:S})}return e._glInformation=y,y},t.traverseAllPasses=()=>{var g;if(e.renderPasses)for(let d=0;d<e.renderPasses.length;++d)e.renderPasses[d].traverse(t,null);e.notifyStartCaptureImage&&o(),t.copyParentContent();const u=e.renderable.getChildRenderWindowsByReference();for(let d=0;d<u.length;++d)(g=t.getViewNodeFor(u[d]))==null||g.traverseAllPasses()},t.copyParentContent=()=>{const u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(h=>{var p;return!!((p=h.getSelector)!=null&&p.call(h))}))return;const g=u.getCanvas(),d=e.canvas;e.context2D.drawImage(g,0,g.height-d.height,d.width,d.height,0,0,d.width,d.height)},t.resizeFromChildRenderWindows=()=>{var g;const u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){const d=[0,0];for(let h=0;h<u.length;++h){const p=(g=t.getViewNodeFor(u[h]))==null?void 0:g.getSize();p&&(d[0]=p[0]>d[0]?p[0]:d[0],d[1]=p[1]>d[1]?p[1]:d[1])}t.setSize(...d)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){const g=e.renderable.getRenderers()[0];g.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(d=>t.setBackgroundImage(d.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const u=_3.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",Y8),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=D.chain(()=>{e.context&&EF(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};const l=t.setSize;t.setSize=(u,g)=>{const d=l(u,g);return d&&t.invokeWindowResizeEvent({width:u,height:g}),d},t.registerGraphicsResourceUser=(u,g)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null);const d=e._graphicsResources.get(u);d==null||d.users.add(g)},t.unregisterGraphicsResourceUser=(u,g)=>{var h;const d=e._graphicsResources.get(u);d&&(d.users.delete(g),d.users.size||((h=d.oglObject)==null||h.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,g,d)=>{var p;if(!u)return;const h=e._graphicsResources.get(u);(p=h==null?void 0:h.oglObject)==null||p.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:g,hash:d,users:(h==null?void 0:h.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(g=>{let{oglObject:d}=g;u+=d.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:g}=u;g.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{const g=t.getViewNodeFor(u);g==null||g.releaseGraphicsResources()})};const f={...t};xF.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):f[u](...arguments)}})}const MF={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function SS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MF,n),yF.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=_3.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=wP.newInstance(),e.shaderCache=lF.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=yk.newInstance(),D.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),D.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),D.setGetArray(t,e,["size"],2),D.event(t,e,"imageReady"),D.event(t,e,"windowResizeEvent"),RF(t,e)}const b3=D.newInstance(SS,"vtkOpenGLRenderWindow");oT("WebGL",b3);var LF={newInstance:b3,extend:SS,pushMonitorGLContextCount:OF,popMonitorGLContextCount:DF};Nt("vtkRenderWindow",b3);function IF(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),it(e.keyMatrices.mcwc,e.renderable.getMatrix()),xe(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?pr(e.keyMatrices.normalMatrix):(Fg(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),Ul(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),J5(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const VF={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function _F(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VF,n),ze.extend(t,e,n),e.keyMatrixTime={},je(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:pr(new Float64Array(9)),mcwc:ie(new Float64Array(16))},Ot(t,e,["context"]),In(t,e,["activeTextures"]),IF(t,e)}const xS=be(_F);var bF={newInstance:xS};Nt("vtkActor",xS);function NF(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const i=e.children[r];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const PF={context:null,activeTextures:null};function kF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PF,n),ze.extend(t,e,n),Ot(t,e,["context"]),In(t,e,["activeTextures"]),NF(t,e)}const wS=be(kF);var FF={newInstance:wS};Nt("vtkActor2D",wS);function UF(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){it(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),Fg(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),Ul(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),xe(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();it(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),xe(e.keyMatrices.vcpc,e.keyMatrices.vcpc),De(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const AF={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function BF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AF,n),ze.extend(t,e,n),e.keyMatrixTime={},je(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Ot(t,e,["context","keyMatrixTime"]),UF(t,e)}const ES=be(BF);var GF={newInstance:ES};Nt("vtkCamera",ES);function WF(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let i=0;i<r&&i<6;i++)t.addClippingPlane(n[i])}},t.getClippingPlaneInDataCoords=(n,r,i)=>{const a=e.clippingPlanes,o=n;if(a){const s=a.length;if(r>=0&&r<s){const c=a[r],l=c.getNormal(),f=c.getOrigin(),u=l[0],g=l[1],d=l[2],h=-(u*f[0]+g*f[1]+d*f[2]);i[0]=u*o[0]+g*o[4]+d*o[8]+h*o[12],i[1]=u*o[1]+g*o[5]+d*o[9]+h*o[13],i[2]=u*o[2]+g*o[6]+d*o[10]+h*o[14],i[3]=u*o[3]+g*o[7]+d*o[11]+h*o[15];return}}D.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const $F={clippingPlanes:[]};function zF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$F,n),D.obj(t,e),D.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),WF(t,e)}var OS={extend:zF};function HF(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{D.vtkErrorMacro("not implemented")}}const jF={};function DS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jF,n),D.obj(t,e),D.setGet(t,e,["transform"]),HF(t,e)}const KF=D.newInstance(DS,"vtkImplicitFunction");var qF={newInstance:KF,extend:DS};const yh=1e-6,RS="coincide",MS="disjoint";function XF(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function LS(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function IS(t,e,n,r){const i=[];xi(t,e,i);const a=Te(n,i);r[0]=t[0]-a*n[0],r[1]=t[1]-a*n[1],r[2]=t[2]-a*n[2]}function VS(t,e,n){const r=Te(t,e);let i=Te(e,e);return i===0&&(i=1),n[0]=t[0]-r*e[0]/i,n[1]=t[1]-r*e[1]/i,n[2]=t[2]-r*e[2]/i,n}function _S(t,e,n,r){const i=[];xi(t,e,i);const a=Te(n,i),o=Te(n,n);o!==0?(r[0]=t[0]-a*n[0]/o,r[1]=t[1]-a*n[1]/o,r[2]=t[2]-a*n[2]/o):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function bS(t,e,n,r){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],o=[];xi(e,t,a),xi(n,t,o);const s=Te(r,o),c=Te(r,a);let l,f;return c<0?l=-c:l=c,s<0?f=-s*yh:f=s*yh,l<=f||(i.t=s/c,i.x[0]=t[0]+i.t*a[0],i.x[1]=t[1]+i.t*a[1],i.x[2]=t[2]+i.t*a[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function NS(t,e,n,r){const i={intersection:!1,l0:[],l1:[],error:null},a=[];ei(e,r,a);const o=a.map(u=>Math.abs(u));if(o[0]+o[1]+o[2]<yh){const u=[];return xi(t,n,u),Te(e,u)===0?i.error=RS:i.error=MS,i}let s;o[0]>o[1]&&o[0]>o[2]?s="x":o[1]>o[2]?s="y":s="z";const c=[],l=-Te(e,t),f=-Te(r,n);switch(s){case"x":c[0]=0,c[1]=(f*e[2]-l*r[2])/a[0],c[2]=(l*r[1]-f*e[1])/a[0];break;case"y":c[0]=(l*r[2]-f*e[2])/a[1],c[1]=0,c[2]=(f*e[0]-l*r[0])/a[1];break;case"z":c[0]=(f*e[1]-l*r[1])/a[2],c[1]=(l*r[0]-f*e[0])/a[2],c[2]=0;break}return i.l0=c,P1(c,a,i.l1),i.intersection=!0,i}const YF={evaluate:XF,distanceToPlane:LS,projectPoint:IS,projectVector:VS,generalizedProjectPoint:_S,intersectWithLine:bS,intersectWithPlane:NS,DISJOINT:MS,COINCIDE:RS};function ZF(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>LS(n,e.origin,e.normal),t.projectPoint=(n,r)=>{IS(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>VS(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{_S(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,i)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>bS(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>NS(n,r,e.origin,e.normal)}const JF={normal:[0,0,1],origin:[0,0,0]};function PS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JF,n),qF.extend(t,e,n),D.setGetArray(t,e,["normal","origin"],3),ZF(t,e)}const QF=D.newInstance(PS,"vtkPlane");var hn={newInstance:QF,extend:PS,...YF};const Hg=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function kS(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function _i(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function N3(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function P3(t){return N3(t,Hg)}function A1(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=i<e?i:e,t[1]=a>e?a:e,t[2]=o<n?o:n,t[3]=s>n?s:n,t[4]=c<r?c:r,t[5]=l>r?l:r,t}function k3(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)A1(t,...e[n]);else for(let n=0;n<e.length;n+=3)A1(t,...e.slice(n,n+3));return t}function FS(t,e,n,r,i,a,o){const[s,c,l,f,u,g]=t;return o===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],f),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],g)):(t[0]=Math.min(e,s),t[1]=Math.max(n,c),t[2]=Math.min(r,l),t[3]=Math.max(i,f),t[4]=Math.min(a,u),t[5]=Math.max(o,g)),t}function US(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=e,t[1]=e>a?e:a,t[2]=n,t[3]=n>s?n:s,t[4]=r,t[5]=r>l?r:l,i!==e||o!==n||c!==r}function AS(t,e,n,r){const[i,a,o,s,c,l]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=n<o?n:o,t[3]=n,t[4]=r<c?r:c,t[5]=r,a!==e||s!==n||l!==r}function BS(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function F3(t,e,n,r){return _i(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function U3(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function eU(t,e,n,r){if(!_i(t))return!1;const i=U3(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],F3(t,e,n,r),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function kc(t,e){return t[e*2+1]-t[e*2]}function jg(t){return[kc(t,0),kc(t,1),kc(t,2)]}function GS(t){return t.slice(0,2)}function WS(t){return t.slice(2,4)}function $S(t){return t.slice(4,6)}function zS(t){const e=jg(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function HS(t){if(_i(t)){const e=jg(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function A3(t){return[t[0],t[2],t[4]]}function B3(t){return[t[1],t[3],t[5]]}function Ru(t,e){return t<=0&&e>=0||t>=0&&e<=0}function G3(t,e){let n=0;for(let r=0;r<2;r++)for(let i=2;i<4;i++)for(let a=4;a<6;a++)e[n++]=[t[r],t[i],t[a]];return e}function jS(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function KS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=G3(t,[]);for(let i=0;i<r.length;++i)Ee(r[i],r[i],e);return P3(n),k3(n,r)}function qS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function XS(t,e,n,r){const i=[].concat(Hg),a=t.getData();for(let o=0;o<a.length;o+=3){const s=[a[o],a[o+1],a[o+2]],c=Te(s,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const l=Te(s,n);i[2]=Math.min(l,i[2]),i[3]=Math.max(l,i[3]);const f=Te(s,r);i[4]=Math.min(f,i[4]),i[5]=Math.max(f,i[5])}return i}function YS(t,e,n,r,i){let a=!0;const o=[];let s=0;const c=[],l=[0,0,0],f=0,u=1,g=2;for(let d=0;d<3;d++)e[d]<t[2*d]?(o[d]=u,l[d]=t[2*d],a=!1):e[d]>t[2*d+1]?(o[d]=f,l[d]=t[2*d+1],a=!1):o[d]=g;if(a)return r[0]=e[0],r[1]=e[1],r[2]=e[2],i[0]=0,1;for(let d=0;d<3;d++)o[d]!==g&&n[d]!==0?c[d]=(l[d]-e[d])/n[d]:c[d]=-1;for(let d=0;d<3;d++)c[s]<c[d]&&(s=d);if(c[s]>1||c[s]<0)return 0;i[0]=c[s];for(let d=0;d<3;d++)if(s!==d){if(r[d]=e[d]+c[s]*n[d],r[d]<t[2*d]||r[d]>t[2*d+1])return 0}else r[d]=l[d];return 1}function ZS(t,e,n){const r=[];let i=0,a=1,o=1;for(let s=4;s<=5;++s){r[2]=t[s];for(let c=2;c<=3;++c){r[1]=t[c];for(let l=0;l<=1;++l)if(r[0]=t[l],i=hn.evaluate(n,e,r),o&&(a=i>=0?1:-1,o=0),i===0||a>0&&i<0||a<0&&i>0)return 1}}return 0}function JS(t,e){if(!(_i(t)&&_i(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let i=0;i<3;i++)if(r=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(r=!0,n[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(r=!0,n[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(r=!0,n[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(r=!0,n[i*2+1]=t[i*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function B1(t,e){if(!(_i(t)&&_i(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function G1(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function tU(t,e){return!(!B1(t,e)||!G1(t,...A3(e))||!G1(t,...B3(e)))}function QS(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let a=0;for(let u=0;u<2;u++)for(let g=2;g<4;g++)for(let d=4;d<6;d++){const h=[t[u],t[g],t[d]];i[a++]=hn.evaluate(n,e,h)}let o=2;for(;o--&&!(Ru(i[r[o][0]],i[r[o][4]])&&Ru(i[r[o][1]],i[r[o][5]])&&Ru(i[r[o][2]],i[r[o][6]])&&Ru(i[r[o][3]],i[r[o][7]])););if(o<0)return!1;const s=Math.sign(n[o]),c=Math.abs((t[o*2+1]-t[o*2])*n[o]);let l=s>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;const g=Math.abs(i[r[o][u]])/c;s>0&&g<l&&(l=g),s<0&&g>l&&(l=g)}const f=(1-l)*t[o*2]+l*t[o*2+1];return s>0?t[o*2]=f:t[o*2+1]=f,!0}class nU{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(Hg))}getBounds(){return this.bounds}equals(e){return kS(this.bounds,e)}isValid(){return _i(this.bounds)}setBounds(e){return N3(this.bounds,e)}reset(){return P3(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return A1(this.bounds,...n)}addPoints(e){return k3(this.bounds,e)}addBounds(e,n,r,i,a,o){return FS(this.bounds,e,n,r,i,a,o)}setMinPoint(e,n,r){return US(this.bounds,e,n,r)}setMaxPoint(e,n,r){return AS(this.bounds,e,n,r)}inflate(e){return BS(this.bounds,e)}scale(e,n,r){return F3(this.bounds,e,n,r)}getCenter(){return U3(this.bounds)}getLength(e){return kc(this.bounds,e)}getLengths(){return jg(this.bounds)}getMaxLength(){return zS(this.bounds)}getDiagonalLength(){return HS(this.bounds)}getMinPoint(){return A3(this.bounds)}getMaxPoint(){return B3(this.bounds)}getXRange(){return GS(this.bounds)}getYRange(){return WS(this.bounds)}getZRange(){return $S(this.bounds)}getCorners(e){return G3(this.bounds,e)}computeCornerPoints(e,n){return jS(this.bounds,e,n)}computeLocalBounds(e,n,r){return XS(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return KS(this.bounds,e,n)}computeScale3(e){return qS(this.bounds,e)}cutWithPlane(e,n){return QS(this.bounds,e,n)}intersectBox(e,n,r,i){return YS(this.bounds,e,n,r,i)}intersectPlane(e,n){return ZS(this.bounds,e,n)}intersect(e){return JS(this.bounds,e)}intersects(e){return B1(this.bounds,e)}containsPoint(e,n,r){return G1(this.bounds,e,n,r)}contains(e){return B1(this.bounds,e)}}function rU(t){const e=t&&t.bounds;return new nU(e)}const iU={equals:kS,isValid:_i,setBounds:N3,reset:P3,addPoint:A1,addPoints:k3,addBounds:FS,setMinPoint:US,setMaxPoint:AS,inflate:BS,scale:F3,scaleAboutCenter:eU,getCenter:U3,getLength:kc,getLengths:jg,getMaxLength:zS,getDiagonalLength:HS,getMinPoint:A3,getMaxPoint:B3,getXRange:GS,getYRange:WS,getZRange:$S,getCorners:G3,computeCornerPoints:jS,computeLocalBounds:XS,transformBounds:KS,computeScale3:qS,cutWithPlane:QS,intersectBox:YS,intersectPlane:ZS,intersect:JS,intersects:B1,containsPoint:G1,contains:tU,INIT_BOUNDS:Hg};var Be={newInstance:rU,...iU};function aU(t,e){t.getBounds=()=>(D.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),xa()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=Be.isValid(n)?Be.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return Be.getDiagonalLength(n)}}const oU=t=>({bounds:[...Be.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function sU(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oU(n)),OS.extend(t,e,n),D.setGet(t,e,["viewSpecificProperties"]),aU(t,e)}var W3={extend:sU};const Cr={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var ex={StructuredType:Cr};const{StructuredType:ai}=ex;function cU(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?ai.EMPTY:e===3?ai.XYZ_GRID:e===2?t[0]===t[1]?ai.YZ_PLANE:t[2]===t[3]?ai.XZ_PLANE:ai.XY_PLANE:e===1?t[0]<t[1]?ai.X_LINE:t[2]<t[3]?ai.Y_LINE:ai.Z_LINE:ai.SINGLE_POINT}var lU={getDataDescriptionFromExtent:cU,...ex};const{vtkErrorMacro:Aa}=D;function uU(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Aa("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];const a=r.length===1?r[0]:r;if(a.length!==6)return!1;const o=e.extent.some((s,c)=>s!==a[c]);return o&&(e.extent=a.slice(),e.dataDescription=lU.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){let n,r,i;if(e.deleted){Aa("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],r=a[1],i=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2];else{Aa("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,i-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let i=0;i<3;i++){if(n[i]===0)return 0;n[i]>1&&(r*=n[i]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return Aa("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(e.dataDescription){case Cr.EMPTY:return null;case Cr.SINGLE_POINT:break;case Cr.X_LINE:i[0]=n;break;case Cr.Y_LINE:i[1]=n;break;case Cr.Z_LINE:i[2]=n;break;case Cr.XY_PLANE:i[0]=n%r[0],i[1]=n/r[0];break;case Cr.YZ_PLANE:i[1]=n%r[1],i[2]=n/r[1];break;case Cr.XZ_PLANE:i[0]=n%r[0],i[2]=n/r[0];break;case Cr.XYZ_GRID:i[0]=n%r[0],i[1]=n/r[0]%r[1],i[2]=n/(r[0]*r[1]);break;default:Aa("Invalid dataDescription");break}const a=[0,0,0];return t.indexToWorld(i,a),a},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>Be.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>Be.inflate([...e.extent],.5),t.computeTransforms=()=>{Ug(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Vi(e.indexToWorld,e.indexToWorld,e.spacing),xt(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Ee(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Ee(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Be.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Be.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>Be.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=[0,0,0,0,0,0];t.worldToIndexBounds(n,i);const a=[0,0,0],o=[0,0,0];Be.computeCornerPoints(i,a,o),gh(a,a),gh(o,o);const s=t.getDimensions();ph(a,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],a),ph(o,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],o);const c=s[0],l=s[0]*s[1],f=t.getPointData().getScalars().getData();let u=-1/0,g=1/0,d=0,h=0,p=0;for(let C=a[2];C<=o[2];C++)for(let T=a[1];T<=o[1];T++){let S=a[0]+T*c+C*l;for(let x=a[0];x<=o[0];x++){if(!r||r([x,T,C],i)){const w=f[S];w>u&&(u=w),w<g&&(g=w),d+=w*w,h+=w,p+=1}++S}}const m=p>0?h/p:0,v=p?Math.abs(d/p-m*m):0,y=Math.sqrt(v);return{minimum:g,maximum:u,average:m,variance:v,sigma:y,count:p}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=[];let a=r;for(let o=0;o<3;++o)i[o]=a,a*=n[o*2+1]-n[o*2]+1;return i},t.computeOffsetIndex=n=>{let[r,i,a]=n;const o=t.getExtent(),s=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(o,s);return Math.floor((Math.round(r)-o[0])*c[0]+(Math.round(i)-o[2])*c[1]+(Math.round(a)-o[4])*c[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),i=t.worldToIndex(n);for(let a=0;a<3;++a)if(i[a]<r[a*2]||i[a]>r[a*2+1])return Aa(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(i)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=i)return Aa(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const a=t.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:t.getPointData().getScalars().getComponent(a,r)}}const fU={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Cr.EMPTY};function tx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fU,n),b0.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=pr(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),D.get(t,e,["indexToWorld","worldToIndex"]),D.setGetArray(t,e,["origin","spacing"],3),D.setGetArray(t,e,["direction"],9),D.getArray(t,e,["extent"],6),uU(t,e)}const gU=D.newInstance(tx,"vtkImageData");var Kg={newInstance:gU,extend:tx};const dU={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},Ch={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var $3={VectorMode:dU,ScalarMappingTarget:Ch};const pU={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},hU={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},mU={BY_ID:0,BY_NAME:1};var qg={ColorMode:pU,GetArray:mU,ScalarMode:hU};const{ScalarMappingTarget:Z8,VectorMode:Wr}=$3,{VtkDataTypes:Ui}=he,{ColorMode:Mu}=qg,{vtkErrorMacro:J8}=D;function vU(t){return t}function Q8(t){return Math.floor(t*255+.5)}function yU(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(Wr.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(Wr.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(Wr.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){J8("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const i=r.length;for(let a=0;a<i;a++)e.annotationArray.push({value:n[a],annotation:String(r[a])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let i=t.checkForAnnotatedValue(n),a=!1;return i>=0?e.annotationArray[i].annotation!==r&&(e.annotationArray[i].annotation=r,a=!0):(e.annotationArray.push({value:n,annotation:r}),i=e.annotationArray.length-1,a=!0),a&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),i=r>=0;return i&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(n);t.getIndexedColor(i,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,i)=>{const a=n.getNumberOfComponents();let o=null;if(r===Mu.DEFAULT&&(n.getDataType()===Ui.UNSIGNED_CHAR||n.getDataType()===Ui.UNSIGNED_CHAR_CLAMPED)||r===Mu.DIRECT_SCALARS&&n)o=t.convertToRGBA(n,a,n.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:Ui.UNSIGNED_CHAR},c=D.newTypedArray(s.dataType,4*n.getNumberOfTuples());s.values=c,s.size=c.length,o=he.newInstance(s);let l=i;l<0&&a>1?t.mapVectorsThroughTable(n,o,Z8.RGBA,-1,-1):(l<0&&(l=0),l>=a&&(l=a-1),t.mapScalarsThroughTable(n,o,Z8.RGBA,l))}return o},t.mapVectorsToMagnitude=(n,r,i)=>{const a=n.getNumberOfTuples(),o=n.getNumberOfComponents(),s=r.getData(),c=n.getData();for(let l=0;l<a;l++){let f=0;for(let u=0;u<i;u++)f+=c[l*o+u]*c[l*o+u];s[l]=Math.sqrt(f)}},t.mapVectorsThroughTable=(n,r,i,a,o)=>{let s=t.getVectorMode(),c=o,l=a;const f=n.getNumberOfComponents();s===Wr.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=f&&(l=f-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=f):(l<0&&(l=0),l>=f&&(l=f-1),l+c>f&&(c=f-l)),s===Wr.MAGNITUDE&&(f===1||c===1)&&(s=Wr.COMPONENT));let u=0;switch(l>0&&(u=l),s){case Wr.COMPONENT:{t.mapScalarsThroughTable(n,r,i,u);break}case Wr.RGBCOLORS:break;case Wr.MAGNITUDE:default:{const g=he.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,g,c),t.mapScalarsThroughTable(g,r,i,0);break}}},t.luminanceToRGBA=(n,r,i,a)=>{const o=a(i),s=r.getData(),c=n.getData(),l=s.length,f=0,u=1;let g=0;for(let d=f;d<l;d+=u){const h=a(s[d]);c[g*4]=h,c[g*4+1]=h,c[g*4+2]=h,c[g*4+3]=o,g++}},t.luminanceAlphaToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,l=0,f=2;let u=0;for(let g=l;g<c;g+=f){const d=a(o[g]);s[u]=d,s[u+1]=d,s[u+2]=d,s[u+3]=a(o[g+1])*i,u+=4}},t.rGBToRGBA=(n,r,i,a)=>{const o=Q8(i),s=r.getData(),c=n.getData(),l=s.length,f=0,u=3;let g=0;for(let d=f;d<l;d+=u)c[g*4]=a(s[d]),c[g*4+1]=a(s[d+1]),c[g*4+2]=a(s[d+2]),c[g*4+3]=o,g++},t.rGBAToRGBA=(n,r,i,a)=>{const o=r.getData(),s=n.getData(),c=o.length,l=0,f=4;let u=0;for(let g=l;g<c;g+=f)s[u*4]=a(o[g]),s[u*4+1]=a(o[g+1]),s[u*4+2]=a(o[g+2]),s[u*4+3]=a(o[g+3])*i,u++},t.convertToRGBA=(n,r,i)=>{let{alpha:a}=e;if(r===4&&a>=1&&n.getDataType()===Ui.UNSIGNED_CHAR)return n;const o=he.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:Ui.UNSIGNED_CHAR});if(i<=0)return o;a=a>0?a:0,a=a<1?a:1;let s=vU;switch((n.getDataType()===Ui.FLOAT||n.getDataType()===Ui.DOUBLE)&&(s=Q8),r){case 1:t.luminanceToRGBA(o,n,a,s);break;case 2:t.luminanceAlphaToRGBA(o,n,s);break;case 3:t.rGBToRGBA(o,n,a,s);break;case 4:t.rGBAToRGBA(o,n,a,s);break;default:return J8("Cannot convert colors"),null}return o},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,i)=>{if(!n)return t.isOpaque();const a=n.getNumberOfComponents();return r===Mu.DEFAULT&&n.getDataType()===Ui.UNSIGNED_CHAR||r===Mu.DIRECT_SCALARS?a===3||a===1?e.alpha>=1:n.getRange(a-1)[0]===255:!0}}const CU={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:Wr.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function nx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CU,n),D.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],D.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),D.setArray(t,e,["mappingRange"],2),D.getArray(t,e,["mappingRange"]),yU(t,e)}const TU=D.newInstance(nx,"vtkScalarsToColors");var Xg={newInstance:TU,extend:nx,...$3};const{vtkErrorMacro:ev}=D,tv=0,nv=1,h2=2;function SU(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let i=0;const a=Number(n);return a<r.range[0]?i=r.maxIndex+tv+1.5:a>r.range[1]?i=r.maxIndex+nv+1.5:(i=(a+r.shift)*r.scale,i=i<r.maxIndex?i:r.maxIndex),Math.floor(i)},t.linearLookup=(n,r,i)=>{let a=0;F1(n)?a=Math.floor(i.maxIndex+1.5+h2):a=t.linearIndexLookup(n,i);const o=4*a;return r.slice(o,o+4)},t.indexedLookupFunction=(n,r,i)=>{let a=t.getAnnotatedValueIndexInternal(n);a===-1&&(a=e.numberOfColors+h2);const o=4*a;return[r[o],r[o+1],r[o+2],r[o+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,i,a)=>{let o=t.linearLookup;e.indexedLookup&&(o=t.indexedLookupFunction);const s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);const l=t.getAlpha(),f=n.getNumberOfTuples(),u=n.getNumberOfComponents(),g=r.getData(),d=n.getData();if(l>=1){if(i===Ch.RGBA)for(let h=0;h<f;h++){const p=o(d[h*u+a],e.table,c);g[h*4]=p[0],g[h*4+1]=p[1],g[h*4+2]=p[2],g[h*4+3]=p[3]}}else if(i===Ch.RGBA)for(let h=0;h<f;h++){const p=o(d[h*u+a],e.table,c);g[h*4]=p[0],g[h*4+1]=p[1],g[h*4+2]=p[2],g[h*4+3]=Math.floor(p[3]*l+.5)}},t.forceBuild=()=>{let n=0,r=0,i=0,a=0;const o=e.numberOfColors-1;o&&(n=(e.hueRange[1]-e.hueRange[0])/o,r=(e.saturationRange[1]-e.saturationRange[0])/o,i=(e.valueRange[1]-e.valueRange[0])/o,a=(e.alphaRange[1]-e.alphaRange[0])/o),e.table.length=4*o+16;const s=[],c=[];for(let l=0;l<=o;l++)s[0]=e.hueRange[0]+l*n,s[1]=e.saturationRange[0]+l*r,s[2]=e.valueRange[0]+l*i,ro(s,c),c[3]=e.alphaRange[0]+l*a,e.table[l*4]=c[0]*255+.5,e.table[l*4+1]=c[1]*255+.5,e.table[l*4+2]=c[2]*255+.5,e.table[l*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const i=n[0].length;e.numberOfColors=n.length;const a=4-i;let o=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<n.length;s++){const c=n[s];for(let l=0;l<i;l++)e.table[o++]=c[l];o+=a}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return ev("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==Se.UNSIGNED_CHAR)return ev("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let i=0;i<r.length;i++)e.table[i]=r[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let i=(n+tv)*4;e.useBelowRangeColor||n===0?(r[i]=e.belowRangeColor[0]*255+.5,r[i+1]=e.belowRangeColor[1]*255+.5,r[i+2]=e.belowRangeColor[2]*255+.5,r[i+3]=e.belowRangeColor[3]*255+.5):(r[i]=r[0],r[i+1]=r[1],r[i+2]=r[2],r[i+3]=r[3]),i=(n+nv)*4,e.useAboveRangeColor||n===0?(r[i]=e.aboveRangeColor[0]*255+.5,r[i+1]=e.aboveRangeColor[1]*255+.5,r[i+2]=e.aboveRangeColor[2]*255+.5,r[i+3]=e.aboveRangeColor[3]*255+.5):(r[i]=r[4*(n-1)+0],r[i+1]=r[4*(n-1)+1],r[i+2]=r[4*(n-1)+2],r[i+3]=r[4*(n-1)+3]),i=(n+h2)*4,r[i]=e.nanColor[0]*255+.5,r[i+1]=e.nanColor[1]*255+.5,r[i+2]=e.nanColor[2]*255+.5,r[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const xU={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function rx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xU,n),Xg.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},D.obj(e.buildTime),e.opaqueFlagBuildTime={},D.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},D.obj(e.insertTime,{mtime:0}),D.get(t,e,["buildTime"]),D.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),D.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),D.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),D.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),SU(t,e)}const wU=D.newInstance(rx,"vtkLookupTable");var W1={newInstance:wU,extend:rx};const Pr={Off:0,PolygonOffset:1};let Th=Pr.PolygonOffset,$1=Pr.Off;const EU=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function OU(){return Th}function DU(t){const e=Th===t;return Th=t,e}function RU(){return $1}function Yg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=$1===t;return $1=t,e}function MU(){return Yg(Pr.Off)}function LU(){return Yg(Pr.Off)}function IU(){return Yg(Pr.PolygonOffset)}function VU(){return EU[$1]}var Sh={Resolve:Pr,getResolveCoincidentTopologyAsString:VU,getResolveCoincidentTopologyPolygonOffsetFaces:OU,getResolveCoincidentTopology:RU,setResolveCoincidentTopology:Yg,setResolveCoincidentTopologyPolygonOffsetFaces:DU,setResolveCoincidentTopologyToDefault:MU,setResolveCoincidentTopologyToOff:LU,setResolveCoincidentTopologyToPolygonOffset:IU};function ix(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=D.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const z3=["Polygon","Line","Point"],_U={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},io={};ix(io,_U,z3.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function bU(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),D.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(Sh).forEach(n=>{t[n]=Sh[n]}),Object.keys(io).forEach(n=>{t[n]=io[n]}),ix(t,e.topologyOffset,z3.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=io.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=io.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=io.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var Zg={implementCoincidentTopologyMethods:bU,staticOffsetAPI:io,otherStaticMethods:Sh,CATEGORIES:z3,Resolve:Pr};const{FieldAssociations:rv}=b0,{staticOffsetAPI:NU,otherStaticMethods:PU}=Zg,{ColorMode:Lu,ScalarMode:Ba,GetArray:m2}=qg,{VectorMode:kU}=$3,{VtkDataTypes:FU}=he;function Q0(t){return()=>D.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function UU(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function AU(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function iv(t,e,n){const r=Math.floor(e),i=r%(2*n[0]);let a,o;i<n[0]?(t[0]=i,a=1,o=t[0]===n[0]-1):(t[0]=2*n[0]-1-i,a=-1,o=t[0]===0);const s=Math.floor(r/n[0]),c=s%(2*n[1]);let l,f;c<n[1]?(t[1]=c,l=1,f=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,l=-1,f=t[1]===0),t[2]=Math.floor(s/n[1]);const u=e-r;o?f?t[2]+=u:t[1]+=l*u:t[0]+=a*u,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const av=new WeakMap;function BU(t,e,n,r,i,a,o){var _;const s=new Array(arguments.length);for(let P=0;P<arguments.length;++P){const N=arguments[P];s[P]=((_=N.getMTime)==null?void 0:_.call(N))??N}const c=s.join("/"),l=av.get(t);if(l&&l.stringHash===c)return l.textureCoordinates;const f=(n[1]-n[0])/(r-1),[u,g]=[n[0]-f,n[1]+f],d=u-.5*f,h=1/(g-u+f),p=u,m=(r+1)/(g-u),v=t.getData(),y=t.getNumberOfTuples(),C=t.getNumberOfComponents(),T=e<0||e>=C,S=i[2]<=1?2:3,x=he.newInstance({numberOfComponents:S,values:new Float32Array(y*S)}),w=x.getData(),E=[0,0,0];iv(E,r+2,i);let M=0,O=0;const R=[.5,.5,.5];for(let P=0;P<y;++P){let N;if(T){let W=0;for(let U=0;U<C;++U){const K=v[M+U];W+=K*K}N=Math.sqrt(W)}else N=v[M+e];if(M+=C,a&&(N=W1.applyLogScale(N,n,n)),F1(N))R[0]=E[0],R[1]=E[1],R[2]=E[2];else if(o){let W=(N-p)*m;W<1?W=0:W>r&&(W=r+1),iv(R,W,i)}else{R[1]=.49;const W=(N-d)*h;W>1e3?R[0]=1e3:W<-1e3?R[0]=-1e3:R[0]=W}for(let W=0;W<S;++W)w[O++]=R[W]}return av.set(t,{stringHash:c,textureCoordinates:x}),x}function GU(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=xa(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=W1.newInstance()},t.getColorModeAsString=()=>D.enumToString(Lu,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>D.enumToString(Ba,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let s=null,c=!1;if(r===Ba.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),c=!0);else if(r===Ba.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===Ba.USE_CELL_DATA)s=n.getCellData().getScalars(),c=!0;else if(r===Ba.USE_POINT_FIELD_DATA){const l=n.getPointData();i===m2.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===Ba.USE_CELL_FIELD_DATA){const l=n.getCellData();c=!0,i===m2.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===Ba.USE_FIELD_DATA){const l=n.getFieldData();i===m2.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}return{scalars:s,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:i,cellFlag:a}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=a,!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const o=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString!==o){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(i,a))e.mapScalarsToTexture(i,a,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const s=t.getLookupTable();s&&(s.build(),e.colorMapColors=s.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,i)=>{const a=e.lookupTable.getRange(),o=e.lookupTable.usingLogScale();o&&W1.getLogRange(a,a);const s=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==i){e.lookupTable.setAlpha(i),e.colorTextureMap=null,e.lookupTable.build();const l=e.lookupTable.getNumberOfAvailableColors(),f=2048,u=f**3-3,d=4096-2,h=2,p=r?u:d;e.numberOfColorsInRange=Math.min(Math.max(l,h),p);const m=e.numberOfColorsInRange+3,v=e.numberOfColorsInRange+2,y=r?[Math.min(Math.ceil(m/f**0),f),Math.min(Math.ceil(m/f**1),f),Math.min(Math.ceil(m/f**2),f)]:[v,2,1],C=y[0]*y[1]*y[2],T=new Float64Array(C);T.fill(NaN);const S=e.numberOfColorsInRange,x=S+2,w=[0,0,0],E=a[0],M=a[1]-a[0];for(let _=0;_<x;++_){const P=AU(w,y),N=E+M*(_-1)/(S-1);T[P]=o?10**N:N,UU(w,y)}const O=he.newInstance({numberOfComponents:1,values:T}),R=e.lookupTable.mapScalars(O,e.colorMode,0);e.colorTextureMap=Kg.newInstance(),e.colorTextureMap.setDimensions(y),e.colorTextureMap.getPointData().setScalars(R),e.lookupTable.setAlpha(s)}const c=e.lookupTable.getVectorMode()===kU.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=BU(n,c,a,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),o,r)},t.getIsOpaque=()=>{const n=t.getInputData(),i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const a=t.getLookupTable();return a?(a.build(),a.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==Lu.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===Lu.DEFAULT&&n.getDataType()===FU.UNSIGNED_CHAR||e.colorMode===Lu.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=Q0("AcquireInvertibleLookupTable"),t.valueToColor=Q0("ValueToColor"),t.colorToValue=Q0("ColorToValue"),t.useInvertibleColorFor=Q0("UseInvertibleColorFor"),t.clearInvertibleColor=Q0("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=n.getRawPixelBuffer(wn.ID_LOW24),a=n.getRawPixelBuffer(wn.ID_HIGH24),o=n.getCurrentPass(),s=n.getFieldAssociation();let c=null;s===rv.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===rv.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(l=>{if(o===wn.ID_LOW24){let f=0;a&&(f+=a[l],f*=256),f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],g=n.getPixelBuffer(wn.ID_LOW24);g[l]=u&255,g[l+1]=(u&65280)>>8,g[l+2]=(u&16711680)>>16}else if(o===wn.ID_HIGH24&&a){let f=0;f+=a[l],f*=256,f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],g=n.getPixelBuffer(wn.ID_HIGH24);g[l]=(u&4278190080)>>24}})}}const WU={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function ax(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WU,n),W3.extend(t,e,n),D.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),D.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),D.setGetArray(t,e,["scalarRange"],2),Zg.implementCoincidentTopologyMethods(t,e),GU(t,e)}const $U=D.newInstance(ax,"vtkMapper");var No={newInstance:$U,extend:ax,...NU,...PU,...qg};const zU={DISPLAY:0,WORLD:1};var ox={CoordinateSystem:zU};const{CoordinateSystem:xh}=ox;function ov(t){return()=>D.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function HU(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const i=e.textures[r].getMTime();i>n&&(n=i)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=ov("pick"),t.hasKey=ov("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(i=>i!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(xh.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(xh.DISPLAY)}const jU={allocatedRenderTime:10,coordinateSystem:xh.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function sx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jU,n),D.obj(t,e),D.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),D.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),D.moveToProtected(t,e,["parentProp"]),HU(t,e)}const KU=D.newInstance(sx,"vtkProp");var jl={newInstance:KU,extend:sx,...ox},H3=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,Kl=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function qU(t,e){t.replaceShaderCoincidentOffset=(n,r,i)=>{const a=t.getCoincidentParameters(r,i);if(a&&(a.factor!==0||a.offset!==0)){let o=n.Fragment;o=k.substitute(o,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(a.factor!==0?(o=k.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=k.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=k.substitute(o,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(a.factor!==0?(o=k.substitute(o,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,o=k.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):o=k.substitute(o,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=o}}}function XU(t,e){t.applyShaderReplacements=(n,r,i)=>{let a=null;if(r&&(a=r.ShaderReplacements),a)for(let o=0;o<a.length;o++){const s=a[o];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const c=s.shaderType,l=n[c],f=k.substitute(l,s.originalValue,s.replacementValue,s.replaceAll);n[c]=f.result}}},t.buildShaders=(n,r,i)=>{t.getReplacedShaderTemplate(n,r,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const a=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,a,!0),t.replaceShaderValues(n,r,i),t.applyShaderReplacements(n,a)},t.getReplacedShaderTemplate=(n,r,i)=>{const a=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,i);let o=n.Vertex;if(a){const l=a.VertexShaderCode;l!==void 0&&l!==""&&(o=l)}n.Vertex=o;let s=n.Fragment;if(a){const l=a.FragmentShaderCode;l!==void 0&&l!==""&&(s=l)}n.Fragment=s;let c=n.Geometry;if(a){const l=a.GeometryShaderCode;l!==void 0&&(c=l)}n.Geometry=c}}var ti={implementReplaceShaderCoincidentOffset:qU,implementBuildShadersWithReplacements:XU};const{FieldAssociations:v2}=b0,{primTypes:At}=ri,{Representation:es,Shading:sv}=_0,{ScalarMode:Iu}=No,{Filter:cv,Wrap:lv}=Je,{vtkErrorMacro:Ga}=cn,YU={type:"StartEvent"},ZU={type:"EndEvent"},{CoordinateSystem:JU}=jl;function QU(t){const e=t.getSelector();return e?e.getCurrentPass():wn.MIN_KNOWN_PASS-1}function eA(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=At.Start;o<At.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=H3,r.Fragment=Kl,r.Geometry=""},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(f=f.concat(["varying vec4 vertexColorVSOutput;"]),o=k.substitute(o,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,o=k.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=k.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=k.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=k.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=k.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(a.getBackfaceProperty()&&!e.drawingEdges&&(f=f.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),l?(f=f.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(f=f.concat(["uniform samplerBuffer texture1;"])),c=k.substitute(c,"//VTK::Color::Impl",u).result),c=k.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderLight=(r,i,a)=>{let o=r.Fragment;const s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=e.lastBoundBO.getReferenceByName("lastLightCount");let f=[];switch(c){case 0:o=k.substitute(o,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:o=k.substitute(o,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);o=k.substitute(o,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<l;++u)f=f.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${s}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=k.substitute(o,"//VTK::Light::Impl",f,!1).result;break;case 3:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);o=k.substitute(o,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<l;++u)f=f.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),o=k.substitute(o,"//VTK::Light::Impl",f,!1).result;break;default:Ga("bad light complexity")}r.Fragment=o},t.replaceShaderNormal=(r,i,a)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex,c=r.Geometry,l=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=k.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=k.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=k.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=k.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,l=k.substitute(l,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,l=k.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(l=k.substitute(l,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,l=k.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES?(l=k.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=k.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(l=k.substitute(l,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,l=k.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=k.substitute(l,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=s,r.Geometry=c,r.Fragment=l}},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a);let o=r.Vertex,s=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=k.substitute(o,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,o=k.substitute(o,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,o=k.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=k.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=k.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=k.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=k.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(o=k.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=k.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;o=k.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const l=e.openGLActor.getActiveTextures();let f=2,u=2;if(l&&l.length>0&&(f=l[0].getComponents(),l[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(f=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(o=k.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=k.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=k.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=k.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l&&l.length>=1)switch(f){case 1:c=k.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=k.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=k.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(o=k.substitute(o,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=k.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=k.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=k.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,f){case 1:c=k.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=k.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=k.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=o,r.Geometry=s,r.Fragment=c}},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();o=k.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,o=k.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=k.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=k.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getCoincidentParameters=(r,i)=>{let a={factor:0,offset:0};const o=i.getProperty();if(e.renderable.getResolveCoincidentTopology()==Pr.PolygonOffset||o.getEdgeVisibility()&&o.getRepresentation()===es.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===At.Points||o.getRepresentation()===es.POINTS?a=e.renderable.getCoincidentTopologyPointOffsetParameter():c===At.Lines||o.getRepresentation()===es.WIREFRAME?a=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===At.Tris||c===At.TriStrips)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===At.TrisEdges||c===At.TriStripsEdges)&&(a=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),a.factor/=2,a.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===v2.FIELD_ASSOCIATION_POINTS&&(a.offset-=2),a},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment,s=r.Vertex;if(o=k.substitute(o,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===wn.ID_LOW24||e.lastSelectionState===wn.ID_HIGH24)&&(s=k.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=k.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,o=k.substitute(o,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,o=k.substitute(o,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case wn.ID_LOW24:o=k.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case wn.ID_HIGH24:o=k.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:o=k.substitute(o,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,o=k.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=o,r.Vertex=s}},t.replaceShaderValues=(r,i,a)=>{if(t.replaceShaderColor(r,i,a),t.replaceShaderNormal(r,i,a),t.replaceShaderLight(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a),t.replaceShaderPositionVC(r,i,a),e.haveSeenDepthRequest){let o=r.Fragment;o=k.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=k.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=o}},t.getNeedToRebuildShaders=(r,i,a)=>{let o=0,s=0;const c=r.getPrimitiveType(),l=e.currentInput;let f=!1;const u=l.getPointData().getNormals(),g=l.getCellData().getNormals(),d=a.getProperty().getInterpolation()===sv.FLAT,h=a.getProperty().getRepresentation(),p=r.getOpenGLMode(h,c);if((p===e.context.TRIANGLES||g&&!u||!d&&u||!d&&p===e.context.LINES)&&(f=!0),a.getProperty().getLighting()&&f){o=0;const C=i.getLightsByReference();for(let T=0;T<C.length;++T){const S=C[T];S.getSwitch()>0&&(s++,o===0&&(o=1)),o===1&&(s>1||S.getIntensity()!==1||!S.lightTypeIsHeadLight())&&(o=2),o<3&&S.getPositional()&&(o=3)}}let m=!1;const v=e.lastBoundBO.getReferenceByName("lastLightComplexity"),y=e.lastBoundBO.getReferenceByName("lastLightCount");return(v!==o||y!==s)&&(e.lastBoundBO.set({lastLightComplexity:o},!0),e.lastBoundBO.set({lastLightCount:s},!0),m=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(m=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||m?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||Ga("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||Ga("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((l,f)=>{r.getProgram().isAttributeUsed(`${l}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${l}MC`,r.getCABO().getCustomData()[f].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[f].components,!1)||Ga(`Error setting ${l}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||Ga("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Ga("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),l=[],u=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,g=u?it(e.tmpMat4,a.getMatrix()):a.getMatrix();u&&(xe(g,g),De(g,g,u),xe(g,g));for(let d=0;d<c;d++){const h=[];e.renderable.getClippingPlaneInDataCoords(g,d,h);for(let p=0;p<4;p++)l.push(h[p])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",l)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor.getActiveTextures();if(o)for(let c=0;c<o.length;++c){const f=o[c].getTextureUnit(),u=`texture${f+1}`;r.getProgram().isUniformUsed(u)&&r.getProgram().setUniformi(u,f)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,i,a)=>{const o=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(o<2)return;const s=r.getProgram();let c=0;const l=i.getLightsByReference();for(let g=0;g<l.length;++g){const d=l[g];if(d.getSwitch()>0){const p=d.getColorByReference(),m=d.getIntensity();e.lightColor[0]=p[0]*m,e.lightColor[1]=p[1]*m,e.lightColor[2]=p[2]*m;const v=d.getDirection(),y=i.getActiveCamera().getViewMatrix(),C=[...v];d.lightTypeIsSceneLight()&&(C[0]=y[0]*v[0]+y[1]*v[1]+y[2]*v[2],C[1]=y[4]*v[0]+y[5]*v[1]+y[6]*v[2],C[2]=y[8]*v[0]+y[9]*v[1]+y[10]*v[2],bo(C)),e.lightDirection[0]=C[0],e.lightDirection[1]=C[1],e.lightDirection[2]=C[2],bo(e.lightDirection),s.setUniform3fArray(`lightColor${c}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(o<3)return;const u=i.getActiveCamera().getViewMatrix();xe(u,u),c=0;for(let g=0;g<l.length;++g){const d=l[g];if(d.getSwitch()>0){const p=d.getTransformedPosition(),m=new Float64Array(3);Ee(m,p,u),s.setUniform3fArray(`lightAttenuation${c}`,d.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${c}`,d.getPositional()),s.setUniformf(`lightExponent${c}`,d.getExponent()),s.setUniformf(`lightConeAngle${c}`,d.getConeAngle()),s.setUniform3fArray(`lightPositionVC${c}`,[m[0],m[1],m[2]]),c++}}};function n(r,i,a){return i.identity(a),r.reduce((o,s,c)=>c===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLCamera.getKeyMatrices(i),c=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrixTime().getMTime(),f=o.getLastCameraMTime(),g=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,d=a.getIsIdentity(),h=d?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(a.getCoordinateSystem()===JU.DISPLAY){const p=e._openGLRenderer.getTiledSizeAndOrigin();ie(e.tmpMat4),e.tmpMat4[0]=2/p.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/p.vsize,e.tmpMat4[13]=-1,De(e.tmpMat4,e.tmpMat4,g),o.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else o.setUniformMatrix("MCPCMatrix",n([s.wcpc,h.mcwc,g],gl,e.tmpMat4));o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",n([s.wcvc,h.mcwc,g],gl,e.tmpMat4)),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",n([s.normalMatrix,h.normalMatrix],CV,e.tmpMat3)),f!==l&&(o.isUniformUsed("cameraParallel")&&o.setUniformi("cameraParallel",c.getParallelProjection()),o.setLastCameraMTime(l)),d||o.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram();let s=a.getProperty(),c=s.getOpacity(),l=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),f=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),u=e.drawingEdges?1:s.getAmbient(),g=e.drawingEdges?0:s.getDiffuse(),d=e.drawingEdges?0:s.getSpecular();const h=s.getSpecularPower();o.setUniformf("opacityUniform",c),o.setUniform3fArray("ambientColorUniform",l),o.setUniform3fArray("diffuseColorUniform",f),o.setUniformf("ambient",u),o.setUniformf("diffuse",g);const p=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(p<1)return;let m=s.getSpecularColorByReference();if(o.setUniform3fArray("specularColorUniform",m),o.setUniformf("specularPowerUniform",h),o.setUniformf("specular",d),o.isUniformUsed("ambientIntensityBF")){if(s=a.getBackfaceProperty(),c=s.getOpacity(),l=s.getAmbientColor(),u=s.getAmbient(),f=s.getDiffuseColor(),g=s.getDiffuse(),m=s.getSpecularColor(),d=s.getSpecular(),o.setUniformf("ambientIntensityBF",u),o.setUniformf("diffuseIntensityBF",g),o.setUniformf("opacityUniformBF",c),o.setUniform3fArray("ambientColorUniformBF",l),o.setUniform3fArray("diffuseColorUniformBF",f),p<1)return;o.setUniformf("specularIntensityBF",d),o.setUniform3fArray("specularColorUniformBF",m),o.setUniformf("specularPowerUniformBF",h)}},t.updateMaximumPointCellIds=(r,i)=>{var s,c,l,f;const a=e._openGLRenderer.getSelector();if(!a)return;if((c=(s=e.selectionWebGLIdsToVTKIds)==null?void 0:s.points)!=null&&c.length){const u=e.selectionWebGLIdsToVTKIds.points.length;a.setMaximumPointId(u-1)}if((f=(l=e.selectionWebGLIdsToVTKIds)==null?void 0:l.cells)!=null&&f.length){const u=e.selectionWebGLIdsToVTKIds.cells.length;a.setMaximumCellId(u-1)}a.getFieldAssociation()===v2.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const a=QU(e._openGLRenderer);if(e.lastSelectionState!==a&&(e.selectionStateChanged.modified(),e.lastSelectionState=a),e._openGLRenderer.getSelector())switch(a){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(r,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=i.getProperty().getEdgeVisibility()&&a===es.SURFACE,s=e._openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===v2.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===wn.ID_LOW24||e.lastSelectionState===wn.ID_HIGH24);for(let l=At.Start;l<At.End;l++)e.primitives[l].setPointPicking(c),e.primitives[l].getCABO().getElementCount()&&(e.drawingEdges=o&&(l===At.TrisEdges||l===At.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[l],e.primitiveIDOffset+=e.primitives[l].drawArrays(r,i,a,t),e.vertexIDOffset+=e.primitives[l].getCABO().getElementCount()))},t.renderPieceFinish=(r,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,i)=>{if(t.invokeEvent(YU),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(ZU),!e.currentInput){Ga("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context,o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){V0(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Iu.USE_CELL_DATA||s===Iu.USE_CELL_FIELD_DATA||s===Iu.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==Iu.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);let c=i.getProperty().getInterpolation()!==sv.FLAT?a.getPointData().getNormals():null;c===null&&a.getCellData().getNormals()&&(e.haveCellNormals=!0,c=a.getCellData().getNormals());const l=i.getProperty().getRepresentation();let f=a.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(f=null);let u=!1;if(e.renderable.getColorCoordinates()){f=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=Je.newInstance({resizable:!0}));const d=e.internalColorTexture;d.setMinificationFilter(cv.NEAREST),d.setMagnificationFilter(cv.NEAREST),d.setWrapS(lv.CLAMP_TO_EDGE),d.setWrapT(lv.CLAMP_TO_EDGE),d.setOpenGLRenderWindow(e._openGLRenderWindow);const h=e.renderable.getColorTextureMap(),p=h.getExtent(),m=h.getPointData().getScalars();d.create2DFromRaw(p[1]-p[0]+1,p[3]-p[2]+1,m.getNumberOfComponents(),m.getDataType(),m.getData()),d.activate(),d.sendParameters(),d.deactivate()}const g=`${a.getMTime()}A${l}B${a.getMTime()}C${c?c.getMTime():1}D${o?o.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${f?f.getMTime():1}`;if(e.VBOBuildString!==g){const h={points:a.getPoints(),normals:c,tcoords:f,colors:o,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(v=>a.getPointData().getArrayByName(v))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const p=[{inRep:"verts",cells:a.getVerts()},{inRep:"lines",cells:a.getLines()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()},{inRep:"polys",cells:a.getPolys()},{inRep:"strips",cells:a.getStrips()}],m=i.getProperty().getEdgeVisibility()&&l===es.SURFACE;for(let v=At.Start;v<At.End;v++)v!==At.TrisEdges&&v!==At.TriStripsEdges?(h.cellOffset+=e.primitives[v].getCABO().createVBO(p[v].cells,p[v].inRep,l,h,e.selectionWebGLIdsToVTKIds),h.vertexOffset+=e.primitives[v].getCABO().getElementCount()):m?e.primitives[v].getCABO().createVBO(p[v].cells,p[v].inRep,es.WIREFRAME,{...h,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[v].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=g}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const tA={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:wn.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function cx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tA,n),ze.extend(t,e,n),ti.implementReplaceShaderCoincidentOffset(t,e,n),ti.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=At,e.tmpMat3=pr(new Float64Array(9)),e.tmpMat4=ie(new Float64Array(16));for(let r=At.Start;r<At.End;r++)e.primitives[r]=ri.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Ot(t,e,["context"]),e.VBOBuildTime={},je(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},je(e.selectionStateChanged,{mtime:0}),eA(t,e)}const lx=be(cx,"vtkOpenGLPolyDataMapper");var Jg={newInstance:lx,extend:cx};Nt("vtkMapper",lx);const{vtkErrorMacro:ec}=cn,{Representation:nA}=_0,{ObjectType:Vu}=yi,{PassTypes:rA}=_3,iA={type:"StartEvent"},aA={type:"EndEvent"};function oA(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const n={...t};t.renderPiece=(r,i)=>{if(t.invokeEvent(iA),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(aA),!e.currentInput){ec("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const a=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const o=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!o&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.FRONT)):(e._openGLRenderWindow.enableCullFace(),a.cullFace(a.BACK)),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.multiply4x4WithOffset=(r,i,a,o)=>{const s=i[0],c=i[1],l=i[2],f=i[3],u=i[4],g=i[5],d=i[6],h=i[7],p=i[8],m=i[9],v=i[10],y=i[11],C=i[12],T=i[13],S=i[14],x=i[15];let w=a[o],E=a[o+1],M=a[o+2],O=a[o+3];r[0]=w*s+E*u+M*p+O*C,r[1]=w*c+E*g+M*m+O*T,r[2]=w*l+E*d+M*v+O*S,r[3]=w*f+E*h+M*y+O*x,w=a[o+4],E=a[o+5],M=a[o+6],O=a[o+7],r[4]=w*s+E*u+M*p+O*C,r[5]=w*c+E*g+M*m+O*T,r[6]=w*l+E*d+M*v+O*S,r[7]=w*f+E*h+M*y+O*x,w=a[o+8],E=a[o+9],M=a[o+10],O=a[o+11],r[8]=w*s+E*u+M*p+O*C,r[9]=w*c+E*g+M*m+O*T,r[10]=w*l+E*d+M*v+O*S,r[11]=w*f+E*h+M*y+O*x,w=a[o+12],E=a[o+13],M=a[o+14],O=a[o+15],r[12]=w*s+E*u+M*p+O*C,r[13]=w*c+E*g+M*m+O*T,r[14]=w*l+E*d+M*v+O*S,r[15]=w*f+E*h+M*y+O*x},t.replaceShaderNormal=(r,i,a)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=r.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=k.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=k.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),r.Vertex=s}n.replaceShaderNormal(r,i,a)},t.replaceShaderColor=(r,i,a)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(f=f.concat(["varying vec4 vertexColorVSOutput;"]),o=k.substitute(o,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,o=k.substitute(o,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=k.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=k.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,u=u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=k.substitute(c,"//VTK::Color::Impl",u).result,c=k.substitute(c,"//VTK::Color::Dec",f).result,r.Vertex=o,r.Geometry=s,r.Fragment=c}n.replaceShaderColor(r,i,a)},t.replaceShaderPositionVC=(r,i,a)=>{if(e.hardwareSupport){let o=r.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(o=k.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,o=k.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(o=k.substitute(o,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,o=k.substitute(o,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),r.Vertex=o}n.replaceShaderPositionVC(r,i,a)},t.replaceShaderPicking=(r,i,a)=>{if(e.hardwareSupport){let o=r.Fragment,s=r.Vertex;s=k.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=k.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,r.Vertex=s,o=k.substitute(o,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,o=k.substitute(o,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,r.Fragment=o}else n.replaceShaderPicking(r,i,a)},t.updateGlyphShaderParameters=(r,i,a,o,s,c,l,f)=>{const u=a.getProgram();if(r){const g=e.normalMatrix,d=c,h=l*9,p=e.tmpMat3,m=g[0],v=g[1],y=g[2],C=g[3],T=g[4],S=g[5],x=g[6],w=g[7],E=g[8],M=d[h],O=d[h+1],R=d[h+2],_=d[h+3],P=d[h+4],N=d[h+5],W=d[h+6],U=d[h+7],K=d[h+8];p[0]=M*m+O*C+R*x,p[1]=M*v+O*T+R*w,p[2]=M*y+O*S+R*E,p[3]=_*m+P*C+N*x,p[4]=_*v+P*T+N*w,p[5]=_*y+P*S+N*E,p[6]=W*m+U*C+K*x,p[7]=W*v+U*T+K*w,p[8]=W*y+U*S+K*E,u.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,l*16),u.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,l*16),u.setUniformMatrix("MCVCMatrix",e.tmpMat4)),o){const g=o.getData();e.tmpColor[0]=g[l*4]/255,e.tmpColor[1]=g[l*4+1]/255,e.tmpColor[2]=g[l*4+2]/255,u.setUniform3fArray("ambientColorUniform",e.tmpColor),u.setUniform3fArray("diffuseColorUniform",e.tmpColor)}f&&u.setUniform3fArray("mapperIndex",f.getPropColorValue())},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation(),o=e.context,s=i.getProperty().getEdgeVisibility()&&a===nA.SURFACE,c=e.openGLCamera.getKeyMatrices(r),l=e.openGLActor.getKeyMatrices();s0(e.normalMatrix,c.normalMatrix,l.normalMatrix),De(e.mcpcMatrix,c.wcpc,l.mcwc),De(e.mcvcMatrix,c.wcvc,l.mcwc);const f=e.renderable.getMatrixArray(),u=e.renderable.getNormalArray(),g=e.renderable.getColorArray(),d=f.length/16;let h=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===rA.COMPOSITE_INDEX_PASS&&(h=!0);for(let p=e.primTypes.Start;p<e.primTypes.End;p++){const m=e.primitives[p].getCABO();if(m.getElementCount()){e.drawingEdges=s&&(p===e.primTypes.TrisEdges||p===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[p],e.primitives[p].updateShaders(r,i,t);const v=e.primitives[p].getProgram(),y=e.primitives[p].getOpenGLMode(a),C=v.isUniformUsed("normalMatrix"),T=v.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(y,0,m.getElementCount(),d):o.drawArraysInstanced(y,0,m.getElementCount(),d);else for(let S=0;S<d;++S)h&&e._openGLRenderer.getSelector().renderCompositeIndex(S),t.updateGlyphShaderParameters(C,T,e.primitives[p],g,f,u,S,h?e._openGLRenderer.getSelector():null),o.drawArrays(y,0,m.getElementCount())}}},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){r.getProgram().isAttributeUsed("gMatrix")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||ec("Error setting gMatrix in shader VAO."):r.getVAO().removeAttributeArray("gMatrix"),r.getProgram().isAttributeUsed("gNormal")?r.getVAO().addAttributeMatrixWithDivisor(r.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||ec("Error setting gNormal in shader VAO."):r.getVAO().removeAttributeArray("gNormal"),r.getProgram().isAttributeUsed("gColor")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||ec("Error setting gColor in shader VAO."):r.getVAO().removeAttributeArray("gColor"),r.getProgram().isAttributeUsed("mapperIndexVS")?r.getVAO().addAttributeArrayWithDivisor(r.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||ec("Error setting mapperIndexVS in shader VAO."):r.getVAO().removeAttributeArray("mapperIndexVS"),n.setMapperShaderParameters(r,i,a),r.getAttributeUpdateTime().modified();return}n.setMapperShaderParameters(r,i,a)},t.getNeedToRebuildBufferObjects=(r,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:n.getNeedToRebuildBufferObjects(r,i)),t.getNeedToRebuildShaders=(r,i,a)=>!!(n.getNeedToRebuildShaders(r,i,a)||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(r,i)=>{if(e.hardwareSupport){const a=e.renderable.getMatrixArray(),o=e.renderable.getNormalArray(),s=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=yi.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=yi.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=yi.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=yi.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(a,Vu.ARRAY_BUFFER),e.normalBuffer.upload(o,Vu.ARRAY_BUFFER),s?e.colorBuffer.upload(s.getData(),Vu.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const c=a.length/16,l=new Uint8Array(4*c);for(let f=0;f<c;++f){let u=f+1;const g=f*4;l[g]=u%256,u-=l[g],u/=256,l[g+1]=u%256,u-=l[g+1],u/=256,l[g+2]=u%256,l[g+3]=255}e.pickBuffer.upload(l,Vu.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return n.buildBufferObjects(r,i)}}const sA={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function cA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sA,n),Jg.extend(t,e,n),e.tmpMat3=pr(new Float64Array(9)),e.normalMatrix=pr(new Float64Array(9)),e.mcpcMatrix=ie(new Float64Array(16)),e.mcvcMatrix=ie(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},je(e.glyphBOBuildTime,{mtime:0}),oA(t,e)}const ux=be(cA,"vtkOpenGLGlyph3DMapper");var lA={newInstance:ux};Nt("vtkGlyph3DMapper",ux);const uA={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var Qg={SlicingMode:uA};const To={NEAREST:0,LINEAR:1};var fA={InterpolationType:To};function ni(t,e,n){return t?`${t.getMTime()}-${e}-${n}`:"0"}function j3(t,e){return`${t.getMTime()}A${e.getMTime()}`}const{vtkErrorMacro:ts}=cn,{SlicingMode:vr}=Qg;function gA(t){const e=t.split(`
`),n=[];for(let r=0;r<e.length;++r){const i=e[r].trim();i.length>0&&n.push(i)}return n}function dA(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function n(r){e.openGLTexture.releaseGraphicsResources(r),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const a=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()==Pr.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=H3,r.Fragment=Kl,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=k.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=k.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,o=k.substitute(o,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,o=k.substitute(o,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=a.getProperty().getIndependentComponents();let f=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(l){for(let g=1;g<c;g++)f=f.concat([`uniform float cshift${g};`,`uniform float cscale${g};`,`uniform float pwfshift${g};`,`uniform float pwfscale${g};`]);switch(c){case 1:f=f.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:f=f.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:ts("Unsupported number of independent coordinates.")}}if(s=k.substitute(s,"//VTK::TCoord::Dec",f).result,a.getProperty().getUseLabelOutline()===!0&&(s=k.substitute(s,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;"]).result,s=k.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,s=k.substitute(s,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","#endif"]).result),l){const g=["r","g","b","a"];let d=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let h=0;h<c;h++)d=d.concat([`vec3 tcolor${h} = mix${h} * texture2D(colorTexture1, vec2(tvalue.${g[h]} * cscale${h} + cshift${h}, height${h})).rgb;`,`float compWeight${h} = mix${h} * texture2D(pwfTexture1, vec2(tvalue.${g[h]} * pwfscale${h} + pwfshift${h}, height${h})).r;`]);switch(c){case 1:d=d.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:d=d.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:d=d.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:ts("Unsupported number of independent coordinates.")}s=k.substitute(s,"//VTK::TCoord::Impl",d).result}else switch(c){case 1:s=k.substitute(s,"//VTK::TCoord::Impl",[...gA(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, centerPosIS.xy).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 1.0, 1.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, neighborPosIS.xy).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:s=k.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:s=k.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:s=k.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(s=k.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=k.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(Oe("OpenGL has a limit of 6 clipping planes"),c=6),o=k.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=k.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=k.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=k.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getNeedToRebuildShaders=(r,i,a)=>{var l;const o=e.openGLTexture.getComponents(),s=a.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((l=r.getProgram())==null?void 0:l.getHandle())===0||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.updateShaders=(r,i,a)=>{if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||ts("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),e.context.FALSE)||ts("Error setting tcoordMC in shader VAO.")),r.getAttributeUpdateTime().modified());const o=e.openGLTexture.getTextureUnit();r.getProgram().setUniformi("texture1",o);const s=e.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents();if(c)for(let h=0;h<s;h++)r.getProgram().setUniformf(`mix${h}`,a.getProperty().getComponentWeight(h));const l=e.openGLTexture.getShiftAndScale();for(let h=0;h<s;h++){let p=a.getProperty().getColorWindow(),m=a.getProperty().getColorLevel();const v=c?h:0,y=a.getProperty().getRGBTransferFunction(v);if(y&&a.getProperty().getUseLookupTableScalarRange()){const S=y.getRange();p=S[1]-S[0],m=.5*(S[1]+S[0])}const C=l.scale/p,T=(l.shift-m)/p+.5;r.getProgram().setUniformf(`cshift${h}`,T),r.getProgram().setUniformf(`cscale${h}`,C)}for(let h=0;h<s;h++){let p=1,m=0;const v=c?h:0,y=a.getProperty().getPiecewiseFunction(v);if(y){const C=y.getRange(),T=C[1]-C[0],S=.5*(C[0]+C[1]);p=l.scale/T,m=(l.shift-S)/T+.5}r.getProgram().setUniformf(`pwfshift${h}`,m),r.getProgram().setUniformf(`pwfscale${h}`,p)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const h=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",h.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",h.factor)}const f=e.colorTexture.getTextureUnit();r.getProgram().setUniformi("colorTexture1",f);const u=e.pwfTexture.getTextureUnit();r.getProgram().setUniformi("pwfTexture1",u);const g=e.labelOutlineThicknessTexture.getTextureUnit();if(r.getProgram().setUniformi("labelOutlineTexture1",g),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(Oe("OpenGL has a limit of 6 clipping planes"),h=6);const m=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,v=m?it(e.imagematinv,a.getMatrix()):a.getMatrix();m&&(xe(v,v),De(v,v,m),xe(v,v)),xe(e.imagemat,e.currentInput.getIndexToWorld()),De(e.imagematinv,v,e.imagemat);const y=[];for(let C=0;C<h;C++){const T=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,C,T);for(let S=0;S<4;S++)y.push(T[S])}r.getProgram().setUniformi("numClipPlanes",h),r.getProgram().setUniform4fv("clipPlanes",y)}if(a.getProperty().getUseLabelOutline()===!0){const h=a.getProperty().getLabelOutlineOpacity();r.getProgram().setUniformf("outlineOpacity",h)}},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();De(e.imagemat,s.mcwc,l);const f=e.openGLCamera.getKeyMatrices(i);if(De(e.imagemat,f.wcpc,e.imagemat),r.getCABO().getCoordShiftAndScaleEnabled()){const g=r.getCABO().getInverseShiftAndScaleMatrix();De(e.imagemat,e.imagemat,g)}if(o.setUniformMatrix("MCPCMatrix",e.imagemat),a.getProperty().getUseLabelOutline()===!0){const g=c.getWorldToIndex(),d=c.getDimensions();o.setUniform3i("imageDimensions",d[0],d[1],1),o.setUniformMatrix("vWCtoIDX",g);const h=e.openGLCamera.getKeyMatrices(i);xt(e.projectionToWorld,h.wcpc),e.openGLCamera.getKeyMatrices(i),o.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const p=t.getRenderTargetSize();o.setUniformf("vpWidth",p[0]),o.setUniformf("vpHeight",p[1]);const m=t.getRenderTargetOffset();o.setUniformf("vpOffsetX",m[0]/p[0]),o.setUniformf("vpOffsetY",m[1]/p[1])}},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),c=a.getProperty().getOpacity();o.setUniformf("opacity",c)},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.renderPiece=(r,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){ts("No input!");return}t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){V0(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>{var a,o,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((a=e.openGLTexture)!=null&&a.getHandle())||!((o=e.colorTexture)!=null&&o.getHandle())||!((s=e.labelOutlineThicknessTexture)!=null&&s.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(r,i)=>{var _,P,N,W;const a=e.currentInput;if(!a)return;const o=a.getPointData()&&a.getPointData().getScalars();if(!o)return;const s=o.getDataType(),c=o.getNumberOfComponents(),l=i.getProperty(),f=l.getInterpolationType(),u=l.getIndependentComponents(),g=u?c:1,d=u?2*g:1,h=l.getRGBTransferFunction(),p=ni(h,u,g),m=e._openGLRenderWindow.getGraphicsResourceForObject(h);if(!((_=m==null?void 0:m.oglObject)!=null&&_.getHandle())||(m==null?void 0:m.hash)!==p){e.colorTexture=Je.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const U=1024,K=U*d*3,A=new Uint8ClampedArray(K);if(f===To.NEAREST?(e.colorTexture.setMinificationFilter(oe.NEAREST),e.colorTexture.setMagnificationFilter(oe.NEAREST)):(e.colorTexture.setMinificationFilter(oe.LINEAR),e.colorTexture.setMagnificationFilter(oe.LINEAR)),h){const b=new Float32Array(U*3);for(let F=0;F<g;F++){const $=l.getRGBTransferFunction(F),j=$.getRange();if($.getTable(j[0],j[1],U,b,1),u)for(let z=0;z<U*3;z++)A[F*U*6+z]=255*b[z],A[F*U*6+z+U*3]=255*b[z];else for(let z=0;z<U*3;z++)A[F*U*6+z]=255*b[z]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(U,d,3,Se.UNSIGNED_CHAR,A)}else{for(let b=0;b<U*3;++b)A[b]=255*b/((U-1)*3),A[b+1]=255*b/((U-1)*3),A[b+2]=255*b/((U-1)*3);e.colorTexture.create2DFromRaw(U,1,3,Se.UNSIGNED_CHAR,A)}h&&(e._openGLRenderWindow.setGraphicsResourceForObject(h,e.colorTexture,p),h!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(h,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=h)}else e.colorTexture=m.oglObject;const y=l.getPiecewiseFunction(),C=ni(y,u,g),T=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!((P=T==null?void 0:T.oglObject)!=null&&P.getHandle())||(T==null?void 0:T.hash)!==C){const K=1024*d,A=new Uint8ClampedArray(K);if(e.pwfTexture=Je.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),f===To.NEAREST?(e.pwfTexture.setMinificationFilter(oe.NEAREST),e.pwfTexture.setMagnificationFilter(oe.NEAREST)):(e.pwfTexture.setMinificationFilter(oe.LINEAR),e.pwfTexture.setMagnificationFilter(oe.LINEAR)),y){const b=new Float32Array(K),F=new Float32Array(1024);for(let $=0;$<g;++$){const j=l.getPiecewiseFunction($);if(j===null)b.fill(1);else{const z=j.getRange();if(j.getTable(z[0],z[1],1024,F,1),u)for(let ge=0;ge<1024;ge++)b[$*1024*2+ge]=F[ge],b[$*1024*2+ge+1024]=F[ge];else for(let ge=0;ge<1024;ge++)b[$*1024*2+ge]=F[ge]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,d,1,Se.FLOAT,b)}else A.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,Se.UNSIGNED_CHAR,A);y&&(e._openGLRenderWindow.setGraphicsResourceForObject(y,e.pwfTexture,C),y!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(y,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=y)}else e.pwfTexture=T.oglObject;t.updatelabelOutlineThicknessTexture(i);const{ijkMode:x}=e.renderable.getClosestIJKAxis();let w=e.renderable.getSlice();x!==e.renderable.getSlicingMode()&&(w=e.renderable.getSliceAtPosition(w));const E=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(w),M=a.getExtent();let O;x===vr.I&&(O=E-M[0]),x===vr.J&&(O=E-M[2]),(x===vr.K||x===vr.NONE)&&(O=E-M[4]);const R=`${w}A${a.getMTime()}A${o.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==R){const U=a.getDimensions();e.openGLTexture||(e.openGLTexture=Je.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),f===To.NEAREST?(new Set([1,3,4]).has(c)&&s===Se.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(oe.NEAREST),e.openGLTexture.setMagnificationFilter(oe.NEAREST)):(c===4&&s===Se.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(oe.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(oe.LINEAR),e.openGLTexture.setMagnificationFilter(oe.LINEAR)),e.openGLTexture.setWrapS(hl.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(hl.CLAMP_TO_EDGE);const K=U[0]*U[1]*c,A=new Float32Array(12),b=new Float32Array(8);for(let Ge=0;Ge<4;Ge++)b[Ge*2]=Ge%2?1:0,b[Ge*2+1]=Ge>1?1:0;const F=[vr.X,vr.Y,vr.Z].includes(e.renderable.getSlicingMode())?w:E,$=a.getSpatialExtent(),j=o.getData();let z=null;if(x===vr.I){z=new j.constructor(U[2]*U[1]*c);let Ge=0;for(let ot=0;ot<U[2];ot++)for(let me=0;me<U[1];me++){let Ce=(O+me*U[0]+ot*U[0]*U[1])*c;Ge=(ot*U[1]+me)*c;const Yt=Ce+c;for(;Ce<Yt;)z[Ge++]=j[Ce++]}U[0]=U[1],U[1]=U[2],A[0]=F,A[1]=$[2],A[2]=$[4],A[3]=F,A[4]=$[3],A[5]=$[4],A[6]=F,A[7]=$[2],A[8]=$[5],A[9]=F,A[10]=$[3],A[11]=$[5]}else if(x===vr.J){z=new j.constructor(U[2]*U[0]*c);let Ge=0;for(let ot=0;ot<U[2];ot++)for(let me=0;me<U[0];me++){let Ce=(me+O*U[0]+ot*U[0]*U[1])*c;Ge=(ot*U[0]+me)*c;const Yt=Ce+c;for(;Ce<Yt;)z[Ge++]=j[Ce++]}U[1]=U[2],A[0]=$[0],A[1]=F,A[2]=$[4],A[3]=$[1],A[4]=F,A[5]=$[4],A[6]=$[0],A[7]=F,A[8]=$[5],A[9]=$[1],A[10]=F,A[11]=$[5]}else x===vr.K||x===vr.NONE?(z=j.subarray(O*K,(O+1)*K),A[0]=$[0],A[1]=$[2],A[2]=F,A[3]=$[1],A[4]=$[2],A[5]=F,A[6]=$[0],A[7]=$[3],A[8]=F,A[9]=$[1],A[10]=$[3],A[11]=F):ts("Reformat slicing not yet supported.");e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw(U[0],U[1],c,o.getDataType(),z,(W=(N=e.renderable).getPreferSizeOverAccuracy)==null?void 0:W.call(N)),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const ge=he.newInstance({numberOfComponents:3,values:A});ge.setName("points");const Pt=he.newInstance({numberOfComponents:2,values:b});Pt.setName("tcoords");const Ae=new Uint16Array(8);Ae[0]=3,Ae[1]=0,Ae[2]=1,Ae[3]=3,Ae[4]=3,Ae[5]=0,Ae[6]=3,Ae[7]=2;const Dt=he.newInstance({numberOfComponents:1,values:Ae});e.tris.getCABO().createVBO(Dt,"polys",an.SURFACE,{points:ge,tcoords:Pt,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=R}},t.updatelabelOutlineThicknessTexture=r=>{var c;const i=r.getProperty().getLabelOutlineThickness(),a=e._openGLRenderWindow.getGraphicsResourceForObject(i),o=`${i.join("-")}`;if(!((c=a==null?void 0:a.oglObject)!=null&&c.getHandle())||(a==null?void 0:a.hash)!==o){const g=new Uint8Array(1024);for(let d=0;d<1024;++d){const h=typeof i[d]<"u"?i[d]:i[0];g[d]=h}e.labelOutlineThicknessTexture=Je.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(oe.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(oe.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,Se.UNSIGNED_CHAR,g),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,o),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=a.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:r,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:r,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.delete=Wl(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const pA={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function hA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pA,n),ze.extend(t,e,n),ti.implementReplaceShaderCoincidentOffset(t,e,n),ti.implementBuildShadersWithReplacements(t,e,n),e.tris=ri.newInstance(),e.imagemat=ie(new Float64Array(16)),e.imagematinv=ie(new Float64Array(16)),e.projectionToWorld=ie(new Float64Array(16)),e.idxToView=ie(new Float64Array(16)),e.idxNormalMatrix=pr(new Float64Array(9)),e.modelToView=ie(new Float64Array(16)),e.projectionToView=ie(new Float64Array(16)),Ot(t,e,[]),e.VBOBuildTime={},je(e.VBOBuildTime),dA(t,e)}const fx=be(hA,"vtkOpenGLImageMapper");var mA={newInstance:fx};Nt("vtkAbstractImageMapper",fx);function vA(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{n&&e.context.depthMask(!0)},t.translucentPass=(n,r)=>{e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(it(e.keyMatrices.mcwc,e.renderable.getMatrix()),xe(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const yA={context:null,keyMatrixTime:null,keyMatrices:null};function CA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yA,n),ze.extend(t,e,n),e.keyMatrixTime={},je(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:ie(new Float64Array(16))},Ot(t,e,["context"]),vA(t,e)}const gx=be(CA,"vtkOpenGLImageSlice");var TA={newInstance:gx};Nt("vtkImageSlice",gx);const{vtkDebugMacro:SA}=cn;function xA(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),l=Math.floor(c.getWidth()),f=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();const g=r.getFramebuffer();g?g.saveCurrentBindingsAndBuffers():SA("No framebuffer to save/restore");const d=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,d),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(l*f*4),u.viewport(0,0,l,f),u.readPixels(0,0,l,f,u.RGBA,u.UNSIGNED_BYTE,s)),g&&g.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(d)}e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const wA={};function EA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wA,n),ze.extend(t,e,n),xA(t,e)}const dx=be(EA,"vtkOpenGLPixelSpaceCallbackMapper");var OA={newInstance:dx};Nt("vtkPixelSpaceCallbackMapper",dx);const{vtkDebugMacro:DA}=cn;function RA(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(DA("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),r|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const a=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.colorMask(!0,!0,!0,!0),r&&i.clear(r),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-s,d=Math.round(u[1])-c;return g<0&&(g=0),d<0&&(d=0),{usize:g,vsize:d,lowerLeftU:s,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const a=e.renderable.getBackgroundByReference();r.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const MA={context:null,_openGLRenderWindow:null,selector:null};function LA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MA,n),ze.extend(t,e,n),In(t,e,["shaderCache"]),Ot(t,e,["selector"]),Gl(t,e,["openGLRenderWindow"]),RA(t,e)}const px=be(LA,"vtkOpenGLRenderer");var IA={newInstance:px};Nt("vtkRenderer",px);const{vtkErrorMacro:uv}=cn;function VA(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const a=e._openGLRenderer.getRenderable(),o=e.openGLCamera.getKeyMatrices(a),s=new Float64Array(16);if(xt(s,o.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const c=a.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let s=0;s<4;s++)r[s*3]=s%2*2-1,r[s*3+1]=s>1?1:-1,r[s*3+2]=1;const i=he.newInstance({numberOfComponents:3,values:r});i.setName("points");const a=new Uint16Array(8);a[0]=3,a[1]=0,a[2]=1,a[3]=3,a[4]=3,a[5]=0,a[6]=3,a[7]=2;const o=he.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",an.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||uv("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||uv("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const _A={context:null};function bA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_A,n),ze.extend(t,e,n),e.openGLTexture=Je.newInstance(),e.tris=ri.newInstance(),e.keyMatrixTime={},je(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:pr(new Float64Array(9)),mcwc:ie(new Float64Array(16))},Ot(t,e,["context"]),In(t,e,["activeTextures"]),VA(t,e)}const hx=be(bA);var NA={newInstance:hx};Nt("vtkSkybox",hx);var PA=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:kA}=cn;function FA(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=PA,r.Fragment=Kl,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=k.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=k.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=k.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=k.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=k.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=k.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=k.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{if(r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"offsetMC",12,r.getCABO().getStride(),e.context.FLOAT,2,!1)||kA("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isUniformUsed("invertedDepth")&&r.getProgram().setUniformf("invertedDepth",e.invert?-1:1),r.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?r.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):r.getProgram().setUniformf("scaleFactor",1)}n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),o.isUniformUsed("MCVCMatrix"))if(a.getIsIdentity())o.setUniformMatrix("MCVCMatrix",c.wcvc);else{const l=e.openGLActor.getKeyMatrices(),f=new Float64Array(16);De(f,c.wcvc,l.mcwc),o.setUniformMatrix("MCVCMatrix",f)}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),l=a.getPoints(),f=l.getNumberOfPoints(),u=l.getData(),g=5;let d=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(d=c.getArray(e.renderable.getScaleArray()).getData());let h=null,p=0,m=null;o?(p=o.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),h=o.getData(),m=new Uint8Array(3*f*4),s.getColorBO()||s.setColorBO(yi.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(p);const v=new Float32Array(g*f*3);s.setStride(g*4);const y=Math.cos(gt(30));let C=0,T=0,S=0,x=0;for(let w=0;w<f;++w){let E=e.renderable.getRadius();d&&(E=d[w]),C=w*3,v[S++]=u[C++],v[S++]=u[C++],v[S++]=u[C++],v[S++]=-2*E*y,v[S++]=-E,h&&(T=w*p,m[x++]=h[T],m[x++]=h[T+1],m[x++]=h[T+2],m[x++]=h[T+3]),C=w*3,v[S++]=u[C++],v[S++]=u[C++],v[S++]=u[C++],v[S++]=2*E*y,v[S++]=-E,h&&(m[x++]=h[T],m[x++]=h[T+1],m[x++]=h[T+2],m[x++]=h[T+3]),C=w*3,v[S++]=u[C++],v[S++]=u[C++],v[S++]=u[C++],v[S++]=0,v[S++]=2*E,h&&(m[x++]=h[T],m[x++]=h[T+1],m[x++]=h[T+2],m[x++]=h[T+3])}s.setElementCount(S/g),s.upload(v,wi.ARRAY_BUFFER),o&&s.getColorBO().upload(m,wi.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const UA={};function AA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,UA,n),Jg.extend(t,e,n),FA(t,e)}const mx=be(AA,"vtkOpenGLSphereMapper");var BA={newInstance:mx};Nt("vtkSphereMapper",mx);var GA=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:_u}=cn;function WA(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const n={...t};t.getShaderTemplate=(r,i,a)=>{r.Vertex=GA,r.Fragment=Kl,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;o=k.substitute(o,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=k.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=k.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=k.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=k.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=k.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=k.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,n.replaceShaderValues(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("orientMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"orientMC",12,r.getCABO().getStride(),e.context.FLOAT,3,!1)||_u("Error setting 'orientMC' in shader VAO.")),r.getProgram().isAttributeUsed("offsetMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"offsetMC",0,r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||_u("Error setting 'offsetMC' in shader VAO.")),r.getProgram().isAttributeUsed("radiusMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"radiusMC",24,r.getCABO().getStride(),e.context.FLOAT,1,!1)||_u("Error setting 'radiusMC' in shader VAO."))),n.setMapperShaderParameters(r,i,a)},t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(o.isUniformUsed("VCPCMatrix")&&o.setUniformMatrix("VCPCMatrix",c.vcpc),a.getIsIdentity())o.isUniformUsed("MCVCMatrix")&&o.setUniformMatrix("MCVCMatrix",c.wcvc),o.isUniformUsed("normalMatrix")&&o.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const l=e.openGLActor.getKeyMatrices();if(o.isUniformUsed("MCVCMatrix")){const f=new Float64Array(16);De(f,c.wcvc,l.mcwc),o.setUniformMatrix("MCVCMatrix",f)}if(o.isUniformUsed("normalMatrix")){const f=new Float64Array(9);s0(f,c.normalMatrix,l.normalMatrix),o.setUniformMatrix3x3("normalMatrix",f)}}o.isUniformUsed("cameraParallel")&&r.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(r,i)=>e.context.TRIANGLES,t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,1);const o=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=a.getPointData(),l=a.getPoints(),f=l.getNumberOfPoints(),u=l.getData();let g=3;g+=4;let d=null,h=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(yi.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),o&&(h=o.getNumberOfComponents(),s.setColorOffset(4),d=o.getData(),s.setColorBOStride(8)),s.setColorComponents(h),s.setStride(g*4);const p=new Float32Array(g*f*12),m=new Uint8Array(12*f*(d?8:4));let v=null,y=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(v=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?y=c.getArray(e.renderable.getOrientationArray()).getData():_u([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const C=[0,1,3,0,3,2,2,3,5,2,5,4];let T=0,S=0,x=0,w=0;for(let E=0;E<f;++E){let M=e.renderable.getLength(),O=e.renderable.getRadius();v&&(M=v[E*2],O=v[E*2+1]);for(let R=0;R<C.length;++R)T=E*3,p[x++]=u[T++],p[x++]=u[T++],p[x++]=u[T++],T=E*3,p[x++]=y[T++]*M,p[x++]=y[T++]*M,p[x++]=y[T++]*M,p[x++]=O,m[w++]=255*(C[R]%2),m[w++]=C[R]>=4?255:0,m[w++]=C[R]>=2?255:0,m[w++]=255,S=E*h,d&&(m[w++]=d[S],m[w++]=d[S+1],m[w++]=d[S+2],m[w++]=d[S+3])}s.setElementCount(x/g),s.upload(p,wi.ARRAY_BUFFER),s.getColorBO().upload(m,wi.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const $A={};function zA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$A,n),Jg.extend(t,e,n),WA(t,e)}const vx=be(zA,"vtkOpenGLStickMapper");var HA={newInstance:vx};Nt("vtkStickMapper",vx);function jA(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=n=>{!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=n=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),it(e.MCWCMatrix,e.renderable.getMatrix()),xe(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?pr(e.normalMatrix):(Fg(e.normalMatrix,e.MCWCMatrix),Ul(e.normalMatrix,e.normalMatrix),J5(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const KA={};function qA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KA,n),ze.extend(t,e,n),e.keyMatrixTime={},je(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),Ot(t,e,["context"]),jA(t,e)}const yx=be(qA,"vtkOpenGLVolume");var XA={newInstance:yx};Nt("vtkVolume",yx);const wh={NEAREST:0,LINEAR:1,FAST_LINEAR:2},Cx={FRACTIONAL:0,PROPORTIONAL:1},Ff={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var Tx={InterpolationType:wh,OpacityMode:Cx,ColorMixPreset:Ff},YA=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,ZA=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define UseIndependentComponents
//VTK::IndependentComponentsOn

// possibly define vtkCustomComponentsColorMix
//VTK::CustomComponentsColorMixOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// possibly define any components that are forced to nearest interpolation
//VTK::vtkForceNearestComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Possibly define vtkLabelEdgeProjectionOn
//VTK::LabelEdgeProjectionOn


#ifdef vtkImageLabelOutlineOn
  uniform float outlineOpacity;
  uniform float vpWidth;
  uniform float vpHeight;
  uniform float vpOffsetX;
  uniform float vpOffsetY;
  uniform mat4 PCWCMatrix;
  uniform mat4 vWCtoIDX;

  const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
  // bool seenSegmentsByOriginalPos[MAX_SEGMENT_INDEX];
  #define MAX_SEGMENTS 256
  #define UINT_SIZE 32
  #define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)

  uint bitmask[BITMASK_SIZE];

  // Set the corresponding bit in the bitmask
  void setBit(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    bitmask[index] |= 1u << bitIndex;
  }

  // Check if a bit is set in the bitmask
  bool isBitSet(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    return ((bitmask[index] & (1u << bitIndex)) != 0u);
  }
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#ifdef UseIndependentComponents
#if vtkNumComponents > 1
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents > 2
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#if vtkNumComponents > 3
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

// jitter texture
uniform sampler2D jtexture;
uniform sampler2D ttexture;


// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;
uniform vec3 volumeSpacings; // spacing in the world coorindates


// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef UseIndependentComponents
#if vtkNumComponents == 1
uniform float mix0;
#define height0 0.5
#endif
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);

  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);
    vec4 nearestValue = texture(texture1, nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  #ifndef UseIndependentComponents
    #if vtkNumComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkClippingPlanesOn
    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
    {
      vec3 g1VC[3];
      for (int i = 0; i < 3; ++i)
      {
        g1VC[i] = IStoVC(texPos[i]);
      }
      vec3 posVC = IStoVC(pos);
      for (int i = 0; i < clip_numPlanes; ++i)
      {
        for (int j = 0; j < 3; ++j)
        {
          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
          {
            g1[j] = 0.0;
          }
        }
      }
    }
  #endif

  #ifdef vtkComputeNormalFromOpacity
    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {
      vec3 opacityG1, opacityG2;
      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;
      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;
      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;
      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;
      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;
      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;
      opacityG1.xyz *= gradientOpacity;
      opacityG2.xyz *= gradientOpacity;

      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
      // divide by spacing
      opacityG.xyz /= vSpacing;
      opacityG.w = length(opacityG.xyz);
      // rotate to View Coords
      rotateToViewCoord(opacityG.xyz);
      if (!all(equal(opacityG.xyz, vec3(0.0)))) {
        return vec4(normalize(opacityG.xyz),opacityG.w);
      } else {
        return vec4(0.0);
      }
    }

    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)
    {
      vec3 xvec = vec3(tstep.x, 0.0, 0.0);
      vec3 yvec = vec3(0.0, tstep.y, 0.0);
      vec3 zvec = vec3(0.0, 0.0, tstep.z);
      vec3 texPosPVec[3];
      texPosPVec[0] = pos + xvec;
      texPosPVec[1] = pos + yvec;
      texPosPVec[2] = pos + zvec;
      vec3 texPosNVec[3];
      texPosNVec[0] = pos - xvec;
      texPosNVec[1] = pos - yvec;
      texPosNVec[2] = pos - zvec;
      vec3 g1, g2;

      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];
      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];
      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];
      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];
      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];
      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];

      #ifdef vtkClippingPlanesOn
        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
      #endif
      vec4 result;
      result.x = scalarInterp[0].x - scalarInterp[1].x;
      result.y = scalarInterp[0].y - scalarInterp[1].y;
      result.z = scalarInterp[0].z - scalarInterp[1].z;
      // divide by spacing
      result.xyz /= vSpacing;
      result.w = length(result.xyz);
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      if (length(result.xyz) > 0.0) {
        return vec4(normalize(result.xyz),result.w);
      } else {
        return vec4(0.0);
      }
    }
  #endif

  // only works with dependent components
  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif


#ifdef vtkImageLabelOutlineOn
  vec4 fragCoordToPCPos(vec4 fragCoord) {
    return vec4(
      (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
      (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
      (fragCoord.z - 0.5) * 2.0,
      1.0);
  }

  vec4 pcPosToWorldCoord(vec4 pcPos) {
    return PCWCMatrix * pcPos;
  }

  vec3 fragCoordToIndexSpace(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    vec4 vertex = (worldCoord / worldCoord.w);

    vec3 index = (vWCtoIDX * vertex).xyz;

    // half voxel fix for labelmapOutline
    return (index + vec3(0.5)) / vec3(volumeDimensions);
  }

  vec3 fragCoordToWorld(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    return worldCoord.xyz;
  }
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)
      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {
  #if vtkLightComplexity > 0
    // surface shadows if needed
    #ifdef SurfaceShadowOn
      #if vtkLightComplexity < 3
        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);
      #else
        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));
      #endif
    #endif

    // volume shadows if needed
    #ifdef VolumeShadowOn
      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);
    #endif

    // merge
    #ifdef VolumeShadowOn
      #ifdef SurfaceShadowOn
        // surface shadows + volumetric shadows
        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
      #else
        // volumetric shadows only
        tColor = tColorVS;
      #endif
    #else
      #ifdef SurfaceShadowOn
        // surface shadows only
        tColor = tColorS;
      #else
        // no shadows
        applyLighting(tColor, normal3);
      #endif
    #endif
  #endif
  return tColor;
}

  
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{

// If labeloutline and not the edge labelmap, since in the edge labelmap blend
// we need the underlying data to sample through
#if defined(vtkImageLabelOutlineOn) && !defined(vtkLabelEdgeProjectionOn)
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  int segmentIndex = int(centerValue.r * 255.0);
  
  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

  int actualThickness = int(textureValue * 255.0);


  // If it is the background (segment index 0), we should quickly bail out. 
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0){
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
        gl_FragCoord.y + float(j),
        gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = outlineOpacity;
  }

  return tColor;

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4

  #ifdef UseIndependentComponents

    // sample textures
    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;

    #if vtkNumComponents > 1
      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;

      #if vtkNumComponents > 2
        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;

        #if vtkNumComponents > 3
          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #endif
      #endif
    #endif

    #if !defined(vtkCustomComponentsColorMix)
      // default path for component color mix

      // compute the normal vectors as needed
      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #endif

      // compute gradient opacity factors as needed
      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);
      #if defined(vtkGradientOpacityOn)
        #if !defined(vtkComponent0Proportional)
          goFactor.x =
            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
        #endif
        #if vtkNumComponents > 1
          #if !defined(vtkComponent1Proportional)
            goFactor.y =
              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          #endif
          #if vtkNumComponents > 2
            #if !defined(vtkComponent2Proportional)
              goFactor.z =
                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);
            #endif
            #if vtkNumComponents > 3
              #if !defined(vtkComponent3Proportional)
                goFactor.w =
                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);
              #endif
            #endif
          #endif
        #endif
      #endif

      // process color and opacity for each component
      #if !defined(vtkComponent0Proportional)
        float alpha = goFactor.x*mix0*pwfValue0;
        #if vtkLightComplexity > 0
          applyLighting(tColor0, normalMat[0]);
        #endif
      #else
        tColor0 *= pwfValue0;
        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));
      #endif

      #if vtkNumComponents > 1
        #if !defined(vtkComponent1Proportional)
          alpha += goFactor.y*mix1*pwfValue1;
          #if vtkLightComplexity > 0
            applyLighting(tColor1, normalMat[1]);
          #endif
        #else
          tColor1 *= pwfValue1;
          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));
        #endif

        #if vtkNumComponents > 2
          #if !defined(vtkComponent2Proportional)
            alpha += goFactor.z*mix2*pwfValue2;
            #if vtkLightComplexity > 0
              applyLighting(tColor2, normalMat[2]);
            #endif
          #else
            tColor2 *= pwfValue2;
            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));
          #endif
        #endif

        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            alpha += goFactor.w*mix3*pwfValue3;
            #if vtkLightComplexity > 0
              applyLighting(tColor3, normalMat[3]);
            #endif
          #else
            tColor3 *= pwfValue3;
            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));
          #endif
        #endif
      #endif

      // perform final independent blend
      vec3 tColor = mix0 * tColor0;
      #if vtkNumComponents > 1
        tColor += mix1 * tColor1;
        #if vtkNumComponents > 2
          tColor += mix2 * tColor2;
          #if vtkNumComponents > 3
            tColor += mix3 * tColor3;
          #endif
        #endif
      #endif

      return vec4(tColor, alpha);
    #else
      /*
       * Mix the color information from all the independent components to get a single rgba output
       * Gradient opactity factors and normals are not computed
       *
       * You can compute these using:
       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix
       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),
       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper
       * - computeGradientOpacityFactor: always available, used in a lot of places
       *
       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)
       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight
       */
      //VTK::CustomComponentsColorMix::Impl
    #endif
  #else
    // dependent components

    // compute normal if needed
    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
      #endif
    #endif

    // compute gradient opacity factor enabled
    #if defined(vtkGradientOpacityOn)
      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #else
      const float gradientOpacity = 1.0;
    #endif

    // get color and opacity
    #if vtkNumComponents == 1
      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      if (alpha < EPSILON){
        return vec4(0.0);
      }
    #endif
    #if vtkNumComponents == 2
      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    #endif
    #if vtkNumComponents == 3
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
    #endif
    #if vtkNumComponents == 4
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
    #endif

    // lighting
    #if (vtkLightComplexity > 0)
      #ifdef vtkComputeNormalFromOpacity
        vec4 normalLight;
        if (!all(equal(normal0, vec4(0.0)))) {
          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;
          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;
          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);
          if (all(equal(normalLight, vec4(0.0)))) {
            normalLight = normal0;
          }
        }
      #else
        vec4 normalLight = normal0;
      #endif
      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);
    #endif

    return vec4(tColor, alpha);
  #endif // dependent
#endif
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #else
    #ifdef UseIndependentComponents
      #if vtkNumComponents == 2
        if (val.r >= min.r && val.r <= max.r &&
            val.g >= min.g && val.g <= max.g) {
          withinRange = true;
        }
      #else
        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
            all(lessThanEqual(val, ipScalarRangeMax))) {
          withinRange = true;
        }
      #endif
    #endif
  #endif
  return withinRange;
}

#if vtkBlendMode == 6 
bool checkOnEdgeForNeighbor(int i, int j, int s, vec3 stepIS) {
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j), gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    bool justSawIt = false;

    vec3 neighborPosIS = originalNeighborPosIS;

    float stepsTraveled = 0.0;


    // float neighborValue;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS += stepIS;
    }

    if (justSawIt){
      return false;
    }

   
    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS -= stepIS;
    }


    if (!justSawIt) {
        // onedge
        vec3 tColorSegment = texture2D(ctexture, vec2(float(s) * cscale1 + cshift1, height1)).rgb;
        float pwfValueSegment = texture2D(otexture, vec2(float(s) * oscale1 + oshift1, height1)).r;
        gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
        return true;
    }

    // not on edge
    return false;
}

#endif


//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // Initialize arrays to false
  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);
  
  #if vtkBlendMode == 6 
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    uint bitmask = 0u;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading 
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the segment index
      // and later check if the bit is set via bit operations
      setBit(segmentIndex);
    }
    
    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value =  tValue; // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue; // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }  

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      gl_FragData[0] = getColorForValue(value, maxPosIS, tstep);
      return;
    }

    // probably we can make this configurable but for now we will use the same
    // sample distance as the original sample distance
    float neighborSampleDistanceIS = sampleDistanceIS;

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    float minVoxelSpacing = min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base = vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z, gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not 
      // been seen by the center segment
      if (!isBitSet(s)) {
       continue;
      }

      // Use texture sampling for outlineThickness so that we can have 
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out 
      // faster if we find the edge
      bool onEdge =
          checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s, stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than 
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety 
      // of the all the fragments inside. i.e., this happens when we zoom out, 
      if (minVoxelSpacing > (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }
      
      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
            for (int j = -actualThickness; j <= actualThickness; j++) {
                if (i == 0 && j == 0) continue; // Skip the center
                if (abs(i) == actualThickness && abs(j) == actualThickness) continue; // Skip corners
                if (checkOnEdgeForNeighbor(i, j, s, stepIS )) {
                    return;
                }
          }
      }
    }

    vec3 tColor0 = texture2D(ctexture, vec2(value.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(value.r * oscale0 + oshift0, height0)).r;
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;const{vtkWarningMacro:JA,vtkErrorMacro:y2}=cn;function QA(t){switch(t){case Ff.CUSTOM:return"//VTK::CustomColorMix";case Ff.ADDITIVE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);

          vec3 scalarInterp1[2];
          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);
          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;
          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;
          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
          vec4 normalLight1 = normalMat[1];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        float opacity1 = pwfValue1;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          opacity1 *= gof1;
        #endif
        float opacitySum = opacity0 + opacity1;
        if (opacitySum <= 0.0) {
          return vec4(0.0);
        }

        // mix the colors and opacities
        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);
        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);
        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;
        return vec4(mixedColor, min(1.0, opacitySum));
`;case Ff.COLORIZE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
        #endif

        // mix the colors and opacities
        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);
        color = applyAllLightning(color, opacity0, posIS, normalLight0);
        return vec4(color, opacity0);
`;default:return null}}function eB(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function n(i){[e._scalars,e._scalarOpacityFunc,e._colorTransferFunc,e._labelOutlineThicknessArray].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(i,a)=>{if(i){const o=a.getZBufferTexture();o!==e.zBufferTexture&&(e.zBufferTexture=o)}},t.opaqueZBufferPass=(i,a)=>t.zBufferPass(i,a),t.volumePass=(i,a)=>{if(i){const o=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),o&&!o.isDeleted()&&o!==e._openGLRenderWindow&&n(o),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const s=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const c=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(c.getActiveCamera()),t.renderPiece(c,s)}},t.getShaderTemplate=(i,a,o)=>{i.Vertex=YA,i.Fragment=ZA,i.Geometry=""},t.useIndependentComponents=i=>{var l,f;const a=i.getIndependentComponents(),o=e.currentInput,s=(f=(l=o==null?void 0:o.getPointData())==null?void 0:l.getScalars())==null?void 0:f.getNumberOfComponents(),c=i.getColorMixPreset();return a&&s>=2||!!c},t.replaceShaderValues=(i,a,o)=>{const s=o.getProperty();let c=i.Fragment;s.getInterpolationType()===wh.LINEAR&&(c=k.substitute(c,"//VTK::TrilinearOn","#define vtkTrilinearOn").result),t.isLabelmapOutlineRequired(o)===!0&&(c=k.substitute(c,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result),e.renderable.getBlendMode()===Of.LABELMAP_EDGE_PROJECTION_BLEND&&(c=k.substitute(c,"//VTK::LabelEdgeProjectionOn","#define vtkLabelEdgeProjectionOn").result);const g=e.scalarTexture.getComponents();c=k.substitute(c,"//VTK::NumComponents",`#define vtkNumComponents ${g}`).result;const d=t.useIndependentComponents(s);d&&(c=k.substitute(c,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const h=[],p=[];for(let w=0;w<g;w++)s.getOpacityMode(w)===Cx.PROPORTIONAL&&h.push(`#define vtkComponent${w}Proportional`),s.getForceNearestInterpolation(w)&&p.push(`#define vtkComponent${w}ForceNearest`);c=k.substitute(c,"//VTK::vtkProportionalComponents",h.join(`
`)).result,c=k.substitute(c,"//VTK::vtkForceNearestComponents",p.join(`
`)).result;const m=s.getColorMixPreset(),v=QA(m);v&&(c=k.substitute(c,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,c=k.substitute(c,"//VTK::CustomComponentsColorMix::Impl",v).result);const y=e.currentInput.getSpatialExtent(),C=e.currentInput.getSpacing(),T=new Float64Array(3);Fe(T,(y[1]-y[0])*C[0],(y[3]-y[2])*C[1],(y[5]-y[4])*C[2]);const S=ma(T)/t.getCurrentSampleDistance(a);c=k.substitute(c,"//VTK::MaximumSamplesValue",`${Math.ceil(S)}`).result,c=k.substitute(c,"//VTK::LightComplexity",`#define vtkLightComplexity ${e.lightComplexity}`).result,e.lightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(c=k.substitute(c,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(c=k.substitute(c,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&s.getAmbient()>0&&(c=k.substitute(c,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const x=d?g:1;e.gopacity=!1;for(let w=0;!e.gopacity&&w<x;++w)e.gopacity||(e.gopacity=s.getUseGradientOpacity(w));e.gopacity&&(c=k.substitute(c,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(c=k.substitute(c,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(c=k.substitute(c,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,c=k.substitute(c,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),c=k.substitute(c,"//VTK::BlendMode",`${e.renderable.getBlendMode()}`).result,i.Fragment=c,t.replaceShaderLight(i,a,o),t.replaceShaderClippingPlane(i,a,o)},t.replaceShaderLight=(i,a,o)=>{if(e.lightComplexity===0)return;let s=i.Fragment,c=0;a.getLights().forEach(l=>{l.getSwitch()&&(c+=1)}),s=k.substitute(s,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${c}];`,`uniform vec3 lightDirectionVC[${c}]; // normalized`,`uniform vec3 lightHalfAngleVC[${c}];`,"//VTK::Light::Dec"],!1).result,e.lightComplexity===3&&(s=k.substitute(s,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${c}];`,`uniform vec3 lightAttenuation[${c}];`,`uniform float lightConeAngle[${c}];`,`uniform float lightExponent[${c}];`,`uniform int lightPositional[${c}];`],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(s=k.substitute(s,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&o.getProperty().getAmbient()>0&&(s=k.substitute(s,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${e.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),i.Fragment=s},t.replaceShaderClippingPlane=(i,a,o)=>{let s=i.Fragment;if(e.renderable.getClippingPlanes().length>0){const c=e.renderable.getClippingPlanes().length;s=k.substitute(s,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,s=k.substitute(s,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${c}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}i.Fragment=s};const r=(i,a)=>{let o=0;i.getProperty().getShade()&&e.renderable.getBlendMode()===Of.COMPOSITE_BLEND&&(o=0,e.numberOfLights=0,a.forEach(s=>{s.getSwitch()>0&&(e.numberOfLights++,o===0&&(o=1)),o===1&&(e.numberOfLights>1||s.getIntensity()!==1||!s.lightTypeIsHeadLight())&&(o=2),o<3&&s.getPositional()&&(o=3)})),o!==e.lightComplexity&&(e.lightComplexity=o,t.modified())};t.getNeedToRebuildShaders=(i,a,o)=>{var v;const s=o.getProperty();r(o,a.getLights());const c=e.scalarTexture.getComponents(),l=[],f=[];for(let y=0;y<c;y++)l.push(s.getOpacityMode(y)),f.push(s.getForceNearestInterpolation(y));const u=e.currentInput.getSpatialExtent(),g=e.currentInput.getSpacing(),d=new Float64Array(3);Fe(d,(u[1]-u[0])*g[0],(u[3]-u[2])*g[1],(u[5]-u[4])*g[2]);const h=ma(d)/t.getCurrentSampleDistance(a),p=!!e.zBufferTexture,m={iComps:s.getIndependentComponents(),colorMixPreset:s.getColorMixPreset(),interpolationType:s.getInterpolationType(),useLabelOutline:t.isLabelmapOutlineRequired(o),numComp:c,maxSamples:h,useGradientOpacity:s.getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),hasZBufferTexture:p,opacityModes:l,forceNearestInterps:f};return((v=i.getProgram())==null?void 0:v.getHandle())===0||i.getShaderSourceTime().getMTime()<t.getMTime()||i.getShaderSourceTime().getMTime()<e.renderable.getMTime()||!e.previousState||!xC(e.previousState,m)?(e.previousState=m,!0):!1},t.updateShaders=(i,a,o)=>{if(t.getNeedToRebuildShaders(i,a,o)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,o);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,o),t.setCameraShaderParameters(i,a,o),t.setPropertyShaderParameters(i,a,o),t.getClippingPlaneShaderParameters(i,a,o)},t.setMapperShaderParameters=(i,a,o)=>{var f;const s=i.getProgram();i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexDC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexDC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||y2("Error setting vertexDC in shader VAO.")),i.getAttributeUpdateTime().modified()),s.setUniformi("texture1",e.scalarTexture.getTextureUnit()),s.setUniformf("sampleDistance",t.getCurrentSampleDistance(a));const c=e.scalarTexture.getVolumeInfo(),l=e.renderable.getIpScalarRange();if((f=c==null?void 0:c.dataComputedScale)!=null&&f.length){const u=[],g=[];for(let d=0;d<4;d++)u[d]=l[0]*c.dataComputedScale[d]+c.dataComputedOffset[d],g[d]=l[1]*c.dataComputedScale[d]+c.dataComputedOffset[d],u[d]=(u[d]-c.offset[d])/c.scale[d],g[d]=(g[d]-c.offset[d])/c.scale[d];s.setUniform4f("ipScalarRangeMin",u[0],u[1],u[2],u[3]),s.setUniform4f("ipScalarRangeMax",g[0],g[1],g[2],g[3])}if(e.zBufferTexture!==null){s.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const u=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();s.setUniformf("vpZWidth",u[0]),s.setUniformf("vpZHeight",u[1])}},t.setCameraShaderParameters=(i,a,o)=>{const s=e.openGLCamera.getKeyMatrices(a),c=e.openGLVolume.getKeyMatrices();De(e.modelToView,s.wcvc,c.mcwc);const l=i.getProgram(),f=e.openGLCamera.getRenderable(),u=f.getClippingRange();l.setUniformf("camThick",u[1]-u[0]),l.setUniformf("camNear",u[0]),l.setUniformf("camFar",u[1]);const g=e.currentInput.getBounds(),d=e.currentInput.getDimensions(),h=new Float64Array(3),p=new Float64Array(3);let m=1,v=-1,y=1,C=-1;for(let U=0;U<8;++U){if(Fe(h,g[U%2],g[2+Math.floor(U/2)%2],g[4+Math.floor(U/4)]),Ee(h,h,e.modelToView),!f.getParallelProjection()){$t(p,h);const K=-u[0]/h[2];Hn(h,p,K)}Ee(h,h,s.vcpc),m=Math.min(h[0],m),v=Math.max(h[0],v),y=Math.min(h[1],y),C=Math.max(h[1],C)}l.setUniformf("dcxmin",m),l.setUniformf("dcxmax",v),l.setUniformf("dcymin",y),l.setUniformf("dcymax",C),l.isUniformUsed("cameraParallel")&&l.setUniformi("cameraParallel",f.getParallelProjection());const T=e.currentInput.getSpatialExtent(),S=e.currentInput.getSpacing(),x=new Float64Array(3);Fe(x,(T[1]-T[0])*S[0],(T[3]-T[2])*S[1],(T[5]-T[4])*S[2]),l.setUniform3f("vSpacing",S[0],S[1],S[2]),Fe(h,T[0],T[2],T[4]),e.currentInput.indexToWorldVec3(h,h),Ee(h,h,e.modelToView),l.setUniform3f("vOriginVC",h[0],h[1],h[2]);const w=e.currentInput.getIndexToWorld();De(e.idxToView,e.modelToView,w),s0(e.idxNormalMatrix,s.normalMatrix,c.normalMatrix),s0(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());const E=ma(x)/t.getCurrentSampleDistance(a);E>e.renderable.getMaximumSamplesPerRay()&&JA(`The number of steps required ${Math.ceil(E)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const M=new Float64Array(3);if(Fe(M,1,1,1),HV(M,M,x),l.setUniform3f("vVCToIJK",M[0],M[1],M[2]),l.setUniform3i("volumeDimensions",d[0],d[1],d[2]),l.setUniform3f("volumeSpacings",S[0],S[1],S[2]),!e._openGLRenderWindow.getWebgl2()){const U=e.scalarTexture.getVolumeInfo();l.setUniformf("texWidth",e.scalarTexture.getWidth()),l.setUniformf("texHeight",e.scalarTexture.getHeight()),l.setUniformi("xreps",U.xreps),l.setUniformi("xstride",U.xstride),l.setUniformi("ystride",U.ystride)}const O=new Float64Array(3),R=new Float64Array(3);for(let U=0;U<6;++U){switch(U){case 1:Fe(O,-1,0,0),Fe(R,T[0],T[2],T[4]);break;case 2:Fe(O,0,1,0),Fe(R,T[1],T[3],T[5]);break;case 3:Fe(O,0,-1,0),Fe(R,T[0],T[2],T[4]);break;case 4:Fe(O,0,0,1),Fe(R,T[1],T[3],T[5]);break;case 5:Fe(O,0,0,-1),Fe(R,T[0],T[2],T[4]);break;case 0:default:Fe(O,1,0,0),Fe(R,T[1],T[3],T[5]);break}Df(O,O,e.idxNormalMatrix),Ee(R,R,e.idxToView);const K=-1*fe(R,O);l.setUniform3f(`vPlaneNormal${U}`,O[0],O[1],O[2]),l.setUniformf(`vPlaneDistance${U}`,K)}if(t.isLabelmapOutlineRequired(o)){const K=e.currentInput.getWorldToIndex();l.setUniformMatrix("vWCtoIDX",K);const A=a.getActiveCamera(),[b,F]=A.getClippingRange(),$=A.getDistance();A.setClippingRange($,$+.1);const j=e.openGLCamera.getKeyMatrices(a);xt(e.projectionToWorld,j.wcpc),A.setClippingRange(b,F),e.openGLCamera.getKeyMatrices(a),l.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const z=t.getRenderTargetSize();l.setUniformf("vpWidth",z[0]),l.setUniformf("vpHeight",z[1]);const ge=t.getRenderTargetOffset();l.setUniformf("vpOffsetX",ge[0]/z[0]),l.setUniformf("vpOffsetY",ge[1]/z[1])}if(xt(e.projectionToView,s.vcpc),l.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lightComplexity===0)return;let _=0;const P=[],N=[],W=[];if(a.getLights().forEach(U=>{if(U.getSwitch()>0){const A=U.getColor(),b=U.getIntensity();P[0+_*3]=A[0]*b,P[1+_*3]=A[1]*b,P[2+_*3]=A[2]*b;const F=U.getDirection();Fe(O,F[0],F[1],F[2]),Df(O,O,s.normalMatrix),$t(O,O),N[0+_*3]=O[0],N[1+_*3]=O[1],N[2+_*3]=O[2],W[0+_*3]=-.5*O[0],W[1+_*3]=-.5*O[1],W[2+_*3]=-.5*(O[2]-1),_++}}),l.setUniformi("twoSidedLighting",a.getTwoSidedLighting()),l.setUniformi("lightNum",_),l.setUniform3fv("lightColor",P),l.setUniform3fv("lightDirectionVC",N),l.setUniform3fv("lightHalfAngleVC",W),e.lightComplexity===3){_=0;const U=[],K=[],A=[],b=[],F=[];a.getLights().forEach($=>{if($.getSwitch()>0){const z=$.getAttenuationValues();K[0+_*3]=z[0],K[1+_*3]=z[1],K[2+_*3]=z[2],b[_]=$.getExponent(),A[_]=$.getConeAngle(),F[_]=$.getPositional();const ge=$.getTransformedPosition();Ee(ge,ge,e.modelToView),U[0+_*3]=ge[0],U[1+_*3]=ge[1],U[2+_*3]=ge[2],_+=1}}),l.setUniform3fv("lightPositionVC",U),l.setUniform3fv("lightAttenuation",K),l.setUniformfv("lightConeAngle",A),l.setUniformfv("lightExponent",b),l.setUniformiv("lightPositional",F)}if(e.renderable.getVolumetricScatteringBlending()>0&&(l.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),l.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),l.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),l.setUniformf("anisotropy",e.renderable.getAnisotropy()),l.setUniformf("anisotropy2",e.renderable.getAnisotropy()**2)),e.renderable.getLocalAmbientOcclusion()&&o.getProperty().getAmbient()>0){const U=e.renderable.getLAOKernelSize();l.setUniformi("kernelSize",U);const K=[];for(let A=0;A<U;A++)K[A*2]=Math.random()*.5,K[A*2+1]=Math.random()*.5;l.setUniform2fv("kernelSample",K),l.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}},t.setPropertyShaderParameters=(i,a,o)=>{const s=i.getProgram();s.setUniformi("ctexture",e.colorTexture.getTextureUnit()),s.setUniformi("otexture",e.opacityTexture.getTextureUnit()),s.setUniformi("jtexture",e.jitterTexture.getTextureUnit()),s.setUniformi("ttexture",e.labelOutlineThicknessTexture.getTextureUnit());const c=e.scalarTexture.getVolumeInfo(),l=o.getProperty(),f=e.scalarTexture.getComponents(),u=t.useIndependentComponents(l);if(u)for(let d=0;d<f;d++)s.setUniformf(`mix${d}`,o.getProperty().getComponentWeight(d));for(let d=0;d<f;d++){const h=u?d:0,p=c.scale[d],v=l.getScalarOpacity(h).getRange(),y=p/(v[1]-v[0]),C=(c.offset[d]-v[0])/(v[1]-v[0]);s.setUniformf(`oshift${d}`,C),s.setUniformf(`oscale${d}`,y);const S=l.getRGBTransferFunction(h).getRange(),x=(c.offset[d]-S[0])/(S[1]-S[0]),w=p/(S[1]-S[0]);s.setUniformf(`cshift${d}`,x),s.setUniformf(`cscale${d}`,w)}if(e.gopacity)if(u)for(let d=0;d<f;++d){const h=c.scale[d];if(l.getUseGradientOpacity(d)){const m=l.getGradientOpacityMinimumOpacity(d),v=l.getGradientOpacityMaximumOpacity(d);s.setUniformf(`gomin${d}`,m),s.setUniformf(`gomax${d}`,v);const y=[l.getGradientOpacityMinimumValue(d),l.getGradientOpacityMaximumValue(d)];s.setUniformf(`goscale${d}`,h*(v-m)/(y[1]-y[0])),s.setUniformf(`goshift${d}`,-y[0]*(v-m)/(y[1]-y[0])+m)}else s.setUniformf(`gomin${d}`,1),s.setUniformf(`gomax${d}`,1),s.setUniformf(`goscale${d}`,0),s.setUniformf(`goshift${d}`,1)}else{const d=c.scale[f-1],h=l.getGradientOpacityMinimumOpacity(0),p=l.getGradientOpacityMaximumOpacity(0);s.setUniformf("gomin0",h),s.setUniformf("gomax0",p);const m=[l.getGradientOpacityMinimumValue(0),l.getGradientOpacityMaximumValue(0)];s.setUniformf("goscale0",d*(p-h)/(m[1]-m[0])),s.setUniformf("goshift0",-m[0]*(p-h)/(m[1]-m[0])+h)}if(t.isLabelmapOutlineRequired(o)===!0){const d=o.getProperty().getLabelOutlineOpacity();s.setUniformf("outlineOpacity",d)}e.lightComplexity>0&&(s.setUniformf("vAmbient",l.getAmbient()),s.setUniformf("vDiffuse",l.getDiffuse()),s.setUniformf("vSpecular",l.getSpecular()),s.setUniformf("vSpecularPower",l.getSpecularPower()))},t.getClippingPlaneShaderParameters=(i,a,o)=>{if(e.renderable.getClippingPlanes().length>0){const s=e.openGLCamera.getKeyMatrices(a),c=[],l=[],f=[],u=e.renderable.getClippingPlanes(),g=u.length;for(let h=0;h<g;++h){const p=u[h].getNormal(),m=u[h].getOrigin();Df(p,p,s.normalMatrix),Ee(m,m,s.wcvc);const v=-1*fe(m,p);c.push(p[0]),c.push(p[1]),c.push(p[2]),l.push(v),f.push(m[0]),f.push(m[1]),f.push(m[2])}const d=i.getProgram();d.setUniform3fv("vClipPlaneNormals",c),d.setUniformfv("vClipPlaneDistances",l),d.setUniform3fv("vClipPlaneOrigins",f),d.setUniformi("clip_numPlanes",g)}},t.delete=Wl(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:i,vsize:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getRenderTargetOffset=()=>{const{lowerLeftU:i,lowerLeftV:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getCurrentSampleDistance=i=>{const a=i.getVTKWindow().getInteractor(),o=e.renderable.getSampleDistance();if(a.isAnimating()){const s=e.renderable.getInteractionSampleDistanceFactor();return o*s}return o},t.renderPieceStart=(i,a)=>{const o=i.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,o.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=o.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const c=o.getRecentAnimationFrameRate(),l=o.getDesiredUpdateRate()/c;(l>1.15||l<.85)&&(e._lastScale*=l),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const c=e._openGLRenderWindow.getFramebufferSize(),l=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(l*c[0]),e._smallViewportHeight=Math.ceil(l*c[1]),e._smallViewportHeight>c[1]&&(e._smallViewportHeight=c[1]),e._smallViewportWidth>c[0]&&(e._smallViewportWidth=c[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer();else{const u=e.framebuffer.getSize();(!u||u[0]!==c[0]||u[1]!==c[1])&&(e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const f=e.context;f.clearColor(0,0,0,0),f.colorMask(!0,!0,!0,!0),f.clear(f.COLOR_BUFFER_BIT),f.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/c[0],e._smallViewportHeight/c[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===wh.NEAREST?(e.scalarTexture.setMinificationFilter(oe.NEAREST),e.scalarTexture.setMagnificationFilter(oe.NEAREST)):(e.scalarTexture.setMinificationFilter(oe.LINEAR),e.scalarTexture.setMagnificationFilter(oe.LINEAR)),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(i,a)=>{const o=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,i,a),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=(i,a)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const l=e.copyShader;e.copyVAO=V3.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(l,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||y2("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const o=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,o[0],o[1]);const s=e.framebuffer.getColorTexture();s.activate(),e.copyShader.setUniformi("texture",s.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const c=e.context;c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.deactivate(),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){y2("No input!");return}t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a)},t.computeBounds=(i,a)=>{if(!t.getInput()){V0(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>{var o,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((o=e.scalarTexture)!=null&&o.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((c=e.labelOutlineThicknessTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,a)=>{var S,x;const o=e.currentInput;if(!o)return;const s=o.getPointData()&&o.getPointData().getScalars();if(!s)return;const c=a.getProperty();if(!e.jitterTexture.getHandle()){const w=new Uint8Array(1024);for(let E=0;E<32*32;++E)w[E]=255*Math.random();e.jitterTexture.setMinificationFilter(oe.LINEAR),e.jitterTexture.setMagnificationFilter(oe.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,Se.UNSIGNED_CHAR,w)}const l=s.getNumberOfComponents(),f=t.useIndependentComponents(c),u=f?l:1,g=c.getScalarOpacity(),d=e._openGLRenderWindow.getGraphicsResourceForObject(g);let h=ni(g,f,u);if(!(d!=null&&d.oglObject)||d.hash!==h){e.opacityTexture=Je.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const w=1024,E=w*2*u,M=new Float32Array(E),O=new Float32Array(w);for(let R=0;R<u;++R){const _=c.getScalarOpacity(R),P=t.getCurrentSampleDistance(i)/c.getScalarOpacityUnitDistance(R),N=_.getRange();_.getTable(N[0],N[1],w,O,1);for(let W=0;W<w;++W)M[R*w*2+W]=1-(1-O[W])**P,M[R*w*2+W+w]=M[R*w*2+W]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(oe.LINEAR),e.opacityTexture.setMagnificationFilter(oe.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(w,2*u,1,Se.FLOAT,M);else{const R=new Uint8ClampedArray(E);for(let _=0;_<E;++_)R[_]=255*M[_];e.opacityTexture.create2DFromRaw(w,2*u,1,Se.UNSIGNED_CHAR,R)}g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.opacityTexture,h),g!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=g)}else e.opacityTexture=d.oglObject;const m=c.getRGBTransferFunction();h=ni(m,f,u);const v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((S=v==null?void 0:v.oglObject)!=null&&S.getHandle())||(v==null?void 0:v.hash)!==h){e.colorTexture=Je.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const w=1024,E=w*2*u*3,M=new Uint8ClampedArray(E),O=new Float32Array(w*3);for(let R=0;R<u;++R){const _=c.getRGBTransferFunction(R),P=_.getRange();_.getTable(P[0],P[1],w,O,1);for(let N=0;N<w*3;++N)M[R*w*6+N]=255*O[N],M[R*w*6+N+w*3]=255*O[N]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(oe.LINEAR),e.colorTexture.setMagnificationFilter(oe.LINEAR),e.colorTexture.create2DFromRaw(w,2*u,3,Se.UNSIGNED_CHAR,M),m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,h),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=v.oglObject;t.updateLabelOutlineThicknessTexture(a);const C=e._openGLRenderWindow.getGraphicsResourceForObject(s);if(h=j3(o,s),!((x=C==null?void 0:C.oglObject)!=null&&x.getHandle())||(C==null?void 0:C.hash)!==h){e.scalarTexture=Je.newInstance(),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const w=o.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(w[0],w[1],w[2],s,e.renderable.getPreferSizeOverAccuracy()),s&&(e._openGLRenderWindow.setGraphicsResourceForObject(s,e.scalarTexture,h),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s)}else e.scalarTexture=C.oglObject;if(!e.tris.getCABO().getElementCount()){const w=new Float32Array(12);for(let R=0;R<4;R++)w[R*3]=R%2*2-1,w[R*3+1]=R>1?1:-1,w[R*3+2]=-1;const E=new Uint16Array(8);E[0]=3,E[1]=0,E[2]=1,E[3]=3,E[4]=3,E[5]=0,E[6]=3,E[7]=2;const M=he.newInstance({numberOfComponents:3,values:w});M.setName("points");const O=he.newInstance({numberOfComponents:1,values:E});e.tris.getCABO().createVBO(O,"polys",an.SURFACE,{points:M,cellOffset:0})}e.VBOBuildTime.modified()},t.updateLabelOutlineThicknessTexture=i=>{var l;const a=i.getProperty().getLabelOutlineThickness(),o=e._openGLRenderWindow.getGraphicsResourceForObject(a),s=`${a.join("-")}`;if(!((l=o==null?void 0:o.oglObject)!=null&&l.getHandle())||(o==null?void 0:o.hash)!==s){e.labelOutlineThicknessTexture=Je.newInstance(),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const f=1024,u=1,g=f*u,d=new Uint8Array(g);for(let h=0;h<f;++h){const p=typeof a[h]<"u"?a[h]:a[0];d[h]=p}e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(oe.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(oe.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(f,u,1,Se.UNSIGNED_CHAR,d),a&&(e._openGLRenderWindow.setGraphicsResourceForObject(a,e.labelOutlineThicknessTexture,s),a!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(a,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=a)}else e.labelOutlineThicknessTexture=o.oglObject},t.isLabelmapOutlineRequired=i=>{const a=i.getProperty(),o=e.renderable;return a.getUseLabelOutline()||o.getBlendMode()===Of.LABELMAP_EDGE_PROJECTION_BLEND}}const tB={context:null,VBOBuildTime:null,scalarTexture:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function Sx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tB,n),ze.extend(t,e,n),ti.implementBuildShadersWithReplacements(t,e,n),e.VBOBuildTime={},je(e.VBOBuildTime,{mtime:0}),e.tris=ri.newInstance(),e.jitterTexture=Je.newInstance(),e.jitterTexture.setWrapS(hl.REPEAT),e.jitterTexture.setWrapT(hl.REPEAT),e.framebuffer=$g.newInstance(),e.idxToView=ie(new Float64Array(16)),e.idxNormalMatrix=pr(new Float64Array(9)),e.modelToView=ie(new Float64Array(16)),e.projectionToView=ie(new Float64Array(16)),e.projectionToWorld=ie(new Float64Array(16)),Ot(t,e,["context"]),eB(t,e)}const xx=be(Sx,"vtkOpenGLVolumeMapper");var wx={newInstance:xx,extend:Sx};Nt("vtkVolumeMapper",xx);function nB(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),t.buildBufferObjects=(n,r)=>{var p;const i=e.currentInput;if(!i)return;const a=r.getProperty();if(!e.jitterTexture.getHandle()){const m=new Uint8Array(1024);for(let v=0;v<32*32;++v)m[v]=255*Math.random();e.jitterTexture.setMinificationFilter(oe.LINEAR),e.jitterTexture.setMagnificationFilter(oe.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,Se.UNSIGNED_CHAR,m)}const{numberOfComponents:o}=i.get("numberOfComponents"),s=t.useIndependentComponents(a),c=a.getScalarOpacity(),l=e._openGLRenderWindow.getGraphicsResourceForObject(c);let f=ni(c,s,o);if(!(l!=null&&l.oglObject)||l.hash!==f){e.opacityTexture=Je.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const m=1024,v=m*2*o,y=new Float32Array(v),C=new Float32Array(m);for(let T=0;T<o;++T){const S=a.getScalarOpacity(T),x=t.getCurrentSampleDistance(n)/a.getScalarOpacityUnitDistance(T),w=S.getRange();S.getTable(w[0],w[1],m,C,1);for(let E=0;E<m;++E)y[T*m*2+E]=1-(1-C[E])**x,y[T*m*2+E+m]=y[T*m*2+E]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(oe.LINEAR),e.opacityTexture.setMagnificationFilter(oe.LINEAR),e._openGLRenderWindow.getWebgl2()&&e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(m,2*o,1,Se.FLOAT,y);else{const T=new Uint8ClampedArray(v);for(let S=0;S<v;++S)T[S]=255*y[S];e.opacityTexture.create2DFromRaw(m,2*o,1,Se.UNSIGNED_CHAR,T)}c&&(e._openGLRenderWindow.setGraphicsResourceForObject(c,e.opacityTexture,f),c!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=c)}else e.opacityTexture=l.oglObject;const g=a.getRGBTransferFunction();f=ni(g,s,o);const d=e._openGLRenderWindow.getGraphicsResourceForObject(g);if(!((p=d==null?void 0:d.oglObject)!=null&&p.getHandle())||(d==null?void 0:d.hash)!==f){e.colorTexture=Je.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const m=1024,v=m*2*o*3,y=new Uint8ClampedArray(v),C=new Float32Array(m*3);for(let T=0;T<o;++T){const S=a.getRGBTransferFunction(T),x=S.getRange();S.getTable(x[0],x[1],m,C,1);for(let w=0;w<m*3;++w)y[T*m*6+w]=255*C[w],y[T*m*6+w+m*3]=255*C[w]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(oe.LINEAR),e.colorTexture.setMagnificationFilter(oe.LINEAR),e.colorTexture.create2DFromRaw(m,2*o,3,Se.UNSIGNED_CHAR,y),g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.colorTexture,f),g!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=g)}else e.colorTexture=d.oglObject;if(t.updateLabelOutlineThicknessTexture(r),f=`${i.getMTime()}-${e.scalarTexture.getMTime()}`,e.scalarTextureString!==f){const m=i.getDimensions();e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.enableUseHalfFloat(!1);const v=e.scalarTexture.getTextureParameters(),y=i.get("dataType").dataType;let C=!0;if((v==null?void 0:v.dataType)===y&&(v==null?void 0:v.width)===m[0]&&(v==null?void 0:v.height)===m[1]&&(v==null?void 0:v.depth)===m[2]&&(C=!1),C){const T=e.context.getExtension("EXT_texture_norm16");e.scalarTexture.setOglNorm16Ext(T),e.scalarTexture.resetFormatAndType(),e.scalarTexture.setTextureParameters({width:m[0],height:m[1],depth:m[2],numberOfComponents:o,dataType:y}),e.scalarTexture.create3DFromRaw(m[0],m[1],m[2],o,y,null),e.scalarTexture.update3DFromRaw()}else e.scalarTexture.deactivate(),e.scalarTexture.update3DFromRaw();e.scalarTextureString=f}if(!e.tris.getCABO().getElementCount()){const m=new Float32Array(12);for(let T=0;T<4;T++)m[T*3]=T%2*2-1,m[T*3+1]=T>1?1:-1,m[T*3+2]=-1;const v=new Uint16Array(8);v[0]=3,v[1]=0,v[2]=1,v[3]=3,v[4]=3,v[5]=0,v[6]=3,v[7]=2;const y=he.newInstance({numberOfComponents:3,values:m});y.setName("points");const C=he.newInstance({numberOfComponents:1,values:v});e.tris.getCABO().createVBO(C,"polys",an.SURFACE,{points:y,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(n,r)=>{var i,a,o,s,c,l;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<r.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<r.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<((i=e.scalarTexture)==null?void 0:i.getMTime())||e.VBOBuildTime.getMTime()<((a=e.colorTexture)==null?void 0:a.getMTime())||e.VBOBuildTime.getMTime()<((o=e.labelOutlineThicknessTexture)==null?void 0:o.getMTime())||!((s=e.scalarTexture)!=null&&s.getHandle())||!((c=e.colorTexture)!=null&&c.getHandle())||!((l=e.labelOutlineThicknessTexture)!=null&&l.getHandle())}}const rB={};function Ex(t,e,n={}){Object.assign(e,rB,n),wx.extend(t,e,n),e.scalarTexture=n.scalarTexture,e.previousState={},nB(t,e)}const iB=D.newInstance(Ex,"vtkStreamingOpenGLVolumeMapper"),aB={newInstance:iB,extend:Ex},Ox=Object.create(null);function Zt(t,e){Ox[t]=e}function oB(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const o=Object.keys(e.overrides);for(;i&&!a;)o.includes(i)?a=!0:i=n.getClassName(r++);if(!a)return null;const s=e.getModelInitialValues(n),c=e.overrides[i](s);return c.setMyFactory(t),c},e.overrides=Ox,e.getModelInitialValues=n=>{const r={};return n.getClassName()==="vtkSharedVolumeMapper"&&(r.scalarTexture=n.getScalarTexture()),r}}const sB={};function Dx(t,e,n={}){Object.assign(e,sB,n),L3.extend(t,e,n),oB(t,e),Zt("vtkActor",bF.newInstance),Zt("vtkActor2D",FF.newInstance),Zt("vtkCamera",GF.newInstance),Zt("vtkGlyph3DMapper",lA.newInstance),Zt("vtkImageMapper",mA.newInstance),Zt("vtkImageSlice",TA.newInstance),Zt("vtkMapper",Jg.newInstance),Zt("vtkPixelSpaceCallbackMapper",OA.newInstance),Zt("vtkRenderer",IA.newInstance),Zt("vtkSkybox",NA.newInstance),Zt("vtkSphereMapper",BA.newInstance),Zt("vtkStickMapper",HA.newInstance),Zt("vtkTexture",Je.newInstance),Zt("vtkVolume",XA.newInstance),Zt("vtkVolumeMapper",wx.newInstance),Zt("vtkSharedVolumeMapper",aB.newInstance)}const cB=D.newInstance(Dx,"vtkStreamingOpenGLViewNodeFactory"),lB={newInstance:cB,extend:Dx};function uB(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function Rx(t,e,n={}){Object.assign(e,n),LF.extend(t,e,n),e.myFactory=lB.newInstance(),Zt("vtkRenderWindow",Mx),uB(t,e)}const Mx=D.newInstance(Rx,"vtkStreamingOpenGLRenderWindow"),fB={newInstance:Mx,extend:Rx},{vtkDebugMacro:bu}=D;function gB(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),a=ie(new Float64Array(16)),o=ie(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),f=ie(new Float64Array(16)),u=ie(new Float64Array(16)),g=new Float64Array(3),d=new Float64Array(3);function h(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const p=t.getViewMatrix();e.viewUp[0]=p[4],e.viewUp[1]=p[5],e.viewUp[2]=p[6],t.modified()},t.setPosition=(p,m,v)=>{p===e.position[0]&&m===e.position[1]&&v===e.position[2]||(e.position[0]=p,e.position[1]=m,e.position[2]=v,t.computeDistance(),t.modified())},t.setFocalPoint=(p,m,v)=>{p===e.focalPoint[0]&&m===e.focalPoint[1]&&v===e.focalPoint[2]||(e.focalPoint[0]=p,e.focalPoint[1]=m,e.focalPoint[2]=v,t.computeDistance(),t.modified())},t.setDistance=p=>{if(e.distance===p)return;e.distance=p,e.distance<1e-20&&(e.distance=1e-20,bu("Distance is set to minimum."));const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,t.modified()},t.computeDistance=()=>{const p=e.focalPoint[0]-e.position[0],m=e.focalPoint[1]-e.position[1],v=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(p*p+m*m+v*v),e.distance<1e-20){e.distance=1e-20,bu("Distance is set to minimum.");const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance}e.directionOfProjection[0]=p/e.distance,e.directionOfProjection[1]=m/e.distance,e.directionOfProjection[2]=v/e.distance,h()},t.dolly=p=>{if(p<=0)return;const m=e.distance/p;t.setPosition(e.focalPoint[0]-m*e.directionOfProjection[0],e.focalPoint[1]-m*e.directionOfProjection[1],e.focalPoint[2]-m*e.directionOfProjection[2])},t.roll=p=>{const m=e.position,v=e.focalPoint,y=e.viewUp,C=new Float64Array([y[0],y[1],y[2],0]);ie(f);const T=new Float64Array([v[0]-m[0],v[1]-m[1],v[2]-m[2]]);yr(f,f,gt(p),T),uo(C,C,f),e.viewUp[0]=C[0],e.viewUp[1]=C[1],e.viewUp[2]=C[2],t.modified()},t.azimuth=p=>{const m=e.focalPoint;ie(u),nt(u,u,m),yr(u,u,gt(p),e.viewUp),nt(u,u,[-m[0],-m[1],-m[2]]),Ee(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.yaw=p=>{const m=e.position;ie(u),nt(u,u,m),yr(u,u,gt(p),e.viewUp),nt(u,u,[-m[0],-m[1],-m[2]]),Ee(d,e.focalPoint,u),t.setFocalPoint(d[0],d[1],d[2])},t.elevation=p=>{const m=e.focalPoint,v=t.getViewMatrix(),y=[-v[0],-v[1],-v[2]];ie(u),nt(u,u,m),yr(u,u,gt(p),y),nt(u,u,[-m[0],-m[1],-m[2]]),Ee(g,e.position,u),t.setPosition(g[0],g[1],g[2])},t.pitch=p=>{const m=e.position,v=t.getViewMatrix(),y=[v[0],v[1],v[2]];ie(u),nt(u,u,m),yr(u,u,gt(p),y),nt(u,u,[-m[0],-m[1],-m[2]]),Ee(d,e.focalPoint,u),t.setFocalPoint(...d)},t.zoom=p=>{p<=0||(e.parallelProjection?e.parallelScale/=p:e.viewAngle/=p,t.modified())},t.translate=(p,m,v)=>{const y=[p,m,v];P1(e.position,y,e.position),P1(e.focalPoint,y,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=p=>{const m=[...e.viewUp,1],v=[],y=[],C=[];m[0]+=e.position[0],m[1]+=e.position[1],m[2]+=e.position[2],uo(v,[...e.position,1],p),uo(y,[...e.focalPoint,1],p),uo(C,m,p),C[0]-=v[0],C[1]-=v[1],C[2]-=v[2],t.setPosition(...v.slice(0,3)),t.setFocalPoint(...y.slice(0,3)),t.setViewUp(...C.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=p=>{let m=p;m<1e-20&&(m=1e-20,bu("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+m)},t.setThicknessFromFocalPoint=p=>{let m=p;m<1e-20&&(m=1e-20,bu("Thickness is set to minimum.")),t.setClippingRange(e.distance-m/2,e.distance+m/2)},t.setRoll=p=>{},t.getRoll=()=>{},t.setObliqueAngles=(p,m)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=p=>{},t.getCameraLightTransformMatrix=p=>(it(p,e.cameraLightTransform),p),t.computeCameraLightTransform=()=>{it(a,t.getViewMatrix()),xt(a,a),n3(o,[e.distance,e.distance,e.distance]),De(a,a,o),ie(e.cameraLightTransform),nt(e.cameraLightTransform,a,[0,0,-1])},t.deepCopy=p=>{},t.physicalOrientationToWorldDirection=p=>{const m=v8(p[0],p[1],p[2],p[3]),v=Io(),y=v8(0,0,1,0);return JV(v,m),m8(y,m,y),m8(y,y,v),[y[0],y[1],y[2]]},t.getPhysicalToWorldMatrix=p=>{t.getWorldToPhysicalMatrix(p),xt(p,p)},t.getWorldToPhysicalMatrix=p=>{ie(p);const m=[3];ei(e.physicalViewNorth,e.physicalViewUp,m),p[0]=m[0],p[1]=m[1],p[2]=m[2],p[4]=e.physicalViewUp[0],p[5]=e.physicalViewUp[1],p[6]=e.physicalViewUp[2],p[8]=-e.physicalViewNorth[0],p[9]=-e.physicalViewNorth[1],p[10]=-e.physicalViewNorth[2],xe(p,p),Fe(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Vi(p,p,s),nt(p,p,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=p=>{xt(a,p),Ee(s,n,a),t.computeDistance();const m=e.distance;t.setPosition(s[0],s[1],s[2]),Ee(c,r,a),rt(c,c,s),$t(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),Ee(l,i,a),rt(l,l,s),$t(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(m)},t.computeViewParametersFromPhysicalMatrix=p=>{t.getWorldToPhysicalMatrix(a),De(a,p,a),t.computeViewParametersFromViewMatrix(a)},t.setViewMatrix=p=>{e.viewMatrix=p,e.viewMatrix&&(it(a,e.viewMatrix),t.computeViewParametersFromViewMatrix(a),xe(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;aC(a,e.position,e.focalPoint,e.viewUp),xe(a,a);const p=new Float64Array(16);return it(p,a),p},t.setProjectionMatrix=p=>{e.projectionMatrix=p},t.getProjectionMatrix=(p,m,v)=>{const y=new Float64Array(16);if(ie(y),e.projectionMatrix){const S=1/e.physicalScale;return Fe(s,S,S,S),it(y,e.projectionMatrix),Vi(y,y,s),xe(y,y),y}ie(a);const C=e.clippingRange[1]-e.clippingRange[0],T=[e.clippingRange[0]+(m+1)*C/2,e.clippingRange[0]+(v+1)*C/2];if(e.parallelProjection){const S=e.parallelScale*p,x=e.parallelScale,w=(e.windowCenter[0]-1)*S,E=(e.windowCenter[0]+1)*S,M=(e.windowCenter[1]-1)*x,O=(e.windowCenter[1]+1)*x;i3(a,w,E,M,O,T[0],T[1]),xe(a,a)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const S=Math.tan(gt(e.viewAngle)/2);let x,w;e.useHorizontalViewAngle===!0?(x=e.clippingRange[0]*S,w=e.clippingRange[0]*S/p):(x=e.clippingRange[0]*S*p,w=e.clippingRange[0]*S);const E=(e.windowCenter[0]-1)*x,M=(e.windowCenter[0]+1)*x,O=(e.windowCenter[1]-1)*w,R=(e.windowCenter[1]+1)*w,_=T[0],P=T[1];a[0]=2*_/(M-E),a[5]=2*_/(R-O),a[2]=(E+M)/(M-E),a[6]=(O+R)/(R-O),a[10]=-(_+P)/(P-_),a[14]=-1,a[11]=-2*_*P/(P-_),a[15]=0}}return it(y,a),y},t.getCompositeProjectionMatrix=(p,m,v)=>{const y=t.getViewMatrix(),C=t.getProjectionMatrix(p,m,v);return De(C,y,C),C},t.setDirectionOfProjection=(p,m,v)=>{if(e.directionOfProjection[0]===p&&e.directionOfProjection[1]===m&&e.directionOfProjection[2]===v)return;e.directionOfProjection[0]=p,e.directionOfProjection[1]=m,e.directionOfProjection[2]=v;const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance,h()},t.setDeviceAngles=(p,m,v,y)=>{const C=[3];ei(e.physicalViewNorth,e.physicalViewUp,C);const T=ie(new Float64Array(16));yr(T,T,gt(p),e.physicalViewUp),yr(T,T,gt(m),C),yr(T,T,gt(v),e.physicalViewNorth),yr(T,T,gt(-y),e.physicalViewUp);const S=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),x=new Float64Array(e.physicalViewNorth);Ee(S,S,T),Ee(x,x,T),t.setDirectionOfProjection(S[0],S[1],S[2]),t.setViewUp(x[0],x[1],x[2]),t.modified()},t.setOrientationWXYZ=(p,m,v,y)=>{const C=ie(new Float64Array(16));if(p!==0&&(m!==0||v!==0||y!==0)){const x=gt(p),w=Io();a3(w,[m,v,y],x),E1(C,w)}const T=new Float64Array(3);Ee(T,[0,0,-1],C);const S=new Float64Array(3);Ee(S,[0,1,0],C),t.setDirectionOfProjection(...T),t.setViewUp(...S),t.modified()},t.computeClippingRange=p=>{let m=null,v=null;m=e.viewPlaneNormal,v=e.position;const y=-m[0],C=-m[1],T=-m[2],S=-(y*v[0]+C*v[1]+T*v[2]),x=[y*p[0]+C*p[2]+T*p[4]+S,1e-18];for(let w=0;w<2;w++)for(let E=0;E<2;E++)for(let M=0;M<2;M++){const O=y*p[M]+C*p[2+E]+T*p[4+w]+S;x[0]=O<x[0]?O:x[0],x[1]=O>x[1]?O:x[1]}return x}}const dB={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:Ia(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function Lx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dB,n),D.obj(t,e),D.get(t,e,["distance"]),D.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),D.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),D.setGetArray(t,e,["clippingRange","windowCenter"],2),D.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),gB(t,e)}const pB=D.newInstance(Lx,"vtkCamera");var K3={newInstance:pB,extend:Lx};function hB(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?Ee(n,e.position,e.transformMatrix):Fe(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?Ee(n,e.focalPoint,e.transformMatrix):Fe(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(_t(e.direction,e.focalPoint,e.position),bo(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const i=new Float64Array(3);_t(i,e.position,r),e.focalPoint=i},t.setDirectionAngle=(r,i)=>{const a=gt(r),o=gt(i);t.setPosition(Math.cos(a)*Math.sin(o),Math.sin(a),Math.cos(a)*Math.cos(o)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const mB={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function vB(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mB,n),D.obj(t,e),D.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),D.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),hB(t,e)}const yB=D.newInstance(vB,"vtkLight");var CB={newInstance:yB};const{vtkErrorMacro:Uf}=D;function TB(t){return()=>Uf(`vtkViewport::${t} - NOT IMPLEMENTED`)}function SB(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const i=e.props.filter(a=>a!==r);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(r);const a=r.getNestedProps();if(a&&a.length)for(let o=0;o<a.length;o++)n(a[o],i);return i}t.getViewPropsWithNestedProps=()=>{const r=[];for(let i=0;i<e.props.length;i++)n(e.props[i],r);return r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>Uf("call displayToView on your view instead"),t.viewToDisplay=()=>Uf("callviewtodisplay on your view instead"),t.getSize=()=>Uf("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,i,a)=>{const o=t.normalizedDisplayToNormalizedViewport(r,i,a);return t.normalizedViewportToProjection(o[0],o[1],o[2])},t.normalizedDisplayToNormalizedViewport=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/o[0],(i-e.viewport[1])/o[1],a]},t.normalizedViewportToProjection=(r,i,a)=>[r*2-1,i*2-1,a*2-1],t.projectionToNormalizedDisplay=(r,i,a)=>{const o=t.projectionToNormalizedViewport(r,i,a);return t.normalizedViewportToNormalizedDisplay(o[0],o[1],o[2])},t.normalizedViewportToNormalizedDisplay=(r,i,a)=>{const o=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*o[0]+e.viewport[0],i*o[1]+e.viewport[1],a]},t.projectionToNormalizedViewport=(r,i,a)=>[(r+1)*.5,(i+1)*.5,(a+1)*.5],t.PickPropFrom=TB("PickPropFrom")}const xB={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function Ix(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xB,n),D.obj(t,e),D.event(t,e,"event"),D.setGetArray(t,e,["viewport"],4),D.setGetArray(t,e,["background","background2"],3),SB(t,e)}const wB=D.newInstance(Ix,"vtkViewport");var EB={newInstance:wB,extend:Ix};const{vtkDebugMacro:tc,vtkErrorMacro:$i,vtkWarningMacro:OB}=cn;function fv(t){return()=>$i(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function DB(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(tc("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const a=t.getActiveCameraAndResetIfCreated();e.lights.forEach(o=>{o.lightTypeIsSceneLight()||(o.lightTypeIsHeadLight()?(o.setPositionFrom(a.getPositionByReference()),o.setFocalPointFrom(a.getFocalPointByReference()),o.modified(a.getMTime())):o.lightTypeIsCameraLight()?o.setTransformMatrix(a.getCameraLightTransformMatrix(Ia())):$i("light has unknown light type",o.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=fv("allocateTime"),t.updateGeometry=fv("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=a=>{tc(t.getClassName(),t,"setting Layer to ",a),e.layer!==a&&(e.layer=a,t.modified()),t.setPreserveColorBuffer(!!a)},t.setActiveCamera=a=>e.activeCamera===a?!1:(e.activeCamera=a,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:a}),!0),t.makeCamera=()=>{const a=K3.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:a}),a},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(a=>{e.actors=e.actors.concat(a.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=a=>{e.actors=e.actors.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(o=>{t.removeViewProp(o)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(a=>{e.volumes=e.volumes.concat(a.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=a=>{e.volumes=e.volumes.filter(o=>o!==a),t.removeViewProp(a),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(o=>{t.removeViewProp(o)}),e.volumes=[],t.modified()},t.hasLight=a=>e.lights.includes(a),t.addLight=a=>{a&&!t.hasLight(a)&&(e.lights.push(a),t.modified())},t.removeLight=a=>{e.lights=e.lights.filter(o=>o!==a),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=a=>{e.lights=a,t.modified()},t.makeLight=CB.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(a,o,s,c)=>{let l=t.normalizedDisplayToProjection(a,o,s);return l=t.projectionToView(l[0],l[1],l[2],c),t.viewToWorld(l[0],l[1],l[2])},t.worldToNormalizedDisplay=(a,o,s,c)=>{let l=t.worldToView(a,o,s);return l=t.viewToProjection(l[0],l[1],l[2],c),t.projectionToNormalizedDisplay(l[0],l[1],l[2])},t.viewToWorld=(a,o,s)=>{if(e.activeCamera===null)return $i("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();xt(c,c),xe(c,c);const l=new Float64Array([a,o,s]);return Ee(l,l,c),l},t.projectionToView=(a,o,s,c)=>{if(e.activeCamera===null)return $i("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);xt(l,l),xe(l,l);const f=new Float64Array([a,o,s]);return Ee(f,f,l),f},t.worldToView=(a,o,s)=>{if(e.activeCamera===null)return $i("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();xe(c,c);const l=new Float64Array([a,o,s]);return Ee(l,l,c),l},t.viewToProjection=(a,o,s,c)=>{if(e.activeCamera===null)return $i("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);xe(l,l);const f=new Float64Array([a,o,s]);return Ee(f,f,l),f},t.computeVisiblePropBounds=()=>{e.allBounds[0]=Be.INIT_BOUNDS[0],e.allBounds[1]=Be.INIT_BOUNDS[1],e.allBounds[2]=Be.INIT_BOUNDS[2],e.allBounds[3]=Be.INIT_BOUNDS[3],e.allBounds[4]=Be.INIT_BOUNDS[4],e.allBounds[5]=Be.INIT_BOUNDS[5];let a=!0;t.invokeEvent(n);for(let o=0;o<e.props.length;++o){const s=e.props[o];if(s.getVisibility()&&s.getUseBounds()){const c=s.getBounds();c&&Pf(c)&&(a=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return a&&(V0(e.allBounds),tc("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!Pf(o))return tc("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return $i("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(o[0]+o[1])/2,s[1]=(o[2]+o[3])/2,s[2]=(o[4]+o[5])/2;let l=o[1]-o[0],f=o[3]-o[2],u=o[5]-o[4];l*=l,f*=f,u*=u;let g=l+f+u;g=g===0?1:g,g=Math.sqrt(g)*.5;const d=gt(e.activeCamera.getViewAngle()),h=g,p=g/Math.sin(d*.5),m=e.activeCamera.getViewUp();return Math.abs(Te(m,c))>.999&&(OB("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-m[2],m[0],m[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+p*c[0],s[1]+p*c[1],s[2]+p*c[2]),t.resetCameraClippingRange(o),e.activeCamera.setParallelScale(h),e.activeCamera.setPhysicalScale(g),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const o=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!Pf(o))return tc("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return $i("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(o);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const l=gt(e.activeCamera.getViewAngle());c=.2*Math.tan(l/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(r),!1},t.setRenderWindow=a=>{a!==e._renderWindow&&(e._vtkWindow=a,e._renderWindow=a)},t.visibleActorCount=()=>e.props.filter(a=>a.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let a=e.mtime;const o=e.activeCamera?e.activeCamera.getMTime():0;o>a&&(a=o);const s=e._createdLight?e._createdLight.getMTime():0;return s>a&&(a=s),a},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const RB={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:xa(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function Vx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,RB,n),EB.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),In(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Ot(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),I0(t,e,["actors","volumes","lights"]),f3(t,e,["background"],4,1),Gl(t,e,["renderWindow"]),DB(t,e)}const MB=be(Vx,"vtkRenderer");var LB={newInstance:MB,extend:Vx};const IB={Unknown:0,LeftController:1,RightController:2},VB={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},_B={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var _x={Device:IB,Input:VB,Axis:_B};const{Device:Nu,Input:Ja}=_x,{vtkWarningMacro:Pu,vtkErrorMacro:ku,normalizeWheel:bB,vtkOnceErrorMacro:NB}=D,ns={ctrlKey:!1,altKey:!1,shiftKey:!1},C2={"xr-standard":[Ja.Trigger,Ja.Grip,Ja.TrackPad,Ja.Thumbstick,Ja.A,Ja.B]},q3=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function nc(t){t.cancelable&&t.preventDefault()}function Fu(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:i}=n;e[r]=i}),e}function PB(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,i=new Map;let a=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=p=>{ku("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=p=>{e.interactorStyle!==p&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=p,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>Pu("empty event loop");function o(p,m){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(p,m))}t.getCurrentRenderer=()=>(e.currentRenderer||o(0,0),e.currentRenderer);function s(p){const m=e._view.getCanvas(),v=m.getBoundingClientRect(),y=m.width/v.width,C=m.height/v.height,T={x:y*(p.clientX-v.left),y:C*(v.height-p.clientY+v.top),z:0};return(i.size<=1||!e.currentRenderer)&&o(T.x,T.y),T}const c=e._getScreenEventPositionFor||s;function l(p){return{controlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey}}function f(p){const m=l(p);return{key:p.key,keyCode:p.charCode,...m}}function u(p){return p.pointerType||""}const g=()=>{if(e.container===null)return;const{container:p}=e;p.addEventListener("contextmenu",nc),p.addEventListener("wheel",t.handleWheel),p.addEventListener("DOMMouseScroll",t.handleWheel),p.addEventListener("pointerenter",t.handlePointerEnter),p.addEventListener("pointerleave",t.handlePointerLeave),p.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.addEventListener("pointerup",t.handlePointerUp),p.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),p.style.touchAction="none",p.style.userSelect="none",p.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=p=>{if(p===null)return;n.setContainer(p)&&g()};const d=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,a=1;const{container:p}=e;p&&(p.removeEventListener("contextmenu",nc),p.removeEventListener("wheel",t.handleWheel),p.removeEventListener("DOMMouseScroll",t.handleWheel),p.removeEventListener("pointerenter",t.handlePointerEnter),p.removeEventListener("pointerleave",t.handlePointerLeave),p.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.removeEventListener("pointerup",t.handlePointerUp),p.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{d(),n.setContainer(null)},t.handleKeyPress=p=>{const m=f(p);t.keyPressEvent(m)},t.handleKeyDown=p=>{const m=f(p);t.keyDownEvent(m)},t.handleKeyUp=p=>{const m=f(p);t.keyUpEvent(m)},t.handlePointerEnter=p=>{const m={...l(p),position:c(p),deviceType:u(p)};t.pointerEnterEvent(m),m.deviceType==="mouse"&&t.mouseEnterEvent(m)},t.handlePointerLeave=p=>{const m={...l(p),position:c(p),deviceType:u(p)};t.pointerLeaveEvent(m),m.deviceType==="mouse"&&t.mouseLeaveEvent(m)},t.handlePointerDown=p=>{if(!(p.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&nc(p),p.target.hasPointerCapture(p.pointerId)&&p.target.releasePointerCapture(p.pointerId),e.container.setPointerCapture(p.pointerId),i.has(p.pointerId)&&Pu("[RenderWindowInteractor] duplicate pointerId detected"),i.set(p.pointerId,{pointerId:p.pointerId,position:c(p)}),p.pointerType){case"pen":case"touch":t.handleTouchStart(p);break;case"mouse":default:t.handleMouseDown(p);break}},t.handlePointerUp=p=>{if(i.has(p.pointerId))switch(e.preventDefaultOnPointerUp&&nc(p),i.delete(p.pointerId),e.container.releasePointerCapture(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerCancel=p=>{if(i.has(p.pointerId))switch(i.delete(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerMove=p=>{if(i.has(p.pointerId)){const m=i.get(p.pointerId);m.position=c(p)}switch(p.pointerType){case"pen":case"touch":t.handleTouchMove(p);break;case"mouse":default:t.handleMouseMove(p);break}},t.handleMouseDown=p=>{const m={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonPressEvent(m);break;case 1:t.middleButtonPressEvent(m);break;case 2:t.rightButtonPressEvent(m);break;default:ku(`Unknown mouse button pressed: ${p.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var p;return(p=document.exitPointerLock)==null?void 0:p.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function h(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=p=>{if(p===void 0){ku("undefined requester, can not start animating");return}if(r.has(p)){Pu("requester is already registered for animating");return}r.add(p),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=p=>{const m=Date.now()+p;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,m),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(p){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(p)){if(!m){const v=p&&p.getClassName?p.getClassName():p;Pu(`${v} did not request an animation`)}return}r.delete(p),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(p,m,v)=>{p.inputSources.forEach(y=>{const C=y.gripSpace==null?null:m.getPose(y.gripSpace,v),T=y.gripSpace==null?null:m.getPose(y.targetRaySpace,v),S=y.gamepad,x=y.handedness;if(S){S.index in e.lastGamepadValues||(e.lastGamepadValues[S.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let w=0;w<S.buttons.length;++w)w in e.lastGamepadValues[S.index][x].buttons||(e.lastGamepadValues[S.index][x].buttons[w]=!1),e.lastGamepadValues[S.index][x].buttons[w]!==S.buttons[w].pressed&&C!=null&&(t.button3DEvent({gamepad:S,position:C.transform.position,orientation:C.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,pressed:S.buttons[w].pressed,device:y.handedness==="left"?Nu.LeftController:Nu.RightController,input:C2[S.mapping]&&C2[S.mapping][w]?C2[S.mapping][w]:Ja.Trigger}),e.lastGamepadValues[S.index][x].buttons[w]=S.buttons[w].pressed),e.lastGamepadValues[S.index][x].buttons[w]&&C!=null&&t.move3DEvent({gamepad:S,position:C.transform.position,orientation:C.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,device:y.handedness==="left"?Nu.LeftController:Nu.RightController})}})},t.handleMouseMove=p=>{const m={...l(p),position:c(p),deviceType:u(p)};e.moveTimeoutID===0?t.startMouseMoveEvent(m):(t.mouseMoveEvent(m),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const p=Date.now();e._animationFrameCount++,p-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(p-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=p,e._animationFrameCount=1),t.animationEvent(),h(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=p=>{nc(p);const m={...bB(p),...l(p),position:c(p),deviceType:u(p)};e.wheelTimeoutID===0&&(Math.abs(m.spinY)>=.3?a=Math.abs(m.spinY):a=1),m.spinY/=a,e.wheelTimeoutID===0?(t.startMouseWheelEvent(m),t.mouseWheelEvent(m)):(t.mouseWheelEvent(m),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=p=>{const m={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonReleaseEvent(m);break;case 1:t.middleButtonReleaseEvent(m);break;case 2:t.rightButtonReleaseEvent(m);break;default:ku(`Unknown mouse button released: ${p.button}`);break}},t.handleTouchStart=p=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const v=Fu(i);if(m.length===2){const y={...l(ns),position:m[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(y)}t.recognizeGesture("TouchStart",v)}else if(m.length===1){const v={...l(ns),position:c(p),deviceType:u(p)};t.leftButtonPressEvent(v)}},t.handleTouchMove=p=>{const m=[...i.values()];if(e.recognizeGestures&&m.length>1){const v=Fu(i);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(ns),position:m[0].position,deviceType:u(p)};t.mouseMoveEvent(v)}},t.handleTouchEnd=p=>{const m=[...i.values()];if(e.recognizeGestures)if(m.length===0){const v={...l(ns),position:c(p),deviceType:u(p)};t.leftButtonReleaseEvent(v)}else if(m.length===1){const v=Fu(i);t.recognizeGesture("TouchEnd",v);const y={...l(ns),position:m[0].position,deviceType:u(p)};t.leftButtonPressEvent(y)}else{const v=Fu(i);t.recognizeGesture("TouchMove",v)}else if(m.length===1){const v={...l(ns),position:m[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(v)}},t.setView=p=>{e._view!==p&&(e._view=p,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var p,m,v;return(v=(m=(p=e._view)==null?void 0:p.getRenderable())==null?void 0:m.getRenderersByReference())==null?void 0:v[0]},t.findPokedRenderer=function(){var x,w;let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const v=(w=(x=e._view)==null?void 0:x.getRenderable())==null?void 0:w.getRenderers();if(!v||v.length===0)return null;v.sort((E,M)=>E.getLayer()-M.getLayer());let y=null,C=null,T=null,S=v.length;for(;S--;){const E=v[S];if(e._view.isInViewport(p,m,E)&&E.getInteractive()){T=E;break}y===null&&E.getInteractive()&&(y=E),C===null&&e._view.isInViewport(p,m,E)&&(C=E)}return T===null&&(T=y),T===null&&(T=C),T==null&&(T=v[0]),T},t.render=()=>{!t.isAnimating()&&!e.inRender&&h()},q3.forEach(p=>{const m=p.charAt(0).toLowerCase()+p.slice(1);t[`${m}Event`]=v=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){NB(`
          Can not forward events without a current renderer on the interactor.
        `);return}const C={type:p,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...v};t[`invoke${p}`](C)}}),t.recognizeGesture=(p,m)=>{if(Object.keys(m).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),p==="TouchStart"){Object.keys(m).forEach(O=>{e.startingEventPositions[O]=m[O]}),e.currentGesture="Start";return}if(p==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let v=0;const y=[],C=[];Object.keys(m).forEach(O=>{y[v]=m[O],C[v]=e.startingEventPositions[O],v++});const T=Math.sqrt((C[0].x-C[1].x)*(C[0].x-C[1].x)+(C[0].y-C[1].y)*(C[0].y-C[1].y)),S=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y));let x=N1(Math.atan2(C[1].y-C[0].y,C[1].x-C[0].x)),w=N1(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),E=w-x;w=w+180>=360?w-180:w+180,x=x+180>=360?x-180:x+180,Math.abs(w-x)<Math.abs(E)&&(E=w-x);const M=[];if(M[0]=(y[0].x-C[0].x+y[1].x-C[1].x)/2,M[1]=(y[0].y-C[0].y+y[1].y-C[1].y)/2,p==="TouchMove")if(e.currentGesture==="Start"){let O=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);O<15&&(O=15);const R=Math.abs(S-T),_=S*3.1415926*Math.abs(E)/360,P=Math.sqrt(M[0]*M[0]+M[1]*M[1]);if(R>O&&R>_&&R>P){e.currentGesture="Pinch";const N={scale:1,touches:m};t.startPinchEvent(N)}else if(_>O&&_>P){e.currentGesture="Rotate";const N={rotation:0,touches:m};t.startRotateEvent(N)}else if(P>O){e.currentGesture="Pan";const N={translation:[0,0],touches:m};t.startPanEvent(N)}}else{if(e.currentGesture==="Rotate"){const O={rotation:E,touches:m};t.rotateEvent(O)}if(e.currentGesture==="Pinch"){const O={scale:S/T,touches:m};t.pinchEvent(O)}if(e.currentGesture==="Pan"){const O={translation:M,touches:m};t.panEvent(O)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=p=>{e._forcedRenderer=!!p,e.currentRenderer=p},t.setContainer=p=>{d();const m=n.setContainer(p??null);return m&&g(),m},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const kB={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function bx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kB,n),D.obj(t,e),e._animationExtendedEnd=0,D.event(t,e,"RenderEvent"),q3.forEach(r=>D.event(t,e,r)),D.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),D.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),D.moveToProtected(t,e,["view"]),PB(t,e)}const FB=D.newInstance(bx,"vtkRenderWindowInteractor");var UB={newInstance:FB,extend:bx,handledEvents:q3,..._x};const{vtkErrorMacro:AB}=D,BB=[1,-1,1,-1,1,-1];function GB(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=D.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.setTuple(n,i)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,i)=>t.insertNextTuple([n,r,i]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1];const o=t.getRange(2);return e.bounds[4]=o[0],e.bounds[5]=o[1],e.bounds}if(t.getNumberOfComponents()!==2)return AB(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),BB;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const WB={empty:!0,numberOfComponents:3,dataType:Se.FLOAT,bounds:[1,-1,1,-1,1,-1]};function Nx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WB,n),he.extend(t,e,n),GB(t,e)}const $B=D.newInstance(Nx,"vtkPoints");var z1={newInstance:$B,extend:Nx};function Px(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function kx(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const zB={extractCellSizes:Px,getNumberOfCells:kx};function HB(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=kx(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=Px(t.getData())),e.cellSizes),t.resize=r=>{const i=t.getNumberOfTuples();n.resize(r);const a=t.getNumberOfTuples();a<i&&(a===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let i=r;const a=e.values[i++];return e.values.subarray(i,i+a)},t.insertNextCell=r=>{const i=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),i}}function jB(t){return{empty:!0,numberOfComponents:1,dataType:Se.UNSIGNED_INT,...t}}function Fx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};he.extend(t,e,jB(n)),HB(t,e)}const KB=D.newInstance(Fx,"vtkCellArray");var Po={newInstance:KB,extend:Fx,...zB};function qB(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=D.newTypedArray(n.getDataType(),3*e.pointsIds.length));const a=n.getData();e.pointsIds.forEach((o,s)=>{let c=3*o,l=3*s;i[l]=a[c],i[++l]=a[++c],i[++l]=a[++c]}),e.points.setData(i)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let i=n.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let i=1;i<n;i++)e.points.getPoint(i,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else V0(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let i=0;i<3;i++)r=e.bounds[2*i+1]-e.bounds[2*i],n+=r*r;return n},t.getParametricDistance=n=>{let r,i=0;for(let a=0;a<3;a++)n[a]<0?r=-n[a]:n[a]>1?r=n[a]-1:r=0,r>i&&(i=r);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,i,a,o,s,c)=>{},t.evaluatePosition=(n,r,i,a,o,s)=>{D.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const XB={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Ux(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XB,n),D.obj(t,e),e.points||(e.points=z1.newInstance()),D.get(t,e,["points","pointsIds"]),qB(t,e)}const YB=D.newInstance(Ux,"vtkCell");var H1={newInstance:YB,extend:Ux};function ZB(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function JB(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),i=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o){const{cellPointIds:s}=n.getCellPoints(o);s.forEach(c=>{t.insertCellReference(c,a[c]++,o)})}}else{for(let o=0;o<i;o++)H1.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let o=0;o<i;++o)H1.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,a[c]++,o)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(i=>i!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{ZB(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,i)=>{e.array[n].cells[r]=i}}const QB={array:null,maxId:0,extend:0};function Ax(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QB,n),D.obj(t,e),JB(t,e)}const eG=D.newInstance(Ax,"vtkCellLinks");var tG={newInstance:eG,extend:Ax};const qe={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},Eh=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function nG(t){return t<Eh.length?Eh[t]:"UnknownClass"}function rG(t){return Eh.findIndex(t)}function iG(t){return t<qe.VTK_QUADRATIC_EDGE||t===qe.VTK_CONVEX_POINT_SET||t===qe.VTK_POLYHEDRON}function aG(t){return t===qe.VTK_TRIANGLE_STRIP||t===qe.VTK_POLY_LINE||t===qe.VTK_POLY_VERTEX}const oG={getClassNameFromTypeId:nG,getTypeIdFromClassName:rG,isLinear:iG,hasSubCells:aG};function sG(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,i)=>{e.typeArray[n]=r,e.locationArray[n]=i,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,i)=>{e.size=n,e.typeArray=r,e.locationArray=i,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=qe.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let i=0;i<r;++i)if(n===t.getCellType(i))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const cG={size:0,maxId:-1,extend:1e3};function Bx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cG,n),D.obj(t,e),D.get(t,e,["size","maxId","extend"]),D.getArray(t,e,["typeArray","locationArray"]),sG(t,e)}const lG=D.newInstance(Bx,"vtkCellTypes");var uG={newInstance:lG,extend:Bx,...oG};const fG={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var Gx={IntersectionState:fG};const{IntersectionState:Af}=Gx;function ws(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},a=[];let o;a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2];const s=a[0]*(t[0]-e[0])+a[1]*(t[1]-e[1])+a[2]*(t[2]-e[2]),c=Te(a,a);let l=1e-5*s;return c!==0&&(i.t=s/c),l<0&&(l=-l),-l<c&&c<l||c<=0||i.t<0?o=e:i.t>1?o=n:(o=a,a[0]=e[0]+i.t*a[0],a[1]=e[1]+i.t*a[1],a[2]=e[2]+i.t*a[2]),r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2]),i.distance=zr(o,t),i}function Wx(t,e,n,r,i,a){const o=[],s=[],c=[];i[0]=0,a[0]=0,xi(e,t,o),xi(r,n,s),xi(n,t,c);const l=[Te(o,o),-Te(o,s),-Te(o,s),Te(s,s)],f=[];if(f[0]=Te(o,c),f[1]=-Te(s,c),DT(l,f,2)===0){let u=Number.MAX_VALUE;const g=[t,e,n,r],d=[n,n,t,t],h=[r,r,e,e];a[0],a[0],i[0],i[0],i[0],i[0],a[0],a[0];let p;for(let m=0;m<4;m++)p=ws(g[m],d[m],h[m]),p.distance<u&&(u=p.distance);return Af.ON_LINE}return i[0]=f[0],a[0]=f[1],i[0]>=0&&i[0]<=1&&a[0]>=0&&a[0]<=1?Af.YES_INTERSECTION:Af.NO_INTERSECTION}const gG={distanceToLine:ws,intersection:Wx};function dG(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,i,a,o,s)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const l=[],f=[],u=[];e.points.getPoint(0,f),e.points.getPoint(1,u);const g=[],d=[],h=Wx(r,i,f,u,g,d);if(c.t=g[0],c.betweenPoints=n(c.t),s[0]=d[0],h===Af.YES_INTERSECTION){for(let p=0;p<3;p++)o[p]=f[p]+s[0]*(u[p]-f[p]),l[p]=r[p]+c.t*(i[p]-r[p]);if(zr(o,l)<=a*a)return c.intersect=1,c}else{let p;if(c.t<0)return p=ws(r,f,u,o),p.distance<=a*a&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return p=ws(i,f,u,o),p.distance<=a*a&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,p=ws(f,r,i,o),c.t=p.t,p.distance<=a*a&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,p=ws(u,r,i,o),c.t=p.t,p.distance<=a*a&&(c.intersect=1),c}return c},t.evaluateLocation=(r,i,a)=>{const o=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,s);for(let c=0;c<3;c++)i[c]=o[c]+r[0]*(s[c]-o[c]);a[0]=1-r[0],a[1]=r[0]},t.evaluateOrientation=(r,i,a)=>e.orientations?(Rf(i,e.orientations[0],e.orientations[1],r[0]),a[0]=1-r[0],a[1]=r[0],!0):!1}const pG={orientations:null};function $x(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pG,n),H1.extend(t,e,n),D.setGet(t,e,["orientations"]),dG(t,e)}const hG=D.newInstance($x,"vtkLine");var rr={newInstance:hG,extend:$x,...gG,...Gx};function mG(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Lr(e.points):e.points=z1.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),e.points=z1.newInstance(),e.points.shallowCopy(r.getPoints())}}const vG={};function zx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vG,n),b0.extend(t,e,n),D.setGet(t,e,["points"]),mG(t,e)}const yG=D.newInstance(zx,"vtkPointSet");var CG={newInstance:yG,extend:zx};function X3(t,e,n,r){const i=n[0]-e[0],a=n[1]-e[1],o=n[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];r[0]=a*l-o*c,r[1]=o*s-i*l,r[2]=i*c-a*s}function j1(t,e,n,r){X3(t,e,n,r);const i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i!==0&&(r[0]/=i,r[1]/=i,r[2]/=i)}function TG(t,e,n,r,i,a){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const c=[],l=[],f=[],u=[],g=[];j1(t,e,n,u),j1(r,i,a,g);const d=-Te(u,t),h=-Te(g,r),p=[Te(g,t)+h,Te(g,e)+h,Te(g,n)+h];if(p[0]*p[1]>o&&p[0]*p[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const m=[Te(u,r)+d,Te(u,i)+d,Te(u,a)+d];if(m[0]*m[1]>o&&m[0]*m[2]>o)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Math.abs(u[0]-g[0])<1e-9&&Math.abs(u[1]-g[1])<1e-9&&Math.abs(u[2]-g[2])<1e-9&&Math.abs(d-h)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const v=[t,e,n],y=[r,i,a],C=Te(u,g),T=(d-h*C)/(C*C-1),S=(h-d*C)/(C*C-1),x=[T*u[0]+S*g[0],T*u[1]+S*g[1],T*u[2]+S*g[2]],w=ei(u,g,[]);bo(w);let E=0,M=0;const O=[],R=[];let _=50,P=50;for(let U=0;U<3;U++){const K=U,A=(U+1)%3,b=hn.intersectWithLine(v[K],v[A],r,g);b.intersection&&b.t>0-o&&b.t<1+o&&(b.t<1+o&&b.t>1-o&&(_=E),O[E++]=Te(b.x,w)-Te(x,w));const F=hn.intersectWithLine(y[K],y[A],t,u);F.intersection&&F.t>0-o&&F.t<1+o&&(F.t<1+o&&F.t>1-o&&(P=M),R[M++]=Te(F.x,w)-Te(x,w))}if(E>2){E--;const U=O[2];O[2]=O[_],O[_]=U}if(M>2){M--;const U=R[2];R[2]=R[P],R[P]=U}if(E!==2||M!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Number.isNaN(O[0])||Number.isNaN(O[1])||Number.isNaN(R[0])||Number.isNaN(R[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(O[0]>O[1]){const U=O[1];O[1]=O[0],O[0]=U}if(R[0]>R[1]){const U=R[1];R[1]=R[0],R[0]=U}let N,W;return O[1]<R[0]||R[1]<O[0]?{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f}:(O[0]<R[0]?O[1]<R[1]?(f[0]=2,f[1]=1,N=R[0],W=O[1]):(f[0]=2,f[1]=2,N=R[0],W=R[1]):O[1]<R[1]?(f[0]=1,f[1]=1,N=O[0],W=O[1]):(f[0]=1,f[1]=2,N=O[0],W=R[1]),lh(x,w,N,c),lh(x,w,W,l),{intersect:!0,coplanar:s,pt1:c,pt2:l,surfaceId:f})}const SG={computeNormalDirection:X3,computeNormal:j1,intersectWithTriangle:TG};function xG(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,i,a,o)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};o[2]=0;const c=[],l=i*i,f=[],u=[],g=[];e.points.getPoint(0,f),e.points.getPoint(1,u),e.points.getPoint(2,g);const d=[],h=[];if(j1(f,u,g,d),d[0]!==0||d[1]!==0||d[2]!==0){const C=hn.intersectWithLine(n,r,f,d);if(s.betweenPoints=C.betweenPoints,s.t=C.t,a[0]=C.x[0],a[1]=C.x[1],a[2]=C.x[2],!C.intersection)return o[0]=0,o[1]=0,s.intersect=0,s;const T=t.evaluatePosition(a,c,o,h);if(T.evaluation>=0)return T.dist2<=l?(s.intersect=1,s):(s.intersect=T.evaluation,s)}const p=zr(f,u),m=zr(u,g),v=zr(g,f);e.line||(e.line=rr.newInstance()),p>m&&p>v?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,u)):m>v&&m>p?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,g)):(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f));const y=e.line.intersectWithLine(n,r,i,a,o);if(s.betweenPoints=y.betweenPoints,s.t=y.t,y.intersect){const C=[],T=[],S=[];for(let x=0;x<3;x++)C[x]=f[x]-g[x],T[x]=u[x]-g[x],S[x]=a[x]-g[x];return o[0]=Te(S,C)/v,o[1]=Te(S,T)/m,s.intersect=1,s}return o[0]=0,o[1]=0,s.intersect=0,s},t.evaluatePosition=(n,r,i,a)=>{const o={subId:0,dist2:0,evaluation:-1};let s,c;const l=[],f=[],u=[],g=[];let d;const h=[],p=[],m=[];let v=0,y=0;const C=[];let T,S,x,w=[];const E=[],M=[],O=[];o.subId=0,i[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,f),e.points.getPoint(0,u),X3(l,f,u,g),hn.generalizedProjectPoint(n,l,g,O);let R=0;for(s=0;s<3;s++)g[s]<0?d=-g[s]:d=g[s],d>R&&(R=d,y=s);for(c=0,s=0;s<3;s++)s!==y&&(C[c++]=s);for(s=0;s<2;s++)h[s]=O[C[s]]-u[C[s]],p[s]=l[C[s]]-u[C[s]],m[s]=f[C[s]]-u[C[s]];if(v=pt(p,m),v===0)return i[0]=0,i[1]=0,o.evaluation=-1,o;if(i[0]=pt(h,m)/v,i[1]=pt(p,h)/v,a[0]=1-(i[0]+i[1]),a[1]=i[0],a[2]=i[1],a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&a[2]>=0&&a[2]<=1)r&&(o.dist2=zr(O,n),r[0]=O[0],r[1]=O[1],r[2]=O[2]),o.evaluation=1;else{let _;if(r){if(a[1]<0&&a[2]<0)for(T=zr(n,u),S=rr.distanceToLine(n,l,u,_,E),x=rr.distanceToLine(n,u,f,_,M),T<S?(o.dist2=T,w=u):(o.dist2=S,w=E),x<o.dist2&&(o.dist2=x,w=M),s=0;s<3;s++)r[s]=w[s];else if(a[2]<0&&a[0]<0)for(T=zr(n,l),S=rr.distanceToLine(n,l,u,_,E),x=rr.distanceToLine(n,l,f,_,M),T<S?(o.dist2=T,w=l):(o.dist2=S,w=E),x<o.dist2&&(o.dist2=x,w=M),s=0;s<3;s++)r[s]=w[s];else if(a[1]<0&&a[0]<0)for(T=zr(n,f),S=rr.distanceToLine(n,f,u,_,E),x=rr.distanceToLine(n,l,f,_,M),T<S?(o.dist2=T,w=f):(o.dist2=S,w=E),x<o.dist2&&(o.dist2=x,w=M),s=0;s<3;s++)r[s]=w[s];else if(a[0]<0){const P=rr.distanceToLine(n,l,f,r);o.dist2=P.distance}else if(a[1]<0){const P=rr.distanceToLine(n,f,u,r);o.dist2=P.distance}else if(a[2]<0){const P=rr.distanceToLine(n,l,u,r);o.dist2=P.distance}}o.evaluation=0}return o},t.evaluateLocation=(n,r,i)=>{const a=[],o=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,o),e.points.getPoint(2,s);const c=1-n[0]-n[1];for(let l=0;l<3;l++)r[l]=a[l]*c+o[l]*n[0]+s[l]*n[1];i[0]=c,i[1]=n[0],i[2]=n[1]},t.getParametricDistance=n=>{let r,i=0;const a=[];a[0]=n[0],a[1]=n[1],a[2]=1-n[0]-n[1];for(let o=0;o<3;o++)a[o]<0?r=-a[o]:a[o]>1?r=a[o]-1:r=0,r>i&&(i=r);return i}}const wG={};function Hx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wG,n),H1.extend(t,e,n),xG(t,e)}const EG=D.newInstance(Hx,"vtkTriangle");var OG={newInstance:EG,extend:Hx,...SG};const T2=["verts","lines","polys","strips"],{vtkWarningMacro:gv}=D,DG={[qe.VTK_LINE]:rr,[qe.VTK_POLY_LINE]:rr,[qe.VTK_TRIANGLE]:OG};function RG(t,e){e.classHierarchy.push("vtkPolyData");function n(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,a=>a.toUpperCase()).replace(/\s+/g,"")}T2.forEach(i=>{t[`getNumberOf${n(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=Lr(e[i]):e[i]=Po.newInstance()}),t.getNumberOfCells=()=>T2.reduce((i,a)=>i+e[a].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,a),T2.forEach(o=>{e[o]=Po.newInstance(),e[o].shallowCopy(i.getReferenceByName(o))})},t.buildCells=()=>{const i=t.getNumberOfVerts(),a=t.getNumberOfLines(),o=t.getNumberOfPolys(),s=t.getNumberOfStrips(),c=i+a+o+s,l=new Uint8Array(c);let f=l;const u=new Uint32Array(c);let g=u;if(i){let d=0;e.verts.getCellSizes().forEach((h,p)=>{g[p]=d,f[p]=h>1?qe.VTK_POLY_VERTEX:qe.VTK_VERTEX,d+=h+1}),g=g.subarray(i),f=f.subarray(i)}if(a){let d=0;e.lines.getCellSizes().forEach((h,p)=>{g[p]=d,f[p]=h>2?qe.VTK_POLY_LINE:qe.VTK_LINE,h===1&&gv("Building VTK_LINE ",p," with only one point, but VTK_LINE needs at least two points. Check the input."),d+=h+1}),g=g.subarray(a),f=f.subarray(a)}if(o){let d=0;e.polys.getCellSizes().forEach((h,p)=>{switch(g[p]=d,h){case 3:f[p]=qe.VTK_TRIANGLE;break;case 4:f[p]=qe.VTK_QUAD;break;default:f[p]=qe.VTK_POLYGON;break}h<3&&gv("Building VTK_TRIANGLE ",p," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),d+=h+1}),g+=g.subarray(o),f+=f.subarray(o)}if(s){let d=0;f.fill(qe.VTK_TRIANGLE_STRIP,0,s),e.strips.getCellSizes().forEach((h,p)=>{g[p]=d,d+=h+1})}e.cells=uG.newInstance(),e.cells.setCellTypes(c,l,u)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=tG.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{const a=t.getCellType(i);let o=null;switch(a){case qe.VTK_VERTEX:case qe.VTK_POLY_VERTEX:o=e.verts;break;case qe.VTK_LINE:case qe.VTK_POLY_LINE:o=e.lines;break;case qe.VTK_TRIANGLE:case qe.VTK_QUAD:case qe.VTK_POLYGON:o=e.polys;break;case qe.VTK_TRIANGLE_STRIP:o=e.strips;break;default:return o=null,{type:0,cellPointIds:null}}const s=e.cells.getCellLocation(i),c=o.getCell(s);return{cellType:a,cellPointIds:c}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,a,o)=>{const s=e.links.getLink(a),c=e.links.getLink(o);return s.cells.filter(l=>l!==i&&c.cells.indexOf(l)!==-1)},t.getCell=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const o=t.getCellPoints(i),s=a||DG[o.cellType].newInstance();return s.initialize(t.getPoints(),o.cellPointIds),s}}const MG={};function jx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MG,n),CG.extend(t,e,n),D.get(t,e,["cells","links"]),D.setGet(t,e,["verts","lines","polys","strips"]),RG(t,e)}const LG=D.newInstance(jx,"vtkPolyData");var Bn={newInstance:LG,extend:jx};const IG=1e-6;function VG(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((i,a)=>i+r[a]),t.modified()},t.getOrientationWXYZ=()=>{const r=Io();ih(r,e.rotation);const i=new Float64Array(3),a=ZV(i,r);return[N1(a),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ih(r,e.rotation)},t.rotateX=r=>{r!==0&&(Q5(e.rotation,e.rotation,gt(r)),t.modified())},t.rotateY=r=>{r!==0&&(e3(e.rotation,e.rotation,gt(r)),t.modified())},t.rotateZ=r=>{r!==0&&(t3(e.rotation,e.rotation,gt(r)),t.modified())},t.rotateWXYZ=(r,i,a,o)=>{if(r===0||i===0&&a===0&&o===0)return;const s=gt(r),c=Io();a3(c,[i,a,o],s);const l=new Float64Array(16);E1(l,c),De(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-IG)return;const i=E1(new Float64Array(16),r);De(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(r,i,a)=>r===e.orientation[0]&&i===e.orientation[1]&&a===e.orientation[2]?!1:(e.orientation=[r,i,a],ie(e.rotation),t.rotateZ(a),t.rotateX(r),t.rotateY(i),t.modified(),!0),t.setUserMatrix=r=>zl(e.userMatrix,r)?!1:(it(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){ie(e.matrix),e.userMatrix&&De(e.matrix,e.matrix,e.userMatrix),nt(e.matrix,e.matrix,e.origin),nt(e.matrix,e.matrix,e.position),De(e.matrix,e.matrix,e.rotation),Vi(e.matrix,e.matrix,e.scale),nt(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),xe(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let i=0;i<4;++i)(r===i?1:0)!==e.matrix[r+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>Be.getCenter(e.bounds),t.getLength=()=>Be.getLength(e.bounds),t.getXRange=()=>Be.getXRange(e.bounds),t.getYRange=()=>Be.getYRange(e.bounds),t.getZRange=()=>Be.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const _G={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function Kx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_G,n),jl.extend(t,e,n),e.matrixMTime={},D.obj(e.matrixMTime),D.get(t,e,["bounds","isIdentity"]),D.getArray(t,e,["orientation"]),D.setGetArray(t,e,["origin","position","scale"],3),e.matrix=ie(new Float64Array(16)),e.rotation=ie(new Float64Array(16)),e.userMatrix=ie(new Float64Array(16)),e.transform=null,VG(t,e)}const bG=D.newInstance(Kx,"vtkProp3D");var Y3={newInstance:bG,extend:Kx};const{vtkDebugMacro:NG}=D;function PG(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=_0.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){NG("Recomputing bounds..."),e.mapperBounds=r.concat();const i=[];Be.getCorners(r,i),t.computeMatrix();const a=new Float64Array(16);xe(a,e.matrix),i.forEach(o=>Ee(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((c,l)=>c>l[s/2]?l[s/2]:c,o):i.reduce((c,l)=>c<l[(s-1)/2]?l[(s-1)/2]:c,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=n.getMTime();if(e.property!==null){const i=e.property.getMTime();r=i>r?i:r}if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();r=i>r?i:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();r=i>r?i:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),r=i>r?i:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,i)}}const kG={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function qx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kG,n),Y3.extend(t,e,n),e.boundsMTime={},D.obj(e.boundsMTime),D.set(t,e,["property"]),D.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),PG(t,e)}const FG=D.newInstance(qx,"vtkActor");var ko={newInstance:FG,extend:qx};function UG(t,e){const n=t.invokeResize;delete t.invokeResize,e.renderWindow=Ub.newInstance(),e.rendererMap={},e.openGLRenderWindow=fB.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=UB.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:r,id:i,background:a})=>{const o=LB.newInstance({viewport:r,background:a||e.background});e.renderWindow.addRenderer(o),e.rendererMap[i]=o},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=r=>{const i=t.getRenderer(r);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[r]},t.getRenderer=r=>e.rendererMap[r],t.getRenderers=()=>{const{rendererMap:r}=e;return Object.keys(r).map(a=>({id:a,renderer:r[a]}))},t.resize=()=>{if(e.container){const{width:r,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(r),Math.floor(i)),n(),e.renderWindow.render()}},t.setContainer=r=>{e.container=r,e.openGLRenderWindow.setContainer(e.container)},t.delete=D.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const AG={background:[0,0,0],container:null};function Xx(t,e,n={}){Object.assign(e,AG,n),D.obj(t,e),D.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),D.event(t,e,"resize"),UG(t,e)}const BG=D.newInstance(Xx),GG={newInstance:BG,extend:Xx},{vtkErrorMacro:Uu}=D;function WG(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let n,r=0,i=0;e.nodes.length>0&&(r=e.nodes[0].y);for(let a=1;a<e.nodes.length;a++){if(n=e.nodes[a].y,n!==r)if(n>r)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(r=n,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(let r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let n=1,r=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){n=0;break}return n?r=Number.MAX_VALUE:i>0?r=e.nodes[i-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=(n,r)=>{const i=e.nodes.length;return n<0||n>=i?(Uu("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=(n,r)=>{const i=e.nodes.length;if(n<0||n>=i)return Uu("Index out of range!"),-1;const a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(n,r)=>t.addPointLong(n,r,.5,0),t.addPointLong=(n,r,i,a)=>{if(i<0||i>1)return Uu("Midpoint outside range [0.0, 1.0]"),-1;if(a<0||a>1)return Uu("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const o={x:n,y:r,midpoint:i,sharpness:a};e.nodes.push(o),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==n;s++);return s<e.nodes.length?s:-1},t.setNodes=n=>{e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((r,i)=>r.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;const i=r;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(n,r,i,a)=>{t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=n&&e.nodes[o].x<=i?e.nodes.splice(o,1):o++;t.addPoint(n,r,.5,0),t.addPoint(i,a,.5,0)},t.getValue=n=>{const r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=n=>{if(n.length<2)return 0;const r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{const n=e.nodes.length;if(n<2)return-1;let r=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<n-1;i++){const a=e.nodes[i+1].x-e.nodes[i].x;a<r&&(r=a)}return r},t.getTable=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0;const l=e.nodes.length;let f=0;l!==0&&(f=e.nodes[l-1].y);let u=0,g=0,d=0,h=0,p=0,m=0,v=0;for(s=0;s<i;s++){const y=o*s;for(i>1?u=n+s/(i-1)*(r-n):u=.5*(n+r);c<l&&u>e.nodes[c].x;)c++,c<l&&(g=e.nodes[c-1].x,d=e.nodes[c].x,h=e.nodes[c-1].y,p=e.nodes[c].y,m=e.nodes[c-1].midpoint,v=e.nodes[c-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(c>=l)a[y]=e.clamping?f:0;else if(c===0)a[y]=e.clamping?e.nodes[0].y:0;else{let C=(u-g)/(d-g);if(C<m?C=.5*C/m:C=.5+.5*(C-m)/(1-m),v>.99)if(C<.5){a[y]=h;continue}else{a[y]=p;continue}if(v<.01){a[y]=(1-C)*h+C*p;continue}C<.5?C=.5*(C*2)**(1+10*v):C>.5&&(C=1-.5*((1-C)*2)**(1+10*v));const T=C*C,S=T*C,x=2*S-3*T+1,w=-2*S+3*T,E=S-2*T+C,M=S-T,O=p-h,R=(1-v)*O;a[y]=x*h+w*p+E*R+M*R;const _=h<p?h:p,P=h>p?h:p;a[y]=a[y]<_?_:a[y],a[y]=a[y]>P?P:a[y]}}}}const $G={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function Yx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$G,n),D.obj(t,e),e.nodes=[],D.setGet(t,e,["allowDuplicateScalars","clamping"]),D.setArray(t,e,["range"],2),D.getArray(t,e,["range"]),WG(t,e)}const zG=D.newInstance(Yx,"vtkPiecewiseFunction");var u0={newInstance:zG,extend:Yx};const{BlendMode:zi,FilterMode:xc}=X7;function HG(t,e,n,r,i){let a=null;return i?(a=i,a.removeAllPoints()):a=u0.newInstance(),a.addPointLong(-1024,0,1,1),a.addPoint(t,e),a.addPoint(n,r),a}const jG={createRadonTransferFunction:HG};function KG(t,e){e.classHierarchy.push("vtkVolumeMapper");const n={...t};t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=xa(),e.bounds},t.update=()=>{t.getInputData()},t.setBlendModeToComposite=()=>{t.setBlendMode(zi.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(zi.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(zi.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(zi.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(zi.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(zi.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>D.enumToString(zi,e.blendMode),t.setAverageIPScalarRange=(r,i)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(r,i)},t.getFilterModeAsString=()=>D.enumToString(xc,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(xc.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(xc.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(xc.RAW)},t.setGlobalIlluminationReach=r=>n.setGlobalIlluminationReach(Ir(r,0,1)),t.setVolumetricScatteringBlending=r=>n.setVolumetricScatteringBlending(Ir(r,0,1)),t.setVolumeShadowSamplingDistFactor=r=>n.setVolumeShadowSamplingDistFactor(r>=1?r:1),t.setAnisotropy=r=>n.setAnisotropy(Ir(r,-.99,.99)),t.setLAOKernelSize=r=>n.setLAOKernelSize(O3(Ir(r,1,32))),t.setLAOKernelRadius=r=>n.setLAOKernelRadius(r>=1?r:1)}const qG={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:zi.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:xc.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function Zx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qG,n),W3.extend(t,e,n),D.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),D.setGetArray(t,e,["ipScalarRange"],2),D.event(t,e,"lightingActivated"),KG(t,e)}const XG=D.newInstance(Zx,"vtkVolumeMapper");var YG={newInstance:XG,extend:Zx,...jG};function ZG(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const n=t.delete;t.delete=()=>{e.scalarTexture=null,n()}}const JG={scalarTexture:null};function Jx(t,e,n={}){Object.assign(e,JG,n),YG.extend(t,e,n),D.setGet(t,e,["scalarTexture"]),ZG(t,e)}const QG=D.newInstance(Jx,"vtkSharedVolumeMapper"),eW={newInstance:QG,extend:Jx};function tW(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(o,s,c,l,f,u,g)=>{e.inputDataType=f,e.inputNumComps=l,n(o,s,c,l,f,u,g)},t.update3DFromRaw=()=>{const{volumeId:o}=e;if(!o)return;const s=Q.getVolume(o);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),s.isDynamicVolume()){a();return}return t.hasUpdatedFrames()&&i()};const r=t.modified;t.setUpdatedFrame=o=>{e.updatedFrames[o]=!0,r()},t.modified=()=>{r();const o=Q.getVolume(e.volumeId);if(!o)return;const s=o.imageIds;for(let c=0;c<s.length;c++)e.updatedFrames[c]=!0};function i(){const s=Q.getVolume(e.volumeId).imageIds;for(let c=0;c<e.updatedFrames.length;c++)if(e.updatedFrames[c]){const l=Q.getImage(s[c]);if(!l)continue;const f=l.voxelManager.getScalarData(),u=e.context,g=f.constructor.name,[d]=t.updateArrayDataTypeForGL(g,[f]);t.bind();const h=c;u.texSubImage3D(e.target,0,0,0,h,e.width,e.height,1,e.format,e.openGLDataType,d),t.deactivate(),e.updatedFrames[c]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function a(){const o=Q.getVolume(e.volumeId),s=o.getCurrentTimePointImageIds();if(!s.length)return!1;let c;for(let l=0;l<s.length;l++){const f=s[l],u=Q.getImage(f);let g;u?(g=u.voxelManager.getScalarData(),c=g.constructor):(c=Y7(o.dataType,!0),g=new c(e.width*e.height));const d=e.context,h=g.constructor.name,[p]=t.updateArrayDataTypeForGL(h,[g]);t.bind();let m=l;d.texSubImage3D(e.target,0,0,0,m,e.width,e.height,1,e.format,e.openGLDataType,p),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(o=>o),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=o=>{e.volumeId=o},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:o,height:s,depth:c,numberOfComponents:l,dataType:f})=>{e.width??(e.width=o),e.height??(e.height=s),e.depth??(e.depth=c),e.inputNumComps??(e.inputNumComps=l),e.inputDataType??(e.inputDataType=f)},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const nW={updatedFrames:[]};function Qx(t,e,n={}){Object.assign(e,nW,n),Je.extend(t,e,n),tW(t,e)}const rW=D.newInstance(Qx,"vtkStreamingOpenGLTexture"),iW={newInstance:rW,extend:Qx},aW={isPerformingCoordinateTransformation:!1};function ew(t,e,n={}){Object.assign(e,aW,n),K3.extend(t,e,n),D.setGet(t,e,["isPerformingCoordinateTransformation"]),sW(t,e)}const oW=D.newInstance(ew,"vtkSlabCamera");function sW(t,e){e.classHierarchy.push("vtkSlabCamera");const n=ie(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(i,a,o)=>{const s=Ia();if(e.projectionMatrix){const g=1/e.physicalScale;return Fe(r,g,g,g),it(s,e.projectionMatrix),Vi(s,s,r),xe(s,s),s}ie(n);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const f=l-c,u=[c+(a+1)*f/2,c+(o+1)*f/2];if(e.parallelProjection){const g=e.parallelScale*i,d=e.parallelScale,h=(e.windowCenter[0]-1)*g,p=(e.windowCenter[0]+1)*g,m=(e.windowCenter[1]-1)*d,v=(e.windowCenter[1]+1)*d;i3(n,h,p,m,v,u[0],u[1]),xe(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const g=Math.tan(Dr.radiansFromDegrees(e.viewAngle)/2);let d,h;e.useHorizontalViewAngle===!0?(d=c*g,h=c*g/i):(d=c*g*i,h=c*g);const p=(e.windowCenter[0]-1)*d,m=(e.windowCenter[0]+1)*d,v=(e.windowCenter[1]-1)*h,y=(e.windowCenter[1]+1)*h,C=u[0],T=u[1];n[0]=2*C/(m-p),n[5]=2*C/(y-v),n[2]=(p+m)/(m-p),n[6]=(v+y)/(y-v),n[10]=-(C+T)/(T-C),n[14]=-1,n[11]=-2*C*T/(T-C),n[15]=0}}return it(s,n),s}}const cW={newInstance:oW,extend:ew};function jr(t){return Gn(t,"vtkVolume")||Gn(t,"vtkImageSlice")}function Gn(t,e){return!!("isA"in t?t:t.actor).isA(e)}function f0(t,e){const{direction:n,spacing:r}=t,i=n.slice(0,3),a=n.slice(3,6),o=n.slice(6,9),s=[fe(i,e),fe(a,e),fe(o,e)],c=te();return Fe(c,s[0]*r[0],s[1]*r[1],s[2]*r[2]),ma(c)}function ml(t,e,n){const{direction:r,spacing:i,imageIds:a}=t;if(!a.length)return;const o=r.slice(6,9),s=fe(o,n);if(Math.abs(s)<1-Qr)return;const l=f0({direction:r,spacing:i},n)/2;let f;for(let u=0;u<a.length;u++){const g=a[u],{imagePositionPatient:d}=ee("imagePlaneModule",g),h=te();_t(h,e,d);const p=fe(h,n);Math.abs(p)<l&&(f=g)}return f}const lW=t=>t,dv=1e-6;let tw=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=ie(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?YI:lW}rotateFromDirections(e,n){const r=new Float64Array(3),i=new Float64Array(3),a=new Float64Array(16);Fe(r,e[0],e[1],e[2]),Fe(i,n[0],n[1],n[2]),$t(r,r),$t(i,i);const o=fe(r,i);return o>=1?this:(vt(this.tmp,r,i),ma(this.tmp)<dv&&(vt(this.tmp,[1,0,0],e),ma(this.tmp)<dv&&vt(this.tmp,[0,1,0],e)),r3(a,Math.acos(o),this.tmp),De(this.matrix,this.matrix,a),this)}rotate(e,n){return Fe(this.tmp,...n),$t(this.tmp,this.tmp),yr(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return Q5(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return e3(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return t3(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return Fe(this.tmp,e,n,r),nt(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return Fe(this.tmp,e,n,r),Vi(this.matrix,this.matrix,this.tmp),this}multiply(e){return De(this.matrix,this.matrix,e),this}multiply3x3(e){return De(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return xt(this.matrix,this.matrix),this}identity(){return ie(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(zl(x3,this.matrix))return this;const i=r===-1?e.length:n+r*3;for(let a=n;a<i;a+=3)Fe(this.tmp,e[a],e[a+1],e[a+2]),Ee(this.tmp,this.tmp,this.matrix),e[a]=this.tmp[0],e[a+1]=this.tmp[1],e[a+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&it(this.matrix,e),this}};function uW(){return new tw(!0)}function fW(){return new tw(!1)}var go={buildFromDegree:uW,buildFromRadian:fW};function nw(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}const gW=Qr*Qr,S2=t=>Math.abs(Math.abs(t)-1)<gW,x2=(t,e)=>S2(t[e])||S2(t[e+1])||S2(t[e+2]),dW=t=>x2(t,0)&&x2(t,3)&&x2(t,6);function ed(t,e,n){const r=t.getMapper().getInputData();let i;const a=r.getDirection();if(dW(a))i=nw(t);else{const[u,g,d]=r.getDimensions();i=[[0,0,0],[u-1,0,0],[0,g-1,0],[u-1,g-1,0],[0,0,d-1],[u-1,0,d-1],[0,g-1,d-1],[u-1,g-1,d-1]].map(p=>r.indexToWorld(p))}const o=go.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(u=>o.apply(u));const s=[...n];o.apply(s);const c=s[0];let l=1/0,f=-1/0;for(let u=0;u<8;u++){const g=i[u][0];g>f&&(f=g),g<l&&(l=g)}return{min:l,max:f,current:c,actor:t,viewPlaneNormal:e,focalPoint:n}}function Ws(t,e,n,r,i,a){const{min:o,max:s,current:c}=n,l=te();_t(l,e,t);const f=Math.round((s-o)/i),g=(c-o)/(s-o)*f;let d=Math.round(g),h=[t[0]-r[0]*g*i,t[1]-r[1]*g*i,t[2]-r[2]*g*i];d+=a,d>f?d=f:d<0&&(d=0);const p=d*i;h=[h[0]+r[0]*p,h[1]+r[1]*p,h[2]+r[2]*p];const m=[h[0]+l[0],h[1]+l[1],h[2]+l[2]];return{newFocalPoint:h,newPosition:m}}const pW={RGB:0,HSV:1,LAB:2,DIVERGING:3},hW={LINEAR:0,LOG10:1};var rw={ColorSpace:pW,Scale:hW};const{ColorSpace:ir,Scale:Z3}=rw,{ScalarMappingTarget:Au}=Xg,{vtkDebugMacro:mW,vtkErrorMacro:oi,vtkWarningMacro:vW}=D;function pv(t,e){const n=t[0],r=t[1],i=t[2],a=Math.sqrt(n*n+r*r+i*i),o=a>.001?Math.acos(n/a):0,s=o>.001?Math.atan2(i,r):0;e[0]=a,e[1]=o,e[2]=s}function yW(t,e){const n=t[0],r=t[1],i=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(i),e[2]=n*Math.sin(r)*Math.sin(i)}function hv(t,e){if(t[0]>=e-.1)return t[2];const n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function CW(t,e){let n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function mv(t,e,n,r){const i=[],a=[];fo(e,i),fo(n,a);const o=[],s=[];pv(i,o),pv(a,s);let c=t;if(o[1]>.05&&s[1]>.05&&CW(o[2],s[2])>.33*Math.PI){let u=Math.max(o[0],s[0]);u=Math.max(88,u),t<.5?(s[0]=u,s[1]=0,s[2]=0,c*=2):(o[0]=u,o[1]=0,o[2]=0,c=2*c-1)}o[1]<.05&&s[1]>.05?o[2]=hv(s,o[0]):s[1]<.05&&o[1]>.05&&(s[2]=hv(o,s[0]));const l=[];l[0]=(1-c)*o[0]+c*s[0],l[1]=(1-c)*o[1]+c*s[1],l[2]=(1-c)*o[2]+c*s[2];const f=[];yW(l,f),k1(f,r)}function TW(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(n,r,i,a)=>t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(o<0||o>1)return oi("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return oi("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const c={x:n,r,g:i,b:a,midpoint:o,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==n;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(n,r,i,a)=>t.addHSVPointLong(n,r,i,a,.5,0),t.addHSVPointLong=function(n,r,i,a){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return ro([r,i,a],c),t.addRGBPoint(n,c[0],c[1],c[2],o,s)},t.setNodes=n=>{if(e.nodes!==n){const r=JSON.stringify(e.nodes);e.nodes=n;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const n=JSON.stringify(e.nodes);e.nodes.sort((a,o)=>a.x-o.x);const r=JSON.stringify(e.nodes),i=t.updateRange();return!i&&n!==r?(t.modified(),!0):i},t.updateRange=()=>{const n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];const r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r=0;for(;r<e.nodes.length&&e.nodes[r].x!==n;r++);const i=r;if(r>=e.nodes.length)return-1;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.movePoint=(n,r)=>{if(n!==r){t.removePoint(r);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===n){e.nodes[i].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(n,r,i,a,o,s,c,l)=>{t.sortAndUpdateRange();for(let f=0;f<e.nodes.length;)e.nodes[f].x>=n&&e.nodes[f].x<=o?e.nodes.splice(f,1):f++;t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong(o,s,c,l,.5,0),t.modified()},t.addHSVSegment=(n,r,i,a,o,s,c,l)=>{const f=[r,i,a],u=[s,c,l],g=[],d=[];ro(f,g),ro(u,d),t.addRGBSegment(n,g[0],g[1],g[2],o,d[0],d[1],d[2])},t.mapValue=n=>{const r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=(n,r)=>{if(e.indexedLookup){const i=t.getSize(),a=t.getAnnotatedValueIndexInternal(n);if(a<0||i===0){const o=t.getNanColorByReference();r[0]=o[0],r[1]=o[1],r[2]=o[2]}else{const o=[];t.getNodeValue(a%i,o),r[0]=o[1],r[1]=o[2],r[2]=o[3]}return}t.getTable(n,n,1,r)},t.getRedValue=n=>{const r=[];return t.getColor(n,r),r[0]},t.getGreenValue=n=>{const r=[];return t.getColor(n,r),r[1]},t.getBlueValue=n=>{const r=[];return t.getColor(n,r),r[2]},t.getTable=(n,r,i,a)=>{const o=Number(n),s=Number(r);if(F1(o)||F1(s)){for(let M=0;M<i;M++)a[M*3+0]=e.nanColor[0],a[M*3+1]=e.nanColor[1],a[M*3+2]=e.nanColor[2];return}let c=0;const l=e.nodes.length;let f=0,u=0,g=0;l!==0&&(f=e.nodes[l-1].r,u=e.nodes[l-1].g,g=e.nodes[l-1].b);let d=0,h=0,p=0;const m=[0,0,0],v=[0,0,0];let y=0,C=0;const T=[];let S=e.scale===Z3.LOG10;S&&(S=e.mappingRange[0]>0);let x=0,w=0,E=0;S&&(x=Math.log10(o),w=Math.log10(s));for(let M=0;M<i;M++){const O=3*M;if(i>1?S?(E=x+M/(i-1)*(w-x),d=10**E):d=o+M/(i-1)*(s-o):S?(E=.5*(x+w),d=10**E):d=.5*(o+s),e.discretize){const R=e.mappingRange;if(d>=R[0]&&d<=R[1]){const _=e.numberOfValues,P=R[1]-R[0];if(_<=1)d=R[0]+P/2;else{const N=(d-R[0])/P,W=O3(_*N);d=R[0]+W/(_-1)*P}}}for(;c<l&&d>e.nodes[c].x;)c++,c<l&&(h=e.nodes[c-1].x,p=e.nodes[c].x,S&&(h=Math.log10(h),p=Math.log10(p)),m[0]=e.nodes[c-1].r,v[0]=e.nodes[c].r,m[1]=e.nodes[c-1].g,v[1]=e.nodes[c].g,m[2]=e.nodes[c-1].b,v[2]=e.nodes[c].b,y=e.nodes[c-1].midpoint,C=e.nodes[c-1].sharpness,y<1e-5&&(y=1e-5),y>.99999&&(y=.99999));if(d>e.mappingRange[1])a[O]=0,a[O+1]=0,a[O+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(a[O]=e.aboveRangeColor[0],a[O+1]=e.aboveRangeColor[1],a[O+2]=e.aboveRangeColor[2]):(a[O]=f,a[O+1]=u,a[O+2]=g));else if(d<e.mappingRange[0]||_T(d)&&d<0)a[O]=0,a[O+1]=0,a[O+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(a[O]=e.belowRangeColor[0],a[O+1]=e.belowRangeColor[1],a[O+2]=e.belowRangeColor[2]):l>0&&(a[O]=e.nodes[0].r,a[O+1]=e.nodes[0].g,a[O+2]=e.nodes[0].b));else if(c===0&&(Math.abs(d-o)<1e-6||e.discretize))l>0?(a[O]=e.nodes[0].r,a[O+1]=e.nodes[0].g,a[O+2]=e.nodes[0].b):(a[O]=0,a[O+1]=0,a[O+2]=0);else{let R=0;if(S?R=(E-h)/(p-h):R=(d-h)/(p-h),R<y?R=.5*R/y:R=.5+.5*(R-y)/(1-y),C>.99)if(R<.5){a[O]=m[0],a[O+1]=m[1],a[O+2]=m[2];continue}else{a[O]=v[0],a[O+1]=v[1],a[O+2]=v[2];continue}if(C<.01){if(e.colorSpace===ir.RGB)a[O]=(1-R)*m[0]+R*v[0],a[O+1]=(1-R)*m[1]+R*v[1],a[O+2]=(1-R)*m[2]+R*v[2];else if(e.colorSpace===ir.HSV){const F=[],$=[];Cc(m,F),Cc(v,$),e.hSVWrap&&(F[0]-$[0]>.5||$[0]-F[0]>.5)&&(F[0]>$[0]?F[0]-=1:$[0]-=1);const j=[];j[0]=(1-R)*F[0]+R*$[0],j[0]<0&&(j[0]+=1),j[1]=(1-R)*F[1]+R*$[1],j[2]=(1-R)*F[2]+R*$[2],ro(j,T),a[O]=T[0],a[O+1]=T[1],a[O+2]=T[2]}else if(e.colorSpace===ir.LAB){const F=[],$=[];fo(m,F),fo(v,$);const j=[];j[0]=(1-R)*F[0]+R*$[0],j[1]=(1-R)*F[1]+R*$[1],j[2]=(1-R)*F[2]+R*$[2],k1(j,T),a[O]=T[0],a[O+1]=T[1],a[O+2]=T[2]}else e.colorSpace===ir.DIVERGING?(mv(R,m,v,T),a[O]=T[0],a[O+1]=T[1],a[O+2]=T[2]):oi("ColorSpace set to invalid value.",e.colorSpace);continue}R<.5?R=.5*(R*2)**(1+10*C):R>.5&&(R=1-.5*((1-R)*2)**(1+10*C));const _=R*R,P=_*R,N=2*P-3*_+1,W=-2*P+3*_,U=P-2*_+R,K=P-_;let A,b;if(e.colorSpace===ir.RGB)for(let F=0;F<3;F++)A=v[F]-m[F],b=(1-C)*A,a[O+F]=N*m[F]+W*v[F]+U*b+K*b;else if(e.colorSpace===ir.HSV){const F=[],$=[];Cc(m,F),Cc(v,$),e.hSVWrap&&(F[0]-$[0]>.5||$[0]-F[0]>.5)&&(F[0]>$[0]?F[0]-=1:$[0]-=1);const j=[];for(let z=0;z<3;z++)A=$[z]-F[z],b=(1-C)*A,j[z]=N*F[z]+W*$[z]+U*b+K*b,z===0&&j[z]<0&&(j[z]+=1);ro(j,T),a[O]=T[0],a[O+1]=T[1],a[O+2]=T[2]}else if(e.colorSpace===ir.LAB){const F=[],$=[];fo(m,F),fo(v,$);const j=[];for(let z=0;z<3;z++)A=$[z]-F[z],b=(1-C)*A,j[z]=N*F[z]+W*$[z]+U*b+K*b;k1(j,T),a[O]=T[0],a[O+1]=T[1],a[O+2]=T[2]}else e.colorSpace===ir.DIVERGING?(mv(R,m,v,T),a[O]=T[0],a[O+1]=T[1],a[O+2]=T[2]):oi("ColorSpace set to invalid value.");for(let F=0;F<3;F++)a[O+F]=a[O+F]<0?0:a[O+F],a[O+F]=a[O+F]>1?1:a[O+F]}}},t.getUint8Table=function(n,r,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==a)return e.table;if(e.nodes.length===0)return oi("Attempting to lookup a value with no points in the function"),e.table;const o=a?4:3;(e.tableSize!==i||e.tableWithAlpha!==a)&&(e.table=new Uint8Array(i*o),e.tableSize=i,e.tableWithAlpha=a);const s=[];t.getTable(n,r,i,s);for(let c=0;c<i;c++)e.table[c*o+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*o+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*o+2]=Math.floor(s[c*3+2]*255+.5),a&&(e.table[c*o+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=n=>{t.removeAllPoints();const r=n.getNumberOfComponents();for(let i=0;i<n.getNumberOfTuples();i++)switch(r){case 3:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}case 6:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(n,r,i,a)=>{let o=0;t.removeAllPoints(),i>1&&(o=(r-n)/(i-1));for(let s=0;s<i;s++){const c={x:n+o*s,r:a[s*3],g:a[s*3+1],b:a[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(n,r)=>n<0||n>=e.nodes.length?(oi("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1),t.setNodeValue=(n,r)=>{if(n<0||n>=e.nodes.length)return oi("Index out of range!"),-1;const i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{var r;if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const n=((r=e.nodes)==null?void 0:r.length)??0;return Math.max(4094,n)},t.getIndexedColor=(n,r)=>{const i=t.getSize();if(i>0&&n>=0){const o=[];t.getNodeValue(n%i,o);for(let s=0;s<3;++s)r[s]=o[s+1];r[3]=1;return}const a=t.getNanColorByReference();r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=1},t.fillFromDataPointer=(n,r)=>{if(!(n<=0||!r)){t.removeAllPoints();for(let i=0;i<n;i++)t.addRGBPoint(r[i*4],r[i*4+1],r[i*4+2],r[i*4+3])}},t.setMappingRange=(n,r)=>{const i=[n,r],a=t.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0]){oi("attempt to set zero width color range");return}const o=(i[1]-i[0])/(a[1]-a[0]),s=i[0]-a[0]*o;for(let c=0;c<e.nodes.length;++c)e.nodes[c].x=e.nodes[c].x*o+s;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=n=>{const r=t.getRange(),i=[];r[0]<n[0]?(t.getColor(n[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])):(t.getColor(r[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])),r[1]>n[1]?(t.getColor(n[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])):(t.getColor(r[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return 1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let n=Number.MAX_VALUE;for(let r=0;r<e.nodes.length-1;r++){const i=e.nodes[r+1].x-e.nodes[r].x;i<n&&(n=i)}return n},t.mapScalarsThroughTable=(n,r,i,a)=>{if(t.getSize()===0){mW("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,i,a):t.mapData(n,r,i,a)},t.mapData=(n,r,i,a)=>{if(t.getSize()===0){vW("Transfer Function Has No Points!");return}const o=Math.floor(t.getAlpha()*255+.5),s=n.getNumberOfTuples(),c=n.getNumberOfComponents(),l=r.getData(),f=n.getData(),u=[];if(i===Au.RGBA)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*4]=Math.floor(u[0]*255+.5),l[g*4+1]=Math.floor(u[1]*255+.5),l[g*4+2]=Math.floor(u[2]*255+.5),l[g*4+3]=o}if(i===Au.RGB)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*3]=Math.floor(u[0]*255+.5),l[g*3+1]=Math.floor(u[1]*255+.5),l[g*3+2]=Math.floor(u[2]*255+.5)}if(i===Au.LUMINANCE)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(i===Au.LUMINANCE_ALPHA)for(let g=0;g<s;g++){const d=f[g*c+a];t.getColor(d,u),l[g*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),l[g*2+1]=o}},t.applyColorMap=n=>{const r=JSON.stringify(e.colorSpace);n.ColorSpace&&(e.colorSpace=ir[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(oi(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),e.colorSpace=ir.RGB));let i=r!==JSON.stringify(e.colorSpace);const a=i||JSON.stringify(e.nanColor);if(n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||a!==JSON.stringify(e.nanColor);const o=i||JSON.stringify(e.nodes);if(n.RGBPoints){const l=n.RGBPoints.length;e.nodes=[];const f=.5,u=0;for(let g=0;g<l;g+=4)e.nodes.push({x:n.RGBPoints[g],r:n.RGBPoints[g+1],g:n.RGBPoints[g+2],b:n.RGBPoints[g+3],midpoint:f,sharpness:u})}const s=t.sortAndUpdateRange(),c=!s&&(i||o!==JSON.stringify(e.nodes));return c&&t.modified(),s||c}}const SW={clamping:!0,colorSpace:ir.RGB,hSVWrap:!0,scale:Z3.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function iw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SW,n),Xg.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},D.obj(e.buildTime),D.get(t,e,["buildTime","mappingRange"]),D.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:ir},{type:"enum",name:"scale",enum:Z3}]),D.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),D.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),TW(t,e)}const xW=D.newInstance(iw,"vtkColorTransferFunction");var wa={newInstance:xW,extend:iw,...rw},wW=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const g0=Object.create(null);wW.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{g0[t.Name]=t});const d0=Object.keys(g0);d0.sort();function EW(t){return g0[t]}function OW(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(g0[t.Name]||(d0.push(t.Name),d0.sort()),g0[t.Name]=t)}function DW(t){const e=d0.indexOf(t);e>-1&&d0.splice(e,1),delete g0[t]}var K1={addPreset:OW,removePresetByName:DW,getPresetByName:EW,rgbPresetNames:d0};function Va(t){return pl.get(t)}function kr(){return pl.getAll()}const q1=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",RW=t=>Array.isArray(t)?[]:{},vl=(t,e)=>e&&e.clone===!0&&q1(t)?Zn(RW(t),t,e):t,vv=(t,e,n)=>{const r=t.slice();return e.forEach(function(i,a){typeof r[a]>"u"?r[a]=vl(i,n):q1(i)?r[a]=Zn(t[a],i,n):t.indexOf(i)===-1&&(r[a]=vl(i,n))}),r},MW=(t,e,n)=>{const r={};return q1(t)&&Object.keys(t).forEach(function(i){r[i]=vl(t[i],n)}),Object.keys(e).forEach(function(i){!q1(e[i])||!t[i]?r[i]=vl(e[i],n):r[i]=Zn(t[i],e[i],n)}),r},Zn=(t={},e={},n=void 0)=>{const r=Array.isArray(e),a=(n||{arrayMerge:vv}).arrayMerge||vv;return r?Array.isArray(t)?a(t,e,n):vl(e,n):MW(t,e,n)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aw=Symbol("Comlink.proxy"),LW=Symbol("Comlink.endpoint"),ow=Symbol("Comlink.releaseProxy"),w2=Symbol("Comlink.finalizer"),Bf=Symbol("Comlink.thrown"),sw=t=>typeof t=="object"&&t!==null||typeof t=="function",IW={canHandle:t=>sw(t)&&t[aw],serialize(t){const{port1:e,port2:n}=new MessageChannel;return lw(t,e),[n,[n]]},deserialize(t){return t.start(),Oh(t)}},VW={canHandle:t=>sw(t)&&Bf in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},cw=new Map([["proxy",IW],["throw",VW]]);function _W(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function lw(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!_W(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:o,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(ao);let l;try{const f=s.slice(0,-1).reduce((g,d)=>g[d],t),u=s.reduce((g,d)=>g[d],t);switch(o){case"GET":l=u;break;case"SET":f[s.slice(-1)[0]]=ao(i.data.value),l=!0;break;case"APPLY":l=u.apply(f,c);break;case"CONSTRUCT":{const g=new u(...c);l=dw(g)}break;case"ENDPOINT":{const{port1:g,port2:d}=new MessageChannel;lw(t,d),l=FW(g,[g])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[Bf]:0}}Promise.resolve(l).catch(f=>({value:f,[Bf]:0})).then(f=>{const[u,g]=Z1(f);e.postMessage(Object.assign(Object.assign({},u),{id:a}),g),o==="RELEASE"&&(e.removeEventListener("message",r),uw(e),w2 in t&&typeof t[w2]=="function"&&t[w2]())}).catch(f=>{const[u,g]=Z1({value:new TypeError("Unserializable return value"),[Bf]:0});e.postMessage(Object.assign(Object.assign({},u),{id:a}),g)})}),e.start&&e.start()}function bW(t){return t.constructor.name==="MessagePort"}function uw(t){bW(t)&&t.close()}function Oh(t,e){const n=new Map;return t.addEventListener("message",function(i){const{data:a}=i;if(!a||!a.id)return;const o=n.get(a.id);if(o)try{o(a)}finally{n.delete(a.id)}}),Dh(t,n,[],e)}function Bu(t){if(t)throw new Error("Proxy has been released and is not useable")}function fw(t){return us(t,new Map,{type:"RELEASE"}).then(()=>{uw(t)})}const X1=new WeakMap,Y1="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(X1.get(t)||0)-1;X1.set(t,e),e===0&&fw(t)});function NW(t,e){const n=(X1.get(e)||0)+1;X1.set(e,n),Y1&&Y1.register(t,e,t)}function PW(t){Y1&&Y1.unregister(t)}function Dh(t,e,n=[],r=function(){}){let i=!1;const a=new Proxy(r,{get(o,s){if(Bu(i),s===ow)return()=>{PW(a),fw(t),e.clear(),i=!0};if(s==="then"){if(n.length===0)return{then:()=>a};const c=us(t,e,{type:"GET",path:n.map(l=>l.toString())}).then(ao);return c.then.bind(c)}return Dh(t,e,[...n,s])},set(o,s,c){Bu(i);const[l,f]=Z1(c);return us(t,e,{type:"SET",path:[...n,s].map(u=>u.toString()),value:l},f).then(ao)},apply(o,s,c){Bu(i);const l=n[n.length-1];if(l===LW)return us(t,e,{type:"ENDPOINT"}).then(ao);if(l==="bind")return Dh(t,e,n.slice(0,-1));const[f,u]=yv(c);return us(t,e,{type:"APPLY",path:n.map(g=>g.toString()),argumentList:f},u).then(ao)},construct(o,s){Bu(i);const[c,l]=yv(s);return us(t,e,{type:"CONSTRUCT",path:n.map(f=>f.toString()),argumentList:c},l).then(ao)}});return NW(a,t),a}function kW(t){return Array.prototype.concat.apply([],t)}function yv(t){const e=t.map(Z1);return[e.map(n=>n[0]),kW(e.map(n=>n[1]))]}const gw=new WeakMap;function FW(t,e){return gw.set(t,e),t}function dw(t){return Object.assign(t,{[aw]:!0})}function Z1(t){for(const[e,n]of cw)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},gw.get(t)||[]]}function ao(t){switch(t.type){case"HANDLER":return cw.get(t.name).deserialize(t.value);case"RAW":return t.value}}function us(t,e,n,r){return new Promise(i=>{const a=UW();e.set(a,i),t.start&&t.start(),t.postMessage(Object.assign({id:a},n),r)})}function UW(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class pw{constructor(){this.workerRegistry={},this.workerPoolManager=new c3("webworker")}registerWorker(e,n,r={}){var c;const{maxWorkerInstances:i=1,overwrite:a=!1,autoTerminateOnIdle:o={enabled:!1,idleTimeThreshold:3e3}}=r;if(this.workerRegistry[e]&&!a){console.warn(`Worker type '${e}' is already registered...`);return}a&&((c=this.workerRegistry[e])!=null&&c.idleCheckIntervalId)&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:o.enabled,idleCheckIntervalId:null,idleTimeThreshold:o.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let l=0;l<i;l++){const f=n();s.instances.push(Oh(f)),s.nativeWorkers.push(f),s.workerFn=n}this.workerRegistry[e]=s}getNextWorkerAPI(e){const n=this.workerRegistry[e];if(!n)return console.error(`Worker type '${e}' is not registered.`),null;const r=n.instances.filter(o=>o!==null);let i=0,a=n.loadCounters[0]||0;for(let o=1;o<r.length;o++){const s=n.loadCounters[o]||0;s<a&&(i=o,a=s)}if(n.instances[i]===null){const o=n.workerFn();n.instances[i]=Oh(o),n.nativeWorkers[i]=o}return n.loadCounters[i]+=1,{api:n.instances[i],index:i}}executeTask(e,n,r={},{requestType:i=ye.Compute,priority:a=0,options:o={},callbacks:s=[]}={}){return new Promise((c,l)=>{const f=async()=>{const{api:u,index:g}=this.getNextWorkerAPI(e);if(!u){const d=new Error(`No available worker instance for '${e}'`);console.error(d),l(d);return}try{let d=[];s.length&&(d=s.map(m=>dw(m)));const h=this.workerRegistry[e];h.processing=!0;const p=await u[n](r,...d);h.processing=!1,h.lastActiveTime[g]=Date.now(),h.autoTerminateOnIdle&&!h.idleCheckIntervalId&&h.idleTimeThreshold&&(h.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,h.idleTimeThreshold)},h.idleTimeThreshold)),c(p)}catch(d){console.error(`Error executing method '${n}' on worker '${e}':`,d),l(d)}finally{this.workerRegistry[e].loadCounters[g]--}};this.workerPoolManager.addRequest(f,i,o,a)})}terminateIdleWorkers(e,n){const r=this.workerRegistry[e];if(r.processing)return;const i=Date.now();r.instances.forEach((a,o)=>{const s=r.lastActiveTime[o],c=s!==null&&r.loadCounters[o]>0,l=i-s;!c&&l>n&&this.terminateWorkerInstance(e,o)})}terminate(e){const n=this.workerRegistry[e];if(!n){console.error(`Worker type '${e}' is not registered.`);return}n.instances.forEach((r,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,n){const r=this.workerRegistry[e],i=r.instances[n];i!==null&&(i[ow](),r.nativeWorkers[n].terminate(),r.instances[n]=null,r.lastActiveTime[n]=null)}}let Es=!1;const Rh={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,strictZSpacingForVolumeViewport:!0},peerImport:t=>null};let oa={...Rh,rendering:{...Rh.rendering}},Fc=null;function AW(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function BW(){const t=AW();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function hw(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function GW(t=oa){var n;return Es||(oa=Zn(Rh,t),hw()&&((n=t.rendering)!=null&&n.preferSizeOverAccuracy?oa.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),BW()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),oa.rendering.useCPURendering=!0),Es=!0,Fc||(Fc=new pw),Es)}function WW(t,e=!0){oa.rendering.useCPURendering=t,Es=!0,e&&$W()}function J3(){return!hw()}function Uc(){return oa.rendering.useCPURendering}function mw(){return Es}function Q3(){return oa}function $W(){kr().forEach(t=>{t.getViewports().forEach(e=>{e.updateRenderingPipeline()})})}function _a(){return Fc||(Fc=new pw),Fc}function zW(t){return oa.peerImport(t)}const em=new Map;function HW(t){em.set(t.Name,t)}function yl(t){return em.get(t)}function vw(){return Array.from(em.keys())}function tm(t,e){const n=K1.rgbPresetNames.map(s=>K1.getPresetByName(s)),r=vw().map(s=>yl(s)),a=n.concat(r).find(s=>{const{RGBPoints:c}=s;if(c.length!==t.length)return!1;for(let l=0;l<c.length;l+=4)if(!Vt(c.slice(l+1,l+4),t.slice(l+1,l+4)))return!1;return!0});if(!a)return null;const o=[];if(Gn(e,"vtkVolume")){const s=e.getProperty().getScalarOpacity(0).getDataPointer();if(!s)return{name:a.Name};for(let c=0;c<s.length;c+=2)o.push({value:s[c],opacity:s[c+1]})}return{name:a.Name,opacity:o}}const jW=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:tm,getColormap:yl,getColormapNames:vw,registerColormap:HW},Symbol.toStringTag,{value:"Module"}));function Ac(t){if(!t)return;const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}function td(t,e){const n=Math.abs(e-t)+1,r=(t+e+1)/2;return{windowWidth:n,windowCenter:r}}function $s(t,e){const n=e-.5-(t-1)/2,r=e-.5+(t-1)/2;return{lower:n,upper:r}}const KW=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:$s,toWindowLevel:td},Symbol.toStringTag,{value:"Module"}));function nm(t,e=1024){const{windowWidth:n,windowCenter:r}=td(t.lower,t.upper),i=(c,l,f)=>l-f/4*Math.log((1-c)/c),o=Array.from({length:e},(c,l)=>(l+1)/(e+2)).flatMap(c=>[i(c,r,n),c,c,c,.5,0]),s=wa.newInstance();return s.buildFunctionFromArray(he.newInstance({values:o,numberOfComponents:6})),s}function Ji(t,e){return t.worldToIndex(e).map(Math.round)}function J1(t){const e=t.getSize(),n=[];for(let r=0;r<e;r++){const i=[];t.getNodeValue(r,i),n.push(i)}return n}function nd(t,e){e!=null&&e.length&&(t.removeAllPoints(),e.forEach(n=>{t.addRGBPoint(...n)}))}const qW=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:J1,setTransferFunctionNodes:nd},Symbol.toStringTag,{value:"Module"})),{InterpolationType:wc,OpacityMode:XW}=Tx,{vtkErrorMacro:E2}=D,Gf=4;function YW(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=()=>{let i=e.mtime,a;for(let o=0;o<Gf;o++)e.componentData[o].colorChannels===1?e.componentData[o].grayTransferFunction&&(a=e.componentData[o].grayTransferFunction.getMTime(),i=i>a?i:a):e.componentData[o].colorChannels===3&&e.componentData[o].rGBTransferFunction&&(a=e.componentData[o].rGBTransferFunction.getMTime(),i=i>a?i:a),e.componentData[o].scalarOpacity&&(a=e.componentData[o].scalarOpacity.getMTime(),i=i>a?i:a),e.componentData[o].gradientOpacity&&(e.componentData[o].disableGradientOpacity||(a=e.componentData[o].gradientOpacity.getMTime(),i=i>a?i:a));return i},t.getColorChannels=i=>i<0||i>3?(E2("Bad index - must be between 0 and 3"),0):e.componentData[i].colorChannels,t.setGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].grayTransferFunction!==a&&(e.componentData[i].grayTransferFunction=a,o=!0),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1,o=!0),o&&t.modified(),o},t.getGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].grayTransferFunction===null&&(e.componentData[i].grayTransferFunction=u0.newInstance(),e.componentData[i].grayTransferFunction.addPoint(0,0),e.componentData[i].grayTransferFunction.addPoint(1024,1),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1),t.modified()),e.componentData[i].grayTransferFunction},t.setRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=!1;return e.componentData[i].rGBTransferFunction!==a&&(e.componentData[i].rGBTransferFunction=a,o=!0),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3,o=!0),o&&t.modified(),o},t.getRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].rGBTransferFunction===null&&(e.componentData[i].rGBTransferFunction=wa.newInstance(),e.componentData[i].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[i].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3),t.modified()),e.componentData[i].rGBTransferFunction},t.setScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[i].scalarOpacity!==a?(e.componentData[i].scalarOpacity=a,t.modified(),!0):!1},t.getScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].scalarOpacity===null&&(e.componentData[i].scalarOpacity=u0.newInstance(),e.componentData[i].scalarOpacity.addPoint(0,1),e.componentData[i].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[i].scalarOpacity},t.setComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(i<0||i>=Gf)return E2("Invalid index"),!1;const o=Math.min(1,Math.max(0,a));return e.componentData[i].componentWeight!==o?(e.componentData[i].componentWeight=o,t.modified(),!0):!1},t.getComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return i<0||i>=Gf?(E2("Invalid index"),0):e.componentData[i].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(wc.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(wc.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(wc.FAST_LINEAR),t.getInterpolationTypeAsString=()=>D.enumToString(wc,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=D.capitalize(i);t[`set${a}`]=(o,s)=>e.componentData[o][`${i}`]!==s?(e.componentData[o][`${i}`]=s,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=D.capitalize(i);t[`get${a}`]=o=>e.componentData[o][`${i}`]})}const ZW={colorMixPreset:null,independentComponents:!0,interpolationType:wc.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function JW(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,ZW,n),D.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<Gf;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:XW.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}D.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),D.setGetArray(t,e,["labelOutlineThickness"]),YW(t,e)}const QW=D.newInstance(JW,"vtkVolumeProperty");var e$={newInstance:QW,...Tx};const{vtkDebugMacro:t$}=D;function n$(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>t,t.makeProperty=e$.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){t$("Recomputing bounds..."),e.mapperBounds=n.map(o=>o);const i=[];Be.getCorners(n,i),t.computeMatrix();const a=new Float64Array(16);xe(a,e.matrix),i.forEach(o=>Ee(o,o,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((o,s)=>s%2===0?i.reduce((c,l)=>c>l[s/2]?l[s/2]:c,o):i.reduce((c,l)=>c<l[(s-1)/2]?l[(s-1)/2]:c,o)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}const r$={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function yw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,r$,n),Y3.extend(t,e,n),e.boundsMTime={},D.obj(e.boundsMTime),D.set(t,e,["property"]),D.setGet(t,e,["mapper"]),D.getArray(t,e,["bounds"],6),n$(t,e)}const i$=D.newInstance(yw,"vtkVolume");var a$={newInstance:i$,extend:yw};const{vtkErrorMacro:o$}=D;class s${constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const n=e[0],r=e[e.length-1];if(n===r||e.length<2)return;const i=this.segmentMapping[n],a=this.segmentMapping[r];if(i!==void 0&&a!==void 0)if(Math.abs(i)===Math.abs(a)){const o=i<a?a:i,s=this.segments[o];if(i>0)for(let c=1;c<e.length-1;c++)s.push(e[c]);else for(let c=1;c<e.length-1;c++)s.unshift(e[e.length-1-c]);this.faces.push(s),this.segments[o]=null,this.segmentMapping[n]=void 0,this.segmentMapping[r]=void 0}else{const o=Math.abs(i),s=Math.abs(a),c=this.segments[o],l=this.segments[s];this.segments[o]=null,this.segments[s]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(i!==void 0){if(i>0){const o=this.segments[i];for(let s=1;s<e.length;s++)o.push(e[s]);this.segmentMapping[r]=i}else{const o=this.segments[-i];this.segmentMapping[r]=i;for(let s=1;s<e.length;s++)o.unshift(e[s])}this.segmentMapping[n]=void 0}else if(a!==void 0){if(a>0){const o=this.segments[a];for(let s=1;s<e.length;s++)o.push(e[e.length-1-s]);this.segmentMapping[n]=a}else{const o=this.segments[-a];this.segmentMapping[n]=a;for(let s=1;s<e.length;s++)o.unshift(e[e.length-s-1])}this.segmentMapping[r]=void 0}else{const o=this.segments.length;this.segments.push(e),this.segmentMapping[n]=-o,this.segmentMapping[r]=o}}}function c$(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(n,r)=>{const i=n[0];if(!i){o$("Invalid or missing input");return}const a=Bn.newInstance();a.shallowCopy(i);const o=new s$,s=i.getLines().getData();let c=0;for(;c<s.length;){const g=s[c++],d=[];for(let h=0;h<g;h++)d.push(s[c+h]);o.addSegment(d),c+=g}const{faces:l}=o;let f=l.length;for(let g=0;g<l.length;g++)f+=l[g].length;const u=new Uint16Array(f);c=0;for(let g=0;g<l.length;g++){const d=l[g];u[c++]=d.length;for(let h=0;h<d.length;h++)u[c++]=d[h]}a.setPolys(Po.newInstance({values:u,name:"faces"})),r[0]=a}}const l$={};function Cw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,l$,n),D.obj(t,e),D.algo(t,e,1,1),c$(t,e)}const u$=D.newInstance(Cw,"vtkClosedPolyLineToSurfaceFilter");var f$={newInstance:u$,extend:Cw};const{vtkErrorMacro:Cv}=cn;function g$(t){const e=t.getPolys().getData(),n=t.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<e.length){r.cellSize=e[r.polyIdx];const i=r.polyIdx+1,a=i+r.cellSize;r.polyIdx=a;let o=0;for(let s=i;s<a;++s)r.cell[o++]=e[s]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const i=r.stripIdx-2,a=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let o=0;for(let s=i;s<a;++s)r.cell[o++]=n[s]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function d$(t,e){e.classHierarchy.push("vtkCutter");const n={...t};t.getMTime=()=>{let i=n.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function r(i,a){const o=i.getPoints(),s=o.getData(),c=o.getNumberOfPoints(),l=[],f=[],u=[];(!e.cutScalars||e.cutScalars.length<c)&&(e.cutScalars=new Float32Array(c));let g=0,d=0;for(;g<s.length;)e.cutScalars[d++]=e.cutFunction.evaluateFunction(s[g++],s[g++],s[g++]);const h=[],p=new Array(3),m=new Array(3),v=[];for(const C=g$(i);!C.done;C.next()){if(C.cellSize<=2)continue;for(let E=0;E<C.cellSize;)v[E]=e.cutScalars[C.cell[E++]];const T=v[0]>0;let S=!0;for(let E=1;E<C.cell.length;E++)if(v[E]>0!==T){S=!1;break}if(S)continue;const x=[];for(let E=0;E<C.cellSize;E++){const M=E+1===C.cellSize?0:E+1,O=v[E]>0;if(v[M]>0===O)continue;let _=E,P=M,N=v[P]-v[_];N<=0&&(_=M,P=E,N*=-1);let W=0;N!==0&&(W=(e.cutValue-v[_])/N);const U=C.cell[_],K=C.cell[P];p[0]=s[U*3],p[1]=s[U*3+1],p[2]=s[U*3+2],m[0]=s[K*3],m[1]=s[K*3+1],m[2]=s[K*3+2];const A=[p[0]+W*(m[0]-p[0]),p[1]+W*(m[1]-p[1]),p[2]+W*(m[2]-p[2])];x.push({pointEdge1:U,pointEdge2:K,intersectedPoint:A,newPointID:-1})}for(let E=0;E<x.length;E++){const M=x[E];let O=!1;for(let R=0;R<h.length;R++){const _=h[R],P=M.pointEdge1===_.pointEdge1&&M.pointEdge2===_.pointEdge2,N=M.intersectedPoint[0]===_.intersectedPoint[0]&&M.intersectedPoint[1]===_.intersectedPoint[1]&&M.intersectedPoint[2]===_.intersectedPoint[2];if(P||N){O=!0,x[E].newPointID=h[R].newPointID;break}}O||(l.push(M.intersectedPoint[0]),l.push(M.intersectedPoint[1]),l.push(M.intersectedPoint[2]),x[E].newPointID=l.length/3-1,h.push(x[E]))}const w=x.length;w===2?f.push(w,x[0].newPointID,x[1].newPointID):w>2&&(u.push(w),x.forEach(E=>{u.push(E.newPointID)}))}a.getPoints().setData(Bg(o.getDataType(),l),3),f.length!==0&&a.getLines().setData(Uint16Array.from(f)),u.length!==0&&a.getPolys().setData(Uint16Array.from(u))}t.requestData=(i,a)=>{const o=i[0];if(!o){Cv("Invalid or missing input");return}if(!e.cutFunction){Cv("Missing cut function");return}const s=Bn.newInstance();r(o,s),a[0]=s}}const p$={cutFunction:null,cutScalars:null,cutValue:0};function Tw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,p$,n),je(t,e),g3(t,e,1,1),Ot(t,e,["cutFunction","cutValue"]),d$(t,e)}const h$=be(Tw,"vtkCutter");var m$={newInstance:h$,extend:Tw};const v$=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],y$=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function C$(t,e){e.classHierarchy.push("vtkCubeSource");function n(r,i){if(e.deleted)return;const a=Bn.newInstance();i[0]=a;const o=24,s=D.newTypedArray(e.pointType,o*3);a.getPoints().setData(s,3);const c=D.newTypedArray(e.pointType,o*3),l=he.newInstance({name:"Normals",values:c,numberOfComponents:3});a.getPointData().setNormals(l);let f=2;e.generate3DTextureCoordinates===!0&&(f=3);const u=D.newTypedArray(e.pointType,o*f),g=he.newInstance({name:"TextureCoordinates",values:u,numberOfComponents:f});a.getPointData().setTCoords(g);const d=[0,0,0],h=[0,0,0],p=[0,0];let m=0;d[0]=-e.xLength/2,h[0]=-1,h[1]=0,h[2]=0;for(let v=0;v<2;v++){d[1]=-e.yLength/2;for(let y=0;y<2;y++){p[1]=d[1]+.5,d[2]=-e.zLength/2;for(let C=0;C<2;C++)p[0]=(d[2]+.5)*(1-2*v),s[m*3]=d[0],s[m*3+1]=d[1],s[m*3+2]=d[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=p[0],u[m*f+1]=p[1]):(u[m*f]=2*v-1,u[m*f+1]=2*y-1,u[m*f+2]=2*C-1),m++,d[2]+=e.zLength;d[1]+=e.yLength}d[0]+=e.xLength,h[0]+=2}d[1]=-e.yLength/2,h[1]=-1,h[0]=0,h[2]=0;for(let v=0;v<2;v++){d[0]=-e.xLength/2;for(let y=0;y<2;y++){p[0]=(d[0]+.5)*(2*v-1),d[2]=-e.zLength/2;for(let C=0;C<2;C++)p[1]=(d[2]+.5)*-1,s[m*3]=d[0],s[m*3+1]=d[1],s[m*3+2]=d[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=p[0],u[m*f+1]=p[1]):(u[m*f]=2*y-1,u[m*f+1]=2*v-1,u[m*f+2]=2*C-1),m++,d[2]+=e.zLength;d[0]+=e.xLength}d[1]+=e.yLength,h[1]+=2}d[2]=-e.zLength/2,h[2]=-1,h[0]=0,h[1]=0;for(let v=0;v<2;v++){d[1]=-e.yLength/2;for(let y=0;y<2;y++){p[1]=d[1]+.5,d[0]=-e.xLength/2;for(let C=0;C<2;C++)p[0]=(d[0]+.5)*(2*v-1),s[m*3]=d[0],s[m*3+1]=d[1],s[m*3+2]=d[2],c[m*3]=h[0],c[m*3+1]=h[1],c[m*3+2]=h[2],f===2?(u[m*f]=p[0],u[m*f+1]=p[1]):(u[m*f]=2*C-1,u[m*f+1]=2*y-1,u[m*f+2]=2*v-1),m++,d[0]+=e.xLength;d[1]+=e.yLength}d[2]+=e.zLength,h[2]+=2}if(e.rotations&&go.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(s).apply(c),e.center&&go.buildFromRadian().translate(...e.center).apply(s),e.matrix){go.buildFromRadian().setMatrix(e.matrix).apply(s);const v=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];go.buildFromRadian().setMatrix(v).apply(c)}e.generateFaces?a.getPolys().deepCopy(e._polys):a.getPolys().initialize(),e.generateLines?(a.getLines().deepCopy(e._lineCells),a.getPointData().setNormals(null)):a.getLines().initialize(),a.modified()}t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let i=0;i<arguments.length;i++)r.push(i<0||arguments.length<=i?void 0:arguments[i]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))},t.requestData=n}const T$={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function Sw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,T$,n),D.obj(t,e),D.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),D.setGetArray(t,e,["center","rotations"],3),D.setGetArray(t,e,["matrix"],16),e._polys=Po.newInstance({values:Uint16Array.from(y$)}),e._lineCells=Po.newInstance({values:Uint16Array.from(v$)}),D.moveToProtected(t,e,["polys","lineCells"]),D.algo(t,e,0,1),C$(t,e)}const S$=D.newInstance(Sw,"vtkCubeSource");var x$={newInstance:S$,extend:Sw};const{vtkErrorMacro:Tv}=D;function w$(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const n={...t};t.requestData=(r,i)=>{const a=r[0];if(!a||!a.isA("vtkImageData")){Tv("Invalid or missing input");return}const o=a.getSpatialExtent();if(!o){Tv("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(o),e._cubeSource.setMatrix(a.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(n.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const E$={};function xw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,E$,n),D.obj(t,e),D.algo(t,e,1,1),e._cubeSource=x$.newInstance(),D.moveToProtected(t,e,["cubeSource","tmpOut"]),w$(t,e)}const O$=D.newInstance(xw,"vtkImageDataOutlineFilter");var D$={newInstance:O$,extend:xw};let rm;function R$(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(n,r)=>(Ee(r,n,e.matrix),r),t.transformPoints=(n,r)=>{const i=new Float64Array(3),a=new Float64Array(3);for(let o=0;o<n.length;o+=3)i[0]=n[o],i[1]=n[o+1],i[2]=n[o+2],Ee(a,i,e.matrix),r[o]=a[0],r[o+1]=a[1],r[o+2]=a[2];return r},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(n,r)=>(e.preMultiplyFlag?De(r,e.matrix,n):De(r,n,e.matrix),r),t.transformMatrices=(n,r)=>{const i=new Float64Array(16),a=new Float64Array(16),o=e.preMultiplyFlag?()=>De(a,e.matrix,i):()=>De(a,i,e.matrix);for(let s=0;s<n.length;s+=16){for(let c=0;c<16;++c)i[c]=n[s+c];o();for(let c=0;c<16;++c)r[s+c]=a[c]}return r},t.getInverse=()=>rm({matrix:Dr.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag})}const M$={preMultiplyFlag:!1,matrix:[...x3]};function ww(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,M$,n),D.obj(t,e),D.setGet(t,e,["preMultiplyFlag"]),D.setGetArray(t,e,["matrix"],16),R$(t,e)}rm=D.newInstance(ww,"vtkTransform");var L$={newInstance:rm,extend:ww},I$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,V$=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:Wa}=cn;function Sv(t,e,n){return e.identity(n),t.reduce((r,i,a)=>a===0?i?e.copy(r,i):e.identity(r):i?e.multiply(r,r,i):r,n)}function _$(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");function n(i){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=i=>{if(i){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const a=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera());const o=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),o&&!o.isDeleted()&&o!==e._openGLRenderWindow&&n(o),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(i,a)=>{i&&(e.currentRenderPass=a,t.render())},t.zBufferPass=i=>{i&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=i=>t.zBufferPass(i),t.opaquePass=i=>{i&&t.render()},t.getCoincidentParameters=(i,a)=>e.renderable.getResolveCoincidentTopology()==Pr.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const i=e._openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){Wa("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(i,a)=>{t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===To.NEAREST?(e.openGLTexture.setMinificationFilter(oe.NEAREST),e.openGLTexture.setMagnificationFilter(oe.NEAREST),e.colorTexture.setMinificationFilter(oe.NEAREST),e.colorTexture.setMagnificationFilter(oe.NEAREST),e.pwfTexture.setMinificationFilter(oe.NEAREST),e.pwfTexture.setMagnificationFilter(oe.NEAREST)):(e.openGLTexture.setMinificationFilter(oe.LINEAR),e.openGLTexture.setMagnificationFilter(oe.LINEAR),e.colorTexture.setMinificationFilter(oe.LINEAR),e.colorTexture.setMagnificationFilter(oe.LINEAR),e.pwfTexture.setMinificationFilter(oe.LINEAR),e.pwfTexture.setMagnificationFilter(oe.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(i,a)=>{const o=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,i,a),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(i,a)=>{},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>{var o,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||!((o=e.openGLTexture)!=null&&o.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,a)=>{var w,E,M,O;const o=e.currentInput;if(!o)return;const s=(w=o.getPointData())==null?void 0:w.getScalars();if(!s)return;const c=s.getNumberOfComponents();let l=j3(o,s);const f=e._openGLRenderWindow.getGraphicsResourceForObject(s);if(!((E=f==null?void 0:f.oglObject)!=null&&E.getHandle())||(f==null?void 0:f.hash)!==l){e.openGLTexture=Je.newInstance(),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const R=o.getDimensions();e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create3DFilterableFromDataArray(R[0],R[1],R[2],s),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.openGLTexture,l),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.openGLTexture=f.oglObject;const g=a.getProperty(),d=g.getIndependentComponents(),h=d?c:1,p=d?2*h:1,m=g.getRGBTransferFunction();l=ni(m,d,h);const v=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((M=v==null?void 0:v.oglObject)!=null&&M.getHandle())||(v==null?void 0:v.hash)!==l){const _=1024*p*3,P=new Uint8ClampedArray(_);if(e.colorTexture=Je.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const N=new Float32Array(3072);for(let W=0;W<h;W++){const U=g.getRGBTransferFunction(W),K=U.getRange();if(U.getTable(K[0],K[1],1024,N,1),d)for(let A=0;A<1024*3;A++)P[W*1024*6+A]=255*N[A],P[W*1024*6+A+1024*3]=255*N[A];else for(let A=0;A<1024*3;A++)P[W*1024*6+A]=255*N[A]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,p,3,Se.UNSIGNED_CHAR,P)}else{for(let N=0;N<1024*3;++N)P[N]=255*N/(1023*3),P[N+1]=255*N/(1023*3),P[N+2]=255*N/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,Se.UNSIGNED_CHAR,P)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,l),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=v.oglObject;const C=g.getPiecewiseFunction();l=ni(C,d,h);const T=e._openGLRenderWindow.getGraphicsResourceForObject(C);if(!((O=T==null?void 0:T.oglObject)!=null&&O.getHandle())||(T==null?void 0:T.hash)!==l){const _=1024*p,P=new Uint8ClampedArray(_);if(e.pwfTexture=Je.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),C){const N=new Float32Array(_),W=new Float32Array(1024);for(let U=0;U<h;++U){const K=g.getPiecewiseFunction(U);if(K===null)N.fill(1);else{const A=K.getRange();if(K.getTable(A[0],A[1],1024,W,1),d)for(let b=0;b<1024;b++)N[U*1024*2+b]=W[b],N[U*1024*2+b+1024]=W[b];else for(let b=0;b<1024;b++)N[U*1024*2+b]=W[b]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,p,1,Se.FLOAT,N)}else P.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,Se.UNSIGNED_CHAR,P);C&&(e._openGLRenderWindow.setGraphicsResourceForObject(C,e.pwfTexture,l),C!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(C,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=C)}else e.pwfTexture=T.oglObject;const x=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==x){const R=he.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});R.setName("points");const _=he.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),P={points:R,cellOffset:0};if(e.renderable.getSlabThickness()>0){const N=e.resliceGeom.getPointData().getNormals();N?P.normals=N:Wa("Slab mode requested without normals")}e.tris.getCABO().createVBO(_,"polys",an.SURFACE,P)}e.VBOBuildString=x,e.VBOBuildTime.modified()},t.updateShaders=(i,a,o)=>{if(e.lastBoundBO=i,t.getNeedToRebuildShaders(i,a,o)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,a,o);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,o),t.setCameraShaderParameters(i,a,o),t.setPropertyShaderParameters(i,a,o)},t.setMapperShaderParameters=(i,a,o)=>{const s=i.getProgram();if(i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())){s.isUniformUsed("texture1")&&s.setUniformi("texture1",e.openGLTexture.getTextureUnit()),s.isAttributeUsed("vertexWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexWC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Wa("Error setting vertexWC in shader VAO.")),s.isAttributeUsed("normalWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"normalWC",i.getCABO().getNormalOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Wa("Error setting normalWC in shader VAO.")),s.isUniformUsed("slabThickness")&&s.setUniformf("slabThickness",e.renderable.getSlabThickness()),s.isUniformUsed("spacing")&&s.setUniform3fv("spacing",e.currentInput.getSpacing()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabTrapezoid")&&s.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const l=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null;if(s.isUniformUsed("WCTCMatrix")){const f=e.currentInput,u=f.getDimensions();it(e.tmpMat4,f.getIndexToWorld()),nt(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),Vi(e.tmpMat4,e.tmpMat4,u),xt(e.tmpMat4,e.tmpMat4),l&&De(e.tmpMat4,e.tmpMat4,l),s.setUniformMatrix("WCTCMatrix",e.tmpMat4)}s.isUniformUsed("vboScaling")&&s.setUniform3fv("vboScaling",i.getCABO().getCoordScale()??[1,1,1]),i.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&i.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),i.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,o);i.getProgram().setUniformf("coffset",c.offset),i.getProgram().isUniformUsed("cfactor")&&i.getProgram().setUniformf("cfactor",c.factor)}},t.setCameraShaderParameters=(i,a,o)=>{const s=e._openGLCamera.getKeyMatrices(a),c=e._openGLImageSlice.getKeyMatrices(),f=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null,u=i.getProgram();u.isUniformUsed("MCPCMatrix")&&(ie(e.tmpMat4),u.setUniformMatrix("MCPCMatrix",Sv([s.wcpc,c.mcwc,f],gl,e.tmpMat4))),u.isUniformUsed("MCVCMatrix")&&(ie(e.tmpMat4),u.setUniformMatrix("MCVCMatrix",Sv([s.wcvc,c.mcwc,f],gl,e.tmpMat4)))},t.setPropertyShaderParameters=(i,a,o)=>{const s=i.getProgram(),c=o.getProperty(),l=c.getOpacity();s.setUniformf("opacity",l);const f=e.openGLTexture.getComponents(),u=c.getIndependentComponents();if(u)for(let p=0;p<f;++p)s.setUniformf(`mix${p}`,c.getComponentWeight(p));const g=e.openGLTexture.getVolumeInfo();for(let p=0;p<f;p++){let m=c.getColorWindow(),v=c.getColorLevel();const y=u?p:0,C=c.getRGBTransferFunction(y);if(C&&c.getUseLookupTableScalarRange()){const x=C.getRange();m=x[1]-x[0],v=.5*(x[1]+x[0])}const T=g.scale[p]/m,S=(g.offset[p]-v)/m+.5;s.setUniformf(`cshift${p}`,S),s.setUniformf(`cscale${p}`,T)}const d=e.colorTexture.getTextureUnit();s.setUniformi("colorTexture1",d);for(let p=0;p<f;p++){let m=1,v=0;const y=u?p:0,C=c.getPiecewiseFunction(y);if(C){const T=C.getRange(),S=T[1]-T[0],x=.5*(T[0]+T[1]);m=g.scale[p]/S,v=(g.offset[p]-x)/S+.5}s.setUniformf(`pwfshift${p}`,v),s.setUniformf(`pwfscale${p}`,m)}const h=e.pwfTexture.getTextureUnit();s.setUniformi("pwfTexture1",h),s.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(i,a,o)=>{var d;const s=e.openGLTexture.getComponents(),c=o.getProperty().getIndependentComponents(),l=e.renderable.getSlabThickness(),f=e.renderable.getSlabType(),u=e.renderable.getSlabTrapezoidIntegration();let g=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(g=!0),g||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((d=i.getProgram())==null?void 0:d.getHandle())===0||e.lastTextureComponents!==s||e.lastIndependentComponents!==c||e.lastSlabThickness!==l||e.lastSlabType!==f||e.lastSlabTrapezoidIntegration!==u?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=c,e.lastSlabThickness=l,e.lastSlabType=f,e.lastSlabTrapezoidIntegration=u,!0):!1},t.getShaderTemplate=(i,a,o)=>{i.Vertex=I$,i.Fragment=V$,i.Geometry=""},t.replaceShaderValues=(i,a,o)=>{if(t.replaceShaderTCoord(i,a,o),t.replaceShaderPositionVC(i,a,o),e.haveSeenDepthRequest){let s=i.Fragment;s=k.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=k.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,i.Fragment=s}t.replaceShaderCoincidentOffset(i,a,o)},t.replaceShaderTCoord=(i,a,o)=>{let s=i.Vertex;const c=i.Geometry;let l=i.Fragment;const f=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],u=e.renderable.getSlabThickness();s=k.substitute(s,"//VTK::TCoord::Dec",f).result;const g=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];s=k.substitute(s,"//VTK::TCoord::Impl",g).result;const d=e.openGLTexture.getComponents(),h=o.getProperty().getIndependentComponents();let p=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(h){for(let v=1;v<d;v++)p=p.concat([`uniform float cshift${v};`,`uniform float cscale${v};`,`uniform float pwfshift${v};`,`uniform float pwfscale${v};`]);switch(d){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Wa("Unsupported number of independent coordinates.")}}u>0&&(p=p.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),p=p.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),l=k.substitute(l,"//VTK::TCoord::Dec",p).result;let m=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(u>0&&(m=m.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),h){const v=["r","g","b","a"];for(let y=0;y<d;++y)m=m.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${v[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${v[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(d){case 1:m=m.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:m=m.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Wa("Unsupported number of independent coordinates.")}}else switch(d){case 1:m=m.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:m=m.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}l=k.substitute(l,"//VTK::TCoord::Impl",m).result,i.Vertex=s,i.Fragment=l,i.Geometry=c},t.replaceShaderPositionVC=(i,a,o)=>{let s=i.Vertex;const c=i.Geometry;let l=i.Fragment;const f=e.renderable.getSlabThickness();let u=["attribute vec4 vertexWC;"];u=u.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),f>0&&(u=u.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),s=k.substitute(s,"//VTK::PositionVC::Dec",u).result;let g=["gl_Position = MCPCMatrix * vertexWC;"];f>0&&(g=g.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),s=k.substitute(s,"//VTK::PositionVC::Impl",g).result,s=k.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let d=[];f>0&&(d=d.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),l=k.substitute(l,"//VTK::PositionVC::Dec",d).result,i.Vertex=s,i.Geometry=c,i.Fragment=l};function r(i){Dr.normalize(i);const a=[0,0,0];for(let o=0;o<3;++o){jV(a),a[o]=1;const s=Dr.dot(i,a);if(s<-.999||s>.999)return[!0,o]}return[!1,2]}t.updateResliceGeometry=()=>{var u;let i="";const a=e.currentInput,o=a==null?void 0:a.getBounds();let s=!0,c=2;const l=e.renderable.getSlicePolyData(),f=e.renderable.getSlicePlane();if(l)i=i.concat(`PolyData${l.getMTime()}`);else if(f){i=i.concat(`Plane${f.getMTime()}`);const g=Z5();a&&(i=i.concat(`Image${a.getMTime()}`),Z7(g,...a.getDirection()),Ul(g,g));const d=[...f.getNormal()];Df(d,d,g),[s,c]=r(d)}else{const g=hn.newInstance();g.setNormal(0,0,1);let d=[0,1,0,1,0,1];a&&(d=o),g.setOrigin(d[0],d[2],.5*(d[5]+d[4])),e.renderable.setSlicePlane(g),i=i.concat(`Plane${f==null?void 0:f.getMTime()}`),a&&(i=i.concat(`Image${a.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==i){if(l)e.resliceGeom||(e.resliceGeom=Bn.newInstance()),e.resliceGeom.getPoints().setData(l.getPoints().getData(),3),e.resliceGeom.getPolys().setData(l.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(l.getPointData().getNormals());else if(f)if(s){const g=new Float32Array(12),d=a.worldToIndex(f.getOrigin(),[0,0,0]),h=[(c+1)%3,(c+2)%3].sort(),p=a.getSpatialExtent();let m=0;for(let S=0;S<2;++S)for(let x=0;x<2;++x)g[m+c]=d[c],g[m+h[0]]=p[2*h[0]+x],g[m+h[1]]=p[2*h[1]+S],m+=3;e.transform.setMatrix(a.getIndexToWorld()),e.transform.transformPoints(g,g);const v=new Uint16Array(8);v[0]=3,v[1]=0,v[2]=1,v[3]=3,v[4]=3,v[5]=0,v[6]=3,v[7]=2;const y=f.getNormal();Dr.normalize(y);const C=new Float32Array(12);for(let S=0;S<4;++S)C[3*S]=y[0],C[3*S+1]=y[1],C[3*S+2]=y[2];e.resliceGeom||(e.resliceGeom=Bn.newInstance()),e.resliceGeom.getPoints().setData(g,3),e.resliceGeom.getPolys().setData(v,1);const T=he.newInstance({numberOfComponents:3,values:C,name:"Normals"});e.resliceGeom.getPointData().setNormals(T)}else{e.outlineFilter.setInputData(a),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(f),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=Bn.newInstance());const g=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(g.getPoints().getData(),3),e.resliceGeom.getPolys().setData(g.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(g.getPointData().getNormals());const d=f.getNormal(),h=e.resliceGeom.getNumberOfPoints();Dr.normalize(d);const p=new Float32Array(h*3);for(let v=0;v<h;++v)p[3*v]=d[0],p[3*v+1]=d[1],p[3*v+2]=d[2];const m=he.newInstance({numberOfComponents:3,values:p,name:"Normals"});e.resliceGeom.getPointData().setNormals(m)}else Wa("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=i,(u=e.resliceGeom)==null||u.modified()}},t.setOpenGLTexture=i=>{i&&(e.openGLTexture=i,e._externalOpenGLTexture=!0)},t.delete=Wl(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const b$={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1};function N$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,b$,n),ze.extend(t,e,n),ti.implementReplaceShaderCoincidentOffset(t,e,n),ti.implementBuildShadersWithReplacements(t,e,n),e.tris=ri.newInstance(),e.openGLTexture=null,e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},je(e.VBOBuildTime),e.tmpMat4=ie(new Float64Array(16)),e.outlineFilter=D$.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=Bn.newInstance(),e.cutter=m$.newInstance(),e.lineToSurfaceFilter=f$.newInstance(),e.transform=L$.newInstance(),In(t,e,["openGLTexture"]),_$(t,e)}const P$=be(N$,"vtkOpenGLImageResliceMapper");Nt("vtkImageResliceMapper",P$);const $a={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:Gu}=D;function k$(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function n(r){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()===Pr.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.renderPiece=(r,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i)},t.renderPieceDraw=(r,i)=>{const a=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),i.getProperty().getInterpolationType()===To.NEAREST?(e.volumeTexture.setMinificationFilter(oe.NEAREST),e.volumeTexture.setMagnificationFilter(oe.NEAREST),e.colorTexture.setMinificationFilter(oe.NEAREST),e.colorTexture.setMagnificationFilter(oe.NEAREST),e.pwfTexture.setMinificationFilter(oe.NEAREST),e.pwfTexture.setMagnificationFilter(oe.NEAREST)):(e.volumeTexture.setMinificationFilter(oe.LINEAR),e.volumeTexture.setMagnificationFilter(oe.LINEAR),e.colorTexture.setMinificationFilter(oe.LINEAR),e.colorTexture.setMagnificationFilter(oe.LINEAR),e.pwfTexture.setMinificationFilter(oe.LINEAR),e.pwfTexture.setMagnificationFilter(oe.LINEAR))},t.getNeedToRebuildBufferObjects=(r,i)=>{var o;const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentImageDataInput.getMTime()||a<e.currentCenterlineInput.getMTime()||!((o=e.volumeTexture)!=null&&o.getHandle())},t.buildBufferObjects=(r,i)=>{var E,M,O,R;const a=e.currentImageDataInput,o=e.currentCenterlineInput,s=(E=a==null?void 0:a.getPointData())==null?void 0:E.getScalars();if(!s)return;const c=e._openGLRenderWindow.getGraphicsResourceForObject(s),l=j3(a,s);if(!((M=c==null?void 0:c.oglObject)!=null&&M.getHandle())||(c==null?void 0:c.hash)!==l){e.volumeTexture=Je.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const _=a.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray(_[0],_[1],_[2],s,e.renderable.getPreferSizeOverAccuracy()),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.volumeTexture,l),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.volumeTexture=c.oglObject;const u=s.getNumberOfComponents(),g=i.getProperty(),d=g.getIndependentComponents(),h=d?u:1,p=d?2*h:1,m=g.getRGBTransferFunction(),v=ni(m,d,h),y=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((O=y==null?void 0:y.oglObject)!=null&&O.getHandle())||(y==null?void 0:y.hash)!==v){const P=1024*p*3,N=new Uint8ClampedArray(P);if(e.colorTexture=Je.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const W=new Float32Array(3072);for(let U=0;U<h;U++){const K=g.getRGBTransferFunction(U),A=K.getRange();if(K.getTable(A[0],A[1],1024,W,1),d)for(let b=0;b<1024*3;b++)N[U*1024*6+b]=255*W[b],N[U*1024*6+b+1024*3]=255*W[b];else for(let b=0;b<1024*3;b++)N[U*1024*6+b]=255*W[b]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,p,3,Se.UNSIGNED_CHAR,N)}else{for(let W=0;W<1024*3;++W)N[W]=255*W/(1023*3),N[W+1]=255*W/(1023*3),N[W+2]=255*W/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,Se.UNSIGNED_CHAR,N)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,v),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=y.oglObject;const T=g.getPiecewiseFunction(),S=ni(T,d,h),x=e._openGLRenderWindow.getGraphicsResourceForObject(T);if(!((R=x==null?void 0:x.oglObject)!=null&&R.getHandle())||(x==null?void 0:x.hash)!==S){const P=1024*p,N=new Uint8ClampedArray(P);if(e.pwfTexture=Je.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),T){const W=new Float32Array(P),U=new Float32Array(1024);for(let K=0;K<h;++K){const A=g.getPiecewiseFunction(K);if(A===null)W.fill(1);else{const b=A.getRange();if(A.getTable(b[0],b[1],1024,U,1),d)for(let F=0;F<1024;F++)W[K*1024*2+F]=U[F],W[K*1024*2+F+1024]=U[F];else for(let F=0;F<1024;F++)W[K*1024*2+F]=U[F]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,p,1,Se.FLOAT,W)}else N.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,Se.UNSIGNED_CHAR,N);T&&(e._openGLRenderWindow.setGraphicsResourceForObject(T,e.pwfTexture,S),T!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(T,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=T)}else e.pwfTexture=x.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<o.getMTime()){const _=o.getNumberOfPoints(),P=_<=1?0:_-1,N=o.getDistancesToFirstPoint(),W=e.renderable.getHeight(),U=4*P,K=new Float32Array(3*U),A=e.renderable.getWidth();for(let me=0,Ce=0;me<P;++me)K.set([0,W-N[me],0],Ce),Ce+=3,K.set([A,W-N[me],0],Ce),Ce+=3,K.set([A,W-N[me+1],0],Ce),Ce+=3,K.set([0,W-N[me+1],0],Ce),Ce+=3;const b=he.newInstance({numberOfComponents:3,values:K});b.setName("points");const F=new Uint16Array(5*P);for(let me=0,Ce=0,Yt=0;me<P;++me)F.set([4,Yt+3,Yt+2,Yt+1,Yt],Ce),Ce+=5,Yt+=4;const $=he.newInstance({numberOfComponents:1,values:F}),j=o.getPoints(),z=new Float32Array(3*U),ge=new Array(3),Pt=new Array(3);for(let me=0,Ce=0;me<P;++me)j.getPoint(me,ge),j.getPoint(me+1,Pt),z.set(ge,Ce),Ce+=3,z.set(ge,Ce),Ce+=3,z.set(Pt,Ce),Ce+=3,z.set(Pt,Ce),Ce+=3;const Ae=he.newInstance({numberOfComponents:3,values:z,name:"centerlinePosition"}),Dt=new Float32Array(U);for(let me=0,Ce=0;me<P;++me)Dt.set([0,1,3,2],Ce),Ce+=4;const Ge=he.newInstance({numberOfComponents:1,values:Dt,name:"quadIndex"}),ot=[Ae,Ge];if(!e.renderable.getUseUniformOrientation()){const me=e.renderable.getOrientedCenterline().getOrientations()??[],Ce=new Float32Array(4*U),Yt=new Float32Array(4*U);for(let Ur=0;Ur<P;++Ur){const _d=me[Ur],bd=me[Ur+1];for(let Fa=0;Fa<4;++Fa){const W0=4*(Fa+4*Ur);Ce.set(_d,W0),Yt.set(bd,W0)}}const ka=he.newInstance({numberOfComponents:4,values:Ce,name:"centerlineTopOrientation"}),Vd=he.newInstance({numberOfComponents:4,values:Yt,name:"centerlineBotOrientation"});ot.push(ka,Vd)}e.tris.getCABO().createVBO($,"polys",an.SURFACE,{points:b,customAttributes:ot}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(r,i,a)=>{const o=e.volumeTexture.getComponents(),s=a.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),f=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return r.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==f||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==o||e.lastIndependentComponents!==s?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=f,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=s,!0):!1},t.buildShaders=(r,i,a)=>{t.getShaderTemplate(r,i,a),t.replaceShaderValues(r,i,a)},t.replaceShaderValues=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];o=k.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,o=k.substitute(o,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],f=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),f&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),o=k.substitute(o,"//VTK::Color::Dec",l).result;const g=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(g.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),f&&g.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):g.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),o=k.substitute(o,"//VTK::Color::Impl",g).result;const d=e.volumeTexture.getComponents(),h=a.getProperty().getIndependentComponents();let p=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];f&&p.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(p.push("in vec3 samplingDirVSOutput;"),f&&p.push("in vec3 projectionDirVSOutput;")):(p.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),f&&p.push("uniform vec3 bitangentDirection;"));const m=e.renderable.getCenterPoint();if(m&&p.push("uniform vec3 globalCenterPoint;"),h){for(let y=1;y<d;y++)p=p.concat([`uniform float cshift${y};`,`uniform float cscale${y};`,`uniform float pwfshift${y};`,`uniform float pwfscale${y};`]);switch(d){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Gu("Unsupported number of independent coordinates.")}}s=k.substitute(s,"//VTK::TCoord::Dec",p).result;let v=[];if(u?(v.push("vec3 samplingDirection = samplingDirVSOutput;"),f&&v.push("vec3 projectionDirection = projectionDirVSOutput;")):(v.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),f&&v.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),m?v.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):v.push("float horizontalOffset = quadOffsetVSOutput.x;"),v.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),f){const y=e.renderable.getProjectionMode();switch(y){case $a.MIN:v.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case $a.MAX:case $a.AVERAGE:default:v.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(v.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),y){case $a.MAX:v.push("  tvalue = max(tvalue, sampledTextureValue);");break;case $a.MIN:v.push("  tvalue = min(tvalue, sampledTextureValue);");break;case $a.AVERAGE:default:v.push("  tvalue = tvalue + sampledTextureValue;");break}v.push("}"),y===$a.AVERAGE&&v.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else v.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(h){const y=["r","g","b","a"];for(let C=0;C<d;++C)v=v.concat([`vec3 tcolor${C} = mix${C} * texture2D(colorTexture1, vec2(tvalue.${y[C]} * cscale${C} + cshift${C}, height${C})).rgb;`,`float compWeight${C} = mix${C} * texture2D(pwfTexture1, vec2(tvalue.${y[C]} * pwfscale${C} + pwfshift${C}, height${C})).r;`]);switch(d){case 1:v=v.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:v=v.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Gu("Unsupported number of independent coordinates.")}}else switch(d){case 1:v=v.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:v=v.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}s=k.substitute(s,"//VTK::TCoord::Impl",v).result,e.haveSeenDepthRequest&&(s=k.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=k.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=o,r.Fragment=s,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let o=r.Vertex,s=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(D.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),o=k.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,o=k.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=k.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=k.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=o,r.Fragment=s},t.getShaderTemplate=(r,i,a)=>{r.Vertex=H3,r.Fragment=Kl,r.Geometry=""},t.setMapperShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=r.getCABO();s.getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(o,s,"vertexMC",s.getVertexOffset(),s.getStride(),e.context.FLOAT,3,e.context.FALSE)||Gu("Error setting vertexMC in shader VAO.")),r.getCABO().getCustomData().forEach(d=>{d&&o.isAttributeUsed(d.name)&&!r.getVAO().addAttributeArray(o,s,d.name,d.offset,s.getStride(),e.context.FLOAT,d.components,e.context.FALSE)&&Gu(`Error setting ${d.name} in shader VAO.`)}),r.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(o.setUniformi("volumeTexture",c),o.setUniformf("width",e.renderable.getWidth()),r.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),o.isUniformUsed("tangentDirection")){const d=e.renderable.getTangentDirection();r.getProgram().setUniform3fArray("tangentDirection",d)}if(o.isUniformUsed("bitangentDirection")){const d=e.renderable.getBitangentDirection();r.getProgram().setUniform3fArray("bitangentDirection",d)}if(o.isUniformUsed("centerlineOrientation")){const d=e.renderable.getUniformOrientation();r.getProgram().setUniform4fv("centerlineOrientation",d)}if(o.isUniformUsed("globalCenterPoint")){const d=e.renderable.getCenterPoint();o.setUniform3fArray("globalCenterPoint",d)}if(e.renderable.isProjectionEnabled()){const d=e.currentImageDataInput,h=d.getSpacing(),p=d.getDimensions(),m=e.renderable.getProjectionSlabThickness(),v=e.renderable.getProjectionSlabNumberOfSamples(),y=KV([],h,p);o.setUniform3fArray("volumeSizeMC",y),o.setUniformi("projectionSlabNumberOfSamples",v);const C=-.5*m;o.setUniformf("projectionConstantOffset",C);const T=m/(v-1);o.setUniformf("projectionStepLength",T)}const l=e.currentImageDataInput,f=l.getWorldToIndex(),u=n3(new Float32Array(16),sC([],l.getDimensions())),g=O1(u,u,f);if(o.setUniformMatrix("MCTCMatrix",g),e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let d=e.renderable.getNumberOfClippingPlanes();d>6&&(D.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),d=6);const p=s.getCoordShiftAndScaleEnabled()?s.getInverseShiftAndScaleMatrix():null,m=p?it(e.imagematinv,a.getMatrix()):a.getMatrix();p&&(xe(m,m),De(m,m,p),xe(m,m)),xe(e.imagemat,e.currentImageDataInput.getIndexToWorld()),De(e.imagematinv,m,e.imagemat);const v=[];for(let y=0;y<d;y++){const C=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,y,C);for(let T=0;T<4;T++)v.push(C[T])}o.setUniformi("numClipPlanes",d),o.setUniform4fv("clipPlanes",v)}if(o.isUniformUsed("coffset")){const d=t.getCoincidentParameters(i,a);o.setUniformf("coffset",d.offset),o.isUniformUsed("cfactor")&&o.setUniformf("cfactor",d.factor)}},t.setCameraShaderParameters=(r,i,a)=>{const o=e.openGLImageSlice.getKeyMatrices().mcwc,s=e.openGLCamera.getKeyMatrices(i).wcpc;if(De(e.imagemat,s,o),r.getCABO().getCoordShiftAndScaleEnabled()){const c=r.getCABO().getInverseShiftAndScaleMatrix();De(e.imagemat,e.imagemat,c)}r.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(r,i,a)=>{const o=r.getProgram(),s=a.getProperty(),c=s.getOpacity();o.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),f=s.getIndependentComponents();if(f)for(let h=0;h<l;++h)o.setUniformf(`mix${h}`,s.getComponentWeight(h));const u=e.volumeTexture.getVolumeInfo();for(let h=0;h<l;h++){let p=s.getColorWindow(),m=s.getColorLevel();const v=f?h:0,y=s.getRGBTransferFunction(v);if(y&&s.getUseLookupTableScalarRange()){const S=y.getRange();p=S[1]-S[0],m=.5*(S[1]+S[0])}const C=u.scale[h]/p,T=(u.offset[h]-m)/p+.5;o.setUniformf(`cshift${h}`,T),o.setUniformf(`cscale${h}`,C)}const g=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",g);for(let h=0;h<l;h++){let p=1,m=0;const v=f?h:0,y=s.getPiecewiseFunction(v);if(y){const C=y.getRange(),T=C[1]-C[0],S=.5*(C[0]+C[1]);p=u.scale[h]/T,m=(u.offset[h]-S)/T+.5}o.setUniformf(`pwfshift${h}`,m),o.setUniformf(`pwfscale${h}`,p)}const d=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",d)},t.updateShaders=(r,i,a)=>{if(t.getNeedToRebuildShaders(r,i,a)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,i,a);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);s!==r.getProgram()&&(r.setProgram(s),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.delete=D.chain(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const F$={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function U$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,F$,n),ze.extend(t,e,n),ti.implementReplaceShaderCoincidentOffset(t,e,n),D.algo(t,e,2,0),e.tris=ri.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=ie(new Float64Array(16)),e.imagematinv=ie(new Float64Array(16)),e.VBOBuildTime={},D.obj(e.VBOBuildTime,{mtime:0}),k$(t,e)}const A$=D.newInstance(U$,"vtkOpenGLImageCPRMapper");Nt("vtkImageCPRMapper",A$);const Ew=Object.create(null);function hr(t,e){Ew[t]=e}function B$(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const G$={};function W$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,G$,n),e.overrides=Ew,L3.extend(t,e,n),B$(t,e)}D.newInstance(W$,"vtkWebGPUViewNodeFactory");function $$(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,i,a)=>{if(ie(n),e.renderable.getParallelProjection()){const o=e.renderable.getParallelScale(),s=o*r,c=o,l=(a[0]-1)*s,f=(a[0]+1)*s,u=(a[1]-1)*c,g=(a[1]+1)*c,d=1/(f-l),h=1/(g-u);n[0]=2*d,n[5]=2*h,n[10]=1/(i[1]-i[0]),n[12]=(f+l)*d,n[13]=(g+u)*h,n[14]=i[1]/(i[1]-i[0])}else{const o=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,c;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*o,c=i[0]*o/r):(s=i[0]*o*r,c=i[0]*o);const l=(a[0]-1)*s,f=(a[0]+1)*s,u=(a[1]-1)*c,g=(a[1]+1)*c;n[0]=2*i[0]/(f-l),n[5]=2*i[0]/(g-u),n[12]=(l+f)/(f-l),n[13]=(u+g)/(g-u),n[10]=0,n[14]=i[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let i=-r[0]/n;return i=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(i*(r[1]-r[0])),.5*i+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),i=n.getParent();if(Math.max(i.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const a=e.renderable.getViewMatrix();it(e.keyMatrices.normalMatrix,a),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,xt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),xe(e.keyMatrices.wcvc,a);const o=n.getStabilizedCenterByReference();nt(e.keyMatrices.scvc,e.keyMatrices.wcvc,o);const s=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),De(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),xt(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const z$={keyMatrixTime:null,keyMatrices:null};function H$(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,z$,n),ze.extend(t,e,n),e.keyMatrixTime={},D.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},D.setGet(t,e,["keyMatrixTime"]),$$(t,e)}const j$=D.newInstance(H$);hr("vtkCamera",j$);function K$(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==n[i]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupLayoutEntry();a.binding=i,r.push(a)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupTime().getMTime();r=o>r?o:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let a=0;a<e.bindables.length;a++){const o=e.bindables[a].getBindGroupEntry();o.binding=a,i.push(o)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],i=n.getBindGroupLayoutCount(e.label);for(let a=0;a<e.bindables.length;a++)r.push(e.bindables[a].getShaderCode(a,i));return r.join(`
`)}}const q$={device:null,handle:null,label:null};function Ow(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,q$,n),D.obj(t,e),e.bindables=[],e.bindGroupTime={},D.obj(e.bindGroupTime,{mtime:0}),D.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),D.setGet(t,e,["label","device","arrayInformation"]),K$(t,e)}const X$=D.newInstance(Ow);var Dw={newInstance:X$,extend:Ow};function Y$(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const Z$={device:null,handle:null};function Rw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Z$,n),D.obj(t,e),D.get(t,e,["lastCameraMTime"]),D.setGet(t,e,["device","handle"]),Y$(t,e)}const J$=D.newInstance(Rw,"vtkWebGPUShaderModule");var Q$={newInstance:J$,extend:Rw};function ez(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(n)?n.join(`
`):n;let a=!1;t.search(e)!==-1&&(a=!0);let o="";r&&(o="g");const s=new RegExp(e,o),c=t.replace(s,i);return{replace:a,result:c}}function tz(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),i=n.getHash(),a=e._shaderModules.keys();for(let s=0;s<a.length;s++){const c=a[s];if(c.getHash()===i&&c.getType()===r)return e._shaderModules.get(c)}const o=Q$.newInstance();return o.initialize(e.device,n),e._shaderModules.set(n,o),o}}const nz={shaderModules:null,device:null,window:null};function Mw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nz,n),e._shaderModules=new Map,D.obj(t,e),D.setGet(t,e,["device","window"]),tz(t,e)}const rz=D.newInstance(Mw,"vtkWebGPUShaderCache");var $e={newInstance:rz,extend:Mw,substitute:ez};function iz(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const i=[];for(let a=0;a<e.layouts.length;a++)i.push(e.layouts[a].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let a=0;a<e.shaderDescriptions.length;a++){const o=e.shaderDescriptions[a],s=n.getShaderModule(o);o.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),o.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const az={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function Lw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,az,n),je(t,e),e.layouts=[],e.shaderDescriptions=[],In(t,e,["handle","pipelineDescription"]),Ot(t,e,["device","renderEncoder","topology","vertexState"]),iz(t,e)}const oz=be(Lw,"vtkWebGPUPipeline");var sz={newInstance:oz,extend:Lw};function cz(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(i)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const i=[];let a=[];if(r&&i.push(r.getShaderCode()),n||e.builtinInputNames.length){const o=[];if(o.push(`struct ${e.type}Input
{`),n){const s=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),l=n.getOutputInterpolationsByReference();for(let f=0;f<s.length;f++)l[f]!==void 0?o.push(`  @location(${f}) @interpolate(${l[f]}) ${s[f]} : ${c[f]},`):o.push(`  @location(${f}) ${s[f]} : ${c[f]},`)}for(let s=0;s<e.builtinInputNames.length;s++)o.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);o.length>1&&(o.push("};"),a=o,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=$e.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const o=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?o.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):o.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)o.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);o.push("};"),a=a.concat(o),e.code=$e.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=$e.substitute(e.code,"//VTK::IOStructs::Dec",a).result}}const lz={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function Iw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lz,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],D.obj(t,e),D.setGet(t,e,["type","hash","code"]),D.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),cz(t,e)}const uz=D.newInstance(Iw,"vtkWebGPUShaderDescription");var xv={newInstance:uz,extend:Iw};const wv={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function fz(t){return!t||t.length<6?0:t in wv?wv[t]:(Oe(`unknown format ${t}`),null)}function gz(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return Oe(`unknown format ${t}`),0;const i=5-r/2;return e*i}function dz(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function pz(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{Oe(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){Oe(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function hz(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{Oe(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function mz(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function vz(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";Oe(`unknown format ${t}`)}}var nn={getDetailsFromTextureFormat:fz,getByteStrideFromBufferFormat:gz,getNumberOfComponentsFromBufferFormat:dz,getNativeTypeFromBufferFormat:pz,getShaderTypeFromBufferFormat:hz,getByteStrideFromShaderFormat:mz,getNativeTypeFromShaderFormat:vz};function yz(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function Cz(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",a=r;Array.isArray(a)||(a=[a]);for(let o=0;o<e.inputs.length;o++)if(yz(e.inputs[o].names,a)){if(e.inputs[o].buffer===n)return;e.inputs[o].buffer=n;return}e.inputs.push({buffer:n,stepMode:i,names:a}),e.inputs=e.inputs.sort((o,s)=>o.names[0]<s.names[0]?-1:o.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let i=0;i<e.inputs.length;i++)for(let a=0;a<e.inputs[i].names.length;a++){const o=e.inputs[i].buffer.getArrayInformation()[a],s=nn.getShaderTypeFromBufferFormat(o.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[i].names[a]} : ${s}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let i=0;for(let a=0;a<e.inputs.length;a++){const o=e.inputs[a].buffer,s={arrayStride:o.getStrideInBytes(),stepMode:e.inputs[a].stepMode,attributes:[]},c=o.getArrayInformation();for(let l=0;l<e.inputs[a].names.length;l++)s.attributes.push({shaderLocation:i,offset:c[l].offset,format:c[l].format}),i++;r.push(s)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const Tz={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function Vw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tz,n),je(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Ot(t,e,["created","device","handle","indexBuffer"]),Cz(t,e)}const Sz=be(Vw,"vtkWebGPUVertexInput");var xz={newInstance:Sz,extend:Vw};const wz=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,Ez=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function Oz(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,i)=>{const a=xv.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),o=xv.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),s=r.getShaderDescriptions();s.push(a),s.push(o);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),u=c.match(l).filter((g,d,h)=>h.indexOf(g)===d).map(g=>`replaceShader${g.substring(7,g.length-2)}`);for(let g=0;g<u.length;g++){const d=u[g];d!=="replaceShaderIOStructs"&&e.shaderReplacements.has(d)&&e.shaderReplacements.get(d)(n,r,i)}t.replaceShaderIOStructs(n,r,i)},t.replaceShaderIOStructs=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.replaceShaderCode(null,i),r.getShaderDescription("fragment").replaceShaderCode(a)},t.replaceShaderRenderEncoder=(n,r,i)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,i)=>{if(!e.WebGPURenderer)return;const a=e.WebGPURenderer.getBindGroup().getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=$e.substitute(s,"//VTK::Renderer::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");s=c.getCode(),s=$e.substitute(s,"//VTK::Renderer::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,i)=>{const a=e.bindGroup.getShaderCode(r),o=r.getShaderDescription("vertex");let s=o.getCode();s=$e.substitute(s,"//VTK::Mapper::Dec",[a]).result,o.setCode(s);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=$e.substitute(s,"//VTK::Mapper::Dec",[a]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let o=a.getCode();o=$e.substitute(o,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,i)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?n.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const i=e.textureViews[r].getSampler();i&&n.push(i)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=sz.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const Dz={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function _w(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Dz,n),ze.extend(t,e,n),e.textureViews=[],e.vertexInput=xz.newInstance(),e.bindGroup=Dw.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||Ez,e.vertexShaderTemplate=e.vertexShaderTemplate||wz,e.shaderReplacements=new Map,D.get(t,e,["pipeline","vertexInput"]),D.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),Oz(t,e)}const Rz=D.newInstance(_w,"vtkWebGPUSimpleMapper");var bw={newInstance:Rz,extend:_w};function Mz(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();o=$e.substitute(o,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const Lz={};function Nw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lz,n),bw.extend(t,e,n),Mz(t,e)}const Iz=D.newInstance(Nw,"vtkWebGPUFullScreenQuad");var Mh={newInstance:Iz,extend:Nw};const Vz={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},_z={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var ql={BufferUsage:Vz,PrimitiveTypes:_z};const O2=["getMappedRange","mapAsync","unmap"];function bz(t,e,n,r){const i=r.byteLength,a=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),o=a.getMappedRange(0,i);new Uint8Array(o).set(new Uint8Array(r)),a.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(a,0,e,n,i);const c=s.finish();t.queue.submit([c]),a.destroy()}function Nz(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{bz(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n.byteLength,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=n.byteLength,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<O2.length;n++)t[O2[n]]=function(){return e.handle[O2[n]](...arguments)}}const Pz={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function Pw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Pz,n),D.obj(t,e),D.get(t,e,["handle","sizeInBytes","usage"]),D.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),Nz(t,e)}const kz=D.newInstance(Pw);var Lh={newInstance:kz,extend:Pw,...ql};const{Representation:Ev}=_0,{PrimitiveTypes:Ki}=ql;class Fz{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function Uz(t){switch(t){case Ki.Points:return"points";case Ki.Lines:return"lines";case Ki.Triangles:case Ki.TriangleEdges:return"polys";case Ki.TriangleStripEdges:case Ki.TriangleStrips:return"strips";default:return""}}function Wu(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function Az(t,e,n){const r=t.length;for(let o=0;o<r;o++){let s=t[o];if(n.cellProvokedMap.has(s)){n.ibo[n.iboId++]=n.cellProvokedMap.get(s);for(let c=o+1;c<o+r;c++){s=t[c%r];const l=Wu(n,s,e);n.ibo[n.iboId++]=l}return}}for(let o=0;o<r;o++){let s=t[o];if(!n.provokedPointIds[s]){let c=Wu(n,s,e);n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let l=o+1;l<o+r;l++)s=t[l%r],c=Wu(n,s,e),n.ibo[n.iboId++]=c;return}}let i=t[0],a=n.flatId;n.cellProvokedMap.set(i,a),n.flatIdToPointId[n.flatId]=i,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=a;for(let o=1;o<r;o++)i=t[o],a=Wu(n,i,e),n.ibo[n.iboId++]=a}function Bz(t,e,n){const r=t.length;n.iboSize+=r;for(let i=0;i<r;i++){const a=t[i];if(n.cellProvokedMap.has(a))return}for(let i=0;i<r;i++){const a=t[i];if(!n.provokedPointIds[a]){n.provokedPointIds[a]=1,n.cellProvokedMap.set(a,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let ui;const Ov=new Uint32Array(1),nr=new Uint32Array(2),Ai=new Uint32Array(3),D2={anythingToPoints(t,e,n,r,i){for(let a=0;a<t;++a)Ov[0]=e[n+a],ui(Ov,r,i)},linesToWireframe(t,e,n,r,i){for(let a=0;a<t-1;++a)nr[0]=e[n+a],nr[1]=e[n+a+1],ui(nr,r,i)},polysToWireframe(t,e,n,r,i){if(t>2)for(let a=0;a<t;++a)nr[0]=e[n+a],nr[1]=e[n+(a+1)%t],ui(nr,r,i)},stripsToWireframe(t,e,n,r,i){if(t>2){for(let a=0;a<t-1;++a)nr[0]=e[n+a],nr[1]=e[n+a+1],ui(nr,r,i);for(let a=0;a<t-2;a++)nr[0]=e[n+a],nr[1]=e[n+a+2],ui(nr,r,i)}},polysToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)Ai[0]=e[n],Ai[1]=e[n+a+1],Ai[2]=e[n+a+2],ui(Ai,r,i)},stripsToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)Ai[0]=e[n+a],Ai[1]=e[n+a+1+a%2],Ai[2]=e[n+a+1+(a+1)%2],ui(Ai,r,i)}};function Gz(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,i=n.primitiveType,a=n.representation,o=n.cellOffset,s=r.getData(),c=s.length,l=Uz(i),f=n.numberOfPoints,u={provokedPointIds:new Uint8Array(f),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new Fz};let g=null;a===Ev.POINTS||i===Ki.Points?g=D2.anythingToPoints:a===Ev.WIREFRAME||i===Ki.Lines?g=D2[`${l}ToWireframe`]:g=D2[`${l}ToSurface`],ui=Bz;let d=o||0;for(let h=0;h<c;)u.cellProvokedMap.clear(),g(s[h],s,h+1,d,u),h+=s[h]+1,d++;f<=65535?u.flatIdToPointId=new Uint16Array(f+u.extraPoints):u.flatIdToPointId=new Uint32Array(f+u.extraPoints),f+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(f):u.pointIdToFlatId=new Int32Array(f),f+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),n.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),n.format="uint32"),d<=65535?u.flatIdToCellId=new Uint16Array(f+u.extraPoints):u.flatIdToCellId=new Uint32Array(f+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),ui=Az,d=o||0;for(let h=0;h<c;)u.cellProvokedMap.clear(),g(s[h],s,h+1,d,u),h+=s[h]+1,d++;delete u.provokedPointIds,delete u.pointIdToFlatId,n.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}const Wz={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function kw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wz,n),Lh.extend(t,e,n),D.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),Gz(t,e)}const $z=D.newInstance(kw);var zz={newInstance:$z,extend:kw,...ql};const{BufferUsage:Bi}=ql,{vtkErrorMacro:Hz}=cn,{VtkDataTypes:za}=he,jz={};function Kz(t){let e;switch(t.getDataType()){case za.UNSIGNED_CHAR:e="uint8";break;case za.FLOAT:e="float32";break;case za.UNSIGNED_INT:e="uint32";break;case za.INT:e="sint32";break;case za.DOUBLE:e="float32";break;case za.UNSIGNED_SHORT:e="uint16";break;case za.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||Hz(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function Dv(t,e,n,r,i){const a={},o=t.getFlatSize();if(!o)return a;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const l=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let f,u=0;const g=n+(l?1:0),d=L0(r,o*g);let h=t.getFlatIdToPointId();i.cellData&&(h=t.getFlatIdToCellId()),n===1?f=function(m){d[u++]=c[0]*e[m]+s[0]}:n===2?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1]}:n===3&&!l?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2]}:n===3&&l?f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2],d[u++]=c[3]*1+s[3]}:n===4&&(f=function(m){d[u++]=c[0]*e[m]+s[0],d[u++]=c[1]*e[m+1]+s[1],d[u++]=c[2]*e[m+2]+s[2],d[u++]=c[3]*e[m+3]+s[3]});for(let p=0;p<o;p++){const m=n*h[p];f(m)}return a.nativeArray=d,a}function qz(t,e,n,r){const i=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],a=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],o=[];return ei(i,a,o),bo(o),o}function Xz(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const i=new Int8Array(t.getNumberOfCells()*4),a=r.length;let o=0;for(let s=0;s<a;){const c=qz(n,r[s+1],r[s+2],r[s+3]);i[o++]=127*c[0],i[o++]=127*c[1],i[o++]=127*c[2],i[o++]=127,s+=r[s]+1}return i}function Yz(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let i,a;if(r.usage===Bi.Index&&(i=zz.newInstance({label:r.label}),i.setDevice(e.device),a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(r),i.createAndWrite(r.nativeArray,a),i.setArrayInformation([{format:r.format}])),i||(i=Lh.newInstance({label:r.label}),i.setDevice(e.device)),r.usage===Bi.UniformArray&&(a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===Bi.Storage&&(a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===Bi.Texture&&(a=GPUBufferUsage.COPY_SRC,i.createAndWrite(r.nativeArray,a)),r.usage===Bi.PointArray){a=GPUBufferUsage.VERTEX;const o=nn.getNativeTypeFromBufferFormat(r.format),s=Dv(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),o,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});i.createAndWrite(s.nativeArray,a),i.setStrideInBytes(nn.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===Bi.NormalsFromPoints){a=GPUBufferUsage.VERTEX;const o=nn.getNativeTypeFromBufferFormat(r.format),s=Xz(r.cells,r.dataArray),c=Dv(r.indexBuffer,s,4,o,{cellData:!0});i.createAndWrite(c.nativeArray,a),i.setStrideInBytes(nn.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===Bi.RawVertex&&(a=GPUBufferUsage.VERTEX,i.createAndWrite(r.nativeArray,a),i.setStrideInBytes(nn.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format}])),i.setSourceTime(r.time),i}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,i)=>{const a=Kz(r),o={hash:`${r.getMTime()}I${i.getMTime()}${a}`,usage:Bi.PointArray,format:a,dataArray:r,indexBuffer:i};return t.getBuffer(o)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=Lh.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const Zz={device:null,fullScreenQuadBuffer:null};function Jz(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zz,n),je(t,e),Ot(t,e,["device"]),Yz(t,e)}be(Jz);var N0={...jz,...ql};const{BufferUsage:Qz}=N0,{vtkErrorMacro:rs}=D;function eH(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){rs(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const i=nn.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:i,offset:e.sizeInBytes,nativeType:nn.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=i},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:Qz.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=D.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){rs(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType];s[(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){rs(`entry named ${n} not found in UBO`);return}const o=e.bufferEntries[a];t.createView(o.nativeType);const s=e[o.nativeType],c=(o.offset+r*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<i.length;l++)s[c+l]=i[l]},t.setAllInstancesFromArray=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){rs(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)o[l+f]=r[c*s+f]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){rs(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)o[l+f]=r[c*s+f]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){rs(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType],s=9;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let f=0;f<3;f++)for(let u=0;u<3;u++)o[l+f*4+u]=r[c*s+f*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const i=[`struct ${e.label}StructEntry
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const tH={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function Fw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tH,n),D.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},D.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},D.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},D.get(t,e,["bindGroupTime"]),D.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),eH(t,e)}const nH=D.newInstance(Fw,"vtkWebGPUStorageBuffer");var rH={newInstance:nH,extend:Fw};const{BufferUsage:iH}=N0,{vtkErrorMacro:R2}=D;function aH(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){R2(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:nn.getByteStrideFromShaderFormat(r),offset:-1,nativeType:nn.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let i=4;for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.sizeInBytes%16===0&&(i=Math.max(16,i)),o.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed===!1&&o.sizeInBytes%16===0&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(o.packed===!1&&o.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(c.packed===!1&&c.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0)for(let s=a+1;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(!c.packed&&c.sizeInBytes%8===0){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];if(!o.packed&&o.sizeInBytes%8===0){let s=!1;for(let c=0;!s&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let f=c+1;f<e.bufferEntries.length;f++){const u=e.bufferEntries[f];if(!u.packed&&u.sizeInBytes===4){o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,s=!0;break}}}}}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];!o.packed&&o.sizeInBytes>4&&(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];o.packed||(o.packed=!0,o.offset=n,r.push(o),n+=o.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let a=0;a<e.bufferEntries.length;a++)e._bufferEntryNames.set(e.bufferEntries[a].name,a);e.sizeInBytes=n,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:iH.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=D.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){R2(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];a.lastValue!==r&&(o[a.offset/o.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),a.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){R2(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const o=e[a.nativeType];let s=!1;for(let c=0;c<r.length;c++)(!a.lastValue||a.lastValue[c]!==r[c])&&(o[a.offset/o.BYTES_PER_ELEMENT+c]=r[c],s=!0);s&&(e.sendDirty=!0,a.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let a=0;a<e.bufferEntries.length;a++){const o=e.bufferEntries[a];i.push(`  ${o.name}: ${o.type},`)}return i.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const oH={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function Uw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oH,n),D.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},D.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},D.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,D.get(t,e,["binding","bindGroupTime"]),D.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),aH(t,e)}const sH=D.newInstance(Uw,"vtkWebGPUUniformBuffer");var zs={newInstance:sH,extend:Uw};const{vtkDebugMacro:cH}=cn,Rv=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,lH=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,$u=new Float64Array(16),Mv=new Float64Array(16);function uH(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function fH(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),a=[],o=[];Hn(o,i,.5*(n[0]+n[1])),rn(a,r,o),_t(o,a,e.stabilizedCenter),R1(o)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=a,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(cH("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const i=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",i.wcvc),e.UBO.setArray("SCPCMatrix",i.scpc),e.UBO.setArray("PCSCMatrix",i.pcsc),e.UBO.setArray("SCVCMatrix",i.scvc),e.UBO.setArray("VCPCMatrix",i.vcpc),e.UBO.setArray("WCVCNormals",i.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const a=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[a.usize,a.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const o=e._parent.getDevice();e.UBO.sendIfNeeded(o)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let a=0;a<n.length;a++)i+=n[a].getMTime();if(i!==e.lightTimeString){const a=new Float32Array(n.length*4),o=new Float32Array(n.length*4),s=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let f=0;f<n.length;f++){const u=f*4,g=n[f].getPosition();Ee(g,g,r.wcvc),a[u]=g[0],a[u+1]=g[1],a[u+2]=g[2],a[u+3]=0,o[u]=-n[f].getDirection()[0],o[u+1]=-n[f].getDirection()[1],o[u+2]=-n[f].getDirection()[2],o[u+3]=0,s[u]=n[f].getColor()[0],s[u+1]=n[f].getColor()[1],s[u+2]=n[f].getColor()[2],s[u+3]=n[f].getIntensity()*5,c[u]=uH(n[f]),c[u+1]=Math.cos(gt(n[f].getConeAngle())),c[u+2]=Math.cos(gt(n[f].getConeAngle()+n[f].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",a),e.SSBO.setAllInstancesFromArray("LightDir",o),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=i},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var a;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=Mh.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Rv);const o=zs.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((a=e.backgroundTex)!=null&&a.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(lH);const o=zs.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o);const s=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(s.getReady()){const c=s.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const l=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:l,magFilter:l,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=Mh.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Rv);const o=zs.newInstance({label:"mapperUBO"});o.addEntry("FSQMatrix","mat4x4<f32>"),o.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(o)}const r=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),xe(Mv,r.normalMatrix),O1($u,r.scvc,r.pcsc),O1($u,Mv,$u),e.clearFSQ.getUBO().setArray("FSQMatrix",$u),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],o=e._parent.normalizedDisplayToDisplay(i,a),s=Math.round(o[0]),c=Math.round(o[1]),l=n[2]-r[0],f=n[3]-r[1],u=e._parent.normalizedDisplayToDisplay(l,f);let g=Math.round(u[0])-s,d=Math.round(u[1])-c;return g<0&&(g=0),d<0&&(d=0),{usize:g,vsize:d,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const gH={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function dH(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gH,n),ze.extend(t,e,n),e.UBO=zs.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=rH.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=Dw.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=ie(new Float64Array(16)),e.stabilizedTime={},je(e.stabilizedTime,{mtime:0}),In(t,e,["bindGroup","stabilizedTime"]),I0(t,e,["stabilizedCenter"]),Ot(t,e,["renderEncoder","selector","suppressClear","UBO"]),fH(t,e)}const pH=be(dH,"vtkWebGPURenderer");hr("vtkRenderer",pH);function hH(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const mH={device:null,handle:null,label:null,options:null};function Aw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mH,n),D.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},D.obj(e.bindGroupTime,{mtime:0}),D.get(t,e,["bindGroupTime","handle","options"]),D.setGet(t,e,["bindGroupLayoutEntry","device","label"]),hH(t,e)}const vH=D.newInstance(Aw);var Bw={newInstance:vH,extend:Aw};const{SlicingMode:Lv}=Qg,yH=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function CH(t,e,n){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${n}`}return"0"}const Wn=new Float64Array(16),Gr=new Float64Array(16),zu=new Float64Array(16),si=new Float64Array(4),kt=new Float64Array(4);function TH(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const a=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),a=e.WebGPUImageSlice.getRenderable(),o=a.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||a.getProperty().getMTime()>i){const s=o.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();ie(Wn),nt(Wn,Wn,c);const l=a.getMatrix();xe(Gr,l),xt(Gr,Gr),De(Wn,Gr,Wn);const f=s.getWorldToIndex();De(Wn,f,Wn),xt(zu,Wn),Ug(Gr,[.5,.5,.5]),De(Wn,Gr,Wn);const u=s.getDimensions();ie(Gr),Vi(Gr,Gr,[1/u[0],1/u[1],1/u[2]]),De(Wn,Gr,Wn),e.UBO.setArray("SCTCMatrix",Wn);const g=e.currentInput.getExtent(),{ijkMode:d}=e.renderable.getClosestIJKAxis();let h=e.renderable.getSlice();d!==e.renderable.getSlicingMode()&&(h=e.renderable.getSliceAtPosition(h));let p=2,m=0,v=1;d===Lv.I?(p=0,m=1,v=2):d===Lv.J&&(p=1,m=2,v=0),si[p]=h,si[m]=g[m*2]-.5,si[v]=g[v*2]-.5,si[3]=1,uo(si,si,zu),e.UBO.setArray("Origin",si),kt[p]=h,kt[m]=g[m*2+1]+.5,kt[v]=g[v*2]-.5,kt[3]=1,uo(kt,kt,zu),h8(kt,kt,si),kt[3]=1,e.UBO.setArray("Axis1",kt),kt[p]=h,kt[m]=g[m*2]-.5,kt[v]=g[v*2+1]+.5,kt[3]=1,uo(kt,kt,zu),h8(kt,kt,si),kt[3]=1,e.UBO.setArray("Axis2",kt);const y=[1,1,1,1],C=[0,0,0,0],T=e.textureViews[0],S=T.getTexture().getScale(),x=T.getTexture().getNumberOfComponents();for(let w=0;w<x;w++){let E=a.getProperty().getColorWindow(),M=a.getProperty().getColorLevel();const R=a.getProperty().getRGBTransferFunction(0);if(R){const _=R.getRange();E=_[1]-_[0],M=.5*(_[1]+_[0])}y[w]=S/E,C[w]=-M/E+.5}e.UBO.setArray("cScale",y),e.UBO.setArray("cShift",C),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const o=1,s=CH(i,i.getRGBTransferFunction,o);if(e.colorTextureString!==s){e.numRows=o;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=i.getRGBTransferFunction();if(l){const f=new Float32Array(e.rowLength*3);for(let u=0;u<o;u++){l=i.getRGBTransferFunction(u);const g=l.getRange();l.getTable(g[0],g[1],e.rowLength,f,1);for(let d=0;d<e.rowLength;d++){const h=u*e.rowLength*8+d*4;c[h]=255*f[d*3],c[h+1]=255*f[d*3+1],c[h+2]=255*f[d*3+2],c[h+3]=255;for(let p=0;p<4;p++)c[h+e.rowLength*4+p]=c[h+p]}}}else for(let f=0;f<e.rowLength;++f){const u=255*f/(e.rowLength-1);c[f*4]=u,c[f*4+1]=u,c[f*4+2]=u,c[f*4+3]=255;for(let g=0;g<4;g++)c[f*4+e.rowLength*4+g]=c[f*4+g]}{const f={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},g=e.device.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[1]=g}e.colorTextureString=s}};const n=t.updateBuffers;t.updateBuffers=()=>{n();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),a=e.textureViews;if(!a[0]||a[0].getTexture()!==i){const c=i.createView("imgTexture");a[0]=c}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===To.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=Bw.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const r=t.getShaderReplacements();t.replaceShaderPosition=(i,a,o)=>{const s=a.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=s.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=$e.substitute(c,"//VTK::Position::Impl",l).result,s.setCode(c)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,a,o)=>{const s=a.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,a,o)=>{const s=a.getShaderDescription("fragment");let c=s.getCode();e.dimensions===3?c=$e.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=$e.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=$e.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},r.set("replaceShaderImage",t.replaceShaderImage)}const SH={rowLength:1024};function xH(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SH,n),Mh.extend(t,e,n),t.setFragmentShaderTemplate(yH),e.UBO=zs.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},je(e.lutBuildTime,{mtime:0}),e.imagemat=ie(new Float64Array(16)),e.imagematinv=ie(new Float64Array(16)),e.VBOBuildTime={},je(e.VBOBuildTime),TH(t,e)}const wH=be(xH,"vtkWebGPUImageMapper");hr("vtkImageMapper",wH);function EH(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix(),i=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-i[0],e.bufferShift[1]=r[7]-i[1],e.bufferShift[2]=r[11]-i[2],xe(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?ie(e.keyMatrices.normalMatrix):(it(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,xt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),xe(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),nt(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),nt(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const OH={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function DH(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OH,n),ze.extend(t,e,n),e.keyMatricesTime={},je(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},je(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:ie(new Float64Array(16))},e.bufferShift=[0,0,0,0],In(t,e,["propID","keyMatricesTime"]),EH(t,e)}const RH=be(DH,"vtkWebGPUImageSlice");hr("vtkImageSlice",RH);function MH(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,a)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const o=e.renderable.getMapper().getBounds();if(!o||o.length!==6||o[0]>o[1])return;a.addVolume(t)}};const n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=(i,a)=>{const o=e.renderable.getMapper().getInputData();if(!o)return;const s=o.getExtent(),c=e.renderable.getMatrix();let l=0;for(let f=4;f<6;f++){n[2]=s[f];for(let u=2;u<4;u++){n[1]=s[u];for(let g=0;g<2;g++){n[0]=s[g],o.indexToWorld(n,r);let d=a+l*3;i[d++]=c[0]*r[0]+c[1]*r[1]+c[2]*r[2]+c[3],i[d++]=c[4]*r[0]+c[5]*r[1]+c[6]*r[2]+c[7],i[d++]=c[8]*r[0]+c[9]*r[1]+c[10]*r[2]+c[11],l++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const a=e.renderable.getMatrix(),o=i.getStabilizedCenterByReference();xe(e.keyMatrices.bcwc,a),nt(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-o[0],-o[1],-o[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const LH={propID:void 0,keyMatricesTime:null};function IH(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LH,n),ze.extend(t,e,n),e.keyMatricesTime={},D.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},D.get(t,e,["propID","keyMatricesTime"]),MH(t,e)}const VH=D.newInstance(IH,"vtkWebGPUVolume");hr("vtkVolume",VH);function _H(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),a,i,o,s)}}const bH={};function NH(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bH,n),ze.extend(t,e,n),_H(t,e)}const PH=D.newInstance(NH,"vtkWebGPUPixelSpaceCallbackMapper");hr("vtkPixelSpaceCallbackMapper",PH);class rd{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numTimePoints=null;const{imageIds:n,scaling:r,dimensions:i,spacing:a,origin:o,direction:s,dataType:c,volumeId:l,referencedVolumeId:f,metadata:u,referencedImageIds:g,additionalDetails:d,voxelManager:h,numberOfComponents:p}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:m}=e;this.imageIds=n,this.volumeId=l,this.metadata=u,this.dimensions=i,this.spacing=a,this.origin=o,this.direction=s,this.dataType=c,this.vtkOpenGLTexture=iW.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=h??ft.createImageVolumeVoxelManager({dimensions:i,imageIds:n,numberOfComponents:p}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],m||(m=Kg.newInstance(),m.setDimensions(i),m.setSpacing(a),m.setDirection(s),m.setOrigin(o)),m.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:p||1}),m.set({hasScalarVolume:!1}),this.imageData=m,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),r&&(this.scaling=r),f&&(this.referencedVolumeId=f),g&&(this.referencedImageIds=g),d&&(this.additionalDetails=d)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,n)=>{const r=Dn(e);this._imageIdsIndexMap.set(e,n),this._imageURIsIndexMap.set(r,n)})}isDynamicVolume(){return this.numTimePoints>1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){Q.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(n=>Q.getImage(n))}}function Gw(t){const e=t[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:o,samplesPerPixel:s}=ee("imagePixelModule",e),c=[],l=ee("voiLutModule",e);let f;if(l){const{windowWidth:y,windowCenter:C}=l;if(f=l==null?void 0:l.voiLUTFunction,Array.isArray(y))for(let T=0;T<y.length;T++)c.push({windowWidth:y[T],windowCenter:C[T]});else c.push({windowWidth:y,windowCenter:C})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:g}=ee("generalSeriesModule",e),{imageOrientationPatient:d,pixelSpacing:h,frameOfReferenceUID:p,columns:m,rows:v}=ee("imagePlaneModule",e);return{BitsAllocated:r,BitsStored:i,SamplesPerPixel:s,HighBit:a,PhotometricInterpretation:o,PixelRepresentation:n,Modality:u,ImageOrientationPatient:d,PixelSpacing:h,FrameOfReferenceUID:p,Columns:m,Rows:v,voiLut:c,VOILUTFunction:f,SeriesInstanceUID:g}}function Ww(t,e){const{imagePositionPatient:n,imageOrientationPatient:r}=ee("imagePlaneModule",t[0]);if(!e){const h=Ze(r[0],r[1],r[2]),p=Ze(r[3],r[4],r[5]);e=te(),vt(e,h,p)}const i=te(),a=t[0].split(":")[0]==="wadouri";Fe(i,n[0],n[1],n[2]);let o,s;function c(h){const{imagePositionPatient:p}=ee("imagePlaneModule",h),m=te();return _t(m,n,p),fe(m,e)}if(a){const h=[t[0],t[Math.floor(t.length/2)]];o=t;const p=c(h[0]),m=c(h[1]);p-m<0&&o.reverse();const v=ee("imagePlaneModule",h[1]);if(!v)throw new Error("Incomplete metadata required for volume construction.");const y=te();_t(y,n,v.imagePositionPatient);const C=fe(y,e);s=Math.abs(C)/Math.floor(t.length/2)}else{const h=t.map(m=>({distance:c(m),imageId:m}));h.sort((m,v)=>v.distance-m.distance),o=h.map(m=>m.imageId);const p=h.length;s=Math.abs(h[p-1].distance-h[0].distance)/(p-1)}const{imagePositionPatient:l,sliceThickness:f,spacingBetweenSlices:u}=ee("imagePlaneModule",o[0]),{strictZSpacingForVolumeViewport:g}=Q3().rendering;return s===0&&!g&&(f&&u?(console.log("Could not calculate zSpacing. Using spacingBetweenSlices"),s=u):f?(console.log("Could not calculate zSpacing and no spacingBetweenSlices. Using sliceThickness"),s=f):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),s=1)),{zSpacing:s,origin:l,sortedImageIds:o}}function $w(t){const e=ee("modalityLutModule",t)||{},n=ee("generalSeriesModule",t)||{},{modality:r}=n,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:r},a=ee("scalingModule",t)||{};return{...i,...r==="PT"&&{suvbw:a.suvbw,suvbsa:a.suvbsa,suvlbm:a.suvlbm}}}const im=t=>Object.values(t).some(n=>typeof n=="number"&&!Number.isInteger(n));function am(t,e){const n=Gw(t),{ImageOrientationPatient:r,PixelSpacing:i,Columns:a,Rows:o}=n,s=Ze(r[0],r[1],r[2]),c=Ze(r[3],r[4],r[5]),l=te();vt(l,s,c);const{zSpacing:f,origin:u,sortedImageIds:g}=Ww(t,l),d=t.length,h=[i[1],i[0],f],p=[a,o,d].map(v=>Math.floor(v)),m=[...s,...c,...l];return{dimensions:p,spacing:h,origin:u,dataType:kH(g,n),direction:m,metadata:n,imageIds:g,volumeId:e,voxelManager:null,numberOfComponents:n.PhotometricInterpretation==="RGB"?3:1}}function kH(t,e){const{BitsAllocated:n,PixelRepresentation:r}=e,i=r===1,[a,o,s]=[0,Math.floor(t.length/2),t.length-1],c=[a,o,s].map(g=>$w(t[g])),l=c.some(g=>g.rescaleIntercept<0||g.rescaleSlope<0),f=c.some(g=>im(g)),u=J3();switch(n){case 8:if(i)throw new Error("8 Bit signed images are not yet supported by this plugin.");return"Uint8Array";case 16:return u&&f?"Float32Array":i||l?"Int16Array":!i&&!l?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";default:throw new Error(`Bits allocated of ${n} is not defined to generate scalarData for the volume.`)}}let Q1=class zw{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const n=new zw("as iterator");return e.then(r=>{try{n.add(r,!0)}catch(i){n.reject(i)}},r=>{n.reject(r)}),n}add(e,n=!1){this.nextValue=e,this.done||(this.done=n),this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){var n;this.rejectReason=e,(n=this.waiting)==null||n.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,n)=>{this.waiting.resolve=e,this.waiting.reject=n})),await this.waiting.promise}yield this.nextValue}async forEach(e,n){let r=0;try{for await(const i of this){const{done:a}=this;try{await e(i,a,r),r++}catch(o){if(!a){console.warn("Caught exception in intermediate value",o);continue}if(n)n(o,a);else throw o}}}catch(i){if(n)n(i,!0);else throw i}}generate(e,n){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},r=>{this.reject(r),n?n(r):console.warn("Couldn't process because",r)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const M2=new Map,Iv="imageRetrieveConfiguration",Cl={IMAGE_RETRIEVE_CONFIGURATION:Iv,clear:()=>{M2.clear()},add:(t,e)=>{M2.set(t,e)},get:(t,...e)=>{if(t===Iv)return e.map(n=>M2.get(n)).find(n=>n!==void 0)}};M0(Cl.get.bind(Cl));function id(t){const e=kr(),n=[];return e.forEach(r=>{const a=r.getVolumeViewports().filter(o=>o.hasVolumeId(t));n.push(...a)}),n}const Ih=t=>{const e=FH(t);e!=null&&e.length&&e.forEach(({renderingEngine:n,viewportIds:r})=>{n.hasBeenDestroyed||n.renderViewports(r)})};function FH(t){const e=kr(),n=[];return e.forEach(r=>{const i=id(t);i.length&&n.push({renderingEngine:r,viewportIds:i.map(a=>a.id)})}),n}const Vv=[{id:"initialImages",retrieveType:"single"}],UH=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],L2=[{offset:-1,imageQualityStatus:qn.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:qn.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:qn.FAR_REPLICATE}],AH=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:ye.Thumbnail,priority:5,nearbyFrames:L2},{id:"quarterThumb",decimate:4,offset:3,requestType:ye.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:L2},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:ye.Thumbnail,retrieveType:"multipleFast",nearbyFrames:L2},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:ye.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:ye.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:ye.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:ye.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function Hw(t,e,n=0){const r=[];for(let i=n;i<t.length;i+=e)r.push(i);return r}function BH(t,e,n){var r;if((r=e==null?void 0:e.nearbyRequests)!=null&&r.length)for(const i of e.nearbyRequests)try{const{itemId:a,imageQualityStatus:o}=i,s=Q.getImageQuality(a);if(s!==void 0&&s>=o)continue;const c={...n,imageId:a,imageQualityStatus:o};Q.setPartialImage(a,c),t.successCallback(a,c)}catch(a){console.warn("Couldn't fill nearby item ",i.itemId,a)}}const Is=class Is{constructor(e){this.stages=e.stages||Vv,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,n){return new GH(this,e,n).loadImages()}};Is.createProgressive=jw,Is.interleavedRetrieveStages={stages:AH},Is.singleRetrieveStages={stages:Vv},Is.sequentialRetrieveStages={stages:UH};let eg=Is;class GH{constructor(e,n,r){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new Q1("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=n,this.listener=r}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const n of e)this.addRequest(n);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,n){const{imageId:r,next:i}=e,a=(f,u)=>{this.listener.errorCallback(r,c||!i,f),u&&this.updateStageStatus(e.stage,f)},o=(n.loader||Vo)(r,n),s=Q1.as(o);let c=!1;return s.forEach(async(f,u)=>{const g=Q.getImageQuality(r);if(!f){console.warn("No image retrieved",r);return}const{imageQualityStatus:d}=f;if(c||(c=d===qn.FULL_RESOLUTION),g!==void 0&&g>d){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(r,f),this.displayedIterator.add(f),u&&this.updateStageStatus(e.stage),BH(this.listener,e,f)},a).finally(()=>{if(!c&&i)Q.setPartialImage(r),this.addRequest(i,n.streamingData);else{c||this.listener.errorCallback(r,!0,"Couldn't decode"),this.outstandingRequests--;for(let f=i;f;f=f.next)this.updateStageStatus(f.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(f=>null)}addRequest(e,n={}){const{imageId:r,stage:i}=e,a=this.listener.getLoaderImageOptions(r);if(!a)return;const{retrieveType:o="default"}=i,{retrieveOptions:s}=this,c=s[o]||s.default,l={...a,retrieveType:o,retrieveOptions:c,streamingData:n},f=i.priority??-5,u=i.requestType||ye.Interaction,g={imageId:r};Jr.addRequest(this.sendRequest.bind(this,e,l),u,g,f)}updateStageStatus(e,n,r=!1){const{id:i}=e,a=this.stageStatusMap.get(i);if(a&&(a.imageLoadPendingCount--,n?a.imageLoadFailedCount++:r||a.totalImageCount++,!r&&!a.stageStartTime&&(a.stageStartTime=Date.now()),!a.imageLoadPendingCount)){const{imageLoadFailedCount:o,totalImageCount:s,stageStartTime:c=Date.now(),startTime:l}=a,f={stageId:i,numberOfFailures:o,numberOfImages:s,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};Z(Y,X.IMAGE_RETRIEVAL_STAGE,f),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,n=new Map,r=(i,a)=>{const o=a<0?this.imageIds.length+a:a<1?Math.floor((this.imageIds.length-1)*a):a,s=this.imageIds[o];if(!s)throw new Error(`No value found to add to requests at ${a}`);const c={imageId:s,stage:i,index:o,nearbyRequests:this.findNearbyRequests(o,i)};this.addStageStatus(i);const l=n.get(s);l?l.next=c:e.push(c),n.set(s,c)};for(const i of this.stages)(i.positions||Hw(this.imageIds,i.decimate||1,i.offset??0)).forEach(o=>{r(i,o)});return e}findNearbyRequests(e,n){const r=new Array;if(!n.nearbyFrames)return r;for(const i of n.nearbyFrames){const a=e+i.offset;a<0||a>=this.imageIds.length||r.push({itemId:this.imageIds[a],imageQualityStatus:i.imageQualityStatus,index:a})}return r}addStageStatus(e){const{id:n}=e,r=this.stageStatusMap.get(n)||{stageId:n,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return r.imageLoadPendingCount++,this.stageStatusMap.set(n,r),r}}function jw(t){return new eg(t)}const _v=ye.Prefetch;class WH extends rd{constructor(e,n){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:r}=this;if(!r||!r.loading)return;r.loading=!1,r.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:a})=>a.volumeId!==this.volumeId;Jr.filterRequests(i)},this.loadStatus=n.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:n}=this,{numFrames:r}=this;for(let i=0;i<r;i++)n.setUpdatedFrame(i);this.modified(),e&&Ih(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:n,framesProcessed:r,totalNumFrames:i}=e,{volumeId:a,reRenderFraction:o,loadStatus:s,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(n>this.reRenderTarget||r===i)&&(this.reRenderTarget+=o,Ih(a)),r===i){s.callbacks.forEach(u=>u(e));const f={FrameOfReferenceUID:l,volumeId:a};Z(Y,X.IMAGE_VOLUME_LOADING_COMPLETED,f)}}updateTextureAndTriggerEvents(e,n,r=qn.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:a,numFrames:o,totalNumFrames:s}=this,{FrameOfReferenceUID:c}=this.metadata;if(a[i]>r||a[i]===qn.FULL_RESOLUTION)return;const f=r===qn.FULL_RESOLUTION;a[e]=r,this.framesUpdated++,f&&(this.framesLoaded++,this.framesProcessed++);const u={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:o,framesProcessed:this.framesProcessed};Z(Y,X.IMAGE_VOLUME_MODIFIED,u),f&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:o,totalNumFrames:s,complete:f,imageQualityStatus:r}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,n){const r=this.getImageIdIndex(e),{imageQualityStatus:i}=n;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",r);return}this.updateTextureAndTriggerEvents(r,e,i),this.isDynamicVolume()&&this.checkTimePointCompletion(r)}errorCallback(e,n,r){if(!n)return;const{totalNumFrames:i,numFrames:a}=this,o=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:o,error:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const s={error:r,imageIdIndex:o,imageId:e};Z(Y,X.IMAGE_LOAD_ERROR,s)}load(e){const{imageIds:n,loadStatus:r,numFrames:i}=this,{transferSyntaxUID:a}=ee("transferSyntax",n[0])||{},o=ee(Cl.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,a,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:o?(o.create||eg.createProgressive)(o):this,r.loading===!0)return;const{loaded:s}=this.loadStatus,c=n.length;if(s){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:n}=ee("transferSyntax",e)||{},r=ee("imagePlaneModule",e)||{},{rows:i,columns:a}=r,o=this.getImageIdIndex(e),s=ee("modalityLutModule",e)||{},c=ee("generalSeriesModule",e)||{},l={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:c.modality};if(l.modality==="PT"){const d=ee("scalingModule",e);d&&(this._addScalingToVolume(d),l.suvbw=d.suvbw)}const f=im(l),u=J3();if(this.isPreScaled=!0,l&&l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:d,rescaleIntercept:h}=l;this.isPreScaled=typeof d=="number"&&typeof h=="number"}return!u&&f&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:a},allowFloatRendering:u,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:_v,transferSyntaxUID:n,additionalDetails:{imageId:e,imageIdIndex:o,volumeId:this.volumeId}}}callLoadImage(e,n,r){const{cachedFrames:i}=this;if(i[n]===qn.FULL_RESOLUTION)return;const a=s=>{const{image:c}=s.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(n),Y.removeEventListener(X.IMAGE_CACHE_IMAGE_ADDED,a))};return Y.addEventListener(X.IMAGE_CACHE_IMAGE_ADDED,a),Q1.as(Vo(e,r)).forEach(s=>{this.successCallback(e,s)},this.errorCallback.bind(this,n,e))}getImageIdsRequests(e,n){this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),e.map(a=>{const o=this.getImageIdIndex(a),s=_v,c=n,l=this.getLoaderImageOptions(a);return{callLoadImage:this.callLoadImage.bind(this),imageId:a,imageIdIndex:o,options:l,priority:c,requestType:s,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(n=>{if(!n)return;const{callLoadImage:r,imageId:i,imageIdIndex:a,options:o,priority:s,requestType:c,additionalDetails:l}=n;Jr.addRequest(r.bind(this,i,a,o),c,l,s)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(r=>{console.debug("progressive loading failed to complete",r)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),n&&(a.suvbw=n),this.scaling={PT:a}}checkTimePointCompletion(e){}}class $H extends WH{constructor(e,n){e.imageIds||(e.imageIds=n.imageIds),super(e,n),this.getImageIdsToLoad=()=>{const{imageIds:r}=this;return this.numFrames=r.length,r}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:n}=this;return this.getImageIdsRequests(n,e)}}function zH(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function n(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[h,p]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],m=[0,h,p];await Promise.all(m.map(v=>new Promise((y,C)=>{const T=e.imageIds[v];Jr.addRequest(async()=>{o_(T).then(()=>{console.log(`Prefetched imageId: ${T}`),y(!0)}).catch(S=>{C(S)})},ye.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=am(e.imageIds,t),{dimensions:a,spacing:o,origin:s,direction:c,metadata:l,imageIds:f,dataType:u,numberOfComponents:g}=i;return new $H({volumeId:t,metadata:l,dimensions:a,spacing:o,origin:s,direction:c,imageIds:f,dataType:u,numberOfComponents:g},{imageIds:f,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const r=n();return{promise:r,decache:()=>{r.then(i=>{i.destroy(),i=null})},cancel:()=>{r.then(i=>{i.cancelLoading()})}}}const Kw={};let Wf=zH;function qw(t,e){const n=t.indexOf(":"),r=t.substring(0,n);let i=Kw[r];if(i==null){if(Wf==null||typeof Wf!="function")throw new Error(`No volume loader for scheme ${r} has been registered`);i=Wf}const a=i(t,e);return a.promise.then(function(o){Z(Y,X.VOLUME_LOADED,{volume:o})},function(o){const s={volumeId:t,error:o};Z(Y,X.VOLUME_LOADED_FAILED,s)}),a}function HH(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=Q.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=qw(t,e),n.promise.then(r=>r))}async function Xw(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=Q.getVolumeLoadObject(t);return n!==void 0||(n=qw(t,e),Q.putVolumeLoadObject(t,n)),n.promise}function jH(t,e){const n=Q.getVolume(t);if(!n)throw new Error(`Cannot created derived volume: Referenced volume with id ${t} does not exist.`);let{volumeId:r}=e;r===void 0&&(r=bt());const{metadata:i,dimensions:a,spacing:o,origin:s,direction:c}=n,l=n.isDynamicVolume()?n.getCurrentTimePointImageIds():n.imageIds??[],f=vC(l,{targetBuffer:e.targetBuffer}),u=f[0].dataType,g=f.map(h=>h.imageId),d=new rd({volumeId:r,dataType:u,metadata:structuredClone(i),dimensions:[a[0],a[1],a[2]],spacing:o,origin:s,direction:c,referencedVolumeId:t,imageIds:g,referencedImageIds:n.imageIds??[]});return Q.putVolumeSync(r,d),d}async function om(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const n=Q.getVolume(t);return n||(e.filter(a=>!Q.getImage(a)).length===0?KH(t,e):await Xw(t,{imageIds:e}))}function KH(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const n=Q.getVolume(t);if(n)return n;const r=am(e,t),i=new rd({volumeId:t,dataType:r.dataType,metadata:structuredClone(r.metadata),dimensions:r.dimensions,spacing:r.spacing,origin:r.origin,direction:r.direction,referencedVolumeId:r.referencedVolumeId,imageIds:r.imageIds,referencedImageIds:r.referencedImageIds});return Q.putVolumeSync(t,i),i}function qH(){return Object.keys(Kw)}function XH(){return Wf.name}function Yw(t,e={}){return jH(t,{...e,targetBuffer:{type:"Uint8Array"}})}function YH(t,e){const n=eW.newInstance();Q3().rendering.preferSizeOverAccuracy&&n.setPreferSizeOverAccuracy(!0),n.setInputData(t);const r=t.getSpacing(),i=(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(i),n.setScalarTexture(e),n}function Zw(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const ZH=0,JH=ye.Prefetch;async function sm(t,e){let n=ej(e);!n&&e.imageIds.length&&(n=await tj(e),n=QH(e,n)),!(n.lower===0&&n.upper===0||n.lower===void 0||n.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(n.lower,n.upper)}function QH(t,e){const n=t.imageIds,r=Math.floor(n.length/2),i=n[r],a=ee("generalSeriesModule",i)||{};return nj(a.modality,t)?{lower:0,upper:5}:e}function ej(t){const{imageIds:e,metadata:n}=t;let r;if(e.length){const i=Math.floor(e.length/2),a=e[i],o=ee("voiLutModule",a);if(o!=null&&o.windowWidth&&o.windowCenter){const{windowWidth:s,windowCenter:c}=o,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;l!==0&&(r={windowWidth:l,windowCenter:f})}}else r=n.voiLut[0];if(r&&(r.windowWidth!==0||r.windowCenter!==0)){const{lower:i,upper:a}=$s(Number(r.windowWidth),Number(r.windowCenter));return{lower:i,upper:a}}}async function tj(t){var h;const{imageIds:e}=t,n=Math.floor(e.length/2),r=t.imageIds[n],i=ee("generalSeriesModule",r)||{},{modality:a}=i,o=ee("modalityLutModule",r)||{},s={rescaleSlope:o.rescaleSlope,rescaleIntercept:o.rescaleIntercept,modality:a};let c;if(a==="PT"){const p=ee("scalingModule",r);p&&(c={...s,suvbw:p.suvbw})}const l={priority:ZH,requestType:JH,preScale:{scalingParameters:c}};let f=Q.getImage(r);(h=t.referencedImageIds)!=null&&h.length||(f=await Vo(r,{...l,ignoreCache:!0}));const u=f.getPixelData(),{min:g,max:d}=Zw(u);return{lower:g,upper:d}}function nj(t,e){var n;return!(t!=="PT"||!e.isPreScaled||!((n=e.scaling)!=null&&n.PT.suvbw))}async function bv(t,e,n,r=!1){const{volumeId:i,callback:a,blendMode:o}=t,s=await HH(i);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=s,f=YH(c,l);o&&f.setBlendMode(o);const u=a$.newInstance();u.setMapper(f);const{numberOfComponents:g}=c.get("numberOfComponents");return u.getProperty().set({viewportId:n}),g===3&&u.getProperty().setIndependentComponents(!1),await sm(u,s),a&&a({volumeActor:u,volumeId:i}),r||rj(e,n,u,i),u}function rj(t,e,n,r){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:r};Z(t,X.VOI_MODIFIED,a)}const P0=t=>{const e="volumeId:",n=t.includes(e)?t.substring(e.length):t,r=n.indexOf("sliceIndex=");return r===-1?n:n.substring(0,r-1)},ij=1+Qr,aj=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),Nv=t=>!!qH().find(e=>aj(t.volumeId,e));function Xl(t,e,n,r=!1){const{viewPlaneNormal:i}=e,a=t.getActors();if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const o=a.map(l=>{const f=l.referencedId??l.uid;return Q.getVolume(f)}).filter(l=>!!l);if(n){const l=P0(n),f=o.findIndex(h=>l.includes(h.volumeId)),u=o[f],{uid:g}=a[f],d=Pv(u,i,t,r);return{imageVolume:u,spacingInNormalDirection:d,actorUID:g}}if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=o.find(Nv);for(let l=0;l<o.length;l++){const f=o[l];if(c&&!Nv(f))continue;const u=Pv(f,i,t);u*ij<s.spacingInNormalDirection&&(s.spacingInNormalDirection=u,s.imageVolume=f,s.actorUID=a[l].uid)}return s}function Pv(t,e,n,r=!1){const{slabThickness:i}=n.getProperties();let a=i;return(!i||!r)&&(a=f0(t,e)),a}function tg(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=Xl(t,e);if(!r)return;const{viewPlaneNormal:i,focalPoint:a}=e,o=t.getActors().find(h=>h.referencedId===r.volumeId||h.uid===r.volumeId);o||console.warn("No actor found for with actorUID of",r.volumeId);const s=o.actor,c=ed(s,i,a),{min:l,max:f,current:u}=c,g=Math.round((f-l)/n)+1;let d=(u-l)/(f-l)*g;return d=Math.floor(d),d>g-1?d=g-1:d<0&&(d=0),{numberOfSlices:g,imageIndex:d}}const Os={};function oj(t){Os[t]!==void 0&&delete Os[t]}function sj(t){const{renderingEngineId:e,viewportId:n}=t.detail,i=Va(e).getViewport(n);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");Os[i.id]===void 0&&(Os[i.id]=0);const a=tg(i);if(!a){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:o,imageIndex:s}=a;if(Os[i.id]===s)return;Os[i.id]=s;const c={imageIndex:s,viewportId:n,renderingEngineId:e,numberOfSlices:o};Z(i.element,X.VOLUME_NEW_IMAGE,c)}function Jw(t,e,n){const[r,i,a]=t,[o,s,c]=e,[l,f,u,g]=n,d=o-r,h=s-i,p=c-a,m=-1*(l*r+f*i+u*a-g)/(l*d+f*h+u*p),v=d*m+r,y=h*m+i,C=p*m+a;return[v,y,C]}function Qw(t,e,n=!1){const[r,i,a]=t,o=r*e[0]+i*e[1]+a*e[2];if(n){const s=Math.sqrt(r*r+i*i+a*a);return[r/s,i/s,a/s,o/s]}return[r,i,a,o]}function cj(t,e,n){const[r,i,a,o]=t,[s,c,l,f]=e,[u,g,d,h]=n,p=hc(r,s,u,i,c,g,a,l,d),m=hc(o,f,h,i,c,g,a,l,d),v=hc(r,s,u,o,f,h,a,l,d),y=hc(r,s,u,i,c,g,o,f,h),C=Za(m)/Za(p),T=Za(v)/Za(p),S=Za(y)/Za(p);return[C,T,S]}function eE(t,e,n=!1){const[r,i,a,o]=t,[s,c,l]=e,f=r*s+i*c+a*l-o,u=Math.abs(f)/Math.sqrt(r*r+i*i+a*a);return(n?Math.sign(f):1)*u}const lj=Object.freeze(Object.defineProperty({__proto__:null,linePlaneIntersection:Jw,planeDistanceToPoint:eE,planeEquation:Qw,threePlaneIntersection:cj},Symbol.toStringTag,{value:"Module"}));function Vh(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function Rr(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(Rr);{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=Rr(t[n]));return e}}const Hc=class Hc{constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=xn.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=n=>{},this.viewportWidgets=new Map,this.addWidget=(n,r)=>{this.viewportWidgets.set(n,r)},this.getWidget=n=>this.viewportWidgets.get(n),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(r=>{if(r.getEnabled()&&r.setEnabled(!1),r.getActor&&r.getRenderer){const i=r.getActor(),a=r.getRenderer();a&&i&&a.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=Rr(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=Rr(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===xn.NO_DATA||this.viewportStatus===xn.LOADING||(this.viewportStatus=xn.RENDERED)}getRenderingEngine(){return pl.get(this.renderingEngineId)}getRenderer(){var n;const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return(n=e.offscreenMultiRenderWindow)==null?void 0:n.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){var r,i;this.options=structuredClone(e),(r=this.options)!=null&&r.displayArea&&this.setDisplayArea((i=this.options)==null?void 0:i.displayArea),n&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;const i=this.getCamera(),{viewPlaneNormal:a,viewUp:o,focalPoint:s,position:c}=i,l=vt(te(),a,o);let f=dl(te(),o);const u=vo(te(),a),g=D1(c,s),h=r.getDimensions().map(S=>Math.floor(S/2)),p=[h[0],h[1],h[2]],m=r.indexToWorld(p,te()),v=this._getFocalPointForResetCamera(m,i,{resetPan:!0,resetToCenter:!1}),y=rt(te(),s,v),C=ma(y),T=S=>{const x=Hn(te(),S,2*fe(y,S));return rt(x,x,y),$t(x,x),x};if(e){const S=T(f),x=dn(te(),v,S,C),w=dn(te(),x,u,g);this.setCamera({viewPlaneNormal:u,position:w,focalPoint:x}),this.flipHorizontal=!this.flipHorizontal}if(n){f=vo(f,o);const S=T(l),x=dn(te(),v,S,C),w=dn(te(),x,u,g);this.setCamera({focalPoint:x,viewPlaneNormal:u,viewUp:f,position:w}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&jr(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const n=this.getActors();let r=n[0];return e&&(r=n.find(a=>a.referencedId===e)),!r||!jr(r)?null:r.actor}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors(),this.addActors(e,{resetCamera:!0})}_removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist for this viewport`);return}this.getRenderer().removeViewProp(n.actor),this._actors.delete(e)}removeActors(e){e.forEach(n=>{this._removeActor(n)})}addActors(e,n={}){const{resetCamera:r=!1}=n,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(s=>{this.addActor(s)});const a=this.getViewPresentation(),o=this.getViewReference();this.resetCamera(),r||(this.setViewReference(o),this.setViewPresentation(a))}addActor(e){const{uid:n,actor:r}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}const a=this.getRenderer();a==null||a.addActor(r),this._actors.set(n,Object.assign({},e)),this.updateCameraClippingPlanesAndRange()}removeAllActors(){var e;(e=this.getRenderer())==null||e.removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,n,r){const i=r[0],a=r[1],o=r[2],s=i*n[0]+a*n[1]+o*n[2],c=e.getBounds(),l=this._getEdges(c),f=[];for(const u of l){const[[g,d,h],[p,m,v]]=u;if(i*(p-g)+a*(m-d)+o*(v-h)===0)continue;const y=Jw([g,d,h],[p,m,v],[i,a,o,s]);this._isInBounds(y,c)&&f.push(y)}return f}setInterpolationType(e,n){}setDisplayArea(e,n=!1){var o;if(!e)return;const{storeAsInitialCamera:r,type:i}=e;r&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:a}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(((o=this.getProperties())==null?void 0:o.interpolationType)??vi.LINEAR),this.setDisplayAreaFit(e)),r&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=a,!n&&!a){const s={viewportId:this.id,displayArea:e,storeAsInitialCamera:r};Z(this.element,X.DISPLAY_AREA_MODIFIED,s),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:n=1}=e,r=this.canvas,i=r.height,a=r.width;if(i<8||a<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(vi.NEAREST),this.setCamera({parallelScale:i*c/(2*n)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:f,viewUp:u,viewPlaneNormal:g}=this.getCamera(),d=te();if(r.height%2&&dn(d,d,u,n*.5*c),r.width%2){const h=vt(te(),u,g);dn(d,d,h,n*.5*c)}!d[0]&&!d[1]&&!d[2]||this.setCamera({focalPoint:rn(te(),l,d),position:rn(te(),f,d)})}setDisplayAreaFit(e){const{imageArea:n,imageCanvasPoint:r}=e,i=(window==null?void 0:window.devicePixelRatio)||1,a=this.getDefaultImageData();if(!a)return;const o=this.sWidth/i,s=this.sHeight/i,c=a.getDimensions(),l=this.worldToCanvas(a.indexToWorld([0,0,0])),f=this.worldToCanvas(a.indexToWorld([c[0]-1,c[1]-1,c[2]])),u=[Math.abs(f[0]-l[0]),Math.abs(f[1]-l[1])],[g,d]=u;if(n){const[h,p]=n,m=Math.abs(h*g/o),v=Math.abs(p*d/s),y=this.getZoom(),C=this.getZoom(this.fitToCanvasCamera),S=Math.min(1/m,1/v)*y/C;this.setZoom(S,!1)}if(r){const{imagePoint:h,canvasPoint:p=h||[.5,.5]}=r,[m,v]=p,y=o*(m-.5),C=s*(v-.5),[T,S]=h||p,x=1,w=x*g*(.5-T),E=x*d*(.5-S),M=w+y,O=E+C,R=[M,O];o3(R,R,this.getPan()),this.setPan(R,!1)}}getDisplayArea(){var e;return(e=this.options)==null?void 0:e.displayArea}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetToCenter:i=!0,storeAsInitialCamera:a=!0}=e||{},o=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const s=this.getCamera(),c=o.computeVisiblePropBounds(),l=[0,0,0],f=this.getDefaultImageData();if(f){const P=f.getSpacing();c[0]=c[0]+P[0]/2,c[1]=c[1]-P[0]/2,c[2]=c[2]+P[1]/2,c[3]=c[3]-P[1]/2,c[4]=c[4]+P[2]/2,c[5]=c[5]-P[2]/2}const u=this.getVtkActiveCamera(),g=u.getViewPlaneNormal(),d=u.getViewUp();if(l[0]=(c[0]+c[1])/2,l[1]=(c[2]+c[3])/2,l[2]=(c[4]+c[5])/2,f){const N=f.getDimensions().map(U=>Math.floor(U/2)),W=[N[0],N[1],N[2]];f.indexToWorld(W,l)}const{widthWorld:h,heightWorld:p}=this._getWorldDistanceViewUpAndViewRight(c,d,g),m=[this.sWidth,this.sHeight],v=h/p,y=m[0]/m[1],C=v/y,T=C<1?this.insetImageMultiplier*p/2:this.insetImageMultiplier*p*C/2,S=Hc.boundsRadius(c)*(this.type===lt.VOLUME_3D?10:1),x=this.insetImageMultiplier*S,w=Math.abs(Dr.dot(d,g))>.999?[-d[2],d[0],d[1]]:d,E=this._getFocalPointForResetCamera(l,s,{resetPan:n,resetToCenter:i}),M=[E[0]+x*g[0],E[1]+x*g[1],E[2]+x*g[2]];o.resetCameraClippingRange(c);const O=[-dt.MAXIMUM_RAY_DISTANCE,dt.MAXIMUM_RAY_DISTANCE];u.setPhysicalScale(S),u.setPhysicalTranslation(-E[0],-E[1],-E[2]),this.setCamera({parallelScale:r?T:s.parallelScale,focalPoint:E,position:M,viewAngle:90,viewUp:w,clippingRange:O});const R=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),a&&this.setInitialCamera(R),r&&this.setZoom(1,a);const _={type:"ResetCameraEvent",renderer:o};return o.invokeEvent(_),this.triggerCameraModifiedEventIfNecessary(s,R),f&&this.options.displayArea&&r&&n&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const r=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),a=this.worldToCanvas(rt([0,0,0],e.focalPoint,i)),o=this.worldToCanvas(rt([0,0,0],r,i));return c0([0,0],a,o)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:i,position:a}=r,o=this.canvasToWorld([0,0]),s=c0([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!n)return;const c=rt(te(),this.canvasToWorld(s),o),l=rt(te(),i,c),f=rt(te(),a,c);this.setCamera({...r,focalPoint:l,position:f},n)}getZoom(e=this.initialCamera){if(!e)return 1;const n=this.getVtkActiveCamera(),{parallelScale:r}=e;return r/n.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:i}=this.initialCamera,a=i/e;r.parallelScale===a&&!n||this.setCamera({...r,parallelScale:a},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),i=this._getViewImageDataIntersections(e,n,r);let a=0,o=0,s=0;return i.forEach(([l,f,u])=>{a+=l,o+=f,s+=u}),[a/i.length,o/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){return this.getRenderer().getActiveCamera()}getCameraNoRotation(){const e=this.getVtkActiveCamera(),n=(s,c)=>s.some(l=>isNaN(l))?c:s,r=n([...e.getViewUp()],[0,1,0]),i=n([...e.getViewPlaneNormal()],[0,0,-1]),a=n([...e.getPosition()],[0,0,1]),o=n([...e.getFocalPoint()],[0,0,0]);return{viewUp:r,viewPlaneNormal:i,position:a,focalPoint:o,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,n=!1){const r=this.getVtkActiveCamera(),i=this.getCamera(),a=Object.assign({},i,e),{viewUp:o,viewPlaneNormal:s,position:c,focalPoint:l,parallelScale:f,viewAngle:u,flipHorizontal:g,flipVertical:d,clippingRange:h}=e;if(g!==void 0){const v=g&&!this.flipHorizontal||!g&&this.flipHorizontal;v&&this.flip({flipHorizontal:v})}if(d!==void 0){const v=d&&!this.flipVertical||!d&&this.flipVertical;v&&this.flip({flipVertical:v})}o!==void 0&&r.setViewUp(o),s!==void 0&&r.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&r.setPosition(...c),l!==void 0&&r.setFocalPoint(...l),f!==void 0&&r.setParallelScale(f),u!==void 0&&r.setViewAngle(u),h!==void 0&&r.setClippingRange(h);const p=i.focalPoint,m=i.viewUp;if(p&&l||m&&o){const v=r.getViewPlaneNormal(),y=r.getViewUp();let C=!1,T=!1;if(l){const S=[l[0]-p[0],l[1]-p[1],l[2]-p[2]];C=Math.abs(Dr.dot(S,v))>0}if(o&&(T=!Vt(y,m)),C||T){const S=this.getDefaultActor();if(!(S!=null&&S.actor))return;Gn(S,"vtkActor")||this.updateClippingPlanesForActors(a),(Gn(S,"vtkImageSlice")||this.type===lt.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}n&&this.setInitialCamera(a),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Z(this.element,X.CAMERA_MODIFIED,r)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(r=>{if(!r.actor)return;const i=r.actor.getMapper();let a=r!=null&&r.clippingFilter?r==null?void 0:r.clippingFilter.getClippingPlanes():i.getClippingPlanes();a.length===0&&(r!=null&&r.clippingFilter)&&(a=[hn.newInstance(),hn.newInstance()]);let o=dt.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(o=r.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(a,o,s,c),Z(this.element,X.CLIPPING_PLANES_UPDATED,{actorEntry:r,focalPoint:c,vtkPlanes:a,viewport:this})})}setOrientationOfClippingPlanes(e,n,r,i){if(e.length<2)return;const a=[r[0],r[1],r[2]];Dr.multiplyScalar(a,n),e[0].setNormal(r);const o=[0,0,0];Dr.subtract(i,a,o),e[0].setOrigin(o),e[1].setNormal(-r[0],-r[1],-r[2]);const s=[0,0,0];Dr.add(i,a,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const n=e.actor.getMapper();let r=e!=null&&e.clippingFilter?e==null?void 0:e.clippingFilter.getClippingPlanes():n.getClippingPlanes();return r.length===0&&(e!=null&&e.clippingFilter)&&(r=[hn.newInstance(),hn.newInstance()]),r}_getWorldDistanceViewUpAndViewRight(e,n,r){const i=this._getCorners(e),a=this._getCorners(e),o=vt(te(),n,r);let s=go.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);i.forEach(g=>s.apply(g));let c=1/0,l=-1/0;for(let g=0;g<8;g++){const d=i[g][0];d>l&&(l=d),d<c&&(c=d)}s=go.buildFromDegree().identity().rotateFromDirections([o[0],o[1],o[2]],[1,0,0]),a.forEach(g=>s.apply(g));let f=1/0,u=-1/0;for(let g=0;g<8;g++){const d=a[g][0];d>u&&(u=d),d<f&&(f=d)}return{widthWorld:u-f,heightWorld:l-c}}getViewReference(e={}){const{focalPoint:n,viewPlaneNormal:r,viewUp:i}=this.getCamera();return{FrameOfReferenceUID:this.getFrameOfReferenceUID(),cameraFocalPoint:n,viewPlaneNormal:r,viewUp:i,sliceIndex:e.sliceIndex??this.getSliceIndex()}}isReferenceViewable(e,n){if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:r}=e,i=this.getCamera();return r&&!Vt(r,i.viewPlaneNormal)&&!Vt(vo(i.viewPlaneNormal,i.viewPlaneNormal),r)?n==null?void 0:n.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0}){const n={},{rotation:r,displayArea:i,zoom:a,pan:o}=e;r&&(n.rotation=this.getRotation()),i&&(n.displayArea=this.getDisplayArea());const s=this.getZoom();return a&&(n.zoom=s),o&&(n.pan=this.getPan(),C8(n.pan,n.pan,1/s)),n}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:n,zoom:r=this.getZoom(),pan:i,rotation:a}=e;n!==this.getDisplayArea()&&this.setDisplayArea(n),this.setZoom(r),i&&this.setPan(C8([0,0],i,r)),a>=0&&this.setRotation(a)}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,n,{resetPan:r=!0,resetToCenter:i=!0}){if(i&&r)return e;if(i&&!r)return Vh(n.focalPoint)?e:n.focalPoint;if(!i&&r){const a=n,o=a.focalPoint,s=a.viewPlaneNormal,c=rt(te(),e,o),l=fe(c,s),f=dn(te(),e,s,-1*l);return[f[0],f[1],f[2]]}if(!r&&!i)return Vh(n.focalPoint)?e:n.focalPoint}_isInBounds(e,n){const[r,i,a,o,s,c]=n,[l,f,u]=e;return!(l<r||l>i||f<a||f>o||u<s||u>c)}_getEdges(e){const[n,r,i,a,o,s,c,l]=this._getCorners(e);return[[n,r],[n,o],[n,i],[r,a],[r,s],[i,a],[i,c],[a,l],[o,c],[o,s],[s,l],[c,l]]}static boundsRadius(e){const n=(e[1]-e[0])**2,r=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(n+r+i||1)*.5}setDataIds(e,n){throw new Error("Unsupported operatoin setDataIds")}};Hc.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},Hc.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let p0=Hc;function tE(t,e,n=!1){const r=t.getCamera(),{focalPoint:i,viewPlaneNormal:a}=r,{spacingInNormalDirection:o,actorUID:s}=Xl(t,r,e,n);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(s);if(!c)return console.warn("No actor found for with actorUID of",s),null;const l=c.actor;return{sliceRange:ed(l,a,i),spacingInNormalDirection:o,camera:r}}function Bc(t,e,n=!1){const{sliceRange:r,spacingInNormalDirection:i,camera:a}=tE(t,e,n),{min:o,max:s,current:c}=r,l=Math.round((s-o)/i),u=(c-o)/(s-o)*l,g=Math.round(u);return{numScrollSteps:l,currentStepIndex:g,sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:i,camera:a}}}function nE(t){let e=[];const[n,r]=t.getRange();t.getTable(n,r,1024,e),e=e.filter((d,h)=>h%3===0);const i=[...Array(1024).keys()].map((d,h)=>n+(r-n)/1023*h),a=e[256],o=Math.log((1-a)/a),s=i[256],c=e[256*3],l=Math.log((1-c)/c),f=i[256*3],u=Math.round(4*(f-s)/(o-l)),g=Math.round(s+u*o/4);return[Math.round(g-u/2),Math.round(g+u/2)]}function rE(t,e){const n=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=uj(n),i=r[0],a=r[1]-r[0],o=wa.newInstance(),s=[];for(let T=0;T<n.length;T+=4){let S=n[T];const x=n[T+1],w=n[T+2],E=n[T+3];S=(S-i)/a,s.push([S,x,w,E])}fj(s,r,o),t.getProperty().setRGBTransferFunction(0,o);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=u0.newInstance(),f=[];for(let T=0;T<c.length;T+=2){let S=c[T];const x=c[T+1];S=(S-i)/a,f.push([S,x])}gj(f,r,l);const u=t.getProperty();u.setScalarOpacity(0,l);const[g,d,h,p]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);u.setUseGradientOpacity(0,!0),u.setGradientOpacityMinimumValue(0,g),u.setGradientOpacityMinimumOpacity(0,d),u.setGradientOpacityMaximumValue(0,h),u.setGradientOpacityMaximumOpacity(0,p),e.interpolation==="1"&&u.setInterpolationTypeToFastLinear(),u.setShade(e.shade==="1");const m=parseFloat(e.ambient),v=parseFloat(e.diffuse),y=parseFloat(e.specular),C=parseFloat(e.specularPower);u.setAmbient(m),u.setDiffuse(v),u.setSpecular(y),u.setSpecularPower(C)}function uj(t){let e=1/0,n=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),n=Math.max(n,t[i]);const r=(n-e)/2;return{shiftRange:[-r,r],min:e,max:n}}function fj(t,e,n){const r=e[1]-e[0],i=t.map(([a,o,s,c])=>[a*r+e[0],o,s,c]);return n.removeAllPoints(),i.forEach(([a,o,s,c])=>n.addRGBPoint(a,o,s,c)),i}function gj(t,e,n){const r=e[1]-e[0],i=t.map(([a,o])=>[a*r+e[0],o]);return n.removeAllPoints(),i.forEach(([a,o])=>n.addPoint(a,o)),i}class Fr extends p0{constructor(e){if(super(e),this.useCPURendering=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const a=this.getPan(this.fitToCanvasCamera),o=this.getPan(),s=this.getCamera(),c=M1([0,0],a,o);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),f=l?vo([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:f}),this.rotateCamera(i);const u=this.getPan(),g=this.getPan(this.fitToCanvasCamera),d=M1([0,0],u,g),h=o3([0,0],a,d);if(this.setPan(h,!1),this._suppressCameraModifiedEvents)return;const p=this.getCamera(),m={previousCamera:s,camera:p,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Z(this.element,X.CAMERA_MODIFIED,m)},this.getDefaultProperties=i=>{let a;return i!==void 0&&(a=this.perVolumeIdDefaultProperties.get(i)),a!==void 0?a:{...this.globalDefaultProperties}},this.getProperties=i=>{var S;if(!this._getApplicableVolumeActor(i))return;const{colormap:o,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}=this.viewportProperties;if(i||(i=this.getVolumeId()),!Q.getVolume(i))return null;const d=this.getActors().find(x=>x.referencedId===i);if(!d)return;const p=d.actor.getProperty().getRGBTransferFunction(0),[m,v]=((S=this.viewportProperties)==null?void 0:S.VOILUTFunction)==="SIGMOID"?nE(p):p.getRange(),y={lower:m,upper:v},C=this.getColormap(i);return{colormap:i&&C?C:o,voiRange:y,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}},this.getColormap=i=>{const a=this._getApplicableVolumeActor(i);if(!a)return;const{volumeActor:o}=a,s=this._getOrCreateColorTransferFunction(i),{nodes:c}=s.getState(),l=c.reduce((u,g)=>(u.push(g.x,g.r,g.g,g.b),u),[]);return tm(l,o)},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:a,flipVertical:o}=this.getCameraNoRotation(),s=o?vo([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const c=cC(s,i)*180/Math.PI,l=vt([0,0,0],s,i);return fe(l,a)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=i=>{var h,p;const a=this.getVtkActiveCamera();(h=a.setIsPerformingCoordinateTransformation)==null||h.call(a,!0);const o=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[i[0]*f,i[1]*f],g=[u[0]+this.sx,u[1]+this.sy];g[1]=l[1]-g[1];const d=c.displayToWorld(g[0],g[1],0,o);return(p=a.setIsPerformingCoordinateTransformation)==null||p.call(a,!1),[d[0],d[1],d[2]]},this.worldToCanvas=i=>{var h;const a=this.getVtkActiveCamera();(h=a.setIsPerformingCoordinateTransformation)==null||h.call(a,!0);const o=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...i,o);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy],g=window.devicePixelRatio||1,d=[u[0]/g,u[1]/g];return a.setIsPerformingCoordinateTransformation(!1),d},this.hasImageURI=i=>this.getActors().filter(o=>Gn(o,"vtkVolume")).some(({uid:o,referencedId:s})=>{const c=Q.getVolume(s||o);return c!=null&&c.imageIds?c.imageIds.map(Dn).includes(i):!1}),this.getImageIds=i=>{const a=this._getApplicableVolumeActor(i);if(!a)throw new Error(`No actor found for the given volumeId: ${i}`);const o=a.volumeId,s=Q.getVolume(o);if(!s)throw new Error(`imageVolume with id: ${o} does not exist in cache`);return s.imageIds},this.useCPURendering=Uc(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const n=this.getRenderer(),r=cW.newInstance();switch(n.setActiveCamera(r),this.type){case lt.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case lt.VOLUME_3D:r.setParallelProjection(!0);break;case lt.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,n=!0){const{viewPlaneNormal:r,viewUp:i}=this._getOrientationVectors(e),a=this.getVtkActiveCamera();a.setDirectionOfProjection(-r[0],-r[1],-r[2]),a.setViewUpFrom(i),this.initialViewUp=i,n&&this.resetCamera()}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=i.bind(this);function r(a){const{viewportId:o}=a.detail;o!==this.id||this.isDisabled||!this.getImageData()||sj(a)}function i(a){const{viewportId:o}=a.detail;o===this.id&&(this.element.removeEventListener(X.CAMERA_MODIFIED,e),Y.removeEventListener(X.ELEMENT_DISABLED,n),oj(o))}this.element.removeEventListener(X.CAMERA_MODIFIED,e),this.element.addEventListener(X.CAMERA_MODIFIED,e),Y.addEventListener(X.ELEMENT_DISABLED,n)}setVOILUTFunction(e,n,r){Object.values(Ti).includes(e)||(e=Ti.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,n,r),this.viewportProperties.VOILUTFunction=e}setColormap(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=wa.newInstance();let s=yl(e.name);const{name:c}=e;if(s||(s=K1.getPresetByName(c)),!s)throw new Error(`Colormap ${e} not found`);const l=a.getProperty().getRGBTransferFunction(0).getRange();if(o.applyColorMap(s),o.setMappingRange(l[0],l[1]),a.getProperty().setRGBTransferFunction(0,o),this.viewportProperties.colormap=e,!r){const f={viewportId:this.id,colormap:e,volumeId:n};Z(this.element,X.VOI_MODIFIED,f),Z(this.element,X.COLORMAP_MODIFIED,f)}}setOpacity(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r,a=u0.newInstance();if(typeof e.opacity=="number"){const o=i.getProperty().getRGBTransferFunction(0).getRange();a.addPoint(o[0],e.opacity),a.addPoint(o[1],e.opacity)}else e.opacity.forEach(({opacity:o,value:s})=>{a.addPoint(s,o)});i.getProperty().setScalarOpacity(0,a),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity}setInvert(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const a=i.volumeId,o=this._getOrCreateColorTransferFunction(a);if(Ac(o),this.viewportProperties.invert=e,!r){const s={...this.getVOIModifiedEventDetail(a),invertStateChanged:!0};Z(this.element,X.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const n=this._getApplicableVolumeActor(e);if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);const a=n.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),o=this.getColormap(e),{VOILUTFunction:s,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:a[0],upper:a[1]},volumeId:n.volumeId,VOILUTFunction:s,colormap:o,invert:c}}_getOrCreateColorTransferFunction(e){const n=this._getApplicableVolumeActor(e);if(!n)return null;const{volumeActor:r}=n,i=r.getProperty().getRGBTransferFunction(0);if(i)return i;const a=wa.newInstance();return r.getProperty().setRGBTransferFunction(0,a),a}setInterpolationType(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,n,r=!1){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,o=i.volumeId,s=e;if(typeof s>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");const{VOILUTFunction:c}=this.getProperties(o);if(c===Ti.SAMPLED_SIGMOID){const l=nm(s);a.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:f}=s;a.getProperty().getRGBTransferFunction(0).setRange(l,f)}if(!r){const l={...this.getVOIModifiedEventDetail(o)};Z(this.element,X.VOI_MODIFIED,l)}this.viewportProperties.voiRange=s}rotateCamera(e){const n=e-this.getRotation();this.getVtkActiveCamera().roll(-n)}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(n,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const n=super.getViewReference(e),r=this.getVolumeId(e);if((e==null?void 0:e.forFrameOfReference)!==!1&&(n.volumeId=r),typeof(e==null?void 0:e.sliceIndex)!="number")return n;const{viewPlaneNormal:i}=n,a=(e==null?void 0:e.sliceIndex)-this.getSliceIndex(),{sliceRangeInfo:o}=Bc(this,r,!0),{sliceRange:s,spacingInNormalDirection:c,camera:l}=o,{focalPoint:f,position:u}=l,{newFocalPoint:g}=Ws(f,u,s,i,c,a);return n.cameraFocalPoint=g,n}isReferenceViewable(e,n){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,n))return!1;if(n!=null&&n.withNavigation)return!0;const r=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=r&&r<=i[1]:i===void 0||i===r}scroll(e=1){const n=this.getVolumeId(),{sliceRangeInfo:r}=Bc(this,n,!0);if(!r)return;const{sliceRange:i,spacingInNormalDirection:a,camera:o}=r,{focalPoint:s,viewPlaneNormal:c,position:l}=o,{newFocalPoint:f,newPosition:u}=Ws(s,l,i,c,a,e);this.setCamera({focalPoint:f,position:u})}setViewReference(e){if(!e)return;const n=this.getVolumeId(),{viewPlaneNormal:r,FrameOfReferenceUID:i,cameraFocalPoint:a,viewUp:o}=e;let{sliceIndex:s}=e;const{focalPoint:c,viewPlaneNormal:l,position:f}=this.getCamera(),u=pC(l,r),g=Vt(l,r);if(typeof s=="number"&&e.volumeId===n&&(u||g)){const{currentStepIndex:d,sliceRangeInfo:h,numScrollSteps:p}=Bc(this,n,!0),{sliceRange:m,spacingInNormalDirection:v}=h;u&&(s=p-s-1);const y=s-d,{newFocalPoint:C,newPosition:T}=Ws(c,f,m,l,v,y);this.setCamera({focalPoint:C,position:T})}else if(i===this.getFrameOfReferenceUID()){if(r&&!u&&!g){this.setOrientation({viewPlaneNormal:r,viewUp:o}),this.setViewReference(e);return}if(a){const d=rt([0,0,0],a,c),h=r??l,p=fe(d,h);Vt(p,0)||Hn(d,h,p);const m=rn([0,0,0],c,d),v=rn([0,0,0],f,d);this.setCamera({focalPoint:m,position:v})}}else throw new Error(`Incompatible view refs: ${i}!==${this.getFrameOfReferenceUID()}`)}setProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,interpolationType:o,slabThickness:s}={},c,l=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,slabThickness:s}),r!==void 0&&this.viewportProperties.invert!==r&&this.setInvert(r,c,l),i!=null&&i.name&&this.setColormap(i,c,l),(i==null?void 0:i.opacity)!=null&&this.setOpacity(i,c),e!==void 0&&this.setVOI(e,c,l),typeof o<"u"&&this.setInterpolationType(o),n!==void 0&&this.setVOILUTFunction(n,c,l),a!==void 0&&this.setPreset(a,c,l),s!==void 0&&(this.setSlabThickness(s),this.viewportProperties.slabThickness=s)}resetToDefaultProperties(e){var r,i;const n=this.globalDefaultProperties;(r=n.colormap)!=null&&r.name&&this.setColormap(n.colormap,e),((i=n.colormap)==null?void 0:i.opacity)!=null&&this.setOpacity(n.colormap,e),n.voiRange!==void 0&&this.setVOI(n.voiRange,e),n.VOILUTFunction!==void 0&&this.setVOILUTFunction(n.VOILUTFunction,e),n.invert!==void 0&&this.setInvert(n.invert,e),n.slabThickness!==void 0&&(this.setSlabThickness(n.slabThickness),this.viewportProperties.slabThickness=n.slabThickness),n.preset!==void 0&&this.setPreset(n.preset,e,!1),n.preset!==void 0&&this.setPreset(n.preset,e,!1),this.render()}setPreset(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i;let o=e;typeof o=="string"&&(o=TC.find(s=>s.name===e)),o&&(rE(a,o),this.viewportProperties.preset=o,this.render(),r||Z(this.element,X.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:a,presetName:o.name}))}async setVolumes(e,n=!1,r=!1){const i=Q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist, you need to create/allocate the volume first`);const a=i.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,a),this._FrameOfReferenceUID=a,e.forEach(s=>{this._addVolumeId(s.volumeId)});const o=[];for(let s=0;s<e.length;s++){const{volumeId:c,actorUID:l,slabThickness:f,...u}=e[s],g=await bv(e[s],this.element,this.id,r),d=l||bt();o.push({uid:d,actor:g,slabThickness:f,referencedId:c,...u})}this._setVolumeActors(o),this.viewportStatus=xn.PRE_RENDER,this.initializeColorTransferFunction(e),Z(this.element,X.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:o}),n&&this.render()}async addVolumes(e,n=!1,r=!1){const i=Q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const a=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(o=>{this._addVolumeId(o.volumeId)});for(let o=0;o<e.length;o++){const{volumeId:s,visibility:c,actorUID:l,slabThickness:f,...u}=e[o],g=await bv(e[o],this.element,this.id,r);c||g.setVisibility(!1);const d=l||bt();a.push({uid:d,actor:g,slabThickness:f,referencedId:s,...u})}this.addActors(a),this.initializeColorTransferFunction(e),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const n=e[0].volumeId,r=this._getOrCreateColorTransferFunction(n);!this.initialTransferFunctionNodes&&r&&(this.initialTransferFunctionNodes=J1(r))}_getApplicableVolumeActor(e){const n=this.getActors();if(!(n!=null&&n.length))return;if(e){const i=n.find(a=>a.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const r=n[0];return{volumeActor:r.actor,volumeId:r.referencedId,actorUID:r.uid}}async _isValidVolumeInputArray(e,n){const r=e.length;for(let i=1;i<r;i++){const a=Q.getVolume(e[i].volumeId);if(n!==a.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const n of this.volumeIds)if(n.includes(e))return!0;return!1}getImageData(e){var s,c,l;if(!this.getDefaultActor())return;e||(e=this.getVolumeId());const r=(s=this.getActors())==null?void 0:s.find(f=>f.referencedId===e);if(!Gn(r,"vtkVolume"))return;const i=r.actor,a=Q.getVolume(e),o=i.getMapper().getInputData();return{dimensions:o.getDimensions(),spacing:o.getSpacing(),origin:o.getOrigin(),direction:o.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:(c=a==null?void 0:a.metadata)==null?void 0:c.Modality,FrameOfReferenceUID:(l=a==null?void 0:a.metadata)==null?void 0:l.FrameOfReferenceUID},get scalarData(){var f;return(f=a==null?void 0:a.voxelManager)==null?void 0:f.getScalarData()},scaling:a==null?void 0:a.scaling,hasPixelSpacing:!0,voxelManager:a==null?void 0:a.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,n){super.setCamera(e,n),this.setCameraClippingRange()}_setVolumeActors(e){for(let n=0;n<e.length;n++)this.viewportProperties.invert=!1;this.setActors(e)}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}else{if(typeof e=="string"&&ia[e])return this.viewportProperties.orientation=e,ia[e];throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(ia).join(", ")}`)}}getSlabThickness(){const e=this.getActors();let n=dt.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}getIntensityFromWorld(e){const n=this.getDefaultActor();if(!Gn(n,"vtkVolume"))return;const{actor:r}=n,i=r.getMapper().getInputData(),a=Q.getVolume(this.getVolumeId()),o=Ji(i,e);return a.voxelManager.getAtIJKPoint(o)}getVolumeId(e){const n=this.getActors();if(!n)return;if(!(e!=null&&e.volumeId)){const i=n.find(a=>a.actor.getClassName()==="vtkVolume");return(i==null?void 0:i.referencedId)||(i==null?void 0:i.uid)}const r=n.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===(e==null?void 0:e.volumeId));return(r==null?void 0:r.referencedId)||(r==null?void 0:r.uid)}getViewReferenceId(e={}){var c;let{volumeId:n,sliceIndex:r}=e;if(!n){const l=this.getActors();if(!l)return;n=(c=l.find(f=>f.actor.getClassName()==="vtkVolume"))==null?void 0:c.referencedId}const i=this.getSliceIndex();r??(r=i);const{viewPlaneNormal:a,focalPoint:o}=this.getCamera(),s=n.includes("?")?"&":"?";return`volumeId:${n}${s}sliceIndex=${r}&viewPlaneNormal=${a.join(",")}&focalPoint=${o.join(",")}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}}function Qi(t,e){const{imageData:n}=t.getImageData(),r=t.canvasToWorld(e);return Ji(n,r)}function iE(t,e){return t.indexToWorld(e)}function dj(t,e){const{imageData:n}=t.getImageData(),r=iE(n,e);return t.worldToCanvas(r)}class Rn extends Fr{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:r}=tg(this)||{};return r},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=r=>{const{viewPlaneNormal:i,focalPoint:a}=this.getCamera(),o=this.getImageData(r);if(!o)return;const{origin:s,direction:c,spacing:l}=o,f=f0({direction:c,spacing:l},i),u=te();_t(u,a,s);const g=fe(u,i);return Math.round(Math.abs(g)/f)},this.getSliceIndex=()=>{const{imageIndex:r}=tg(this)||{};return r},this.getCurrentImageId=()=>{const r=this.getDefaultActor();if(!r||!Gn(r,"vtkVolume"))return;const i=Q.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:a,focalPoint:o}=this.getCamera();return ml(i,o,a)},this.getSlicePlaneCoordinates=()=>{const r=this.getDefaultActor();if(!(r!=null&&r.actor))return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),a=Q.getVolume(i),o=this.getCamera(),{focalPoint:s,position:c,viewPlaneNormal:l}=o,f=f0(a,l),u=ed(r.actor,l,s),g=Math.round((u.current-u.min)/f),d=Math.round((u.max-u.current)/f),h=this.getSliceIndex(),p=[];for(let m=-g;m<=d;m++){const{newFocalPoint:v}=Ws(s,c,u,l,f,m);p.push({sliceIndex:h+m,point:v})}return p};const{orientation:n}=this.options;if(n&&n!==o0.ACQUISITION){this.applyViewOrientation(n);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,n=!1,r=!1){const i=Q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.setVolumes(e,n,r)}async addVolumes(e,n=!1,r=!1){const i=Q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.addVolumes(e,n,r)}jumpToWorld(e){const{focalPoint:n}=this.getCamera(),r=[0,0,0];_t(r,e,n);const i=this.getCamera(),a=i.viewPlaneNormal,o=fe(r,a),s=Ze(a[0],a[1],a[2]);if(Hn(s,s,o),Math.abs(s[0])>.001||Math.abs(s[1])>.001||Math.abs(s[2])>.001){const c=[0,0,0],l=[0,0,0];rn(c,i.focalPoint,s),rn(l,i.position,s),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,n=!0){let r,i;if(typeof e=="string"){if(ia[e])({viewPlaneNormal:r,viewUp:i}=ia[e]);else if(e==="acquisition")({viewPlaneNormal:r,viewUp:i}=this._getAcquisitionPlaneOrientation());else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:r,viewUp:i}=e),this.applyViewOrientation(e);n&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-dt.MAXIMUM_RAY_DISTANCE,dt.MAXIMUM_RAY_DISTANCE):e.setClippingRange(dt.MINIMUM_SLAB_THICKNESS,dt.MAXIMUM_RAY_DISTANCE)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const n=this.getVolumeId(),r=Q.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:i}=r,a=i.slice(6,9).map(s=>-s),o=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:a,viewUp:o}}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:i}=e;n=i.slice(6,9).map(a=>-a),r=i.slice(3,6).map(a=>-a)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.initialViewUp=r,this.resetCamera()}setBlendMode(e,n=[],r=!1){let i=this.getActors();n&&n.length>0&&(i=i.filter(a=>n.includes(a.uid))),i.forEach(a=>{var c;const{actor:o}=a,s=o.getMapper();(c=s.setBlendMode)==null||c.call(s,e)}),r&&this.render()}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetRotation:i=!0,resetToCenter:a=!0,suppressEvents:o=!1,resetOrientation:s=!0}=e||{},{orientation:c}=this.viewportProperties;c&&s&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:n,resetZoom:r,resetToCenter:a});const l=this.getVtkActiveCamera(),f=l.getViewPlaneNormal(),u=l.getFocalPoint();if(this.getActors().forEach(d=>{if(!d.actor)return;const h=d.actor.getMapper();if(h.getClippingPlanes().length===0&&!(d!=null&&d.clippingFilter)){const m=hn.newInstance(),v=hn.newInstance(),y=[m,v];let C=dt.MINIMUM_SLAB_THICKNESS;d.slabThickness&&(C=d.slabThickness),this.setOrientationOfClippingPlanes(y,C,f,u),h.addClippingPlane(m),h.addClippingPlane(v)}}),i&&ia[this.viewportProperties.orientation]!==void 0){const d=ia[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:d.viewUp,viewPlaneNormal:d.viewPlaneNormal})}if(!o){const d={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};Z(this.element,X.CAMERA_RESET,d)}return!0}setSlabThickness(e,n=[]){e<.1&&(e=.1);let r=this.getActors();n&&n.length>0&&(r=r.filter(a=>n.includes(a.uid))),r.forEach(a=>{Gn(a,"vtkVolume")&&(a.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(r=>{Gn(r,"vtkVolume")&&(r.slabThickness=dt.MINIMUM_SLAB_THICKNESS)});const n=this.getCamera();this.updateClippingPlanesForActors(n),this.triggerCameraModifiedEventIfNecessary(n,n),this.viewportProperties.slabThickness=void 0}getSliceViewInfo(){const{width:e,height:n}=this.getCanvas(),r=Qi(this,[0,0]),i=Qi(this,[e-1,0]),a=Qi(this,[0,n-1]),o=_t(te(),i,r),s=_t(te(),a,r),c=vt(te(),o,s);$t(o,o),$t(s,s),$t(c,c);const{dimensions:l}=this.getImageData(),[f,u,g]=l,p=[[0,0,0],[f-1,0,0],[0,u-1,0],[f-1,u-1,0],[0,0,g-1],[f-1,0,g-1],[0,u-1,g-1],[f-1,u-1,g-1]].map(O=>dj(this,O)).reduce((O,R)=>(O.minX=Math.min(O.minX,R[0]),O.minY=Math.min(O.minY,R[1]),O.maxX=Math.max(O.maxX,R[0]),O.maxY=Math.max(O.maxY,R[1]),O),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),m=Qi(this,[p.minX,p.minY]),v=Q7(o[0],o[1],o[2],0,s[0],s[1],s[2],0,c[0],c[1],c[2],0,m[0],m[1],m[2],1),y=Qi(this,[p.maxX,p.maxY]),C=_t(te(),y,m),T=xt(Ia(),v),{viewPlaneNormal:S}=this.getCamera();if(S.filter(O=>Math.abs(O)>Qr).length>1)throw new Error("getSliceInfo is not supported for oblique views");const w=S.findIndex(O=>Math.abs(O)>1-Qr);if(w===-1)throw new Error("Unable to determine slice axis");const E=fe(o,C)+1,M=fe(s,C)+1;return{sliceIndex:this.getSliceIndex(),width:E,height:M,slicePlane:w,sliceToIndexMatrix:v,indexToSliceMatrix:T}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const n=super.getViewReference(e);if(!(n!=null&&n.volumeId))return;const r=Q.getVolume(n.volumeId);return n.referencedImageId=ml(r,n.cameraFocalPoint,n.viewPlaneNormal),n}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=dt.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=Q.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(sm(n.actor,r),jr(n)){const l=n.actor.getProperty().getRGBTransferFunction(0);nd(l,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),Z(this.element,X.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:n}=this.getCamera(),r=dt.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:a})=>{const o=[hn.newInstance(),hn.newInstance()];return this.setOrientationOfClippingPlanes(o,r,n,i),{sliceIndex:a,planes:o.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}function pj(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(D.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),xa())}const hj={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function mj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hj,n),W3.extend(t,e,n),D.setGet(t,e,["slice","useCustomExtents"]),D.setGetArray(t,e,["customDisplayExtent"],6),D.setGetArray(t,e,["backgroundColor"],4),pj(t,e)}var vj={extend:mj};function aE(t,e,n){const r=n.getCurrentImage(),i=r.getExtent(),a=[i[0],i[2],i[4]],{ijkMode:o}=n.getClosestIJKAxis();let s=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();o!==n.getSlicingMode()&&(s=n.getSliceAtPosition(s)),a[o]+=s;const c=[0,0,0];r.indexToWorld(a,c),a[o]+=1;const l=[0,0,0];r.indexToWorld(a,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],$t(l,l);const f=hn.intersectWithLine(t,e,c,l);if(f.intersection){const u=f.x,g=[0,0,0];return r.worldToIndex(u,g),{t:f.t,absoluteIJK:g}}return null}function yj(t,e,n){const r=aE(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return o[0]<a[0]||o[0]>a[1]||o[1]<a[2]||o[1]>a[3]||o[2]<a[4]||o[2]>a[5]?null:{t:r.t,ijk:o}}return null}function Cj(t,e,n){const r=aE(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),o=r.absoluteIJK,s=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])];if(s[0]<a[0]||s[0]>a[1]-1||s[1]<a[2]||s[1]>a[3]-1||s[2]<a[4]||s[2]>(a[5]?a[5]-1:a[5]))return null;const c=[o[0]-s[0],o[1]-s[1],o[2]-s[2]];return{t:r.t,ijk:s,pCoords:c}}return null}const{staticOffsetAPI:Tj,otherStaticMethods:Sj}=Zg,{SlicingMode:Ve}=Qg;function xj(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=r=>{const i=t.getCurrentImage();let a;if(r.length===3)a=r;else if(Number.isFinite(r)){const f=i.getBounds();switch(e.slicingMode){case Ve.X:a=[r,(f[3]+f[2])/2,(f[5]+f[4])/2];break;case Ve.Y:a=[(f[1]+f[0])/2,r,(f[5]+f[4])/2];break;case Ve.Z:a=[(f[1]+f[0])/2,(f[3]+f[2])/2,r];break}}const o=[0,0,0];i.worldToIndex(a,o);const s=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case Ve.I:l=Ir(o[0],s[0],s[1]);break;case Ve.J:l=Ir(o[1],s[2],s[3]);break;case Ve.K:l=Ir(o[2],s[4],s[5]);break;default:return 0}return l},t.setSliceFromCamera=r=>{const i=r.getFocalPoint();switch(e.slicingMode){case Ve.I:case Ve.J:case Ve.K:{const a=t.getSliceAtPosition(i);t.setSlice(a)}break;case Ve.X:t.setSlice(i[0]);break;case Ve.Y:t.setSlice(i[1]);break;case Ve.Z:t.setSlice(i[2]);break}},t.setXSlice=r=>{t.setSlicingMode(Ve.X),t.setSlice(r)},t.setYSlice=r=>{t.setSlicingMode(Ve.Y),t.setSlice(r)},t.setZSlice=r=>{t.setSlicingMode(Ve.Z),t.setSlice(r)},t.setISlice=r=>{t.setSlicingMode(Ve.I),t.setSlice(r)},t.setJSlice=r=>{t.setSlicingMode(Ve.J),t.setSlice(r)},t.setKSlice=r=>{t.setSlicingMode(Ve.K),t.setSlice(r)},t.getSlicingModeNormal=()=>{const r=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case Ve.X:r[0]=1;break;case Ve.Y:r[1]=1;break;case Ve.Z:r[2]=1;break;case Ve.I:bf(i,[1,0,0],r);break;case Ve.J:bf(i,[0,1,0],r);break;case Ve.K:bf(i,[0,0,1],r);break}return r};function n(){let r;switch(e.slicingMode){case Ve.X:r=0;break;case Ve.Y:r=1;break;case Ve.Z:r=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),a=bT(i);let o=0;for(;o<3&&a[r+3*o]===0;++o);const s=a[r+3*o]<0;e.closestIJKAxis={ijkMode:o,flip:s}}t.setSlicingMode=r=>{e.slicingMode!==r&&(e.slicingMode=r,t.getCurrentImage()&&n(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===Ve.NONE)&&t.getCurrentImage()&&n(),e.closestIJKAxis),t.getBounds=()=>{const r=t.getCurrentImage();if(!r)return xa();if(!e.useCustomExtents)return r.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:a}=t.getClosestIJKAxis();let o=e.slice;switch(a!==e.slicingMode&&(o=t.getSliceAtPosition(e.slice)),a){case Ve.I:i[0]=o,i[1]=o;break;case Ve.J:i[2]=o,i[3]=o;break;case Ve.K:i[4]=o,i[5]=o;break}return r.extentToBounds(i)},t.getBoundsForSlice=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getCurrentImage();if(!a)return xa();const o=a.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let c=r;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(r)),s){case Ve.I:o[0]=c-i,o[1]=c+i;break;case Ve.J:o[2]=c-i,o[3]=c+i;break;case Ve.K:o[4]=c-i,o[5]=c+i;break}return a.extentToBounds(o)},t.intersectWithLineForPointPicking=(r,i)=>yj(r,i,t),t.intersectWithLineForCellPicking=(r,i)=>Cj(r,i,t),t.getCurrentImage=()=>t.getInputData()}const wj={slicingMode:Ve.NONE,closestIJKAxis:{ijkMode:Ve.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function oE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wj,n),vj.extend(t,e,n),D.get(t,e,["slicingMode"]),D.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),Zg.implementCoincidentTopologyMethods(t,e),xj(t,e)}const Ej=D.newInstance(oE,"vtkImageMapper");var Oj={newInstance:Ej,extend:oE,...Tj,...Sj,...Qg};const{InterpolationType:$f}=fA,{vtkErrorMacro:kv}=D,zf=4;function Dj(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let n=e.mtime,r;for(let i=0;i<zf;i++)e.componentData[i].rGBTransferFunction&&(r=e.componentData[i].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[i].piecewiseFunction&&(r=e.componentData[i].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].rGBTransferFunction!==a?(e.componentData[i].rGBTransferFunction=a,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].piecewiseFunction!==a?(e.componentData[i].piecewiseFunction=a,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),t.setPiecewiseFunction(i,a)},t.getScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(n<0||n>=zf)return kv("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==i?(e.componentData[n].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return n<0||n>=zf?(kv("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType($f.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType($f.LINEAR),t.getInterpolationTypeAsString=()=>D.enumToString($f,e.interpolationType)}const Rj={independentComponents:!1,interpolationType:$f.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function Mj(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Rj,n),D.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<zf;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}D.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),D.setGetArray(t,e,["labelOutlineThickness"]),Dj(t,e)}const Lj=D.newInstance(Mj,"vtkImageProperty");var Ij={newInstance:Lj};const{vtkDebugMacro:Vj}=D;function _j(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=Ij.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,o)=>i.map(s=>s[o]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){Vj("Recomputing bounds..."),e.mapperBounds=n.map(a=>a),t.computeMatrix();const i=new Float64Array(16);xe(i,e.matrix),Be.transformBounds(n,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=(n,r)=>{const i=e.mapper.getBoundsForSlice(n,r);if(!Be.isValid(i))return i;t.computeMatrix();const a=new Float64Array(16);return xe(a,e.matrix),Be.transformBounds(i,a)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}if(e.property!==null){let r=e.property.getMTime();n=r>n?r:n,e.property.getRGBTransferFunction()!==null&&(r=e.property.getRGBTransferFunction().getMTime(),n=r>n?r:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const bj={mapper:null,property:null,bounds:[...Be.INIT_BOUNDS]};function sE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bj,n),Y3.extend(t,e,n),e.boundsMTime={},D.obj(e.boundsMTime),D.set(t,e,["property"]),D.setGet(t,e,["mapper"]),D.getArray(t,e,["bounds"],6),_j(t,e)}const Nj=D.newInstance(sE,"vtkImageSlice");var Pj={newInstance:Nj,extend:sE};function cE(t){const e=wa.newInstance();let n=0,r=1024;return t.lower!==void 0&&t.upper!==void 0&&(n=t.lower,r=t.upper),e.addRGBPoint(n,0,0,0),e.addRGBPoint(r,1,1,1),e}function ad(t,e){const n=e.voxelManager.getScalarData();if(!t.getPointData)return;const r=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let a=0;a<e.columns*e.rows;a++)i[a*3]=n[a*4],i[a*3+1]=n[a*4+1],i[a*3+2]=n[a*4+2];e.rgba=!1,e.getPixelData=()=>i,r.set(i)}else r.set(n);t.modified()}function we(){return window.performance?performance.now():Date.now()}function kj(t,e){return function(n){const r=((n-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(r,0),255)}}function Fj(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,i=t.lut[t.lut.length-1]>>n,a=t.firstValueMapped+t.lut.length-1;return function(o){return o<t.firstValueMapped?r:o>=a?i:t.lut[o-t.firstValueMapped]>>n}}function lE(t,e,n){return n?Fj(n):kj(t,e)}function Uj(t,e,n,r,i){const a=t.maxPixelValue,o=t.minPixelValue,s=Math.min(o,0);if(t.cachedLut===void 0){const f=a-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(f)}const c=t.cachedLut.lutArray,l=lE(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,i);if(r)for(let f=o;f<=a;f++)c[f+-s]=255-l(f);else for(let f=o;f<=a;f++)c[f+-s]=l(f);return c}function Aj(t,e,n){let r=we();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=we()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=we(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o]=e[i[s]+-a],s+=2,o+=2;else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o]=e[i[s]],s+=2,o+=2;t.stats.lastStoredPixelDataToCanvasImageDataTime=we()-r}function Bj(t,e,n){let r=we();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=we()-r;const a=t.minPixelValue;let o=0,s=0;const c=i.length;if(r=we(),a<0)for(;s<c;)n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=e[i[s++]+-a],n[o++]=i[s++];else for(;s<c;)n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=e[i[s++]],n[o++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=we()-r}class k0{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new k0;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],a=this.m[1]*e[2]+this.m[3]*e[3],o=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,a=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=o,this.m[5]=s}rotate(e){const n=Math.cos(e),r=Math.sin(e),i=this.m[0]*n+this.m[2]*r,a=this.m[1]*n+this.m[3]*r,o=this.m[0]*-r+this.m[2]*n,s=this.m[1]*-r+this.m[3]*n;this.m[0]=i,this.m[1]=a,this.m[2]=o,this.m[3]=s}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function Tl(t,e){const n=new k0;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let i=t.viewport.scale,a=t.viewport.scale;const o=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(a*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,a=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*a),l=t.canvas.width/(o*i);i=a=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(a*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(i,a),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-o/2,-s/2),n}function cm(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=Tl(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function lm(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function ng(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const i=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=i}function um(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}function Gj(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(Uj(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function Wj(t,e,n){const r=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=document.createElement("canvas"));const i=t.renderingTools.renderCanvas,{windowWidth:a,windowCenter:o}=t.viewport.voi;if((a===256||a===255)&&(o===128||o===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!lm(t,e)&&!n)return i;(i.width!==e.width||i.height!==e.height)&&ng(t,e);let s=we();const c=Gj(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=we()-s;const l=t.renderingTools.renderCanvasData,f=t.renderingTools.renderCanvasContext;return e.rgba?Bj(e,c,l.data):Aj(e,c,l.data),s=we(),f.putImageData(l,0,0),e.stats.lastPutImageDataTime=we()-s,i}function $j(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,cm(t,r);const i=Wj(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=um(t)}function zj(t,e,n){let r=we();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=we()-r;const a=i.length,o=t.minPixelValue;let s=3,c=0;if(r=we(),i instanceof Int16Array)if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;else if(i instanceof Uint16Array)for(;c<a;)n[s]=e[i[c++]],s+=4;else if(o<0)for(;c<a;)n[s]=e[i[c++]+-o],s+=4;else for(;c<a;)n[s]=e[i[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=we()-r}function Hj(t,e,n){let r=we();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=we()-r;const a=i.length;let o=3,s=0;for(r=we();s<a;)n[o]=e(i[s++]),o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=we()-r}function jj(t,e,n){let r=we();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=we()-r;const a=i.length,o=t.minPixelValue;let s=0,c=0,l;if(r=we(),i instanceof Int16Array)if(o<0)for(;c<a;)l=e[i[c++]+-o],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else if(i instanceof Uint16Array)for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else if(o<0)for(;c<a;)l=e[i[c++]+-o],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;else for(;c<a;)l=e[i[c++]],n[s++]=l,n[s++]=l,n[s++]=l,n[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=we()-r}function Kj(t,e){if(qj(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,i=n-r,a=(n+r)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:a}:(t.voi.windowWidth=i,t.voi.windowCenter=a)}function qj(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function Fv(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function Xj(t,e){return n=>n*t+e}function Yj(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=r?n:t.lut[i]}function Zj(t,e,n){return n?Yj(n):Xj(t,e)}function Jj(t,e,n,r,i,a){const o=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const g=o-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(g)}const l=t.cachedLut.lutArray,f=Zj(t.slope,t.intercept,i),u=lE(e,n,a);if(t.isPreScaled)if(r)for(let g=s;g<=o;g++)l[g+-c]=255-u(g);else for(let g=s;g<=o;g++)l[g+-c]=u(g);else if(r)for(let g=s;g<=o;g++)l[g+-c]=255-u(f(g));else for(let g=s;g<=o;g++)l[g+-c]=u(f(g));return l}function uE(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&Fv(t.cachedLut.modalityLUT,e.modalityLUT)&&Fv(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!n||(Kj(e,t),Jj(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function Qj(t,e,n,r=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=document.createElement("canvas"),ng(t,e));const a=t.renderingTools.renderCanvas;if(!lm(t,e)&&!n)return a;(a.width!==e.width||a.height!==e.height)&&ng(t,e),e.stats=e.stats||{};const o=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=we();e.stats.lastLutGenerateTime=we()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:f,windowCenter:u}=l.voi,g=u-f/2,p=255/(u+f/2-g);let m;l.invert?m=v=>255-(v-g)*p:m=v=>(v-g)*p,Hj(e,m,o.data)}else{const f=uE(e,l,n);r?zj(e,f,o.data):jj(e,f,o.data)}return c=we(),s.putImageData(o,0,0),e.stats.lastPutImageDataTime=we()-c,a}function eK(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,cm(t,r);const i=Qj(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=um(t)}const _h=0,bh=1,tK=2;function nK(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const i=Math.floor(t*6),a=6*t-i,o=n*(1-e),s=n*(1-e*a),c=n*(1-e*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=c,r[2]=o;break;case 1:r[0]=s,r[1]=n,r[2]=o;break;case 2:r[0]=o,r[1]=n,r[2]=c;break;case 3:r[0]=o,r[1]=s,r[2]=n;break;case 4:r[0]=c,r[1]=o,r[2]=n;break;case 5:r[0]=n,r[1]=o,r[2]=s;break}return r}function rK(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+_h+1.5:t>e.Range[1]?n=e.MaxIndex+bh+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class fm{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,i,a,o;n?(r=(this.HueRange[1]-this.HueRange[0])/n,i=(this.SaturationRange[1]-this.SaturationRange[0])/n,a=(this.ValueRange[1]-this.ValueRange[0])/n,o=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=i=a=o=0;for(let s=0;s<=n;s++){const c=this.HueRange[0]+s*r,l=this.SaturationRange[0]+s*i,f=this.ValueRange[0]+s*a,u=this.AlphaRange[0]+s*o,g=nK(c,l,f),d=[0,0,0,0];switch(this.Ramp){case"scurve":d[0]=Math.floor(127.5*(1+Math.cos((1-g[0])*Math.PI))),d[1]=Math.floor(127.5*(1+Math.cos((1-g[1])*Math.PI))),d[2]=Math.floor(127.5*(1+Math.cos((1-g[2])*Math.PI))),d[3]=Math.floor(u*255);break;case"linear":d[0]=Math.floor(g[0]*255+.5),d[1]=Math.floor(g[1]*255+.5),d[2]=Math.floor(g[2]*255+.5),d[3]=Math.floor(u*255+.5);break;case"sqrt":d[0]=Math.floor(Math.sqrt(g[0])*255+.5),d[1]=Math.floor(Math.sqrt(g[1])*255+.5),d[2]=Math.floor(Math.sqrt(g[2])*255+.5),d[3]=Math.floor(Math.sqrt(u)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(d)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+_h,r=e+bh,i=e+tK;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=rK(e,n);return r===this.NumberOfColors+_h?r=0:r===this.NumberOfColors+bh&&(r=this.NumberOfColors-1),r}setTableValue(e,n,r,i,a){let o;if(typeof n=="number"&&r!==void 0&&i!==void 0&&a!==void 0)o=[n,r,i,a];else if(Array.isArray(n))o=n;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=o,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const Uv=[0,0,0,0];function iK(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),i=[];for(;n-- >0;)i.push(t),t+=r;return i[i.length-1]=e,i}function aK(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=n+Math.floor((r-n)/2),a=t[i];if(a===e)return i;e<a?r=i-1:n=i+1}return n}function oK(t,e){let n;const r=[],i=e.length;for(t.sort(function(a,o){return a-o}),n=0;n<i;n++)r[n]=aK(t,e[n]);return r}function I2(t,e,n){let r;const i=[],a=[],o=[],s=[];for(n=n===null?1:n,r=0;r<e.length;r++){const f=e[r];i.push((t-1)*f[0]),a.push(f[1]),o.push(f[1])}const c=iK(0,1,t);for(r=0;r<t;r++)c[r]=(t-1)*Math.pow(c[r],n);const l=oK(i,c);for(r=1;r<t-1;r++){const f=l[r],u=(c[r]-i[f-1])/(i[f]-i[f-1]),g=a[f]-o[f-1];s[r]=u*g+o[f-1]}return s[0]=o[0],s[t-1]=a[e.length-1],s}function sK(t,e,n){let r;const i=[];e=e===null?256:e,n=n===null?1:n;const a=I2(e,t.red,n),o=I2(e,t.green,n),s=I2(e,t.blue,n);for(r=0;r<e;r++){const c=Math.round(a[r]*255),l=Math.round(o[r]*255),f=Math.round(s[r]*255),u=[c,l,f,255];i.push(u)}return i}function cK(t,e){let n=oh[t];return n||(n=oh[t]={name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=sK(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(i){n.name=i},getNumberOfColors(){return n.colors.length},setNumberOfColors(i){for(;n.colors.length<i;)n.colors.push(Uv);n.colors.length=i},getColor(i){return this.isValidIndex(i)?n.colors[i]:Uv},getColorRepeating(i){const a=n.colors.length;return i=a?i%a:0,this.getColor(i)},setColor(i,a){this.isValidIndex(i)&&(n.colors[i]=a)},addColor(i){n.colors.push(i)},insertColor(i,a){this.isValidIndex(i)&&n.colors.splice(i,1,a)},removeColor(i){this.isValidIndex(i)&&n.colors.splice(i,1)},clearColors(){n.colors=[]},buildLookupTable(i){if(!i)return;const a=n.colors.length;i.setNumberOfTableValues(a);for(let o=0;o<a;o++)i.setTableValue(o,n.colors[o])},createLookupTable(){const i=new fm;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<n.colors.length}}}function lK(t,e,n,r){let i=we();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=we()-i;const o=a.length,s=t.minPixelValue;let c=0,l=0,f,u,g;if(i=we(),n instanceof fm?g=n.Table:g=n,s<0)for(;l<o;)f=e[a[l++]+-s],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<o;)f=e[a[l++]],u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=we()-i}function uK(t,e,n,r){let i=we();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=we()-i;const o=a.length,s=t.minPixelValue;let c=0,l=0,f,u,g;if(i=we(),n instanceof fm?g=n.Table:g=n,s<0)for(;l<o;)f=e(a[l++]+-s),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];else for(;l<o;)f=e(a[l++]),u=g[f],r[c++]=u[0],r[c++]=u[1],r[c++]=u[2],r[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=we()-i}function Nh(t,e,n){return Math.max(e,Math.min(n,t))}function fK(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=document.createElement("canvas"));const r=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=cK(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const a=i.getId();if(!lm(t,e)&&!n&&t.renderingTools.colormapId===a)return r;(r.width!==e.width||r.height!==e.height)&&ng(t,e);let o=we();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==a)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=a);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,f=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:u,windowCenter:g}=l.voi,d=g-u/2,m=255/(g+u/2-d);let v;l.invert?v=y=>Nh(Math.floor(255-(y-d)*m),0,255):v=y=>Nh(Math.floor((y-d)*m),0,255),uK(e,v,f,s.data)}else{const u=uE(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=we()-o,lK(e,u,f,s.data)}return o=we(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=we()-o,r}function gK(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,cm(t,r);const i=fK(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,o=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-o;r.drawImage(i,a,o,s,c,0,0,s,c),t.renderingTools=um(t)}function fE(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=we();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let a=n.render;a||(t.viewport.colormap?a=gK:n.color?a=$j:a=eK),a(t,e)}const i=we()-r;n.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function gE(t){return Tl(t)}function Hu(t,e){const n=gE(t);return n.invert(),n.transformPoint(e)}const dK={viewport:{}};function pK(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function hK(){const t=pK();return Object.assign({},{scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t},dK.viewport)}function Gc(t,e){if(t==null)throw new Error(e)}function mK(t){return!(t==null||t===0||t===180)}function dE(t,e=null){return Gc(t,"getImageSize: parameter image must not be undefined"),Gc(t.width,"getImageSize: parameter image must have width"),Gc(t.height,"getImageSize: parameter image must have height"),mK(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function gm(t,e,n=null){Gc(t,"getImageScale: parameter canvas must not be undefined"),Gc(e,"getImageScale: parameter image must not be undefined");const r=dE(e,n),i=e.rowPixelSpacing||1,a=e.columnPixelSpacing||1;let o=1,s=1;i<a?s=a/i:o=i/a;const c=t.height/r.height/o,l=t.width/r.width/s;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function pE(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return hK();const i=gm(t,e,0).scaleFactor;let a;return n==="PT"&&e.isPreScaled?a={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(a={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:a,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function Av(t,e){return gE(t).transformPoint(e)}function vK(t){const{image:e}=t;t.viewport.scale=gm(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function yK(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function CK(t,e,n){const r=t.viewport.scale,i=dE(t.image,t.viewport.rotation),a=Math.round(i.width*r),o=Math.round(i.height*r),s=t.viewport.translation.x,c=t.viewport.translation.y;return a===e&&o<=n||a<=e&&o===n&&s===0&&c===0}function TK(t,e,n){const r=t.viewport.scale,i=t.canvas.width,a=t.canvas.height,o=i/e,s=a/n,c=Math.sqrt(o*s);t.viewport.scale=c*r}function SK(t,e=!1){const n=t.canvas.width,r=t.canvas.height;yK(t),t.image!==void 0&&(e||CK(t,n,r)?vK(t):TK(t,n,r))}function xK(t,e){const{hflip:n,vflip:r,rotation:i}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,i!==0){const a=i*Math.PI/180,o=Math.cos(a),s=Math.sin(a),c=t.x*o-t.y*s,l=t.x*s+t.y*o;t.x=c,t.y=l}return t}function wK(t,e=!0,n=!0){const{canvas:r,image:i,viewport:a}=t,o=gm(r,i,0).scaleFactor;a.vflip=!1,a.hflip=!1,e&&(a.translation.x=0,a.translation.y=0),n&&(a.displayedArea.tlhc.x=1,a.displayedArea.tlhc.y=1,a.displayedArea.brhc.x=i.columns,a.displayedArea.brhc.y=i.rows,a.scale=o)}const EK=1;class fr extends p0{constructor(e){super(e),this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&SK(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=n=>{var r;return(r=this.getImagePlaneReferenceData(n))==null?void 0:r.FrameOfReferenceUID},this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=n=>{const r=Oj.newInstance();r.setInputData(n);const i=Pj.newInstance();i.setMapper(r);const{preferSizeOverAccuracy:a}=Q3().rendering;return a&&r.setPreferSizeOverAccuracy(!0),n.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=n=>{let r;return n!==void 0&&(r=this.perImageIdDefaultProperties.get(n)),r!==void 0?r:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,voiUpdatedWithSetProperties:s}=this;return{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:o,isComputedVOI:!s}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:n}=this._cpuFallbackEnabledElement;return n.rotation},this.getRotationGPU=()=>{const{viewUp:n,viewPlaneNormal:r,flipVertical:i}=this.getCameraNoRotation(),a=i?vo(te(),this.initialViewUp):this.initialViewUp,o=cC(a,n)*180/Math.PI,s=vt(te(),a,n);return fe(s,r)>=0?o:(360-o)%360},this.setRotation=n=>{const r=this.getCamera();if(this.useCPURendering?this.setRotationCPU(n):this.setRotationGPU(n),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),a={previousCamera:r,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Z(this.element,X.CAMERA_MODIFIED,a)},this.renderImageObject=n=>{this._setCSImage(n),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,n)},this._setCSImage=n=>{var r;n.isPreScaled=(r=n.preScale)==null?void 0:r.scaled,this.csImage=n},this.canvasToWorldCPU=(n,r=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,a]=Hu(this._cpuFallbackEnabledElement,n),{origin:o,spacing:s,direction:c}=this.getImageData(),l=c.slice(0,3),f=c.slice(3,6);return dn(r,o,l,i*s[0]),dn(r,r,f,a*s[1]),r},this.worldToCanvasCPU=n=>{const{spacing:r,direction:i,origin:a}=this.getImageData(),o=i.slice(0,3),s=i.slice(3,6),c=rt(te(),n,a),l=[fe(c,o)/r[0],fe(c,s)/r[1]];return Av(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[n[0]*f,n[1]*f],g=[u[0]+this.sx,u[1]+this.sy];g[1]=l[1]-g[1];const d=c.displayToWorld(g[0],g[1],0,r);return i.setClippingRange(a[0],a[1]),[d[0],d[1],d[2]]},this.worldToCanvasGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),o=i.getDistance();i.setClippingRange(o,o+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...n,r);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy];i.setClippingRange(a[0],a[1]);const g=window.devicePixelRatio||1;return[u[0]/g,u[1]/g]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=()=>this.imageIds[this.currentImageIdIndex],this.hasImageId=n=>this.imageIds.includes(n),this.hasImageURI=n=>{const r=this.imageIds;for(let i=0;i<r.length;i++)if(Dn(r[i])===n)return!0;return!1},this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(fE(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraCPU({resetPan:r,resetZoom:i}),!0},gpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraGPU({resetPan:r,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:this.canvasToWorldGPU},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:this.worldToCanvasGPU},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:super.getRenderer},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=Uc(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.imageIds=[],this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return Uc()}_configureRenderingPipeline(e){this.useCPURendering=e??Uc();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const r=this.renderingPipelineFunctions[n];this[n]=this.useCPURendering?r.cpu:r.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new k0,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),n=K3.newInstance();e.setActiveCamera(n);const r=[0,0,-1];this.initialViewUp=[0,-1,0],n.setDirectionOfProjection(-r[0],-r[1],-r[2]),n.setViewUp(...this.initialViewUp),n.setParallelProjection(!0),n.setThicknessFromFocalPoint(.1),n.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){Y.addEventListener(X.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),Y.removeEventListener(X.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!jr(e))return;const{actor:n}=e,r=n.getMapper().getInputData(),i=this.csImage;return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),get scalarData(){return i==null?void 0:i.voxelManager.getScalarData()},imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i==null?void 0:i.calibration,...this.calibration},preScale:{...i==null?void 0:i.preScale},voxelManager:i==null?void 0:i.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement,n=e.spacing,r=this.csImage;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:i=>{const a=this.worldToCanvasCPU(i),o=Hu(this._cpuFallbackEnabledElement,a);return[o[0],o[1],0]},indexToWorld:(i,a)=>{const o=Av(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(o,a)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...r==null?void 0:r.calibration,...this.calibration},preScale:{...r==null?void 0:r.preScale},voxelManager:r==null?void 0:r.voxelManager}}buildMetadata(e){const n=e.imageId,{pixelRepresentation:r,bitsAllocated:i,bitsStored:a,highBit:o,photometricInterpretation:s,samplesPerPixel:c}=ee("imagePixelModule",n),{windowWidth:l,windowCenter:f,voiLUTFunction:u}=e,{modality:g}=ee("generalSeriesModule",n),d=ee("scalingModule",n),h=ee(En.CALIBRATION,n);g==="PT"&&d&&this._addScalingToViewport(d),this.modality=g;const p=this._getValidVOILUTFunction(u);this.VOILUTFunction=p,this.calibration=h;let m=this._getImagePlaneModule(n);return this.useCPURendering||(m=this.calibrateIfNecessary(n,m)),{imagePlaneModule:m,imagePixelModule:{bitsAllocated:i,bitsStored:a,samplesPerPixel:c,highBit:o,photometricInterpretation:s,pixelRepresentation:r,windowWidth:l,windowCenter:f,modality:g,voiLUTFunction:p}}}calibrateIfNecessary(e,n){const r=ee("calibratedPixelSpacing",e),i=this.calibration!==r,{scale:a}=r||{};return this.hasPixelSpacing=a>0||n.rowPixelSpacing>0,n.calibration=r,i&&(this.calibration=r,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:a,calibration:r}),n}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(n,e),this.getCurrentImageId()===n&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:i,interpolationType:a}={},o=!1){this.viewportStatus=this.csImage?xn.PRE_RENDER:xn.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??n,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??r,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??a},typeof e<"u"&&this.setColormap(e),typeof n<"u"&&this.setVOI(n,{suppressEvents:o,voiUpdatedWithSetProperties:!0}),typeof r<"u"&&this.setVOILUTFunction(r,o),typeof i<"u"&&this.setInvertColor(i),typeof a<"u"&&this.setInterpolationType(a)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=xn.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(vi.LINEAR);const n=this.getTransferFunction();nd(n,this.initialTransferFunctionNodes);const i=J1(n).reduce((s,c)=>(s.push(c[0],c[1],c[2],c[3]),s),[]),a=this.getDefaultActor(),o=tm(i,a.actor);this.setColormap(o)}resetToDefaultProperties(){var i;this.cpuRenderingInvalidated=!0,this.viewportStatus=xn.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),n=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;(i=n.colormap)!=null&&i.name&&this.setColormap(n.colormap);let r;n.voiRange==null?r=this._getVOIRangeForCurrentImage():r=n.voiRange,this.setVOI(r),this.setInterpolationType(vi.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:n,invert:r}=this;this.setVOI(e),this.setInterpolationType(n),this.setInvertColor(r)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement,{direction:r}=e,i=r.slice(6,9).map(u=>-u);let a=r.slice(3,6).map(u=>-u);if(n.rotation){const u=r3(Ia(),n.rotation*Math.PI/180,i);a=Ee(te(),a,u)}const o=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(o),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),f=D1(c,l)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:f,scale:n.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[a[0],a[1],a[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:a,parallelScale:o,scale:s,flipHorizontal:c,flipVertical:l}=e,{clientHeight:f}=this.element;if(a){const g=this.worldToCanvasCPU(a),d=Hu(this._cpuFallbackEnabledElement,g),h=this.worldToCanvasCPU(i.focalPoint),p=Hu(this._cpuFallbackEnabledElement,h),m=Si();c0(m,y8(d[0],d[1]),y8(p[0],p[1]));const v=xK({x:m[0],y:m[1]},n);n.translation.x-=v.x,n.translation.y-=v.y}if(o){const{rowPixelSpacing:g}=r,d=f*g*.5/o;n.scale=d,n.parallelScale=o}if(s){const{rowPixelSpacing:g}=r;n.scale=s,n.parallelScale=f*g*.5/s}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=Tl(this._cpuFallbackEnabledElement);const u={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Z(this.element,X.CAMERA_MODIFIED,u)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,focalPoint:[...e.map(r=>-r),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOILUTFunction(e,n){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const r=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==r&&(i=!0),this.VOILUTFunction=r;const{voiRange:a}=this.getProperties();this.setVOI(a,{suppressEvents:n,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.rotation=e}setRotationGPU(e){const n=this.getPan(this.fitToCanvasCamera),r=this.getPan(),i=M1([0,0],n,r);this.setPan(i,!1);const{flipVertical:a}=this.getCamera(),o=a?vo(te(),this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:o}),this.getVtkActiveCamera().roll(-e);const s=this.getPan(),c=this.getPan(this.fitToCanvasCamera),l=M1([0,0],s,c),f=o3([0,0],n,l);this.setPan(f,!1)}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n||!jr(n))return;const{actor:r}=n;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.pixelReplication=e!==vi.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n&&(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(n&&jr(n)){if(Gn(n,"vtkVolume")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Ac(i),this.invert=e}else if(Gn(n,"vtkImageSlice")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Ac(i),this.invert=e}}}setVOICPU(e,n={}){const{suppressEvents:r=!1}=n,{viewport:i,image:a}=this._cpuFallbackEnabledElement;if(!i||!a)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:c}=a,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;i.voi={windowWidth:l,windowCenter:f};const{lower:u,upper:g}=$s(l,f);e={lower:u,upper:g}}else{const{lower:s,upper:c}=e,{windowCenter:l,windowWidth:f}=td(s,c);i.voi||(i.voi={windowWidth:0,windowCenter:0}),i.voi.windowWidth=f,i.voi.windowCenter=l}this.voiRange=e;const o={viewportId:this.id,range:e};r||Z(this.element,X.VOI_MODIFIED,o)}getTransferFunction(){const e=this.getDefaultActor();return!e||!jr(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,n={}){const{suppressEvents:r=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:a=!1}=n;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const o=this.getDefaultActor();if(!o||!jr(o))return;const s=o.actor;let c=e;if(typeof c>"u"){const d=s.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:d[0],upper:d[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let l=s.getProperty().getRGBTransferFunction(0);const f=this.VOILUTFunction===Ti.SAMPLED_SIGMOID;if((f||!l||i)&&(l=(f?nm:cE)(c),this.invert&&Ac(l),s.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=J1(l)),f||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=a),r)return;const u={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};Z(this.element,X.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),this.scaling.PT=a}_getNumCompsFromPhotometricInterpretation(e){let n=1;return(e==="RGB"||e.includes("YBR")||e==="PALETTE COLOR")&&(n=3),n}getImageDataMetadata(e){const{imagePlaneModule:n,imagePixelModule:r}=this.buildMetadata(e);let i,a;i=n.rowCosines,a=n.columnCosines,(i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const o=Ze(i[0],i[1],i[2]),s=Ze(a[0],a[1],a[2]),c=te();vt(c,o,s);let l=n.imagePositionPatient;l==null&&(l=[0,0,0]);const f=n.columnPixelSpacing||e.columnPixelSpacing,u=n.rowPixelSpacing||e.rowPixelSpacing,g=e.columns,d=e.rows,h=EK,p=1,m=e.numberOfComponents||this._getNumCompsFromPhotometricInterpretation(r.photometricInterpretation);return{bitsAllocated:r.bitsAllocated,numberOfComponents:m,origin:l,direction:[...o,...s,...c],dimensions:[g,d,p],spacing:[f,u,h],numVoxels:g*d*p,imagePlaneModule:n,imagePixelModule:r}}matchImagesForOverlay(e,n){return(i=>{const a=ee(En.IMAGE_PLANE,n),o=ee(En.IMAGE_PLANE,i),s=a.imageOrientationPatient,c=o.imageOrientationPatient;if(s&&c){if(Vt(a.imageOrientationPatient,o.imageOrientationPatient)){const f=a.imagePositionPatient,u=o.imagePositionPatient;if(f&&u&&Vt(f,u)){const d=a.rows,h=a.columns,p=o.rows,m=o.columns;if(d===p&&h===m)return i}}}else{const l=a.rows,f=a.columns,u=o.rows,g=o.columns;if(l===u&&f===g)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const n=this.imageIds[e];if(!n)return;const r=ee(En.IMAGE_PLANE,n);if(!r)return;const{imagePositionPatient:i,frameOfReferenceUID:a}=r;let{rowCosines:o,columnCosines:s}=r;o||(o=[1,0,0]),s||(s=[0,1,0]);const c=vt([0,0,0],s,o);return{FrameOfReferenceUID:a,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:n,sliceIndex:e}}_getCameraOrientation(e){const n=e.slice(6,9).map(i=>-i),r=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){const s=new o.constructor(o.length),c=he.newInstance({name:"Pixels",numberOfComponents:a,values:s}),l=Kg.newInstance();return l.setDimensions(r),l.setSpacing(i),l.setDirection(n),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o}){try{this._imageData=this.createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:o})}catch(s){console.error(s)}}async setStack(e,n=0){this._throwIfDestroyed(),this.imageIds=e,this.currentImageIdIndex=n,this.targetImageIdIndex=n;const r=ee(Cl.IMAGE_RETRIEVE_CONFIGURATION,e[n],"stack");this.imagesLoader=r?(r.create||jw)(r):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=vi.LINEAR,this.invert=!1,this.viewportStatus=xn.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(n),a={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return Z(this.element,X.VIEWPORT_NEW_IMAGE_SET,a),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,i]=n.getSpacing(),[a,o]=n.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=n.getDirection(),l=c.slice(0,3),f=c.slice(3,6),u=n.getPointData().getScalars().getDataType(),g=Vt(r,e.columnPixelSpacing),d=Vt(i,e.rowPixelSpacing),h=g||e.columnPixelSpacing===null&&r===1,p=d||e.rowPixelSpacing===null&&i===1,m=a===e.columns,v=o===e.rows,y=Vt(s.rowCosines,l),C=Vt(s.columnCosines,f),T=u===e.voxelManager.getScalarData().constructor.name;return h&&p&&m&&v&&y&&C&&T}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r),ad(this._imageData,e)}_loadAndDisplayImage(e,n){return this.useCPURendering?this._loadAndDisplayImageCPU(e,n):this._loadAndDisplayImageGPU(e,n)}_loadAndDisplayImageCPU(e,n){return new Promise((r,i)=>{function a(d,h,p){if(this.currentImageIdIndex!==h)return;const m=d.voxelManager.getScalarData(),v=d.preScale,y=v==null?void 0:v.scalingParameters,C=(v==null?void 0:v.scaled)&&(y==null?void 0:y.rescaleIntercept)%1!==0||(y==null?void 0:y.rescaleSlope)%1!==0;if(m instanceof Float32Array&&C){const S={min:d.maxPixelValue,max:d.minPixelValue},E=Math.abs(S.max-S.min)/65535,M=S.min,O=m.length,R=new Uint16Array(O);let _=65535,P=0;for(let N=0;N<O;N++){const W=Math.floor((m[N]-M)/E);R[N]=W,_=Math.min(_,W),P=Math.max(P,W)}d.minPixelValue=_,d.maxPixelValue=P,d.slope=E,d.intercept=M,d.getPixelData=()=>R,d.preScale={...d.preScale,scaled:!1}}this._setCSImage(d),this.viewportStatus=xn.PRE_RENDER;const T={image:d,imageId:p,imageIdIndex:h,viewportId:this.id,renderingEngineId:this.renderingEngineId};Z(this.element,X.STACK_NEW_IMAGE,T),this._updateToDisplayImageCPU(d),this.render(),this.currentImageIdIndex=h,r(p)}function o(d,h,p){const m={error:d,imageIdIndex:h,imageId:p};this.suppressEvents||Z(Y,X.IMAGE_LOAD_ERROR,m),i(d)}function s(d,h,p){return Vo(d,p).then(m=>{a.call(this,m,h,d)},m=>{o.call(this,m,h,d)})}const c=-5,l=ye.Interaction,f={imageId:e,imageIdIndex:n},u={useRGBA:!0,requestType:l},g={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};Z(this.element,X.PRE_STACK_NEW_IMAGE,g),Jr.addRequest(s.bind(this,e,n,u),l,f,c)})}successCallback(e,n){var l,f;const r=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==r)return;const i=(l=this.csImage)==null?void 0:l.imageFrame,a=n==null?void 0:n.imageFrame,o=(i==null?void 0:i.photometricInterpretation)||((f=this.csImage)==null?void 0:f.photometricInterpretation),s=(a==null?void 0:a.photometricInterpretation)||(n==null?void 0:n.photometricInterpretation);o!==s&&(this.stackInvalidated=!0),this._setCSImage(n);const c={image:n,imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(n),Z(this.element,X.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=r}errorCallback(e,n,r){if(!n)return;const i=this.imageIds.indexOf(e),a={error:r,imageIdIndex:i,imageId:e};Z(Y,X.IMAGE_LOAD_ERROR,a)}getLoaderImageOptions(e){const n=this.imageIds.indexOf(e),{transferSyntaxUID:r}=ee("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:r,priority:5,requestType:ye.Interaction,additionalDetails:{imageId:e,imageIdIndex:n}}}async loadImages(e,n){const r=await Promise.allSettled(e.map(a=>{const o=this.getLoaderImageOptions(a);return Vo(a,o).then(s=>(n.successCallback(a,s),a),s=>(n.errorCallback(a,!0,s),a))})),i=r.filter(a=>a.status==="rejected");if(i&&i.length){const a=new CustomEvent(X.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});Y.dispatchEvent(a)}return r}_loadAndDisplayImageGPU(e,n){const r={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};return Z(this.element,X.PRE_STACK_NEW_IMAGE,r),this.imagesLoader.loadImages([e],this).then(i=>e)}_updateToDisplayImageCPU(e){const n=this.getImageDataMetadata(e),r=pE(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:a}=r.voi;this.voiRange=$s(a,i),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...n},this.cpuImagePixelData=e.voxelManager.getScalarData();const o=Object.assign({},r,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?r:o,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=Tl(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const n=[];e.forEach(r=>{const{imageId:i,...a}=r,o=Q.getImage(i),{origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u}=this.getImageDataMetadata(o),g=this.createVTKImageData({origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u,pixelArray:o.voxelManager.getScalarData()}),d=this.createActorMapper(g);d&&(n.push({uid:r.actorUID??bt(),actor:d,referencedId:i,...a}),r.callback&&r.callback({imageActor:d,imageId:r.imageId}))}),this.addActors(n)}_updateActorToDisplayImageId(e){const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getViewPresentation();if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(r),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),f=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:a,dimensions:o,spacing:s,numberOfComponents:c,pixelArray:f}),this._updateVTKImageDataFromCornerstoneImage(e);const u=this.createActorMapper(this._imageData),g=this.getActors();g.length&&g[0].uid===this.id?g[0].actor=u:g.unshift({uid:this.id,actor:u}),this.setActors(g);const{viewPlaneNormal:d,viewUp:h}=this._getCameraOrientation(a),p=this.getCamera();this.setCameraNoEvent({viewUp:h,viewPlaneNormal:d}),this.initialViewUp=h,this.resetCameraNoEvent(),this.setViewPresentation(r),this.triggerCameraEvent(this.getCamera(),p);const m=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const v=this._getInitialVOIRange(e);this.setVOI(v,{forceRecreateLUTFunction:!!m}),this.initialInvert=!!m,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.globalDefaultProperties.voiRange;const{windowCenter:n,windowWidth:r}=e;let i=this._getVOIRangeFromWindowLevel(r,n);return i=this._getPTPreScaledRange()||i,i}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){var e;return!(this.modality!=="PT"||!this.csImage.isPreScaled||!((e=this.csImage.preScale)!=null&&e.scalingParameters.suvbw))}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,n){let r,i;if(typeof n=="number"&&typeof e=="number"?(r=n,i=e):Array.isArray(n)&&Array.isArray(e)&&(r=n[0],i=e[0]),r!==void 0&&i!==void 0)return $s(i,r)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=xn.PRE_RENDER;const n=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const r=this.perImageIdDefaultProperties.get(n);r!==void 0?this.setProperties(r):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return n}resetCameraCPU({resetPan:e=!0,resetZoom:n=!0}){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;wK(this._cpuFallbackEnabledElement,e,n);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:a,clientHeight:o}=this.element,s=[a/2,o/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:n}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:!0})}scroll(e,n=!0,r=!1){const i=this.imageIds,a=this.targetImageIdIndex,o=i.length;let s=a+e;s=Math.max(0,s),r?s=s%o:s=Math.min(o-1,s),this.targetImageIdIndex=s;const c=i[s];Q.isLoaded(c)||!n?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const f={newImageIdIndex:s,imageId:c,direction:e};s!==a&&Z(this.element,X.STACK_VIEWPORT_SCROLL,f)}setImageIdIndex(e){return this._throwIfDestroyed(),this.currentImageIdIndex===e?Promise.resolve(this.getCurrentImageId()):this._setImageIdIndex(e)}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Z(this.element,X.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Z(this.element,X.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}jumpToWorld(e){const n=this.getImageIds(),r=this.getImageData(),{direction:i,spacing:a}=r,o=ml({direction:i,spacing:a,imageIds:n},e,this.getCamera().viewPlaneNormal),s=n.indexOf(o);return s===-1?!1:(this.setImageIdIndex(s),this.render(),!0)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:n}=this.csImage;return this._getVOIRangeFromWindowLevel(n,e)}_getValidVOILUTFunction(e){return Object.values(Ti).includes(e)?e:Ti.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:n}=this.getImageData();return{width:n[0],height:n[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,n={}){if(!super.isReferenceViewable(e,n))return!1;const{referencedImageId:r,sliceIndex:i}=e;if(e.volumeId&&!r)return n.asVolume;let a=this.getCurrentImageIdIndex(),o=this.imageIds[a];if(n.withNavigation&&typeof i=="number"&&(a=i,o=this.imageIds[a]),!o)return!1;if(n.asOverlay&&r&&this.matchImagesForOverlay(o,r))return!0;let{imageURI:s}=n;s||(s=Dn(o));const l=Dn(r)===s;if(l)return l;const{cameraFocalPoint:f}=e;if(n.asNearbyProjection&&f){const{spacing:u,direction:g,origin:d}=this.getImageData(),h=g.slice(6,9),p=f0({direction:g,spacing:u},h),m=rt(te(),f,d),v=fe(m,h),y=p/2;if(Math.abs(v)<=y)return!0}return!1}getViewReference(e={}){const{sliceIndex:n=this.getCurrentImageIdIndex()}=e,r=super.getViewReference(e),i=this.imageIds[n];if(i){if(r.referencedImageId=i,this.getCurrentImageIdIndex()!==n){const a=this.getImagePlaneReferenceData(n);if(!a)return;Object.assign(r,a)}return r}}setViewReference(e){if(!e)return;const{referencedImageId:n,sliceIndex:r}=e;if(typeof r=="number"&&n&&n===this.imageIds[r])this.scroll(r-this.targetImageIdIndex);else{const i=this.imageIds.indexOf(n);if(i!==-1)this.scroll(i-this.targetImageIdIndex);else throw new Error("Unsupported - referenced image id not found")}}getViewReferenceId(e={}){const{sliceIndex:n=this.currentImageIdIndex}=e;if(Array.isArray(n))throw new Error("Use of slice ranges for stacks not supported");return`imageId:${this.imageIds[n]}`}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const n=yl(e.name);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const r={viewportId:this.id,colormap:e};Z(this.element,X.COLORMAP_MODIFIED,r)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),a=i.getRGBTransferFunction(),o=yl(e.name)||K1.getPresetByName(e.name);if(a)a.applyColorMap(o),a.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,a);else{const c=wa.newInstance();c.applyColorMap(o),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};Z(this.element,X.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){var i;const n=ee(En.IMAGE_PLANE,e);this.hasPixelSpacing=!n.usingDefaultValues||((i=this.calibration)==null?void 0:i.scale)>0,this.calibration||(this.calibration=n.calibration);const r={...n};return r.columnPixelSpacing||(r.columnPixelSpacing=1),r.rowPixelSpacing||(r.rowPixelSpacing=1),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}}class hE extends Fr{constructor(e){super(e),this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:n,orientation:r}=this.options,i=this.getVtkActiveCamera();n!=null&&i.setParallelProjection(n),r&&r!==o0.ACQUISITION&&this.applyViewOrientation(r)}resetCamera({resetPan:e=!0,resetZoom:n=!0,resetToCenter:r=!0}={}){super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:r});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-dt.MAXIMUM_RAY_DISTANCE,dt.MAXIMUM_RAY_DISTANCE):i.setClippingRange(dt.MINIMUM_SLAB_THICKNESS,dt.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,n){return null}setBlendMode(e,n,r){return null}resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=dt.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=Q.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(sm(n.actor,r),jr(n)){const i=n.actor.getProperty().getRGBTransferFunction(0);nd(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),Z(this.element,X.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-dt.MAXIMUM_RAY_DISTANCE,dt.MAXIMUM_RAY_DISTANCE):e.setClippingRange(dt.MINIMUM_SLAB_THICKNESS,dt.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}const mE="viewport-element",vE="cornerstone-canvas",Bv=1e-4;function OK(t){const e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.imageRendering="pixelated",e.classList.add(vE),t.appendChild(e),e}function DK(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(mE),t.appendChild(e),e}function di(t){const e=`canvas.${vE}`,n=`div.${mE}`,r=t.querySelector(n)||DK(t),i=r.querySelector(e);if(i)return i;const a=OK(r),o=r.getBoundingClientRect(),s=window.devicePixelRatio||1,c=Math.ceil(o.width*s),l=Math.ceil(o.height*s);return a.width=c,a.height=l,a}async function RK(t,e,n,r=!1,i=!1){n.forEach(o=>{const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof Fr))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const a=n.map(async o=>{await t.getViewport(o).setVolumes(e,r,i)});await Promise.all(a)}async function MK(t,e,n,r=!1,i=!1){for(const o of n){const s=t.getViewport(o);if(!s)throw new Error(`Viewport with Id ${o} does not exist`);if(!(s instanceof Fr)){console.warn(`Viewport with Id ${o} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const a=n.map(async o=>{await t.getViewport(o).addVolumes(e,r,i)});await Promise.all(a)}async function LK(t,e,n){for(const i of n){const a=t.getStackViewport(i);if(!a)throw new Error(`Viewport with Id ${i} does not exist`);if(!a.addImages){console.warn(`Viewport with Id ${i} does not have addImages. Cannot add image segmentation to this viewport.`);return}}const r=n.map(async i=>{t.getStackViewport(i).addImages(e)});await Promise.all(r)}class IK{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,n){this.transferFunction[e]=n}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const n=this.transferFunction[0],r=n.getRedValue(e),i=n.getGreenValue(e),a=n.getBlueValue(e);return[r,i,a,this.opacity]}}class VK{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class _K{constructor(e,n){this.canvasProperties=new IK(this),this.visibility=!1,this.mapper=new VK(this),this.className="CanvasActor",this.derivedImage=n,this.viewport=e}renderRLE(e,n,r){const{width:i,height:a}=this.image;let{canvas:o}=this;(!o||o.width!==i||o.height!==a)&&(this.canvas=o=new window.OffscreenCanvas(i,a));const s=o.getContext("2d"),c=s.createImageData(i,a),{data:l}=c;l.fill(0);const{map:f}=r;let u=1/0,g=1/0,d=-1/0,h=-1/0;for(let v=0;v<a;v++){const y=f.getRun(v,0);if(!y)continue;g=Math.min(g,v),h=Math.max(h,v);const C=v*i<<2;let T;for(const S of y){const{start:x,end:w,value:E}=S;if(E===0){T||(T=[]),T.push(y.indexOf(S));continue}u=Math.min(u,x),d=Math.max(d,w);const M=this.canvasProperties.getColor(E).map(R=>R*255);let O=C+(x<<2);for(let R=x;R<w;R++)l[O++]=M[0],l[O++]=M[1],l[O++]=M[2],l[O++]=M[3]}}if(u>i)return;const p=d-u,m=h-g;s.putImageData(c,0,0,u-1,g-1,p+2,m+2),n.drawImage(o,u,g,p,m,u,g,p,m)}render(e,n){if(!this.visibility)return;const r=this.image||this.getImage(),{width:i,height:a}=r,o=r.getScalarData();if(!o)return;const{voxelManager:s}=r;if(s&&s.map.getRun){this.renderRLE(e,n,s);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==a)&&(this.canvas=c=new window.OffscreenCanvas(i,a));const l=c.getContext("2d"),f=l.createImageData(i,a),{data:u}=f;let g=0,d=0,h=1/0,p=1/0,m=-1/0,v=-1/0;for(let T=0;T<a;T++)for(let S=0;S<i;S++){const x=o[g++];if(x){h=Math.min(S,h),p=Math.min(T,p),m=Math.max(S,m),v=Math.max(T,v);const w=this.canvasProperties.getColor(x);u[d]=w[0]*255,u[d+1]=w[1]*255,u[d+2]=w[2]*255,u[d+3]=127}d+=4}if(h>i)return;const y=m-h+1,C=v-p+1;l.putImageData(f,0,0,h,p,y,C),n.drawImage(c,h,p,y,C,h,p,y,C)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:n=>e.imageData.worldToIndex(n),indexToWorld:(n,r)=>e.imageData.indexToWorld(n,r),getDimensions:()=>e.dimensions,getScalarData:()=>{var n;return(n=this.derivedImage)==null?void 0:n.getPixelData()},getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:n=>{this.derivedImage=n,this.image=null},modified:()=>null}),this.image}}function dm(t,e){const{pointInShapeFn:n,callback:r,boundsIJK:i,returnPoints:a=!1}=e;let o,s,c,l,f,u,g;const{numComps:d}=t;if(t.getScalarData?g=t.getScalarData():g=t.getPointData().getScalars().getData(),!g){console.warn("No scalar data found for imageData",t);return}const h=t.getDimensions();i?[[o,s],[c,l],[f,u]]=i:(o=0,s=h[0],c=0,l=h[1],f=0,u=h[2]);const p=Ze(o,c,f),m=t.getDirection(),v=m.slice(0,3),y=m.slice(3,6),C=m.slice(6,9),T=t.getSpacing(),[S,x,w]=T,E=t.indexToWorld(p),M=Ze(v[0]*S,v[1]*S,v[2]*S),O=Ze(y[0]*x,y[1]*x,y[2]*x),R=Ze(C[0]*w,C[1]*w,C[2]*w),_=d||g.length/h[2]/h[1]/h[0],P=h[0]*_,N=h[1]*P,W=[],U=Us(E);for(let K=f;K<=u;K++){const A=Us(U);for(let b=c;b<=l;b++){const F=Us(U);for(let $=o;$<=s;$++){const j=[$,b,K];if(n(U,j)){const z=K*N+b*P+$*_;let ge;_>2?ge=[g[z],g[z+1],g[z+2]]:ge=g[z],W.push({value:ge,index:z,pointIJK:j,pointLPS:U.slice()}),r&&r({value:ge,index:z,pointIJK:j,pointLPS:U})}rn(U,U,M)}dl(U,F),rn(U,U,O)}dl(U,A),rn(U,U,R)}return a?W:void 0}const jc=class jc extends p0{constructor(e){super({...e,canvas:e.canvas||di(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const n=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(n)?this.numberOfFrames:n},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const n=this.canvas,{clientWidth:r,clientHeight:i}=n;(n.width!==r||n.height!==i)&&(n.width=r,n.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(n,r=[0,0,0])=>{const i=this.videoCamera.panWorld,a=this.getWorldToCanvasRatio(),o=[i[0]*a,i[1]*a],s=[n[0]-o[0],n[1]-o[1]];return r.splice(0,2,s[0]/a,s[1]/a),r},this.worldToCanvas=n=>{const r=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(n[0]+r[0])*i,(n[1]+r[1])*i]},this.getRotation=()=>0,this.canvasToIndex=n=>{const r=this.getTransform();return r.invert(),r.transformPoint(n.map(i=>i*devicePixelRatio))},this.indexToCanvas=n=>this.getTransform().transformPoint(n).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{var s;const n=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),a=this.canvasContext;a.resetTransform(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.transform(i[0]/n,i[1]/n,i[2]/n,i[3]/n,i[4]/n,i[5]/n),a.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const c of this.getActors())c.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),Z(this.element,X.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),Z(this.element,X.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(s=this.initialRender)==null||s.call(this);const o=this.getFrameNumber();this.isPlaying&&(o<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):o>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const n=typeof e=="string"?e:e.imageId,r=ee(En.IMAGE_PLANE,n);let i=r.rowCosines,a=r.columnCosines;(i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const o=Ze(i[0],i[1],i[2]),s=Ze(a[0],a[1],a[2]),{rows:c,columns:l}=r,f=te();vt(f,o,s);let u=r.imagePositionPatient;u==null&&(u=[0,0,0]);const g=r.columnPixelSpacing||1,d=r.rowPixelSpacing||1,h=r.columns,p=r.rows,m=1,v=1;return this.hasPixelSpacing=!!r.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:u,rows:c,columns:l,direction:[...o,...s,...f],dimensions:[h,p,v],spacing:[g,d,m],hasPixelSpacing:this.hasPixelSpacing,numVoxels:h*p*v,imagePlaneModule:r}}setDataIds(e,n){var r;this.setVideo(e[0],(((r=n.viewReference)==null?void 0:r.sliceIndex)||0)+1)}setVideo(e,n){this.imageId=Array.isArray(e)?e[0]:e;const r=ee(En.IMAGE_URL,e);if(!(r!=null&&r.rendered))throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=r,a=ee(En.GENERAL_SERIES,e);this.modality=a==null?void 0:a.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:o,numberOfFrames:s}=ee(En.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(o||30))),o||(o=Math.round(s/this.videoElement.duration)),this.fps=o,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(n||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(n||1),c(this)},25)})))}async setVideoURL(e){return new Promise(n=>{this.videoElement.src=e,this.videoElement.preload="auto";const r=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",r),this.refreshRenderValues(),n(!0)};this.videoElement.addEventListener("loadedmetadata",r)})}getImageIds(){const e=new Array(this.numberOfFrames),n=this.imageId.replace(/[0-9]+$/,"");for(let r=0;r<this.numberOfFrames;r++)e[r]=`${n}${r+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const n=this.videoElement,r=this.renderFrame,a=n.currentTime+e*this.scrollSpeed/this.fps;n.currentTime=a;const o=s=>{r(),n.removeEventListener("seeked",o)};n.addEventListener("seeked",o)}async start(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=0,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async end(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=e.duration,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async setTime(e){const n=this.videoElement,r=this.renderFrame;if(n.currentTime=e,n.paused){const i=a=>{r(),n.removeEventListener("seeked",i)};n.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,n=ul.FRAME){this.scrollSpeed=n===ul.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){var a;if(((a=this.scalarData)==null?void 0:a.frameNumber)===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const o=new Uint8ClampedArray;return o.getRange=()=>[0,255],o.frameNumber=-1,o}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");n.drawImage(this.videoElement,0,0);const i=n.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,n=e.spacing,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const o=this.worldToCanvas(a),s=this.canvasToIndex(o);return[s[0],s[1],0]},indexToWorld:(a,o)=>{const s=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(s,o)}},i={dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,o)=>dm(o.imageData,{pointInShapeFn:o.isInObject??(()=>!0),callback:a,boundsIJK:o.boundsIJK,returnPoints:o.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(r,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const n=e.match(jc.frameRangeExtractor),r=n?e.substring(0,n.index):e;return this.imageId.includes(r)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,n=128){const r=n-e/2,i=n+e/2-1;this.setVOI({lower:r,upper:i}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite){this.feFilter=null;return}const e=this.averageWhite||[255,255,255],n=Math.max(...e),r=e.map(c=>n/c),{lower:i=0,upper:a=255}=this.voiRange||{},o=(a-i+1)/255,s=i/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${r[0]*o} 0 0 0 ${s}           0 ${r[1]*o} 0 0 ${s}           0 0 ${r[2]*o} 0 ${s}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:n,focalPoint:r}=e;if(n&&(this.videoCamera.parallelScale=this.element.clientHeight/2/n),r!==void 0){const i=this.worldToCanvas(r),a=[this.element.clientWidth/2,this.element.clientHeight/2],o=[(i[0]-a[0])/this.videoCamera.parallelScale,(i[1]-a[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-o[0],this.videoCamera.panWorld[1]-o[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(){return this.imageId.replace("/frames/1",this.isPlaying?`/frames/${this.frameRange[0]}-${this.frameRange[1]}`:`/frames/${this.getFrameNumber()}`)}getViewReferenceId(e={}){const{sliceIndex:n}=e;return n===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(n)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${n[0]+1}-${n[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+n}`)}`}isReferenceViewable(e,n={}){let{imageURI:r}=n;const{referencedImageId:i,sliceIndex:a}=e;if(!super.isReferenceViewable(e))return!1;const o=this.getCurrentImageId();if(!r){const u=o.indexOf(":");r=o.substring(u+1,o.length-1)}if(n.withNavigation)return!0;const s=this.getSliceIndex();if(Array.isArray(a))return s>=a[0]&&s<=a[1];if(a!==void 0)return s===a;if(!i)return!1;const c=i.match(jc.frameRangeExtractor);if(!c[2])return!0;const l=c[2].split("-").map(u=>Number(u)),f=s+1;return l[0]<=f&&f<=(l[1]??l[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){let n=(e==null?void 0:e.sliceIndex)??this.getSliceIndex();return n||(n=this.isPlaying?[this.frameRange[0]-1,this.frameRange[1]-1]:this.getCurrentImageIdIndex()),{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:n}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,n=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(n),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const n=Math.floor(this.videoWidth*e),r=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-n)/2,a=(this.canvas.offsetHeight-r)/2,o=i/e,s=a/e;this.videoCamera.panWorld=[o,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,n=window.devicePixelRatio||1,r=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),a=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],o=[a[0]*i,a[1]*i],s=new k0;return s.scale(n,n),s.translate(a[0],a[1]),s.scale(r,r),s.translate(e[0],e[1]),s.translate(-o[0],-o[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const n=this.getActors();e.forEach(r=>{const i=Q.getImage(r.imageId),a=this.createActorMapper(i),o=r.actorUID??bt();a&&(n.push({uid:o,actor:a}),r.callback&&r.callback({imageActor:a,imageId:r.imageId}))}),this.setActors(n)}createActorMapper(e){return new _K(this,e)}};jc.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let Ph=jc;const bK=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`,Gv=Symbol.for("map"),NK="postrender",Vs=class Vs extends p0{constructor(e){super({...e,canvas:e.canvas||di(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const r=this.canvas,{clientWidth:i,clientHeight:a}=r;(r.width!==i||r.height!==a)&&(r.width=i,r.height=a),this.refreshRenderValues()},this.canvasToWorld=r=>{if(!this.metadata)return;const[i,a]=this.canvasToIndex(r),{origin:o,spacing:s,direction:c}=this.getImageData(),l=Ze(0,0,0),f=c.slice(0,3),u=c.slice(3,6);return dn(l,o,f,i*s[0]),dn(l,l,u,a*s[1]),[l[0],l[1],l[2]]},this.worldToCanvas=r=>{if(!this.metadata)return;const{spacing:i,direction:a,origin:o}=this.metadata,s=a.slice(0,3),c=a.slice(3,6),l=rt([0,0,0],r,o),f=[fe(l,s)/i[0],fe(l,c)/i[1]];return this.indexToCanvas(f)},this.postrender=()=>{this.refreshRenderValues(),Z(this.element,X.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=r=>{const i=this.getTransform();return i.invert(),i.transformPoint(r)},this.indexToCanvas=r=>this.getTransform().transformPoint(r),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=bt(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const n=this.element.firstElementChild;n.insertBefore(this.microscopyElement,n.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(X.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){var n;this.removeEventListeners(),(n=this.viewer)==null||n.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null}getImageDataMetadata(e=0){var M;const n=this.metadataDicomweb.reduce((O,R)=>(O==null?void 0:O.NumberOfFrames)<R.NumberOfFrames?R:O),{TotalPixelMatrixColumns:r,TotalPixelMatrixRows:i,ImageOrientationSlide:a,ImagedVolumeWidth:o,ImagedVolumeHeight:s,ImagedVolumeDepth:c}=n,l=ee(En.IMAGE_PLANE,this.imageIds[e]);let f=a.slice(0,3),u=a.slice(3,6);(f==null||u==null)&&(f=[1,0,0],u=[0,1,0]);const g=Ze(f[0],f[1],f[2]),d=Ze(u[0],u[1],u[2]),h=te();vt(h,g,d);const{XOffsetInSlideCoordinateSystem:p=0,YOffsetInSlideCoordinateSystem:m=0,ZOffsetInSlideCoordinateSystem:v=0}=((M=n.TotalPixelMatrixOriginSequence)==null?void 0:M[0])||{},y=[p,m,v],C=o/r,T=s/i,S=r,x=i,w=c,E=1;return this.hasPixelSpacing=!!(o&&s),{bitsAllocated:8,numberOfComponents:3,origin:y,direction:[...g,...d,...h],dimensions:[S,x,E],spacing:[C,T,w],hasPixelSpacing:this.hasPixelSpacing,numVoxels:S*x*E,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){}resetProperties(){this.setProperties({})}getScalarData(){return null}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:n}=e,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const o=this.worldToCanvas(a),s=this.canvasToIndex(o);return[s[0],s[1],0]},indexToWorld:a=>{const o=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(o)}};return{dimensions:e.dimensions,spacing:n,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,o)=>dm(o.imageData,{pointInShapeFn:o.isInObject??(()=>!0),callback:a,boundsIJK:o.boundsIJK,returnPoints:o.returnPoints??!1})}}}hasImageURI(e){return!0}setCamera(e){const n=this.getCamera(),{parallelScale:r,focalPoint:i}=e,a=this.getView(),{xSpacing:o}=this.internalCamera;if(r){const c=this.element.clientHeight/r,l=1/o/c;a.setResolution(l)}if(i){const c=this.worldToCanvas(i),l=this.canvasToIndex(c);a.setCenter(l)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(n,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:n}=this.internalCamera,r=e*n,i=[this.element.clientWidth/2,this.element.clientHeight/2],a=this.canvasToWorld(i);return{parallelProjection:!0,focalPoint:a,position:a,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*r,viewPlaneNormal:[0,0,1]}}setDataIds(e,n){(n==null?void 0:n.miniNavigationOverlay)!==!1&&Vs.addMiniNavigationOverlayCss();const r=(n==null?void 0:n.webClient)||ee(En.WADO_WEB_CLIENT,e[0]);if(!r)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);return this.setWSI(e,r)}async setWSI(e,n){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e;const r=await Vs.getDicomMicroscopyViewer();this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{var u,g,d;const c=n.getDICOMwebMetadata(s);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=(u=c["00080008"])==null?void 0:u.Value;(l==null?void 0:l.length)===1&&(c["00080008"].Value=l[0].split("\\"));const f=(d=(g=c["00200052"])==null?void 0:g.Value)==null?void 0:d[0];return this.frameOfReferenceUID?f!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=f,c}),a=[];i.forEach(s=>{const c=new r.metadata.VLWholeSlideMicroscopyImage({metadata:s}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?a.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=a;const o=new r.viewer.VolumeImageViewer({client:n,metadata:a,controls:["overview","position"],retrieveRendered:!1,bindings:{}});o.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),o.deactivateDragPanInteraction(),this.viewer=o,this.map=o[Gv],this.map.on(NK,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const n=this.getCamera();this.setCamera({parallelScale:n.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[Gv],n=window;return n.map=e,n.viewer=this.viewer,n.view=e==null?void 0:e.getView(),n.wsi=this,e==null?void 0:e.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const n=e.getResolution();if(!n||n<Qr)return;const r=e.getCenter(),i=e.getProjection().getExtent(),a=e.getRotation(),o=e.getZoom(),{metadata:{spacing:[s,c]}}=this,l=1/n/s;Object.assign(this.internalCamera,{extent:i,centerIndex:r,worldToCanvasRatio:l,xSpacing:s,ySpacing:c,resolution:n,rotation:a,zoom:o})}getZoom(){var e;return(e=this.getView())==null?void 0:e.getZoom()}setZoom(e){var n;(n=this.getView())==null||n.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:n,rotation:r}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],a=new k0;return a.translate(i[0],i[1]),a.rotate(r),a.scale(1/n,-1/n),a.translate(-e[0],-e[1]),a}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=bK,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};Vs.getDicomMicroscopyViewer=async()=>zW("dicom-microscopy-viewer"),Vs.overlayCssId="overlayCss";let kh=Vs;const yE={[lt.ORTHOGRAPHIC]:Rn,[lt.PERSPECTIVE]:Rn,[lt.STACK]:fr,[lt.VOLUME_3D]:hE,[lt.VIDEO]:Ph,[lt.WHOLE_SLIDE]:kh};function is(t){return yE[t].useCustomRenderingPipeline}const Wv=2;class CE{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const i=this._getViewportsAsArray().map(a=>{if(a.getFrameOfReferenceUID()===n)return a.id});this.renderViewports(i)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let i=0;i<n.length;i++){const a=n[i];if(this._needsRender.has(a.id)){const o=this.renderViewportUsingCustomOrVtkPipeline(a);if(r.push(o),a.setRendered(),this._needsRender.delete(a.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(i=>{i!=null&&i.element&&Z(i.element,X.IMAGE_RENDERED,i)})},this.id=e||bt(),this.useCPURendering=Uc(),pl.set(this),!mw())throw new Error("@cornerstonejs/core is not initialized, run init() first");this.useCPURendering||(this.offscreenMultiRenderWindow=GG.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer)),this._viewports=new Map,this.hasBeenDestroyed=!1}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:i}=n;if(!r)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:o}=n,s=is(o);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const c=di(r),{background:l}=n.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!is(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),n.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],i=[];n.forEach(a=>{!this.useCPURendering&&!is(a.type)?r.push(a):i.push(a)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(i),n.forEach(a=>{const o=di(a.element),{background:s}=a.defaultOptions;this.fillCanvasWithBackgroundColor(o,s)})}resize(e=!0,n=!0){this._throwIfDestroyed();const r=this._getViewportsAsArray(),i=[],a=[];r.forEach(o=>{is(o.type)?a.push(o):i.push(o)}),i.length&&this._resizeVTKViewports(i,n,e),a.length&&this._resizeUsingCustomResizeHandler(a,n,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n)throw new Error(`Viewport with Id ${e} does not exist`);if(!(n instanceof fr))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return n}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(n=>n instanceof fr)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof Fr;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(this.useCPURendering||(this._getViewportsAsArray().forEach(n=>{this.offscreenMultiRenderWindow.removeRenderer(n.id)}),this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),pl.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let i;if(n){const a=n.map(o=>Math.floor(255*o));i=`rgb(${a[0]}, ${a[1]}, ${a[2]})`}else i="black";r.fillStyle=i,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let i=r;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},n===lt.ORTHOGRAPHIC&&(i={...i,orientation:o0.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const a=i.getCamera();i.resetCamera(),n&&i.setCamera(a)}),r&&this.render()}_resizeVTKViewports(e,n=!0,r=!0){const i=e.map(a=>di(a.element));if(i.forEach(a=>{const o=window.devicePixelRatio||1;a.width=a.clientWidth*o,a.height=a.clientHeight*o}),i.length){const{offScreenCanvasWidth:a,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(i);this._resize(e,a,o)}e.forEach(a=>{const o=a.getCamera(),s=a.getRotation(),{flipHorizontal:c}=o;a.resetCameraForResize();const l=a.getDisplayArea();n&&(l?(c&&a.setCamera({flipHorizontal:c}),s&&a.setViewPresentation({rotation:s})):a.setCamera(o))}),r&&this.render()}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(f=>is(f.type)===!1),i=r.map(f=>f.canvas),a=di(e.element);i.push(a);const{offScreenCanvasWidth:o,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),c=this._resize(r,o,s),l={...e,canvas:a};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:o,offScreenCanvasHeight:s,xOffset:c})}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addVtkjsDrivenViewport(e,n){const{element:r,canvas:i,viewportId:a,type:o,defaultOptions:s}=e;r.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:f}=n,{sxStartDisplayCoords:u,syStartDisplayCoords:g,sxEndDisplayCoords:d,syEndDisplayCoords:h,sx:p,sy:m,sWidth:v,sHeight:y}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,f);this.offscreenMultiRenderWindow.addRenderer({viewport:[u,g,d,h],id:a,background:s.background?s.background:[0,0,0]});const C={id:a,element:r,renderingEngineId:this.id,type:o,canvas:i,sx:p,sy:m,sWidth:v,sHeight:y,defaultOptions:s||{}};let T;if(o===lt.STACK)T=new fr(C);else if(o===lt.ORTHOGRAPHIC||o===lt.PERSPECTIVE)T=new Rn(C);else if(o===lt.VOLUME_3D)T=new hE(C);else throw new Error(`Viewport Type ${o} is not supported`);this._viewports.set(a,T);const S={element:r,viewportId:a,renderingEngineId:this.id};T.suppressEvents||Z(Y,X.ELEMENT_ENABLED,S)}addCustomViewport(e){const{element:n,viewportId:r,type:i,defaultOptions:a}=e;n.tabIndex=-1;const o=di(n),{clientWidth:s,clientHeight:c}=o;(o.width!==s||o.height!==c)&&(o.width=s,o.height=c);const l={id:r,renderingEngineId:this.id,element:n,type:i,canvas:o,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:a||{}},f=yE[i],u=new f(l);this._viewports.set(r,u);const g={element:n,viewportId:r,renderingEngineId:this.id};Z(Y,X.ELEMENT_ENABLED,g)}setCustomViewports(e){e.forEach(n=>{this.addCustomViewport(n)})}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(o=>di(o.element));n.forEach(o=>{const s=window.devicePixelRatio||1,c=o.getBoundingClientRect();o.width=c.width*s,o.height=c.height*s});const{offScreenCanvasWidth:r,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(n);let a=0;for(let o=0;o<e.length;o++){const s=e[o],c=n[o],l={...s,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:r,offScreenCanvasHeight:i,xOffset:a}),a+=c.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,i=Math.max(...e.map(o=>o.height));let a=0;return e.forEach(o=>{a+=o.width}),n.width=a,n.height=i,r.resize(),{offScreenCanvasWidth:a,offScreenCanvasHeight:i}}_resize(e,n,r){let i=0;for(let a=0;a<e.length;a++){const o=e[a],{sxStartDisplayCoords:s,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:f,sx:u,sy:g,sWidth:d,sHeight:h}=this._getViewportCoordsOnOffScreenCanvas(o,n,r,i);i+=o.canvas.width,o.sx=u,o.sy=g,o.sWidth=d,o.sHeight=h,this.offscreenMultiRenderWindow.getRenderer(o.id).setViewport([s,c,l,f])}return i}_getViewportCoordsOnOffScreenCanvas(e,n,r,i){const{canvas:a}=e,{width:o,height:s}=a,c=i,l=0,f=c/n,u=l+(r-s)/r,g=o/n,d=s/r;return{sxStartDisplayCoords:f,syStartDisplayCoords:u,sxEndDisplayCoords:f+g,syEndDisplayCoords:u+d,sx:c,sy:l,sWidth:o,sHeight:s}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(r.length){for(let i=0;i<r.length;i++){const{renderer:a,id:o}=r[i];this._needsRender.has(o)?a.setDraw(!0):a.setDraw(!1)}n.render();for(let i=0;i<r.length;i++)r[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(e.sWidth<Wv||e.sHeight<Wv){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(is(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,o=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,o)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:i,sx:a,sy:o,sWidth:s,sHeight:c,id:l,renderingEngineId:f,suppressEvents:u}=e,{width:g,height:d}=i;return i.getContext("2d").drawImage(n,a,o,s,c,0,0,g,d),{element:r,suppressEvents:u,viewportId:l,renderingEngineId:f,viewportStatus:e.viewportStatus}}_resetViewport(e){const n=this.id,{element:r,canvas:i,id:a}=e,o={element:r,viewportId:a,renderingEngineId:n};e.removeWidgets(),Z(Y,X.ELEMENT_DISABLED,o),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){const e=this._debugRender();PK(e)}_debugRender(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();for(let c=0;c<r.length;c++)r[c].renderer.setDraw(!0);n.render();const o=e.getOpenGLRenderWindow().get3DContext().canvas,s=o.toDataURL();return this._getViewportsAsArray().forEach(c=>{const{sx:l,sy:f,sWidth:u,sHeight:g}=c,d=c.canvas,{width:h,height:p}=d;d.getContext("2d").drawImage(o,l,f,u,g,0,0,h,p)}),s}}function PK(t){const e=document.createElement("a");e.download="viewport.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}class kK{constructor(e){this._color=[200,0,0],this.id=e.id,this._points=e.points,this._polys=e.polys,this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes(),this._updateCentroid()}_getSizeInBytes(){return this._points.length*4+this._polys.length*4}_updateCentroid(){const e=this._points.length/3;let n=0,r=0,i=0;for(let a=0;a<this._points.length;a+=3)n+=this._points[a],r+=this._points[a+1],i+=this._points[a+2];this._centroid=[n/e,r/e,i/e]}get color(){return this._color}set color(e){this._color=e}get points(){return this._points}set points(e){this._points=e,this._updateCentroid()}get polys(){return this._polys}set polys(e){this._polys=e}get segmentIndex(){return this._segmentIndex}get centroid(){return this._centroid}get flatPointsArray(){return this._points}get totalNumberOfPoints(){return this._points.length/3}}var Tr;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(Tr||(Tr={}));class od{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i);let s=this._children.get(o);s||(s=new od(this._target),this._children.set(o,s)),e=e.substring(i+1),s.addEventListener(e,n,r)}else this._addEventListener(e,n,r)}removeEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const o=e.substring(0,i),s=this._children.get(o);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,n,r),s.isEmpty&&this._children.delete(o)}else this._removeEventListener(e,n,r)}reset(){Array.from(this._children.entries()).forEach(([e,n])=>{if(n.reset(),n.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,n,r){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const o=(r==null?void 0:r.capture)??!1?Tr.Capture:Tr.Bubble,s=i.get(n)??Tr.None;if(s&o){console.warn("A listener is already registered for this phase");return}i.set(n,s|o),this._target.addEventListener(e,n,r)}_removeEventListener(e,n,r){const a=(r==null?void 0:r.capture)??!1?Tr.Capture:Tr.Bubble,o=this._eventListeners.get(e);if(!o)return;(n?[n]:Array.from(o.keys())).forEach(c=>{const l=o.get(c)??Tr.None;if(!!!(l&a))return;this._target.removeEventListener(e,c,r);const u=l^a;u===Tr.None?o.delete(c):o.set(c,u)}),o.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,n){Array.from(n.entries()).forEach(([r,i])=>{const a=Tr.Capture;for(let o=a;i;o<<=1){if(!(i&o))continue;const s=o===Tr.Capture;this.removeEventListener(e,r,{capture:s}),i^=o}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,n])=>{this._unregisterAllListeners(e,n)})}}class FK{constructor(){this._targetsEventListeners=new Map}addEventListener(e,n,r,i){let a=this._targetsEventListeners.get(e);a||(a=new od(e),this._targetsEventListeners.set(e,a)),a.addEventListener(n,r,i)}removeEventListener(e,n,r,i){const a=this._targetsEventListeners.get(e);a&&(a.removeEventListener(n,r,i),a.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,n])=>{n.reset(),this._targetsEventListeners.delete(e)})}}const UK=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:FK,TargetEventListeners:od},Symbol.toStringTag,{value:"Module"}));function AK(t,e){const n=t.getSize();for(let r=0;r<n;r++){const i=[];t.getNodeValue(r,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(r,i)}}const BK=Symbol("LastRuntimeId"),GK={},WK=4294967295,$K="-";function TE(t,e,n){return zK(t!==null&&typeof t=="object"?t:GK,BK,(typeof n=="number"&&n>0?n:WK)>>>0).join(typeof e=="string"?e:$K)}function zK(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let i=!0,a=0;i&&a<r.length;++a){let o=r[a]|0;o<n?(i=!1,o=o+1):(o=0,a+1===r.length&&r.push(0)),r[a]=o}return r}const $v={},HK={add:(t,e)=>{const n=Dn(t);$v[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=Dn(e);return $v[n]}}};function jK(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function KK(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function qK(t,e){let n;e?n=[Va(e)]:n=kr();const r=[];return n.forEach(i=>{const a=t.getActors(),o=i.getVolumeViewports();for(const s of o){const c=s.getActors();if(c.length!==a.length)continue;a.every(({uid:f})=>c.find(u=>f===u.uid))&&r.push(s)}}),r}const SE=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function xE(t,e,n=void 0,r="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!e.imageId,o=!a&&e,s=a&&e,l=`renderGPUViewport-${o.imageId||s.volumeId}`,f=document.createElement("div"),u=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const g=t.width,d=t.height;f.style.width=`${g/u+Bv}px`,f.style.height=`${d/u+Bv}px`,f.style.visibility="hidden",f.style.position="absolute",document.body.appendChild(f);const h=l.split(":").join("-");f.setAttribute("viewport-id-for-remove",h);const p=di(f),m=Va(r)||new CE(r);let v=m.getViewport(l);if(!v){const y={viewportId:l,type:a?lt.ORTHOGRAPHIC:lt.STACK,element:f,defaultOptions:{...i,suppressEvents:!0}};m.enableElement(y),v=m.getViewport(l)}return new Promise(y=>{let C=!1,{viewReference:T}=i;const S=x=>{if(C)return;if(T){const _=T;T=null,v.setViewReference(_),v.render();return}t.getContext("2d").drawImage(p,0,0,p.width,p.height,0,0,t.width,t.height);const E=v.canvasToWorld([0,0]),M=v.canvasToWorld([p.width/u,0]),O=v.canvasToWorld([0,p.height/u]),R=1;C=!0,f.removeEventListener(X.IMAGE_RENDERED,S),setTimeout(()=>{m.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${h}"]`).forEach(P=>{P.remove()})},0),y({origin:E,bottomLeft:O,topRight:M,thicknessMm:R})};f.addEventListener(X.IMAGE_RENDERED,S),a?v.setVolumes([s],!1,!0):v.renderImageObject(e),v.resetCamera(),n==="PT"&&!SE(o)&&v.setProperties({voiRange:{lower:o.minPixelValue,upper:o.maxPixelValue}}),v.render()})}function wE(t,e,n,r,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const o=e,s=pE(t,o,n),c={canvas:t,viewport:s,image:o,renderingTools:{}};c.transform=Tl(c);const l=!0;return new Promise((f,u)=>{fE(c,l),f(null)})}function XK(t){const{canvas:e,imageId:n,viewReference:r,requestType:i=ye.Thumbnail,priority:a=-5,renderingEngineId:o="_thumbnails",useCPURendering:s=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:f}=t,u=r==null?void 0:r.volumeId,g=u&&!n,d=r&&f?{...f,viewReference:r}:f,h=s?wE:xE;return new Promise((p,m)=>{function v(S,x){var O;const{modality:w}=ee("generalSeriesModule",x)||{},E=!g&&S,M=g&&S;E&&(E.isPreScaled=E.isPreScaled||((O=E.preScale)==null?void 0:O.scaled)),c&&(e.height=256,e.width=256),l&&E&&(e.width=E&&e.height*E.width/E.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,M&&s&&m(new Error("CPU rendering of volume not supported")),h(e,S,w,o,d).then(p)}function y(S,x){console.error(S,x),m(S)}function C(S,x,w){return Vo(S,w).then(E=>{v.call(this,E,S)},E=>{y.call(this,E,S)})}const T={useRGBA:!!s,requestType:i};if(u){const S=Q.getVolume(u);S||m(new Error(`Volume id ${u} not found in cache`));const x=S.imageIds[0];v(S,x)}else Jr.addRequest(C.bind(null,n,null,T),i,{imageId:n},a)})}function YK(t,e){const n=ee("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||(o=1),s||(s=1);const c=te();dn(c,a,r,-o/2),dn(c,c,i,-s/2);const l=te();_t(l,e,c);const f=fe(l,i),u=fe(l,r);return[f/s,u/o]}function ZK(t,e){const n=ee("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:o,rowPixelSpacing:s}=n;o||(o=1),s||(s=1);const c=te();return dn(c,a,i,s*(e[0]-.5)),dn(c,c,r,o*(e[1]-.5)),Array.from(c)}function Fh(t){const e=kr(),n=[];return e.forEach(r=>{r.getViewports().forEach(a=>{a.hasImageURI(t)&&n.push(a)})}),n}function JK(t,e){const n=QK(t,e);return n?n.index:null}function QK(t,e){const n=e.getImageIds(),r=e.getCurrentImageIdIndex();if(n.length===0)return null;const i=c=>{const l=eq(c);if(!l)return null;const f=Qw(l.planeNormal,l.imagePositionPatient);return eE(f,t)},a={distance:i(n[r])??1/0,index:r},o=n.slice(r+1);for(let c=0;c<o.length;c++){const l=o[c],f=i(l);if(f!==null)if(f<=a.distance)a.distance=f,a.index=c+r+1;else break}const s=n.slice(0,r);for(let c=s.length-1;c>=0;c--){const l=s[c],f=i(l);if(!(f===null||f===a.distance))if(f<a.distance)a.distance=f,a.index=c;else break}return a.distance===1/0?null:a}function eq(t){const e=ee("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:i}=e,a=Fe(te(),...n),o=Fe(te(),...r),s=vt(te(),a,o);return{rowCosines:n,columnCosines:r,imagePositionPatient:i,planeNormal:s}}function tq(t){const{width:e,height:n}=t.getCanvas(),{sliceToIndexMatrix:r,indexToSliceMatrix:i}=t.getSliceViewInfo(),a=Qi(t,[0,0]),o=Qi(t,[e-1,0]),s=Qi(t,[0,n-1]),c=_t(te(),o,a),l=_t(te(),s,a),f=vt(te(),c,l);$t(c,c),$t(l,l),$t(f,f);const u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),g=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!fl(1,u)||!fl(1,g))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:d}=t.getImageData(),h=t.getSliceViewInfo(),p=d.getSliceData(h);return{width:h.width,height:h.height,scalarData:p,sliceToIndexMatrix:r,indexToSliceMatrix:i}}const Ha={},rg={add:(t,e)=>{const[n,r]=t,i=`${n}_${r}`;Ha[i]||(Ha[i]={}),Ha[i]=e},get:(t,e,n)=>{if(t!=="spatialRegistrationModule")return;const r=`${e}_${n}`;if(Ha[r])return Ha[r];const i=`${n}_${e}`;if(Ha[i])return xt(Ia(),Ha[i])}};M0(rg.get.bind(rg));const nq=.05;function rq(t,e){const n=t.getSliceIndex(),r=e.getSliceIndex(),i=ee("imagePlaneModule",n.toString()),a=ee("imagePlaneModule",r.toString());if(!i||!a){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:o}=a;if(!i.imageOrientationPatient.every((g,d)=>Math.abs(g-o[d])<nq)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i==null?void 0:i.imageOrientationPatient,a==null?void 0:a.imageOrientationPatient);return}const c=i.imagePositionPatient,l=a.imagePositionPatient,f=rt(te(),c,l),u=Ug(Ia(),f);rg.add([t.id,e.id],u)}function iq(t){const{imageData:e,dimensions:n}=t.getImageData(),{canvas:r}=t,i=window.devicePixelRatio,a=[0,0],o=[r.width/i,0],s=[r.width/i,r.height/i],c=[0,r.height/i],l=t.canvasToWorld(a),f=t.canvasToWorld(o),u=t.canvasToWorld(s),g=t.canvasToWorld(c),d=e.worldToIndex(l),h=e.worldToIndex(f),p=e.worldToIndex(u),m=e.worldToIndex(g);return aq({dimensions:n,imageData:e,topLeftImage:d,topRightImage:h,bottomRightImage:p,bottomLeftImage:m,topLeftWorld:l,topRightWorld:f,bottomRightWorld:u,bottomLeftWorld:g})}function aq({dimensions:t,imageData:e,topLeftImage:n,topRightImage:r,bottomRightImage:i,bottomLeftImage:a,topLeftWorld:o,topRightWorld:s,bottomRightWorld:c,bottomLeftWorld:l}){const f=ju(n,t)?o:e.indexToWorld([0,0,0]),u=ju(r,t)?s:e.indexToWorld([t[0]-1,0,0]),g=ju(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),d=ju(a,t)?l:e.indexToWorld([0,t[1]-1,0]);return[f,u,d,g]}function ju(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}let oq=class Ec{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:i=128}=e,a=n*r;this.growSize=i,this.array=new ArrayBuffer(a*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(e){for(let n=0;n<this._length;n++)e(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;return this.data.subarray(n,n+this._dimensions)}getPointArray(e){const n=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;for(let i=0;i<this._dimensions;i++)n.push(this.data[i+r]);return n}grow(e=1,n=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const r=this.data.length+n,i=new ArrayBuffer(r*this._dimensions*this._byteSize),a=new Float32Array(i);a.set(this.data),this.data=a,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let n=0;n<e;n++){const r=n*this._dimensions,i=(this._length-1-n)*this._dimensions;for(let a=0;a<this._dimensions;a++){const o=this.data[r+a];this.data[r+a]=this.data[i+a],this.data[i+a]=o}}}push(e){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=e[r];this._length++}map(e){const n=[];for(let r=0;r<this._length;r++)n.push(e(this.getPoint(r),r));return n}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:n,y:r,z:i}=e;return this.forEach(a=>{n.push(a[0]),r.push(a[1]),i&&i.push(a[2])}),e}static fromXYZ({x:e,y:n,z:r}){const i=Ec.create3(e.length);let a=0;for(let o=0;o<e.length;o++)i.data[a++]=e[o],i.data[a++]=n[o],i.data[a++]=r?r[o]:0;return i._length=e.length,i}subselect(e=10,n=0){const r=new Ec({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const a=(n+Math.floor(this.length*i/e))%this.length;r.push(this.getPoint(a))}return r}static create3(e=128){return new Ec({initialSize:e,dimensions:3})}static create2(e=128){return new Ec({initialSize:e,dimensions:2})}};function le(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return Yl(e,n)}function Yl(t,e){if(!e||!t)return;const n=Va(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const i=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function en(t){const e=kr();for(let n=0;n<e.length;n++){const r=e[n];if(r.getViewport(t))return Yl(t,r.id)}}function sq(){const t=[];return kr().forEach(n=>{n.getViewports().forEach(({element:i})=>{t.push(le(i))})}),t}function cq(t){const e=le(t);if(!e)return;const{viewport:n}=e;if(!(n instanceof fr))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()}function lq(t){const e=t[0],{modality:n,seriesInstanceUID:r}=ee("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:o,columns:s,rows:c}=ee("imagePlaneModule",e),l={modality:n,imageOrientationPatient:i,pixelSpacing:a,columns:s,rows:c,seriesInstanceUID:r};return t.every(u=>{const{modality:g,seriesInstanceUID:d}=ee("generalSeriesModule",u),{imageOrientationPatient:h,pixelSpacing:p,columns:m,rows:v}=ee("imagePlaneModule",u);return d===l.seriesInstanceUID&&g===l.modality&&m===l.columns&&v===l.rows&&Vt(h,l.imageOrientationPatient)&&Vt(p,l.pixelSpacing)})}const uq=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function EE(t){return t?(Array.isArray(t)?t:[t]).find(n=>uq.has(n)):!1}async function fq({viewport:t,options:e={}}){const n=t.getRenderingEngine();let r=e.volumeId||`${bt()}`;r.split(":").length===0&&(r=`${XH()}:${r}`);const{id:i,element:a}=t,o=e.viewportId||i,s=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();n.enableElement({viewportId:o,type:lt.ORTHOGRAPHIC,element:a,defaultOptions:{background:e.background,orientation:e.orientation}}),(await Xw(r,{imageIds:s})).load();const u=n.getViewport(o);await RK(n,[{volumeId:r}],[o]);const g=()=>{u.render(),a.removeEventListener(X.VOLUME_VIEWPORT_NEW_VOLUME,g)};return(()=>{a.addEventListener(X.VOLUME_VIEWPORT_NEW_VOLUME,g)})(),u.setViewPresentation(c),u.setViewReference(l),u.render(),u}async function gq({viewport:t,options:e}){const n=t,{id:r,element:i}=n,a=t.getRenderingEngine(),{background:o}=e,s=e.viewportId||r,c=Q.getVolume(n.getVolumeId());if(!(c instanceof rd))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:s,type:lt.STACK,element:i,defaultOptions:{background:o}},f=n.getViewReference();a.enableElement(l);const u=a.getViewport(s);return await u.setStack(c.imageIds),u.setViewReference(f),u.render(),u}function qi(t,e=2){if(Array.isArray(t))return t.map(i=>qi(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const n=Math.abs(t);if(n<1e-4)return`${t}`;const r=n>=100?e-2:n>=10?e-1:n>=1?e:n>=.1?e+1:n>=.01?e+2:n>=.001?e+3:e+4;return t.toFixed(r)}function dq(t){return Math.round(t/Qr)*Qr}function pq(t,e,n){const r=t.length===e*n*4,i=t.length===e*n*3;if(r||i){const a=new Float32Array(e*n);let o=0,s=0;const c=r?4:3;for(let l=0;l<e;l++)for(let f=0;f<n;f++){const u=t[o],g=t[o+1],d=t[o+2];a[s]=(u+g+d)/3,o+=c,s++}return a}else return t}function OE(t){if(t instanceof Rn)return Q.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function DE(t,e){const n=[...t];return e>=n.length?(zv(n),n):(zv(n),n.slice(0,e))}function zv(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function V2(t){const e=t.toString(16);return e.length==1?"0"+e:e}function hq(t,e,n){return"#"+V2(t)+V2(e)+V2(n)}function mq(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const vq=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:mq,rgbToHex:hq},Symbol.toStringTag,{value:"Module"}));function RE(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),t===e}}function yq(t,e,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!n?void 0:n(e).metadata.Modality;throw new Error("Invalid viewport type")}const Cq=(t,e)=>t.reduce((n,r)=>((n[r[e]]=n[r[e]]||[]).push(r),n),{});function Tq(t){const e=t.map(o=>{const{imagePositionPatient:s}=ee("imagePlaneModule",o)||{};return{imageId:o,imagePositionPatient:s}});if(!e.every(o=>o.imagePositionPatient))return null;const n=Cq(e,"imagePositionPatient"),r=Object.keys(n),i=n[r[0]].length;return i===1||!r.every(o=>n[o].length===i)?null:n}function Sq(t,e){const n={};let r=[];const i=Object.keys(t);for(let a=0;a<i.length;a++){const o=new Set,s=t[i[a]];for(let c=0;c<s.length;c++){const l=e(s[c].imageId)||0;if(n[l]=n[l]||[],n[l].push({imageId:s[c].imageId}),o.add(l),o.size-1<c)return}if(a==0)r=Array.from(o);else if(!Oq(r,o))return}return n}function rc(t,e){const n=ee(e,t);try{return parseFloat(n)}catch{return}}function xq(t){const e=ee("20011003",t);try{const{InlineBinary:n}=e;if(n){const r=atob(n),i=new ArrayBuffer(r.length),a=new DataView(i);for(let o=0;o<r.length;o++)a.setUint8(o,r.charCodeAt(o));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function wq(t){let e=ee("0019100c",t)||ee("0019100C",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n)),parseFloat(e)}catch{return}}function Eq(t){let e=ee("00431039",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n).split("//")),parseFloat(e[0])%1e5}catch{return}}function Oq(t,e){if(t.length!=e.size)return!1;for(let n=0;n<t.length;n++)if(!e.has(t[n]))return!1;return!0}function Dq(t){const e=ee("petImageModule",t);return e?e.frameReferenceTime:0}function ME(t){const e=Tq(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],r=[i=>rc(i,n[0]),i=>rc(i,n[1]),i=>rc(i,n[2]),i=>rc(i,n[3]),i=>rc(i,n[4]),xq,wq,Eq,Dq];for(let i=0;i<r.length;i++){const a=Sq(e,r[i]);if(a)return{imageIdGroups:Object.keys(a).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>a[c].map(l=>l.imageId)),splittingTag:n[i]}}return{imageIdGroups:[t],splittingTag:null}}function Rq(t){const{imageIdGroups:e,splittingTag:n}=ME(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:n}}function Mq(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a}=e;if(e.modality==="PT"&&typeof a=="number")for(let o=0;o<n;o++)t[o]=a*(t[o]*r+i);else for(let o=0;o<n;o++)t[o]=t[o]*r+i;return t}function LE(t,e,n){return Math.min(Math.max(e,t),n)}function IE(t,e){if(!le(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof fr&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:r,delta:i,scrollSlabs:a}=e;if(t instanceof Rn)Lq(t,r,i,a);else{const o=t.getCurrentImageIdIndex();if(o+i>t.getImageIds().length-1||o+i<0){const s={imageIdIndex:o,direction:i};Z(Y,X.STACK_SCROLL_OUT_OF_BOUNDS,s)}t.scroll(i,e.debounceLoading,e.loop)}}function Lq(t,e,n,r=!1){const i=r,{numScrollSteps:a,currentStepIndex:o,sliceRangeInfo:s}=Bc(t,e,i);if(!s)return;const{sliceRange:c,spacingInNormalDirection:l,camera:f}=s,{focalPoint:u,viewPlaneNormal:g,position:d}=f,{newFocalPoint:h,newPosition:p}=Ws(u,d,c,g,l,n);t.setCamera({focalPoint:h,position:p}),t.render();const m=o+n,v={volumeId:e,viewport:t,delta:n,desiredStepIndex:m,currentStepIndex:o,numScrollSteps:a,currentImageId:t.getCurrentImageId()};(m>a||m<0)&&t.getCurrentImageId()?Z(Y,X.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,v):Z(Y,X.VOLUME_VIEWPORT_SCROLL,v)}async function Iq(t,e={}){const{imageIndex:n,debounceLoading:r,volumeId:i}=e,a=le(t);if(!a)throw new Error("Element has been disabled");const{viewport:o}=a,{imageIndex:s,numberOfSlices:c}=Vq(o,r),f=_q(c,n)-s;IE(o,{delta:f,debounceLoading:r,volumeId:i})}function Vq(t,e){return t instanceof fr?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function _q(t,e){const n=t-1;return LE(e,0,n)}const bq=(t,e)=>yq(t,e,Q.getVolume),ba=Object.freeze(Object.defineProperty({__proto__:null,PointsManager:oq,ProgressiveIterator:Q1,RLEVoxelMap:fC,VoxelManager:ft,actorIsA:Gn,applyPreset:rE,autoLoad:Ih,calculateViewportsSpatialRegistration:rq,calibratedPixelSpacingMetadataProvider:HK,clamp:Nh,clip:LE,color:vq,colormap:jW,convertStackToVolumeViewport:fq,convertToGrayscale:pq,convertVolumeToStackViewport:gq,createLinearRGBTransferFunction:cE,createSigmoidRGBTransferFunction:nm,decimate:Hw,deepClone:Rr,deepEqual:RE,deepMerge:Zn,eventListener:UK,generateVolumePropsFromImageIds:am,genericMetadataProvider:ra,getBufferConfiguration:Y5,getClosestImageId:ml,getClosestStackImageIndexForPoint:JK,getCurrentVolumeViewportSlice:tq,getDynamicVolumeInfo:Rq,getImageLegacy:cq,getImageSliceDataForVolumeViewport:tg,getMinMax:Zw,getRandomSampleFromArray:DE,getRuntimeId:TE,getScalingParameters:$w,getSliceRange:ed,getSpacingInNormalDirection:f0,getTargetVolumeAndSpacingInNormalDir:Xl,getViewportImageCornersInWorld:iq,getViewportImageIds:OE,getViewportModality:bq,getViewportsWithImageURI:Fh,getViewportsWithVolumeId:id,getVoiFromSigmoidRGBTransferFunction:nE,getVolumeActorCorners:nw,getVolumeId:P0,getVolumeSliceRangeInfo:tE,getVolumeViewportScrollInfo:Bc,getVolumeViewportsContainingSameVolumes:qK,hasFloatScalingParameters:im,hasNaNValues:Vh,imageIdToURI:Dn,imageRetrieveMetadataProvider:Cl,imageToWorldCoords:ZK,indexWithinDimensions:KK,invertRgbTransferFunction:Ac,isEqual:Vt,isEqualAbs:n_,isEqualNegative:pC,isImageActor:jr,isOpposite:jK,isPTPrescaledWithSUV:SE,isValidVolume:lq,isVideoTransferSyntax:EE,jumpToSlice:Iq,loadImageToCanvas:XK,makeVolumeMetadata:Gw,planar:lj,pointInShapeCallback:dm,renderToCanvasCPU:wE,renderToCanvasGPU:xE,roundNumber:qi,roundToPrecision:dq,scaleArray:Mq,scaleRgbTransferFunction:AK,scroll:IE,snapFocalPointToSlice:Ws,sortImageIdsAndGetSpacing:Ww,spatialRegistrationMetadataProvider:rg,splitImageIdsBy4DTags:ME,transferFunctionUtils:qW,transformIndexToWorld:iE,transformWorldToIndex:Ji,triggerEvent:Z,updateVTKImageDataWithCornerstoneImage:ad,uuidv4:bt,windowLevel:KW,worldToImageCoords:YK},Symbol.toStringTag,{value:"Module"})),Zl=new c3("imageRetrievalPool");Zl.setMaxSimultaneousRequests(ye.Interaction,200);Zl.setMaxSimultaneousRequests(ye.Thumbnail,200);Zl.setMaxSimultaneousRequests(ye.Prefetch,200);Zl.grabDelay=0;const Hv=Symbol("DefaultSettings"),jv=Symbol("RuntimeSettings"),Kv=Symbol("ObjectSettingsMap"),ci=Symbol("Dictionary");class Ke{constructor(e){const n=Object.create(e instanceof Ke&&ci in e?e[ci]:null);Object.seal(Object.defineProperty(this,ci,{value:n}))}set(e,n){return ig(this[ci],e,n,null)}get(e){return kq(this[ci],e)}unset(e){return Nq(this[ci],e+"")}forEach(e){qv(this[ci],e)}extend(){return new Ke(this)}import(e){VE(e)&&Object.keys(e).forEach(n=>{ig(this[ci],n,e[n],null)})}dump(){const e={};return qv(this[ci],(n,r)=>{typeof r<"u"&&_E(e,n,r)}),e}static assert(e){return e instanceof Ke?e:Ke.getRuntimeSettings()}static getDefaultSettings(e=null){let n=Ke[Hv];if(n instanceof Ke||(n=new Ke,Ke[Hv]=n),e){const r={};return n.forEach(i=>{if(i.startsWith(e)){const a=i.split(`${e}.`)[1];r[a]=n.get(i)}}),r}return n}static getRuntimeSettings(){let e=Ke[jv];return e instanceof Ke||(e=new Ke(Ke.getDefaultSettings()),Ke[jv]=e),e}static getObjectSettings(e,n){let r=null;if(e instanceof Ke)r=e;else if(typeof e=="object"&&e!==null){let i=Ke[Kv];i instanceof WeakMap||(i=new WeakMap,Ke[Kv]=i),r=i.get(e),r instanceof Ke||(r=new Ke(Ke.assert(Ke.getObjectSettings(n))),i.set(e,r))}return r}static extendRuntimeSettings(){return Ke.getRuntimeSettings().extend()}}function Nq(t,e){if(e.endsWith(".")){let n=0;const r=e,i=r.slice(0,-1),a=i.length===0;for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(a||o.startsWith(r)||o===i)&&(delete t[o],++n);return n>0}return delete t[e]}function qv(t,e){for(const n in t)e(n,t[n])}function Pq(t,e,n,r){let i;if(r.has(n))return ig(t,e,null,r);r.add(n),i=0;for(const a in n)if(Object.prototype.hasOwnProperty.call(n,a)){const o=a.length===0?e:`${e}.${a}`;ig(t,o,n[a],r)||++i}return r.delete(n),i===0}function ig(t,e,n,r){return Fq(e)?VE(n)?Pq(t,e,n,r instanceof WeakSet?r:new WeakSet):(t[e]=n,!0):!1}function kq(t,e){return t[e]}function Fq(t){let e,n,r;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(r=-1;(n=t.indexOf(".",r+1))>=0;){if(n-r<2||n===e)return!1;r=n}return!0}function VE(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function _E(t,e,n){const r=e.indexOf(".");if(r>=0){const i=e.slice(0,r);let a=t[i];if(typeof a!="object"||a===null){const o=a;a={},typeof o<"u"&&(a[""]=o),t[i]=a}_E(a,e.slice(r+1,e.length),n)}else t[e]=n}Ke.getDefaultSettings().set("useCursors",!0);function Hf(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Uq(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function bE(t){let e,n,r;t.length!==2?(e=Hf,n=(s,c)=>Hf(t(s),c),r=(s,c)=>t(s)-c):(e=t===Hf||t===Uq?t:Aq,n=t,r=t);function i(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;n(s[u],c)<0?l=u+1:f=u}while(l<f)}return l}function a(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;n(s[u],c)<=0?l=u+1:f=u}while(l<f)}return l}function o(s,c,l=0,f=s.length){const u=i(s,c,l,f-1);return u>l&&r(s[u-1],c)>-r(s[u],c)?u-1:u}return{left:i,center:o,right:a}}function Aq(){return 0}function Bq(t){return t===null?NaN:+t}const Gq=bE(Hf),Wq=Gq.right;bE(Bq).center;const $q=Math.sqrt(50),zq=Math.sqrt(10),Hq=Math.sqrt(2);function ag(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=$q?10:a>=zq?5:a>=Hq?2:1;let s,c,l;return i<0?(l=Math.pow(10,-i)/o,s=Math.round(t*l),c=Math.round(e*l),s/l<t&&++s,c/l>e&&--c,l=-l):(l=Math.pow(10,i)*o,s=Math.round(t/l),c=Math.round(e/l),s*l<t&&++s,c*l>e&&--c),c<s&&.5<=n&&n<2?ag(t,e,n*2):[s,c,l]}function jq(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,a,o]=r?ag(e,t,n):ag(t,e,n);if(!(a>=i))return[];const s=a-i+1,c=new Array(s);if(r)if(o<0)for(let l=0;l<s;++l)c[l]=(a-l)/-o;else for(let l=0;l<s;++l)c[l]=(a-l)*o;else if(o<0)for(let l=0;l<s;++l)c[l]=(i+l)/-o;else for(let l=0;l<s;++l)c[l]=(i+l)*o;return c}function Uh(t,e,n){return e=+e,t=+t,n=+n,ag(t,e,n)[2]}function Kq(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?Uh(e,t,n):Uh(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function qq(t,e){let n;if(e===void 0)for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of t)(i=e(i,++r,t))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function Xq(t){if(!(a=t.length))return[];for(var e=-1,n=qq(t,Yq),r=new Array(n);++e<n;)for(var i=-1,a,o=r[e]=new Array(a);++i<a;)o[i]=t[i][e];return r}function Yq(t){return t.length}function Xv(){return Xq(arguments)}function Zq(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function pm(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function NE(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Jl(){}var Sl=.7,og=1/Sl,Hs="\\s*([+-]?\\d+)\\s*",xl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Yr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Jq=/^#([0-9a-f]{3,8})$/,Qq=new RegExp(`^rgb\\(${Hs},${Hs},${Hs}\\)$`),eX=new RegExp(`^rgb\\(${Yr},${Yr},${Yr}\\)$`),tX=new RegExp(`^rgba\\(${Hs},${Hs},${Hs},${xl}\\)$`),nX=new RegExp(`^rgba\\(${Yr},${Yr},${Yr},${xl}\\)$`),rX=new RegExp(`^hsl\\(${xl},${Yr},${Yr}\\)$`),iX=new RegExp(`^hsla\\(${xl},${Yr},${Yr},${xl}\\)$`),Yv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};pm(Jl,wl,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Zv,formatHex:Zv,formatHex8:aX,formatHsl:oX,formatRgb:Jv,toString:Jv});function Zv(){return this.rgb().formatHex()}function aX(){return this.rgb().formatHex8()}function oX(){return PE(this).formatHsl()}function Jv(){return this.rgb().formatRgb()}function wl(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Jq.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Qv(e):n===3?new kn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Ku(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Ku(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Qq.exec(t))?new kn(e[1],e[2],e[3],1):(e=eX.exec(t))?new kn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=tX.exec(t))?Ku(e[1],e[2],e[3],e[4]):(e=nX.exec(t))?Ku(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=rX.exec(t))?n6(e[1],e[2]/100,e[3]/100,1):(e=iX.exec(t))?n6(e[1],e[2]/100,e[3]/100,e[4]):Yv.hasOwnProperty(t)?Qv(Yv[t]):t==="transparent"?new kn(NaN,NaN,NaN,0):null}function Qv(t){return new kn(t>>16&255,t>>8&255,t&255,1)}function Ku(t,e,n,r){return r<=0&&(t=e=n=NaN),new kn(t,e,n,r)}function sX(t){return t instanceof Jl||(t=wl(t)),t?(t=t.rgb(),new kn(t.r,t.g,t.b,t.opacity)):new kn}function Ah(t,e,n,r){return arguments.length===1?sX(t):new kn(t,e,n,r??1)}function kn(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}pm(kn,Ah,NE(Jl,{brighter(t){return t=t==null?og:Math.pow(og,t),new kn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Sl:Math.pow(Sl,t),new kn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new kn(So(this.r),So(this.g),So(this.b),sg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:e6,formatHex:e6,formatHex8:cX,formatRgb:t6,toString:t6}));function e6(){return`#${po(this.r)}${po(this.g)}${po(this.b)}`}function cX(){return`#${po(this.r)}${po(this.g)}${po(this.b)}${po((isNaN(this.opacity)?1:this.opacity)*255)}`}function t6(){const t=sg(this.opacity);return`${t===1?"rgb(":"rgba("}${So(this.r)}, ${So(this.g)}, ${So(this.b)}${t===1?")":`, ${t})`}`}function sg(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function So(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function po(t){return t=So(t),(t<16?"0":"")+t.toString(16)}function n6(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Mr(t,e,n,r)}function PE(t){if(t instanceof Mr)return new Mr(t.h,t.s,t.l,t.opacity);if(t instanceof Jl||(t=wl(t)),!t)return new Mr;if(t instanceof Mr)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,s=a-i,c=(a+i)/2;return s?(e===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-e)/s+2:o=(e-n)/s+4,s/=c<.5?a+i:2-a-i,o*=60):s=c>0&&c<1?0:o,new Mr(o,s,c,t.opacity)}function lX(t,e,n,r){return arguments.length===1?PE(t):new Mr(t,e,n,r??1)}function Mr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}pm(Mr,lX,NE(Jl,{brighter(t){return t=t==null?og:Math.pow(og,t),new Mr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Sl:Math.pow(Sl,t),new Mr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new kn(_2(t>=240?t-240:t+120,i,r),_2(t,i,r),_2(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Mr(r6(this.h),qu(this.s),qu(this.l),sg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=sg(this.opacity);return`${t===1?"hsl(":"hsla("}${r6(this.h)}, ${qu(this.s)*100}%, ${qu(this.l)*100}%${t===1?")":`, ${t})`}`}}));function r6(t){return t=(t||0)%360,t<0?t+360:t}function qu(t){return Math.max(0,Math.min(1,t||0))}function _2(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function uX(t,e,n,r,i){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*r+o*i)/6}function b2(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],a=t[r+1],o=r>0?t[r-1]:2*i-a,s=r<e-1?t[r+2]:2*a-i;return uX((n-r/e)*e,o,i,a,s)}}const hm=t=>()=>t;function fX(t,e){return function(n){return t+n*e}}function gX(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function dX(t){return(t=+t)==1?kE:function(e,n){return n-e?gX(e,n,t):hm(isNaN(e)?n:e)}}function kE(t,e){var n=e-t;return n?fX(t,n):hm(isNaN(t)?e:t)}const i6=function t(e){var n=dX(e);function r(i,a){var o=n((i=Ah(i)).r,(a=Ah(a)).r),s=n(i.g,a.g),c=n(i.b,a.b),l=kE(i.opacity,a.opacity);return function(f){return i.r=o(f),i.g=s(f),i.b=c(f),i.opacity=l(f),i+""}}return r.gamma=t,r}(1);function pX(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function hX(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function mX(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=mm(t[o],e[o]);for(;o<n;++o)a[o]=e[o];return function(s){for(o=0;o<r;++o)a[o]=i[o](s);return a}}function vX(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function cg(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function yX(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=mm(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var Bh=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,N2=new RegExp(Bh.source,"g");function CX(t){return function(){return t}}function TX(t){return function(e){return t(e)+""}}function SX(t,e){var n=Bh.lastIndex=N2.lastIndex=0,r,i,a,o=-1,s=[],c=[];for(t=t+"",e=e+"";(r=Bh.exec(t))&&(i=N2.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,c.push({i:o,x:cg(r,i)})),n=N2.lastIndex;return n<e.length&&(a=e.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?c[0]?TX(c[0].x):CX(e):(e=c.length,function(l){for(var f=0,u;f<e;++f)s[(u=c[f]).i]=u.x(l);return s.join("")})}function mm(t,e){var n=typeof e,r;return e==null||n==="boolean"?hm(e):(n==="number"?cg:n==="string"?(r=wl(e))?(e=r,i6):SX:e instanceof wl?i6:e instanceof Date?vX:hX(e)?pX:Array.isArray(e)?mX:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?yX:cg)(t,e)}function xX(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function ic(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}function wX(t){return function(){return t}}function EX(t){return+t}var a6=[0,1];function Ds(t){return t}function Gh(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:wX(isNaN(e)?NaN:.5)}function OX(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function DX(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=Gh(i,r),a=n(o,a)):(r=Gh(r,i),a=n(a,o)),function(s){return a(r(s))}}function RX(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=Gh(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(s){var c=Wq(t,s,1,r)-1;return a[c](i[c](s))}}function MX(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function LX(){var t=a6,e=a6,n=mm,r,i,a,o=Ds,s,c,l;function f(){var g=Math.min(t.length,e.length);return o!==Ds&&(o=OX(t[0],t[g-1])),s=g>2?RX:DX,c=l=null,u}function u(g){return g==null||isNaN(g=+g)?a:(c||(c=s(t.map(r),e,n)))(r(o(g)))}return u.invert=function(g){return o(i((l||(l=s(e,t.map(r),cg)))(g)))},u.domain=function(g){return arguments.length?(t=Array.from(g,EX),f()):t.slice()},u.range=function(g){return arguments.length?(e=Array.from(g),f()):e.slice()},u.rangeRound=function(g){return e=Array.from(g),n=xX,f()},u.clamp=function(g){return arguments.length?(o=g?!0:Ds,f()):o!==Ds},u.interpolate=function(g){return arguments.length?(n=g,f()):n},u.unknown=function(g){return arguments.length?(a=g,u):a},function(g,d){return r=g,i=d,f()}}function IX(){return LX()(Ds,Ds)}function VX(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function lg(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function h0(t){return t=lg(Math.abs(t)),t?t[1]:NaN}function _X(t,e){return function(n,r){for(var i=n.length,a=[],o=0,s=t[0],c=0;i>0&&s>0&&(c+s+1>r&&(s=Math.max(1,r-c)),a.push(n.substring(i-=s,i+s)),!((c+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(e)}}function bX(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var NX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ug(t){if(!(e=NX.exec(t)))throw new Error("invalid format: "+t);var e;return new vm({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ug.prototype=vm.prototype;function vm(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}vm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function PX(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var FE;function kX(t,e){var n=lg(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(FE=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+lg(t,Math.max(0,e+a-1))[0]}function o6(t,e){var n=lg(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const s6={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:VX,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>o6(t*100,e),r:o6,s:kX,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function c6(t){return t}var l6=Array.prototype.map,u6=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function FX(t){var e=t.grouping===void 0||t.thousands===void 0?c6:_X(l6.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?c6:bX(l6.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(u){u=ug(u);var g=u.fill,d=u.align,h=u.sign,p=u.symbol,m=u.zero,v=u.width,y=u.comma,C=u.precision,T=u.trim,S=u.type;S==="n"?(y=!0,S="g"):s6[S]||(C===void 0&&(C=12),T=!0,S="g"),(m||g==="0"&&d==="=")&&(m=!0,g="0",d="=");var x=p==="$"?n:p==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",w=p==="$"?r:/[%p]/.test(S)?o:"",E=s6[S],M=/[defgprs%]/.test(S);C=C===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,C)):Math.max(0,Math.min(20,C));function O(R){var _=x,P=w,N,W,U;if(S==="c")P=E(R)+P,R="";else{R=+R;var K=R<0||1/R<0;if(R=isNaN(R)?c:E(Math.abs(R),C),T&&(R=PX(R)),K&&+R==0&&h!=="+"&&(K=!1),_=(K?h==="("?h:s:h==="-"||h==="("?"":h)+_,P=(S==="s"?u6[8+FE/3]:"")+P+(K&&h==="("?")":""),M){for(N=-1,W=R.length;++N<W;)if(U=R.charCodeAt(N),48>U||U>57){P=(U===46?i+R.slice(N+1):R.slice(N))+P,R=R.slice(0,N);break}}}y&&!m&&(R=e(R,1/0));var A=_.length+R.length+P.length,b=A<v?new Array(v-A+1).join(g):"";switch(y&&m&&(R=e(b+R,b.length?v-P.length:1/0),b=""),d){case"<":R=_+R+P+b;break;case"=":R=_+b+R+P;break;case"^":R=b.slice(0,A=b.length>>1)+_+R+P+b.slice(A);break;default:R=b+_+R+P;break}return a(R)}return O.toString=function(){return u+""},O}function f(u,g){var d=l((u=ug(u),u.type="f",u)),h=Math.max(-8,Math.min(8,Math.floor(h0(g)/3)))*3,p=Math.pow(10,-h),m=u6[8+h/3];return function(v){return d(p*v)+m}}return{format:l,formatPrefix:f}}var Xu,UE,AE;UX({thousands:",",grouping:[3],currency:["$",""]});function UX(t){return Xu=FX(t),UE=Xu.format,AE=Xu.formatPrefix,Xu}function AX(t){return Math.max(0,-h0(Math.abs(t)))}function BX(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(h0(e)/3)))*3-h0(Math.abs(t)))}function GX(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,h0(e)-h0(t))+1}function WX(t,e,n,r){var i=Kq(t,e,n),a;switch(r=ug(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(a=BX(i,o))&&(r.precision=a),AE(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=GX(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=AX(i))&&(r.precision=a-(r.type==="%")*2);break}}return UE(r)}function $X(t){var e=t.domain;return t.ticks=function(n){var r=e();return jq(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return WX(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,a=r.length-1,o=r[i],s=r[a],c,l,f=10;for(s<o&&(l=o,o=s,s=l,l=i,i=a,a=l);f-- >0;){if(l=Uh(o,s,n),l===c)return r[i]=o,r[a]=s,e(r);if(l>0)o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l;else if(l<0)o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l;else break;c=l}return t},t}function ym(){var t=IX();return t.copy=function(){return MX(t,ym())},Zq.apply(t,arguments),$X(t)}function zX(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=n=>{e.jsImageData!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=n,e.imageLoaded=!0,t.modified())},t.setCanvas=n=>{e.canvas!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=n,t.modified())},t.setImage=n=>{e.image!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=n,e.imageLoaded=!1,n.complete?t.imageLoaded():n.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let n=0,r=0,i=1;if(t.getInputData()){const o=t.getInputData();n=o.getDimensions()[0],r=o.getDimensions()[1],i=o.getDimensions()[2]}return e.jsImageData&&(n=e.jsImageData.width,r=e.jsImageData.height),e.canvas&&(n=e.canvas.width,r=e.canvas.height),e.image&&(n=e.image.width,r=e.image.height),(n>1)+(r>1)+(i>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const n=document.createElement("canvas");n.width=e.image.width,n.height=e.image.height;const r=n.getContext("2d");return r.translate(0,n.height),r.scale(1,-1),r.drawImage(e.image,0,0,e.image.width,e.image.height),r.getImageData(0,0,n.width,n.height)}return null}}const HX=(t,e,n,r)=>{const i=[1,2,1],a=4,o=i,s=a,c=t.length/(e*n);let l=e,f=n,u=t;const g=[u];for(let d=0;d<r;d++){const h=[...u];l/=2,f/=2,u=new Uint8ClampedArray(l*f*c);const p=c*l;let m=0;for(let y=0;y<u.length;y+=c){y%p===0&&(m+=2*c*l);for(let C=0;C<c;C++){let T=h[m+C];T+=h[m+c+C],T+=h[m-2*p+C],T+=h[m-2*p+c+C],T/=4,u[y+C]=T}m+=2*c}let v=[...u];for(let y=0;y<u.length;y+=c)for(let C=0;C<c;C++){let T=-(o.length-1)/2,S=s,x=0;for(let w=0;w<o.length;w++){let E=y+C+T*c;const M=E%p-(y+C)%p;M>c&&(E+=p),M<-c&&(E-=p),v[E]?x+=v[E]*o[w]:S-=o[w],T+=1}u[y+C]=x/S}v=[...u];for(let y=0;y<u.length;y+=c)for(let C=0;C<c;C++){let T=-(o.length-1)/2,S=s,x=0;for(let w=0;w<o.length;w++){const E=y+C+T*p;v[E]?x+=v[E]*o[w]:S-=o[w],T+=1}u[y+C]=x/S}g.push(u)}return g},jX={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function BE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jX,n),D.obj(t,e),D.algo(t,e,6,0),D.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),D.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),zX(t,e)}const KX=D.newInstance(BE,"vtkTexture"),qX={generateMipmaps:HX};var sd={newInstance:KX,extend:BE,...qX};const XX=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],f6=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],Yu=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],g6=[0,1,0,1,0,1,0,1,2,2,2,2],st=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],ve=new Float64Array(3),Zu=new Float64Array(3),We=new Float64Array(3),oo=new Float64Array(3),ja=new Float64Array(3),Ju=new Float64Array(3),P2=new Float64Array(16);function k2(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function GE(t){const e=[],n=[];for(let r=0;r<3;r++){const i=ym().domain([t[r*2],t[r*2+1]]);e[r]=i.ticks(5);const a=i.tickFormat(5);n[r]=e[r].map(a)}return{ticks:e,tickStrings:n}}function YX(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=n=>{e.renderable!==n&&(e.renderable=n,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(n.getProperty()),e.tmActor.setParentProp(n),t.modified())},t.createPolyDataForOneLabel=(n,r,i,a,o,s,c)=>{const l=e.renderable.get_tmAtlas().get(n);if(!l)return;const f=e.renderable.getTextPolyData().getPoints().getData(),u=e.lastSize;ve[0]=f[r*3],ve[1]=f[r*3+1],ve[2]=f[r*3+2],Ee(We,ve,i),We[0]+=.1,Ee(Zu,We,a),rt(ja,Zu,ve),We[0]-=.1,We[1]+=.1,Ee(Zu,We,a),rt(Ju,Zu,ve);for(let h=0;h<3;h++)ja[h]/=.5*.1*u[0],Ju[h]/=.5*.1*u[1];let g=c.ptIdx,d=c.cellIdx;ve[0]=f[r*3],ve[1]=f[r*3+1],ve[2]=f[r*3+2],o[0]<-.5?Hn(We,ja,o[0]*s-l.width):o[0]>.5?Hn(We,ja,o[0]*s):Hn(We,ja,o[0]*s-l.width/2),rn(ve,ve,We),Hn(We,Ju,o[1]*s-l.height/2),rn(ve,ve,We),c.points[g*3]=ve[0],c.points[g*3+1]=ve[1],c.points[g*3+2]=ve[2],c.tcoords[g*2]=l.tcoords[0],c.tcoords[g*2+1]=l.tcoords[1],g++,Hn(We,ja,l.width),rn(ve,ve,We),c.points[g*3]=ve[0],c.points[g*3+1]=ve[1],c.points[g*3+2]=ve[2],c.tcoords[g*2]=l.tcoords[2],c.tcoords[g*2+1]=l.tcoords[3],g++,Hn(We,Ju,l.height),rn(ve,ve,We),c.points[g*3]=ve[0],c.points[g*3+1]=ve[1],c.points[g*3+2]=ve[2],c.tcoords[g*2]=l.tcoords[4],c.tcoords[g*2+1]=l.tcoords[5],g++,Hn(We,ja,l.width),rt(ve,ve,We),c.points[g*3]=ve[0],c.points[g*3+1]=ve[1],c.points[g*3+2]=ve[2],c.tcoords[g*2]=l.tcoords[6],c.tcoords[g*2+1]=l.tcoords[7],g++,c.polys[d*4]=3,c.polys[d*4+1]=g-4,c.polys[d*4+2]=g-3,c.polys[d*4+3]=g-2,d++,c.polys[d*4]=3,c.polys[d*4+1]=g-4,c.polys[d*4+2]=g-2,c.polys[d*4+3]=g-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const n=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);xe(n,n);const r=e.renderable.getTextValues().length,i=r*4,a=r*2,o=new Float64Array(i*3),s=new Uint16Array(a*4),c=new Float32Array(i*2);xt(P2,n);const l={ptIdx:0,cellIdx:0,polys:s,points:o,tcoords:c};let f=0,u=0,g=0;const d=e.renderable.getTextPolyData().getPoints().getData(),h=e.renderable.getTextValues();for(;f<d.length/3;){ve[0]=d[f*3],ve[1]=d[f*3+1],ve[2]=d[f*3+2],Ee(We,ve,n),ve[0]=d[f*3+3],ve[1]=d[f*3+4],ve[2]=d[f*3+5],Ee(oo,ve,n),rt(We,We,oo);const m=[We[0],We[1]];yT(m),t.createPolyDataForOneLabel(h[u],f,n,P2,m,e.renderable.getAxisTitlePixelOffset(),l),f+=2,u++;for(let v=0;v<e.renderable.getTickCounts()[g];v++)t.createPolyDataForOneLabel(h[u],f,n,P2,m,e.renderable.getTickLabelPixelOffset(),l),f++,u++;g++}const p=he.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(p),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(s,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(n,r,i)=>{(e.lastSize[0]!==n[0]||e.lastSize[1]!==n[1])&&(e.lastSize[0]=n[0],e.lastSize[1]=n[1],e.lastAspectRatio=n[0]/n[1],e.forceUpdate=!0),e.camera=r,t.updateTexturePolyData()}}const ZX=D.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),D.obj(t,e),e.tmPolyData=Bn.newInstance(),e.tmMapper=No.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=ko.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),D.setGet(t,e,["renderable"]),D.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},D.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},D.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],YX(t,e)},"vtkCubeAxesActorHelper");function JX(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=r=>{e.camera!==r&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=r,r&&(e.cameraModifiedSub=r.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const r=e.camera.getViewMatrix();xe(r,r);let i=!1;const a=Be.getDiagonalLength(e.dataBounds),o=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let s=0;s<6;s++){let c=!1;const l=Math.floor(s/2),f=(l+1)%3,u=(l+2)%3;e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&e.dataBounds[u*2]!==e.dataBounds[u*2+1]&&(ve[l]=e.dataBounds[s]-.1*a*XX[s][l],ve[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),ve[u]=.5*(e.dataBounds[u*2]+e.dataBounds[u*2+1]),Ee(We,ve,r),ve[l]=e.dataBounds[s],Ee(oo,ve,r),rt(We,oo,We),$t(We,We),c=We[2]>o,e.camera.getParallelProjection()||($t(oo,oo),c=fe(oo,We)>o)),c!==e.lastFacesToDraw[s]&&(e.lastFacesToDraw[s]=c,i=!0)}return i},t.updatePolyData=(r,i,a)=>{let o=0,s=0;o+=8;let c=0;for(let d=0;d<12;d++)i[d]>0&&c++;if(s+=c,e.gridLines)for(let d=0;d<6;d++)r[d]&&(o+=a[st[d][0]].length*2+a[st[d][1]].length*2,s+=a[st[d][0]].length+a[st[d][1]].length);const l=new Float64Array(o*3),f=new Uint32Array(s*3);let u=0,g=0;for(let d=0;d<2;d++)for(let h=0;h<2;h++)for(let p=0;p<2;p++)l[u*3]=e.dataBounds[p],l[u*3+1]=e.dataBounds[2+h],l[u*3+2]=e.dataBounds[4+d],u++;for(let d=0;d<12;d++)i[d]>0&&(f[g*3]=2,f[g*3+1]=Yu[d][0],f[g*3+2]=Yu[d][1],g++);if(e.gridLines){for(let d=0;d<6;d++)if(r[d]){const h=Math.floor(d/2);let p=a[st[d][0]];for(let m=0;m<p.length;m++)l[u*3+h]=e.dataBounds[d],l[u*3+st[d][0]]=p[m],l[u*3+st[d][1]]=e.dataBounds[st[d][1]*2],u++,l[u*3+h]=e.dataBounds[d],l[u*3+st[d][0]]=p[m],l[u*3+st[d][1]]=e.dataBounds[st[d][1]*2+1],u++,f[g*3]=2,f[g*3+1]=u-2,f[g*3+2]=u-1,g++;p=a[st[d][1]];for(let m=0;m<p.length;m++)l[u*3+h]=e.dataBounds[d],l[u*3+st[d][1]]=p[m],l[u*3+st[d][0]]=e.dataBounds[st[d][0]*2],u++,l[u*3+h]=e.dataBounds[d],l[u*3+st[d][1]]=p[m],l[u*3+st[d][0]]=e.dataBounds[st[d][0]*2+1],u++,f[g*3]=2,f[g*3+1]=u-2,f[g*3+2]=u-1,g++}}e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(f,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(r,i,a,o)=>{let s=0;for(let d=0;d<12;d++)i[d]===1&&(s+=2,s+=a[g6[d]].length);const c=e.polyData.getPoints().getData(),l=new Float64Array(s*3);let f=0,u=0,g=0;for(let d=0;d<6;d++)if(r[d])for(let h=0;h<4;h++){const p=f6[d][h];if(i[p]===1){const m=g6[p],v=Yu[p][0]*3,y=Yu[p][1]*3;l[f*3]=.5*(c[v]+c[y]),l[f*3+1]=.5*(c[v+1]+c[y+1]),l[f*3+2]=.5*(c[v+2]+c[y+2]),f++;const C=Math.floor(d/2);l[f*3+C]=e.dataBounds[d],l[f*3+st[d][0]]=.5*(e.dataBounds[st[d][0]*2]+e.dataBounds[st[d][0]*2+1]),l[f*3+st[d][1]]=.5*(e.dataBounds[st[d][1]*2]+e.dataBounds[st[d][1]*2+1]),f++,e.textValues[u]=e.axisLabels[m],u++;const T=(m+1)%3,S=(m+2)%3,x=a[m],w=o[m];e.tickCounts[g]=x.length;for(let E=0;E<x.length;E++)l[f*3+m]=x[E],l[f*3+T]=c[v+T],l[f*3+S]=c[v+S],f++,e.textValues[u]=w[E],u++;g++}}e.textPolyData.getPoints().setData(l,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const r=t.computeFacesToDraw(),i=e.lastFacesToDraw;let a=!1;for(let o=0;o<6;o++)e.dataBounds[o]!==e.lastTickBounds[o]&&(a=!0,e.lastTickBounds[o]=e.dataBounds[o]);if(r||a||e.forceUpdate){const o=new Array(12).fill(0);for(let c=0;c<6;c++)if(i[c])for(let l=0;l<4;l++)o[f6[c][l]]++;const s=e.generateTicks(e.dataBounds);t.updatePolyData(i,o,s.ticks),t.updateTextData(i,o,s.ticks,s.tickStrings),(a||e.forceUpdate)&&t.updateTextureAtlas(s.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=r=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let i=0,a=1;for(let o=0;o<3;o++){if(!e._tmAtlas.has(e.axisLabels[o])){k2(e.tmContext,e.axisTextStyle);const s=e.tmContext.measureText(e.axisLabels[o]),c={height:s.actualBoundingBoxAscent+2,startingHeight:a,width:s.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[o],c),a+=c.height,i<c.width&&(i=c.width)}k2(e.tmContext,e.tickTextStyle);for(let s=0;s<r[o].length;s++)if(!e._tmAtlas.has(r[o][s])){const c=e.tmContext.measureText(r[o][s]),l={height:c.actualBoundingBoxAscent+2,startingHeight:a,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(r[o][s],l),a+=l.height,i<l.width&&(i=l.width)}}i=cr(i),a=cr(a),e._tmAtlas.forEach(o=>{o.tcoords=[0,(a-o.startingHeight-o.height)/a,o.width/i,(a-o.startingHeight-o.height)/a,o.width/i,(a-o.startingHeight)/a,0,(a-o.startingHeight)/a]}),e.tmCanvas.width=i,e.tmCanvas.height=a,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,a),e._tmAtlas.forEach((o,s)=>{k2(e.tmContext,o.textStyle),e.tmContext.fillText(s,1,o.startingHeight+o.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),Be.setBounds(e.bounds,e.gridActor.getBounds()),Be.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const n=D.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=r=>n(r)[0]}function QX(t,e,n){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...Be.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:GE,...n,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...n==null?void 0:n.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...n==null?void 0:n.tickTextStyle}}}function WE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ko.extend(t,e,QX(t,e,n)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=sd.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=No.newInstance(),e.polyData=Bn.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=ko.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=Bn.newInstance(),D.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),D.setGetArray(t,e,["dataBounds"],6),D.setGetArray(t,e,["axisLabels"],3),D.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),JX(t,e)}const eY=D.newInstance(WE,"vtkCubeAxesActor");var $E={newInstance:eY,extend:WE,newCubeAxesActorHelper:ZX,defaultGenerateTicks:GE};function tY(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e._openGLRenderWindow.getRenderable())}}}const nY={};function rY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nY,n),ze.extend(t,e,n),e.CubeAxesActorHelper=$E.newCubeAxesActorHelper(),tY(t,e)}const iY=be(rY,"vtkOpenGLCubeAxesActor");Nt("vtkCubeAxesActor",iY);const{ColorMode:aY,ScalarMode:Ka,GetArray:F2}=qg;function oY(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=()=>{e.lookupTable=W1.newInstance()},t.getColorModeAsString=()=>D.enumToString(aY,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>D.enumToString(Ka,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,i,a,o)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let s=null,c=!1;if(r===Ka.DEFAULT)s=n.getPointData().getScalars(),s||(s=n.getCellData().getScalars(),c=!0);else if(r===Ka.USE_POINT_DATA)s=n.getPointData().getScalars();else if(r===Ka.USE_CELL_DATA)s=n.getCellData().getScalars(),c=!0;else if(r===Ka.USE_POINT_FIELD_DATA){const l=n.getPointData();i===F2.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===Ka.USE_CELL_FIELD_DATA){const l=n.getCellData();c=!0,i===F2.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}else if(r===Ka.USE_FIELD_DATA){const l=n.getFieldData();i===F2.BY_ID?s=l.getArrayByIndex(a):s=l.getArrayByName(o)}return{scalars:s,cellFlag:c}},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.mapScalars=(n,r)=>{const i=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!i){e.colorMapColors=null;return}const a=`${t.getMTime()}${i.getMTime()}${r}`;if(e.colorBuildString===a)return;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(i,e.colorMode,e.fieldDataTupleId)),e.colorBuildString=`${t.getMTime()}${i.getMTime()}${r}`},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}}}const sY={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function cY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sY,n),OS.extend(t,e,n),D.get(t,e,["colorMapColors"]),D.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),D.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),oY(t,e)}D.newInstance(cY,"vtkMapper2D");var lY={},uY=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,fY=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const zE={BACKGROUND:0,FOREGROUND:1};var HE={DisplayLocation:zE};const{primTypes:xr}=ri,{ScalarMode:Qu}=lY,{vtkErrorMacro:ef}=cn,gY={type:"StartEvent"},dY={type:"EndEvent"};function pY(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=r=>{r&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=r=>{r&&t.render()},t.getShaderTemplate=(r,i,a)=>{r.Vertex=fY,r.Fragment=uY,r.Geometry=""},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let o=xr.Start;o<xr.End;o++)e.primitives[o].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor2D.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.renderPiece=(r,i)=>{if(t.invokeEvent(gY),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(dY),!e.currentInput){ef("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(r,i),e.lastBoundBO=null},t.getNeedToRebuildShaders=(r,i,a)=>r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>{const a=e.VBOBuildTime.getMTime();return!!(a<t.getMTime()||a<e._openGLRenderWindow.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&a<r.getMTime())},t.buildBufferObjects=(r,i)=>{const a=e.currentInput;if(a===null)return;e.renderable.mapScalars(a,i.getProperty().getOpacity());const o=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Qu.USE_CELL_DATA||s===Qu.USE_CELL_FIELD_DATA||s===Qu.USE_FIELD_DATA||!a.getPointData().getScalars())&&s!==Qu.USE_POINT_FIELD_DATA&&o&&(e.haveCellScalars=!0);const c=i.getProperty().getRepresentation();let l=a.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(l=null);const f=e.renderable.getTransformCoordinate(),g=r.getRenderWindow().getViews()[0].getViewportSize(r),d=`${a.getMTime()}A${c}B${a.getMTime()}C${o?o.getMTime():1}D${l?l.getMTime():1}E${f?r.getMTime():1}F${g}`;if(e.VBOBuildString!==d){let h=a.getPoints();if(f){const m=z1.newInstance(),v=h.getNumberOfPoints();m.setNumberOfPoints(v);const y=[];for(let C=0;C<v;++C){h.getPoint(C,y),f.setValue(y);const T=f.getComputedDoubleViewportValue(r);m.setPoint(C,T[0],T[1],0)}h=m}const p={points:h,tcoords:l,colors:o,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(m=>a.getPointData().getArrayByName(m))};p.cellOffset+=e.primitives[xr.Points].getCABO().createVBO(a.getVerts(),"verts",c,p),p.cellOffset+=e.primitives[xr.Lines].getCABO().createVBO(a.getLines(),"lines",c,p),p.cellOffset+=e.primitives[xr.Tris].getCABO().createVBO(a.getPolys(),"polys",c,p),p.cellOffset+=e.primitives[xr.TriStrips].getCABO().createVBO(a.getStrips(),"strips",c,p),e.VBOBuildTime.modified(),e.VBOBuildString=d}},t.renderPieceDraw=(r,i)=>{const a=i.getProperty().getRepresentation();e.context.depthMask(!0);for(let s=xr.Start;s<xr.End;s++)e.primitives[s].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[s],e.primitiveIDOffset+=e.primitives[s].drawArrays(r,i,a,t))},t.renderPieceFinish=(r,i)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=(r,i,a)=>{t.replaceShaderColor(r,i,a),t.replaceShaderTCoord(r,i,a),t.replaceShaderPicking(r,i,a),t.replaceShaderPositionVC(r,i,a)},t.replaceShaderColor=(r,i,a)=>{let o=r.Vertex,s=r.Geometry,c=r.Fragment;e.haveCellScalars&&(c=k.substitute(c,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,c=k.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(o=k.substitute(o,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,o=k.substitute(o,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,s=k.substitute(s,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,s=k.substitute(s,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,c=k.substitute(c,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,c=k.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(c=k.substitute(c,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,c=k.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c},t.replaceShaderTCoord=(r,i,a)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let o=r.Vertex,s=r.Geometry,c=r.Fragment;const l=e.lastBoundBO.getCABO().getTCoordComponents();l===1?(o=k.substitute(o,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,o=k.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=k.substitute(s,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,s=k.substitute(s,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=k.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=k.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):l===2&&(o=k.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,o=k.substitute(o,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=k.substitute(s,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,s=k.substitute(s,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=k.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=k.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(s=k.substitute(s,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),r.Vertex=o,r.Geometry=s,r.Fragment=c}},t.replaceShaderPicking=(r,i,a)=>{let o=r.Fragment;o=k.substitute(o,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,o=k.substitute(o,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,r.Fragment=o},t.replaceShaderPositionVC=(r,i,a)=>{e.lastBoundBO.replaceShaderPositionVC(r,i,a)},t.invokeShaderCallbacks=(r,i,a)=>{const o=e.renderable.getViewSpecificProperties().ShadersCallbacks;o&&o.forEach(s=>{s.callback(s.userData,r,i,a)})},t.setMapperShaderParameters=(r,i,a)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isAttributeUsed("vertexWC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexWC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||ef("Error setting vertexWC in shader VAO.")),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,l)=>{r.getProgram().isAttributeUsed(`${c}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${c}MC`,r.getCABO().getCustomData()[l].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[l].components,!1)||ef(`Error setting ${c}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||ef("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const o=e.openGLActor2D.getActiveTextures();if(o)for(let c=0;c<o.length;++c){const f=o[c].getTextureUnit(),u=`texture${f+1}`;r.getProgram().isUniformUsed(u)&&r.getProgram().setUniformi(u,f)}r.setMapperShaderParameters(i,a,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(r,i,a)=>{const o=e.renderable.getColorMapColors();if(!o||o.getNumberOfComponents()===0){const s=r.getProgram(),c=a.getProperty(),l=c.getOpacity(),f=c.getColor(),u=[f[0],f[1],f[2],l];s.setUniform4f("diffuseColor",u)}},t.setLightingShaderParameters=(r,i,a)=>{};function n(r,i,a){return i.identity(a),r.reduce((o,s,c)=>c===0?s?i.copy(o,s):i.identity(o):s?i.multiply(o,o,s):o,a)}t.setCameraShaderParameters=(r,i,a)=>{const o=r.getProgram(),c=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,f=i.getRenderWindow().getViews()[0].getViewportSize(i),u=i.getViewport(),g=a.getActualPositionCoordinate().getComputedDoubleViewportValue(i),d=[0,0,1,1],h=[0,0,1,1];if(h[0]=u[0]>=d[0]?u[0]:d[0],h[1]=u[1]>=d[1]?u[1]:d[1],h[2]=u[2]<=d[2]?u[2]:d[2],h[3]=u[3]<=d[3]?u[3]:d[3],h[0]>=h[2]||h[1]>=h[3])return;f[0]=vc(f[0]*(h[2]-h[0])/(u[2]-u[0])),f[1]=vc(f[1]*(h[3]-h[1])/(u[3]-u[1]));const p=e._openGLRenderer.getParent().getSize(),m=vc(g[0]-(h[0]-u[0])*p[0]),v=vc(g[1]-(h[1]-u[1])*p[1]),y=-m;let C=-m+f[0];const T=-v;let S=-v+f[1];y===C&&(C=y+1),T===S&&(S=T+1);const x=ie(new Float64Array(16));x[0]=2/(C-y),x[1*4+1]=2/(S-T),x[0*4+3]=-1*(C+y)/(C-y),x[1*4+3]=-1*(S+T)/(S-T),x[2*4+2]=0,x[2*4+3]=a.getProperty().getDisplayLocation()===zE.FOREGROUND?-1:1,x[3*4+3]=1,xe(x,x),o.setUniformMatrix("WCVCMatrix",n([x,c],gl,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(i=>{r+=i.getAllocatedGPUMemoryInBytes()}),r}}const hY={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function mY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hY,n),ze.extend(t,e,n),ti.implementReplaceShaderCoincidentOffset(t,e,n),ti.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=xr,e.tmpMat4=ie(new Float64Array(16));for(let r=xr.Start;r<xr.End;r++)e.primitives[r]=ri.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Ot(t,e,["context"]),e.VBOBuildTime={},je(e.VBOBuildTime,{mtime:0}),pY(t,e)}const vY=be(mY,"vtkOpenGLPolyDataMapper2D");Nt("vtkMapper2D",vY);const{VectorMode:yY}=Xg;function U2(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function jE(t,e){return n=>{const r=n.getLastSize(),i=(r[0]/700)**.8,a=(r[1]/700)**.8,o=Math.min(i,a),s=n.getAxisTextStyle(),c=n.getTickTextStyle();Object.assign(s,e.axisTextStyle),Object.assign(c,e.tickTextStyle),s.fontSize=Math.max(24*o,12),n.getLastAspectRatio()>1?c.fontSize=Math.max(20*o,10):c.fontSize=Math.max(16*o,10);const l=n.updateTextureAtlas();n.setTopTitle(!1);const f=n.getBoxSizeByReference();if(n.getLastAspectRatio()>1)n.setTickLabelPixelOffset(.3*c.fontSize),l.titleWidth<=l.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize?(n.setTopTitle(!0),n.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.98-f[0],-.92])):(n.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.titleHeight+n.getAxisTitlePixelOffset()+l.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.99-f[0],-.92])),f[1]=Math.max(1.2,Math.min(1.84/a,1.84));else{n.setAxisTitlePixelOffset(1.2*c.fontSize),n.setTickLabelPixelOffset(.1*c.fontSize);const u=2*(.8*c.fontSize+l.titleHeight+n.getAxisTitlePixelOffset())/r[1],g=2*l.tickWidth/r[0];f[0]=Math.min(1.9,Math.max(1.4,1.4*g*(n.getTicks().length+3))),f[1]=u,n.setBoxPosition([-.5*f[0],-.97])}n.recomputeBarSegments(l)}}function KE(t,e){return n=>{const r=n.getLastTickBounds(),i=ym().domain([r[0],r[1]]),a=i.ticks(5),o=i.tickFormat(5);n.setTicks(a),n.setTickStrings(a.map(o))}}function CY(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=i=>{e.renderable!==i&&(e.renderable=i,e.barActor.setProperty(i.getProperty()),e.barActor.setParentProp(i),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(i.getProperty()),e.tmActor.setParentProp(i),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=i.generateTicks,e.axisTextStyle={...i.getAxisTextStyle()},e.tickTextStyle={...i.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(i,a,o)=>{(e.lastSize[0]!==i[0]||e.lastSize[1]!==i[1])&&(e.lastSize[0]=i[0],e.lastSize[1]=i[1],e.lastAspectRatio=i[0]/i[1],e.forceUpdate=!0);const s=e.renderable.getScalarsToColors();if(!(!s||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(s),e.camera=a,e.renderWindow=o,e.forceUpdate||Math.max(s.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=s.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const l=t.updateTextureAtlas();t.recomputeBarSegments(l)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const i={},a=new Map;let o=0,s=1;U2(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.axisTextStyle};a.set(e.renderable.getAxisLabel(),l),s+=l.height,o=l.width,i.titleWidth=l.width,i.titleHeight=l.height,i.tickWidth=0,i.tickHeight=0,U2(e.tmContext,e.tickTextStyle);const f=[...t.getTickStrings(),"NaN","Below","Above"];for(let u=0;u<f.length;u++)a.has(f[u])||(c=e.tmContext.measureText(f[u]),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.tickTextStyle},a.set(f[u],l),s+=l.height,o<l.width&&(o=l.width),i.tickWidth<l.width&&(i.tickWidth=l.width),i.tickHeight<l.height&&(i.tickHeight=l.height));return o=cr(o),s=cr(s),a.forEach(u=>{u.tcoords=[0,(s-u.startingHeight-u.height)/s,u.width/o,(s-u.startingHeight-u.height)/s,u.width/o,(s-u.startingHeight)/s,0,(s-u.startingHeight)/s]}),e.tmCanvas.width=o,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,o,s),a.forEach((u,g)=>{U2(e.tmContext,u.textStyle),e.tmContext.fillText(g,1,u.startingHeight+u.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=a,i},t.computeBarSize=i=>{e.vertical=e.boxSize[1]>e.boxSize[0];const a=2*i.tickHeight/e.lastSize[1],o=[1,1];if(e.vertical){const s=2*(i.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-s,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-s,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+s,e.barPosition[1]=e.boxPosition[1],o[1]=a}else{const s=(2*i.tickWidth-8)/e.lastSize[0],c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],o[0]=s}return o},t.recomputeBarSegments=i=>{var g,d,h,p;const a=t.computeBarSize(i);e.barSegments=[];const o=[0,0],s=e.vertical?1:0,c=e.vertical?.01:.02;function l(m,v){e.barSegments.push({corners:[[...o],[o[0]+a[0],o[1]],[o[0]+a[0],o[1]+a[1]],[o[0],o[1]+a[1]]],scalars:v,title:m}),o[s]+=a[s]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&l("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((d=(g=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&d.call(g))&&l("Below",[-.1,-.1,-.1,-.1]);const f=(p=(h=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:p.call(h);o[s]+=c;const u=a[s];a[s]=f?1-2*c-a[s]-o[s]:1-c-o[s],l("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&f&&(a[s]=u,o[s]+=c,l("Above",[1.1,1.1,1.1,1.1]))};const n=new Float64Array(3);t.createPolyDataForOneLabel=(i,a,o,s,c,l)=>{const f=e._tmAtlas.get(i);if(!f)return;let u=l.ptIdx,g=l.cellIdx;n[0]=(.5*a[0]+.5)*e.lastSize[0],n[1]=(.5*a[1]+.5)*e.lastSize[1],n[2]=a[2],n[0]+=c[0],n[1]+=c[1];const d=[],h=s==="vertical"?[1,0]:[0,1];s==="vertical"?(d[0]=f.width,d[1]=-f.height,o[0]==="middle"?n[1]-=f.width/2:o[0]==="right"&&(n[1]-=f.width),o[1]==="middle"?n[0]+=f.height/2:o[1]==="top"&&(n[0]+=f.height)):(d[0]=f.width,d[1]=f.height,o[0]==="middle"?n[0]-=f.width/2:o[0]==="right"&&(n[0]-=f.width),o[1]==="middle"?n[1]-=f.height/2:o[1]==="top"&&(n[1]-=f.height)),l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[0],l.tcoords[u*2+1]=f.tcoords[1],u++,n[h[0]]+=d[0],l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[2],l.tcoords[u*2+1]=f.tcoords[3],u++,n[h[1]]+=d[1],l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[4],l.tcoords[u*2+1]=f.tcoords[5],u++,n[h[0]]-=d[0],l.points[u*3]=n[0],l.points[u*3+1]=n[1],l.points[u*3+2]=n[2],l.tcoords[u*2]=f.tcoords[6],l.tcoords[u*2+1]=f.tcoords[7],u++,l.polys[g*4]=3,l.polys[g*4+1]=u-4,l.polys[g*4+2]=u-3,l.polys[g*4+3]=u-2,g++,l.polys[g*4]=3,l.polys[g*4+1]=u-4,l.polys[g*4+2]=u-2,l.polys[g*4+3]=u-1,l.ptIdx+=4,l.cellIdx+=2};const r=new Float64Array(3);t.updatePolyDataForLabels=()=>{const i=t.getTickStrings().length+e.barSegments.length,a=i*4,o=i*2,s=new Float64Array(a*3),c=new Uint16Array(o*4),l=new Float32Array(a*2),f={ptIdx:0,cellIdx:0,polys:c,points:s,tcoords:l},u=e.vertical?0:1,g=e.vertical?1:0;r[2]=-.99;const d=e.vertical?["right","middle"]:["middle","bottom"];let h=[0,1];const p=[0,0];e.vertical?(p[0]=-e.tickLabelPixelOffset,e.topTitle?(r[0]=e.boxPosition[0]+.5*e.boxSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)):(r[0]=e.barPosition[0]+e.barSize[0],r[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],f)),h=[-1,0]):(p[1]=e.tickLabelPixelOffset,r[0]=e.barPosition[0]+.5*e.barSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)),r[u]=e.barPosition[u]+(.5*h[u]+.5)*e.barSize[u],r[g]=e.barPosition[g]+e.barSize[g]*.5;let m=null;for(let x=0;x<e.barSegments.length;x++){const w=e.barSegments[x];w.title==="ticks"?m=w:(r[g]=e.barPosition[g]+.5*e.barSize[g]*(w.corners[2][g]+w.corners[0][g]),t.createPolyDataForOneLabel(w.title,r,d,"horizontal",p,f))}const v=e.barPosition[g]+e.barSize[g]*m.corners[0][g],y=e.barSize[g]*(m.corners[2][g]-m.corners[0][g]),C=t.getTicks(),T=t.getTickStrings();for(let x=0;x<C.length;x++){const w=(C[x]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);r[g]=v+y*w,t.createPolyDataForOneLabel(T[x],r,d,"horizontal",p,f)}const S=he.newInstance({numberOfComponents:2,values:l,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(S),e.tmPolyData.getPoints().setData(s,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var p,m;const i=e.renderable.getScalarsToColors();let a=0;e.renderable.getDrawNanAnnotation()&&i.getNanColor()&&(a+=1),e.renderable.getDrawBelowRangeSwatch()&&((p=i.getUseBelowRangeColor)!=null&&p.call(i))&&(a+=1),e.renderable.getDrawAboveRangeSwatch()&&((m=i.getUseAboveRangeColor)!=null&&m.call(i))&&(a+=1);const o=4*(1+a),s=o;let c=1;i.getVectorMode()===yY.COMPONENT&&(c=i.getVectorComponent()+1);const l=new Float64Array(o*3),f=new Uint16Array(s*5),u=new Float32Array(o*c);let g=0,d=0;for(let v=0;v<e.barSegments.length;v++){const y=e.barSegments[v];for(let C=0;C<4;C++){r[0]=e.barPosition[0]+y.corners[C][0]*e.barSize[0],r[1]=e.barPosition[1]+y.corners[C][1]*e.barSize[1],l[g*3]=(.5*r[0]+.5)*e.lastSize[0],l[g*3+1]=(.5*r[1]+.5)*e.lastSize[1],l[g*3+2]=r[2];for(let T=0;T<c;T++)u[g*c+T]=e.lastTickBounds[0]+y.scalars[C]*(e.lastTickBounds[1]-e.lastTickBounds[0]);g++}f[d*5]=4,f[d*5+1]=g-4,f[d*5+2]=g-3,f[d*5+3]=g-2,f[d*5+4]=g-1,d++}const h=he.newInstance({numberOfComponents:c,values:u,name:"Scalars"});e.polyData.getPointData().setScalars(h),e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(f,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const TY=D.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),D.obj(t,e),D.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings"]),D.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),D.getArray(t,e,["boxPosition","boxSize"]),D.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},D.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=No.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=Bn.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=ko.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=Bn.newInstance(),e.tmMapper=No.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=sd.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=ko.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],CY(t,e)},"vtkScalarBarActorHelper");function SY(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(jE(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(KE())}}function xY(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function qE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xY(n)),e.autoLayout||(e.autoLayout=jE(t,e)),e.generateTicks||(e.generateTicks=KE()),ko.extend(t,e,n),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),D.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),D.get(t,e,["axisTextStyle","tickTextStyle"]),D.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),D.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),SY(t,e)}const wY=D.newInstance(qE,"vtkScalarBarActor");var XE={newInstance:wY,extend:qE,newScalarBarActorHelper:TY};function EY(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e._openGLRenderWindow.getRenderable())}}}const OY={};function DY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OY,n),ze.extend(t,e,n),e.scalarBarActorHelper=XE.newScalarBarActorHelper(),EY(t,e)}const RY=be(DY,"vtkOpenGLScalarBarActor");Nt("vtkScalarBarActor",RY);const{CoordinateSystem:d6}=jl;function MY(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix();e.bufferShift[0]=r[3],e.bufferShift[1]=r[7],e.bufferShift[2]=r[11];const i=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===d6.WORLD&&(e.bufferShift[0]-=i[0],e.bufferShift[1]-=i[1],e.bufferShift[2]-=i[2]),xe(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?ie(e.keyMatrices.normalMatrix):(it(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,xt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),xe(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),nt(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===d6.WORLD?nt(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]):it(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const LY={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function IY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LY,n),ze.extend(t,e,n),e.keyMatricesTime={},D.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},D.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],MY(t,e)}const VY=D.newInstance(IY);hr("vtkActor",VY);const{CoordinateSystem:p6}=jl;function _Y(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const r=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===p6.WORLD&&(e.bufferShift[0]-=r[0],e.bufferShift[1]-=r[1],e.bufferShift[2]-=r[2]),ie(e.keyMatrices.bcwc),ie(e.keyMatrices.normalMatrix),nt(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===p6.WORLD?nt(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]):it(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const bY={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function NY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bY,n),ze.extend(t,e,n),e.keyMatricesTime={},D.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},D.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],_Y(t,e)}const PY=D.newInstance(NY);hr("vtkActor2D",PY);function kY(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const FY={};function UY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FY,n),ze.extend(t,e,n),e.CubeAxesActorHelper=$E.newCubeAxesActorHelper(),kY(t,e)}const AY=be(UY,"vtkWebGPUCubeAxesActor");hr("vtkCubeAxesActor",AY);const{DisplayLocation:Wh}=HE;function BY(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(Wh.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(Wh.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(an.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(an.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(an.POINTS),t.getRepresentationAsString=()=>D.enumToString(an,e.representation)}const GY={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:an.SURFACE,displayLocation:Wh.FOREGROUND};function WY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GY,n),D.obj(t,e),D.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),D.setGetArray(t,e,["color"],3),BY(t,e)}D.newInstance(WY,"vtkProperty2D");var $Y={...HE};const{BufferUsage:Ht,PrimitiveTypes:Tn}=N0,{Representation:tf}=_0,{ScalarMode:nf}=No,{CoordinateSystem:zY}=jl,{DisplayLocation:HY}=$Y,jY=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,KY=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var pi: f32 = 3.14159265359; 
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var pi: f32 = 3.14159265359; 

  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;
  
  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  
  var L: vec3<f32> = normalize(direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf*incoming*angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); 
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// TODO: find some way to reduce the number of arguments going in here
fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = color * (1.0 / (dist*dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  
  // Cones.x is the inner phi and cones.y is the outer phi
  var theta: f32 = mdot(normalize(direction), L);
  var epsilon: f32 = cones.x - cones.y;
  var intensity: f32 = (theta - cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist*dist;

  var incoming: vec3<f32> = color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function h6(t){return t.indexOf("edge")>=0}function qY(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=n=>{n&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==zY.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var a;const r=e.WebGPUActor.getRenderable().getProperty(),i=e.UBO.getSendTime();if(t.getMTime()>i||r.getMTime()>i||e.renderable.getMTime()>i){const o=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",o.bcwc),e.UBO.setArray("BCSCMatrix",o.bcsc),e.UBO.setArray("MCWCNormals",o.normalMatrix),e.is2D){e.UBO.setValue("ZValue",e.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===HY.FOREGROUND?1:0);const l=r.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[l[0],l[1],l[2],1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else{let l=r.getAmbientColorByReference();e.UBO.setValue("AmbientIntensity",r.getAmbient()),e.UBO.setArray("AmbientColor",[l[0],l[1],l[2],1]),e.UBO.setValue("DiffuseIntensity",r.getDiffuse()),l=r.getDiffuseColorByReference(),e.UBO.setArray("DiffuseColor",[l[0],l[1],l[2],1]),e.UBO.setValue("Roughness",r.getRoughness()),e.UBO.setValue("BaseIOR",r.getBaseIOR()),e.UBO.setValue("Metallic",r.getMetallic()),e.UBO.setValue("NormalStrength",r.getNormalStrength()),e.UBO.setValue("Emission",r.getEmission()),e.UBO.setValue("SpecularIntensity",r.getSpecular()),l=r.getSpecularColorByReference(),e.UBO.setArray("SpecularColor",[l[0],l[1],l[2],1])}const s=(a=r.getEdgeColorByReference)==null?void 0:a.call(r);s&&e.UBO.setArray("EdgeColor",[s[0],s[1],s[2],1]),e.UBO.setValue("LineWidth",r.getLineWidth()),e.UBO.setValue("Opacity",r.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID());const c=e.WebGPURenderWindow.getDevice();e.UBO.sendIfNeeded(c)}},t.haveWideLines=()=>{const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();return n.getProperty().getLineWidth()<=1||e.primitiveType===Tn.Verts?!1:e.primitiveType===Tn.Triangles||e.primitiveType===Tn.TriangleStrips?r===tf.WIREFRAME:!0},t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.hasOutput("vertexVC")||a.addOutput("vec4<f32>","vertexVC");let o=a.getCode();e.useRendererMatrix?(o=$e.substitute(o,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(o=$e.substitute(o,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(o=$e.substitute(o,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(o=$e.substitute(o,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(a.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),o=$e.substitute(o,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),o=$e.substitute(o,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,a.setCode(o)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(n,r,i)=>{const a=i.getBuffer("normalMC"),o=e.WebGPUActor.getRenderable();if(a){const s=r.getShaderDescription("vertex");s.hasOutput("normalVC")||s.addOutput("vec3<f32>","normalVC",a.getArrayInformation()[0].interpolation),s.hasOutput("tangentVC")||s.addOutput("vec3<f32>","tangentVC",a.getArrayInformation()[0].interpolation),s.hasOutput("bitangentVC")||s.addOutput("vec3<f32>","bitangentVC",a.getArrayInformation()[0].interpolation);let c=s.getCode();c=$e.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,s.setCode(c);const l=r.getShaderDescription("fragment");c=l.getCode(),o.getProperty().getNormalTexture()?c=$e.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=$e.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,l.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(n,r,i)=>{var l;if(n.includes("sel"))return;const a=r.getShaderDescription("vertex");a.hasOutput("vertexVC")||a.addOutput("vec4<f32>","vertexVC");const o=e.WebGPURenderer.getRenderable(),s=r.getShaderDescription("fragment");let c=s.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!h6(n)&&!e.is2D&&!n.includes("sel")){const f=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];(l=o.getEnvironmentTexture())!=null&&l.getImageLoaded()&&f.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),c=$e.substitute(c,"//VTK::Light::Impl",f).result,s.setCode(c)}else c=$e.substitute(c,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,s.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(n,r,i)=>{if(h6(n)){const l=r.getShaderDescription("fragment");let f=l.getCode();f=$e.substitute(f,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,l.setCode(f);return}const a=i.getBuffer("colorVI");if(!a)return;const o=r.getShaderDescription("vertex");o.addOutput("vec4<f32>","color",a.getArrayInformation()[0].interpolation);let s=o.getCode();s=$e.substitute(s,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,o.setCode(s);const c=r.getShaderDescription("fragment");s=c.getCode(),s=$e.substitute(s,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(n,r,i)=>{var d,h,p,m,v,y,C,T,S,x,w,E,M,O,R,_,P,N,W,U;if(!i.hasAttribute("tcoord"))return;const a=r.getShaderDescription("vertex"),o=i.getBuffer("tcoord"),s=nn.getNumberOfComponentsFromBufferFormat(o.getArrayInformation()[0].format);let c=a.getCode();a.addOutput(`vec${s}<f32>`,"tcoordVS"),c=$e.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,a.setCode(c);const l=r.getShaderDescription("fragment");c=l.getCode();const f=e.WebGPUActor.getRenderable(),u=K=>K?K.getDimensionality()===s:!1,g=[];((p=(h=(d=f.getProperty()).getDiffuseTexture)==null?void 0:h.call(d))!=null&&p.getImageLoaded()||f.getTextures()[0]||e.colorTexture)&&(u((v=(m=f.getProperty()).getDiffuseTexture)==null?void 0:v.call(m))||u(f.getTextures()[0])||u(e.colorTexture))&&g.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);"),(T=(C=(y=f.getProperty()).getRoughnessTexture)==null?void 0:C.call(y))!=null&&T.getImageLoaded()&&u(f.getProperty().getRoughnessTexture())&&g.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),(w=(x=(S=f.getProperty()).getMetallicTexture)==null?void 0:x.call(S))!=null&&w.getImageLoaded()&&u(f.getProperty().getMetallicTexture())&&g.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),(O=(M=(E=f.getProperty()).getNormalTexture)==null?void 0:M.call(E))!=null&&O.getImageLoaded()&&u(f.getProperty().getNormalTexture())&&g.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),(P=(_=(R=f.getProperty()).getAmbientOcclusionTexture)==null?void 0:_.call(R))!=null&&P.getImageLoaded()&&u(f.getProperty().getAmbientOcclusionTexture())&&g.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);"),(U=(W=(N=f.getProperty()).getEmissionTexture)==null?void 0:W.call(N))!=null&&U.getImageLoaded()&&u(f.getProperty().getEmissionTexture())&&g.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),c=$e.substitute(c,"//VTK::TCoord::Impl",g).result,l.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(n,r,i)=>{if(n.includes("sel")){const a=r.getShaderDescription("fragment");let o=a.getCode();o=$e.substitute(o,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,a.setCode(o)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(n,r)=>n===tf.POINTS||r===Tn.Points?Ht.Verts:r===Tn.Lines?Ht.Lines:n===tf.WIREFRAME?r===Tn.Triangles?Ht.LinesFromTriangles:Ht.LinesFromStrips:r===Tn.Triangles?Ht.Triangles:r===Tn.TriangleStrips?Ht.Strips:r===Tn.TriangleEdges?Ht.LinesFromTriangles:Ht.LinesFromStrips,t.getHashFromUsage=n=>`pt${n}`,t.getTopologyFromUsage=n=>{switch(n){case Ht.Triangles:return"triangle-list";case Ht.Verts:return"point-list";case Ht.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var p,m;const n=e.currentInput,r=e.cellArray,i=e.primitiveType;let o=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const s=e.WebGPURenderWindow.getDevice();let c=!1;i===Tn.TriangleEdges&&(c=!0,o=tf.WIREFRAME);const l=e.vertexInput,f=n.getPoints();let u;if(r){const v={hash:`R${o}P${i}${r.getMTime()}`,usage:Ht.Index,cells:r,numberOfPoints:f.getNumberOfPoints(),primitiveType:i,representation:o};u=s.getBufferManager().getBuffer(v),l.setIndexBuffer(u)}else l.setIndexBuffer(null);if(f){const v=e.WebGPUActor.getBufferShift(e.WebGPURenderer),y={hash:`${f.getMTime()}I${u.getMTime()}${v.join()}float32x4`,usage:Ht.PointArray,format:"float32x4",dataArray:f,indexBuffer:u,shift:v,packExtra:!0},C=s.getBufferManager().getBuffer(y);l.addBuffer(C,["vertexBC"])}else l.removeBufferIfPresent("vertexBC");const g=t.getUsage(o,i);if(e._usesCellNormals=!1,!e.is2D&&(g===Ht.Triangles||g===Ht.Strips)){const v=n.getPointData().getNormals(),y={format:"snorm8x4",indexBuffer:u,packExtra:!0,shift:0,scale:127};if(v){y.hash=`${v.getMTime()}I${u.getMTime()}snorm8x4`,y.dataArray=v,y.usage=Ht.PointArray;const C=s.getBufferManager().getBuffer(y);l.addBuffer(C,["normalMC"])}else if(i===Tn.Triangles){e._usesCellNormals=!0,y.hash=`PFN${f.getMTime()}I${u.getMTime()}snorm8x4`,y.dataArray=f,y.cells=r,y.usage=Ht.NormalsFromPoints;const C=s.getBufferManager().getBuffer(y);l.addBuffer(C,["normalMC"])}else l.removeBufferIfPresent("normalMC")}else l.removeBufferIfPresent("normalMC");let d=!1;if(e.renderable.getScalarVisibility()){const v=e.renderable.getColorMapColors();if(v&&!c){const y=e.renderable.getScalarMode();let C=!1;(y===nf.USE_CELL_DATA||y===nf.USE_CELL_FIELD_DATA||y===nf.USE_FIELD_DATA||!n.getPointData().getScalars())&&y!==nf.USE_POINT_FIELD_DATA&&v&&(C=!0);const T={usage:Ht.PointArray,format:"unorm8x4",hash:`${C}${v.getMTime()}I${u.getMTime()}unorm8x4`,dataArray:v,indexBuffer:u,cellData:C,cellOffset:0},S=s.getBufferManager().getBuffer(T);l.addBuffer(S,["colorVI"]),d=!0}}d||l.removeBufferIfPresent("colorVI");let h=null;if((m=(p=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&m.call(p)&&e.renderable.getColorCoordinates()?h=e.renderable.getColorCoordinates():h=n.getPointData().getTCoords(),h&&!c){const v=s.getBufferManager().getBufferForPointArray(h,l.getIndexBuffer());l.addBuffer(v,["tcoord"])}else l.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var c,l,f,u,g,d,h,p,m,v,y,C,T,S,x;const n=[],r=[],i=(l=(c=e.renderable).getColorTextureMap)==null?void 0:l.call(c);i&&(e.colorTexture||(e.colorTexture=sd.newInstance({label:"polyDataColor"})),e.colorTexture.setInputData(i),r.push(["Diffuse",e.colorTexture]));const a=e.WebGPUActor.getRenderable(),o=e.WebGPURenderer.getRenderable(),s=[];if((u=(f=a.getProperty()).getDiffuseTexture)!=null&&u.call(f)){const w=["Diffuse",a.getProperty().getDiffuseTexture()];s.push(w)}if(a.getTextures()[0]){const w=["Diffuse",a.getTextures()[0]];s.push(w)}if(e.colorTexture){const w=["Diffuse",e.colorTexture];s.push(w)}if((d=(g=a.getProperty()).getRoughnessTexture)!=null&&d.call(g)){const w=["Roughness",a.getProperty().getRoughnessTexture()];s.push(w)}if((p=(h=a.getProperty()).getMetallicTexture)!=null&&p.call(h)){const w=["Metallic",a.getProperty().getMetallicTexture()];s.push(w)}if((v=(m=a.getProperty()).getNormalTexture)!=null&&v.call(m)){const w=["Normal",a.getProperty().getNormalTexture()];s.push(w)}if((C=(y=a.getProperty()).getAmbientOcclusionTexture)!=null&&C.call(y)){const w=["AmbientOcclusion",a.getProperty().getAmbientOcclusionTexture()];s.push(w)}if((S=(T=a.getProperty()).getEmissionTexture)!=null&&S.call(T)){const w=["Emission",a.getProperty().getEmissionTexture()];s.push(w)}if((x=o.getEnvironmentTexture)!=null&&x.call(o)){const w=["Environment",o.getEnvironmentTexture()];s.push(w)}for(let w=0;w<s.length;w++)(s[w][1].getInputData()||s[w][1].getJsImageData()||s[w][1].getCanvas())&&r.push(s[w]),s[w][1].getImage()&&s[w][1].getImageLoaded()&&r.push(s[w]);for(let w=0;w<r.length;w++){const E=r[w][1],M=r[w][0],O=e.device.getTextureManager().getTextureForVTKTexture(E);if(O.getReady()){let R=!1;for(let _=0;_<e.textures.length;_++)e.textures[_]===O&&(R=!0,n[_]=!0);if(!R){n[e.textures.length]=!0;const _=O.createView(`${M}Texture`);e.textures.push(O),e.textureViews.push(_);const P=E.getInterpolate()?"linear":"nearest";let N=null;!N&&E.getEdgeClamp()&&E.getRepeat()&&(N="mirror-repeat"),!N&&E.getEdgeClamp()&&(N="clamp-to-edge"),!N&&E.getRepeat()&&(N="repeat"),M!=="Environment"?_.addSampler(e.device,{addressModeU:N,addressModeV:N,addressModeW:N,minFilter:P,magFilter:P}):_.addSampler(e.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:P,magFilter:P,mipmapFilter:"linear"})}}}for(let w=e.textures.length-1;w>=0;w--)n[w]||(e.textures.splice(w,1),e.textureViews.splice(w,1))},t.computePipelineHash=()=>{let n=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===Tn.TriangleEdges||e.primitiveType===Tn.TriangleStripEdges)n+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(n+="n"),e.vertexInput.hasAttribute("colorVI")&&(n+="c"),e.vertexInput.hasAttribute("tcoord")){const i=e.vertexInput.getBuffer("tcoord"),a=nn.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);n+=`t${a}`}e.textures.length&&(n+=`tx${e.textures.length}`)}e._usesCellNormals&&(n+="cn"),e.SSBO&&(n+="ssbo");const r=t.getHashFromUsage(e.usage);n+=r,n+=e.renderEncoder.getPipelineHash(),e.pipelineHash=n},t.updateBuffers=()=>{e.primitiveType!==Tn.TriangleEdges&&e.primitiveType!==Tn.TriangleStripEdges&&t.updateTextures();const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();e.usage=t.getUsage(r,e.primitiveType),t.buildVertexInput();const i=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(i.getSizeInBytes()/i.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const a=n.getProperty();t.setNumberOfInstances(Math.ceil(a.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const XY={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function YE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XY,n),bw.extend(t,e,n),e.fragmentShaderTemplate=KY,e.vertexShaderTemplate=jY,e._tmpMat3=pr(new Float64Array(9)),e._tmpMat4=ie(new Float64Array(16)),e.UBO=zs.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),Ot(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],qY(t,e)}const YY=be(YE,"vtkWebGPUCellArrayMapper");var ZE={newInstance:YY,extend:YE};const{PrimitiveTypes:rf}=N0;function ZY(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>ZE.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let a=0;for(let o=rf.Points;o<=rf.Triangles;o++)if(r[o].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o]),s.setCurrentInput(n),s.setCellOffset(a),s.setPrimitiveType(o),s.setRenderable(e.renderable),a+=r[o].getNumberOfCells(),i.push(s)}else e.primitives[o]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let o=rf.TriangleEdges;o<=rf.TriangleStripEdges;o++)if(r[o-2].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o-2]),s.setCurrentInput(n),s.setCellOffset(e.primitives[o-2].getCellOffset()),s.setPrimitiveType(o),s.setRenderable(e.renderable),i.push(s)}else e.primitives[o]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}const JY={primitives:null};function QY(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JY,n),ze.extend(t,e,n),e.primitives=[],ZY(t,e)}const eZ=be(QY,"vtkWebGPUPolyDataMapper");hr("vtkMapper",eZ);const{PrimitiveTypes:m6}=N0;function tZ(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>ZE.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],i=[];let a=0;for(let o=m6.Points;o<=m6.Triangles;o++)if(r[o].getNumberOfValues()>0){e.primitives[o]||(e.primitives[o]=t.createCellArrayMapper());const s=e.primitives[o];s.setCellArray(r[o]),s.setCurrentInput(n),s.setCellOffset(a),s.setPrimitiveType(o),s.setRenderable(e.renderable),s.setIs2D(!0),a+=r[o].getNumberOfCells(),i.push(s)}else e.primitives[o]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}function nZ(t){return{primitives:[],...t}}function rZ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nZ(n)),ze.extend(t,e,n),e.primitives=[],tZ(t,e)}const iZ=be(rZ,"vtkWebGPUPolyDataMapper2D");hr("vtkMapper2D",iZ);function aZ(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([a.usize,a.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const oZ={};function sZ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oZ,n),ze.extend(t,e,n),e.scalarBarActorHelper=XE.newScalarBarActorHelper(),aZ(t,e)}const cZ=be(sZ,"vtkWebGPUScalarBarActor");hr("vtkScalarBarActor",cZ);function lZ(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(n,r)=>{e.texture=n,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=nn.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=i.sampleType},t.createFromTextureHandle=(n,r)=>{e.texture=null,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=nn.getDetailsFromTextureFormat(r.format);e.bindGroupLayoutEntry.texture.sampleType=i.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(n,r)=>{let i="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?i="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(i="u32");let a=`@binding(${n}) @group(${r}) var ${e.label}: texture_${e.options.dimension}<${i}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(a=`@binding(${n}) @group(${r}) var ${e.label}: texture_depth_${e.options.dimension};`),a},t.addSampler=(n,r)=>{const i=Bw.newInstance({label:`${e.label}Sampler`});i.create(n,r),t.setSampler(i)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const uZ={texture:null,handle:null,sampler:null,label:null};function JE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uZ,n),D.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},D.obj(e.bindGroupTime,{mtime:0}),D.get(t,e,["bindGroupTime","texture"]),D.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),lZ(t,e)}const fZ=D.newInstance(JE);var gZ={newInstance:fZ,extend:JE};const{BufferUsage:v6}=N0;function dZ(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(n,r)=>{e.device=n,e.width=r.width,e.height=r.height,e.depth=r.depth?r.depth:1;const i=e.depth===1?"2d":"3d";e.format=r.format?r.format:"rgba8unorm",e.mipLevel=r.mipLevel?r.mipLevel:0,e.usage=r.usage?r.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:i,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(n,r,i)=>{e.device=n,e.handle=r,e.width=i.width,e.height=i.height,e.depth=i.depth?i.depth:1,e.format=i.format?i.format:"rgba8unorm",e.usage=i.usage?i.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=n=>{let r=[];if(n.canvas){e.device.getHandle().queue.copyExternalImageToTexture({source:n.canvas,flipY:n.flip},{texture:e.handle,premultipliedAlpha:!0},[e.width,e.height,e.depth]),e.ready=!0;return}n.jsImageData&&!n.nativeArray&&(n.width=n.jsImageData.width,n.height=n.jsImageData.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,n.nativeArray=n.jsImageData.data);const i=nn.getDetailsFromTextureFormat(e.format);let a=e.width*i.stride;const o=(c,l,f)=>{const u=c.length/(l*f)*c.BYTES_PER_ELEMENT,g=i.elementSize===2&&i.sampleType==="float";if(g||u%256){const d=c,h=u/d.BYTES_PER_ELEMENT,p=i.elementSize,m=256*Math.floor((h*p+255)/256),v=m/p,y=D.newTypedArray(g?"Uint16Array":d.constructor.name,v*l*f);for(let C=0;C<l*f;C++)if(g)for(let T=0;T<h;T++)y[C*v+T]=no.toHalf(d[C*h+T]);else y.set(d.subarray(C*h,(C+1)*h),C*v);return[y,m]}return[c,u]};if(n.nativeArray&&(r=n.nativeArray),n.image){const c=document.createElement("canvas");c.width=n.image.width,c.height=n.image.height;const l=c.getContext("2d");l.translate(0,c.height),l.scale(1,-1),l.drawImage(n.image,0,0,n.image.width,n.image.height,0,0,c.width,c.height),r=l.getImageData(0,0,n.image.width,n.image.height).data}const s=e.device.createCommandEncoder();if(t.getDimensionality()!==3){const c=sd.generateMipmaps(r,e.width,e.height,e.mipLevel);let l=e.width,f=e.height;for(let u=0;u<=e.mipLevel;u++){const g=o(c[u],f,1);a=g[1];const d={dataArray:n.dataArray?n.dataArray:null,nativeArray:g[0],usage:v6.Texture},h=e.device.getBufferManager().getBuffer(d);s.copyBufferToTexture({buffer:h.getHandle(),offset:0,bytesPerRow:a,rowsPerImage:f},{texture:e.handle,mipLevel:u},[l,f,1]),l/=2,f/=2}e.device.submitCommandEncoder(s),e.ready=!0}else{const c=o(r,e.height,e.depth);a=c[1];const l={dataArray:n.dataArray?n.dataArray:null,usage:v6.Texture};l.nativeArray=c[0];const f=e.device.getBufferManager().getBuffer(l);s.copyBufferToTexture({buffer:f.getHandle(),offset:0,bytesPerRow:a,rowsPerImage:e.height},{texture:e.handle},[e.width,e.height,e.depth]),e.device.submitCommandEncoder(s),e.ready=!0}},t.getScale=()=>{const n=nn.getDetailsFromTextureFormat(e.format);return n.elementSize===2&&n.sampleType==="float"?1:255},t.getNumberOfComponents=()=>nn.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let n=0;return e.width>1&&n++,e.height>1&&n++,e.depth>1&&n++,n},t.resizeToMatch=n=>{(n.getWidth()!==e.width||n.getHeight()!==e.height||n.getDepth()!==e.depth)&&(e.width=n.getWidth(),e.height=n.getHeight(),e.depth=n.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(n!==e.width||r!==e.height||i!==e.depth)&&(e.width=n,e.height=r,e.depth=i,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r.dimension||(r.dimension=e.depth===1?"2d":"3d");const i=gZ.newInstance({label:n});return i.create(t,r),i}}const pZ={device:null,handle:null,buffer:null,ready:!1,label:null};function hZ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pZ,n),D.obj(t,e),D.get(t,e,["handle","ready","width","height","depth","format","usage"]),D.setGet(t,e,["device","label"]),dZ(t,e)}D.newInstance(hZ);function mZ(t){if(!t||t.data.length===0)throw new Error("Invalid contour set data, see publicContourSetData type for more info");if(!t.id)throw new Error("Invalid contour set data, each contour set must have an id");if(!t.data||!Array.isArray(t.data))throw new Error("Invalid contour set data, each contour set must have an array of contours");t.data.forEach(e=>{if(!e.points||!Array.isArray(e.points))throw new Error("Invalid contour set data, each contour must have an array of points");e.points.forEach(n=>{if(!n||!Array.isArray(n)||n.length!==3)throw new Error("Invalid contour set data, each point must be an array of length 3")})})}class y6{constructor(e){const{points:n,type:r}=e.data;this.id=e.id,this._points=n,this._type=r,this._color=e.color,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){return this._points.length*3}get points(){return this._points}set points(e){this._points=e}get color(){return this._color}set color(e){this._color=e}get type(){return this._type}set type(e){this._type=e}get segmentIndex(){return this._segmentIndex}set segmentIndex(e){this._segmentIndex=e}get flatPointsArray(){return this._points.map(e=>[...e]).flat()}}class vZ{constructor(e){this._color=[200,0,0],this.id=e.id,this._contours=[],this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this._createEachContour(e.data),this.sizeInBytes=this._getSizeInBytes()}_createEachContour(e){e.forEach(n=>{const{points:r,type:i,color:a}=n,o=new y6({id:`${this.id}-segment-${this._segmentIndex}`,data:{points:r,type:i,segmentIndex:this._segmentIndex,color:a??this._color},segmentIndex:this._segmentIndex,color:a??this._color});this._contours.push(o)}),this._updateContourSetCentroid()}_updateContourSetCentroid(){const e=this.totalNumberOfPoints,n=this.flatPointsArray,r=n.reduce((o,s)=>[o[0]+s[0],o[1]+s[1],o[2]+s[2]],[0,0,0]),i=[r[0]/e,r[1]/e,r[2]/e],a=n.reduce((o,s)=>{const c=this._getDistance(i,s),l=this._getDistance(i,o);return c<l?s:o},n[0]);this._centroid=a}_getSizeInBytes(){return this._contours.reduce((e,n)=>e+n.sizeInBytes,0)}_getDistance(e,n){return Math.sqrt((e[0]-n[0])**2+(e[1]-n[1])**2+(e[2]-n[2])**2)}get centroid(){return this._centroid}get segmentIndex(){return this._segmentIndex}get color(){return this._color}set color(e){this._color=e,this._contours.forEach(n=>{n instanceof y6&&(n.color=e)})}get contours(){return this._contours}get flatPointsArray(){return this._contours.flatMap(e=>e.points)}get numberOfContours(){return this._contours.length}get totalNumberOfPoints(){return this._contours.reduce((e,n)=>e+n.points.length,0)}get numberOfPointsArray(){return this._contours.map(e=>e.points.length)}getPointsInContour(e){return this._contours[e].points}getNumberOfPointsInAContour(e){return this.getPointsInContour(e).length}}function yZ(t,e){mZ(e);const n=new vZ({id:e.id,data:e.data,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:Ii.CONTOUR,data:n,sizeInBytes:n.sizeInBytes}}function CZ(t){var e,n;if(!t.id)throw new Error("Surface must have an id");if(((e=t.points)==null?void 0:e.length)===0)throw new Error("Surface must have non-empty points array");if(((n=t.polys)==null?void 0:n.length)===0)throw new Error("Surface must have non-empty polys array");if(!t.frameOfReferenceUID)throw new Error("Surface must have a frameOfReferenceUID")}function TZ(t,e){CZ(e);const n=new kK({id:e.id,points:e.points,polys:e.polys,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:Ii.SURFACE,data:n,sizeInBytes:n.sizeInBytes}}function SZ(t,e){if(t===void 0)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let n=Q.getGeometry(t);if(n)return n;if(e.type===Ii.CONTOUR)n=yZ(t,e.geometryData);else if(e.type===Ii.SURFACE)n=TZ(t,e.geometryData);else throw new Error("Unknown geometry type");return Q.putGeometrySync(t,n),n}class xZ{constructor(e){this.getGroupKey=n=>{if(typeof n=="string")return n;const i=le(n);if(!i)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return i.FrameOfReferenceUID},this._imageVolumeModifiedHandler=n=>{const r=n.detail,{FrameOfReferenceUID:i}=r,o=this.annotations[i];o&&Object.keys(o).forEach(s=>{o[s].forEach(l=>{l.invalidated!==void 0&&(l.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(n,r)=>{const i=this.annotations;return i[n]?r?i[n][r]?i[n][r]:[]:i[n]:[]},this.getAnnotation=n=>{const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];for(const c of s)if(n===c.annotationUID)return c}}},this.getNumberOfAnnotations=(n,r)=>{const i=this.getAnnotations(n,r);if(!i.length)return 0;if(r)return i.length;let a=0;for(const o in i)a+=i[o].length;return a},this.addAnnotation=(n,r)=>{const{metadata:i}=n,{FrameOfReferenceUID:a,toolName:o}=i;r=r||a;const s=this.annotations;let c=s[r];c||(s[r]={},c=s[r]);let l=c[o];l||(c[o]=[],l=c[o]),this.preprocessingFn&&(n=this.preprocessingFn(n)),l.push(n)},this.removeAnnotation=n=>{const{annotations:r}=this;for(const i in r){const a=r[i];for(const o in a){const s=a[o],c=s.findIndex(l=>l.annotationUID===n);c!==-1&&(s.splice(c,1),s.length===0&&delete a[o])}Object.keys(a).length===0&&delete r[i]}},this.removeAnnotations=(n,r)=>{const i=this.annotations,a=[];if(!i[n])return a;if(r){const o=i[n][r];for(const s of o)this.removeAnnotation(s.annotationUID),a.push(s)}else for(const o in i[n]){const s=i[n][o];for(const c of s)this.removeAnnotation(c.annotationUID),a.push(c)}return a},this.saveAnnotations=(n,r)=>{const i=this.annotations;if(n&&r){const a=i[n];if(!a)return;const o=a[r];return structuredClone(o)}else if(n){const a=i[n];return structuredClone(a)}return structuredClone(i)},this.restoreAnnotations=(n,r,i)=>{const a=this.annotations;if(r&&i){let o=a[r];o||(a[r]={},o=a[r]),o[i]=n}else r?a[r]=n:this.annotations=structuredClone(n)},this.getAllAnnotations=()=>Object.values(this.annotations).map(n=>Object.values(n)).flat(2),this.getNumberOfAllAnnotations=()=>{let n=0;const r=this.annotations;for(const i in r){const a=r[i];for(const o in a){const s=a[o];n+=s.length}}return n},this.removeAllAnnotations=()=>{const n=[];for(const r of this.getAllAnnotations())this.removeAnnotation(r.annotationUID),n.push(r);return n},e||(e=bt()),this.annotations={},this.uid=e,Y.addEventListener(X.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const QE=new xZ("DEFAULT");function zt(t){return QE.getAnnotation(t)}var Fo;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button",t[t.Wheel=524288]="Wheel",t[t.Wheel_Primary=524289]="Wheel_Primary"})(Fo||(Fo={}));var $n;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta",t[t.ShiftCtrl=1617]="ShiftCtrl",t[t.ShiftAlt=1618]="ShiftAlt",t[t.ShiftMeta=1691]="ShiftMeta",t[t.CtrlAlt=1718]="CtrlAlt",t[t.CtrlMeta=1791]="CtrlMeta",t[t.AltMeta=1891]="AltMeta"})($n||($n={}));var Qe;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(Qe||(Qe={}));var ea;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked",t.AutoGenerated="AutoGenerated"})(ea||(ea={}));var H;(function(t){t.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",t.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",t.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",t.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",t.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",t.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",t.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",t.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",t.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",t.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",t.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",t.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",t.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"})(H||(H={}));var se;(function(t){t.Labelmap="Labelmap",t.Contour="Contour",t.Surface="Surface"})(se||(se={}));var Rs;(function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"})(Rs||(Rs={}));var Ea;(function(t){t.Interaction="Interaction",t.HandlesUpdated="HandlesUpdated",t.StatsUpdated="StatsUpdated",t.InitialSetup="InitialSetup",t.Completed="Completed",t.InterpolationUpdated="InterpolationUpdated"})(Ea||(Ea={}));var Uo;(function(t){t.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",t.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",t.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",t.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",t.SURFACE_CLIPPING="Clipping Surfaces"})(Uo||(Uo={}));let wZ={},ce={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:wZ,enabledElements:[]};var EZ="Expected a function",eO="__lodash_hash_undefined__",tO=1/0,OZ="[object Function]",DZ="[object GeneratorFunction]",RZ="[object Symbol]",MZ=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,LZ=/^\w*$/,IZ=/^\./,VZ=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_Z=/[\\^$.*+?()[\]{}|]/g,bZ=/\\(\\)?/g,NZ=/^\[object .+?Constructor\]$/,PZ=typeof tn=="object"&&tn&&tn.Object===Object&&tn,kZ=typeof self=="object"&&self&&self.Object===Object&&self,Cm=PZ||kZ||Function("return this")();function FZ(t,e){return t==null?void 0:t[e]}function UZ(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var AZ=Array.prototype,BZ=Function.prototype,nO=Object.prototype,A2=Cm["__core-js_shared__"],C6=function(){var t=/[^.]+$/.exec(A2&&A2.keys&&A2.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),rO=BZ.toString,Tm=nO.hasOwnProperty,iO=nO.toString,GZ=RegExp("^"+rO.call(Tm).replace(_Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),T6=Cm.Symbol,WZ=AZ.splice,$Z=aO(Cm,"Map"),El=aO(Object,"create"),S6=T6?T6.prototype:void 0,x6=S6?S6.toString:void 0;function Ao(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function zZ(){this.__data__=El?El(null):{}}function HZ(t){return this.has(t)&&delete this.__data__[t]}function jZ(t){var e=this.__data__;if(El){var n=e[t];return n===eO?void 0:n}return Tm.call(e,t)?e[t]:void 0}function KZ(t){var e=this.__data__;return El?e[t]!==void 0:Tm.call(e,t)}function qZ(t,e){var n=this.__data__;return n[t]=El&&e===void 0?eO:e,this}Ao.prototype.clear=zZ;Ao.prototype.delete=HZ;Ao.prototype.get=jZ;Ao.prototype.has=KZ;Ao.prototype.set=qZ;function F0(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function XZ(){this.__data__=[]}function YZ(t){var e=this.__data__,n=cd(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():WZ.call(e,n,1),!0}function ZZ(t){var e=this.__data__,n=cd(e,t);return n<0?void 0:e[n][1]}function JZ(t){return cd(this.__data__,t)>-1}function QZ(t,e){var n=this.__data__,r=cd(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}F0.prototype.clear=XZ;F0.prototype.delete=YZ;F0.prototype.get=ZZ;F0.prototype.has=JZ;F0.prototype.set=QZ;function Ko(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function eJ(){this.__data__={hash:new Ao,map:new($Z||F0),string:new Ao}}function tJ(t){return ld(this,t).delete(t)}function nJ(t){return ld(this,t).get(t)}function rJ(t){return ld(this,t).has(t)}function iJ(t,e){return ld(this,t).set(t,e),this}Ko.prototype.clear=eJ;Ko.prototype.delete=tJ;Ko.prototype.get=nJ;Ko.prototype.has=rJ;Ko.prototype.set=iJ;function cd(t,e){for(var n=t.length;n--;)if(hJ(t[n][0],e))return n;return-1}function aJ(t,e){e=lJ(e,t)?[e]:cJ(e);for(var n=0,r=e.length;t!=null&&n<r;)t=t[dJ(e[n++])];return n&&n==r?t:void 0}function oJ(t){if(!sO(t)||fJ(t))return!1;var e=mJ(t)||UZ(t)?GZ:NZ;return e.test(pJ(t))}function sJ(t){if(typeof t=="string")return t;if(xm(t))return x6?x6.call(t):"";var e=t+"";return e=="0"&&1/t==-tO?"-0":e}function cJ(t){return oO(t)?t:gJ(t)}function ld(t,e){var n=t.__data__;return uJ(e)?n[typeof e=="string"?"string":"hash"]:n.map}function aO(t,e){var n=FZ(t,e);return oJ(n)?n:void 0}function lJ(t,e){if(oO(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||xm(t)?!0:LZ.test(t)||!MZ.test(t)||e!=null&&t in Object(e)}function uJ(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function fJ(t){return!!C6&&C6 in t}var gJ=Sm(function(t){t=yJ(t);var e=[];return IZ.test(t)&&e.push(""),t.replace(VZ,function(n,r,i,a){e.push(i?a.replace(bZ,"$1"):r||n)}),e});function dJ(t){if(typeof t=="string"||xm(t))return t;var e=t+"";return e=="0"&&1/t==-tO?"-0":e}function pJ(t){if(t!=null){try{return rO.call(t)}catch{}try{return t+""}catch{}}return""}function Sm(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(EZ);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=t.apply(this,r);return n.cache=a.set(i,o),o};return n.cache=new(Sm.Cache||Ko),n}Sm.Cache=Ko;function hJ(t,e){return t===e||t!==t&&e!==e}var oO=Array.isArray;function mJ(t){var e=sO(t)?iO.call(t):"";return e==OZ||e==DZ}function sO(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function vJ(t){return!!t&&typeof t=="object"}function xm(t){return typeof t=="symbol"||vJ(t)&&iO.call(t)==RZ}function yJ(t){return t==null?"":sJ(t)}function CJ(t,e,n){var r=t==null?void 0:aJ(t,e);return r===void 0?n:r}var TJ=CJ;const SJ=_l(TJ),w6=Symbol("DefinedCursors"),cO=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class jn{constructor(e,n){this.name=e+"",this.fallback=n}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:n}=this;return n instanceof jn?`${e}, ${n.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const n=E6(jn,w6);let r=n.get(e);if(r instanceof jn)return r;if(cO.has(e))return r=new jn(e),n.set(e,r),r}static setDefinedCursor(e,n){return n instanceof jn?(E6(jn,w6).set(e,n),!0):!1}}function E6(t,e){let n=t[e];return n instanceof Map||(n=new Map,Object.defineProperty(t,e,{value:n})),n}const xJ=cO.values(),wJ="image-cursor";class fg extends jn{constructor(e,n,r,i,a){super(i||fg.getUniqueInstanceName(wJ),a),this.url=e,this.x=Number(n)||0,this.y=Number(r)||0}getStyleProperty(){const{url:e,x:n,y:r}=this;let i=`url('${e}')`;return n>=0&&r>=0&&(n>0||r>0)&&(i+=` ${n} ${r}`),this.addFallbackStyleProperty(i)}static getUniqueInstanceName(e){return`${e}-${TE(fg)}`}}const Me={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},_n={x:127,y:60},as=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,Gi=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,af='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',os='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',of='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',lO={Angle:Le(Me,{name:"Angle",iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:Le(Me,{name:"ArrowAnnotate",iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:Le(Me,{name:"Bidirectional",iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:Le(Me,{name:"CobbAngle",iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:Le(Me,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:Le(Me,{name:"EllipticalROI",iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:Le(Me,{name:"FreehandROI",iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:Le(Me,{name:"FreehandROISculptor",iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:Le(Me,{name:"Length",iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:Le(Me,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:Le(Me,{name:"Probe",iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:Le(Me,{name:"RectangleROI",iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),TextMarker:Le(Me,{name:"TextMarker",iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:Le(Me,{name:"Crosshairs",iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:Le(Me,{name:"Eraser",iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:Le(Me,{name:"Magnify",iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:Le(Me,{name:"Pan",iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:Le(Me,{name:"Rotate",iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:Le(Me,{name:"StackScroll",iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:Le(Me,{name:"WindowLevelRegion",iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:Le(Me,{name:"WindowLevel",iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:Le(Me,{name:"Zoom",iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:Le(Me,{name:"SegmentationFreeHandEraseInside",iconContent:`${af} ${as}`,viewBox:_n}),SegmentationFreeHandFillInside:Le(Me,{name:"SegmentationFreeHandFillInside",iconContent:`${af} ${Gi}`,viewBox:_n}),SegmentationFreeHandEraseOutside:Le(Me,{name:"SegmentationFreeHandEraseOutside",iconContent:`${af} ${as}`,viewBox:_n}),SegmentationFreeHandFillOutside:Le(Me,{name:"SegmentationFreeHandFillOutside",iconContent:`${af} ${Gi}`,viewBox:_n}),SegmentationRectangleEraseInside:Le(Me,{name:"SegmentationRectangleEraseInside",iconContent:`${os} ${as}`,viewBox:_n}),RectangleScissor:Le(Me,{name:"RectangleScissor",iconContent:`${os} ${Gi}`,viewBox:_n}),"RectangleScissor.FILL_INSIDE":Le(Me,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${os} ${Gi}`,viewBox:_n}),"RectangleScissor.FILL_OUTSIDE":Le(Me,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${os} ${Gi}`,viewBox:_n}),"RectangleScissor.ERASE_OUTSIDE":Le(Me,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${os} ${as}`,viewBox:_n}),"RectangleScissor.ERASE_INSIDE":Le(Me,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${os} ${as}`,viewBox:_n}),CircleScissor:Le(Me,{name:"CircleScissor",iconContent:`${of} ${Gi}`,viewBox:_n}),"CircleScissor.FILL_INSIDE":Le(Me,{name:"CircleScissor.FILL_INSIDE",iconContent:`${of} ${Gi}`,viewBox:_n}),"CircleScissor.ERASE_OUTSIDE":Le(Me,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${of} ${as}`,viewBox:_n}),"CircleScissor.FILL_OUTSIDE":Le(Me,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${of} ${Gi}`,viewBox:_n})};function Le(t,e){return Object.assign(Object.create(t),{...e,name:e.name||t.name})}function EJ(t){return lO[t]}const OJ=Object.keys(lO);class DJ{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,n){let r=this.config.annotations;r||(this.config={...this.config,annotations:{}},r=this.config.annotations),r[e]=n}setViewportToolStyles(e,n){let r=this.config.viewports;r||(this.config={...this.config,viewports:{}},r=this.config.viewports),r[e]=n}setToolGroupToolStyles(e,n){let r=this.config.toolGroups;r||(this.config={...this.config,toolGroups:{}},r=this.config.toolGroups),r[e]=n}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,n){const{annotationUID:r,viewportId:i,toolGroupId:a,toolName:o}=n;return this._getToolStyle(e,r,i,a,o)}_getToolStyle(e,n,r,i,a){if(n){const s=this.getAnnotationToolStyles(n);if(s&&s[e]!==void 0)return s[e]}if(r){const s=this.getViewportToolStyles(r);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}if(i){const s=this.getToolGroupToolStyles(i);if(s){if(s[a]&&s[a][e]!==void 0)return s[a][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}const o=this.getDefaultToolStyles();if(o[a]&&o[a][e]!==void 0)return o[a][e];if(o.global&&o.global[e]!==void 0)return o.global[e]}_initializeConfig(e){const n={};for(const r in e)n[r]=e[r];this.config={default:{global:n}}}}const RJ=new DJ;function MJ(t,e,n){const r=[`${t}`];return e&&r.push(`${r[0]}${e}`),n&&r.push(`${r[r.length-1]}${n}`),r}function uO(t,e,n,r){const i=MJ(t,n,r);for(let a=i.length-1;a>=0;--a){const o=RJ.getStyleProperty(i[a],e);if(o!==void 0)return o}}const LJ="color",IJ=ea.Highlighted,VJ=Qe.Active;class jf extends fg{constructor(e,n,r,i,a){super(e,n,r,i,a)}static getDefinedCursor(e,n=!1,r){r||(r=uO(LJ,{},IJ,VJ));const i=_J(e,n,r);let a=super.getDefinedCursor(i);if(!a){const o=EJ(e);o&&(a=bJ(o,i,n,r,super.getDefinedCursor("default")),super.setDefinedCursor(i,a))}return a}}function fO(t,e){const n=Object(e),r=Object.prototype.hasOwnProperty.bind(n);return(t+"").replace(/\{\{(\w+)\}\}/g,(i,a)=>r(a)?n[a]+"":"")}function _J(t,e,n){return`${e?"pointer":"cursor"}:${t}/${n}`}function bJ(t,e,n,r,i){const{x:a,y:o}=t.mousePoint;return new jf(NJ(t,n,{color:r}),a,o,e,i)}function NJ(t,e,n){const r=PJ(t,e,n);return`${URL.createObjectURL(r)}#${t.name||"unknown"}-${e?"pointer":"cursor"}`}function PJ(t,e,n){const r=(e?FJ:kJ)(t,n);return new Blob([r],{type:"image/svg+xml"})}function kJ(t,e){const{iconContent:n,iconSize:r,viewBox:i}=t,a=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${r}" height="${r}" viewBox="0 0
      ${i.x} ${i.y}">
      ${n}
    </svg>`;return fO(a,e)}function FJ(t,e){const{iconContent:n,iconSize:r,viewBox:i,mousePointerGroupString:a}=t,o=r/Math.max(i.x,i.y,1),s=16+r,c=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g>${a}</g>
      <g transform="translate(16, 16) scale(${o})">${n}</g>
    </svg>`;return fO(c,e)}const O6=Symbol("ElementCursorsMap");function UJ(t,e){Ol(t)[0]=e,wm(t,e)}function wm(t,e){const n=Ol(t);n[1]=n[0],n[0]=e,t.style.cursor=(e instanceof jn?e:jn.getDefinedCursor("auto")).getStyleProperty()}function Em(t){wm(t,Ol(t)[1])}function ud(t){wm(t,jn.getDefinedCursor("none"))}function Ol(t){let e=Ol[O6];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(Ol,O6,{value:e}));let n=e.get(t);return n||(n=[null,null],e.set(t,n)),n}[...OJ,...xJ];function gO(t){return ce.toolGroups.find(e=>e.id===t)}const{Active:ac,Passive:B2,Enabled:G2,Disabled:W2}=Qe,AJ=[{mouseButton:Fo.Primary}];class Om{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const n=this._toolInstances[e];if(!n){console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`);return}return n}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,n={}){const r=ce.tools[e],i=typeof e<"u"&&e!=="",a=this.toolOptions[e];if(!i){console.warn("Tool with configuration did not produce a toolName: ",n);return}if(!r){console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);return}if(a){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:o}=r,s={name:e,toolGroupId:this.id,configuration:n},c=new o(s);this._toolInstances[e]=c}addToolInstance(e,n,r={}){var a;let i=(a=ce.tools[e])==null?void 0:a.toolClass;if(!i){const o=ce.tools[n].toolClass;class s extends o{}s.toolName=e,i=s,ce.tools[e]={toolClass:s}}this.addTool(i.toolName,r)}addViewport(e,n){if(typeof e!="string")throw new Error("viewportId must be defined and be a string");const r=this._findRenderingEngine(e,n);this.viewportsInfo.some(({viewportId:s})=>s===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:r});const i=this.getActivePrimaryMouseButtonTool();Ke.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(i);const o={toolGroupId:this.id,viewportId:e,renderingEngineId:r};Z(Y,H.TOOLGROUP_VIEWPORT_ADDED,o)}removeViewports(e,n){const r=[];if(this.viewportsInfo.forEach((a,o)=>{let s=!1;a.renderingEngineId===e&&(s=!0,n&&a.viewportId!==n&&(s=!1)),s&&r.push(o)}),r.length)for(let a=r.length-1;a>=0;a--)this.viewportsInfo.splice(r[a],1);const i={toolGroupId:this.id,viewportId:n,renderingEngineId:e};Z(Y,H.TOOLGROUP_VIEWPORT_REMOVED,i)}setActiveStrategy(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`);return}r.setActiveStrategy(n)}setToolMode(e,n,r={}){if(!e){console.warn("setToolMode: toolName must be defined");return}if(n===Qe.Active){this.setToolActive(e,r||this.restoreToolOptions[e]);return}if(n===Qe.Passive){this.setToolPassive(e);return}if(n===Qe.Enabled){this.setToolEnabled(e);return}if(n===Qe.Disabled){this.setToolDisabled(e);return}console.warn("setToolMode: mode must be defined")}setToolActive(e,n={}){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}if(!r){console.warn(`'${e}' instance ${r} is not registered with this toolGroup, can't set tool mode.`);return}const i=this.toolOptions[e]?this.toolOptions[e].bindings:[],a=n.bindings?n.bindings:[],s={bindings:[...i,...a].reduce((u,g)=>{const d=g.numTouchPoints!==void 0,h=g.mouseButton!==void 0;return!u.some(p=>$2(p,g))&&(d||h)&&u.push(g),u},[]),mode:ac};this.toolOptions[e]=s,this._toolInstances[e].mode=ac;const l=Ke.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(n)&&l)this.setViewportsCursorByToolName(e);else if(!this.getActivePrimaryMouseButtonTool()&&l){const g=jn.getDefinedCursor("default");this._setCursorForViewports(g)}this._hasMousePrimaryButtonBinding(n)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),typeof r.onSetToolActive=="function"&&r.onSetToolActive(),this._renderViewports();const f={toolGroupId:this.id,toolName:e,toolBindingsOptions:n};Z(Y,H.TOOL_ACTIVATED,f),this._triggerToolModeChangedEvent(e,ac,n)}setToolPassive(e,n){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const i=this.getToolOptions(e),a=Object.assign({bindings:i?i.bindings:[]},i,{mode:B2}),o=Array.isArray(n==null?void 0:n.removeAllBindings)?n.removeAllBindings:this.getDefaultPrimaryBindings();a.bindings=a.bindings.filter(c=>(n==null?void 0:n.removeAllBindings)!==!0&&!o.some(l=>$2(c,l)));let s=B2;a.bindings.length!==0&&(s=ac,a.mode=s),this.toolOptions[e]=a,r.mode=s,typeof r.onSetToolPassive=="function"&&r.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,B2)}setToolEnabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:G2};this.toolOptions[e]=r,n.mode=G2,typeof n.onSetToolEnabled=="function"&&n.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,G2)}setToolDisabled(e){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const r={bindings:[],mode:W2};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=r,n.mode=W2,typeof n.onSetToolDisabled=="function"&&n.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,W2)}getToolOptions(e){const n=this.toolOptions[e];if(n!==void 0)return n}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const n=this.toolOptions[e];return n.mode===ac&&this._hasMousePrimaryButtonBinding(n)})}setViewportsCursorByToolName(e,n){const r=this._getCursor(e,n);this._setCursorForViewports(r)}_getCursor(e,n){let r,i;return n&&(r=`${e}.${n}`,i=jf.getDefinedCursor(r,!0),i)||(r=`${e}`,i=jf.getDefinedCursor(r,!0),i)||(r=e,i=jf.getDefinedCursor(r,!0),i)?i:jn.getDefinedCursor("default")}_setCursorForViewports(e){this.viewportsInfo.forEach(({renderingEngineId:n,viewportId:r})=>{const i=Yl(r,n);if(!i)return;const{viewport:a}=i;UJ(a.element,e)})}setToolConfiguration(e,n,r){const i=this._toolInstances[e];if(i===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let a;return r?a=n:a=Object.assign(i.configuration,n),i.configuration=a,typeof i.onSetToolConfiguration=="function"&&i.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return Fo.Primary}getDefaultPrimaryBindings(){return AJ}getToolConfiguration(e,n){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const r=SJ(this._toolInstances[e].configuration,n)||this._toolInstances[e].configuration;return Rr(r)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const n=this.getCurrentActivePrimaryToolName();this.setToolDisabled(n),this.setToolActive(e,{bindings:[{mouseButton:Fo.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,n=null){let r=gO(e);return r?(console.debug(`ToolGroup ${e} already exists`),r):(r=new Om(e),ce.toolGroups.push(r),n=n??(()=>!0),Object.keys(this._toolInstances).filter(n).forEach(i=>{const a=this._toolInstances[i],o=this.toolOptions[i],s=a.mode;r.addTool(i),r.setToolMode(i,s,{bindings:o.bindings??[]})}),r)}_hasMousePrimaryButtonBinding(e){var r;const n=this.getDefaultPrimaryBindings();return(r=e==null?void 0:e.bindings)==null?void 0:r.some(i=>n.some(a=>$2(i,a)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:n})=>{Va(e).renderViewport(n)})}_triggerToolModeChangedEvent(e,n,r){const i={toolGroupId:this.id,toolName:e,mode:n,toolBindingsOptions:r};Z(Y,H.TOOL_MODE_CHANGED,i)}_findRenderingEngine(e,n){const r=kr();if((r==null?void 0:r.length)===0)throw new Error("No rendering engines found.");if(n)return n;const i=r.filter(a=>a.getViewport(e));if(i.length===0){if(r.length===1)return r[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(i.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return i[0].id}}function $2(t,e){return t.mouseButton!==e.mouseButton||t.numTouchPoints!==e.numTouchPoints?!1:t.modifierKey===e.modifierKey}function BJ(t){if(ce.toolGroups.some(r=>r.id===t)){console.warn(`'${t}' already exists.`);return}const n=new Om(t);return ce.toolGroups.push(n),n}function yn(t,e){var r;e||(e=(r=kr().find(i=>i.getViewports().find(a=>a.id===t)))==null?void 0:r.id);const n=ce.toolGroups.filter(i=>i.viewportsInfo.some(a=>a.renderingEngineId===e&&(!a.viewportId||a.viewportId===t)));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return n[0]}}const GJ=[Qe.Active,Qe.Passive,Qe.Enabled];function WJ(t){return ce.toolGroups.filter(({toolOptions:e})=>{const n=Object.keys(e);for(let r=0;r<n.length;r++)if(t===n[r]&&e[t]&&GJ.includes(e[t].mode))return!0;return!1})}function $J(t,e){const n=le(e),{renderingEngine:r,viewportId:i}=n,a=H.ANNOTATION_ADDED,o={annotation:t,viewportId:i,renderingEngineId:r.id};Z(Y,a,o)}function zJ(t){const{toolName:e}=t.metadata,n=WJ(e);if(!n.length)return;const r=[];n.forEach(o=>{o.viewportsInfo.forEach(s=>{const{renderingEngineId:c,viewportId:l}=s,{FrameOfReferenceUID:f}=Yl(l,c);t.metadata.FrameOfReferenceUID===f&&r.push(s)})});const i=H.ANNOTATION_ADDED,a={annotation:t};if(!r.length){Z(Y,i,a);return}r.forEach(({renderingEngineId:o,viewportId:s})=>{a.viewportId=s,a.renderingEngineId=o,Z(Y,i,a)})}function HJ(t){const e=H.ANNOTATION_REMOVED;Z(Y,e,t)}function Na(t,e,n=Ea.HandlesUpdated){const r=le(e),{viewportId:i,renderingEngineId:a}=r,o=H.ANNOTATION_MODIFIED;Z(Y,o,{annotation:t,viewportId:i,renderingEngineId:a,changeType:n})}function dO(t,e=!1){jJ({annotation:t,contourHoleProcessingEnabled:e})}function jJ(t){const e=H.ANNOTATION_COMPLETED;Z(Y,e,t)}const Kf=new Set;function KJ(t,e=!0){const n=XJ();t&&(e?YJ(t,Kf,n):ZJ(t,Kf,n)),JJ(n,Kf)}function m0(t){return Kf.has(t)}function qJ(t){const e=m0(t);return KJ(t,e),e}function XJ(){return Object.freeze({added:[],removed:[],locked:[]})}function YJ(t,e,n){if(!e.has(t)){e.add(t),n.added.push(t);const r=zt(t);r&&(r.isLocked=!0)}}function ZJ(t,e,n){if(e.delete(t)){n.removed.push(t);const r=zt(t);r&&(r.isLocked=!1)}}function JJ(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.locked.push(n)),Z(Y,H.ANNOTATION_LOCK_CHANGE,t))}const QJ=t=>(t.data||(t.data={}),t.data.handles||(t.data.handles={}),t.data.handles.textBox||(t.data.handles.textBox={}),t),eQ=t=>(t.data||(t.data={}),t.data.cachedStats||(t.data.cachedStats={}),t),sa=new Set;function va(t,e=!0,n=!1){e?tQ(t,n):pO(t)}function tQ(t,e=!1){const n=hO();if(!e){mO(sa,n);const r=zt(t);r&&(r.isSelected=!0)}if(t&&!sa.has(t)){sa.add(t),n.added.push(t);const r=zt(t);r&&(r.isSelected=!0)}vO(n,sa)}function pO(t){const e=hO();if(t){if(sa.delete(t)){e.removed.push(t);const n=zt(t);n.isSelected=!1}}else mO(sa,e);vO(e,sa)}function fd(t){return sa.has(t)}function hO(){return Object.freeze({added:[],removed:[],selection:[]})}function mO(t,e){t.forEach(n=>{if(t.delete(n)){e.removed.push(n);const r=zt(n);r&&(r.isSelected=!1)}})}function vO(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(n=>void t.selection.push(n)),Z(Y,H.ANNOTATION_SELECTION_CHANGE,t))}const Dl=new Set;function nQ(t,e=!0){const n=rQ();t&&(e?iQ(t,Dl,n):aQ(t,Dl,n)),oQ(n)}function gg(t){if(zt(t))return!Dl.has(t)}function rQ(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function iQ(t,e,n){if(e.delete(t)){n.lastVisible.push(t);const r=zt(t);r.isVisible=!0}}function aQ(t,e,n){e.has(t)||(e.add(t),fd(t)&&pO(t),n.lastHidden.push(t))}function oQ(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(Dl.forEach(e=>void t.hidden.push(e)),Z(Y,H.ANNOTATION_VISIBILITY_CHANGE,t))}function sQ(t){const e=!Dl.has(t);return nQ(t,e),e}let yO=QE;const cQ=t=>{t=QJ(t),t=eQ(t);const e=t.annotationUID,n=qJ(e);t.isLocked=n;const r=sQ(e);return t.isVisible=r,t};yO.setPreprocessingFn(cQ);function Ql(){return yO}function v0(t,e){const n=Ql(),r=n.getGroupKey(e);return n.getAnnotations(r,t)}function lQ(){return Ql().getAllAnnotations()}function CO(t){const{annotationUID:e,parentAnnotationUID:n}=t;if(!n)return;const r=zt(n),i=r.childAnnotationUIDs.indexOf(e);r.childAnnotationUIDs.splice(i,1),t.parentAnnotationUID=void 0}function TO(t,e){const{annotationUID:n}=t,{annotationUID:r}=e;CO(e),t.childAnnotationUIDs||(t.childAnnotationUIDs=[]),!t.childAnnotationUIDs.includes(r)&&(t.childAnnotationUIDs.push(r),e.parentAnnotationUID=n)}function uQ(t){return t.parentAnnotationUID?zt(t.parentAnnotationUID):void 0}function SO(t){var e;return((e=t.childAnnotationUIDs)==null?void 0:e.map(n=>zt(n)))??[]}function U0(t,e){t.annotationUID||(t.annotationUID=bt());const n=Ql();if(e instanceof HTMLDivElement){const r=n.getGroupKey(e);n.addAnnotation(t,r),$J(t,e)}else n.addAnnotation(t,void 0),zJ(t);return t.annotationUID}function y0(t){var r;if(!t)return;const e=Ql(),n=e.getAnnotation(t);n&&((r=n.childAnnotationUIDs)==null||r.forEach(i=>y0(i)),e.removeAnnotation(t),HJ({annotation:n,annotationManagerUID:e.uid}))}function fQ(t){let e=t;for(;e;)e.invalidated=!0,e=e.parentAnnotationUID?zt(e.parentAnnotationUID):void 0}function xO(t){const e=t.toolName;if(ce.tools[e],!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);ce.tools[e]={toolClass:t}}function gQ(t){return!!ce.tools[t]}function qo(t,e){const n=e||t.currentTarget,{viewport:r}=le(n)||{};if(!r)return;const i=hQ(t),a=pQ(t),o=dQ(n,a),s=r.canvasToWorld(o);return{page:a,client:i,canvas:o,world:s}}function dQ(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function pQ(t){return[t.pageX,t.pageY]}function hQ(t){return[t.clientX,t.clientY]}function wO(t){const e=t.currentTarget,{viewportId:n,renderingEngineId:r}=le(e),i=qo(t,e),a={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},o={event:t,eventName:H.MOUSE_DOUBLE_CLICK,viewportId:n,renderingEngineId:r,camera:{},element:e,startPoints:i,lastPoints:i,currentPoints:i,deltaPoints:a};!Z(e,H.MOUSE_DOUBLE_CLICK,o)&&(t.stopImmediatePropagation(),t.preventDefault())}const D6=H.MOUSE_MOVE;function eu(t){const e=t.currentTarget,n=le(e),{renderingEngineId:r,viewportId:i}=n,a=qo(t);!Z(e,D6,{renderingEngineId:r,viewportId:i,camera:{},element:e,currentPoints:a,eventName:D6,event:t})&&(t.stopImmediatePropagation(),t.preventDefault())}const{MOUSE_DOWN:R6,MOUSE_DOWN_ACTIVATE:mQ,MOUSE_CLICK:vQ,MOUSE_UP:yQ,MOUSE_DRAG:M6}=H,CQ=400,TQ=150,SQ=3,xQ={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let de={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const Ft={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function EO(t){if(Ft.doubleClickTimeout){if(t.buttons===Ft.mouseDownEvent.buttons)return;Ft.mouseDownEvent=t,dg();return}Ft.doubleClickTimeout=setTimeout(dg,t.buttons===1?CQ:TQ),Ft.mouseDownEvent=t,Ft.ignoreDoubleClick=!1,de.element=t.currentTarget,de.mouseButton=t.buttons;const e=le(de.element),{renderingEngineId:n,viewportId:r}=e;de.renderingEngineId=n,de.viewportId=r,de.preventClickTimeout=setTimeout(EQ,de.clickDelay),de.element.removeEventListener("mousemove",eu);const i=qo(t,de.element);de.startPoints=ya(i),de.lastPoints=ya(i),document.addEventListener("mouseup",Dm),document.addEventListener("mousemove",OO)}function wQ(t){const e=gd(de.startPoints,de.startPoints),n={event:t,eventName:R6,element:de.element,mouseButton:de.mouseButton,renderingEngineId:de.renderingEngineId,viewportId:de.viewportId,camera:{},startPoints:de.startPoints,lastPoints:de.startPoints,currentPoints:de.startPoints,deltaPoints:e};de.lastPoints=ya(n.lastPoints),Z(n.element,R6,n)&&Z(n.element,mQ,n)}function OO(t){const e=le(de.element);if(!(e!=null&&e.viewport))return;const n=qo(t,de.element),r=LO(de.element,de.lastPoints),i=gd(n,r);if(Ft.doubleClickTimeout)if(RO(i.canvas))dg();else return;const a={event:t,eventName:M6,mouseButton:de.mouseButton,renderingEngineId:de.renderingEngineId,viewportId:de.viewportId,camera:{},element:de.element,startPoints:ya(de.startPoints),lastPoints:ya(r),currentPoints:n,deltaPoints:i};!Z(de.element,M6,a)&&(t.stopImmediatePropagation(),t.preventDefault()),de.lastPoints=ya(n)}function Dm(t){if(clearTimeout(de.preventClickTimeout),Ft.doubleClickTimeout)Ft.mouseUpEvent?$h():(Ft.mouseUpEvent=t,de.element.addEventListener("mousemove",DO));else{const e=de.isClickEvent?vQ:yQ,n=qo(t,de.element),r=gd(n,de.lastPoints),i={event:t,eventName:e,mouseButton:de.mouseButton,element:de.element,renderingEngineId:de.renderingEngineId,viewportId:de.viewportId,camera:{},startPoints:ya(de.startPoints),lastPoints:ya(de.lastPoints),currentPoints:n,deltaPoints:r};Z(i.element,e,i),$h()}document.removeEventListener("mousemove",OO)}function DO(t){const e=qo(t,de.element),n=LO(de.element,de.lastPoints),r=gd(e,n);RO(r.canvas)&&(dg(),eu(t))}function RO(t){return Math.abs(t[0])+Math.abs(t[1])>SQ}function EQ(){de.isClickEvent=!1}function dg(){Ft.ignoreDoubleClick=!0;const t=Ft.mouseDownEvent,e=Ft.mouseUpEvent;MO(),wQ(t),e&&Dm(e)}function MO(){Ft.doubleClickTimeout&&(clearTimeout(Ft.doubleClickTimeout),Ft.doubleClickTimeout=null),Ft.mouseDownEvent=null,Ft.mouseUpEvent=null}function $h(){var t,e;document.removeEventListener("mouseup",Dm),(t=de.element)==null||t.removeEventListener("mousemove",DO),(e=de.element)==null||e.addEventListener("mousemove",eu),MO(),de=JSON.parse(JSON.stringify(xQ))}function ya(t){return JSON.parse(JSON.stringify(t))}function LO(t,e){const{viewport:n}=le(t)||{};if(!n)return e;const r=n.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:r}}function gd(t,e){return!t||!e?{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}:{page:z2(t.page,e.page),client:z2(t.client,e.client),canvas:z2(t.canvas,e.canvas),world:OQ(t.world,e.world)}}function z2(t,e){return[t[0]-e[0],t[1]-e[1]]}function OQ(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function DQ(){return de.mouseButton}function IO(t){Ft.ignoreDoubleClick?(Ft.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):$h()}function VO(t){t.removeEventListener("dblclick",wO),t.removeEventListener("mousedown",EO),t.removeEventListener("mousemove",eu),t.removeEventListener("dblclick",IO,{capture:!0})}function RQ(t){VO(t),t.addEventListener("dblclick",wO),t.addEventListener("mousedown",EO),t.addEventListener("mousemove",eu),t.addEventListener("dblclick",IO,{capture:!0})}const _O={enable:RQ,disable:VO},MQ=2e3,C0={mouse:0,touch:1};let L6,I6;function bO(t,e){const n=Date.now();if(t!==L6){if(n-I6<=MQ)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;L6=t}I6=n}const NO=bO.bind(null,C0.mouse),PO=bO.bind(null,C0.touch);function V6(t,e,n){const r=n?NO:PO;e.forEach(function(i){t.addEventListener(i,r,{passive:!1})})}function _6(t,e,n){const r=n?NO:PO;e.forEach(function(i){t.removeEventListener(i,r)})}const kO=["mousedown","mouseup","mousemove"],FO=["touchstart","touchend"];function UO(t){_6(t,kO,C0.mouse),_6(t,FO,C0.touch)}function LQ(t){UO(t),V6(t,kO,C0.mouse),V6(t,FO,C0.touch)}const AO={enable:LQ,disable:UO};function dd(t,e){const n=e||t.currentTarget,r=t.type==="touchend"?t.changedTouches:t.touches;return Object.keys(r).map(i=>{const a=_Q(r[i]),o=VQ(r[i]),s=IQ(n,o),{viewport:c}=le(n),l=c.canvasToWorld(s);return{page:o,client:a,canvas:s,world:l,touch:{identifier:i,radiusX:r[i].radiusX,radiusY:r[i].radiusY,force:r[i].force,rotationAngle:r[i].rotationAngle}}})}function IQ(t,e){const n=t.getBoundingClientRect();return[e[0]-n.left-window.pageXOffset,e[1]-n.top-window.pageYOffset]}function VQ(t){return[t.pageX,t.pageY]}function _Q(t){return[t.clientX,t.clientY]}function zh(t,e){const n=pg(t),r=pg(e);return{page:H2(n.page,r.page),client:H2(n.client,r.client),canvas:H2(n.canvas,r.canvas),world:bQ(n.world,r.world)}}function BO(t,e){const n=pg(t),r=pg(e);return{page:js(n.page,r.page),client:js(n.client,r.client),canvas:js(n.canvas,r.canvas),world:GO(n.world,r.world)}}function Hh(t,e){const n=N6(t),r=N6(e);return{page:n.page-r.page,client:n.client-r.client,canvas:n.canvas-r.canvas,world:n.world-r.world}}function Ei(t){return JSON.parse(JSON.stringify(t))}function b6(t){return JSON.parse(JSON.stringify(t))}function pg(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function Zr(t){return t.reduce((e,n)=>({page:[e.page[0]+n.page[0]/t.length,e.page[1]+n.page[1]/t.length],client:[e.client[0]+n.client[0]/t.length,e.client[1]+n.client[1]/t.length],canvas:[e.canvas[0]+n.canvas[0]/t.length,e.canvas[1]+n.canvas[1]/t.length],world:[e.world[0]+n.world[0]/t.length,e.world[1]+n.world[1]/t.length,e.world[2]+n.world[2]/t.length],touch:{identifier:null,radiusX:e.touch.radiusX+n.touch.radiusX/t.length,radiusY:e.touch.radiusY+n.touch.radiusY/t.length,force:e.touch.force+n.touch.force/t.length,rotationAngle:e.touch.rotationAngle+n.touch.rotationAngle/t.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function H2(t,e){return[t[0]-e[0],t[1]-e[1]]}function bQ(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function N6(t){const e=[];for(let n=0;n<t.length;n++)for(let r=0;r<t.length;r++)n<r&&e.push({page:js(t[n].page,t[r].page),client:js(t[n].client,t[r].client),canvas:js(t[n].canvas,t[r].canvas),world:GO(t[n].world,t[r].world)});return e.reduce((n,r)=>({page:n.page+r.page/e.length,client:n.client+r.client/e.length,canvas:n.canvas+r.canvas/e.length,world:n.world+r.world/e.length}),{page:0,client:0,canvas:0,world:0})}function js(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function GO(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}Ke.getRuntimeSettings();const{TOUCH_START:P6,TOUCH_START_ACTIVATE:NQ,TOUCH_PRESS:k6,TOUCH_DRAG:F6,TOUCH_END:U6,TOUCH_TAP:A6,TOUCH_SWIPE:j2}=H,Rl={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},hg={page:0,client:0,canvas:0,world:0},WO={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Rl,touch:null}],lastPointsList:[{...Rl,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:hg,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},$O={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Rl,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let ne=JSON.parse(JSON.stringify(WO)),Ct=JSON.parse(JSON.stringify($O));function Oa(t,e,n){return Z(t,e,n)}function zO(t){ne.element=t.currentTarget;const e=le(ne.element),{renderingEngineId:n,viewportId:r}=e;ne.renderingEngineId=n,ne.viewportId=r,!ne.isTouchStart&&(clearTimeout(ne.pressTimeout),ne.pressTimeout=setTimeout(()=>PQ(t),ne.pressDelay),kQ(t),document.addEventListener("touchmove",HO),document.addEventListener("touchend",jO))}function PQ(t){if(ne.accumulatedDistance.canvas>ne.pressMaxDistance)return;const n={event:t,eventName:k6,renderingEngineId:ne.renderingEngineId,viewportId:ne.viewportId,camera:{},element:ne.element,startPointsList:Ei(ne.startPointsList),lastPointsList:Ei(ne.lastPointsList),startPoints:b6(Zr(ne.startPointsList)),lastPoints:b6(Zr(ne.lastPointsList))};Oa(n.element,k6,n)}function kQ(t){ne.isTouchStart=!0,ne.startTime=new Date;const e=dd(t,ne.element),n=Zr(e),r=Rl,i=hg,a={event:t,eventName:P6,element:ne.element,renderingEngineId:ne.renderingEngineId,viewportId:ne.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:n,lastPoints:n,currentPoints:n,deltaPoints:r,deltaDistance:i};ne.startPointsList=Ei(a.startPointsList),ne.lastPointsList=Ei(a.lastPointsList),Oa(a.element,P6,a)&&Oa(a.element,NQ,a)}function HO(t){const e=dd(t,ne.element),n=KO(ne.element,ne.lastPointsList),r=e.length===n.length?zh(e,n):Rl,i=e.length===n.length?Hh(e,n):hg,a=e.length===n.length?BO(e,ne.lastPointsList):hg;ne.accumulatedDistance={page:ne.accumulatedDistance.page+a.page,client:ne.accumulatedDistance.client+a.client,canvas:ne.accumulatedDistance.canvas+a.canvas,world:ne.accumulatedDistance.world+a.world};const o={event:t,eventName:F6,renderingEngineId:ne.renderingEngineId,viewportId:ne.viewportId,camera:{},element:ne.element,startPoints:Zr(ne.startPointsList),lastPoints:Zr(n),currentPoints:Zr(e),startPointsList:Ei(ne.startPointsList),lastPointsList:Ei(n),currentPointsList:e,deltaPoints:r,deltaDistance:i};Oa(ne.element,F6,o),UQ(t,r),ne.lastPointsList=Ei(e)}function jO(t){clearTimeout(ne.pressTimeout);const e=dd(t,ne.element),n=KO(ne.element,ne.lastPointsList),r=e.length===n.length?zh(e,n):zh(e,e),i=e.length===n.length?Hh(e,n):Hh(e,e),a={event:t,eventName:U6,element:ne.element,renderingEngineId:ne.renderingEngineId,viewportId:ne.viewportId,camera:{},startPointsList:Ei(ne.startPointsList),lastPointsList:Ei(n),currentPointsList:e,startPoints:Zr(ne.startPointsList),lastPoints:Zr(n),currentPoints:Zr(e),deltaPoints:r,deltaDistance:i};Oa(a.element,U6,a),FQ(t),ne=JSON.parse(JSON.stringify(WO)),document.removeEventListener("touchmove",HO),document.removeEventListener("touchend",jO)}function FQ(t){const e=new Date().getTime(),n=ne.startTime.getTime();if(e-n>Ct.tapToleranceMs||(Ct.taps===0&&(Ct.element=ne.element,Ct.renderingEngineId=ne.renderingEngineId,Ct.viewportId=ne.viewportId,Ct.startPointsList=ne.startPointsList),Ct.taps>0&&!(Ct.element==ne.element&&Ct.renderingEngineId==ne.renderingEngineId&&Ct.viewportId==ne.viewportId)))return;const r=dd(t,Ct.element);BO(r,Ct.startPointsList).canvas>Ct.tapMaxDistance||(clearTimeout(Ct.tapTimeout),Ct.taps+=1,Ct.tapTimeout=setTimeout(()=>{const a={event:t,eventName:A6,element:Ct.element,renderingEngineId:Ct.renderingEngineId,viewportId:Ct.viewportId,camera:{},currentPointsList:r,currentPoints:Zr(r),taps:Ct.taps};Oa(a.element,A6,a),Ct=JSON.parse(JSON.stringify($O))},Ct.tapToleranceMs))}function UQ(t,e){const n=new Date().getTime(),r=ne.startTime.getTime();if(ne.swiped||n-r>ne.swipeToleranceMs)return;const[i,a]=e.canvas,o={event:t,eventName:j2,renderingEngineId:ne.renderingEngineId,viewportId:ne.viewportId,camera:{},element:ne.element,swipe:null};Math.abs(i)>ne.swipeDistanceThreshold&&(o.swipe=i>0?Rs.RIGHT:Rs.LEFT,Oa(o.element,j2,o),ne.swiped=!0),Math.abs(a)>ne.swipeDistanceThreshold&&(o.swipe=a>0?Rs.DOWN:Rs.UP,Oa(o.element,j2,o),ne.swiped=!0)}function KO(t,e){const{viewport:n}=le(t);return e.map(r=>{const i=n.canvasToWorld(r.canvas);return{page:r.page,client:r.client,canvas:r.canvas,world:i,touch:r.touch}})}function qO(t){AO.disable(t),t.removeEventListener("touchstart",zO)}function AQ(t){qO(t),AO.enable(t),t.addEventListener("touchstart",zO,{passive:!1})}const XO={enable:AQ,disable:qO},B6=10,G6=40,W6=800;function BQ(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),r=e*B6,i=n*B6,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=G6,i*=G6):(r*=W6,i*=W6)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:i}}function YO(t){const e=t.currentTarget,n=le(e),{renderingEngineId:r,viewportId:i}=n;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:a,spinY:o,pixelX:s,pixelY:c}=BQ(t),l=o<0?-1:1,f={event:t,eventName:H.MOUSE_WHEEL,renderingEngineId:r,viewportId:i,element:e,camera:{},detail:t,wheel:{spinX:a,spinY:o,pixelX:s,pixelY:c,direction:l},points:qo(t)};Z(e,H.MOUSE_WHEEL,f)}function GQ(t){ZO(t),t.addEventListener("wheel",YO,{passive:!1})}function ZO(t){t.removeEventListener("wheel",YO)}const JO={enable:GQ,disable:ZO},WQ={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Lt={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function pd(t){Lt.element=t.currentTarget;const e=le(Lt.element),{renderingEngineId:n,viewportId:r}=e;Lt.renderingEngineId=n,Lt.viewportId=r,Lt.key=t.key,Lt.keyCode=t.keyCode,t.preventDefault();const i={renderingEngineId:Lt.renderingEngineId,viewportId:Lt.viewportId,element:Lt.element,key:Lt.key,keyCode:Lt.keyCode};Z(i.element,H.KEY_DOWN,i),document.addEventListener("keyup",QO),document.addEventListener("visibilitychange",Rm),Lt.element.removeEventListener("keydown",pd)}function Rm(){document.removeEventListener("visibilitychange",Rm),document.visibilityState==="hidden"&&eD()}function QO(t){const e={renderingEngineId:Lt.renderingEngineId,viewportId:Lt.viewportId,element:Lt.element,key:Lt.key,keyCode:Lt.keyCode};document.removeEventListener("keyup",QO),document.removeEventListener("visibilitychange",Rm),Lt.element.addEventListener("keydown",pd),Lt=structuredClone(WQ),Z(e.element,H.KEY_UP,e)}function $Q(){return Lt.keyCode}function eD(){Lt.keyCode=void 0}function zQ(t){tD(t),t.addEventListener("keydown",pd)}function tD(t){t.removeEventListener("keydown",pd)}const A0={enable:zQ,disable:tD,getModifierKey:$Q},Mm=new Map,HQ=t=>{const e=Mm.get(t);e&&(e.isDirty=!0)},jQ=t=>{const e=Mm.get(t);return e&&!e.isDirty?e.indices:null},KQ=(t,e)=>{Mm.set(t,{indices:e,isDirty:!1})};function hd(t,e){const n={segmentationId:t,modifiedSlicesToUse:e};HQ(t),Z(Y,H.SEGMENTATION_DATA_MODIFIED,n)}function T0(t){const e={segmentationId:t};Z(Y,H.SEGMENTATION_MODIFIED,e)}function qQ(t){const e={segmentationId:t};Z(Y,H.SEGMENTATION_REMOVED,e)}function sf(t,e,n){const r={segmentationId:e,type:n,viewportId:t};Z(Y,H.SEGMENTATION_REPRESENTATION_ADDED,r)}function $6(t,e,n){const r={viewportId:t,segmentationId:e,type:n};Z(Y,H.SEGMENTATION_REPRESENTATION_REMOVED,r)}const XQ={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};function YQ(){return XQ}const ZQ={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};function JQ(){return ZQ}class QQ{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,n){const{viewportId:r,segmentationId:i,type:a,segmentIndex:o}=e,s=this.getStyle(e);let c;if(!r&&!i?c={...s,...n}:c=this.copyActiveToInactiveIfNotProvided({...s,...n},a),!a)throw new Error("Type is required to set a style");if(r){this.config.viewportsStyle[r]||(this.config.viewportsStyle[r]={renderInactiveSegmentations:!1,representations:{}});const l=this.config.viewportsStyle[r].representations;if(i){l[i]||(l[i]={}),l[i][a]||(l[i][a]={});const f=l[i][a];o!==void 0?(f.perSegment||(f.perSegment={}),f.perSegment[o]=c):f.allSegments=c}else{const f="__allSegmentations__";l[f]||(l[f]={}),l[f][a]||(l[f][a]={}),l[f][a].allSegments=c}}else if(i){this.config.segmentations[i]||(this.config.segmentations[i]={}),this.config.segmentations[i][a]||(this.config.segmentations[i][a]={});const l=this.config.segmentations[i][a];o!==void 0?(l.perSegment||(l.perSegment={}),l.perSegment[o]=c):l.allSegments=c}else this.config.global[a]=c}copyActiveToInactiveIfNotProvided(e,n){const r={...e};if(n===se.Labelmap){const i=r;i.renderOutlineInactive=i.renderOutline,i.outlineWidthInactive=i.outlineWidth,i.renderFillInactive=i.renderFill,i.fillAlphaInactive=i.fillAlpha,i.outlineOpacityInactive=i.outlineOpacity}else if(n===se.Contour){const i=r;i.outlineWidthInactive=i.outlineWidth,i.outlineOpacityInactive=i.outlineOpacity,i.outlineDashInactive=i.outlineDash,i.renderOutlineInactive=i.renderOutline,i.renderFillInactive=i.renderFill,i.fillAlphaInactive=i.fillAlpha}return r}getStyle(e){var s,c,l,f,u;const{viewportId:n,segmentationId:r,type:i,segmentIndex:a}=e;let o=this.getDefaultStyle(i);if(this.config.global[i]&&(o={...o,...this.config.global[i]}),(s=this.config.segmentations[r])!=null&&s[i]&&(o={...o,...this.config.segmentations[r][i].allSegments},a!==void 0&&((c=this.config.segmentations[r][i].perSegment)!=null&&c[a])&&(o={...o,...this.config.segmentations[r][i].perSegment[a]})),n&&this.config.viewportsStyle[n]){this.config.viewportsStyle[n].renderInactiveSegmentations;const g="__allSegmentations__";(l=this.config.viewportsStyle[n].representations[g])!=null&&l[i]&&(o={...o,...this.config.viewportsStyle[n].representations[g][i].allSegments}),r&&((f=this.config.viewportsStyle[n].representations[r])!=null&&f[i])&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].allSegments},a!==void 0&&((u=this.config.viewportsStyle[n].representations[r][i].perSegment)!=null&&u[a])&&(o={...o,...this.config.viewportsStyle[n].representations[r][i].perSegment[a]}))}return o}getRenderInactiveSegmentations(e){var n;return(n=this.config.viewportsStyle[e])==null?void 0:n.renderInactiveSegmentations}setRenderInactiveSegmentations(e,n){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=n}getDefaultStyle(e){switch(e){case se.Labelmap:return JQ();case se.Contour:return YQ();case se.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const r=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:r,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:n}=e,r=this.getStyle(e),i=this.getDefaultStyle(n);return!RE(r,i)}}const xo=new QQ;function eee(t){const e={segmentationId:t};Z(Y,H.SEGMENTATION_ADDED,e)}const z6={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};class tee{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,e||(e=bt()),this.state=Object.freeze(Rr(z6)),this.uid=e}getState(){return this.state}updateState(e){const n=Rr(this.state);e(n),this.state=Object.freeze(n)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this.state=Object.freeze(Rr(z6))}getSegmentation(e){return this.state.segmentations.find(n=>n.segmentationId===e)}updateSegmentation(e,n){this.updateState(r=>{const i=r.segmentations.find(a=>a.segmentationId===e);if(!i){console.warn(`Segmentation with id ${e} not found. Update aborted.`);return}Object.assign(i,n)}),T0(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(n=>{const r=Rr(e);if(r.representationData.Labelmap&&"volumeId"in r.representationData.Labelmap&&!("imageIds"in r.representationData.Labelmap)){const i=this.getLabelmapImageIds(r.representationData);r.representationData.Labelmap.imageIds=i}n.segmentations.push(r)}),eee(e.segmentationId)}removeSegmentation(e){this.updateState(n=>{const r=n.segmentations.filter(i=>i.segmentationId!==e);n.segmentations.splice(0,n.segmentations.length,...r)}),qQ(e)}addSegmentationRepresentation(e,n,r,i){if(!en(e))return;if(this.getSegmentationRepresentations(e,{type:r,segmentationId:n}).length>0){console.debug("A segmentation representation of type",r,"already exists in viewport",e,"for segmentation",n);return}this.updateState(s=>{s.viewportSegRepresentations[e]||(s.viewportSegRepresentations[e]=[],xo.setRenderInactiveSegmentations(e,!0)),r!==se.Labelmap?this.addDefaultSegmentationRepresentation(s,e,n,r,i):this.addLabelmapRepresentation(s,e,n,i)}),sf(e,n,r)}addDefaultSegmentationRepresentation(e,n,r,i,a){const o=e.segmentations.find(c=>c.segmentationId===r);if(!o)return;const s={};Object.keys(o.segments).forEach(c=>{s[Number(c)]={visible:!0}}),e.viewportSegRepresentations[n].push({segmentationId:r,type:i,active:!0,visible:!0,colorLUTIndex:0,segments:s,config:{...H6(i),...a}}),this._setActiveSegmentation(e,n,r)}addLabelmapRepresentation(e,n,r,i=H6(se.Labelmap)){if(!en(n))return;const o=this.getSegmentation(r);if(!o)return;const{representationData:s}=o;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,n,r,se.Labelmap,i);this.processLabelmapRepresentationAddition(n,r),this.addDefaultSegmentationRepresentation(e,n,r,se.Labelmap,i)}async processLabelmapRepresentationAddition(e,n){const r=en(e);if(!r)return;const i=this.getSegmentation(n);if(!i)return;const a=r.viewport instanceof Fr,{representationData:o}=i,s="volumeId"in o.Labelmap;r.viewport,!a&&!s&&this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,n,r,i){const a=n.getCurrentImageId();let o=!1;for(const s of r)n.isReferenceViewable({referencedImageId:s},{asOverlay:!0})&&(o=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(a,s));return i&&i(n,e,r),o?this._stackLabelmapImageIdReferenceMap.get(e).get(a):void 0}updateLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=en(e).viewport;return this._updateLabelmapSegmentationReferences(n,s,a,null)}_updateAllLabelmapSegmentationImageReferences(e,n){const r=this.getSegmentation(n);if(!r)return;this._stackLabelmapImageIdReferenceMap.has(n)||this._stackLabelmapImageIdReferenceMap.set(n,new Map);const{representationData:i}=r;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),s=en(e).viewport;this._updateLabelmapSegmentationReferences(n,s,a,(c,l,f)=>{c.getImageIds().forEach((g,d)=>{for(const h of f)c.isReferenceViewable({referencedImageId:h,sliceIndex:d},{asOverlay:!0,withNavigation:!0})&&this._stackLabelmapImageIdReferenceMap.get(l).set(g,h)})})}getLabelmapImageIds(e){const n=e.Labelmap;let r;if(n.imageIds)r=n.imageIds;else if(!r&&n.volumeId){const i=n.volumeId;r=Q.getVolume(i).imageIds}return r}getCurrentLabelmapImageIdForViewport(e,n){const r=en(e);if(!r||!this._stackLabelmapImageIdReferenceMap.has(n))return;const a=r.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(n).get(a)}getStackSegmentationImageIdsForViewport(e,n){if(!this.getSegmentation(n))return[];this._updateAllLabelmapSegmentationImageReferences(e,n);const{viewport:i}=en(e),a=i.getImageIds(),o=this._stackLabelmapImageIdReferenceMap.get(n);return a.map(s=>o.get(s))}removeSegmentationRepresentationsInternal(e,n){const r=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const a=i.viewportSegRepresentations[e];let o=!1;if(!n||Object.values(n).every(s=>s===void 0))r.push(...a),delete i.viewportSegRepresentations[e];else{const{segmentationId:s,type:c}=n;i.viewportSegRepresentations[e]=a.filter(l=>{const f=s&&c&&l.segmentationId===s&&l.type===c||s&&!c&&l.segmentationId===s||!s&&c&&l.type===c;return f&&(r.push(l),l.active&&(o=!0)),!f}),i.viewportSegRepresentations[e].length===0?delete i.viewportSegRepresentations[e]:o&&(i.viewportSegRepresentations[e][0].active=!0)}}),r}removeSegmentationRepresentations(e,n){const r=this.removeSegmentationRepresentationsInternal(e,n);r.forEach(a=>{$6(e,a.segmentationId,a.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&sf(e,i[0].segmentationId,i[0].type),r}removeSegmentationRepresentation(e,n,r){const i=this.removeSegmentationRepresentationsInternal(e,n);return r||i.forEach(({segmentationId:a,type:o})=>{$6(e,a,o)}),i}_setActiveSegmentation(e,n,r){const i=e.viewportSegRepresentations[n];i&&i.forEach(a=>{a.active=a.segmentationId===r})}setActiveSegmentation(e,n){this.updateState(r=>{const i=r.viewportSegRepresentations[e];i&&i.forEach(a=>{a.active=a.segmentationId===n})}),sf(e,n)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const n=this.state.viewportSegRepresentations[e].find(r=>r.active);if(n)return this.getSegmentation(n.segmentationId)}getSegmentationRepresentations(e,n={}){const r=this.state.viewportSegRepresentations[e];return r?!n.type&&!n.segmentationId?r:r.filter(i=>{const a=n.type?i.type===n.type:!0,o=n.segmentationId?i.segmentationId===n.segmentationId:!0;return a&&o}):[]}getSegmentationRepresentation(e,n){return this.getSegmentationRepresentations(e,n)[0]}getSegmentationRepresentationVisibility(e,n){const r=this.getSegmentationRepresentation(e,n);return r==null?void 0:r.visible}setSegmentationRepresentationVisibility(e,n,r){this.updateState(i=>{const a=this.getSegmentationRepresentations(e,n);a&&a.forEach(o=>{o.visible=r,Object.entries(o.segments).forEach(([s,c])=>{c.visible=r})})}),sf(e,n.segmentationId,n.type)}addColorLUT(e,n){this.updateState(r=>{r.colorLUT[n]&&console.warn("Color LUT table already exists, overwriting"),r.colorLUT[n]=Rr(e)})}removeColorLUT(e){this.updateState(n=>{delete n.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(n=>n.slice(-Math.round(n.length*.15))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,n])=>({viewportId:e,representations:n}))}getSegmentationRepresentationsBySegmentationId(e){const n=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([r,i])=>{const a=i.filter(o=>o.segmentationId===e);a.length>0&&n.push({viewportId:r,representations:a})}),n}}async function nee({imageIds:t,options:e}){const n=t,r=(e==null?void 0:e.volumeId)||bt();return await om(r,n),{volumeId:r}}function H6(t){const e=wa.newInstance(),n=u0.newInstance();return n.addPoint(0,0),t===se.Labelmap?{cfun:e,ofun:n}:{}}const ii=new tee("DEFAULT");function wo(t,e={}){return ii.getSegmentationRepresentations(t,e)}function nD(t,e){const n=ii;if(!e.segmentationId||!e.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");const r=n.getSegmentationRepresentations(t,e);return r==null?void 0:r[0]}function rD(t,e,n){const r=en(t);if(!r)return;const{renderingEngine:i,viewport:a}=r;if(!i||!a)return;const s=a.getActors().filter(n);return s.length>0?s[0]:void 0}function ree(t,e){const n=Ks(t,e);return n==null?void 0:n.uid}function Ks(t,e){return rD(t,e,n=>{var r;return(r=n.representationUID)==null?void 0:r.startsWith(`${e}-${se.Labelmap}`)})}function iD(t,e,n){return rD(t,e,r=>{var i;return(i=r.representationUID)==null?void 0:i.startsWith(`${e}-${se.Surface}-${n}`)})}function aD(t,e,n){const r=n?n.toString():"",i=iD(t,e,r);return i==null?void 0:i.uid}function iee(t,e){const n=le(t),{viewport:r}=n,a=r.getActors().filter(o=>o.uid.startsWith(aD(r.id,e,"")));r.removeActors(a.map(o=>o.uid))}function aee(t,e,n){const r=le(t),{viewport:i}=r,a=aD(i.id,n,e.segmentIndex),o=iD(i.id,n,e.segmentIndex),s=o==null?void 0:o.actor;if(s){const m=s.getMapper(),v=m.getInputData(),y=e.points,C=e.polys,T=v.getPoints().getData(),S=v.getPolys().getData();if(y.length===T.length&&C.length===S.length)return;const x=Bn.newInstance();x.getPoints().setData(y,3);const w=Po.newInstance({values:Float32Array.from(C)});x.setPolys(w),m.setInputData(x),m.modified(),i.getRenderer().resetCameraClippingRange();return}const c=e.points,l=e.polys,f=e.color,u=Bn.newInstance();u.getPoints().setData(c,3);const g=Po.newInstance({values:Float32Array.from(l)});u.setPolys(g);const d=No.newInstance({});let h;d.setInputData(u);const p=ko.newInstance();p.setMapper(d),p.getProperty().setColor(f[0]/255,f[1]/255,f[2]/255),p.getProperty().setLineWidth(2),i.addActor({uid:bt(),actor:p,clippingFilter:h,representationUID:a}),i.resetCamera(),i.getRenderer().resetCameraClippingRange(),i.render()}function ut(t){return ii.getSegmentation(t)}function Lm(t){return ii.getColorLUT(t)}function oee(t){if("volumeId"in t){if(t=t,!Q.getVolume(t.volumeId))throw new Error(`volumeId of ${t.volumeId} not found in cache, you should load and cache volume before adding segmentation`)}else if("imageIds"in t){if(t=t,!t.imageIds)throw new Error("The segmentationInput.representationData.imageIds is undefined, please provide a valid representationData.imageIds for stack data")}else throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData")}function see(t){oee(t)}const cee=new Map([[se.Labelmap,new Set([se.Surface,se.Contour])],[se.Contour,new Set([se.Labelmap,se.Surface])],[se.Surface,new Set([se.Labelmap])]]);function Im(t,e){const{representationData:n}=ut(t);return lee(n).some(i=>uee(i,e))}function lee(t){const e=[];return Object.keys(t).forEach(n=>{const r=t[n];let i;switch(n){case se.Labelmap:i=see;break}if(i)try{i(r),e.push(n)}catch{console.warn(`Validation failed for labelmap of type ${n}`)}else e.push(n)}),e}async function uee(t,e){var n;return((n=cee.get(t))==null?void 0:n.has(e))||!1}function fee({segmentationId:t,type:e,data:n}){const r=ut(t);if(!r)throw new Error(`Segmentation ${t} not found`);switch(r.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case se.Labelmap:n&&(r.representationData[e]=n);break;case se.Contour:n&&(r.representationData[e]=n);break;case se.Surface:n&&(r.representationData[e]=n);break;default:throw new Error(`Invalid representation type ${e}`)}}function oD(t){const e=typeof t;return t!==null&&(e==="object"||e==="function")}function sD(t,e,n){let r,i,a,o,s,c,l=0,f=!1,u=!1,g=!0;const d=!e&&e!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,oD(n)&&(f=!!n.leading,u="maxWait"in n,a=u?Math.max(Number(n.maxWait)||0,e):a,g="trailing"in n?!!n.trailing:g);function h(O){const R=r,_=i;return r=i=void 0,l=O,o=t.apply(_,R),o}function p(O,R){return d?window.requestAnimationFrame(O):setTimeout(O,R)}function m(O){if(d)return window.cancelAnimationFrame(O);clearTimeout(O)}function v(O){return l=O,s=p(T,e),f?h(O):o}function y(O){const R=O-c,_=O-l,P=e-R;return u?Math.min(P,a-_):P}function C(O){const R=O-c,_=O-l;return c===void 0||R>=e||R<0||u&&_>=a}function T(){const O=Date.now();if(C(O))return S(O);s=p(T,y(O))}function S(O){return s=void 0,g&&r?h(O):(r=i=void 0,o)}function x(){s!==void 0&&m(s),l=0,r=c=i=s=void 0}function w(){return s===void 0?o:S(Date.now())}function E(){return s!==void 0}function M(...O){const R=Date.now(),_=C(R);if(r=O,i=this,c=R,_){if(s===void 0)return v(c);if(u)return s=p(T,e),h(c)}return s===void 0&&(s=p(T,e)),o}return M.cancel=x,M.flush=w,M.pending=E,M}let j6=!1;function cD(){if(j6)return;j6=!0;const t=()=>new Worker(new URL("/corenerstone-test-react-vite/assets/polySegConverters-CQFC-sbb.js",import.meta.url),{name:"polySeg",type:"module"}),e=_a(),n={maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:2e3}};e.registerWorker("polySeg",t,n)}const qf=new Map;async function Vm(t,e,n,r,i){cD();const a=await n();fee({segmentationId:t,type:e,data:a}),i==null||i(),qf.has(t)||qf.set(t,[]);const o=qf.get(t);return o.includes(e)||o.push(e),gee(r),T0(t),a}function gee(t){const e=n=>{dee(n,t)};t._debouncedUpdateFunction=e,Y.removeEventListener(H.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction),Y.addEventListener(H.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction)}const dee=sD((t,e)=>{const n=t.detail.segmentationId,r=qf.get(n);!r||!r.length||(e(n),r.length&&T0(n))},300);function Ni(t){const e=jQ(t);if(e)return e;const n=ut(t);if(!n)throw new Error(`No segmentation found for segmentationId ${t}`);let r;if(n.representationData.Labelmap)r=pee(n,t);else if(n.representationData.Contour)r=vee(n);else if(n.representationData.Surface)r=yee(n);else throw new Error(`Unsupported segmentation type: ${n.representationData}`);return KQ(t,r),r}function pee(t,e){const n=t.representationData[se.Labelmap],r=new Set;return n.imageIds?mee(r,n.imageIds):hee(r,e),Array.from(r).map(Number).sort((i,a)=>i-a)}function hee(t,e){Q.getVolume(e).voxelManager.forEach(({value:r})=>{r!==0&&t.add(r)})}function mee(t,e){e.forEach(n=>{Q.getImage(n).voxelManager.getScalarData().forEach(a=>{a!==0&&t.add(a)})})}function vee(t){const{annotationUIDsMap:e,geometryIds:n}=t.representationData.Contour||{};if(!n)throw new Error(`No geometryIds found for segmentationId ${t.segmentationId}`);const r=new Set([...e.keys()]);return n.forEach(i=>{const a=Q.getGeometry(i);r.add(a.data.segmentIndex)}),Array.from(r).sort((i,a)=>i-a)}function yee(t){var n;const e=((n=t.representationData.Surface)==null?void 0:n.geometryIds)??[];return Array.from(e.keys()).map(Number).sort((r,i)=>r-i)}const Cee=_a(),K2=(t,e,n)=>{Z(t,X.WEB_WORKER_PROGRESS,{progress:e,type:Uo.POLYSEG_CONTOUR_TO_SURFACE,id:n})};async function Tee(t,e){const{annotationUIDsMap:n}=t,r=[],i=[],a=n.get(e);for(const s of a){const c=zt(s),{polyline:l}=c.data.contour;i.push(l.length),l.forEach(f=>r.push(...f))}K2(Y,0,e);const o=await Cee.executeTask("polySeg","convertContourToSurface",{polylines:r,numPointsArray:i},{callbacks:[s=>{K2(Y,s,e)}]});return K2(Y,100,e),o}function lD(t,e,n){const r=wo(t,{segmentationId:e});if(!r||r.length===0)return null;const i=r[0],{colorLUTIndex:a}=i,o=Lm(a);let s=o[n];if(!s){if(typeof n!="number")throw new Error(`Can't create colour for LUT index ${n}`);s=o[n]=[0,0,0,0]}return s}async function uD(t,e,n={}){const r=ut(t),i=new Map,a=Object.keys(e).map(async o=>{const s=e[o],c=s.segmentIndex,l=lD(n.viewport.id,r.segmentationId,c).slice(0,3);if(!l)throw new Error("No color found for segment index, unable to create surface");const f={id:`segmentation_${r.segmentationId}_surface_${c}`,color:l,frameOfReferenceUID:"test-frameOfReferenceUID",points:s.data.points,polys:s.data.polys,segmentIndex:c},u=f.id;return i.set(c,u),SZ(u,{type:Ii.SURFACE,geometryData:f})});return await Promise.all(a),{geometryIds:i}}async function See(t){return nee(t)}const xee=_a(),q2=(t,e,n)=>{Z(t,X.WEB_WORKER_PROGRESS,{progress:e,type:Uo.POLYSEG_LABELMAP_TO_SURFACE,id:n})};async function wee(t,e){let n;if(t.volumeId)n=t.volumeId;else{const{imageIds:f}=t;({volumeId:n}=await See({imageIds:f}))}const r=Q.getVolume(n),i=r.voxelManager.getCompleteScalarDataArray(),{dimensions:a,spacing:o,origin:s,direction:c}=r;q2(Y,0,e);const l=await xee.executeTask("polySeg","convertLabelmapToSurface",{scalarData:i,dimensions:a,spacing:o,origin:s,direction:c,segmentIndex:e},{callbacks:[f=>{q2(Y,f,e)}]});return q2(Y,100,e),l}async function Eee(t,e={}){var s;const n=(s=e.segmentIndices)!=null&&s.length?e.segmentIndices:Ni(t);let r;const i=ut(t),a=i.representationData;try{a.Contour?r=await Oee(t,{segmentIndices:n,...e}):a.Labelmap&&(r=await _m(i.segmentationId,{segmentIndices:n,...e}))}catch(c){throw console.error(c),c}if(!r)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return await uD(t,r,e)}async function _m(t,e={}){var l;const n=ut(t);if(!((l=n==null?void 0:n.representationData)!=null&&l.Labelmap)){console.warn("Only support surface update from labelmaps");return}const r=n.representationData.Labelmap,i=e.segmentIndices||Ni(t),a=i.map(f=>wee(r,f)),o=await Promise.allSettled(a),s=o.filter(f=>f.status==="rejected");if(s.length>0)throw console.error(s),new Error("Failed to convert labelmap to surface");return o.map((f,u)=>{if(f.status==="fulfilled")return{segmentIndex:i[u],data:f.value}}).filter(Boolean)}async function Oee(t,e={}){const r=ut(t).representationData.Contour,a=(e.segmentIndices||Ni(t)).map(async s=>{const c=await Tee(r,s);return{segmentIndex:s,data:c}});return await Promise.all(a)}function bm(t){const r=ii.getState().viewportSegRepresentations;return Object.entries(r).filter(([,a])=>a.some(o=>o.segmentationId===t)).map(([a])=>a)}async function Dee(t){const e=await _m(t);if(!e)return;const n=ut(t),r=Ni(t);if(!r.length){n.representationData.Surface.geometryIds.forEach(o=>{const c=Q.getGeometry(o).data;c.points=[],c.polys=[]}),T0(t);return}const i=e.map(({data:a,segmentIndex:o})=>{const s=`segmentation_${t}_surface_${o}`,c=Q.getGeometry(s);if(c)if(r.includes(o)){const l=c.data;l.points=a.points,l.polys=a.polys}else{const l=c.data;l.points=[],l.polys=[]}else return bm(t).map(f=>[nD(f,{segmentationId:t,type:se.Surface})].map(g=>(n.representationData.Surface.geometryIds.set(o,s),uD(t,[{segmentIndex:o,data:a}],{segmentationId:g.segmentationId}))))});await Promise.all(i),T0(t)}function Ree(t,e={}){return Vm(t,se.Surface,()=>Eee(t,e),()=>Dee(t))}function Mee(t,e,n=!1){const r=en(t);if(!r)return;const{viewport:i}=r;iee(i.element,e),n&&i.render()}async function Lee(t,e){const{segmentationId:n}=e,r=ut(n);if(!r)return;let i=r.representationData[se.Surface];if(!i&&Im(n,se.Surface)&&(i=await Ree(n,{viewport:t}),!i))throw new Error(`No Surface data found for segmentationId ${n}.`);const{geometryIds:a}=i;a!=null&&a.size||console.warn(`No Surfaces found for segmentationId ${n}. Skipping render.`);const{colorLUTIndex:o}=e,s=Lm(o);a.forEach(c=>{const l=Q.getGeometry(c);if(!(l!=null&&l.data)){console.warn(`No Surfaces found for geometryId ${c}. Skipping render.`);return}const f=l.data.segmentIndex,u=l.data,g=s[f];u.color=g.slice(0,3),aee(t.element,u,n)}),t.render()}const Iee={render:Lee,removeRepresentation:Mee};function Vee(t,e,n){const r=t.getImageIds();if(!r||!r.length)return;const i=r.map(a=>{const{imagePositionPatient:o}=ee("imagePlaneModule",a),s=_ee(e,o,n);return{imageId:a,distance:s}});return i.sort((a,o)=>a.distance-o.distance),i[0].imageId}function _ee(t,e,n){const r=te();_t(r,t,e);const i=fe(r,n);return Math.abs(i)}function bee(t,e){const{segmentation:n}=t.data,{segmentation:r}=e.data;return n.segmentationId===r.segmentationId&&n.segmentIndex===r.segmentIndex}function md(t){var e;return!!((e=t.data)!=null&&e.segmentation)}function Ml(t){if(t.parentAnnotationUID)return;if(!t.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=ut(e);r.representationData.Contour||(r.representationData.Contour={annotationUIDsMap:new Map});const{annotationUIDsMap:i}=r.representationData.Contour;let a=i.get(n);a||(a=new Set,i.set(n,a)),i.set(n,a.add(t.annotationUID))}function Nm(t){if(!t.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:n}=t.data.segmentation,r=ut(e),{annotationUIDsMap:i}=(r==null?void 0:r.representationData.Contour)||{},a=i==null?void 0:i.get(n);a&&(a.delete(t.annotationUID),a.size||i.delete(n))}function Nee(t){if(!t)throw new Error(`No contours found for geometryId ${t.id}`);const e=t.id;if(t.type!==Ii.CONTOUR)throw new Error(`Geometry type ${t.type} not supported for rendering.`);if(!t.data){console.warn(`No contours found for geometryId ${e}. Skipping render.`);return}}function Pee(t,e,n,r){n.size?t.render():kee(t,e,r)}function kee(t,e,n){const{segmentationId:r}=n,i=new Map;e.forEach(a=>{const o=Q.getGeometry(a);if(!o){console.warn(`No geometry found for geometryId ${a}. Skipping render.`);return}const s=o.data.segmentIndex;Nee(o);const c=xo.getStyle({viewportId:t.id,segmentationId:r,type:se.Contour,segmentIndex:s}),l=o.data,f=t.getCamera().viewPlaneNormal;l.contours.forEach(u=>{const{points:g,color:d,id:h}=u,p=Vee(t,g[0],f),m={annotationUID:bt(),data:{contour:{closed:!0,polyline:g},segmentation:{segmentationId:r,segmentIndex:s,color:d,id:h},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:p,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:t.getFrameOfReferenceUID(),viewPlaneNormal:t.getCamera().viewPlaneNormal}},v=t.element;U0(m,v),Ml(m)}),c&&i.set(s,c)}),t.resetCamera(),t.render()}function Fee(t,e=5){return parseFloat(t[0]).toFixed(e)+","+parseFloat(t[1]).toFixed(e)+","+parseFloat(t[2]).toFixed(e)+","}const fD=_a(),jh=new Map,Kh=new Map,Xf=(t,e)=>{Z(t,X.WEB_WORKER_PROGRESS,{progress:e,type:Uo.SURFACE_CLIPPING})};async function gD(t,e){var o;cD();const n=(o=e.getSlicesClippingPlanes)==null?void 0:o.call(e);if(!n)return;const r=e.getSliceIndex();n.sort((s,c)=>{const l=Math.abs(s.sliceIndex-r),f=Math.abs(c.sliceIndex-r);return l-f}),Xf(Y,0),await Uee(t);const i=new Map;t.forEach(s=>{i.set(s.id,Kh.get(s.id))});const a=e.getCamera();return await fD.executeTask("polySeg","cutSurfacesIntoPlanes",{surfacesInfo:t,planesInfo:n,surfacesAABB:i},{callbacks:[({progress:s})=>{Xf(Y,s)},({sliceIndex:s,polyDataResults:c})=>{c.forEach((l,f)=>{const u=Number(f),g=Aee(e,a.viewPlaneNormal,s);Bee(u,g,l)})}]}).catch(s=>{console.error(s)}),Xf(Y,100),jh}async function Uee(t){const e=t.filter(r=>!Kh.has(r.id));if(!e.length)return;(await fD.executeTask("polySeg","getSurfacesAABBs",{surfacesInfo:e},{callbacks:[({progress:r})=>{Xf(Y,r)}]})).forEach((r,i)=>{Kh.set(i,r)})}function Aee(t,e,n){return`${t.id}-${Fee(e)}-${n}`}function Bee(t,e,n){const{points:r,lines:i,numberOfCells:a}=n;let o=jh.get(t);o||(o=new Map,jh.set(t,o)),o.set(e,{points:r,lines:i,numberOfCells:a})}function dD(t){const e=new Map;for(const[n,r]of t){const i=Number(n);for(const[a,o]of r)o&&(e.has(i)||e.set(i,[]),e.get(i).push(o))}return e}const{CalibrationTypes:oc}=La,qa="px",Gee=[1],Wee=["3,3"],$ee={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm²",9:"cm²/s",12:"degrees"},zee=.001,sc="²",Hee=(t,e)=>{const{calibration:n,hasPixelSpacing:r}=t;let i=r?"mm":qa,a=i+sc,o=1,s="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{unit:i,areaUnit:a,scale:o};if(n.type===oc.UNCALIBRATED)return{unit:qa,areaUnit:qa+sc,scale:o};if(n.sequenceOfUltrasoundRegions){let l,f;if(Array.isArray(e)&&e.length===2)[l,f]=e;else if(typeof e=="function"){const m=e();l=m[0],f=m[1]}let u=n.sequenceOfUltrasoundRegions.filter(m=>l[0]>=m.regionLocationMinX0&&l[0]<=m.regionLocationMaxX1&&l[1]>=m.regionLocationMinY0&&l[1]<=m.regionLocationMaxY1&&f[0]>=m.regionLocationMinX0&&f[0]<=m.regionLocationMaxX1&&f[1]>=m.regionLocationMinY0&&f[1]<=m.regionLocationMaxY1);if(!(u!=null&&u.length))return{unit:i,areaUnit:a,scale:o};if(u=u.filter(m=>Gee.includes(m.regionDataType)&&Wee.includes(`${m.physicalUnitsXDirection},${m.physicalUnitsYDirection}`)),!u.length)return{unit:qa,areaUnit:qa+sc,scale:o};const g=u[0],d=Math.abs(g.physicalDeltaX),h=Math.abs(g.physicalDeltaY);if(Vt(d,h,zee))o=1/d,s="US Region",i=$ee[g.physicalUnitsXDirection]||"unknown",a=i+sc;else return{unit:qa,areaUnit:qa+sc,scale:o}}else n.scale&&(o=n.scale);return[oc.ERMF,oc.USER,oc.ERROR,oc.PROJECTION].includes(n==null?void 0:n.type)&&(s=n.type),{unit:i+(s?` ${s}`:""),areaUnit:a+(s?` ${s}`:""),scale:o}};function jee(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}class Kee{}const{PointsManager:K6}=ba,ue=class ue extends Kee{static statsInit(e){e.storePointData||(ue.pointsInShape=null)}};ue.max=[-1/0],ue.min=[1/0],ue.sum=[0],ue.count=0,ue.runMean=[0],ue.m2=[0],ue.pointsInShape=K6.create3(1024),ue.statsCallback=({value:e,pointLPS:n=null})=>{var i;Array.isArray(e)&&e.length>1&&ue.max.length===1&&(ue.max.push(ue.max[0],ue.max[0]),ue.min.push(ue.min[0],ue.min[0]),ue.sum.push(ue.sum[0],ue.sum[0]),ue.runMean.push(0,0),ue.m2.push(ue.m2[0],ue.m2[0])),(i=ue.pointsInShape)==null||i.push(n);const r=Array.isArray(e)?e:[e];ue.count+=1,ue.max.map((a,o)=>{const s=r[o],c=s-ue.runMean[o];ue.sum[o]+=s,ue.runMean[o]+=c/ue.count;const l=s-ue.runMean[o];ue.m2[o]+=c*l,ue.min[o]=Math.min(ue.min[o],s),ue.max[o]=Math.max(a,s)})},ue.getStatistics=e=>{const n=ue.sum.map(o=>o/ue.count),r=ue.m2.map(o=>Math.sqrt(o/ue.count)),i=(e==null?void 0:e.unit)||null,a={max:{name:"max",label:"Max Pixel",value:cf(ue.max),unit:i},min:{name:"min",label:"Min Pixel",value:cf(ue.min),unit:i},mean:{name:"mean",label:"Mean Pixel",value:cf(n),unit:i},stdDev:{name:"stdDev",label:"Standard Deviation",value:cf(r),unit:i},count:{name:"count",label:"Pixel Count",value:ue.count,unit:null},pointsInShape:ue.pointsInShape,array:[]};return a.array.push(a.max,a.mean,a.stdDev,a.stdDev,a.count),ue.max=[-1/0],ue.min=[1/0],ue.sum=[0],ue.m2=[0],ue.runMean=[0],ue.count=0,ue.pointsInShape=K6.create3(1024),a};let qh=ue;function cf(t){return t.length===1?t[0]:t}function Bo(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[n,r,i=0]=t,[a,o,s=0]=e,c=a-n,l=o-r,f=s-i;return c*c+l*l+f*f}function pD(t,e){return Math.sqrt(Bo(t,e))}function qee(t,e,n){let r;const i=Bo(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(r=t),!r){const a=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/i;a<0?r=t:a>1?r=e:r=[t[0]+a*(e[0]-t[0]),t[1]+a*(e[1]-t[1])]}return{point:[...r],distanceSquared:Bo(n,r)}}function Xee(t,e,n){return qee(t,e,n).distanceSquared}const cc=.01;function X2(t,e,n){const r=t[0]<=e[0]?t[0]:e[0],i=t[0]>=e[0]?t[0]:e[0],a=t[1]<=e[1]?t[1]:e[1],o=t[1]>=e[1]?t[1]:e[1];if(!(n[0]>=r-cc&&n[0]<=i+cc&&n[1]>=a-cc&&n[1]<=o+cc))return!1;const c=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return(c>=0?c:-c)<=cc}function hD(t){if(t.length<3)return!1;const e=t.length,n=t[0],r=t[e-1],i=Bo(n,r);return fl(0,i)}function Go(t,e,n={closed:void 0}){if(t.length<3)return!1;const r=t.length;let i=0;const{closed:a,holes:o}=n;if(o!=null&&o.length){for(const l of o)if(Go(l,e))return!1}const s=!(a===void 0?hD(t):a),c=t.length-(s?1:2);for(let l=0;l<=c;l++){const f=t[l],u=l===r-1?0:l+1,g=t[u],d=f[0]>=g[0]?f[0]:g[0],h=f[1]>=g[1]?f[1]:g[1],p=f[1]<=g[1]?f[1]:g[1];if(e[0]<=d&&e[1]>=p&&e[1]<h){let y=f[0]===g[0];if(!y){const C=(e[1]-f[1])*(g[0]-f[0])/(g[1]-f[1])+f[0];y=e[0]<=C}i+=y?1:0}}return!!(i%2)}function Pm(t,e){for(let n=0,r=e.length;n<r;n++)if(!Go(t,e[n]))return!1;return!0}function mg(t,e){let n=t;const r=(e==null?void 0:e.numDimensions)||2,i=r===3;if(!Array.isArray(t[0])){const u=t,g=u.length/r;n=new Array(u.length/r);for(let d=0,h=g;d<h;d++)n[d]=[u[d*r],u[d*r+1]],i&&n[d].push(u[d*r+2])}let a=1/0,o=1/0,s=-1/0,c=-1/0,l=1/0,f=-1/0;n=n;for(let u=0,g=n.length;u<g;u++){const[d,h,p]=n[u];a=a<d?a:d,o=o<h?o:h,s=s>d?s:d,c=c>h?c:h,i&&(l=l<p?l:p,f=f>p?f:p)}return i?{minX:a,maxX:s,minY:o,maxY:c,minZ:l,maxZ:f}:{minX:a,maxX:s,minY:o,maxY:c}}function km(t){const e=t.length;let n=0,r=e-1;for(let i=0;i<e;i++)n+=(t[r][0]+t[i][0])*(t[r][1]-t[i][1]),r=i;return Math.abs(n/2)}function Fm(t){if(t.length<3)return 0;const e=t[0];let n=0;for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-e[0],l=a[1]-e[1],f=s[0]-e[0],u=s[1]-e[1];n+=c*u-l*f}return n*=.5,n}function Yf(t){return Fm(t)>=0?1:-1}function Yee(t){const e=te(),n=t[0];for(let r=0,i=t.length;r<i;r++){const a=t[r],o=r===i-1?0:r+1,s=t[o],c=a[0]-n[0],l=a[1]-n[1],f=a[2]-n[2],u=s[0]-n[0],g=s[1]-n[1],d=s[2]-n[2];e[0]+=l*d-f*g,e[1]+=f*u-c*d,e[2]+=c*g-l*u}return Hn(e,e,.5),e}function Zee(t){const e=Yee(t);return $t(e,e)}function Ll(t){const e=Fm(t);return[0,0,e/Math.abs(e)]}function Um(t,e,n,r){let i=!1;const a=t[0]<e[0]?t[0]:e[0],o=t[1]<e[1]?t[1]:e[1],s=t[0]>e[0]?t[0]:e[0],c=t[1]>e[1]?t[1]:e[1],l=n[0]<r[0]?n[0]:r[0],f=n[1]<r[1]?n[1]:r[1],u=n[0]>r[0]?n[0]:r[0],g=n[1]>r[1]?n[1]:r[1];if(a>u||s<l||o>g||c<f)return!1;const d=[lf(t,e,n),lf(t,e,r),lf(n,r,t),lf(n,r,e)];return d[0]!==d[1]&&d[2]!==d[3]?!0:((d[0]===0&&uf(t,n,e)||d[1]===0&&uf(t,r,e)||d[2]===0&&uf(n,t,r)||d[3]===0&&uf(n,e,r))&&(i=!0),i)}function lf(t,e,n){const r=(e[1]-t[1])*(n[0]-e[0])-(e[0]-t[0])*(n[1]-e[1]);return r===0?0:r>0?1:2}function uf(t,e,n){return e[0]<=Math.max(t[0],n[0])&&e[0]>=Math.min(t[0],n[0])&&e[1]<=Math.max(t[1],n[1])&&e[1]>=Math.min(t[1],n[1])}function Am(t,e,n,r=!0){const i=[],a=t.length,o=a-(r?1:2);for(let s=0;s<=o;s++){const c=t[s],l=s===a-1?0:s+1,f=t[l];Um(e,n,c,f)&&i.push([s,l])}return i}const Jee=.01;function mD(t,e,n,r){const i=[e[0]-t[0],e[1]-t[1]],a=[r[0]-n[0],r[1]-n[1]],o=a[1]*i[0]-a[0]*i[1];if((o>=0?o:-o)<Jee){const h=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],p=[n[0]<r[0]?n[0]:r[0],n[0]>r[0]?n[0]:r[0],n[1]<r[1]?n[1]:r[1],n[1]>r[1]?n[1]:r[1]];if(!(h[0]<=p[1]&&h[1]>=p[0]&&h[2]<=p[3]&&h[3]>=p[2])||!(X2(t,e,n)||X2(t,e,r)||X2(n,r,t)))return;const y=h[0]>p[0]?h[0]:p[0],C=h[1]<p[1]?h[1]:p[1],T=h[2]>p[2]?h[2]:p[2],S=h[3]<p[3]?h[3]:p[3],x=(y+C)*.5,w=(T+S)*.5;return[x,w]}let c=t[1]-n[1],l=t[0]-n[0];const f=a[0]*c-a[1]*l,u=i[0]*c-i[1]*l;c=f/o,l=u/o;const g=t[0]+c*i[0],d=t[1]+c*i[1];return[g,d]}var Eo;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(Eo||(Eo={}));var qs;(function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"})(qs||(qs={}));var Ms;(function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"})(Ms||(Ms={}));function q6(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];r.next||(r.next=t[e===n-1?0:e+1])}}function vD(t,e){const n=[],r=[],i=new Map;let o=Go(e,t[0])?Ms.Exiting:Ms.Entering;for(let s=0,c=t.length;s<c;s++){const l=t[s],f=Go(e,l),u={type:Eo.Vertex,coordinates:l,position:f?qs.Inside:qs.Outside,visited:!1,next:null};n.push(u);const g=t[s===c-1?0:s+1],d=Am(e,l,g).map(h=>{const p=h[0],m=e[h[0]],v=e[h[1]],y=mD(l,g,m,v),C=Bo(l,y);return{sourceLineSegmentId:p,coordinate:y,targetStartPointDistSquared:C}});d.sort((h,p)=>h.targetStartPointDistSquared-p.targetStartPointDistSquared),d.forEach(h=>{const{sourceLineSegmentId:p,coordinate:m}=h,v={type:Eo.Intersection,coordinates:m,position:qs.Edge,direction:o,visited:!1,next:null},y={...v,direction:Ms.Unknown,cloned:!0};o===Ms.Entering?v.next=y:y.next=v;let C=i.get(p);C||(C=[],i.set(p,C)),n.push(v),C.push(y),o*=-1})}for(let s=0,c=e.length;s<c;s++){const l=s,f=e[s],u={type:Eo.Vertex,coordinates:f,visited:!1,next:null};r.push(u);const g=i.get(l);g!=null&&g.length&&g.map(d=>({intersectionPoint:d,lineSegStartDistSquared:Bo(f,d.coordinates)})).sort((d,h)=>d.lineSegStartDistSquared-h.lineSegStartDistSquared).map(({intersectionPoint:d})=>d).forEach(d=>r.push(d))}return q6(n),q6(r),{targetPolylinePoints:n,sourcePolylinePoints:r}}function yD(t){for(let e=0,n=t.length;e<n;e++){const r=t[e];if(!r.visited&&r.position===qs.Outside)return r}}function CD(t,e){const n=Ll(t),r=Ll(e),i=fe(r,n);fl(1,i)||(e=e.slice().reverse());const{targetPolylinePoints:a}=vD(t,e),o=yD(a);if(!o)return t.slice();const s=[o.coordinates];let c=o.next;for(;c!==o;){if(c.type===Eo.Intersection&&c.cloned){c=c.next;continue}s.push(c.coordinates),c=c.next}return s}function TD(t,e){const n=Ll(t),r=Ll(e),i=fe(r,n);fl(-1,i)||(e=e.slice().reverse());const{targetPolylinePoints:a}=vD(t,e);let o=null;const s=[];for(;o=yD(a);){const c=[o.coordinates];let l=o.next;for(o.visited=!0;l!==o;){if(l.visited=!0,l.type===Eo.Intersection&&l.cloned){l=l.next;continue}c.push(l.coordinates),l=l.next}s.push(c)}return s}function SD(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);for(let o=i;o<t.length;o++){const s=t[a],c=t[o];if(Um(e,n,s,c))return[a,o];a=o}}function xD(t,e){for(let n=0,r=t.length;n<r;n++){const i=t[n],a=n===r-1?0:n+1,o=t[a],s=SD(e,i,o);if((s==null?void 0:s.length)===2)return!0}return!1}const Qee=.1;function wD(t,e=Qee){const n=t.length;if(n<3)return t;const r=e*e,i=[[0,n-1]],a=new Array(n).fill(!1);let o=2;for(a[0]=!0,a[n-1]=!0;i.length;){const[c,l]=i.pop();if(l-c===1)continue;const f=t[c],u=t[l];let g=-1/0,d=-1;for(let h=c+1;h<l;h++){const p=t[h],m=Xee(f,u,p);m>g&&(g=m,d=h)}g<r||(a[d]=!0,o++,i.push([d,l]),i.push([c,d]))}const s=new Array(o);for(let c=0,l=0;c<n;c++)a[c]&&(s[l++]=t[c]);return s}function ED(t,e,n,r=!0){const i=[],a=Am(t,e,n,r);for(let o=0;o<a.length;o++){const s=t[a[o][0]],c=t[a[o][1]],l=mD(e,n,s,c);i.push(l)}return i}function ete(t,e,n,r=!0){let i,a;r?(a=t.length-1,i=0):(a=0,i=1);const o=[];for(let f=i;f<t.length;f++){const u=t[a],g=t[f];Um(e,n,u,g)&&o.push([a,f]),a=f}if(o.length===0)return;const s=[];o.forEach(f=>{const u=[t[f[0]],t[f[1]]],g=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2];s.push(qt(g,e))});const c=Math.min(...s),l=s.indexOf(c);return{segment:o[l],distance:c}}const ss=.001,tte=(t,e)=>{let n,r,i;if(t instanceof fr){const o=t.getImageData();r=o.direction.slice(0,3),i=o.direction.slice(3,6),n=o.spacing}else{const o=t.getImageData(),{direction:s,spacing:c}=o,{viewPlaneNormal:l,viewUp:f}=t.getCamera(),u=s.slice(0,3),g=s.slice(3,6),d=s.slice(6,9),h=te();vt(h,f,l);const p=Math.abs(fe(h,u)),m=Math.abs(fe(h,g)),v=Math.abs(fe(h,d));let y;if(Math.abs(1-p)<ss)y=c[0],r=u;else if(Math.abs(1-m)<ss)y=c[1],r=g;else if(Math.abs(1-v)<ss)y=c[2],r=d;else throw new Error("No support yet for oblique plane planar contours");const C=Math.abs(fe(f,u)),T=Math.abs(fe(f,g)),S=Math.abs(fe(f,d));let x;if(Math.abs(1-C)<ss)x=c[0],i=u;else if(Math.abs(1-T)<ss)x=c[1],i=g;else if(Math.abs(1-S)<ss)x=c[2],i=d;else throw new Error("No support yet for oblique plane planar contours");n=[y,x]}return{spacing:[n[0]/e,n[1]/e],xDir:r,yDir:i}},nte=(t,e,n)=>s3(t,e)<n,rte=(t,e,n,r)=>{const{xDir:i,yDir:a,spacing:o}=r,s=le(t),{viewport:c}=s;if(!e.length)return e.push(n),console.log(">>>>> !canvasPoints. :: RETURN"),1;const l=c.canvasToWorld(e[e.length-1]),f=c.canvasToWorld(n),u=te();rt(u,f,l);const g=Math.abs(fe(u,i)),d=Math.abs(fe(u,a)),h=Math.max(Math.floor(g/o[0]),Math.floor(d/o[0]));if(h>1){const p=e[e.length-1],m=s3(p,n),v=Si();c0(v,n,p),As(v,v[0]/m,v[1]/m);const y=m/h;for(let C=1;C<=h;C++)e.push([p[0]+y*v[0]*C,p[1]+y*v[1]*C])}else e.push(n);return h},ite=(t,e,n,r)=>{const i=[t[0]-e[0],t[1]-e[1]],a=[n[0]-e[0],n[1]-e[1]],o=i[0]*a[0]+i[1]*a[1];if(o<0)return!1;const s=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(s===0)return!1;const c=o/s,l=[a[0]/s,a[1]/s],f=[l[0]*c,l[1]*c],u=[e[0]+f[0],e[1]+f[1]];return!(qt(t,u)>r||qt(e,u)>qt(e,n))},ate=1e-6;function OD(t){let e;const n=DE(t,50);for(let o=0;o<3;o++)if(n.every((s,c,l)=>Math.abs(s[o]-l[0][o])<ate)){e=o;break}if(e===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const r=[],i=(e+1)%3,a=(e+2)%3;for(let o=0;o<t.length;o++)r.push([t[o][i],t[o][a]]);return{sharedDimensionIndex:e,projectedPolyline:r}}function ote(t,e,n={}){const{sharedDimensionIndex:r,projectedPolyline:i}=OD(e),{holes:a}=n,o=[];if(a)for(let c=0;c<a.length;c++){const l=a[c],f=[];for(let u=0;u<l.length;u++)f.push([l[u][(r+1)%3],l[u][(r+2)%3]]);o.push(f)}const s=[t[(r+1)%3],t[(r+2)%3]];return Go(i,s,{holes:o})}const Xo=Object.freeze(Object.defineProperty({__proto__:null,addCanvasPointsToArray:rte,containsPoint:Go,containsPoints:Pm,decimate:wD,getAABB:mg,getArea:km,getClosestLineSegmentIntersection:ete,getFirstLineSegmentIntersectionIndexes:SD,getLineSegmentIntersectionsCoordinates:ED,getLineSegmentIntersectionsIndexes:Am,getNormal2:Ll,getNormal3:Zee,getSignedArea:Fm,getSubPixelSpacingAndXYDirections:tte,getWindingDirection:Yf,intersectPolyline:xD,isClosed:hD,isPointInsidePolyline3D:ote,mergePolylines:CD,pointCanProjectOnLine:ite,pointsAreWithinCloseContourProximity:nte,projectTo2D:OD,subtractPolylines:TD},Symbol.toStringTag,{value:"Module"}));function X6(t,e){let n=[0,0],r=Number.MAX_SAFE_INTEGER;return t.forEach(function(i){const a=ste(e,i);a<r&&(r=a,n=[...i])}),n}function ste(t,e){const[n,r]=t,[i,a]=e;return Math.sqrt(Math.pow(n-i,2)+Math.pow(r-a,2))}const{EPSILON:cte}=SC,lte=1-cte;function ute(t,e,n){const{viewPlaneNormal:r}=e,i=t.filter(c=>{let l=c.metadata.viewPlaneNormal;if(!l){const{referencedImageId:u}=c.metadata,{imageOrientationPatient:g}=ee("imagePlaneModule",u),d=Ze(g[0],g[1],g[2]),h=Ze(g[3],g[4],g[5]);l=te(),vt(l,d,h),c.metadata.viewPlaneNormal=l}const f=Math.abs(fe(r,l))>lte;return l&&f});if(!i.length)return[];const a=n/2,{focalPoint:o}=e,s=[];for(const c of i){const f=c.data.handles.points[0];if(!c.isVisible)continue;const u=te();_t(u,o,f);const g=fe(u,r);Math.abs(g)<a&&s.push(c)}return s}function DD(t,e,n={}){if(t instanceof Rn){const r=t.getCamera(),{spacingInNormalDirection:i}=Xl(t,r);return ute(e,r,i)}if(t instanceof fr){const r=t.getCurrentImageId(),i=r.indexOf(":");n.imageURI=r.substring(i+1)}return e.filter(r=>r.isVisible?r.data.isCanvasAnnotation?!0:t.isReferenceViewable(r.metadata,n):!1)}function fte(t,e,n){let r=!0,i=!0;if(typeof t!="function")throw new TypeError("Expected a function");return oD(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),sD(t,e,{leading:r,trailing:i,maxWait:e})}function gte(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i];a.getFrameOfReferenceUID()===e&&r.push(a)}return r}const{Active:dte,Passive:pte,Enabled:hte}=Qe;function mte(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const a=t[i],o=yn(a.id,a.renderingEngineId);if(!o)continue;vte(o,e)&&r.push(a)}return r}function vte(t,e){const{toolOptions:n}=t,r=n[e];if(!r)return!1;const i=r.mode;return i===dte||i===pte||i===hte}function yte(t,e,n=.999){return t.filter(r=>{const i=r.getCamera();return Math.abs(fe(i.viewPlaneNormal,e.viewPlaneNormal))>n})}function Wc(t,e,n=!0){const r=le(t),{renderingEngine:i,FrameOfReferenceUID:a}=r;let o=i.getViewports();o=gte(o,a),o=mte(o,e);const s=i.getViewport(r.viewportId);return n&&(o=yte(o,s.getCamera())),o.map(l=>l.id)}const Cte="viewport-element";function Tte(t){const e=le(t),{viewportId:n,renderingEngineId:r}=e,i=`${n}:${r}`,a=Ste(t);return Object.keys(ce.svgNodeCache[i]).forEach(o=>{ce.svgNodeCache[i][o].touched=!1}),{svgLayerElement:a,svgNodeCacheForCanvas:ce.svgNodeCache,getSvgNode:xte.bind(this,i),appendNode:wte.bind(this,a,i),setNodeTouched:Ete.bind(this,i),clearUntouched:Ote.bind(this,a,i)}}function Ste(t){const e=`.${Cte}`,n=t.querySelector(e);return n==null?void 0:n.querySelector(":scope > .svg-layer")}function xte(t,e){if(ce.svgNodeCache[t]&&ce.svgNodeCache[t][e])return ce.svgNodeCache[t][e].domRef}function wte(t,e,n,r){if(!ce.svgNodeCache[e])return null;ce.svgNodeCache[e][r]={touched:!0,domRef:n},t.appendChild(n)}function Ete(t,e){ce.svgNodeCache[t]&&ce.svgNodeCache[t][e]&&(ce.svgNodeCache[t][e].touched=!0)}function Ote(t,e){ce.svgNodeCache[e]&&Object.keys(ce.svgNodeCache[e]).forEach(n=>{const r=ce.svgNodeCache[e][n];!r.touched&&r.domRef&&(t.removeChild(r.domRef),delete ce.svgNodeCache[e][n])})}function Dte(t,e){const n=Tte(t);e(n),n.clearUntouched()}function tu(t,e,n){return`${t}::${e}::${n}`}function Wo(t,e){Object.keys(t).forEach(n=>{const r=e.getAttribute(n),i=t[n];i===void 0||i===""?e.removeAttribute(n):r!==i&&e.setAttribute(n,i)})}function vd(t,e){Object.keys(t).forEach(n=>{const r=t[n];r!==void 0&&r!==""&&e.setAttribute(n,r)})}function Rte(t,e,n,r,i={},a){const{color:o,handleRadius:s,width:c,lineWidth:l,fill:f,type:u,opacity:g}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),d=l||c,h="http://www.w3.org/2000/svg",p=tu(e,"handle",`hg-${n}-index-${a}`);let m;if(u==="circle")m={cx:`${r[0]}`,cy:`${r[1]}`,r:s,stroke:o,fill:f,"stroke-width":d,opacity:g};else if(u==="rect"){const C=parseFloat(s)*1.5,T=r[0]-C*.5,S=r[1]-C*.5;m={x:`${T}`,y:`${S}`,width:`${C}`,height:`${C}`,stroke:o,fill:f,"stroke-width":d,rx:`${C*.1}`,opacity:g}}else throw new Error(`Unsupported handle type: ${u}`);const v=t.getSvgNode(p);if(v)Wo(m,v),t.setNodeTouched(p);else{const y=document.createElementNS(h,u);vd(m,y),t.appendNode(y,p)}}function Xh(t,e,n,r,i={}){r.forEach((a,o)=>{Rte(t,e,n,a,i,o)})}function Mte(t,e,n,r,i,a={},o=""){if(isNaN(r[0])||isNaN(r[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s,width:c,lineWidth:l,lineDash:f,shadow:u}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0,shadow:void 0},a),g=l||c,d="http://www.w3.org/2000/svg",h=tu(e,"line",n),p=t.getSvgNode(h),m=u?`filter:url(#shadow-${t.svgLayerElement.id});`:"",v={x1:`${r[0]}`,y1:`${r[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:s,style:m,"stroke-width":g,"stroke-dasharray":f};if(p)Wo(v,p),t.setNodeTouched(h);else{const y=document.createElementNS(d,"line");o!==""&&y.setAttribute("data-id",o),vd(v,y),t.appendNode(y,h)}}function S0(t,e,n,r,i){if(r.length<2)return;const{color:a="rgb(0, 255, 0)",width:o=10,fillColor:s="none",fillOpacity:c=0,lineWidth:l,lineDash:f,closePath:u=!1}=i,g=l||o,d="http://www.w3.org/2000/svg",h=tu(e,"polyline",n),p=t.getSvgNode(h);let m="";for(const y of r)m+=`${y[0].toFixed(1)}, ${y[1].toFixed(1)} `;if(u){const y=r[0];m+=`${y[0]}, ${y[1]}`}const v={points:m,stroke:a,fill:s,"fill-opacity":c,"stroke-width":g,"stroke-dasharray":f};if(p)Wo(v,p),t.setNodeTouched(h);else{const y=document.createElementNS(d,"polyline");vd(v,y),t.appendNode(y,h)}}function Xs(t,e,n,r,i){const o=r.length&&r[0].length&&Array.isArray(r[0][0])?r:[r],{color:s="rgb(0, 255, 0)",width:c=10,fillColor:l="none",fillOpacity:f=0,lineWidth:u,lineDash:g,closePath:d=!1}=i,h=u||c,p="http://www.w3.org/2000/svg",m=tu(e,"path",n),v=t.getSvgNode(m);let y="";for(let T=0,S=o.length;T<S;T++){const x=o[T],w=x.length;if(!(w<2)){for(let E=0;E<w;E++){const M=x[E];y+=`${E?"L":"M"} ${M[0].toFixed(1)}, ${M[1].toFixed(1)} `}d&&(y+="Z ")}}if(!y)return;const C={d:y,stroke:s,fill:l,"fill-opacity":f,"stroke-width":h,"stroke-dasharray":g};if(v)Wo(C,v),t.setNodeTouched(m);else{const T=document.createElementNS(p,"path");vd(C,T),t.appendNode(T,m)}}function Lte(t,e,n,r,i,a={}){const o=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},a);return Ite(t,e,n,r,i,o)}function Ite(t,e,n,r=[""],i,a){const{padding:o,color:s,fontFamily:c,fontSize:l,background:f}=a;let u;const[g,d]=[i[0]+o,i[1]+o],h="http://www.w3.org/2000/svg",p=tu(e,"text",n),m=t.getSvgNode(p);if(m){const v=m.querySelector("text"),y=Array.from(v.children);for(let S=0;S<y.length;S++){const x=y[S],w=r[S]||"";x.textContent=w}if(r.length>y.length){for(let S=0;S<r.length-y.length;S++){const x=r[S+y.length],w=Y6(x);v.appendChild(w)}m.appendChild(v),t.appendNode(m,p)}const C={fill:s,"font-size":l,"font-family":c},T={transform:`translate(${g} ${d})`};Wo(C,v),Wo(T,m),u=Z6(m,f),t.setNodeTouched(p)}else{const v=document.createElementNS(h,"g");v.setAttribute("transform",`translate(${g} ${d})`);const y=Vte(t,a);for(let C=0;C<r.length;C++){const T=r[C],S=Y6(T);y.appendChild(S)}v.appendChild(y),t.appendNode(v,p),u=Z6(v,f)}return Object.assign({},u,{x:g,y:d,height:u.height+o,width:u.width+o})}function Vte(t,e){const{color:n,fontFamily:r,fontSize:i}=e,o=document.createElementNS("http://www.w3.org/2000/svg","text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",c=`filter:url(#shadow-${t.svgLayerElement.id});`,l=`${s}${c}`;return o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("fill",n),o.setAttribute("font-family",r),o.setAttribute("font-size",i),o.setAttribute("style",l),o}function Y6(t){const n=document.createElementNS("http://www.w3.org/2000/svg","tspan");return n.setAttribute("x","0"),n.setAttribute("dy","1.2em"),n.textContent=t,n}function Z6(t,e){let n=t.querySelector("rect.background");if(!e)return n&&t.removeChild(n),t.getBBox();n||(n=document.createElementNS("http://www.w3.org/2000/svg","rect"),n.setAttribute("class","background"),t.insertBefore(n,t.firstChild));const r=t.getBBox(),i={x:`${r.x}`,y:`${r.y}`,width:`${r.width}`,height:`${r.height}`,fill:e};return Wo(i,n),r}function _te(t,e,n,r,i,a,o={}){const s=r.length>0?X6(r,i):i,c=bte(a),l=X6(c,s),f=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},o);Mte(t,e,`link-${n}`,s,l,f)}function bte(t){const{x:e,y:n,height:r,width:i}=t,a=i/2,o=r/2,s=[e+a,n],c=[e,n+o],l=[e+a,n+r],f=[e+i,n+o];return[s,c,l,f]}function Nte(t,e,n,r,i,a,o,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),l=Lte(t,e,n,r,i,c);return _te(t,e,n,a,i,l,c),l}function Pte(t,e){const n=le(t),{renderingEngineId:r,viewportId:i}=n,a=yn(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l];if(f&&e.includes(f.mode)){const u=a.getToolInstance(l);o.push(u)}}return o}const{Active:kte,Passive:Fte,Enabled:Ute}=Qe;class Ate{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let n=0;n<e.length;n++){const r=e[n];if(this._needsRender.has(r)&&(this._triggerRender(r),this._needsRender.delete(r),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,n){this._viewportElements.set(e,n)}removeViewportElement(e,n){this._viewportElements.delete(e),this._needsRender.delete(n),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(n=>{this._needsRender.add(n)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const n=[...this._viewportElements.values()];e.forEach(r=>{n.indexOf(r)!==-1&&this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const n=le(e);if(!n)return;if(!Va(n.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const i=Pte(e,[kte,Fte,Ute]),{renderingEngineId:a,viewportId:o}=n,s={element:e,renderingEngineId:a,viewportId:o};Dte(e,c=>{let l=!1;const f=u=>{if(u.renderAnnotation){const g=u.renderAnnotation(n,c);l=l||g}};i.forEach(f),l&&Z(e,H.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}const Bm=new Ate;function nu(t){Bm.renderViewport(t)}function Vn(t){t.length&&t.forEach(e=>{const n=en(e);if(!n){console.warn(`Viewport not available for ${e}`);return}const{viewport:r}=n;if(!r){console.warn(`Viewport not available for ${e}`);return}const i=r.element;nu(i)})}function Bte(t){var e;return((e=t[0])==null?void 0:e.length)===3}function Gte(t,e){if(!e||e.length===0||e.length===t.length)return t;const n=e[e.length-1]-e[0]+1,r=b2(e.map(a=>t[a][0])),i=b2(e.map(a=>t[a][1]));if(Bte(t)){const a=b2(e.map(o=>t[o][2]));return Xv(ic(r,n),ic(i,n),ic(a,n))}else return Xv(ic(r,n),ic(i,n))}function Wte(t,e){const n=[],[r,i]=e,a=i-r+1,o=Math.floor(a/t);let s=0,c=Math.round((a-1)/(o-1)*s)+r;for(;c<=i;)n.push(c),s++,c=Math.round((a-1)/(o-1)*s)+r;return n}function $te(t,e,n,r){const i=n-e+1,a=Math.floor(r/100*i)??1,o=Math.floor(i/a)??1;if(isNaN(i)||!i||!o||i/o<2)return t;const s=Math.max(0,e),c=Math.min(t.length-1,n),l=t.slice(0,s),f=t.slice(c+1,t.length),u=Wte(o,[s,c]),g=Gte(t,u);return[...l,...g,...f]}function yd(t,e){var r,i;return e!=null&&e.autoGenerated?!1:((r=t==null?void 0:t.smoothing)==null?void 0:r.smoothOnAdd)===!0||((i=t==null?void 0:t.smoothing)==null?void 0:i.smoothOnEdit)===!0}function zte(t,e){return pD(t,e)<.001}function Hte(t,e){return pD(t,e)===0}function jte(t,e){for(let n=0;n<t.length;n++)for(let r=0;r<e.length;r++)if(Hte(t[n],e[r]))return[n,r]}function Ls(t,e,n){return(t+e+n)%e}function J6(t,e,n,r){const[,i,a]=t,[,o,s]=e,c=a.length,l=s.length;let f=t[0],u=e[0];if(!a[f]||!s[u]||!a[i]||!s[o])return[void 0,void 0];for(;f!==i&&u!==o;){if(n(s[u],a[f]))return[f,u];f=Ls(f,c,r),u=Ls(u,l,r)}return[void 0,void 0]}function Kte(t,e){const[n,r]=jte(t,e)||[],i=(c,l)=>zte(c,l)===!1,[a,o]=J6([Ls(n,t.length,1),n,t],[Ls(r,e.length,1),r,e],i,1),[s]=J6([Ls(a,t.length,-1),a,t],[Ls(o,e.length,-1),o,e],i,-1);return[a,s]}function Cd(t,e,n){const{interpolation:r,smoothing:i}=t,a=e;if(r){const{knotsRatioPercentageOnAdd:o,knotsRatioPercentageOnEdit:s,smoothOnAdd:c=!1,smoothOnEdit:l=!1}=i,f=n?s:o;if(n?l:c){const[g,d]=n?Kte(e,n):[0,e.length-1];return!e[g]||!e[d]?e:$te(e,g,d,f)}}return a}const Td=t=>{if(t.shiftKey)return t.ctrlKey?$n.ShiftCtrl:t.altKey?$n.ShiftAlt:t.metaKey?$n.ShiftMeta:$n.Shift;if(t.ctrlKey)return t.altKey?$n.CtrlAlt:t.metaKey?$n.CtrlMeta:$n.Ctrl;if(t.altKey)return t.metaKey&&$n.AltMeta||$n.Alt;if(t.metaKey)return $n.Meta};function Gm(t,e){const n=t[0],r=t[t.length-1],i=Si();As(i,r[0]-n[0],r[1]-n[1]),uC(i,i);const a=Si(),o=Si();As(a,-i[1],i[0]),As(o,i[1],-i[0]);const s=[(n[0]+r[0])/2,(n[1]+r[1])/2],c={dist:0,index:null};for(let u=0;u<t.length;u++){const g=t[u],d=s3(g,s);d>c.dist&&(c.dist=d,c.index=u)}return[t[c.index],s].map(e.canvasToWorld)}function qte(t,e){const{viewport:n}=t,r=e.data.contour.polyline.map(n.worldToCanvas);return Gm(r,n)}var x0;(function(t){t[t.CounterClockwise=-1]="CounterClockwise",t[t.Unknown=0]="Unknown",t[t.Clockwise=1]="Clockwise"})(x0||(x0={}));const{addCanvasPointsToArray:Wm,pointsAreWithinCloseContourProximity:RD,getFirstLineSegmentIntersectionIndexes:MD,getSubPixelSpacingAndXYDirections:Xte}=Xo;function Yte(t,e,n){this.isDrawing=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=le(a),{viewport:c}=s,l=Td(t.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:f,xDir:u,yDir:g}=Xte(c,this.configuration.subPixelResolution);this.drawData={canvasPoints:[o],polylineIndex:0,contourHoleProcessingEnabled:l},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},ce.isInteractingWithTool=!0,a.addEventListener(H.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(H.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(H.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(H.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(H.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(H.TOUCH_TAP,this.mouseUpDrawCallback),ud(a)}function Zte(t){ce.isInteractingWithTool=!1,t.removeEventListener(H.MOUSE_UP,this.mouseUpDrawCallback),t.removeEventListener(H.MOUSE_DRAG,this.mouseDragDrawCallback),t.removeEventListener(H.MOUSE_CLICK,this.mouseUpDrawCallback),t.removeEventListener(H.TOUCH_END,this.mouseUpDrawCallback),t.removeEventListener(H.TOUCH_DRAG,this.mouseDragDrawCallback),t.removeEventListener(H.TOUCH_TAP,this.mouseUpDrawCallback),Em(t)}function Jte(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=le(r),{renderingEngine:s,viewport:c}=o,{annotation:l,viewportIdsToRender:f,xDir:u,yDir:g,spacing:d,movingTextBox:h}=this.commonData,{polylineIndex:p,canvasPoints:m}=this.drawData,v=m[m.length-1],y=c.canvasToWorld(v),C=te();rt(C,i,y);const T=Math.abs(fe(C,u)),S=Math.abs(fe(C,g));if(!(T<=d[0]&&S<=d[1])){if(h){this.isDrawing=!1;const{deltaPoints:x}=e,w=x.world,{textBox:E}=l.data.handles,{worldPosition:M}=E;M[0]+=w[0],M[1]+=w[1],M[2]+=w[2],E.hasMoved=!0}else{const x=this.findCrossingIndexDuringCreate(t);if(x!==void 0)this.applyCreateOnCross(t,x);else{const w=Wm(r,m,a,this.commonData);this.drawData.polylineIndex=p+w}}Vn(f)}}function Qte(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1],o=t.detail,{element:s}=o;e&&!RD(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:r})}function ene(t,e){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r,minPointsToSave:i}=e??{};if(i&&n.length<i||this.haltDrawing(t,n))return!1;const{annotation:a,viewportIdsToRender:o}=this.commonData,s=le(t),{viewport:c,renderingEngine:l}=s;Wm(t,n,n[0],this.commonData),n.pop();const f=yd(this.configuration,a)?Cd(this.configuration,n):n;this.updateContourPolyline(a,{points:f,closed:!0,targetWindingDirection:x0.Clockwise},c);const{textBox:u}=a.data.handles;return u!=null&&u.hasMoved||dO(a,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Vn(o),this.deactivateDraw(t),!0}function tne(){const{canvasPoints:t}=this.drawData,e=t.length,n=[t[0],t[e-1]],r=t.slice(0,-1).slice(1),i=MD(r,n[0],n[1],!1);if(i){const a=i[1];a===1?this.drawData.canvasPoints=t.splice(1):this.drawData.canvasPoints=t.splice(0,a)}}function nne(t,e){const{canvasPoints:n}=this.drawData,{contourHoleProcessingEnabled:r}=e??{};if(this.haltDrawing(t,n))return!1;const{annotation:i,viewportIdsToRender:a}=this.commonData,o=le(t),{viewport:s,renderingEngine:c}=o,l=yd(this.configuration,i)?Cd(this.configuration,n):n;this.updateContourPolyline(i,{points:l,closed:!1},s);const{textBox:f}=i.data.handles,u=i.data.contour.polyline;return i.data.handles.points=[u[0],u[u.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=Gm(n,s)),f.hasMoved||dO(i,r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Vn(a),this.deactivateDraw(t),!0}function rne(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{canvasPoints:o}=this.drawData,s=o.slice(0,-1),c=MD(s,i,a,!1);return c===void 0?void 0:c[0]}function ine(t,e){const n=t.detail,{element:r}=n,{canvasPoints:i,contourHoleProcessingEnabled:a}=this.drawData,{annotation:o,viewportIdsToRender:s}=this.commonData;Wm(r,i,i[e],this.commonData),i.pop();const c=i.slice(e),l=km(c);if(Vt(l,0)){i.splice(e+1);return}i.splice(0,e);const f={contourHoleProcessingEnabled:a,minPointsToSave:3};this.completeDrawClosedContour(r,f)&&this.activateClosedContourEdit(t,o,s)}function ane(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:n,contourHoleProcessingEnabled:r}=this.drawData,i=n[0],a=n[n.length-1];e&&!RD(i,a,this.configuration.closeContourProximity)?this.completeDrawOpenContour(t,{contourHoleProcessingEnabled:r}):this.completeDrawClosedContour(t,{contourHoleProcessingEnabled:r})}function one(t,e){const n=Math.max(e*3,3);return t.length<n}function sne(t,e){const{subPixelResolution:n}=this.configuration;if(one(e,n)){const{annotation:r,viewportIdsToRender:i}=this.commonData,a=le(t),{renderingEngine:o}=a;return y0(r.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Vn(i),this.deactivateDraw(t),!0}return!1}function cne(t){t.activateDraw=Yte.bind(t),t.deactivateDraw=Zte.bind(t),t.applyCreateOnCross=ine.bind(t),t.findCrossingIndexDuringCreate=rne.bind(t),t.completeDrawOpenContour=nne.bind(t),t.removeCrossedLinesOnCompleteDraw=tne.bind(t),t.mouseDragDrawCallback=Jte.bind(t),t.mouseUpDrawCallback=Qte.bind(t),t.completeDrawClosedContour=ene.bind(t),t.cancelDrawing=ane.bind(t),t.haltDrawing=sne.bind(t)}const{addCanvasPointsToArray:lne,getFirstLineSegmentIntersectionIndexes:$o}=Xo;function une(t,e){const n=t.detail,{element:r,currentPoints:i,lastPoints:a}=n,o=i.canvas,s=a.canvas,{editCanvasPoints:c,prevCanvasPoints:l}=this.editData,f=$o(l,o,s,e);if(f)this.editData.startCrossingIndex=f[0],this.removePointsUpUntilFirstCrossing(e);else if(l.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const u=c[0],g=[];for(let p=0;p<l.length;p++){const m=l[p],v=qt(m,u);g.push({distance:v,index:p})}g.sort((p,m)=>p.distance-m.distance);const d=[g[0],g[1]],h=Math.min(d[0].index,d[1].index);this.editData.startCrossingIndex=h}else{const u=Si();c0(u,c[1],c[0]),uC(u,u);const g=6,d=[c[0][0]-u[0]*g,c[0][1]-u[1]*g],h=$o(l,d,c[0],e);if(h){const p=[d];lne(r,p,c[0],this.commonData),c.unshift(...p),this.removePointsUpUntilFirstCrossing(e),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=h[0]}}}function fne(t){const{editCanvasPoints:e,prevCanvasPoints:n}=this.editData;let r=0;for(let i=0;i<e.length-1;i++){const a=[e[i],e[i+1]],o=!!$o(n,a[0],a[1],t);if(r++,o)break}e.splice(0,r),this.editData.editIndex=e.length-1}function gne(t,e){const n=t.detail,{currentPoints:r,lastPoints:i}=n,a=r.canvas,o=i.canvas,{prevCanvasPoints:s}=this.editData;return!!$o(s,a,o,e)}function dne(t){const{prevCanvasPoints:e,editCanvasPoints:n}=this.editData;for(let r=n.length-1;r>0;r--){const i=[n[r],n[r-1]],a=!!$o(e,i[0],i[1],t);if(n.pop(),a)break}}function pne(){const{editCanvasPoints:t,prevCanvasPoints:e,startCrossingIndex:n}=this.editData;if(n===void 0)return;const r=t[t.length-1],i=[];for(let o=0;o<e.length;o++){const s=e[o],c=qt(s,r);i.push({distance:c,index:o})}i.sort((o,s)=>o.distance-s.distance);const a=t.slice(0,-1);for(let o=0;o<i.length;o++){const{index:s}=i[o],c=e[s],l=t[t.length-1];if(!$o(a,c,l,!1))return s}return-1}function hne(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{editCanvasPoints:o}=this.editData,s=o.slice(0,-2),c=$o(s,i,a,!1);if(!c)return;const l=c[0],f=o.length-l;for(let u=0;u<f;u++)o.pop()}function mne(t){t.checkForFirstCrossing=une.bind(t),t.removePointsUpUntilFirstCrossing=fne.bind(t),t.checkForSecondCrossing=gne.bind(t),t.findSnapIndex=pne.bind(t),t.removePointsAfterSecondCrossing=dne.bind(t),t.checkAndRemoveCrossesOnEditLine=hne.bind(t)}function Pa(t,e,n,r){var h,p;const{canvasToWorld:i,worldToCanvas:a}=n,{data:o}=t,{targetWindingDirection:s}=e;let{points:c}=e,l=Yf(c);(h=r==null?void 0:r.decimate)!=null&&h.enabled&&(c=wD(e.points,(p=r==null?void 0:r.decimate)==null?void 0:p.epsilon));let{closed:f}=e;const u=c.length,g=new Array(u);Yf(c);const d=uQ(t);if(f===void 0){let m=!1;if(c.length>3){const v=Bo(c[0],c[u-1]);m=Vt(0,v)}f=m}if((r==null?void 0:r.updateWindingDirection)!==!1){let m=d?d.data.contour.windingDirection*-1:s;m===void 0&&(m=l),m!==l&&c.reverse();const v=o.handles.points.map(y=>a(y));v.length>2&&Yf(v)!==m&&o.handles.points.reverse(),l=m}for(let m=0;m<u;m++)g[m]=i(c[m]);o.contour.polyline=g,o.contour.closed=f,o.contour.windingDirection=l,fQ(t)}const{getSubPixelSpacingAndXYDirections:vne,addCanvasPointsToArray:LD,getArea:Q6}=Xo;function yne(t,e,n){this.isEditingClosed=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=le(a);if(!s)return;const{viewport:c}=s,l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:g}=vne(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},ce.isInteractingWithTool=!0,a.addEventListener(H.MOUSE_UP,this.mouseUpClosedContourEditCallback),a.addEventListener(H.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(H.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),a.addEventListener(H.TOUCH_END,this.mouseUpClosedContourEditCallback),a.addEventListener(H.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(H.TOUCH_TAP,this.mouseUpClosedContourEditCallback),ud(a)}function Cne(t){ce.isInteractingWithTool=!1,t.removeEventListener(H.MOUSE_UP,this.mouseUpClosedContourEditCallback),t.removeEventListener(H.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(H.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),t.removeEventListener(H.TOUCH_END,this.mouseUpClosedContourEditCallback),t.removeEventListener(H.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(H.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Em(t)}function Tne(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=le(r),{renderingEngine:s,viewport:c}=o,{viewportIdsToRender:l,xDir:f,yDir:u,spacing:g}=this.commonData,{editIndex:d,editCanvasPoints:h,startCrossingIndex:p}=this.editData,m=h[h.length-1],v=c.canvasToWorld(m),y=te();rt(y,i,v);const C=Math.abs(fe(y,f)),T=Math.abs(fe(y,u));if(C<=g[0]&&T<=g[1])return;p!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const S=LD(r,h,a,this.commonData),x=d+S;if(this.editData.editIndex=x,p===void 0&&h.length>1&&this.checkForFirstCrossing(t,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex===-1){this.finishEditAndStartNewEdit(t);return}this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(t),p!==void 0&&this.checkForSecondCrossing(t,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(t)),Vn(l)}function Sne(t){const e=t.detail,{element:n}=e,r=le(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Pa(o,{points:c,closed:!0,targetWindingDirection:x0.Clockwise},i),o.autoGenerated&&(o.autoGenerated=!1),Na(o,n);const f=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[f],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0},Vn(s)}function xne(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];LD(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,l;r>i?(c=i,l=r):(c=r,l=i);const f=qt(e[c],s[0]),u=qt(e[c],s[s.length-1]),g=qt(e[l],s[0]),d=qt(e[l],s[s.length-1]),h=[];for(let S=0;S<c;S++){const x=e[S];h.push([x[0],x[1]])}let p=f+d,m=u+g;if(p<m)for(let S=0;S<s.length;S++){const x=s[S];h.push([x[0],x[1]])}else for(let S=s.length-1;S>=0;S--){const x=s[S];h.push([x[0],x[1]])}for(let S=l;S<e.length;S++){const x=e[S];h.push([x[0],x[1]])}const v=[];for(let S=c;S<l;S++){const x=e[S];v.push([x[0],x[1]])}if(p=g+u,m=d+f,p<m)for(let S=0;S<s.length;S++){const x=s[S];v.push([x[0],x[1]])}else for(let S=s.length-1;S>=0;S--){const x=s[S];v.push([x[0],x[1]])}const y=Q6(h),C=Q6(v);return y>C?h:v}function wne(t){const e=t.detail,{element:n}=e;this.completeClosedContourEdit(n)}function Ene(t){var c;const e=le(t),{viewport:n,renderingEngine:r}=e,{annotation:i,viewportIdsToRender:a}=this.commonData,{fusedCanvasPoints:o,prevCanvasPoints:s}=this.editData;if(o){const l=yd(this.configuration,i)?Cd(this.configuration,o,s):o,f=((c=this.configuration)==null?void 0:c.decimate)||{};Pa(i,{points:l,closed:!0,targetWindingDirection:x0.Clockwise},n,{decimate:{enabled:!!f.enabled,epsilon:f.epsilon}}),i.autoGenerated&&(i.autoGenerated=!1),Na(i,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,Vn(a),this.deactivateClosedContourEdit(t)}function One(t){this.completeClosedContourEdit(t)}function Dne(t){t.activateClosedContourEdit=yne.bind(t),t.deactivateClosedContourEdit=Cne.bind(t),t.mouseDragClosedContourEditCallback=Tne.bind(t),t.mouseUpClosedContourEditCallback=wne.bind(t),t.finishEditAndStartNewEdit=Sne.bind(t),t.fuseEditPointsWithClosedContour=xne.bind(t),t.cancelClosedContourEdit=One.bind(t),t.completeClosedContourEdit=Ene.bind(t)}const{addCanvasPointsToArray:ID,getSubPixelSpacingAndXYDirections:Rne}=Xo;function Mne(t,e,n){this.isEditingOpen=!0;const r=t.detail,{currentPoints:i,element:a}=r,o=i.canvas,s=le(a),{viewport:c}=s,l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:g}=Rne(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[o],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:n,spacing:f,xDir:u,yDir:g,movingTextBox:!1},ce.isInteractingWithTool=!0,a.addEventListener(H.MOUSE_UP,this.mouseUpOpenContourEditCallback),a.addEventListener(H.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(H.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),a.addEventListener(H.TOUCH_END,this.mouseUpOpenContourEditCallback),a.addEventListener(H.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(H.TOUCH_TAP,this.mouseUpOpenContourEditCallback),ud(a)}function Lne(t){ce.isInteractingWithTool=!1,t.removeEventListener(H.MOUSE_UP,this.mouseUpOpenContourEditCallback),t.removeEventListener(H.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(H.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),t.removeEventListener(H.TOUCH_END,this.mouseUpOpenContourEditCallback),t.removeEventListener(H.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(H.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Em(t)}function Ine(t){const e=t.detail,{currentPoints:n,element:r}=e,i=n.world,a=n.canvas,o=le(r),{renderingEngine:s,viewport:c}=o,{viewportIdsToRender:l,xDir:f,yDir:u,spacing:g}=this.commonData,{editIndex:d,editCanvasPoints:h,startCrossingIndex:p}=this.editData,m=h[h.length-1],v=c.canvasToWorld(m),y=te();rt(y,i,v);const C=Math.abs(fe(y,f)),T=Math.abs(fe(y,u));if(C<=g[0]&&T<=g[1])return;p!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const S=ID(r,h,a,this.commonData),x=d+S;this.editData.editIndex=x,p===void 0&&h.length>1&&this.checkForFirstCrossing(t,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(t),p!==void 0&&this.checkForSecondCrossing(t,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(t)):this.checkIfShouldOverwriteAnEnd(t)&&this.openContourEditOverwriteEnd(t),Vn(l)}function Vne(t){const e=t.detail,{element:n}=e,r=le(n),{viewport:i}=r,{annotation:a,viewportIdsToRender:o}=this.commonData,s=this.fuseEditPointsForOpenContourEndEdit();Pa(a,{points:s,closed:!1},i);const c=a.data.contour.polyline;a.data.handles.points=[c[0],c[c.length-1]],a.data.handles.activeHandleIndex=1,Na(a,n),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.deactivateOpenContourEdit(n),this.activateOpenContourEndEdit(t,a,o,null)}function _ne(t){const e=t.detail,{currentPoints:n,lastPoints:r}=e,i=n.canvas,a=r.canvas,{snapIndex:o,prevCanvasPoints:s,startCrossingIndex:c}=this.editData;if(c===void 0||o===void 0)return!1;if(o===-1)return!0;if(o!==0&&o!==s.length-1)return!1;const l=i,f=a,u=s[o],g=Si(),d=Si();As(g,l[0]-f[0],l[1]-f[1]),As(d,l[0]-u[0],l[1]-u[1]);const h=e_(g,d),p=Math.sqrt(g[0]*g[0]+g[1]*g[1]),m=Math.sqrt(d[0]*d[0]+d[1]*d[1]);return Math.acos(h/(p*m))<Math.PI/2}function bne(){const{snapIndex:t,prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r}=this.editData,i=[];if(t===0)for(let s=e.length-1;s>=r;s--){const c=e[s];i.push([c[0],c[1]])}else for(let s=0;s<r;s++){const c=e[s];i.push([c[0],c[1]])}const a=qt(e[r],n[0]),o=qt(e[r],n[n.length-1]);if(a<o)for(let s=0;s<n.length;s++){const c=n[s];i.push([c[0],c[1]])}else for(let s=n.length-1;s>=0;s--){const c=n[s];i.push([c[0],c[1]])}return i}function Nne(t){const{prevCanvasPoints:e,editCanvasPoints:n,startCrossingIndex:r,snapIndex:i}=this.editData;if(r===void 0||i===void 0)return;const a=t.detail,{element:o}=a,s=[...n];ID(o,s,e[i],this.commonData),s.length>n.length&&s.pop();let c,l;r>i?(c=i,l=r):(c=r,l=i);const f=qt(e[c],s[0]),u=qt(e[c],s[s.length-1]),g=qt(e[l],s[0]),d=qt(e[l],s[s.length-1]),h=[];for(let v=0;v<c;v++){const y=e[v];h.push([y[0],y[1]])}const p=f+d,m=u+g;if(p<m)for(let v=0;v<s.length;v++){const y=s[v];h.push([y[0],y[1]])}else for(let v=s.length-1;v>=0;v--){const y=s[v];h.push([y[0],y[1]])}for(let v=l;v<e.length;v++){const y=e[v];h.push([y[0],y[1]])}return h}function Pne(t){const e=t.detail,{element:n}=e,r=le(n),{viewport:i,renderingEngine:a}=r,{annotation:o,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Pa(o,{points:c,closed:!1},i);const f=o.data.contour.polyline;o.data.handles.points=[f[0],f[f.length-1]],Na(o,n);const u=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},Vn(s)}function kne(t){const e=t.detail,{element:n}=e;this.completeOpenContourEdit(n)}function Fne(t){var c;const e=le(t),{viewport:n,renderingEngine:r}=e,{annotation:i,viewportIdsToRender:a}=this.commonData,{fusedCanvasPoints:o,prevCanvasPoints:s}=this.editData;if(o){const l=yd(this.configuration)?Cd(this.configuration,o,s):o,f=((c=this.configuration)==null?void 0:c.decimate)||{};Pa(i,{points:l,closed:!1},n,{decimate:{enabled:!!f.enabled,epsilon:f.epsilon}});const u=i.data.contour.polyline;i.data.handles.points=[u[0],u[u.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=Gm(o,n)),Na(i,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,Vn(a),this.deactivateOpenContourEdit(t)}function Une(t){this.completeOpenContourEdit(t)}function Ane(t){t.activateOpenContourEdit=Mne.bind(t),t.deactivateOpenContourEdit=Lne.bind(t),t.mouseDragOpenContourEditCallback=Ine.bind(t),t.mouseUpOpenContourEditCallback=kne.bind(t),t.fuseEditPointsWithOpenContour=Nne.bind(t),t.finishEditOpenOnSecondCrossing=Pne.bind(t),t.checkIfShouldOverwriteAnEnd=_ne.bind(t),t.fuseEditPointsForOpenContourEndEdit=bne.bind(t),t.openContourEditOverwriteEnd=Vne.bind(t),t.cancelOpenContourEdit=Une.bind(t),t.completeOpenContourEdit=Fne.bind(t)}const{getSubPixelSpacingAndXYDirections:Bne}=Xo;function Gne(t,e,n,r){this.isDrawing=!0;const i=t.detail,{element:a}=i,o=le(a),{viewport:s}=o,{spacing:c,xDir:l,yDir:f}=Bne(s,this.configuration.subPixelResolution),u=e.data.contour.polyline.map(s.worldToCanvas);e.data.handles.activeHandleIndex===0&&u.reverse();let d=!1;r!=null&&r.worldPosition&&(d=!0),this.drawData={canvasPoints:u,polylineIndex:u.length-1},this.commonData={annotation:e,viewportIdsToRender:n,spacing:c,xDir:l,yDir:f,movingTextBox:d},ce.isInteractingWithTool=!0,a.addEventListener(H.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(H.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(H.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(H.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(H.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(H.TOUCH_TAP,this.mouseUpDrawCallback),ud(a)}function Wne(t){t.activateOpenContourEndEdit=Gne.bind(t)}function $ne(t){return(t.childAnnotationUIDs??[]).map(n=>zt(n).data.contour.polyline)}function Sd(t,e){const n=$ne(t),r=[];return n.forEach(i=>{const a=i.length,o=new Array(a);for(let s=0;s<a;s++)o[s]=e.worldToCanvas(i[s]);r.push(o)}),r}const{pointsAreWithinCloseContourProximity:zne}=Xo;function Hne(t,e){const n={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id,annotationUID:e.annotationUID},{lineWidth:r,lineDash:i,color:a,fillColor:o,fillOpacity:s}=this.getAnnotationStyle({annotation:e,styleSpecifier:n}),{closed:c}=e.data.contour;return{color:a,width:r,lineDash:i,fillColor:o,fillOpacity:s,closePath:c}}function jne(t,e,n){var r;(r=t==null?void 0:t.viewport)!=null&&r.getImageData()&&(n.data.contour.closed?this.renderClosedContour(t,e,n):n.data.isOpenUShapeContour?(Kne(t,n),this.renderOpenUShapedContour(t,e,n)):this.renderOpenContour(t,e,n))}function Kne(t,e){e.data.openUShapeContourVectorToPeak||(e.data.openUShapeContourVectorToPeak=qte(t,e))}function qne(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(l=>r.worldToCanvas(l)),o=Sd(n,r),s=[a,...o];Xs(e,n.annotationUID,"1",s,i)}function Xne(t,e,n){var c;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(l=>r.worldToCanvas(l));S0(e,n.annotationUID,"1",a,i);const s=n.data.handles.activeHandleIndex;if(((c=this.configuration.alwaysRenderOpenContourHandles)==null?void 0:c.enabled)===!0){const l=this.configuration.alwaysRenderOpenContourHandles.radius,f="0",u=[a[0],a[a.length-1]];s===0?u.shift():s===1&&u.pop(),Xh(e,n.annotationUID,f,u,{color:i.color,handleRadius:l})}if(s!==null){const l="1",f=s===0?0:a.length-1,u=a[f];Xh(e,n.annotationUID,l,[u],{color:i.color})}}function Yne(t,e,n){const{viewport:r}=t,{openUShapeContourVectorToPeak:i}=n.data,{polyline:a}=n.data.contour;if(this.renderOpenContour(t,e,n),!i)return;const o=r.worldToCanvas(a[0]),s=r.worldToCanvas(a[a.length-1]),c=[r.worldToCanvas(i[0]),r.worldToCanvas(i[1])],l=this._getRenderingOptions(t,n);S0(e,n.annotationUID,"first-to-last",[o,s],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"}),S0(e,n.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"})}function Zne(t,e,n){const r=this._getRenderingOptions(t,n),{allowOpenContours:i}=this.configuration,{canvasPoints:a}=this.drawData;if(r.closePath=!1,S0(e,n.annotationUID,"1",a,r),i){const o=a[0],s=a[a.length-1];zne(o,s,this.configuration.closeContourProximity)?S0(e,n.annotationUID,"2",[s,o],r):Xh(e,n.annotationUID,"0",[o],{color:r.color,handleRadius:2})}}function Jne(t,e,n){const{viewport:r}=t,{fusedCanvasPoints:i}=this.editData;if(i===void 0){this.renderClosedContour(t,e,n);return}const a=Sd(n,r),o=[i,...a],s=this._getRenderingOptions(t,n),c="preview-1";n.parentAnnotationUID&&s.fillOpacity&&(s.fillOpacity=0),Xs(e,n.annotationUID,c,o,s)}function Qne(t,e,n){const{fusedCanvasPoints:r}=this.editData;if(r===void 0){this.renderOpenContour(t,e,n);return}const i=this._getRenderingOptions(t,n);S0(e,n.annotationUID,"preview-1",r,i)}function ere(t,e,n){if(n.parentAnnotationUID)return;const{viewport:r}=t,i=this._getRenderingOptions(t,n),a=n.data.contour.polyline.map(h=>r.worldToCanvas(h)),o=Sd(n,r),s="1",c=a[0],l=6,f=100,u=[];for(let h=0;h<f;h++){const p=h/f*2*Math.PI,m=c[0]+l*Math.cos(p),v=c[1]+l*Math.sin(p);u.push([m,v])}const g=[[c[0]-l*2,c[1]],[c[0]+l*2,c[1]],[c[0],c[1]-l*2],[c[0],c[1]+l*2]];Xs(e,n.annotationUID,s+"-crosshair_v",[g[0],g[1]],i),Xs(e,n.annotationUID,s+"-crosshair_h",[g[2],g[3]],i);const d=[u,...o];Xs(e,n.annotationUID,s,d,i)}function tre(t){t.renderContour=jne.bind(t),t.renderClosedContour=qne.bind(t),t.renderOpenContour=Xne.bind(t),t.renderPointContourWithMarker=ere.bind(t),t.renderOpenUShapedContour=Yne.bind(t),t.renderContourBeingDrawn=Zne.bind(t),t.renderClosedContourBeingEdited=Jne.bind(t),t.renderOpenContourBeingEdited=Qne.bind(t),t._getRenderingOptions=Hne.bind(t)}function nre(t){const e=rre(t),n=(e.top[1]+e.bottom[1])/2;return[e.right[0],n]}function rre(t){const e=[t[0],t[1]].sort(o),n=[t[0],t[1]].sort(s),r=e[e.length-1],i=n[0],a=n[n.length-1];return{top:i,bottom:a,right:r};function o(c,l){return c[0]<l[0]?-1:1}function s(c,l){return c[1]<l[1]?-1:1}}function ire(t,e){if(t instanceof Fr){const n=P0(e),r=Q.getVolume(n);return!!(r!=null&&r.scaling)&&Object.keys(r.scaling).length>0}else if(t instanceof fr){const{preScale:n}=t.getImageData()||{};return!!(n!=null&&n.scaled)}else return!1}function e9(t,e){let n=0;for(let r=0;r<t.length-1;r++){const i=t[r],a=t[r+1];n+=Math.sqrt(Math.pow(a[0]-i[0],2)+Math.pow(a[1]-i[1],2))}if(e){const r=t[0],i=t[t.length-1];n+=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2))}return n}class $m{constructor(e,n){const r=Zn(n,e),{configuration:i={},supportedInteractionTypes:a,toolGroupId:o}=r;i.strategies||(i.strategies={},i.defaultStrategy=void 0,i.activeStrategy=void 0,i.strategyOptions={}),this.toolGroupId=o,this.supportedInteractionTypes=a||[],this.configuration=Object.assign({},i),this.mode=Qe.Disabled}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,n){var a;const{strategies:r,activeStrategy:i}=this.configuration;return(a=r[i])==null?void 0:a.call(this,e,n)}applyActiveStrategyCallback(e,n,r){var o;const{strategies:i,activeStrategy:a}=this.configuration;if(!i[a])throw new Error(`applyActiveStrategyCallback: active strategy ${a} not found, check tool configuration or spellings`);return(o=i[a][r])==null?void 0:o.call(this,e,n)}setConfiguration(e){this.configuration=Zn(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const n=e.split("imageId:")[1],r=Dn(n);let i=Fh(r);return!i||!i.length||(i=i.filter(a=>a.getCurrentImageId()===n),!i||!i.length)?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const n=P0(e),r=id(n);return!r||!r.length?void 0:r[0].getImageData()}else if(e.startsWith("videoId:")){const n=Dn(e),r=Fh(n);return!r||!r.length?void 0:r[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){var r;const n=(r=e.getViewReferenceId)==null?void 0:r.call(e);if(n)return n;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}}$m.toolName="BaseTool";function are(t){if(t){if(t.data&&t.highlighted)return ea.Highlighted;if(fd(t.annotationUID))return ea.Selected;if(m0(t.annotationUID))return ea.Locked;if(t.data&&t.autoGenerated)return ea.AutoGenerated}return ea.Default}class VD extends $m{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:n,imageId:r}=e.detail,i=Dn(r),a=Ql();a.getFramesOfReference().forEach(s=>{const l=a.getAnnotations(s)[this.getToolName()];!l||!l.length||(l.forEach(f=>{var g;if(!((g=f.metadata)!=null&&g.referencedImageId))return;Dn(f.metadata.referencedImageId)===i&&(f.invalidated=!0,f.data.cachedStats={})}),nu(n))})}}filterInteractableAnnotationsForElement(e,n){if(!n||!n.length)return;const r=le(e),{viewport:i}=r;return DD(i,n)}getReferencedImageId(e,n,r,i){const a=this.getTargetId(e);let o=a.split(/^[a-zA-Z]+:/)[1];if(e instanceof Fr){const s=P0(a),c=Q.getVolume(s);o=ml(c,n,r)}return o}getStyle(e,n,r){return uO(e,n,are(r),this.mode)}}VD.toolName="AnnotationDisplayTool";class _D extends VD{static createAnnotation(...e){let n={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const r of e)n=Zn(n,r);return n}static createAnnotationForViewport(e,...n){return this.createAnnotation({metadata:e.getViewReference()},...n)}static createAndAddAnnotation(e,...n){const r=this.createAnnotationForViewport(e,...n);U0(r,e.element),Na(r,e.element)}constructor(e,n){var r,i;super(e,n),this.mouseMoveCallback=(a,o)=>{if(!o)return!1;const{element:s,currentPoints:c}=a.detail,l=c.canvas;let f=!1;for(const u of o){if(m0(u.annotationUID)||!gg(u.annotationUID))continue;const{data:g}=u,d=g.handles?g.handles.activeHandleIndex:void 0,h=this._imagePointNearToolOrHandle(s,u,l,6),p=h&&!u.highlighted,m=!h&&u.highlighted;p||m?(u.highlighted=!u.highlighted,f=!0):g.handles&&g.handles.activeHandleIndex!==d&&(f=!0)}return f},(r=e.configuration)!=null&&r.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),(i=e.configuration)!=null&&i.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,n,r,i){const a=le(e),{viewport:o}=a,{data:s}=n,{isCanvasAnnotation:c}=s,{points:l,textBox:f}=s.handles;if(f){const{worldBoundingBox:u}=f;if(u){const g={topLeft:o.worldToCanvas(u.topLeft),topRight:o.worldToCanvas(u.topRight),bottomLeft:o.worldToCanvas(u.bottomLeft),bottomRight:o.worldToCanvas(u.bottomRight)};if(r[0]>=g.topLeft[0]&&r[0]<=g.bottomRight[0]&&r[1]>=g.topLeft[1]&&r[1]<=g.bottomRight[1])return s.handles.activeHandleIndex=null,f}}for(let u=0;u<(l==null?void 0:l.length);u++){const g=l[u],d=c?g.slice(0,2):o.worldToCanvas(g);if(qt(r,d)<i===!0)return s.handles.activeHandleIndex=u,g}s.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,n){return{visibility:this.getStyle("textBoxVisibility",e,n),fontFamily:this.getStyle("textBoxFontFamily",e,n),fontSize:this.getStyle("textBoxFontSize",e,n),color:this.getStyle("textBoxColor",e,n),shadow:this.getStyle("textBoxShadow",e,n),background:this.getStyle("textBoxBackground",e,n),lineWidth:this.getStyle("textBoxLinkLineWidth",e,n),lineDash:this.getStyle("textBoxLinkLineDash",e,n)}}isSuvScaled(e,n,r){var a;if(e instanceof Fr){const o=P0(n),s=Q.getVolume(o);return((a=s==null?void 0:s.scaling)==null?void 0:a.PT)!==void 0}const i=r&&ee("scalingModule",r);return typeof(i==null?void 0:i.suvbw)=="number"}getAnnotationStyle(e){const{annotation:n,styleSpecifier:r}=e,i=d=>this.getStyle(d,r,n),{annotationUID:a}=n,o=gg(a),s=m0(a),c=i("lineWidth"),l=i("lineDash"),f=i("color"),u=i("shadow"),g=this.getLinkedTextBoxStyle(r,n);return{visibility:o,locked:s,color:f,lineWidth:c,lineDash:l,lineOpacity:1,fillColor:f,fillOpacity:0,shadow:u,textbox:g}}_imagePointNearToolOrHandle(e,n,r,i){if(this.getHandleNearImagePoint(e,n,r,i)||this.isPointNearTool(e,n,r,i,"mouse"))return!0}}_D.toolName="AnnotationTool";class ore extends _D{constructor(e,n){super(e,n)}renderAnnotation(e,n){let r=!1;const{viewport:i}=e,{element:a}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),r;let o=v0(this.getToolName(),a);if(!(o!=null&&o.length)||(o=this.filterInteractableAnnotationsForElement(a,o),!(o!=null&&o.length)))return r;const s=this.getTargetId(i),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let l=0;l<o.length;l++){const f=o[l];c.annotationUID=f.annotationUID;const u=this.getAnnotationStyle({annotation:f,styleSpecifier:c});if(!u.visibility)continue;const g=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:f,annotationStyle:u,svgDrawingHelper:n});r||(r=g),f.invalidated=!1}return r}createAnnotation(e){const n=e.detail,{currentPoints:r,element:i}=n,{world:a}=r,o=le(i),{viewport:s}=o,c=s.getCamera(),{viewPlaneNormal:l,viewUp:f,position:u}=c,g=this.getReferencedImageId(s,a,l,f),d=s.getViewReference({points:[a]});return{highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),...d,referencedImageId:g,viewUp:f,cameraPosition:u},data:{handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{polyline:[],closed:!1}},interpolationUID:"",autoGenerated:!1}}addAnnotation(e,n){return U0(e,n)}cancelAnnotation(e){}moveAnnotation(e,n){const{points:r}=e.data.handles;for(let i=0,a=r.length;i<a;i++){const o=r[i];o[0]+=n[0],o[1]+=n[1],o[2]+=n[2]}e.invalidated=!0,SO(e).forEach(i=>this.moveAnnotation(i,n))}updateContourPolyline(e,n,r,i){var o;const a=((o=this.configuration)==null?void 0:o.decimate)||{};Pa(e,n,r,{decimate:{enabled:!!a.enabled,epsilon:a.epsilon},updateWindingDirection:i==null?void 0:i.updateWindingDirection})}getPolylinePoints(e){var n;return((n=e.data.contour)==null?void 0:n.polyline)??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:n,annotationStyle:r,svgDrawingHelper:i}=e,a=e.annotation;if(a.parentAnnotationUID)return;const{annotationUID:o}=a,{viewport:s}=n,{worldToCanvas:c}=s,l=this.getPolylinePoints(a).map(v=>c(v)),{lineWidth:f,lineDash:u,color:g,fillColor:d,fillOpacity:h}=r,p=Sd(a,s),m=[l,...p];return Xs(i,o,"contourPolyline",m,{color:g,lineDash:u,lineWidth:Math.max(.1,f),fillColor:d,fillOpacity:h}),!0}}const t9="PlanarFreehandContourSegmentationTool";function zm(t,e=[]){const{viewport:n,sliceData:r,annotation:i}=t,a=new Map,{toolName:o,originalToolName:s}=i.metadata,c=s||o,l=(v0(c,n.element)||[]).filter(f=>!f.metadata.originalToolName||f.metadata.originalToolName===c);if(c!==t9){const f=v0(t9,n.element);f!=null&&f.length&&f.forEach(u=>{const{metadata:g}=u;g.originalToolName===c&&g.originalToolName!==g.toolName&&l.push(u)})}if(!(l!=null&&l.length))return a;for(let f=0;f<r.numberOfSlices;f++){const u=l.filter(d=>d.metadata.sliceIndex===f);if(!(u!=null&&u.length))continue;const g=u.filter(d=>e.every(h=>{const p=h.parentKey?h.parentKey(d):d,m=p==null?void 0:p[h.key];return Array.isArray(m)?m.every((v,y)=>v===h.value[y]):m===h.value}));g.length&&a.set(f,g)}return a}function sre(t,e){const n=zm(t,e),r=[];if(!(n!=null&&n.size))return r;for(const i of n.values())i.forEach(a=>{r.push(a)});return r}function bD(t,e,n){const r=Zn({data:{},metadata:{}},n);return Object.assign(r,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(r.data,{handles:{points:e.points||e||[],interpolationSources:e.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...n.data.contour,polyline:t}}),r}function cre(t,e){const n=zm(e,[{key:"interpolationUID",value:e.interpolationUID}]),r=lre(n);if(!r){console.warn("No annotations found to interpolate",n);return}const i=ure(n,t.annotationUID),a=[];for(let o=r[0]+1;o<r[1];o++)if(fre(n,o)){const s=dre(o,r,n);((s==null?void 0:s[0])===i||(s==null?void 0:s[1])===i)&&gre(s,a,o)}return{interpolationData:n,interpolationList:a}}function lre(t){let e=1/0,n=-1/0,r=!1;for(const[i,a]of t.entries())a.length&&(e=Math.min(i,e),n=Math.max(i,n),r=!0);if(r)return[e,n]}function ure(t,e){for(const[n,r]of t)for(let i=0;i<r.length;i++)if(r[i].annotationUID===e)return n}function fre(t,e){const n=t.get(e);return!(n!=null&&n.length)||n.length===1&&n[0].autoGenerated}function gre(t,e,n){const[r]=t;e[r]||(e[r]={pair:t,list:[]}),e[r].list.push(n)}function dre(t,e,n){const r=[];let i=!0;for(let a=t-1;a>=e[0];a--){const o=n.get(a);if(o!=null&&o.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||!r.length)){for(let a=t+1;a<=e[1];a++){const o=n.get(a);if(o!=null&&o.length){if(o[0].autoGenerated)continue;o.length>1&&(i=!1),r.push(a);break}}if(!(!i||r.length<2))return r}}const{PointsManager:n9}=ba;function pre(t,e=12){const n=n9.create3(e);n.sources=[];const{sources:r}=n,{length:i,sources:a=[]}=t,o=5;if(i<o*3)return t.subselect(e);const s=Math.floor(Math.max(2*i/e,o*2));a.forEach(()=>r.push(n9.create3(e)));const c=hre(t,o),l=mre(c,e),f=[];if((l==null?void 0:l.length)>2){let u=-1;const g=s/3;l.forEach(p=>{const[m,,v]=p,y=Math.ceil((m+v)/2);v-u<g||(y-m>2*g?(cs(f,u,m,s,i),u=cs(f,m,y,s,i)):u=cs(f,u,y,s,i),v-u>g&&(u=cs(f,u,v,s,i)))});const d=f[0];Yh(d+i-u,i)>2*g&&cs(f,u,d-g,s,i)}else{const u=Math.floor(i/e);cs(f,-1,i-u,u,i)}return f.forEach(u=>{const g=t.getPointArray(u);n.push(g),a.forEach((d,h)=>r[h].push(d.getPoint(u)))}),n}function hre(t,e=6){const{length:n}=t,r=te(),i=te(),a=new Float32Array(n);for(let o=0;o<n;o++){const s=t.getPoint(o),c=t.getPoint(o-e),l=t.getPoint((o+e)%n);_t(r,s,c),_t(i,l,s);const f=fe(r,i)/(R1(r)*R1(i));a[o]=f}return a}function mre(t,e){const{max:n,deviation:r}=vre(t),{length:i}=t;if(r<.01||i<e*3)return[];const a=[];let o=null,s,c=0;for(let l=0;l<i;l++){const f=t[l];f<n-r?o?(o[2]=l,f<s&&(s=f,c=l),o[1]=c):(s=f,c=l,o=[l,l,l]):o&&(a.push(o),o=null)}return o&&(a[0][0]===0?a[0][0]=o[0]:(o[1]=c,o[2]=i-1,a.push(o))),a}function cs(t,e,n,r,i){n<e&&(n+=i);const a=n-e,o=Math.ceil(a/r);if(o<=0)return t[t.length-1]!==n&&t.push(Yh(n,i)),n;for(let s=1;s<=o;s++){const c=Yh(e+s*a/o,i);t.push(c)}return t[t.length-1]}function Yh(t,e){return(Math.round(t)+e)%e}function vre(t){const{length:e}=t;let n=0,r=1/0,i=-1/0,a=0;for(let s=0;s<e;s++){const c=t[s];n+=c,r=Math.min(r,c),i=Math.max(i,c)}const o=n/e;for(let s=0;s<e;s++){const c=t[s]-o;a+=c*c}return{mean:o,max:i,min:r,sumSq:a,deviation:Math.sqrt(a/e)}}function yre(t){const{parentAnnotationUID:e,annotationUID:n}=t;if(!e)return t.interpolationUID;const r=zt(e),{interpolationUID:i}=r,a=r.childAnnotationUIDs.indexOf(n);return t.interpolationUID=`${i}-${a}`,t.interpolationUID}const{isEqual:r9}=ba;function ND(t){const{metadata:e}=t;return sq().filter(n=>{if(n.FrameOfReferenceUID===e.FrameOfReferenceUID){const r=n.viewport,{viewPlaneNormal:i,viewUp:a}=r.getCamera();return r9(i,e.viewPlaneNormal)&&(!e.viewUp||r9(a,e.viewUp))}}).map(n=>n.viewport)}const $c="PlanarFreehandContourSegmentationTool";async function Cre(t){const e=t.detail.annotation;if(!md(e))return;const n=Tre(e),r=Sre(n,e);if(!r.length)return;const i=xd(e.data.contour.polyline,n),a=xre(n,i,r);if(!a)return;const{targetAnnotation:o,targetPolyline:s,isContourHole:c}=a;if(c){const{contourHoleProcessingEnabled:l=!1}=t.detail;if(!l)return;kD(n,o,e)}else Ere(n,o,s,e,i)}function PD(t,e=!1){const n="PlanarFreehandContourSegmentationTool",r=yn(t.id,t.renderingEngineId);let i;return r.hasTool(n)?r.getToolOptions(n)||(i=`Tool ${n} must be in active/passive state`):i=`Tool ${n} not added to ${r.id} toolGroup`,i&&!e&&console.warn(i),!i}function Tre(t){const e=ND(t);return e.find(r=>PD(r,!0))??e[0]}function xd(t,e){const n=t.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e.worldToCanvas(t[i]);return r}function Sre(t,e){const{annotationUID:n}=e;return lQ().filter(i=>i.annotationUID&&i.annotationUID!==n&&md(i)&&bee(i,e)&&t.isReferenceViewable(i.metadata))}function xre(t,e,n){const r=mg(e);for(let i=0;i<n.length;i++){const a=n[i],o=xd(a.data.contour.polyline,t),s=mg(o),c=jee(r,s),l=c&&xD(e,o),f=c&&!l&&Pm(o,e);if(l||f)return{targetAnnotation:a,targetPolyline:o,isContourHole:f}}}function kD(t,e,n){const{windingDirection:r}=e.data.contour,{windingDirection:i}=n.data.contour;TO(e,n),Nm(n);const{contour:a}=n.data,o=xd(a.polyline,t);Pa(n,{points:o,closed:a.closed},t);const{element:s}=t,c=new Set([$c,e.metadata.toolName,n.metadata.toolName]);for(const l of c.values()){const f=Wc(s,l);Vn(f)}}function wre(t,e){return SO(e).map(n=>{const r=xd(n.data.contour.polyline,t);return{annotation:n,polyline:r}})}function Ere(t,e,n,r,i){var C;if(!gQ($c)){console.warn(`${$c} is not registered in cornerstone`);return}if(!PD(t))return;const a=i[0],o=Go(n,a),s=wre(t,e),c=new Set(s),l=new Map,f=(T,S)=>{let x=l.get(T);x||(x=[],l.set(T,x)),x.push(S),c.delete(S)},u=[];if(o){const T=CD(n,i);u.push(T),Array.from(c.keys()).forEach(S=>f(T,S))}else TD(n,i).forEach(S=>{u.push(S),Array.from(c.keys()).forEach(x=>{Pm(S,x.polyline)&&(f(S,x),c.delete(x))})});Array.from(l.values()).forEach(T=>T.forEach(S=>CO(S.annotation)));const{element:g}=t,d=le(g),{metadata:h,data:p}=e,{handles:m,segmentation:v}=p,{textBox:y}=m;y0(r.annotationUID),y0(e.annotationUID);for(let T=0;T<u.length;T++){const S=u[T],x=t.canvasToWorld(S[0]),w=t.canvasToWorld(S[S.length-1]),E={metadata:{...h,toolName:$c,originalToolName:h.originalToolName||h.toolName},data:{cachedStats:{},handles:{points:[x,w],textBox:y?{...y}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...v}},annotationUID:bt(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};Pa(E,{points:S,closed:!0,targetWindingDirection:x0.Clockwise},t),U0(E,g),Ml(E),Na(E,t.element),(C=l.get(S))==null||C.forEach(M=>TO(E,M.annotation))}Ore(d,e,r)}function Ore(t,e,n){const{viewport:r}=t,{element:i}=r,a=new Set([$c,e.metadata.toolName,n.metadata.toolName]);for(const o of a.values()){const s=Wc(i,o);Vn(s)}return new Promise(o=>window.requestAnimationFrame(o))}const{PointsManager:lc}=ba,i9=.2;function Zf(t){if(!t.annotation)return;const{isInterpolationUpdate:e,annotation:n}=t;queueMicrotask(()=>{try{e&&(n.isInterpolationUpdate=!0,n.autoGenerated=!1),Dre(t)}finally{e&&(n.autoGenerated=!0)}})}function Dre(t){const{annotation:e}=t;yre(e);const{interpolationData:n,interpolationList:r}=cre(e,t)||{};if(!n||!r)return;const i={toolName:e.metadata.toolName,toolType:e.metadata.toolName,viewport:t.viewport};for(let l=0;l<r.length;l++)r[l]&&Rre(r[l].list,r[l].pair,n,i);const{id:a,renderingEngineId:o,element:s}=t.viewport,c={annotation:e,element:s,viewportId:a,renderingEngineId:o};r.length&&Z(t.viewport.element,H.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c)}function Rre(t,e,n,r){const i=n.get(e[0])[0],a=n.get(e[1])[0],o=f9(i.data.contour.polyline),s=f9(a.data.contour.polyline),{c1Interp:c,c2Interp:l}=_re(o,s);c.kIndex=e[0],l.kIndex=e[1],t.forEach(function(f){Mre(c,l,f,e,n,o.x.length>s.x.length,r)})}function Mre(t,e,n,r,i,a,o){const[s,c]=r,l=(n-s)/(c-s),f=i.get(s)[0],u=i.get(c)[0],g=Vre(t,e,l,a),d=l>.5?u:f,h=pre(g);i.has(n)?Ire(g,h,n,d,o):Lre(g,h,n,d,o)}function Lre(t,e,n,r,i){var f;const a=t.points,{viewport:o}=i,s=bD(a,e,r),c=o.getViewReference({sliceIndex:n});if(!c)throw new Error(`Can't find slice ${n}`);Object.assign(s.metadata,c),U0(s,o.element),(f=r.onInterpolationComplete)==null||f.call(r,s,r);const{parentAnnotationUID:l}=r;if(l){const u=zt(l),g=FD(u,n,i);kD(o,g,s)}}function FD(t,e,n){const{viewport:r}=n,i=v0(t.metadata.toolName,r.element);for(let a=0;a<i.length;a++){const o=i[a];if(o.interpolationUID===t.interpolationUID&&o.metadata.sliceIndex===e)return o}}function Ire(t,e,n,r,i){const a=FD(r,n,i),o=t.points,s=bD(o,e,a);Object.assign(a,{metadata:s.metadata,data:s.data})}function Vre(t,e,n,r){const i=r?t.I:e.I,a=lc.fromXYZ(t),o=lc.fromXYZ(e),{length:s}=a,c=lc.create3(s),l=te(),f=te(),u=lc.create3(s);u.kIndex=t.kIndex;const g=lc.create3(s);g.kIndex=e.kIndex;for(let d=0;d<t.x.length;d++)if(i[d]){const h=a.getPoint(d),p=o.getPoint(d);u.push(h),g.push(p),_t(l,p,h),c.push(dn(f,h,l,n))}return c.sources=[u,g],c}function _re(t,e){const n=u9(t),r=u9(e),i=Math.max(Math.ceil(n[n.length-1]/i9),Math.ceil(r[r.length-1]/i9)),a=l9(n),o=l9(r),s=i+e.x.length,c=i+t.x.length,l=c9(s,a),f=c9(c,o),u=s9(s-2,t.x.length),g=s9(c-2,e.x.length),d=o9(l,u),h=o9(f,g),p=a9(t,d),m=a9(e,h);return Nre(p,m),bre(p,m)}function bre(t,e){const n={x:[],y:[],z:[],I:[]},r={x:[],y:[],z:[],I:[]};for(let i=0;i<t.x.length;i++)(t.I[i]||e.I[i])&&(n.x.push(t.x[i]),n.y.push(t.y[i]),n.z.push(t.z[i]),n.I.push(t.I[i]),r.x.push(e.x[i]),r.y.push(e.y[i]),r.z.push(e.z[i]),r.I.push(e.I[i]));return{c1Interp:n,c2Interp:r}}function Nre(t,e){const n=t.x.length,r={startingNode:0,totalSquaredXYLengths:1/0};for(let a=0;a<n;a++){let o=a,s=0;for(let c=0;c<n;c++)s+=(t.x[o]-e.x[c])**2+(t.y[o]-e.y[c])**2+(t.z[o]-e.z[c])**2,o++,o===n&&(o=0);s<r.totalSquaredXYLengths&&(r.totalSquaredXYLengths=s,r.startingNode=a)}const i=r.startingNode;ff(t.x,i),ff(t.y,i),ff(t.z,i),ff(t.I,i)}function ff(t,e){e-=t.length*Math.floor(e/t.length);const n=t.splice(0,e);return t.push(...n),t}function a9(t,e){const n={x:[],y:[],z:[],I:[]};for(let r=0;r<t.x.length-1;r++){n.x.push(t.x[r]),n.y.push(t.y[r]),n.z.push(t.z[r]),n.I.push(!0);const i=(t.x[r+1]-t.x[r])/(e[r]+1),a=(t.y[r+1]-t.y[r])/(e[r]+1),o=(t.z[r+1]-t.z[r])/(e[r]+1);for(let s=0;s<e[r]-1;s++)n.x.push(n.x[n.x.length-1]+i),n.y.push(n.y[n.y.length-1]+a),n.z.push(n.z[n.z.length-1]+o),n.I.push(!1)}return n}function o9(t,e){const n=[];for(let o=0;o<t.length;++o)n[o]=o;n.sort(function(o,s){return t[o]<t[s]?-1:1});const r=[];for(let o=0;o<e.length;o++)r.push(e[n[o]]);const i=r.reduce(function(o,s,c){return s&&o.push(c),o},[]),a=[];for(let o=0;o<i.length-1;o++)a.push(i[o+1]-i[o]);return a}function s9(t,e){const n=new Array(t+e);return n.fill(!1,0,t),n.fill(!0,t,t+e),n}function c9(t,e){const n=1/(t-1),r=[n];for(let i=1;i<t-2;i++)r.push(r[r.length-1]+n);return r.concat(e)}function l9(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n]/t[t.length-1]);return e}function u9(t){const e=[0];for(let n=1;n<t.x.length;n++){const r=Math.sqrt((t.x[n]-t.x[n-1])**2+(t.y[n]-t.y[n-1])**2+(t.z[n]-t.z[n-1])**2);e.push(e[n-1]+r)}return e}function f9(t){const e={x:[],y:[],z:[]};for(let n=0;n<t.length;n++)e.x[n]=t[n][0],e.y[n]=t[n][1],e.z[n]=t[n][2];return e.x.push(e.x[0]),e.y.push(e.y[0]),e.z.push(e.z[0]),e}function g9(t){const{annotation:e}=t,n=zm(t,[{key:"interpolationUID",value:t.interpolationUID}]),r=e.metadata.sliceIndex;let i=-1,a=t.sliceData.numberOfSlices;for(const[s,c]of n.entries())s===r||!c.find(f=>!f.autoGenerated)||(s<r?i=Math.max(s,i):a=Math.min(s,a));const o=[];for(const[s,c]of n.entries())s<=i||s>=a||s===r||c.forEach(l=>{l.autoGenerated&&(y0(l.annotationUID),o.push(l))});if(o.length){const s={annotations:o,element:t.viewport.element,viewportId:t.viewport.id,renderingEngineId:t.viewport.getRenderingEngine().id};Z(t.viewport.element,H.INTERPOLATED_ANNOTATIONS_REMOVED,s)}if(i>=0&&a<t.sliceData.numberOfSlices){const s=n.get(a)[0],c={viewport:t.viewport,sliceData:{numberOfSlices:t.sliceData.numberOfSlices,imageIndex:s.metadata.sliceIndex},annotation:s,interpolationUID:s.interpolationUID};Zf(c)}}function Y2(t){const e=ND(t);return e.length?e[0]:void 0}const{uuidv4:Pre}=ba,kre=[Ea.HandlesUpdated,Ea.InterpolationUpdated],ar=class ar{static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,n={}){const{toolNames:r,segmentationId:i,segmentIndex:a,sliceIndex:o}=n;for(const s of r||ar.toolNames){const c=v0(s,e);if(c!=null&&c.length)for(const l of c){const{interpolationUID:f,data:u,autoGenerated:g,metadata:d}=l;f&&(l.interpolationCompleted=!0),g&&(a&&a!==u.segmentation.segmentIndex||o!==void 0&&d&&o!==d.sliceIndex||i&&i!==u.segmentation.segmentationId||(Ml(l),l.autoGenerated=!1))}}}};ar.toolNames=[],ar.handleAnnotationCompleted=e=>{var d;const n=e.detail.annotation;if(!(n!=null&&n.metadata))return;const{toolName:r,originalToolName:i}=n.metadata;if(!ar.toolNames.includes(r)&&!ar.toolNames.includes(i))return;const a=Y2(n);if(!a){console.warn("Unable to find viewport for",n);return}const o=Z2(a),s={viewport:a,sliceData:o,annotation:n,interpolationUID:n.interpolationUID},c=!!n.interpolationUID;if(n.autoGenerated=!1,c){g9(s),Zf(s);return}const l=[{key:"segmentIndex",value:n.data.segmentation.segmentIndex,parentKey:h=>h.data.segmentation},{key:"viewPlaneNormal",value:n.metadata.viewPlaneNormal,parentKey:h=>h.metadata},{key:"viewUp",value:n.metadata.viewUp,parentKey:h=>h.metadata}];let f=sre(s,l);const{sliceIndex:u}=n.metadata,g=new Set;f.forEach(h=>{if(h.interpolationCompleted||h.metadata.sliceIndex===u){const{interpolationUID:p}=h;g.add(p)}}),f=f.filter(h=>!g.has(h.interpolationUID)),n.interpolationUID=((d=f[0])==null?void 0:d.interpolationUID)||Pre(),s.interpolationUID=n.interpolationUID,Zf(s)},ar.handleAnnotationUpdate=e=>{const n=e.detail.annotation,{changeType:r=Ea.HandlesUpdated}=e.detail;if(!(n!=null&&n.metadata))return;const{toolName:i,originalToolName:a}=n.metadata;if(!ar.toolNames.includes(i)&&!ar.toolNames.includes(a)||!kre.includes(r))return;const o=Y2(n);if(!o){console.warn("Unable to find matching viewport for annotation interpolation",n);return}n.autoGenerated&&(Ml(n),n.autoGenerated=!1);const s=Z2(o),c={viewport:o,sliceData:s,annotation:n,interpolationUID:n.interpolationUID,isInterpolationUpdate:r===Ea.InterpolationUpdated};Zf(c)},ar.handleAnnotationDelete=e=>{const n=e.detail.annotation;if(!(n!=null&&n.metadata))return;const{toolName:r}=n.metadata;if(!ar.toolNames.includes(r)||n.autoGenerated)return;const i=Y2(n);if(!i){console.warn("No viewport, can't delete interpolated results",n);return}const a=Z2(i),o={viewport:i,sliceData:a,annotation:n,interpolationUID:n.interpolationUID};n.autoGenerated=!1,g9(o)};let Oi=ar;function Z2(t){return{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getCurrentImageIdIndex()}}function Fre(t){t.forEach(e=>{const n=gO(e);if(!n){console.warn(`ToolGroup not available for ${e}`);return}n.getViewportsInfo().forEach(i=>{const{renderingEngineId:a,viewportId:o}=i,s=Va(a);if(!s){console.warn(`RenderingEngine not available for ${a}`);return}const c=s.getViewport(o);nu(c.element)})})}function Zh(t){return ii.getActiveSegmentation(t)}function Ure(t,e){return ii.getSegmentationRepresentationVisibility(t,e)}function Jh(t){const e=ut(t);if(e){const n=Object.keys(e.segments).find(r=>e.segments[r].active);return n?Number(n):void 0}}function Are(t){const e=ut(t);if(!e)throw new Error(`No segmentation state found for ${t}`);const{segments:n}=e;return Object.keys(n).filter(i=>n[i].locked).map(i=>parseInt(i))}function UD(t,e){const n=nD(t,e);return n?Object.entries(n.segments).reduce((i,[a,o])=>(o.visible||i.add(Number(a)),i),new Set):new Set}class Bre extends ore{constructor(e,n){var r;super(e,n),(r=this.configuration.interpolation)!=null&&r.enabled&&Oi.addTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const n=e.detail,{element:r}=n,i=le(r);if(!i)return;const{viewport:a}=i,o=super.createAnnotation(e);if(!this.isContourSegmentationTool())return o;const s=Zh(a.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:c}=s,l=Jh(c);return Zn(o,{data:{segmentation:{segmentationId:c,segmentIndex:l}}})}addAnnotation(e,n){const r=super.addAnnotation(e,n);return this.isContourSegmentationTool()&&Ml(e),r}cancelAnnotation(e){this.isContourSegmentationTool()&&Nm(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const n=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return n;const r=this._getContourSegmentationStyle(e);return Zn(n,r)}renderAnnotationInstance(e){const{annotation:n}=e,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r&&this.isContourSegmentationTool()){const{segmentationId:a}=n.data.segmentation;hd(a);const s=bm(a).map(c=>yn(c).id);Fre(s)}return i}_getContourSegmentationStyle(e){const n=e.annotation,{segmentationId:r,segmentIndex:i}=n.data.segmentation,{viewportId:a}=e.styleSpecifier,o=wo(a,{segmentationId:r});if(!(o!=null&&o.length))return{};o.length>1?o.find(E=>E.segmentationId===r&&E.type===se.Contour):o[0];const{autoGenerated:s}=n,l=Are(r).includes(i),f=lD(e.styleSpecifier.viewportId,r,i),u=Ure(a,{segmentationId:r,type:se.Contour}),g=Zh(a),d=(g==null?void 0:g.segmentationId)===r,p=xo.getStyle({viewportId:a,segmentationId:r,type:se.Contour,segmentIndex:i});let m=1,v,y=1,C=0;s?(m=p.outlineWidthAutoGenerated??m,v=p.outlineDashAutoGenerated??v,y=p.outlineOpacity??y,C=p.fillAlphaAutoGenerated??C):d?(m=p.outlineWidth??m,v=p.outlineDash??v,y=p.outlineOpacity??y,C=p.fillAlpha??C):(m=p.outlineWidthInactive??m,v=p.outlineDashInactive??v,y=p.outlineOpacityInactive??y,C=p.fillAlphaInactive??C),Jh(r)===i&&(m+=p.activeSegmentOutlineWidthDelta),m=p.renderOutline?m:0,C=p.renderFill?C:0;const T=`rgba(${f[0]}, ${f[1]}, ${f[2]}, ${y})`,S=`rgb(${f[0]}, ${f[1]}, ${f[2]})`,w=!UD(a,{segmentationId:r,type:se.Contour}).has(i);return{color:T,fillColor:S,lineWidth:m,fillOpacity:C,lineDash:v,textbox:{color:T},visibility:u&&w,locked:l}}}function Gre(t,e,n){return t==="CT"?"HU":t==="PT"?Wre(e,n):""}function Wre(t,e){if(!e.isPreScaled)return"raw";if(e.isSuvScaled)return"SUV";const n=ee("generalSeriesModule",t);if((n==null?void 0:n.modality)==="PT"){const r=ee("petSeriesModule",t);return(r==null?void 0:r.units)||"unitless"}return"unknown"}const{pointCanProjectOnLine:d9}=Xo,{EPSILON:$re}=SC,zre=1-$re;class AD extends Bre{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:$n.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:Hre,statsCalculator:qh}}){super(e,n),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=r=>{const i=r.detail,{element:a}=i,o=this.createAnnotation(r);this.addAnnotation(o,a);const s=Wc(a,this.getToolName());return this.activateDraw(r,o,s),r.preventDefault(),Vn(s),o},this.handleSelectedCallback=(r,i,a)=>{const o=r.detail,{element:s}=o,c=Wc(s,this.getToolName());this.activateOpenContourEndEdit(r,i,c,a)},this.toolSelectedCallback=(r,i)=>{const a=r.detail,{element:o}=a,s=Wc(o,this.getToolName());i.data.contour.closed?this.activateClosedContourEdit(r,i,s):this.activateOpenContourEdit(r,i,s),r.preventDefault()},this.isPointNearTool=(r,i,a,o)=>{const s=le(r),{viewport:c}=s,{polyline:l}=i.data.contour;let f=c.worldToCanvas(l[0]);for(let d=1;d<l.length;d++){const h=f,p=c.worldToCanvas(l[d]);if(d9(a,h,p,o))return!0;f=p}if(!i.data.contour.closed)return!1;const u=c.worldToCanvas(l[0]),g=c.worldToCanvas(l[l.length-1]);return d9(a,u,g,o)},this.cancel=r=>{const i=this.isDrawing,a=this.isEditingOpen,o=this.isEditingClosed;i?this.cancelDrawing(r):a?this.cancelOpenContourEdit(r):o&&this.cancelClosedContourEdit(r)},this._calculateCachedStats=(r,i,a,o)=>{const{data:s}=r,{cachedStats:c}=s,{polyline:l,closed:f}=s.contour,u=Object.keys(c);for(let g=0;g<u.length;g++){const d=u[g],h=this.getTargetImageData(d);if(!h)continue;const{imageData:p,metadata:m}=h,v=l.map(S=>i.worldToCanvas(S)),y={isPreScaled:ire(i,d),isSuvScaled:this.isSuvScaled(i,d,r.metadata.referencedImageId)},C=Gre(m.Modality,r.metadata.referencedImageId,y),T=Hee(h,()=>{const S=s.contour.polyline,x=S.length,w=new Array(x);for(let U=0;U<x;U++)w[U]=i.worldToCanvas(S[U]);const{maxX:E,maxY:M,minX:O,minY:R}=mg(w),_=i.canvasToWorld([O,R]),P=Ji(p,_),N=i.canvasToWorld([E,M]),W=Ji(p,N);return[P,W]});f?this.updateClosedCachedStats({targetId:d,viewport:i,canvasCoordinates:v,points:l,imageData:p,metadata:m,cachedStats:c,modalityUnit:C,calibratedScale:T}):this.updateOpenCachedStats({metadata:m,canvasCoordinates:v,targetId:d,cachedStats:c,modalityUnit:C,calibratedScale:T})}return Na(r,o.viewport.element,Ea.StatsUpdated),r.invalidated=!1,c},this._renderStats=(r,i,a,o)=>{const{data:s}=r,c=this.getTargetId(i),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:a.viewport.id},f=this.getLinkedTextBoxStyle(l,r);if(!f.visibility)return;const u=this.configuration.getTextLines(s,c);if(!u||u.length===0)return;const g=s.contour.polyline.map(T=>i.worldToCanvas(T));if(!s.handles.textBox.hasMoved){const T=nre(g);s.handles.textBox.worldPosition=i.canvasToWorld(T)}const d=i.worldToCanvas(s.handles.textBox.worldPosition),p=Nte(o,r.annotationUID??"","1",u,d,g,{},f),{x:m,y:v,width:y,height:C}=p;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([m,v]),topRight:i.canvasToWorld([m+y,v]),bottomLeft:i.canvasToWorld([m,v+C]),bottomRight:i.canvasToWorld([m+y,v+C])}},cne(this),mne(this),Dne(this),Ane(this),Wne(this),tre(this),this._throttledCalculateCachedStats=fte(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,n){if(!n||!n.length)return;const r=le(e),{viewport:i}=r;let a;if(i instanceof Rn){const o=i.getCamera(),{spacingInNormalDirection:s}=Xl(i,o);a=this.filterAnnotationsWithinSlice(n,o,s)}else a=DD(i,n);return a}filterAnnotationsWithinSlice(e,n,r){const{viewPlaneNormal:i}=n,a=e.filter(l=>{const f=l.metadata.viewPlaneNormal,u=Math.abs(fe(i,f))>zre;return f&&u});if(!a.length)return[];const o=r/2,{focalPoint:s}=n,c=[];for(const l of a){const u=l.data.contour.polyline[0];if(!l.isVisible)continue;const g=te();_t(g,s,u);const d=fe(g,i);Math.abs(d)<o&&c.push(l)}return c}isContourSegmentationTool(){return!1}createAnnotation(e){const n=e.detail.currentPoints.world,r=super.createAnnotation(e),i=o=>{o.data.handles.points.length=0};return Zn(r,{data:{contour:{polyline:[[...n]]},label:"",cachedStats:{}},onInterpolationComplete:i})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:n,targetId:r,svgDrawingHelper:i}=e,a=e.annotation;let o=!1;const{viewport:s,renderingEngine:c}=n,l=this.isDrawing,f=this.isEditingOpen,u=this.isEditingClosed;if(!(l||f||u))this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);else{const g=this.commonData.annotation.annotationUID;if(a.annotationUID===g)if(l)this.renderContourBeingDrawn(n,i,a);else if(u)this.renderClosedContourBeingEdited(n,i,a);else if(f)this.renderOpenContourBeingEdited(n,i,a);else throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);else this.configuration.displayOnePointAsCrosshairs&&a.data.contour.polyline.length===1?this.renderPointContourWithMarker(n,i,a):this.renderContour(n,i,a);o=!0}if(this.configuration.calculateStats)return this._calculateStatsIfActive(a,r,s,c,n),this._renderStats(a,s,n,i),o}_calculateStatsIfActive(e,n,r,i,a){var s,c,l;const o=(s=this.commonData)==null?void 0:s.annotation.annotationUID;if(!(e.annotationUID===o&&!((c=this.commonData)!=null&&c.movingTextBox))&&!((l=this.commonData)!=null&&l.movingTextBox)){const{data:f}=e;!f.cachedStats[n]||f.cachedStats[n].areaUnit==null?(f.cachedStats[n]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(e,r,i,a)):e.invalidated&&this._throttledCalculateCachedStats(e,r,i,a)}}updateClosedCachedStats({viewport:e,points:n,imageData:r,metadata:i,cachedStats:a,targetId:o,modalityUnit:s,canvasCoordinates:c,calibratedScale:l}){var ge,Pt,Ae;const{scale:f,areaUnit:u,units:g}=l,{voxelManager:d}=e.getImageData(),h=c[0],p=e.canvasToWorld(h),m=e.canvasToWorld([h[0]+1,h[1]]),v=e.canvasToWorld([h[0],h[1]+1]),y=D1(p,m),C=D1(p,v),T=Ji(r,n[0]);T[0]=Math.floor(T[0]),T[1]=Math.floor(T[1]),T[2]=Math.floor(T[2]);let S=T[0],x=T[0],w=T[1],E=T[1],M=T[2],O=T[2];for(let Dt=1;Dt<n.length;Dt++){const Ge=Ji(r,n[Dt]);Ge[0]=Math.floor(Ge[0]),Ge[1]=Math.floor(Ge[1]),Ge[2]=Math.floor(Ge[2]),S=Math.min(S,Ge[0]),x=Math.max(x,Ge[0]),w=Math.min(w,Ge[1]),E=Math.max(E,Ge[1]),M=Math.min(M,Ge[2]),O=Math.max(O,Ge[2])}const R=Ji(r,n[1]);R[0]=Math.floor(R[0]),R[1]=Math.floor(R[1]),R[2]=Math.floor(R[2]);let _=km(c)/f/f;_*=y*C;const P=.01*(x-S),N=.01*(E-w),W=.01*(O-M);S=Math.floor(S-P),x=Math.ceil(x+P),w=Math.floor(w-N),E=Math.ceil(E+N),M=Math.floor(M-W),O=Math.ceil(O+W);const U=[[S,x],[w,E],[M,O]],K=r.indexToWorld([x,E,O]),A=e.worldToCanvas(K);let b=0,F=[],$=0;const j=d.forEach(this.configuration.statsCalculator.statsCallback,{imageData:r,isInObject:(Dt,Ge)=>{let ot=!0;const me=e.worldToCanvas(Dt);return me[1]!=b&&($=0,b=me[1],F=ED(c,me,[A[0],me[1]]),F.sort(function(Ce){return function(Yt,ka){return Yt[Ce]===ka[Ce]?0:Yt[Ce]<ka[Ce]?-1:1}}(0))),F.length&&me[0]>F[0][0]&&(F.shift(),$++),$%2===0&&(ot=!1),ot},boundsIJK:U,returnPoints:this.configuration.storePointData}),z=this.configuration.statsCalculator.getStatistics();a[o]={Modality:i.Modality,area:_,perimeter:e9(c,closed)/f,mean:(ge=z.mean)==null?void 0:ge.value,max:(Pt=z.max)==null?void 0:Pt.value,stdDev:(Ae=z.stdDev)==null?void 0:Ae.value,statsArray:z.array,pointsInShape:j,areaUnit:u,modalityUnit:s,unit:g}}updateOpenCachedStats({targetId:e,metadata:n,canvasCoordinates:r,cachedStats:i,modalityUnit:a,calibratedScale:o}){const{scale:s,units:c}=o;i[e]={Modality:n.Modality,length:e9(r,!1)/s,modalityUnit:a,getPixelValueUnitunit:c}}}function Hre(t,e){const n=t.cachedStats[e],{area:r,mean:i,stdDev:a,length:o,perimeter:s,max:c,isEmptyArea:l,unit:f,areaUnit:u,modalityUnit:g}=n||{},d=[];if(r){const h=l?"Area: Oblique not supported":`Area: ${qi(r)} ${u}`;d.push(h)}return i&&d.push(`Mean: ${qi(i)} ${g}`),Number.isFinite(c)&&d.push(`Max: ${qi(c)} ${g}`),a&&d.push(`Std Dev: ${qi(a)} ${g}`),s&&d.push(`Perimeter: ${qi(s)} ${f}`),o&&d.push(`${qi(o)} ${f}`),d}AD.toolName="PlanarFreehandROI";class wd extends AD{constructor(e){const n=Zn({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(n)}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const n=e.annotation,{invalidated:r}=n,i=super.renderAnnotationInstance(e);if(r){const{segmentationId:a}=n.data.segmentation;hd(a)}return i}}wd.toolName="PlanarFreehandContourSegmentationTool";function jre(t,e,n){const r=new Map;for(const[i,a]of t)for(const o of a){const{points:s}=o,{lineSegments:c,linesNumberOfPoints:l}=Kre(o);for(let f=0;f<c.length;f++){const u=c[f],g=[];for(let p=0;p<l[f];p++){const m=u[p];g.push([s[3*m],s[3*m+1],s[3*m+2]])}if(g.length<3)continue;const d={annotationUID:bt(),data:{contour:{closed:!0,polyline:g},segmentation:{segmentationId:n,segmentIndex:i},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:wd.toolName,...e.getViewReference()}};U0(d,e.element);const h=r.get(i)||new Set;h.add(d.annotationUID),r.set(i,h)}}return r}const Kre=t=>{const{numberOfCells:e,lines:n}=t,r=[],i=[];for(let a=0;a<n.length;){const o=n[a];if(i.push(o),r.push(n.slice(a+1,a+o+1)),a+=o+1,r.length===e)break}return{lineSegments:r,linesNumberOfPoints:i}};async function qre(t,e={}){var c;const n=(c=e.segmentIndices)!=null&&c.length?e.segmentIndices:Ni(t);let r;const a=ut(t).representationData;try{a.Surface?r=await Yre(t,{segmentIndices:n,...e}):a.Labelmap&&(r=await Xre(t,{segmentIndices:n,...e}))}catch(l){throw console.error(l),l}if(!r)throw new Error("Not enough data to convert to contour, currently only support converting volume labelmap to contour if available");const{viewport:o}=e,s=jre(r,o,t);return xo.setStyle({segmentationId:t,type:se.Contour},{fillAlpha:0}),{annotationUIDsMap:s}}async function Xre(t,e={}){if(!e.viewport)throw new Error("Viewport is required to compute contour from labelmap");const n=await _m(t,e);if(!(n!=null&&n.length)){console.error("Failed to convert labelmap to surface or labelmap is empty");return}const{viewport:r}=e,i=n.map(s=>({id:s.segmentIndex.toString(),points:s.data.points,polys:s.data.polys,segmentIndex:s.segmentIndex})),a=await gD(i,r);return dD(a)}async function Yre(t,e={}){var u;if(!e.viewport)throw new Error("Viewport is required to compute contour from surface");const{viewport:n}=e,r=(u=e.segmentIndices)!=null&&u.length?e.segmentIndices:Ni(t),i=new Map,a=new Map,s=ut(t).representationData.Surface,c=[];s.geometryIds.forEach((g,d)=>{var h;if(r.includes(d)){i.set(d,g);const p=(h=Q.getGeometry(g))==null?void 0:h.data;p&&c.push({id:g,points:p.points,polys:p.polys,segmentIndex:d})}}),i.forEach((g,d)=>{a.set(g,d)});const l=await gD(c,n);return dD(l)}function Zre(t,e={}){return Vm(t,se.Contour,()=>qre(t,e),()=>{})}function Jre(t,e,n=!1){const r=ut(e),{annotationUIDsMap:i}=r.representationData.Contour;i.forEach(a=>{a.forEach(o=>{y0(o)})})}let J2=!1;function Qre(t,e,n=!1){const r=en(t);if(!r)return;const{viewport:i}=r;n&&(Jre(t,e),i.render())}async function eie(t,e){var a;const{segmentationId:n}=e,r=ut(n);if(!r)return;let i=r.representationData[se.Contour];!i&&Im(n,se.Contour)&&!J2&&(J2=!0,i=await Zre(n,{viewport:t}),J2=!1),i&&(a=i.geometryIds)!=null&&a.length&&Pee(t,i.geometryIds,i.annotationUIDsMap,e)}const tie={render:eie,removeRepresentation:Qre};function Il(t,e){return ii.getCurrentLabelmapImageIdForViewport(t,e)}const{uuidv4:BD}=ba;async function nie(t,e,n){const r=le(t),{renderingEngine:i,viewport:a}=r,{id:o}=a,s=!0,c=!1,l=!0;if(a instanceof Fr){const u=rie(e,n);Q.getVolume(u)||await iie(e);const g=[{volumeId:u,visibility:s,blendMode:w1.MAXIMUM_INTENSITY_BLEND,representationUID:`${n}-${se.Labelmap}`}];await MK(i,g,[o],c,l)}else{const u=[{imageId:Il(a.id,n),representationUID:`${n}-${se.Labelmap}`}];await LK(i,u,[o])}hd(n)}function rie(t,e){let{volumeId:n}=t;if(!n){n=BD();const r=ut(e);r.representationData.Labelmap={...r.representationData.Labelmap,volumeId:n},t.volumeId=n,T0(e)}return n}async function iie(t){const e=t;if(!(e.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");return await om(t.volumeId||BD(),e.imageIds)}function aie(t,e){const n=le(t),{viewport:r}=n;r.removeActors([ree(r.id,e)])}function oie(t){return Zh(t)}const GD=_a(),Ys=(t,e)=>{Z(t,X.WEB_WORKER_PROGRESS,{progress:e,type:Uo.POLYSEG_CONTOUR_TO_LABELMAP})};async function sie(t,e={}){var p;const n=e.viewport,r=n.getVolumeId();if(!OE(n))throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");const a=bt(),o=Yw(r,{volumeId:a}),{dimensions:s,origin:c,direction:l,spacing:f,voxelManager:u}=o,{segmentIndices:g,annotationUIDsInSegmentMap:d}=WD(t,e);Ys(Y,0);const h=await GD.executeTask("polySeg","convertContourToVolumeLabelmap",{segmentIndices:g,dimensions:s,scalarData:(p=u.getCompleteScalarDataArray)==null?void 0:p.call(u),origin:c,direction:l,spacing:f,annotationUIDsInSegmentMap:d},{callbacks:[m=>{Ys(Y,m)}]});return Ys(Y,100),u.setCompleteScalarDataArray(h),o.modified(),{volumeId:o.volumeId}}async function cie(t,e={}){if(!e.viewport)throw new Error("No viewport provided, labelmap computation from contour requires viewports");const r=e.viewport.getImageIds();if(!r)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");r.forEach(u=>{if(!Q.getImageLoadObject(u))throw new Error("ImageIds must be cached before converting contour to labelmap")});const a=(await yC(r)).map(u=>u.imageId),{segmentIndices:o,annotationUIDsInSegmentMap:s}=WD(t,e),c=new Map;a.forEach((u,g)=>{const d=Q.getImage(u),h=ee(En.IMAGE_PLANE,u);let{columnCosines:p,rowCosines:m,rowPixelSpacing:v,columnPixelSpacing:y,imagePositionPatient:C}=h;p=p??[0,1,0],m=m??[1,0,0],v=v??1,y=y??1,C=C??[0,0,0];const T=Ze(m[0],m[1],m[2]),S=Ze(p[0],p[1],p[2]),x=te();vt(x,T,S);const w=[...T,...S,...x],E=[v,y,1],M=C;c.set(r[g],{direction:w,spacing:E,origin:M,scalarData:d.voxelManager.getScalarData(),imageId:u,dimensions:[d.width,d.height,1]})}),Ys(Y,0);const l=await GD.executeTask("polySeg","convertContourToStackLabelmap",{segmentationsInfo:c,annotationUIDsInSegmentMap:s,segmentIndices:o},{callbacks:[u=>{Ys(Y,u)}]});Ys(Y,100);const f=[];return l.forEach(({scalarData:u},g)=>{var m,v;const d=c.get(g),{imageId:h}=d,p=Q.getImage(h);p.voxelManager.getScalarData().set(u),(v=(m=p.imageFrame)==null?void 0:m.pixelData)==null||v.set(u),f.push(h)}),{imageIds:f}}function WD(t,e={}){var a;const n=t.annotationUIDsMap,r=(a=e.segmentIndices)!=null&&a.length?e.segmentIndices:Array.from(n.keys()),i=new Map;return r.forEach(o=>{const s=n.get(o);let c=Array.from(s);c=c.filter(f=>!zt(f).parentAnnotationUID);const l=c.map(f=>{var d;const u=zt(f),g=(d=u.childAnnotationUIDs)==null?void 0:d.length;return{polyline:u.data.contour.polyline,referencedImageId:u.metadata.referencedImageId,holesPolyline:g&&u.childAnnotationUIDs.map(h=>zt(h).data.contour.polyline)}});i.set(o,l)}),{segmentIndices:r,annotationUIDsInSegmentMap:i}}const lie=_a(),Q2=(t,e)=>{Z(t,X.WEB_WORKER_PROGRESS,{progress:e,type:Uo.POLYSEG_SURFACE_TO_LABELMAP})};async function uie(t,e){const{geometryIds:n}=t;if(!(n!=null&&n.size))throw new Error("No geometry IDs found for surface representation");const r=new Map;n.forEach((f,u)=>{const d=Q.getGeometry(f).data,h=d.points,p=d.polys;r.set(u,{points:h,polys:p})});const{dimensions:i,direction:a,origin:o,spacing:s,voxelManager:c}=e;Q2(Y,0);const l=await lie.executeTask("polySeg","convertSurfacesToVolumeLabelmap",{segmentsInfo:r,dimensions:i,spacing:s,direction:a,origin:o},{callbacks:[f=>{Q2(Y,f)}]});return Q2(Y,100),c.setCompleteScalarDataArray(l),e.modified(),{volumeId:e.volumeId}}async function fie({volumeId:t}){return{imageIds:Q.getVolume(t).imageIds}}async function gie(t,e={}){var o;const n=(o=e.segmentIndices)!=null&&o.length?e.segmentIndices:Ni(t);let r;const i=ut(t),a=i.representationData;try{a.Contour?r=await die(t,{segmentIndices:n,...e}):a.Surface&&(r=await pie(i.segmentationId,{segmentIndices:n,...e}))}catch(s){throw console.error(s),s}if(!r)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return r}async function die(t,e={}){var c;const n=e.viewport instanceof Rn;if(n&&!e.viewport)throw new Error("Cannot compute labelmap from contour segmentation without providing the viewport");const r=(c=e.segmentIndices)!=null&&c.length?e.segmentIndices:Ni(t),a=ut(t).representationData.Contour;return await(n?sie:cie)(a,{segmentIndices:r,viewport:e.viewport})}async function pie(t,e={}){var u;const{viewport:n}=e,r=n instanceof Rn,i=(u=e.segmentIndices)!=null&&u.length?e.segmentIndices:Ni(t),a=ut(t),o=new Map;if(a.representationData.Surface.geometryIds.forEach((g,d)=>{i.includes(d)&&o.set(d,g)}),r&&!n)throw new Error("Cannot compute labelmap from surface segmentation without providing the viewport");let c;if(r){const g=n.getVolumeId();c=await Yw(g)}else{const g=e.viewport.getImageIds(),h=yC(g).map(p=>p.imageId);c=await om("generatedSegmentationVolumeId",h)}const l=await uie({geometryIds:o},c);return r?l:await fie({volumeId:c.volumeId})}async function hie(t,e={}){return Vm(t,se.Labelmap,()=>gie(t,e),()=>null,()=>{ii.processLabelmapRepresentationAddition(e.viewport.id,t),setTimeout(()=>{hd(t)},0)})}const ep=255,zc=new Map;let tp=!1;function mie(t,e,n=!1){const r=en(t);if(zc.forEach((a,o)=>{o.includes(e)&&zc.delete(o)}),!r)return;const{viewport:i}=r;aie(i.element,e),n&&i.render()}async function vie(t,e){const{segmentationId:n}=e,r=ut(n);if(!r){console.warn("No segmentation found for segmentationId: ",n);return}let i=r.representationData[se.Labelmap],a=Ks(t.id,n);if(!i&&Im(n,se.Labelmap)&&!tp){if(tp=!0,i=await hie(n,{viewport:t}),!i)throw new Error(`No labelmap data found for segmentationId ${n}.`);tp=!1}if(i){if(t instanceof Rn)a||await h9(t,i,n),a=Ks(t.id,n);else{if(!Il(t.id,n))return;a||await h9(t,i,n),a=Ks(t.id,n)}a&&yie(t.id,a,e)}}function yie(t,e,n){const{segmentationId:r}=n,{cfun:i,ofun:a}=n.config,{colorLUTIndex:o}=n,s=oie(t),c=(s==null?void 0:s.segmentationId)===r,l=xo.getStyle({viewportId:t,type:se.Labelmap,segmentationId:r}),f=xo.getRenderInactiveSegmentations(t),u=Lm(o),g=Math.min(256,u.length),{outlineWidth:d,renderOutline:h,outlineOpacity:p,activeSegmentOutlineWidthDelta:m}=p9(l,c),v=UD(t,{segmentationId:r,type:se.Labelmap});for(let T=0;T<g;T++){const S=T,x=u[S],E=xo.getStyle({viewportId:t,type:se.Labelmap,segmentationId:r,segmentIndex:S}),{fillAlpha:M,outlineWidth:O,renderFill:R,renderOutline:_}=p9(l,c,E),{forceOpacityUpdate:P,forceColorUpdate:N}=Cie(t,r,S,{fillAlpha:M,renderFill:R,renderOutline:_,segmentColor:x,outlineWidth:O,segmentsHidden:v,cfun:i,ofun:a});if(N&&i.addRGBPoint(S,x[0]/ep,x[1]/ep,x[2]/ep),P)if(R){const W=v.has(S)?0:x[3]/255*M;a.removePoint(S),a.addPointLong(S,W,.5,1)}else a.addPointLong(S,.01,.5,1)}const y=e.actor;if(y.getProperty().setRGBTransferFunction(0,i),a.setClamping(!1),y.getProperty().setScalarOpacity(0,a),y.getProperty().setInterpolationTypeToNearest(),h){y.getProperty().setUseLabelOutline(h),y.getProperty().setLabelOutlineOpacity(p);const T=Jh(n.segmentationId),S=new Array(g-1);for(let x=1;x<g;x++){if(v.has(x)){S[x-1]=0;continue}S[x-1]=x===T?d+m:d}y.getProperty().setLabelOutlineThickness(S)}else y.getProperty().setLabelOutlineThickness(new Array(g-1).fill(0));const C=c||f;y.setVisibility(C)}function p9(t,e,n){const i={...t,...n||{}},a=e?i.fillAlpha:i.fillAlphaInactive,o=e?i.outlineWidth:i.outlineWidthInactive,s=e?i.renderFill:i.renderFillInactive,c=e?i.renderOutline:i.renderOutlineInactive,l=e?i.outlineOpacity:i.outlineOpacityInactive,f=i.activeSegmentOutlineWidthDelta;return{fillAlpha:a,outlineWidth:o,renderFill:s,renderOutline:c,outlineOpacity:l,activeSegmentOutlineWidthDelta:f}}function Cie(t,e,n,{fillAlpha:r,renderFill:i,renderOutline:a,segmentColor:o,outlineWidth:s,segmentsHidden:c,cfun:l,ofun:f}){const u=`${t}-${e}-${n}`,g=zc.get(u);if(!g)return zc.set(u,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:d,renderFill:h,renderOutline:p,outlineWidth:m,segmentColor:v,segmentsHidden:y,cfunMTime:C,ofunMTime:T}=g,S=v[0]!==o[0]||v[1]!==o[1]||v[2]!==o[2],x=v[3]!==o[3]||d!==r||h!==i||p!==a||m!==s||y!==c;return(x||S)&&zc.set(u,{fillAlpha:r,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:o.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:x,forceColorUpdate:S}}async function h9(t,e,n){await nie(t.element,e,n)}const Tie={render:vie,removeRepresentation:mie},Sie={[se.Labelmap]:Tie,[se.Contour]:tie,[se.Surface]:Iee},gf=wd.toolName;class xie{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>kr().flatMap(n=>n.getViewports()),this._renderFlaggedSegmentations=()=>{this._throwIfDestroyed(),Array.from(this._needsRender).forEach(n=>{this._triggerRender(n)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}renderSegmentationsForViewport(e){const n=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(n)}renderSegmentation(e){const n=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(n)}_getViewportIdsForSegmentation(e){const n=this._getAllViewports(),r=[];for(const i of n){const a=i.id;if(e){const o=wo(a,{segmentationId:e});(o==null?void 0:o.length)>0&&r.push(a)}else{const o=wo(a);(o==null?void 0:o.length)>0&&r.push(a)}}return r}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const n=wo(e);if(!(n!=null&&n.length))return;const{viewport:r}=en(e)||{};if(!r)return;const i=[],a=n.map(o=>{o.type===se.Contour&&this._addPlanarFreeHandToolIfAbsent(r);const s=Sie[o.type];try{const c=s.render(r,o);i.push(c)}catch(c){console.error(c)}return Promise.resolve({segmentationId:o.segmentationId,type:o.type})});Promise.allSettled(a).then(o=>{const s=o.filter(f=>f.status==="fulfilled").map(f=>f.value);function c(f){const{element:u,viewportId:g}=f.detail;u.removeEventListener(X.IMAGE_RENDERED,c),s.forEach(d=>{const h={viewportId:g,segmentationId:d.segmentationId,type:d.type};Z(Y,H.SEGMENTATION_RENDERED,{...h})})}r.element.addEventListener(X.IMAGE_RENDERED,c),r.render()})}_addPlanarFreeHandToolIfAbsent(e){gf in ce.tools||xO(wd);const n=yn(e.id);n.hasTool(gf)||(n.addTool(gf),n.setToolPassive(gf))}}function $D(t){HD.renderSegmentationsForViewport(t)}function zD(t){HD.renderSegmentation(t)}const HD=new xie;function wie(t,e){return ii.updateLabelmapSegmentationImageReferences(t,e)}const Eie=function(t){const{segmentationId:e,modifiedSlicesToUse:n}=t.detail,{representationData:r}=ut(e),i=bm(e),a=i.some(c=>{const{viewport:l}=en(c);return l instanceof Rn}),o=i.some(c=>{const{viewport:l}=en(c);return l instanceof fr}),s=a&&o;i.forEach(c=>{const{viewport:l}=en(c);l instanceof Rn&&Oie({modifiedSlicesToUse:s?[]:n,representationData:r,type:se.Labelmap}),l instanceof fr&&Die({viewportIds:i,segmentationId:e})})};function Oie({modifiedSlicesToUse:t,representationData:e,type:n}){const r=Q.getVolume(e[n].volumeId);if(!r){console.warn("segmentation not found in cache");return}const{imageData:i,vtkOpenGLTexture:a}=r;let o;if((t==null?void 0:t.length)>0)o=t;else{const s=i.getDimensions()[2];o=[...Array(s).keys()]}o.forEach(s=>{a.setUpdatedFrame(s)}),i.modified()}function Die({viewportIds:t,segmentationId:e}){t.forEach(n=>{let r=wo(n,{segmentationId:e});r=r.filter(i=>i.type===se.Labelmap),r.forEach(i=>{if(i.segmentationId!==e)return;const a=en(n);if(!a)return;const{viewport:o}=a;if(o instanceof Rn)return;const s=Ks(n,e);if(!s)return;const c=s.actor.getMapper().getInputData(),l=Il(n,e),f=Q.getImage(l);c.modified(),ad(c,f)})})}const jD=function(t){const{segmentationId:e}=t.detail,{representationData:n}=ut(e);n.Labelmap&&Eie(t),zD(e)},KD=function(t){const{segmentationId:e}=t.detail;zD(e)},Rie=function(t){const{viewport:e}=le(t);e instanceof Fr||(t.addEventListener(X.STACK_NEW_IMAGE,Vl),t.addEventListener(X.IMAGE_RENDERED,Vl))},Mie=function(t){t.removeEventListener(X.STACK_NEW_IMAGE,Vl),t.removeEventListener(X.IMAGE_RENDERED,Vl)};function Vl(t){const e=t.detail,{viewportId:n,renderingEngineId:r}=e,{viewport:i}=Yl(n,r),a=wo(n);if(!(a!=null&&a.length))return;const o=a.filter(l=>l.type===se.Labelmap),s=i.getActors();o.forEach(l=>{const{segmentationId:f}=l;wie(n,f)});const c=o.map(l=>Ks(n,l.segmentationId)).filter(l=>l!==void 0);c.length&&(c.forEach(l=>{o.find(u=>Il(n,u.segmentationId)===l.referencedId)||i.removeActors([l.uid])}),o.forEach(l=>{const{segmentationId:f}=l,u=i.getCurrentImageId(),g=Il(n,f);if(!g)return;const d=Q.getImage(g);if(!d){console.warn("No derived image found in the cache for segmentation representation",l);return}const h=s.find(p=>p.referencedId===g);if(h){const p=h.actor.getMapper().getInputData();p.setDerivedImage?p.setDerivedImage(d):ad(p,d)}else{const{dimensions:p,spacing:m,direction:v}=i.getImageDataMetadata(d),y=Q.getImage(u)||{imageId:u},{origin:C}=i.getImageDataMetadata(y),T=C,S=d.voxelManager.getConstructor(),x=d.voxelManager.getScalarData(),w=he.newInstance({name:"Pixels",numberOfComponents:1,values:new S(x)}),E=Kg.newInstance();E.setDimensions(p[0],p[1],1),E.setSpacing(m),E.setDirection(v),E.setOrigin(T),E.getPointData().setScalars(w),E.modified(),i.addImages([{imageId:g,representationUID:`${f}-${se.Labelmap}`,callback:({imageActor:M})=>{M.getMapper().setInputData(E)}}]),$D(n);return}i.render(),t.type===X.IMAGE_RENDERED&&i.element.removeEventListener(X.IMAGE_RENDERED,Vl)}))}const qD={enable:Rie,disable:Mie};function Lie(t){const e=t.detail.annotation;Nm(e)}function XD(t){const e=t.detail.annotation;md(e)&&Cre(t)}function vg(t){if(!t.detail.removed.length)return;kr().forEach(r=>{const a=r.getViewports().map(o=>o.id);Vn(a)})}function YD(t){const{viewportId:e}=t.detail;Vn([e])}function Iie(t){const e=t.detail.annotation;md(e)&&Lie(t)}const ZD=function(t){nu(t.detail.element)},Vie=function(t){t.addEventListener(X.IMAGE_RENDERED,ZD)},_ie=function(t){t.removeEventListener(X.IMAGE_RENDERED,ZD)},JD={enable:Vie,disable:_ie},{Active:bie}=Qe;function B0(t,e,n){if(ce.isInteractingWithTool)return!1;const{renderingEngineId:r,viewportId:i}=n.detail,a=yn(i,r);if(!a)return!1;let o;const s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=a.getToolInstance(l);if(f.mode===bie&&typeof u[e]=="function"){o=a.getToolInstance(l);break}}o&&o[e](n)}const QD=B0.bind(null,"Mouse","mouseClickCallback"),eR=B0.bind(null,"Mouse","doubleClickCallback");function tR(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const l=o.getHandleNearImagePoint(t,c,n,i);if(l){a.push({tool:o,annotation:c,handle:l});break}}}),a}function Ed(t,e){const n=[];for(let r=0;r<e.length;r++){const i=e[r];if(!i){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let a=v0(i.constructor.toolName,t);a!=null&&a.length&&(typeof i.filterInteractableAnnotationsForElement=="function"&&(a=i.filterInteractableAnnotationsForElement(t,a)),a.length>0&&n.push({tool:i,annotations:a}))}return n}function Hm(t,e,n,r="mouse"){const i=r==="touch"?36:6,a=[];return e.forEach(({tool:o,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(o.isPointNearTool(t,c,n,i,r)){a.push({tool:o,annotation:c});break}}}),a}const{Active:Nie}=Qe;function Od(t){const{renderingEngineId:e,viewportId:n,event:r}=t.detail,i=Td(r)||A0.getModifierKey(),a=yn(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.buttons??(r==null?void 0:r.buttons)??s;for(let l=0;l<o.length;l++){const f=o[l],u=a.toolOptions[f],g=u.bindings.length&&u.bindings.some(d=>d.mouseButton===c&&d.modifierKey===i);if(u.mode===Nie&&g)return a.getToolInstance(f)}}function w0(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=yn(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=n!=null&&f.bindings.length&&f.bindings.some(g=>g.mouseButton===n);if(e.includes(f.mode)&&(!n||u)){const g=a.getToolInstance(l);o.push(g)}}return o}function Pie(t,e){var u;const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=yn(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary(),c=t.detail.event,l=(c==null?void 0:c.buttons)??s,f=Td(c)||A0.getModifierKey();for(let g=0;g<o.length;g++){const d=o[g],h=a.getToolInstance(d),p=((u=h.configuration)==null?void 0:u.actions)??{},m=Object.values(p);if(!(m!=null&&m.length)||!e.includes(h.mode))continue;const v=m.find(y=>y.bindings.length&&y.bindings.some(C=>C.mouseButton===l&&C.modifierKey===f));v&&n.set(h,v)}return n}const{Active:kie,Passive:Fie}=Qe;function Uie(t){if(ce.isInteractingWithTool)return!1;const e=t.detail,{element:n}=e,r=le(n),{canvas:i}=e.currentPoints;if(!r)return!1;const a=Pie(t,[kie,Fie]),o=Array.from(a.keys()),s=Ed(n,o),c=Hm(n,s,i);if(c.length>0){const{tool:l,annotation:f}=c[0],u=a.get(l);return(typeof u.method=="string"?l[u.method]:u.method).call(l,t,f),!0}return!1}const{Active:Aie,Passive:Bie}=Qe;function nR(t){if(ce.isInteractingWithTool)return;const e=Od(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const n=t.detail.event.buttons===1,r=w0(t,[Aie],t.detail.event.buttons),i=n?w0(t,[Bie]):void 0,a=[...r||[],...i||[]];if(Uie(t))return;const s=t.detail,{element:c}=s,l=Ed(c,a),f=s.currentPoints.canvas,u=tR(c,l,f,"mouse"),g=!!t.detail.event.shiftKey;if(u.length>0){const{tool:h,annotation:p,handle:m}=m9(u);v9(p.annotationUID,g),h.handleSelectedCallback(t,p,m,"Mouse");return}const d=Hm(c,l,f,"mouse");if(d.length>0){const{tool:h,annotation:p}=m9(d);v9(p.annotationUID,g),h.toolSelectedCallback(t,p,"Mouse",f);return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function m9(t){if(t.length>1){const e=t.find(n=>{const r=!m0(n.annotation.annotationUID),i=gg(n.annotation.annotationUID);return r&&i});if(e)return e}return t[0]}function v9(t,e=!1){e?fd(t)?va(t,!1):va(t,!0,!0):va(t,!0,!1)}function rR(t){if(ce.isInteractingWithTool)return;const e=Od(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"mouse");va(n.annotationUID)}}function iR(t){if(ce.isInteractingWithTool)return;const e=Od(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:Gie,Passive:Wie}=Qe;function aR(t){if(ce.isInteractingWithTool||ce.isMultiPartToolActive)return;const e=w0(t,[Gie,Wie]),n=t.detail,{element:r}=n,i=Ed(r,e),a=e.filter(s=>!i.some(l=>l.tool.getToolName()===s.getToolName()));let o=!1;for(const{tool:s,annotations:c}of i)typeof s.mouseMoveCallback=="function"&&(o=s.mouseMoveCallback(t,c)||o);a.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),o===!0&&nu(r)}const oR=B0.bind(null,"Mouse","mouseUpCallback");function sR(t){if(ce.isInteractingWithTool)return;t.detail.buttons=Fo.Wheel|(t.detail.event.buttons||0);const e=Od(t);if(e)return e.mouseWheelCallback(t)}const $ie=function(t){t.addEventListener(H.MOUSE_CLICK,QD),t.addEventListener(H.MOUSE_DOWN,nR),t.addEventListener(H.MOUSE_DOWN_ACTIVATE,rR),t.addEventListener(H.MOUSE_DOUBLE_CLICK,eR),t.addEventListener(H.MOUSE_DRAG,iR),t.addEventListener(H.MOUSE_MOVE,aR),t.addEventListener(H.MOUSE_UP,oR),t.addEventListener(H.MOUSE_WHEEL,sR)},zie=function(t){t.removeEventListener(H.MOUSE_CLICK,QD),t.removeEventListener(H.MOUSE_DOWN,nR),t.removeEventListener(H.MOUSE_DOWN_ACTIVATE,rR),t.removeEventListener(H.MOUSE_DOUBLE_CLICK,eR),t.removeEventListener(H.MOUSE_DRAG,iR),t.removeEventListener(H.MOUSE_MOVE,aR),t.removeEventListener(H.MOUSE_UP,oR),t.removeEventListener(H.MOUSE_WHEEL,sR)},cR={enable:$ie,disable:zie},{Active:Hie}=Qe;function lR(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=DQ(),i=A0.getModifierKey(),a=yn(n,e);if(!a)return null;const o=Object.keys(a.toolOptions),s=a.getDefaultMousePrimary();for(let c=0;c<o.length;c++){const l=o[c],f=a.toolOptions[l];if(f.mode!==Hie)continue;if(f.bindings.length&&f.bindings.some(g=>g.mouseButton===(r??s)&&g.modifierKey===i))return a.getToolInstance(l)}}function jie(t,e){var c;const n=new Map,{renderingEngineId:r,viewportId:i}=t.detail,a=yn(i,r);if(!a)return n;const o=Object.keys(a.toolOptions),s=t.detail.key;for(let l=0;l<o.length;l++){const f=o[l],u=a.getToolInstance(f),g=(c=u.configuration)==null?void 0:c.actions;if(!g)continue;const d=Object.values(g);if(!(d!=null&&d.length)||!e.includes(u.mode))continue;const h=d.find(p=>p.bindings.some(m=>m.key===s));h&&n.set(u,h)}return n}function uR(t){const e=lR(t);if(e){const{renderingEngineId:r,viewportId:i}=t.detail,a=yn(i,r),o=e.getToolName();Object.keys(a.toolOptions).includes(o)&&a.setViewportsCursorByToolName(o)}const n=jie(t,[Qe.Active]);if(n!=null&&n.size){const{element:r}=t.detail;for(const[i,a]of[...n.entries()])(typeof a.method=="function"?a.method:i[a.method]).call(i,r,a,t)}}function fR(t){const e=lR(t);if(!e)return;const{renderingEngineId:n,viewportId:r}=t.detail,i=yn(r,n);eD();const a=e.getToolName();Object.keys(i.toolOptions).includes(a)&&i.setViewportsCursorByToolName(a)}const Kie=function(t){t.addEventListener(H.KEY_DOWN,uR),t.addEventListener(H.KEY_UP,fR)},qie=function(t){t.removeEventListener(H.KEY_DOWN,uR),t.removeEventListener(H.KEY_UP,fR)},gR={enable:Kie,disable:qie},{Active:Xie,Passive:Yie,Enabled:Zie}=Qe,dR=function(t){w0(t,[Xie,Yie,Zie]).forEach(n=>{n.onCameraModified&&n.onCameraModified(t)})},Jie=function(t){t.addEventListener(X.CAMERA_MODIFIED,dR)},Qie=function(t){t.removeEventListener(X.CAMERA_MODIFIED,dR)},pR={enable:Jie,disable:Qie},{Active:eae,Passive:tae,Enabled:nae}=Qe,hR=function(t){w0(t,[eae,tae,nae]).forEach(n=>{n.onImageSpacingCalibrated&&n.onImageSpacingCalibrated(t)})},rae=function(t){t.addEventListener(X.IMAGE_SPACING_CALIBRATED,hR)},iae=function(t){t.removeEventListener(X.IMAGE_SPACING_CALIBRATED,hR)},mR={enable:rae,disable:iae},{Active:aae}=Qe;function jm(t){const{renderingEngineId:e,viewportId:n}=t.detail,r=t.detail.event,i=yn(n,e);if(!i)return null;const a=Object.keys(i.toolOptions),o=Object.keys(r.touches).length,s=Td(r)||A0.getModifierKey(),c=i.getDefaultMousePrimary();for(let l=0;l<a.length;l++){const f=a[l],u=i.toolOptions[f],g=u.bindings.length&&u.bindings.some(d=>(d.numTouchPoints===o||o===1&&d.mouseButton===c)&&d.modifierKey===s);if(u.mode===aae&&g)return i.getToolInstance(f)}}function y9(t,e,n){const{renderingEngineId:r,viewportId:i}=t.detail,a=yn(i,r);if(!a)return[];const o=[],s=Object.keys(a.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=a.toolOptions[l],u=n!=null&&f.bindings.length&&f.bindings.some(g=>g.numTouchPoints===n);if(e.includes(f.mode)&&(!n||u)){const g=a.getToolInstance(l);o.push(g)}}return o}const{Active:oae,Passive:sae}=Qe;function vR(t){if(ce.isInteractingWithTool)return;const e=jm(t);if(e&&typeof e.preTouchStartCallback=="function"&&e.preTouchStartCallback(t))return;const n=Object.keys(t.detail.event.touches).length===1,r=y9(t,[oae],Object.keys(t.detail.event.touches).length),i=n?y9(t,[sae]):void 0,a=[...r||[],...i||[],e],o=t.detail,{element:s}=o,c=Ed(s,a),l=o.currentPoints.canvas,f=tR(s,c,l,"touch"),u=!1;if(f.length>0){const{tool:d,annotation:h,handle:p}=C9(f);T9(h.annotationUID,u),d.handleSelectedCallback(t,h,p,"Touch");return}const g=Hm(s,c,l,"touch");if(g.length>0){const{tool:d,annotation:h}=C9(g);T9(h.annotationUID,u),d.toolSelectedCallback(t,h,"Touch");return}e&&typeof e.postTouchStartCallback=="function"&&e.postTouchStartCallback(t)}function C9(t){return t.length>1&&t.find(e=>!m0(e.annotation.annotationUID)&&gg(e.annotation.annotationUID))||t[0]}function T9(t,e=!1){e?fd(t)?va(t,!1):va(t,!0,!0):va(t,!0,!1)}function yR(t){if(ce.isInteractingWithTool)return;const e=jm(t);if(e&&e.addNewAnnotation){const n=e.addNewAnnotation(t,"touch");va(n.annotationUID)}}function CR(t){if(ce.isInteractingWithTool)return;const e=jm(t);!e||typeof e.touchDragCallback!="function"||e.touchDragCallback(t)}const TR=B0.bind(null,"Touch","touchEndCallback"),cae=B0.bind(null,"Touch","touchTapCallback"),SR=B0.bind(null,"Touch","touchPressCallback"),lae=function(t){t.addEventListener(H.TOUCH_START,vR),t.addEventListener(H.TOUCH_START_ACTIVATE,yR),t.addEventListener(H.TOUCH_DRAG,CR),t.addEventListener(H.TOUCH_END,TR),t.addEventListener(H.TOUCH_TAP,cae),t.addEventListener(H.TOUCH_PRESS,SR)},uae=function(t){t.removeEventListener(H.TOUCH_START,vR),t.removeEventListener(H.TOUCH_START_ACTIVATE,yR),t.removeEventListener(H.TOUCH_DRAG,CR),t.removeEventListener(H.TOUCH_END,TR),t.removeEventListener(H.TOUCH_PRESS,SR)},xR={enable:lae,disable:uae},fae=function(){Y.addEventListener(H.ANNOTATION_COMPLETED,Oi.handleAnnotationCompleted),Y.addEventListener(H.ANNOTATION_MODIFIED,Oi.handleAnnotationUpdate),Y.addEventListener(H.ANNOTATION_REMOVED,Oi.handleAnnotationDelete)},gae=function(){Y.removeEventListener(H.ANNOTATION_COMPLETED,Oi.handleAnnotationCompleted),Y.removeEventListener(H.ANNOTATION_MODIFIED,Oi.handleAnnotationUpdate),Y.removeEventListener(H.ANNOTATION_REMOVED,Oi.handleAnnotationDelete)},wR={enable:fae,disable:gae},{Active:dae,Passive:pae,Enabled:hae}=Qe,ER=function(t){w0(t,[dae,pae,hae]).forEach(n=>{n.onResetCamera&&n.onResetCamera(t)})},mae=function(t){t.addEventListener(X.CAMERA_RESET,ER)},vae=function(t){t.removeEventListener(X.CAMERA_RESET,ER)},OR={enable:mae,disable:vae};function DR(t){const{element:e,viewportId:n}=t.detail,r=yae(n);Cae(e),Tae(r,e),Bm.addViewportElement(n,e),_O.enable(e),JO.enable(e),XO.enable(e),A0.enable(e),qD.enable(e),JD.enable(e),pR.enable(e),mR.enable(e),OR.enable(e),cR.enable(e),gR.enable(e),xR.enable(e),ce.enabledElements.push(e)}function yae(t){const e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg"),r=`svg-layer-${t}`;n.classList.add("svg-layer"),n.setAttribute("id",r),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.position="absolute";const i=document.createElementNS(e,"defs"),a=document.createElementNS(e,"filter"),o=document.createElementNS(e,"feOffset"),s=document.createElementNS(e,"feColorMatrix"),c=document.createElementNS(e,"feBlend");return a.setAttribute("id",`shadow-${r}`),a.setAttribute("filterUnits","userSpaceOnUse"),o.setAttribute("result","offOut"),o.setAttribute("in","SourceGraphic"),o.setAttribute("dx","0.5"),o.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),a.appendChild(o),a.appendChild(s),a.appendChild(c),i.appendChild(a),n.appendChild(i),n}function Cae(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;ce.svgNodeCache[r]={}}function Tae(t,e){e.querySelector("div.viewport-element").appendChild(t)}function Sae(t,e){const n=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let r=0;r<ce.synchronizers.length;r++){const i=ce.synchronizers[r],a=!i.isDisabled(),o=i.hasSourceViewport(e,t),s=i.hasTargetViewport(e,t);a&&(o||s)&&n.push(i)}return n}const xae="viewport-element";function RR(t){const{element:e,viewportId:n}=t.detail;Oae(e),Dae(e),Bm.removeViewportElement(n,e),_O.disable(e),JO.disable(e),XO.disable(e),A0.disable(e),qD.disable(e),JD.disable(e),pR.disable(e),mR.disable(e),OR.disable(e),cR.disable(e),gR.disable(e),xR.disable(e),wae(e),Eae(e),Rae(e)}const wae=t=>{const e=le(t);Sae(e.viewportId,e.renderingEngineId).forEach(r=>{r.remove(e)})},Eae=t=>{const{renderingEngineId:e,viewportId:n}=le(t),r=yn(n,e);r&&r.removeViewports(e,n)};function Oae(t){const{viewportUid:e,renderingEngineUid:n}=t.dataset,r=`${e}:${n}`;delete ce.svgNodeCache[r]}function Dae(t){const e=t.querySelector(`div.${xae}`),n=e.querySelector("svg");n&&e.removeChild(n)}const Rae=function(t){const e=ce.enabledElements.findIndex(n=>n===t);e>-1&&ce.enabledElements.splice(e,1)},yg=function(t){const{viewportId:e}=t.detail;$D(e)};let S9=!1;function Mae(t={}){S9||(Lae(),Vae(),S9=!0)}function Lae(){Iae();const t=X.ELEMENT_ENABLED,e=X.ELEMENT_DISABLED;Y.addEventListener(t,DR),Y.addEventListener(e,RR),wR.enable()}function Iae(){const t=X.ELEMENT_ENABLED,e=X.ELEMENT_DISABLED;Y.removeEventListener(t,DR),Y.removeEventListener(e,RR),wR.disable()}function Vae(){_ae(),Y.addEventListener(H.ANNOTATION_COMPLETED,XD),Y.addEventListener(H.ANNOTATION_MODIFIED,YD),Y.addEventListener(H.ANNOTATION_SELECTION_CHANGE,vg),Y.addEventListener(H.ANNOTATION_SELECTION_CHANGE,vg),Y.addEventListener(H.ANNOTATION_REMOVED,Iie),Y.addEventListener(H.SEGMENTATION_MODIFIED,KD),Y.addEventListener(H.SEGMENTATION_DATA_MODIFIED,jD),Y.addEventListener(H.SEGMENTATION_REPRESENTATION_MODIFIED,yg),Y.addEventListener(H.SEGMENTATION_REPRESENTATION_ADDED,yg)}function _ae(){Y.removeEventListener(H.ANNOTATION_COMPLETED,XD),Y.removeEventListener(H.ANNOTATION_MODIFIED,YD),Y.removeEventListener(H.ANNOTATION_SELECTION_CHANGE,vg),Y.removeEventListener(H.ANNOTATION_SELECTION_CHANGE,vg),Y.removeEventListener(H.SEGMENTATION_MODIFIED,KD),Y.removeEventListener(H.SEGMENTATION_DATA_MODIFIED,jD),Y.removeEventListener(H.SEGMENTATION_REPRESENTATION_MODIFIED,yg),Y.removeEventListener(H.SEGMENTATION_REPRESENTATION_ADDED,yg)}const np=4,bae=1024,Nae="PT";class Cg extends $m{constructor(e={},n={supportedInteractionTypes:["Mouse","Touch"]}){super(e,n),this._getImageDynamicRangeFromMiddleSlice=(r,i)=>{const a=Math.floor(i[2]/2),o=i[0]*i[1];let s,c;r instanceof Float32Array?(s=4,c=Float32Array):r instanceof Uint8Array?(s=1,c=Uint8Array):r instanceof Uint16Array?(s=2,c=Uint16Array):r instanceof Int16Array&&(s=2,c=Int16Array);const l=r.buffer,f=a*o*s,u=new c(l,f,o),{max:g,min:d}=this._getMinMax(u,o);return g-d}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){var h,p;const{element:n,deltaPoints:r}=e.detail,i=le(n),{viewport:a}=i;let o,s,c,l,f,u,g=!1;const d=a.getProperties();if(a instanceof Rn){o=a.getVolumeId(),u=id(o),{lower:s,upper:c}=d.voiRange;const m=Q.getVolume(o);if(!m)throw new Error("Volume not found "+o);l=m.metadata.Modality,g=m.scaling&&Object.keys(m.scaling).length>0}else if(d.voiRange){l=a.modality,{lower:s,upper:c}=d.voiRange;const{preScale:m={scaled:!1}}=((h=a.getImageData)==null?void 0:h.call(a))||{};g=m.scaled&&((p=m.scalingParameters)==null?void 0:p.suvbw)!==void 0}else throw new Error("Viewport is not a valid type");if(l===Nae&&g?f=this.getPTScaledNewRange({deltaPointsCanvas:r.canvas,lower:s,upper:c,clientHeight:n.clientHeight,isPreScaled:g,viewport:a,volumeId:o}):f=this.getNewRange({viewport:a,deltaPointsCanvas:r.canvas,volumeId:o,lower:s,upper:c}),!(f.lower>=f.upper)&&(a.setProperties({voiRange:f}),a.render(),a instanceof Rn)){u.forEach(m=>{a!==m&&m.render()});return}}getPTScaledNewRange({deltaPointsCanvas:e,lower:n,upper:r,clientHeight:i,viewport:a,volumeId:o,isPreScaled:s}){let c=np;s?c=5/i:c=this._getMultiplierFromDynamicRange(a,o)||np;const f=e[1]*c;return r-=f,r=s?Math.max(r,.1):r,{lower:n,upper:r}}getNewRange({viewport:e,deltaPointsCanvas:n,volumeId:r,lower:i,upper:a}){const o=this._getMultiplierFromDynamicRange(e,r)||np,s=n[0]*o,c=n[1]*o;let{windowWidth:l,windowCenter:f}=td(i,a);return l+=s,f+=c,l=Math.max(l,1),$s(l,f)}_getMultiplierFromDynamicRange(e,n){var a;let r;if(n){const o=Q.getVolume(n),{voxelManager:s}=e.getImageData(),l=s.getMiddleSliceData().reduce((g,d)=>[Math.min(g[0],d),Math.max(g[1],d)],[1/0,-1/0]),f=(a=o==null?void 0:o.metadata)==null?void 0:a.BitsStored,u=f?2**f:1/0;r=Math.min(l,u)}else r=this._getImageDynamicRangeFromViewport(e);const i=r/bae;return i>1?Math.round(i):i}_getImageDynamicRangeFromViewport(e){const{imageData:n,voxelManager:r}=e.getImageData();if(r!=null&&r.getRange){const s=r.getRange();return s[1]-s[0]}const i=n.getDimensions();if(n.getRange){const s=n.getRange();return s[1]-s[0]}let a;if(n.getScalarData?a=n.getScalarData():a=n.getPointData().getScalars().getData(),i[2]!==1)return this._getImageDynamicRangeFromMiddleSlice(a,i);let o;if(a.getRange)o=a.getRange();else{const{min:s,max:c}=this._getMinMax(a,a.length);o=[s,c]}return o[1]-o[0]}_getMinMax(e,n){let r=1/0,i=-1/0;for(let a=0;a<n;a++){const o=e[a];o<r&&(r=o),o>i&&(i=o)}return{max:i,min:r}}}Cg.toolName="WindowLevel";function MR(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++)e[a++]=t[i++],e[a++]=t[i++],e[a++]=t[i++],e[a++]=255;return}e.set(t)}function LR(t,e,n){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n)for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++],e[i++]=255;else for(let c=0;c<r;c++)e[i++]=t[a++],e[i++]=t[o++],e[i++]=t[s++]}function IR(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0;if(n){for(let o=0;o<r;o++){const s=t[i++],c=t[i++],l=t[i++];e[a++]=s+1.402*(l-128),e[a++]=s-.34414*(c-128)-.71414*(l-128),e[a++]=s+1.772*(c-128),e[a++]=255}return}for(let o=0;o<r;o++){const s=t[i++],c=t[i++],l=t[i++];e[a++]=s+1.402*(l-128),e[a++]=s-.34414*(c-128)-.71414*(l-128),e[a++]=s+1.772*(c-128)}}function VR(t,e,n){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const r=t.length/3;let i=0,a=0,o=r,s=r*2;if(n){for(let c=0;c<r;c++){const l=t[a++],f=t[o++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128),e[i++]=255}return}for(let c=0;c<r;c++){const l=t[a++],f=t[o++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128)}}function Pae(t,e,n){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const r=t.length/2;let i=0,a=0;if(n){for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[a++]=s+1.402*(f-128),e[a++]=s-.34414*(l-128)-.71414*(f-128),e[a++]=s+1.772*(l-128),e[a++]=255,e[a++]=c+1.402*(f-128),e[a++]=c-.34414*(l-128)-.71414*(f-128),e[a++]=c+1.772*(l-128),e[a++]=255}return}for(let o=0;o<r;o+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[a++]=s+1.402*(f-128),e[a++]=s-.34414*(l-128)-.71414*(f-128),e[a++]=s+1.772*(l-128),e[a++]=c+1.402*(f-128),e[a++]=c-.34414*(l-128)-.71414*(f-128),e[a++]=c+1.772*(l-128)}}function rp(t,e){const n=t.length,r=new Uint8ClampedArray(n);for(let i=0;i<n;++i)r[i]=t[i]>>e;return r}function ip(t,e,n){const r=t[`${e}PaletteColorLookupTableData`];if(r)return Promise.resolve(r);const i=ee("imagePixelModule",t.imageId);return i&&typeof i.then=="function"?i.then(a=>a?a[`${e}PaletteColorLookupTableData`]:n):Promise.resolve(i?i[`${e}PaletteColorLookupTableData`]:n)}function _R(t,e,n){const r=t.columns*t.rows,i=t.pixelData;Promise.all([ip(t,"red",null),ip(t,"green",null),ip(t,"blue",null)]).then(([a,o,s])=>{if(!a||!o||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=a.length;let l=0,f=0;const u=t.redPaletteColorLookupTableDescriptor[1],g=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,d=rp(a,g),h=rp(o,g),p=rp(s,g);if(n){for(let m=0;m<r;++m){let v=i[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=d[v],e[f++]=h[v],e[f++]=p[v],e[f++]=255}return}for(let m=0;m<r;++m){let v=i[l++];v<u?v=0:v>u+c-1?v=c-1:v-=u,e[f++]=d[v],e[f++]=h[v],e[f++]=p[v]}})}function ap(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function op(t,e,n){const r=[],i=t.elements[e];for(let a=0;a<n[0];a++)n[2]===16?r[a]=t.uint16(e,a):r[a]=t.byteArray[a+i.dataOffset];return r}function kae(t,e){e.redPaletteColorLookupTableDescriptor=ap(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=ap(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=ap(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const n=e.redPaletteColorLookupTableDescriptor[0],i=t.elements.x00281201.length===n?8:16;e.redPaletteColorLookupTableDescriptor[2]!==i&&(e.redPaletteColorLookupTableDescriptor[2]=i,e.greenPaletteColorLookupTableDescriptor[2]=i,e.bluePaletteColorLookupTableDescriptor[2]=i),e.redPaletteColorLookupTableData=op(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=op(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=op(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function Fae(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function bR(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return Fae(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&kae(t,e),e}function Uae(t,e){let n=e.uint16("x00283002",0);n===0&&(n=65535);let r=0;t===0?r=e.uint16("x00283002",1):r=e.int16("x00283002",1);const i=e.uint16("x00283002",2),a={id:"1",firstValueMapped:r,numBitsPerEntry:i,lut:[]};for(let o=0;o<n;o++)t===0?a.lut[o]=e.uint16("x00283006",o):a.lut[o]=e.int16("x00283006",o);return a}function Qh(t,e){if(!e||!e.items||!e.items.length)return;const n=[];for(let r=0;r<e.items.length;r++){const i=e.items[r].dataSet,a=Uae(t,i);a&&n.push(a)}return n}function Aae(t){const e=t.uint16("x00280103"),n=t.uint16("x00280101");return e===0?0:-1<<n-1}function NR(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const n=t.floatString("x00281052"),r=t.floatString("x00281053");return n!==void 0&&r!==void 0?Aae(t)*r+n<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function Nr(t,e,n){const r=[],i=t.string(e);if(!i)return;const a=i.split("\\");if(!(n&&a.length<n)){for(let o=0;o<a.length;o++)r.push(parseFloat(a[o]));return r}}var PR={exports:{}};/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */(function(t,e){(function(n,r){t.exports=r(gT)})(tn,function(n){return i=[function(o,s){o.exports=n},function(o,s,c){c.r(s),c.d(s,"isStringVr",function(){return f}),c.d(s,"isPrivateTag",function(){return u}),c.d(s,"parsePN",function(){return g}),c.d(s,"parseTM",function(){return d}),c.d(s,"parseDA",function(){return p}),c.d(s,"explicitElementToString",function(){return m}),c.d(s,"explicitDataSetToJS",function(){return v}),c.d(s,"createJPEGBasicOffsetTable",function(){return T}),c.d(s,"parseDicomDataSetExplicit",function(){return j}),c.d(s,"parseDicomDataSetImplicit",function(){return z}),c.d(s,"readFixedString",function(){return E}),c.d(s,"alloc",function(){return ge}),c.d(s,"version",function(){return Pt}),c.d(s,"bigEndianByteArrayParser",function(){return Ae}),c.d(s,"ByteStream",function(){return ot}),c.d(s,"sharedCopy",function(){return Dt}),c.d(s,"DataSet",function(){return R}),c.d(s,"findAndSetUNElementLength",function(){return w}),c.d(s,"findEndOfEncapsulatedElement",function(){return x}),c.d(s,"findItemDelimitationItemAndSetElementLength",function(){return _}),c.d(s,"littleEndianByteArrayParser",function(){return me}),c.d(s,"parseDicom",function(){return ka}),c.d(s,"readDicomElementExplicit",function(){return $}),c.d(s,"readDicomElementImplicit",function(){return N}),c.d(s,"readEncapsulatedImageFrame",function(){return Fa}),c.d(s,"readEncapsulatedPixelData",function(){return W0}),c.d(s,"readEncapsulatedPixelDataFromFragments",function(){return Ur}),c.d(s,"readPart10Header",function(){return Ce}),c.d(s,"readSequenceItemsExplicit",function(){return b}),c.d(s,"readSequenceItemsImplicit",function(){return K}),c.d(s,"readSequenceItem",function(){return W}),c.d(s,"readTag",function(){return S});var l={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},f=function(L){return l[L]},u=function(L){if(L=parseInt(L[4],16),isNaN(L))throw"dicomParser.isPrivateTag: cannot parse last character of group";return L%2==1},g=function(L){if(L!==void 0)return L=L.split("^"),{familyName:L[0],givenName:L[1],middleName:L[2],prefix:L[3],suffix:L[4]}};function d(L,V){if(2<=L.length){var B=parseInt(L.substring(0,2),10),I=4<=L.length?parseInt(L.substring(2,4),10):void 0,G=6<=L.length?parseInt(L.substring(4,6),10):void 0,q=8<=L.length?L.substring(7,13):void 0,q=q?parseInt(q,10)*Math.pow(10,6-q.length):void 0;if(V&&(isNaN(B)||I!==void 0&&isNaN(I)||G!==void 0&&isNaN(G)||q!==void 0&&isNaN(q)||B<0||23<B||I&&(I<0||59<I)||G&&(G<0||59<G)||q&&(q<0||999999<q)))throw"invalid TM '".concat(L,"'");return{hours:B,minutes:I,seconds:G,fractionalSeconds:q}}if(V)throw"invalid TM '".concat(L,"'")}function h(L,V,B){return!isNaN(B)&&0<V&&V<=12&&0<L&&L<=function(I,G){switch(I){case 2:return G%4==0&&G%100||G%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(V,B)}function p(L,V){if(L&&L.length===8){var B=parseInt(L.substring(0,4),10),I=parseInt(L.substring(4,6),10),G=parseInt(L.substring(6,8),10);if(V&&h(G,I,B)!==!0)throw"invalid DA '".concat(L,"'");return{year:B,month:I,day:G}}if(V)throw"invalid DA '".concat(L,"'")}function m(L,V){if(L===void 0||V===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(V.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var B,I=V.vr,G=V.tag;function q(Ne,et){for(var er="",Rt=0;Rt<Ne;Rt++)Rt!==0&&(er+="/"),er+=et.call(L,G,Rt).toString();return er}if(f(I)===!0)B=L.string(G);else{if(I==="AT"){var ae=L.uint32(G);return ae===void 0?void 0:"x".concat((ae=ae<0?4294967295+ae+1:ae).toString(16).toUpperCase())}I==="US"?B=q(V.length/2,L.uint16):I==="SS"?B=q(V.length/2,L.int16):I==="UL"?B=q(V.length/4,L.uint32):I==="SL"?B=q(V.length/4,L.int32):I==="FD"?B=q(V.length/8,L.double):I==="FL"&&(B=q(V.length/4,L.float))}return B}function v(L,V){if(L===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";V=V||{omitPrivateAttibutes:!0,maxElementLength:128};var B,I={};for(B in L.elements){var G=L.elements[B];if(V.omitPrivateAttibutes!==!0||!u(B))if(G.items){for(var q=[],ae=0;ae<G.items.length;ae++)q.push(v(G.items[ae].dataSet,V));I[B]=q}else{var Ne=void 0;G.length<V.maxElementLength&&(Ne=m(L,G)),I[B]=Ne!==void 0?Ne:{dataOffset:G.dataOffset,length:G.length}}}return I}function y(L,V){return L.byteArray[V]===255&&L.byteArray[V+1]===217}function C(L,V,B){for(var I,G,q=B;q<V.fragments.length;q++)if(I=L,G=q,G=V.fragments[G],!(!y(I,G.position+G.length-2)&&!y(I,G.position+G.length-3)))return q}function T(L,V,B){if(L===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(V===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(V.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(V.encapsulatedPixelData!==!0||V.hadUndefinedLength!==!0||V.basicOffsetTable===void 0||V.fragments===void 0||V.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(B&&B.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";B=B||V.fragments;for(var I=[],G=0;;){I.push(V.fragments[G].offset);var q=C(L,V,G);if(q===void 0||q===V.fragments.length-1)return I;G=q+1}}function S(B){if(B===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var V=256*B.readUint16()*256,B=B.readUint16();return"x".concat("00000000".concat((V+B).toString(16)).substr(-8))}function x(L,V,B){if(L===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(V===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(V.encapsulatedPixelData=!0,V.basicOffsetTable=[],V.fragments=[],S(L)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var I=L.readUint32()/4,G=0;G<I;G++){var q=L.readUint32();V.basicOffsetTable.push(q)}for(var ae=L.position;L.position<L.byteArray.length;){var Ne=S(L),et=L.readUint32();if(Ne==="xfffee0dd")return L.seek(et),void(V.length=L.position-V.dataOffset);if(Ne!=="xfffee000")return B&&B.push("unexpected tag ".concat(Ne," while searching for end of pixel data element with undefined length")),et>L.byteArray.length-L.position&&(et=L.byteArray.length-L.position),V.fragments.push({offset:L.position-ae-8,position:L.position,length:et}),L.seek(et),void(V.length=L.position-V.dataOffset);V.fragments.push({offset:L.position-ae-8,position:L.position,length:et}),L.seek(et)}B&&B.push("pixel data element ".concat(V.tag," missing sequence delimiter tag xfffee0dd"))}function w(L,V){if(L===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var B=L.byteArray.length-8;L.position<=B;)if(L.readUint16()===65534){var I=L.readUint16();if(I===57565)return L.readUint32()!==0&&L.warnings("encountered non zero length following item delimiter at position ".concat(L.position-4," while reading element of undefined length with tag ").concat(V.tag)),void(V.length=L.position-V.dataOffset)}V.length=L.byteArray.length-V.dataOffset,L.seek(L.byteArray.length-L.position)}function E(L,V,B){if(B<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(V+B>L.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var I,G="",q=0;q<B;q++){if((I=L[V+q])===0)return V+=B,G;G+=String.fromCharCode(I)}return G}function M(L,V){for(var B=0;B<V.length;B++){var I=V[B];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(L,I.key,I)}}function O(L,V){return L.parser!==void 0?L.parser:V}var R=function(){function L(I,G,q){(function(ae,Ne){if(!(ae instanceof Ne))throw new TypeError("Cannot call a class as a function")})(this,L),this.byteArrayParser=I,this.byteArray=G,this.elements=q}var V,B;return V=L,(B=[{key:"uint16",value:function(I,G){if(I=this.elements[I],G=G!==void 0?G:0,I&&I.length!==0)return O(I,this.byteArrayParser).readUint16(this.byteArray,I.dataOffset+2*G)}},{key:"int16",value:function(I,G){if(I=this.elements[I],G=G!==void 0?G:0,I&&I.length!==0)return O(I,this.byteArrayParser).readInt16(this.byteArray,I.dataOffset+2*G)}},{key:"uint32",value:function(I,G){if(I=this.elements[I],G=G!==void 0?G:0,I&&I.length!==0)return O(I,this.byteArrayParser).readUint32(this.byteArray,I.dataOffset+4*G)}},{key:"int32",value:function(I,G){if(I=this.elements[I],G=G!==void 0?G:0,I&&I.length!==0)return O(I,this.byteArrayParser).readInt32(this.byteArray,I.dataOffset+4*G)}},{key:"float",value:function(I,G){if(I=this.elements[I],G=G!==void 0?G:0,I&&I.length!==0)return O(I,this.byteArrayParser).readFloat(this.byteArray,I.dataOffset+4*G)}},{key:"double",value:function(I,G){if(I=this.elements[I],G=G!==void 0?G:0,I&&I.length!==0)return O(I,this.byteArrayParser).readDouble(this.byteArray,I.dataOffset+8*G)}},{key:"numStringValues",value:function(I){if(I=this.elements[I],I&&0<I.length)return I=E(this.byteArray,I.dataOffset,I.length).match(/\\/g),I===null?1:I.length+1}},{key:"string",value:function(I,G){if(I=this.elements[I],I&&I.Value)return I.Value;if(I&&0<I.length)return I=E(this.byteArray,I.dataOffset,I.length),0<=G?I.split("\\")[G].trim():I.trim()}},{key:"text",value:function(I,G){if(I=this.elements[I],I&&0<I.length)return I=E(this.byteArray,I.dataOffset,I.length),0<=G?I.split("\\")[G].replace(/ +$/,""):I.replace(/ +$/,"")}},{key:"floatString",value:function(I,G){var q=this.elements[I];if(q&&0<q.length&&(G=this.string(I,G=G!==void 0?G:0),G!==void 0))return parseFloat(G)}},{key:"intString",value:function(I,G){var q=this.elements[I];if(q&&0<q.length&&(G=this.string(I,G=G!==void 0?G:0),G!==void 0))return parseInt(G)}},{key:"attributeTag",value:function(I){var G=this.elements[I];if(G&&G.length===4){var q=O(G,this.byteArrayParser).readUint16,I=this.byteArray,G=G.dataOffset;return"x".concat("00000000".concat((256*q(I,G)*256+q(I,G+2)).toString(16)).substr(-8))}}}])&&M(V.prototype,B),Object.defineProperty(V,"prototype",{writable:!1}),L}();function _(L,V){if(L===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var B=L.byteArray.length-8;L.position<=B;)if(L.readUint16()===65534){var I=L.readUint16();if(I===57357)return L.readUint32()!==0&&L.warnings("encountered non zero length following item delimiter at position ".concat(L.position-4," while reading element of undefined length with tag ").concat(V.tag)),void(V.length=L.position-V.dataOffset)}V.length=L.byteArray.length-V.dataOffset,L.seek(L.byteArray.length-L.position)}var P=function(L,V){return L.vr!==void 0?L.vr==="SQ":V.position+4<=V.byteArray.length?(L=S(V),V.seek(-4),L==="xfffee000"||L==="xfffee0dd"):(V.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function N(L,V,B){if(L===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var I=S(L),I={tag:I,vr:B!==void 0?B(I):void 0,length:L.readUint32(),dataOffset:L.position};return I.length===4294967295&&(I.hadUndefinedLength=!0),I.tag===V||(!P(I,L)||u(I.tag)&&!I.hadUndefinedLength?I.hadUndefinedLength?_(L,I):L.seek(I.length):(K(L,I,B),u(I.tag)&&(I.items=void 0))),I}function W(L){if(L===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var V={tag:S(L),length:L.readUint32(),dataOffset:L.position};if(V.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(L.position);return V}function U(L,V){var B=W(L);return B.length===4294967295?(B.hadUndefinedLength=!0,B.dataSet=function(I,G){for(var q={};I.position<I.byteArray.length;){var ae=N(I,void 0,G);if((q[ae.tag]=ae).tag==="xfffee00d")return new R(I.byteArrayParser,I.byteArray,q)}return I.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new R(I.byteArrayParser,I.byteArray,q)}(L,V),B.length=L.position-B.dataOffset):(B.dataSet=new R(L.byteArrayParser,L.byteArray,{}),z(B.dataSet,L,L.position+B.length,{vrCallback:V})),B}function K(L,V,B){if(L===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(V===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";V.items=[],(V.length===4294967295?function(I,G,q){for(;I.position+4<=I.byteArray.length;){var ae=S(I);if(I.seek(-4),ae==="xfffee0dd")return G.length=I.position-G.dataOffset,I.seek(8);ae=U(I,q),G.items.push(ae)}I.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),G.length=I.byteArray.length-G.dataOffset}:function(I,G,q){for(var ae=G.dataOffset+G.length;I.position<ae;){var Ne=U(I,q);G.items.push(Ne)}})(L,V,B)}function A(L,V){var B=W(L);return B.length===4294967295?(B.hadUndefinedLength=!0,B.dataSet=function(I,G){for(var q={};I.position<I.byteArray.length;){var ae=$(I,G);if((q[ae.tag]=ae).tag==="xfffee00d")return new R(I.byteArrayParser,I.byteArray,q)}return G.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new R(I.byteArrayParser,I.byteArray,q)}(L,V),B.length=L.position-B.dataOffset):(B.dataSet=new R(L.byteArrayParser,L.byteArray,{}),j(B.dataSet,L,L.position+B.length)),B}function b(L,V,B){if(L===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(V===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";V.items=[],(V.length===4294967295?function(I,G,q){for(;I.position+4<=I.byteArray.length;){var ae=S(I);if(I.seek(-4),ae==="xfffee0dd")return G.length=I.position-G.dataOffset,I.seek(8);ae=A(I,q),G.items.push(ae)}q.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),G.length=I.position-G.dataOffset}:function(I,G,q){for(var ae=G.dataOffset+G.length;I.position<ae;){var Ne=A(I,q);G.items.push(Ne)}})(L,V,B)}var F=function(L){return L==="OB"||L==="OD"||L==="OL"||L==="OW"||L==="SQ"||L==="OF"||L==="UC"||L==="UR"||L==="UT"||L==="UN"?4:2};function $(L,V,B){if(L===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var I={tag:S(L),vr:L.readFixedString(2)};return F(I.vr)===2?I.length=L.readUint16():(L.seek(2),I.length=L.readUint32()),I.dataOffset=L.position,I.length===4294967295&&(I.hadUndefinedLength=!0),I.tag===B||(I.vr==="SQ"?b(L,I,V):I.length===4294967295?I.tag==="x7fe00010"?x(L,I,V):(I.vr==="UN"?K:_)(L,I):L.seek(I.length)),I}function j(L,V,B){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(B=B===void 0?V.byteArray.length:B,V===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(B<V.position||B>V.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var G=L.elements;V.position<B;){var q=$(V,L.warnings,I.untilTag);if((G[q.tag]=q).tag===I.untilTag)return}if(V.position>B)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function z(L,V,B){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(B=B===void 0?L.byteArray.length:B,V===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(B<V.position||B>V.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var G=L.elements;V.position<B;){var q=N(V,I.untilTag,I.vrCallback);if((G[q.tag]=q).tag===I.untilTag)return}}function ge(L,V){if(typeof Buffer<"u"&&L instanceof Buffer)return Buffer.alloc(V);if(L instanceof Uint8Array)return new Uint8Array(V);throw"dicomParser.alloc: unknown type for byteArray"}var Pt="1.8.12",Ae={readUint16:function(L,V){if(V<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(V+2>L.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(L[V]<<8)+L[V+1]},readInt16:function(L,V){if(V<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(V+2>L.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return V=(L[V]<<8)+L[V+1],V=32768&V?V-65535-1:V},readUint32:function(L,V){if(V<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(V+4>L.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*L[V]+L[V+1])+L[V+2])+L[V+3]},readInt32:function(L,V){if(V<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(V+4>L.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(L[V]<<24)+(L[V+1]<<16)+(L[V+2]<<8)+L[V+3]},readFloat:function(L,V){if(V<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(V+4>L.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var B=new Uint8Array(4);return B[3]=L[V],B[2]=L[V+1],B[1]=L[V+2],B[0]=L[V+3],new Float32Array(B.buffer)[0]},readDouble:function(L,V){if(V<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(V+8>L.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var B=new Uint8Array(8);return B[7]=L[V],B[6]=L[V+1],B[5]=L[V+2],B[4]=L[V+3],B[3]=L[V+4],B[2]=L[V+5],B[1]=L[V+6],B[0]=L[V+7],new Float64Array(B.buffer)[0]}};function Dt(L,V,B){if(typeof Buffer<"u"&&L instanceof Buffer)return L.slice(V,V+B);if(L instanceof Uint8Array)return new Uint8Array(L.buffer,L.byteOffset+V,B);throw"dicomParser.from: unknown type for byteArray"}function Ge(L,V){for(var B=0;B<V.length;B++){var I=V[B];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(L,I.key,I)}}var ot=function(){function L(I,G,q){if(function(ae,Ne){if(!(ae instanceof Ne))throw new TypeError("Cannot call a class as a function")}(this,L),I===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(G===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(G instanceof Uint8Array)&&(typeof Buffer>"u"||!(G instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(q<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(q>=G.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=I,this.byteArray=G,this.position=q||0,this.warnings=[]}var V,B;return V=L,(B=[{key:"seek",value:function(I){if(this.position+I<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=I}},{key:"readByteStream",value:function(I){if(this.position+I>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var G=Dt(this.byteArray,this.position,I);return this.position+=I,new L(this.byteArrayParser,G)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var I=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,I}},{key:"readUint32",value:function(){var I=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,I}},{key:"readFixedString",value:function(I){var G=E(this.byteArray,this.position,I);return this.position+=I,G}}])&&Ge(V.prototype,B),Object.defineProperty(V,"prototype",{writable:!1}),L}(),me={readUint16:function(L,V){if(V<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(V+2>L.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return L[V]+256*L[V+1]},readInt16:function(L,V){if(V<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(V+2>L.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return V=L[V]+(L[V+1]<<8),V=32768&V?V-65535-1:V},readUint32:function(L,V){if(V<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(V+4>L.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return L[V]+256*L[V+1]+256*L[V+2]*256+256*L[V+3]*256*256},readInt32:function(L,V){if(V<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(V+4>L.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return L[V]+(L[V+1]<<8)+(L[V+2]<<16)+(L[V+3]<<24)},readFloat:function(L,V){if(V<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(V+4>L.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var B=new Uint8Array(4);return B[0]=L[V],B[1]=L[V+1],B[2]=L[V+2],B[3]=L[V+3],new Float32Array(B.buffer)[0]},readDouble:function(L,V){if(V<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(V+8>L.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var B=new Uint8Array(8);return B[0]=L[V],B[1]=L[V+1],B[2]=L[V+2],B[3]=L[V+3],B[4]=L[V+4],B[5]=L[V+5],B[6]=L[V+6],B[7]=L[V+7],new Float64Array(B.buffer)[0]}};function Ce(L){var V=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(L===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var B=V.TransferSyntaxUID,I=new ot(me,L);return function(){var G=function(){if(I.getSize()<=132&&B)return!1;if(I.seek(128),I.readFixedString(4)==="DICM")return!0;if(!(V||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return I.seek(0),!1}(),q=[],ae={};if(!G)return I.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:B}},warnings:q};for(;I.position<I.byteArray.length;){var Ne=I.position,et=$(I,q);if("x0002ffff"<et.tag){I.position=Ne;break}et.parser=me,ae[et.tag]=et}return(G=new R(I.byteArrayParser,I.byteArray,ae)).warnings=I.warnings,G.position=I.position,G}()}var Yt="1.2.840.10008.1.2.2";function ka(L){var V=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(L===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var B,I=function(q){if(q.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return q=q.elements.x00020010,q&&q.Value||E(L,q.dataOffset,q.length)};function G(et){var Ne=I(et),ae=Ne!=="1.2.840.10008.1.2",Ne=function(er,Rt){var Pd=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(er!=="1.2.840.10008.1.2.1.99")return new ot(er===Yt?Ae:me,L,Rt);if(V&&V.inflater)return er=V.inflater(L,Rt),new ot(me,er,0);if(Pd==!0){var tr=c(0),Pi=Dt(L,Rt,L.length-Rt),tr=tr.inflateRawSync(Pi),Pi=ge(L,tr.length+Rt);return L.copy(Pi,0,0,Rt),tr.copy(Pi,Rt),new ot(me,Pi,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return tr=L.slice(Rt),Pi=pako.inflateRaw(tr),(tr=ge(L,Pi.length+Rt)).set(L.slice(0,Rt),0),tr.set(Pi,Rt),new ot(me,tr,0)}(Ne,et.position),et=new R(Ne.byteArrayParser,Ne.byteArray,{});et.warnings=Ne.warnings;try{(ae?j:z)(et,Ne,Ne.byteArray.length,V)}catch(er){throw{exception:er,dataSet:et}}return et}return function(q,ae){for(var Ne in q.elements)q.elements.hasOwnProperty(Ne)&&(ae.elements[Ne]=q.elements[Ne]);return q.warnings!==void 0&&(ae.warnings=q.warnings.concat(ae.warnings)),ae}(B=Ce(L,V),G(B))}var Vd=function(L,V,B){for(var I=0,G=V;G<V+B;G++)I+=L[G].length;return I};function Ur(L,ae,B,I,G){if(G=G||ae.fragments,L===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(ae===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(B===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((I=I||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(ae.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(ae.encapsulatedPixelData!==!0||ae.hadUndefinedLength!==!0||ae.basicOffsetTable===void 0||ae.fragments===void 0||ae.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(B<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(B>=ae.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(I<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(B+I>ae.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var q=new ot(L.byteArrayParser,L.byteArray,ae.dataOffset),ae=W(q);if(ae.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";q.seek(ae.length);var Ne=q.position;if(I===1)return Dt(q.byteArray,Ne+G[B].offset+8,G[B].length);for(var ae=Vd(G,B,I),et=ge(q.byteArray,ae),er=0,Rt=B;Rt<B+I;Rt++)for(var Pd=Ne+G[Rt].offset+8,tr=0;tr<G[Rt].length;tr++)et[er++]=q.byteArray[Pd++];return et}var _d=function(L,V){for(var B=0;B<L.length;B++)if(L[B].offset===V)return B},bd=function(L,V,B,I){if(L===V.length-1)return B.length-I;for(var G=V[L+1],q=I+1;q<B.length;q++)if(B[q].offset===G)return q-I;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function Fa(L,V,B,I,G){if(I=I||V.basicOffsetTable,G=G||V.fragments,L===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(V===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(B===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(I===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(V.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(V.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(V.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(V.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(I.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(B<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(B>=I.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var q=I[B],q=_d(G,q);if(q===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return Ur(L,V,q,bd(B,I,G,q),G)}var Nd=!1;function W0(L,V,B){if(Nd||(Nd=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),L===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(V===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(B===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(V.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(V.encapsulatedPixelData!==!0||V.hadUndefinedLength!==!0||V.basicOffsetTable===void 0||V.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(B<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return V.basicOffsetTable.length!==0?Fa(L,V,B):Ur(L,V,0,V.fragments.length)}s.default={isStringVr:f,isPrivateTag:u,parsePN:g,parseTM:d,parseDA:p,explicitElementToString:m,explicitDataSetToJS:v,createJPEGBasicOffsetTable:T,parseDicomDataSetExplicit:j,parseDicomDataSetImplicit:z,readFixedString:E,alloc:ge,version:Pt,bigEndianByteArrayParser:Ae,ByteStream:ot,sharedCopy:Dt,DataSet:R,findAndSetUNElementLength:w,findEndOfEncapsulatedElement:x,findItemDelimitationItemAndSetElementLength:_,littleEndianByteArrayParser:me,parseDicom:ka,readDicomElementExplicit:$,readDicomElementImplicit:N,readEncapsulatedImageFrame:Fa,readEncapsulatedPixelData:W0,readEncapsulatedPixelDataFromFragments:Ur,readPart10Header:Ce,readSequenceItemsExplicit:b,readSequenceItemsImplicit:K,readSequenceItem:W,readTag:S,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],a={},r.m=i,r.c=a,r.d=function(o,s,c){r.o(o,s)||Object.defineProperty(o,s,{enumerable:!0,get:c})},r.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},r.t=function(o,s){if(1&s&&(o=r(o)),8&s||4&s&&typeof o=="object"&&o&&o.__esModule)return o;var c=Object.create(null);if(r.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:o}),2&s&&typeof o!="string")for(var l in o)r.d(c,l,(function(f){return o[f]}).bind(null,l));return c},r.n=function(o){var s=o&&o.__esModule?function(){return o.default}:function(){return o};return r.d(s,"a",s),s},r.o=function(o,s){return Object.prototype.hasOwnProperty.call(o,s)},r.p="",r(r.s=1);function r(o){if(a[o])return a[o].exports;var s=a[o]={i:o,l:!1,exports:{}};return i[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}var i,a})})(PR);var St=PR.exports;function ru(t){const e=t.indexOf(":");let n=t.substring(e+1);const r=n.indexOf("frame=");let i;if(r!==-1){const s=n.substring(r+6);i=parseInt(s,10),n=n.substring(0,r-1)}const a=t.substring(0,e),o=i!==void 0?i-1:void 0;return{scheme:a,url:n,frame:i,pixelDataFrame:o}}let e5={open(t,e){t.open("get",e,!0)},beforeSend(){},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function kR(t){e5=Object.assign(e5,t)}function iu(){return e5}function Dd(t,e,n={},r={}){const i=iu(),a=c=>{if(typeof i.errorInterceptor=="function"){const l=new Error("request failed");l.request=c,l.response=c.response,l.status=c.status,i.errorInterceptor(l)}},o=new XMLHttpRequest,s=new Promise((c,l)=>{i.open(o,t,n,r);const f=i.beforeSend(o,e,n,r);o.responseType="arraybuffer";const u=Object.assign({},n,f);Object.keys(u).forEach(function(g){u[g]!==null&&(g==="Accept"&&t.indexOf("accept=")!==-1||o.setRequestHeader(g,u[g]))}),r.deferred={resolve:c,reject:l},r.url=t,r.imageId=e,o.onloadstart=function(g){i.onloadstart&&i.onloadstart(g,r),Z(Y,"cornerstoneimageloadstart",{url:t,imageId:e})},o.onloadend=function(g){i.onloadend&&i.onloadend(g,r),Z(Y,"cornerstoneimageloadend",{url:t,imageId:e})},o.onreadystatechange=function(g){if(i.onreadystatechange){i.onreadystatechange(g,r);return}o.readyState===4&&(o.status===200||o.status===206?i.beforeProcessing(o).then(c).catch(()=>{a(o),l(o)}):(a(o),l(o)))},o.onprogress=function(g){g.loaded,g.lengthComputable&&g.total,i.onprogress&&i.onprogress(g,r)},o.onerror=function(){a(o),l(o)},o.onabort=function(){a(o),l(o)},o.send()});return s.xhr=o,s}function Bae(t,e,n){if(n+t.length>e.length)return!1;let r=n;for(let i=0;i<t.length;i++)if(t[i]!==e[r++])return!1;return!0}function Gae(t){const e=new Uint8Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t.charCodeAt(n);return e}function t5(t,e,n){n=n||0;const r=Gae(e);for(let i=n;i<t.length;i++)if(r[0]===t[i]&&Bae(r,t,i))return i;return-1}const{ImageQualityStatus:x9}=La;function Km(t,e,n){n||(n={});const r=new Uint8Array(e),i=!!(n!=null&&n.isPartial);if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:i?x9.SUBRESOLUTION:x9.FULL_RESOLUTION,pixelData:r};let{tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c}=n;if(a||(a=t5(r,`\r
\r
`)),a===-1)throw new Error("invalid response - no multipart mime header");if(!s&&(o=zae(r,0,a).split(`\r
`),s=Wae(o),!s))throw new Error("invalid response - no boundary marker");const l=a+4,f=t5(r,s,l);if(f===-1&&!i)throw new Error("invalid response - terminating boundary not found");return c||(c=$ae(o)),n.tokenIndex=a,n.boundary=s,n.responseHeaders=o,n.multipartContentType=c,n.isPartial=f===-1,{contentType:c,extractDone:!i||f!==-1,tokenIndex:a,responseHeaders:o,boundary:s,multipartContentType:c,pixelData:e.slice(l,f-2)}}function Wae(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function $ae(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function zae(t,e,n){e=e||0,n=n||t.length-e;let r="";for(let i=e;i<e+n;i++)r+=String.fromCharCode(t[i]);return r}const{ImageQualityStatus:w9}=La;function qm(t,e=!0){return e?t.imageQualityStatus??w9.FULL_RESOLUTION:w9.SUBRESOLUTION}const{ProgressiveIterator:Hae}=ba;function FR(t,e,n={},r={}){const i=iu(),{retrieveOptions:a={},streamingData:o={}}=r,s=a.minChunkSize||128*1024,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}},l=new Hae("streamRequest");return l.generate(async(f,u)=>{var h,p;const g=(h=i.beforeSend)==null?void 0:h.call(i,null,t,n,{}),d=Object.assign({},n,g);Object.keys(d).forEach(function(m){d[m]===null&&(d[m]=void 0),m==="Accept"&&t.indexOf("accept=")!==-1&&(d[m]=void 0)});try{const m=await fetch(t,{headers:d,signal:void 0});if(m.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${m.status}`);const v=m.body.getReader(),y=m.headers,C=y.get("content-type"),T=Number(y.get("Content-Length"));let S=!1,x=o.encodedData,w=o.lastSize||0;for(o.isPartial=!0;!S;){const{done:E,value:M}=await v.read();if(x=jae(x,M),!x){if(S)throw new Error(`Done but no image frame available ${e}`);continue}if(S=E||x.byteLength===T,!S&&x.length<w+s)continue;w=x.length,o.isPartial=!E;const O=Km(C,x,o),R=qm(a,S),_={url:t,imageId:e,...O,percentComplete:E?100:((p=O.pixelData)==null?void 0:p.length)*100/T,imageQualityStatus:R,done:S};f.add(_,S)}}catch(m){c(),console.error(m),u(m)}}),l.getNextPromise()}function jae(t,e){if(!t)return e;if(!e)return t;const n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n}const Kae={xhrRequest:Dd,streamRequest:FR,setOptions:kR,getOptions:iu};function qae(t){const e=t.elements.x7fe00010.fragments,n=t.byteArray.length;for(const r of e){const{position:i,length:a}=r;a>n-i&&(console.log(`Truncated fragment, changing fragment length from ${r.length} to ${n-i}`),r.length=n-i)}return t}function Xae(t){let e=St.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let n;try{n=St.parseDicom(t)}catch(r){console.error(r),console.log("pixel data dataset:",r.dataSet),n=r.dataSet}return e.elements.x7fe00010=n.elements.x7fe00010,e=qae(e),e}async function UR(t,e,n){const r=Xae(t),{uri:i,imageId:a,fileTotalLength:o}=n;return r.fetchMore=async function(s){const c=Object.assign({uri:i,imageId:a,fetchedLength:t.length,lengthToFetch:o-t.length},s),{fetchedLength:l,lengthToFetch:f}=c,{arrayBuffer:u}=await e(i,a,{byteRange:`${l}-${l+f}`}),g=new Uint8Array(u),d=new Uint8Array(r.byteArray.length+g.length);return d.set(r.byteArray),d.set(g,r.byteArray.length),UR(d,e,n)},r}function Yae(t,e){if(!t)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i}=BR(t);if(r||n>1){const{shared:a,perFrame:o}=AR(r,i,e);return{NumberOfFrames:n,PerFrameFunctionalInformation:o,SharedFunctionalInformation:a}}return{NumberOfFrames:n}}function AR(t,e,n){const r={};(e?Object.values(e.items[0].dataSet.elements):[]).map(a=>r[a.tag]=a);const i={};return(t?Object.values(t.items[n-1].dataSet.elements):[]).map(a=>i[a.tag]=a),{shared:r,perFrame:i}}function BR(t){if(!t)return;const{elements:e,...n}=t,{x52009230:r,x52009229:i,...a}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a,otherAttributtes:n}}function Zae(t,e){if(!e)return;const{NumberOfFrames:n,PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:i,otherElements:a}=BR(e);if(r||n>1){const{shared:o,perFrame:s}=AR(r,i,t),c={elements:{...a,...o,...s}},l=Object.create(e);return Object.assign(l,c)}return e}let Gt={};const Jae=()=>{Gt={}};function Xm(t){if(Gt[t])return Gt[t]}function Qae(t){const e=Xm(t);return GR(e)}function GR(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function eoe(t){return t.indexOf("&frame=")}function toe(t){const e=eoe(t),n=e===-1?t:t.slice(0,e),r=parseInt(t.slice(e+7),10)||1;let i;return Gt[n]?i=Gt[n].dataSet:i=void 0,{dataSet:i,frame:r}}function noe(t){const e=[],n=Xm(t);if(GR(n)){const r=n.intString("x00280008");for(let i=1;i<=r;i++)e.push(`${t}&frame=${i}`)}else e.push(t);return e}const WR={_get:Xm,generateMultiframeWADOURIs:noe,retrieveMultiframeDataset:toe,isMultiframeDataset:Qae};let E0=0,Qa={};function roe(t){return Gt[t]!==void 0}function ioe(t){let e;if(t.includes("&frame=")){const{frame:n,dataSet:r}=WR.retrieveMultiframeDataset(t);e=Zae(n,r)}else Gt[t]&&(e=Gt[t].dataSet);return e}function aoe(t,e){const n=Gt[t];if(!n){console.error(`No loaded dataSet for uri ${t}`);return}E0-=n.dataSet.byteArray.length,n.dataSet=e,E0+=e.byteArray.length,Z(Y,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:Rd()})}function ooe(t,e=Dd,n){if(Gt[t])return new Promise(a=>{Gt[t].cacheCount++,a(Gt[t].dataSet)});if(Qa[t])return Qa[t].cacheCount++,Qa[t];const r=e(t,n),i=new Promise((a,o)=>{r.then(async function(s){const c={isPartialContent:!1,fileTotalLength:null};if(!(s instanceof ArrayBuffer)){if(!s.arrayBuffer)return o(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=s.flags.isPartialContent,c.fileTotalLength=s.flags.fileTotalLength,s=s.arrayBuffer}const l=new Uint8Array(s);let f;try{c.isPartialContent?f=await UR(l,e,{uri:t,imageId:n,fileTotalLength:c.fileTotalLength}):f=St.parseDicom(l)}catch(u){return o(u)}Gt[t]={dataSet:f,cacheCount:i.cacheCount},E0+=f.byteArray.length,a(f),Z(Y,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:Rd()})},o).then(()=>{delete Qa[t]},()=>{delete Qa[t]})});return i.cacheCount=1,Qa[t]=i,i}function soe(t){Gt[t]&&(Gt[t].cacheCount--,Gt[t].cacheCount===0&&(E0-=Gt[t].dataSet.byteArray.length,delete Gt[t],Z(Y,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:Rd()})))}function Rd(){return{cacheSizeInBytes:E0,numberOfDataSetsCached:Object.keys(Gt).length}}function coe(){Jae(),Qa={},E0=0}const Zs={isLoaded:roe,load:ooe,unload:soe,getInfo:Rd,purge:coe,get:ioe,update:aoe};function loe(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=t.elements[`${r}3000`];if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.byteArray[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:t.uint16(`${r}0010`),columns:t.uint16(`${r}0011`),type:t.string(`${r}0040`),x:t.int16(`${r}0050`,1)-1,y:t.int16(`${r}0050`,0)-1,pixelData:a,description:t.string(`${r}0022`),label:t.string(`${r}1500`),roiArea:t.string(`${r}1301`),roiMean:t.string(`${r}1302`),roiStandardDeviation:t.string(`${r}1303`)})}return{overlays:e}}function G0(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function Ym(t,e){const n=t.string("x00080008");if(n){const r=n.split("\\");if(r.length>e)return r[e]}}function uoe(t){let e;const n=t.string("x00080060");if(n!=null&&n.includes("NM")){const r=Ym(t,2);r&&G0(r)&&t.elements.x00540022&&(e=Nr(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function foe(t){let e;const n=t.string("x00080060");if(n!=null&&n.includes("NM")){const r=Ym(t,2);r&&G0(r)&&t.elements.x00540022&&(e=Nr(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function E9(t){let e=Nr(t,"x00200037",6);return!e&&t.elements.x00209116&&(e=Nr(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=uoe(t)),e}function O9(t){let e=Nr(t,"x00200032",3);return!e&&t.elements.x00209113&&(e=Nr(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=foe(t)),e}function D9(t){let e=Nr(t,"x00280030",2);return!e&&t.elements.x00289110&&(e=Nr(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function R9(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}function $R(t,e,n){const r={};for(const i of n)try{const a=e(i,t);if(a){const o={};for(const s in a)if(s in a){const c=goe(s);o[c]=a[s]}Object.assign(r,o)}}catch(a){console.error(`Error retrieving ${i} data:`,a)}return r}const goe=t=>t.charAt(0).toUpperCase()+t.slice(1),zR=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function M9(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(r=>{const i=r.dataSet.double("x0018602c"),a=r.dataSet.double("x0018602e"),o=r.dataSet.uint16("x00186024"),s=r.dataSet.uint16("x00186026"),c=r.dataSet.uint16("x0018601a"),l=r.dataSet.uint16("x0018601e"),f=r.dataSet.uint16("x00186018"),u=r.dataSet.uint16("x0018601c"),g=r.dataSet.int32("x00186020")||null,d=r.dataSet.int32("x00186022")||null,h=r.dataSet.uint16("x0018602a"),p=r.dataSet.uint16("x00186028"),m=r.dataSet.uint16("x00186012"),v=r.dataSet.uint16("x00186014"),y=r.dataSet.uint16("x00186016"),C=r.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:d,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:h,referencePhysicalPixelValueX:p,regionSpatialFormat:m,regionDataType:v,regionFlags:y,transducerFrequency:C}})}function Zm(t,e){const{MetadataModules:n}=La;if(Array.isArray(e))return;const r=ru(e);if(t===n.MULTIFRAME){const o=WR.retrieveMultiframeDataset(r.url);return o.dataSet?Yae(o.dataSet,o.frame):void 0}let i=r.url;r.frame&&(i=`${i}&frame=${r.frame}`);const a=Zs.get(i);if(a)return HR(t,e,a)}function HR(t,e,n){const{MetadataModules:r}=La;if(t===r.GENERAL_STUDY)return{studyDescription:n.string("x00081030"),studyDate:St.parseDA(n.string("x00080020")),studyTime:St.parseTM(n.string("x00080030")||""),accessionNumber:n.string("x00080050")};if(t===r.GENERAL_SERIES)return{modality:n.string("x00080060"),seriesInstanceUID:n.string("x0020000e"),seriesNumber:n.intString("x00200011"),studyInstanceUID:n.string("x0020000d"),seriesDate:St.parseDA(n.string("x00080021")),seriesTime:St.parseTM(n.string("x00080031")||""),acquisitionDate:St.parseDA(n.string("x00080022")),acquisitionTime:St.parseTM(n.string("x00080032")||"")};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:n.string("x00080018"),instanceNumber:n.intString("x00200013"),lossyImageCompression:n.string("x00282110"),lossyImageCompressionRatio:n.floatString("x00282112"),lossyImageCompressionMethod:n.string("x00282114")};if(t===r.PATIENT)return{patientID:n.string("x00100020"),patientName:n.string("x00100010")};if(t===r.PATIENT_STUDY)return{patientAge:n.intString("x00101010"),patientSize:n.floatString("x00101020"),patientSex:n.string("x00100040"),patientWeight:n.floatString("x00101030")};if(t===r.NM_MULTIFRAME_GEOMETRY){const i=n.string("x00080060"),a=Ym(n,2);return{modality:i,imageType:n.string("x00080008"),imageSubType:a,imageOrientationPatient:E9(n),imagePositionPatient:O9(n),sliceThickness:R9(n),pixelSpacing:D9(n),numberOfFrames:n.uint16("x00280008"),isNMReconstructable:G0(a)&&i.includes("NM")}}if(t===r.IMAGE_PLANE){const i=E9(n),a=O9(n),o=D9(n),s=R9(n);let c=null,l=null;o&&(l=o[0],c=o[1]);let f=null,u=null;return i&&(f=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],u=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]),{frameOfReferenceUID:n.string("x00200052"),rows:n.uint16("x00280010"),columns:n.uint16("x00280011"),imageOrientationPatient:i,rowCosines:f,columnCosines:u,imagePositionPatient:a,sliceThickness:s,sliceLocation:n.floatString("x00201041"),pixelSpacing:o,rowPixelSpacing:l,columnPixelSpacing:c}}if(t===r.CINE)return{frameTime:n.floatString("x00181063")};if(t===r.IMAGE_PIXEL)return bR(n);if(t===r.VOI_LUT){const i=NR(n);return{windowCenter:Nr(n,"x00281050",1),windowWidth:Nr(n,"x00281051",1),voiLUTSequence:Qh(i,n.elements.x00283010)}}if(t===r.MODALITY_LUT)return{rescaleIntercept:n.floatString("x00281052"),rescaleSlope:n.floatString("x00281053"),rescaleType:n.string("x00281054"),modalityLUTSequence:Qh(n.uint16("x00280103"),n.elements.x00283000)};if(t===r.SOP_COMMON)return{sopClassUID:n.string("x00080016"),sopInstanceUID:n.string("x00080018")};if(t===r.PET_ISOTOPE){const i=n.elements.x00540016;if(i===void 0)return;const a=i.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:St.parseTM(a.string("x00181072")||""),radionuclideTotalDose:a.floatString("x00181074"),radionuclideHalfLife:a.floatString("x00181075")}}}if(t===r.OVERLAY_PLANE)return loe(n);if(t==="transferSyntax"){let i;try{i=n.string("x00020010")}catch{}return{transferSyntaxUID:i}}if(t===r.PET_SERIES)return{correctedImage:n.string("x00280051"),units:n.string("x00541001"),decayCorrection:n.string("x00541102")};if(t===r.PET_IMAGE)return{frameReferenceTime:n.floatString(n.string("x00541300")||""),actualFrameDuration:n.intString(n.string("x00181242"))};if(t===r.ULTRASOUND_ENHANCED_REGION)return M9(n);if(t===r.CALIBRATION&&n.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:M9(n)};if(t==="instance")return $R(e,Zm,zR)}let Md=[];function doe(t){return`dicomfile:${Md.push(t)-1}`}function poe(t){return Md[t]}function hoe(t){Md[t]=void 0}function moe(){Md=[]}const jR={add:doe,get:poe,remove:hoe,purge:moe};function voe(t){const e=t.intString("x00280008"),n=t.elements.x7fe00010;return e!==n.fragments.length}function KR(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return St.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(voe(t)){const l=St.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return St.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,l)}const n=t.elements.x7fe00010.fragments,r=new St.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),i=St.readSequenceItem(r);if(i.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";r.seek(i.length);const a=r.position;if(e+1>n.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=a+n[e].offset+8,c=n[e].length;return new Uint8Array(r.byteArray.buffer.slice(r.byteArray.byteOffset+s,r.byteArray.byteOffset+s+c))}function yoe(t,e){return t&1<<e}function qR(t,e,n){const r=new Uint8Array(n);for(let i=0;i<n;i++){const a=Math.floor(i/8),o=t[a+e],s=i%8;r[i]=yoe(o,s)?1:0}return r}function XR(t,e){const n=t.elements.x7fe00010||t.elements.x7fe00008,r=t.uint16("x00280100"),i=t.uint16("x00280010"),a=t.uint16("x00280011");let o=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(o=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=n.dataOffset,l=i*a*o;let f;if(r===8){if(f=c+e*l,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l))}else if(r===16){if(f=c+e*l*2,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*2))}else if(r===1){if(f=c+e*l*.125,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return qR(t.byteArray,f,l)}else if(r===32){if(f=c+e*l*4,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*4))}throw new Error("unsupported pixel format")}function YR(t){const e=ru(t),n=parseInt(e.url,10),r=jR.get(n);return new Promise((i,a)=>{const o=new FileReader;o.onload=s=>{const c=s.target.result;i(c)},o.onerror=a,o.readAsArrayBuffer(r)})}function Jm(t,e=0){const n=t.elements.x7fe00010||t.elements.x7fe00008;return n?n.encapsulatedPixelData?KR(t,e):XR(t,e):null}function Qm(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}function Coe(t,e){let n;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?n=Uint8Array:e<=65535&&(n=Uint16Array):t>=-128&&e<=127?n=Int8Array:t>=-32768&&e<=32767&&(n=Int16Array)),n||Float32Array}function sp(t,e,n){t.planarConfiguration===0?MR(t.pixelData,e,n):LR(t.pixelData,e,n)}function Toe(t,e,n){t.planarConfiguration===0?IR(t.pixelData,e,n):VR(t.pixelData,e,n)}function ZR(t,e,n){if(t.photometricInterpretation==="RGB")sp(t,e,n);else if(t.photometricInterpretation==="YBR_RCT")sp(t,e,n);else if(t.photometricInterpretation==="YBR_ICT")sp(t,e,n);else if(t.photometricInterpretation==="PALETTE COLOR")_R(t,e,n);else if(t.photometricInterpretation==="YBR_FULL_422")Pae(t.pixelData,e,n);else if(t.photometricInterpretation==="YBR_FULL")Toe(t,e,n);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function Soe(t){if(t===void 0)return!1;const{rows:e,columns:n,photometricInterpretation:r,pixelDataLength:i,planarConfiguration:a}=t;return i===4*n*e||r==="PALETTE COLOR"?!1:r.endsWith("420")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*e:r.endsWith("422")?i===(3*Math.ceil(n/2)+Math.floor(n/2))*Math.ceil(e/2)+Math.floor(e/2)*n:r!=="RGB"||a===1}function xoe(t){return woe(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function woe(t){let e;try{return decodeURIComponent(escape(t))}catch(n){if(e=n,e instanceof URIError)return t;throw e}}function JR(t,e,n){const r=new Date().getTime(),i=new Blob([e],{type:"image/jpeg"});return new Promise((a,o)=>{const s=new FileReader;s.readAsBinaryString===void 0?s.readAsArrayBuffer(i):s.readAsBinaryString(i),s.onload=function(){const c=new Image;c.onload=function(){n.height=c.height,n.width=c.width,t.rows=c.height,t.columns=c.width;const l=n.getContext("2d");l.drawImage(this,0,0);const f=l.getImageData(0,0,c.width,c.height),u=new Date().getTime();t.pixelData=new Uint8Array(f.data.buffer),t.imageData=f,t.decodeTimeInMS=u-r;const g=Qm(t.pixelData);t.smallestPixelValue=g.min,t.largestPixelValue=g.max,t.pixelDataLength=t.pixelData.length,a(t)},c.onerror=function(l){o(l)},s.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(xoe(s.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(s.result)}`},s.onerror=c=>{o(c)}})}function bn(t,e,n,r,i){const a={...r};delete a.loader,delete a.streamingData;const o=_a(),s=a.priority||void 0;return a.transferPixelData&&n.buffer,o.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:n,options:a,decodeConfig:i},{priority:s,requestType:a==null?void 0:a.requestType})}function Eoe(t,e,n,r,i={},a){switch(e){case"1.2.840.10008.1.2":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.1":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.2":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.1.99":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.5":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?JR(t,n,r):bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.51":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.57":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.70":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.80":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.81":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.90":return bn(t,e,n,i,a);case"1.2.840.10008.1.2.4.91":return bn(t,e,n,i,a);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return bn(t,e,n,i,a)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function QR(t){const e=ee("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function Ooe(t,e){const n=t.get("modalityLutModule",e)||{},r=t.get("generalSeriesModule",e)||{},{modality:i}=r,a={rescaleSlope:n.rescaleSlope,rescaleIntercept:n.rescaleIntercept,modality:i},o=t.get("scalingModule",e)||{};return{...a,...i==="PT"&&{suvbw:o.suvbw}}}function eM(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}let L9="";function Doe(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function Roe(t){const e=t.smallestPixelValue,n=t.largestPixelValue,r=Coe(e,n);if(r){const i=new r(t.pixelData);t.pixelData=i}else throw new Error("Could not apply a typed array to the pixel data")}function Moe(t,e){const n=t.length/4;let r=0,i=0;for(let a=0;a<n;a++)e[i++]=t[r++],e[i++]=t[r++],e[i++]=t[r++],r++;return e}function Ld(t,e,n,r={}){const i=r.useRGBA;if(r.preScale={enabled:r.preScale&&r.preScale.enabled!==void 0?r.preScale.enabled:!0},!(e!=null&&e.length))return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:a}=La,o=document.createElement("canvas"),s=QR(t);if(s.decodeLevel=r.decodeLevel,r.allowFloatRendering=J3(),r.preScale.enabled){const u=Ooe(qI,t);u&&(r.preScale={...r.preScale,scalingParameters:u})}const{decodeConfig:c}=iu();Object.keys(s).forEach(u=>{(typeof s[u]=="function"||s[u]instanceof Promise)&&delete s[u]});const l=Eoe(s,n,e,o,r,c),f=eM(s.photometricInterpretation);return new Promise((u,g)=>{l.then(function(d){let h=!1;if(r.targetBuffer&&r.targetBuffer.type&&!f){const{arrayBuffer:E,type:M,offset:O=0,length:R}=r.targetBuffer,_=d.pixelDataLength,P=O,N=R??_-P,W={Uint8Array,Uint16Array,Int16Array,Float32Array};if(N!==d.pixelDataLength)throw new Error(`target array for image does not have the same length (${N}) as the decoded image length (${d.pixelDataLength}).`);const U=W[M],K=E?new U(E,P,N):new U(d.pixelData);if(N!==d.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");d.pixelData=K,h=!0}h||Roe(d);const p=ee(a.IMAGE_PLANE,t)||{},m=ee(a.VOI_LUT,t)||{},v=ee(a.MODALITY_LUT,t)||{},y=ee(a.SOP_COMMON,t)||{},C=ee(a.CALIBRATION,t)||{},{rows:T,columns:S}=d;if(f){if(Soe(d)){o.height=d.rows,o.width=d.columns;let O=o.getContext("2d").createImageData(d.columns,d.rows);i||(O={...O,data:new Uint8ClampedArray(3*d.columns*d.rows)}),ZR(d,O.data,i),d.imageData=O,d.pixelData=O.data,d.pixelDataLength=O.data.length}else if(!i&&d.pixelDataLength===4*T*S){const M=new Uint8Array(d.pixelData.length/4*3);d.pixelData=Moe(d.pixelData,M),d.pixelDataLength=d.pixelData.length}const E=Qm(d.pixelData);d.smallestPixelValue=E.min,d.largestPixelValue=E.max}const x=ft.createImageVoxelManager({scalarData:d.pixelData,width:d.columns,height:d.rows,numberOfComponents:d.samplesPerPixel}),w={imageId:t,dataType:d.pixelData.constructor.name,color:f,calibration:C,columnPixelSpacing:p.columnPixelSpacing,columns:d.columns,height:d.rows,preScale:d.preScale,intercept:v.rescaleIntercept?v.rescaleIntercept:0,slope:v.rescaleSlope?v.rescaleSlope:1,invert:d.photometricInterpretation==="MONOCHROME1",minPixelValue:d.smallestPixelValue,maxPixelValue:d.largestPixelValue,rowPixelSpacing:p.rowPixelSpacing,rows:d.rows,sizeInBytes:d.pixelData.byteLength,width:d.columns,windowCenter:m.windowCenter?m.windowCenter[0]:void 0,windowWidth:m.windowWidth?m.windowWidth[0]:void 0,voiLUTFunction:m.voiLUTFunction?m.voiLUTFunction:void 0,decodeTimeInMS:d.decodeTimeInMS,floatPixelData:void 0,imageFrame:d,voxelManager:x,rgba:f&&i,getPixelData:()=>d.pixelData,getCanvas:void 0,numberOfComponents:d.samplesPerPixel};if(w.color&&(w.getCanvas=function(){if(L9===t)return o;const E=w.columns,M=w.rows;o.height=M,o.width=E;const O=o.getContext("2d"),R=O.createImageData(E,M),_=d.pixelData;if(_.length===E*M*4)for(let P=0;P<_.length;P++)R.data[P]=_[P];else if(_.length===E*M*3){let P=0;for(let N=0;N<_.length;N+=3)R.data[P++]=_[N],R.data[P++]=_[N+1],R.data[P++]=_[N+2],R.data[P++]=255}return d.pixelData=R.data,d.pixelDataLength=R.data.length,d.imageData=R,O.putImageData(d.imageData,0,0),L9=t,o}),v.modalityLUTSequence&&v.modalityLUTSequence.length>0&&Doe(y.sopClassUID)&&(w.modalityLUT=v.modalityLUTSequence[0]),m.voiLUTSequence&&m.voiLUTSequence.length>0&&(w.voiLUT=m.voiLUTSequence[0]),w.color&&(w.windowWidth=256,w.windowCenter=128),w.windowCenter===void 0||w.windowWidth===void 0){const E=w.imageFrame.smallestPixelValue,M=w.imageFrame.largestPixelValue;w.windowWidth=M-E,w.windowCenter=(M+E)/2}u(w)},g)})}function Loe(t,e){t.decache=function(){const n=ru(e);Zs.unload(n.url)}}function tM(t,e,n=0,r,i,a){const o=new Date().getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise((c,l)=>{t.then(f=>{const u=Jm(f,n),g=f.string("x00020010"),d=new Date().getTime(),h=Ld(e,u,g,i);Loe(s,e),h.then(p=>{p=p,p.data=f,p.sharedCacheKey=r;const m=new Date().getTime();p.loadTimeInMS=d-o,p.totalTimeInMS=m-o,a!==void 0&&a.imageDoneCallback!==void 0&&a.imageDoneCallback(p),c(p)},function(p){l({error:p,dataSet:f})})},function(f){l({error:f})})}),s}function Ioe(t,e,n=0,r,i){const a=new Date().getTime();return{promise:new Promise((s,c)=>{const l=new Date().getTime();let f;try{const u=Jm(t,n),g=t.string("x00020010");f=Ld(e,u,g,i)}catch(u){c({error:u,dataSet:t});return}f.then(u=>{u=u,u.data=t,u.sharedCacheKey=r;const g=new Date().getTime();u.loadTimeInMS=l-a,u.totalTimeInMS=g-a,s(u)},c)}),cancelFn:void 0}}function nM(t){if(t==="dicomweb"||t==="wadouri")return Dd;if(t==="dicomfile")return YR}function Jf(t,e={}){const n=ru(t);e=Object.assign({},e),delete e.loader;const r=nM(n.scheme);if(Zs.isLoaded(n.url)){const a=Zs.get(n.url,r,t);return Ioe(a,t,n.pixelDataFrame,n.url,e)}const i=Zs.load(n.url,r,t);return tM(i,t,n.frame,n.url,e)}function rM(){Mf("dicomweb",Jf),Mf("wadouri",Jf),Mf("dicomfile",Jf),M0(Zm)}const Voe={getImagePixelModule:bR,getLUTs:Qh,getModalityLUTOutputPixelRepresentation:NR,getNumberValues:Nr,metaDataProvider:Zm,metadataForDataset:HR},_oe={metaData:Voe,dataSetCacheManager:Zs,fileManager:jR,getEncapsulatedImageFrame:KR,getUncompressedImageFrame:XR,loadFileRequest:YR,loadImageFromPromise:tM,getLoaderForScheme:nM,getPixelData:Jm,loadImage:Jf,parseImageId:ru,unpackBinaryFrame:qR,register:rM};function pe(t,e,n){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?n:t.Value[e]}function boe(t,e,n){const r=pe(t,e,n);if(r!==void 0)return parseFloat(String(r))}function ke(t,e){const n=pe(t,e);if(n!==void 0)return parseFloat(n)}function gn(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const n=[];for(let r=0;r<t.Value.length;r++)n.push(parseFloat(t.Value[r]));return n}function Noe(t){const e=[];for(let n=0;n<=30;n+=2){let r=`x60${n.toString(16)}`;r.length===4&&(r=`x600${n.toString(16)}`);const i=pe(t[`${r}3000`]);if(!i)continue;const a=[];for(let o=0;o<i.length;o++)for(let s=0;s<8;s++){const c=t.Value[i.dataOffset+o];a[o*8+s]=c>>s&1}e.push({rows:ke(t[`${r}0010`]),columns:ke(t[`${r}0011`]),type:pe(t[`${r}0040`]),x:ke(t[`${r}0050`],1)-1,y:ke(t[`${r}0050`],0)-1,pixelData:a,description:pe(t[`${r}0022`]),label:pe(t[`${r}1500`]),roiArea:pe(t[`${r}1301`]),roiMean:pe(t[`${r}1302`]),roiStandardDeviation:pe(t[`${r}1303`])})}return{overlays:e}}function Id(t){const e=t.indexOf(":");return t.substring(e+1)}function Js(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function iM(t,e,n){const r=(e?Object.values(e[0]):[]).map(a=>a[0]).filter(a=>a!==void 0&&typeof a=="object"),i=(t?Object.values(t[n-1]):[]).map(a=>a.Value[0]).filter(a=>a!==void 0&&typeof a=="object");return{shared:r,perFrame:i}}function aM(t){let{52009230:e,52009229:n,"00280008":r,...i}=t;return e=Js(e,!1),n=Js(n,!1),r=Js(r),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:n,NumberOfFrames:r,rest:i}}function Poe(t,e){const{PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:r,NumberOfFrames:i,rest:a}=aM(e);if(n||i>1){const{shared:o,perFrame:s}=iM(n,r,t),c=Object.assign(e,{frameNumber:t});return[...o,...s].forEach(l=>{Object.entries(l).forEach(([f,u])=>{c[f]=u})}),Object.assign(a,{"00280008":i},c)}return e}let au=[],Tg={};function oM(t){const e=t.indexOf("/frames/")+8,n=t.slice(0,e),r=parseInt(t.slice(e),10);return{metadata:au[`${n}1`],frame:r}}function koe(t){const e=Id(t);return oM(e)}function Foe(t){const e=pe(t["00280008"]);return e&&e>1}function Uoe(t,e){const n=Id(t);Object.defineProperty(e,"isMultiframe",{value:Foe(e),enumerable:!1}),au[n]=e}function Aoe(t){const e=Id(t),n=au[e];if(n&&!(n!=null&&n.isMultiframe))return n;const r=Tg[e];if(r)return r;const i=oM(e);if(!i||!i.metadata)return;const{metadata:a,frame:o}=i;if(a){const s=Poe(o,a);return Tg[e]=s,s}}function Boe(t){const e=Id(t);au[e]=void 0,Tg[e]=void 0}function Goe(){au=[],Tg={}}const e4={add:Uoe,get:Aoe,remove:Boe,purge:Goe};function sM(t){return pe(t["00080060"]).includes("NM")}function t4(t,e){const n=Js(t["00080008"],!1);if(n)return n[e]}function Woe(t){let e;const n=t4(t,2);if(n&&G0(n)){const r=Js(t["00540022"]);r&&(e=gn(r["00200037"],6))}return e}function $oe(t){let e;const n=t4(t,2);if(n&&G0(n)){const r=Js(t["00540022"]);r&&(e=gn(r["00200032"],3))}return e}function I9(t){let e=gn(t["00200037"],6);return!e&&sM(t)&&(e=Woe(t)),e}function V9(t){let e=gn(t["00200032"],3);return!e&&sM(t)&&(e=$oe(t)),e}function fn(t,e){const n=gn(t[e]);return n?n[0]:null}function zoe(t){var e;return(e=t==null?void 0:t.Value)!=null&&e.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function _9(t){const e=zoe(t["00186011"]);return!e||!e.length?null:e.map(r=>{const i=fn(r,"0018602C"),a=fn(r,"0018602E"),o=fn(r,"00186024"),s=fn(r,"00186026"),c=fn(r,"0018601A"),l=fn(r,"0018601E"),f=fn(r,"00186018"),u=fn(r,"0018601C"),g=fn(r,"00186020"),d=fn(r,"00186022"),h=fn(r,"0018602A"),p=fn(r,"00186028"),m=fn(r,"00186012"),v=fn(r,"00186014"),y=fn(r,"00186016"),C=fn(r,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:g,referencePixelY0:d,physicalDeltaX:i,physicalDeltaY:a,physicalUnitsXDirection:o,physicalUnitsYDirection:s,referencePhysicalPixelValueY:h,referencePhysicalPixelValueX:p,regionSpatialFormat:m,regionDataType:v,regionFlags:y,transducerFrequency:C}})}function n4(t,e){const{MetadataModules:n}=La;if(t===n.MULTIFRAME){const{metadata:i,frame:a}=koe(e);if(!i)return;const{PerFrameFunctionalGroupsSequence:o,SharedFunctionalGroupsSequence:s,NumberOfFrames:c}=aM(i);if(o||c>1){const{shared:l,perFrame:f}=iM(o,s,a);return{NumberOfFrames:c,PerFrameFunctionalInformation:f,SharedFunctionalInformation:l}}return{NumberOfFrames:c}}const r=e4.get(e);if(r){if(t===n.GENERAL_STUDY)return{studyDescription:pe(r["00081030"]),studyDate:St.parseDA(pe(r["00080020"])),studyTime:St.parseTM(pe(r["00080030"],0,"")),accessionNumber:pe(r["00080050"])};if(t===n.GENERAL_SERIES)return{modality:pe(r["00080060"]),seriesInstanceUID:pe(r["0020000E"]),seriesNumber:ke(r["00200011"]),studyInstanceUID:pe(r["0020000D"]),seriesDate:St.parseDA(pe(r["00080021"])),seriesTime:St.parseTM(pe(r["00080031"],0,"")),acquisitionDate:St.parseDA(pe(r["00080022"])),acquisitionTime:St.parseTM(pe(r["00080032"],0,""))};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:pe(r["00080018"]),instanceNumber:ke(r["00200013"]),lossyImageCompression:pe(r["00282110"]),lossyImageCompressionRatio:ke(r["00282112"]),lossyImageCompressionMethod:pe(r["00282114"])};if(t===n.PATIENT)return{patientID:pe(r["00100020"]),patientName:pe(r["00100010"])};if(t===n.PATIENT_STUDY)return{patientAge:ke(r["00101010"]),patientSize:ke(r["00101020"]),patientSex:pe(r["00100040"]),patientWeight:ke(r["00101030"])};if(t===n.NM_MULTIFRAME_GEOMETRY){const i=pe(r["00080060"]),a=t4(r,2);return{modality:i,imageType:pe(r["00080008"]),imageSubType:a,imageOrientationPatient:I9(r),imagePositionPatient:V9(r),sliceThickness:ke(r["00180050"]),spacingBetweenSlices:ke(r["00180088"]),pixelSpacing:gn(r["00280030"],2),numberOfFrames:ke(r["00280008"]),isNMReconstructable:G0(a)&&i.includes("NM")}}if(t===n.IMAGE_PLANE){let i=I9(r),a=V9(r);const o=gn(r["00280030"],2);let s=null,c=null,l=null,f=null,u=!1;return o?(c=o[0],s=o[1]):(u=!0,c=1,s=1),i?(l=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],f=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]):(l=[0,1,0],f=[0,0,-1],u=!0,i=[...l,...f]),a||(a=[0,0,0],u=!0),{frameOfReferenceUID:pe(r["00200052"]),rows:ke(r["00280010"]),columns:ke(r["00280011"]),imageOrientationPatient:i,rowCosines:l,columnCosines:f,imagePositionPatient:a,sliceThickness:ke(r["00180050"]),sliceLocation:ke(r["00201041"]),pixelSpacing:o,rowPixelSpacing:c,columnPixelSpacing:s,usingDefaultValues:u}}if(t===n.ULTRASOUND_ENHANCED_REGION)return _9(r);if(t===n.CALIBRATION&&pe(r["00080060"])==="US")return{sequenceOfUltrasoundRegions:_9(r)};if(t===n.IMAGE_URL)return Hoe(e,r);if(t===n.CINE)return joe(e,r);if(t===n.IMAGE_PIXEL)return{samplesPerPixel:ke(r["00280002"]),photometricInterpretation:pe(r["00280004"]),rows:ke(r["00280010"]),columns:ke(r["00280011"]),bitsAllocated:ke(r["00280100"]),bitsStored:ke(r["00280101"]),highBit:pe(r["00280102"]),pixelRepresentation:ke(r["00280103"]),planarConfiguration:ke(r["00280006"]),pixelAspectRatio:pe(r["00280034"]),smallestPixelValue:ke(r["00280106"]),largestPixelValue:ke(r["00280107"]),redPaletteColorLookupTableDescriptor:gn(r["00281101"]),greenPaletteColorLookupTableDescriptor:gn(r["00281102"]),bluePaletteColorLookupTableDescriptor:gn(r["00281103"]),redPaletteColorLookupTableData:gn(r["00281201"]),greenPaletteColorLookupTableData:gn(r["00281202"]),bluePaletteColorLookupTableData:gn(r["00281203"])};if(t===n.VOI_LUT)return{windowCenter:gn(r["00281050"],1),windowWidth:gn(r["00281051"],1)};if(t===n.MODALITY_LUT)return{rescaleIntercept:ke(r["00281052"]),rescaleSlope:ke(r["00281053"]),rescaleType:pe(r["00281054"])};if(t===n.SOP_COMMON)return{sopClassUID:pe(r["00080016"]),sopInstanceUID:pe(r["00080018"])};if(t===n.PET_ISOTOPE){const i=pe(r["00540016"]);return i===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:St.parseTM(pe(i["00181072"],0,"")),radiopharmaceuticalStartDateTime:pe(i["00181078"],0,""),radionuclideTotalDose:ke(i["00181074"]),radionuclideHalfLife:ke(i["00181075"])}}}if(t===n.OVERLAY_PLANE)return Noe(r);if(t==="transferSyntax")return cM(e,r);if(t===n.PET_SERIES)return{correctedImage:pe(r["00280051"]),units:pe(r["00541001"]),decayCorrection:pe(r["00541102"])};if(t===n.PET_IMAGE)return{frameReferenceTime:ke(r["00541300"]),actualFrameDuration:ke(r["00181242"])};if(t==="instance")return $R(e,n4,zR)}}function Hoe(t,e){const{transferSyntaxUID:n}=cM(t,e),r=EE(n),i=t.substring(7),a=i.replace("/frames/","/thumbnail/");let o=i.replace("/frames/","/rendered/");return r&&(o=o.replace("/rendered/1","/rendered")),{isVideo:r,rendered:o,thumbnail:a}}function joe(t,e){return{cineRate:pe(e["00180040"]),numberOfFrames:ke(e["00280008"])}}function cM(t,e){return{transferSyntaxUID:pe(e["00020010"])||pe(e["00083002"])}}function Koe(t,e,n={},r={}){const i=iu(),{retrieveOptions:a={},streamingData:o}=r,s=o.chunkSize||Xoe(e,a,"chunkSize")||65536,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}else console.warn("rangeRequest:Caught",f)};return new Promise(async(f,u)=>{const g=Object.assign({},n);Object.keys(g).forEach(function(d){(g[d]===null||g[d]===void 0)&&delete g[d]});try{o.encodedData||(o.chunkSize=s,o.rangesFetched=0);const d=Yoe(o,a),{encodedData:h,responseHeaders:p}=await qoe(t,g,d,o),m=p.get("content-type"),{totalBytes:v}=o,y=v===h.byteLength,C=Km(m,h,{isPartial:!0}),T=qm(a,y||C.extractDone);f({...C,imageQualityStatus:T,percentComplete:C.extractDone?100:s*100/v})}catch(d){c(d),console.error(d),u(d)}})}async function qoe(t,e,n,r){n&&(e=Object.assign(e,{Range:`bytes=${n[0]}-${n[1]}`}));let{encodedData:i}=r;if(n[1]&&(i==null?void 0:i.byteLength)>n[1])return r;const a=await fetch(t,{headers:e,signal:void 0}),o=await a.arrayBuffer(),s=new Uint8Array(o),{status:c}=a;let l;i?(l=new Uint8Array(i.length+s.length),l.set(i,0),l.set(s,i.length),r.rangesFetched=1):(l=new Uint8Array(s.length),l.set(s,0),r.rangesFetched++),r.encodedData=i=l,r.responseHeaders=a.headers;const f=a.headers.get("Content-Range");return f?r.totalBytes=Number(f.split("/")[1]):c!==206||!n?r.totalBytes=i==null?void 0:i.byteLength:n[1]===""||(i==null?void 0:i.length)<n[1]?r.totalBytes=i.byteLength:r.totalBytes=Number.MAX_SAFE_INTEGER,r}function Xoe(t,e,n){const r=e[n];if(typeof r!="function")return r;const i=e4.get(t);return r(i,t)}function Yoe(t,e){const{totalBytes:n,encodedData:r,chunkSize:i=65536}=t,{rangeIndex:a=0}=e;return a===-1&&(!n||!r)?[0,""]:a===-1||(r==null?void 0:r.byteLength)>n-i?[(r==null?void 0:r.byteLength)||0,""]:[(r==null?void 0:r.byteLength)||0,i*(a+1)-1]}function r4(t,e,n="application/octet-stream",r){const{streamingData:i,retrieveOptions:a={}}=r||{},o={Accept:n};let s=a.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${a.urlArguments}`:t;if(a.framesPath&&(s=s.replace("/frames/",a.framesPath)),(i==null?void 0:i.url)!==s&&(r.streamingData={url:s}),a.rangeIndex!==void 0)return Koe(s,e,o,r);if(a.streaming)return FR(s,e,o,r);const c=Dd(s,e,o),{xhr:l}=c;return c.then(function(f){const u=l.getResponseHeader("Content-Type")||"application/octet-stream",g=Km(u,new Uint8Array(f));return g.imageQualityStatus=qm(a,!0),g})}const{ProgressiveIterator:b9}=ba,{ImageQualityStatus:N9}=La,Zoe=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function Joe(t){const e="1.2.840.10008.1.2";if(!t)return e;const n=t.split(";"),r={};n.forEach(a=>{const o=a.split("=");if(o.length!==2)return;const s=o[1].trim().replace(/"/g,"");r[o[0].trim()]=s});const i={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return r["transfer-syntax"]?r["transfer-syntax"]:t&&!Object.keys(r).length&&i[t]?i[t]:r.type&&i[r.type]?i[r.type]:i[t]?i[t]:e}function Qoe(){return Zl}const ese="multipart/related; type=application/octet-stream; transfer-syntax=*";function lM(t,e={}){const n=Qoe(),r=new Date().getTime(),i=new b9("decompress");async function a(f,u,g){i.generate(async d=>{var m;const h=b9.as(r4(f,u,g,e));let p=10;for await(const v of h){const{pixelData:y,imageQualityStatus:C=N9.FULL_RESOLUTION,percentComplete:T,done:S=!0,extractDone:x=!0}=v,w=Joe(v.contentType);if(!x&&!Zoe.has(w))continue;const E=v.decodeLevel??(C===N9.FULL_RESOLUTION?0:tse(T,(m=e.retrieveOptions)==null?void 0:m.decodeLevel));if(!(!S&&p<=E))try{const M={...e,decodeLevel:E},O=await Ld(u,y,w,M),R=new Date().getTime();O.loadTimeInMS=R-r,O.transferSyntaxUID=w,O.imageQualityStatus=C,d.add(O,S),p=E}catch(M){if(x)throw console.warn("Couldn't decode",M),M}}})}const o=e.requestType||ye.Interaction,s=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,l=t.substring(7);return n.addRequest(a.bind(this,l,t,ese),o,s,c),{promise:i.getDonePromise(),cancelFn:void 0}}function tse(t,e=4){const n=t/100-.02;return n>1/4?Math.min(e,0):n>1/16?Math.min(e,1):n>1/64?Math.min(e,2):Math.min(e,3)}function uM(){Mf("wadors",lM),M0(n4)}const nse={getNumberString:boe,getNumberValue:ke,getNumberValues:gn,getValue:pe,metaDataProvider:n4},rse={metaData:nse,findIndexOfString:t5,getPixelData:r4,loadImage:lM,metaDataManager:e4,register:uM};function ise(){uM(),rM()}const ase=()=>new Worker(new URL("/corenerstone-test-react-vite/assets/decodeImageFrameWorker-TXqc1un-.js",import.meta.url),{type:"module"});function ose(t={}){kR(t),ise();const e=_a(),n=(t==null?void 0:t.maxWebWorkers)||sse();e.registerWorker("dicomImageLoader",ase,{maxWorkerInstances:n})}function sse(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function cse(t,e){if(e=e||t.transferSyntax,t.bitsAllocated===8&&e==="1.2.840.10008.1.2.4.50"&&(t.samplesPerPixel===3||t.samplesPerPixel===4))return!0}const lse={IMPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2",EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1",DEFLATED_EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1.99",EXPLICIT_VR_BIG_ENDIAN:"1.2.840.10008.1.2.2",JPEG_BASELINE_PROCESS_1:"1.2.840.10008.1.2.4.50",JPEG_EXTENDED_PROCESS_2_4:"1.2.840.10008.1.2.4.51",JPEG_EXTENDED_PROCESSES_3_5:"1.2.840.10008.1.2.4.52",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_6_8:"1.2.840.10008.1.2.4.53",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_7_9:"1.2.840.10008.1.2.4.54",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_10_12:"1.2.840.10008.1.2.4.55",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_11_13:"1.2.840.10008.1.2.4.56",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_14:"1.2.840.10008.1.2.4.57",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_15:"1.2.840.10008.1.2.4.58",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_16_18:"1.2.840.10008.1.2.4.59",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_17_19:"1.2.840.10008.1.2.4.60",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_20_22:"1.2.840.10008.1.2.4.61",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_21_23:"1.2.840.10008.1.2.4.62",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_24_26:"1.2.840.10008.1.2.4.63",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_25_27:"1.2.840.10008.1.2.4.64",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_28:"1.2.840.10008.1.2.4.65",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_29:"1.2.840.10008.1.2.4.66",JPEG_LOSSLESS_NONHIERARCHICAL_FIRST_ORDER_PREDICTION_PROCESS_14:"1.2.840.10008.1.2.4.70",JPEG_LS_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.80",JPEG_LS_LOSSY_NEAR_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.81",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.90",JPEG_2000_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.91",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.92",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.93",JPIP_REFERENCED:"1.2.840.10008.1.2.4.94",JPIP_REFERENCED_DEFLATE:"1.2.840.10008.1.2.4.95",MPEG2_MAIN_PROFILE_MAIN_LEVEL:"1.2.840.10008.1.2.4.100",MPEG4_AVC_H264_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.101",MPEG4_AVC_H264_BD_COMPATIBLE_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.102",MPEG4_AVC_H264_HIGH_PROFILE_FOR_2D_VIDEO:"1.2.840.10008.1.2.4.103",MPEG4_AVC_H264_HIGH_PROFILE_FOR_3D_VIDEO:"1.2.840.10008.1.2.4.104",JPIP_LOSSLESS:"1.2.840.10008.1.2.4.96",JPIP_PART2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.97",RFC_2557_MIME_ENCAPSULATION:"1.2.840.10008.1.2.6.1",JPEG_XR_IMAGE_COMPRESSION:"1.2.840.10008.1.2.6.2",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.90R",JPEG_2000_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.91R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.92R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.93R"},use=Object.freeze(Object.defineProperty({__proto__:null,transferSyntaxes:lse},Symbol.toStringTag,{value:"Module"})),P9={constants:use,convertRGBColorByPixel:MR,convertRGBColorByPlane:LR,convertYBRFullByPixel:IR,convertYBRFullByPlane:VR,convertPALETTECOLOR:_R,wadouri:_oe,wadors:rse,init:ose,convertColorSpace:ZR,createImage:Ld,decodeJPEGBaseline8BitColor:JR,getImageFrame:QR,getPixelData:r4,getMinMax:Qm,isColorImage:eM,isJPEGBaseline8BitColor:cse,internal:Kae};async function fse(){mw()||(await GW(),WW(!0),await Mae(),xO(Cg),await P9.init({}),await P9.init({}))}const gse="dicomweb:/corenerstone-test-react-vite/3.dcm";function dse(){const[t,e]=eo.useState(!0),[n,r]=eo.useState(""),i=eo.useRef(null);eo.useEffect(()=>{n&&a()},[n]);const a=async()=>{const o="re-0",s="vp-0";if(!(i!=null&&i.current))return;const c=Va(o)||new CE(o),l={viewportId:s,element:i==null?void 0:i.current,type:lt.STACK};c.getViewport(s)||c.enableElement(l);const f=c.getViewport(s);f.setStack([n],0),f.render(),e(!1);const u=BJ("to");u.addTool(Cg.toolName),u.setToolActive(Cg.toolName,{bindings:[{mouseButton:Fo.Primary}]}),u.addViewport(s,o)};return eo.useEffect(()=>{fse().then(()=>{Vo(gse).then(o=>{r(o.imageId)})})},[]),uc.jsx("div",{className:"w-full h-[100vh] flex items-center justify-center",ref:i,children:t?uc.jsx("span",{children:"Loading ..."}):uc.jsx(uc.Fragment,{})})}q7(document.getElementById("root")).render(uc.jsx(dse,{}));
